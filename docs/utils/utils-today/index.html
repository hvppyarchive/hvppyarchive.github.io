<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.27.1 by Michael Rose
  Copyright 2013-2025 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Today 업무 보조 툴 - ARCHIVE</title>
<meta name="description" content="">


  <meta name="author" content="hvppyarchive">
  
  <meta property="article:author" content="hvppyarchive">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="ARCHIVE">
<meta property="og:title" content="Today 업무 보조 툴">
<meta property="og:url" content="https://hvppyarchive.github.io/utils/utils-today/">


  <meta property="og:description" content="">







  <meta property="article:published_time" content="2025-08-29T16:18:01+09:00">





  

  


<link rel="canonical" href="https://hvppyarchive.github.io/utils/utils-today/">












<!-- end _includes/seo.html -->


<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->
<!-- hvppyarchive: add fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@200..900&display=swap" rel="stylesheet">

<!-- insert favicons. use https://realfavicongenerator.net/ -->
 <!-- hvppyarchive: add favicons -->
<link rel="icon" type="image/png" href="/assets/favicon/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/assets/favicon/favicon.svg" />
<link rel="shortcut icon" href="/assets/favicon/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png" />
<link rel="manifest" href="/assets/favicon/site.webmanifest" />

<!-- end custom head snippets -->

  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          ARCHIVE
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/year-archive/"
                
                
              >Posts</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Today 업무 보조 툴">
    <meta itemprop="description" content="">
    <meta itemprop="datePublished" content="2025-08-29T16:18:01+09:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://hvppyarchive.github.io/utils/utils-today/" itemprop="url">Today 업무 보조 툴
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <!-- hvppyarchive: remove date icon
        <i class="far fa-calendar-alt" aria-hidden="true"></i> 
        -->
        
        <time datetime="2025-08-29T16:18:01+09:00">2025-08-29</time>
      </span>
    

    

    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="chat--user">

today 업무 보조 툴 개발 배경: 자주 사용하는 각종 주소 치기, 필요한 커맨드 치기 귀찮음. 이를 효율적으로 관리하고 싶음 툴 이름: today 명세: today 입력 시 현재 쉘(tcsh)에서 실행됨 먼저 등록된 shortcut list(label, path, command_list)보여지고, 숫자 입력 시 해당 path로 이동, command 실행 숫자가 아니라 등록 기능을 실행 (A)dd 시 interactive하게 label, path(기본은 현재 장소가 쳐진 상태, 만약 바꾸고 싶으면 지우고 치게할 수 있을까? 만약 아무것도 없으면 나중에 cd 자체를 안하게 하고 싶음), command list(;로 구분됨)을 각각 입력 받음 삭제 기능도 필요 내가 생각하고 있는 구현법(꼭 따르지 않아도 되며 더 좋은 방법이 있으면 생각해내도 됨) today.csh: tcsh 파일, 내부에서 파이썬 스크립트를 실행 (argument로 커맨드 저장할 경로 전달 (e.g. ~/.config/today/command_YYMMDD_HHMMSS.csh)) 명세 2번은 파이썬에서 실행되고 전달 받은 경로에 실행할 커맨드들을 write (e.g. cd path; command1; command2;) 그 후 tcsh 나머지 코드에서 해당 경로를 source 

</p>

<p>좋아요—요구하신 “today” 업무 보조 툴을 tcsh용으로 설계·구현해서 바로 쓸 수 있는 형태로 만들어 드렸어요. 아래 순서대로 진행하면 끝납니다. (요청하신 대로 단계별로 생각·설계·구현을 풀어서 안내할게요.)</p>

<p>⬇️ today.csh / today.py 내려받기</p>

<hr />

<h1 id="1-목표-정리-step-by-step-사고">1) 목표 정리 (step-by-step 사고)</h1>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">today</code>를 <strong>현재 tcsh 세션 안에서</strong> 실행 → 목록 표시 → 번호 입력 시</p>

    <ul>
      <li>
        <p>(선택한 항목의) <code class="language-plaintext highlighter-rouge">cd &lt;path&gt;</code> 실행</p>
      </li>
      <li>
        <p>이어서 <code class="language-plaintext highlighter-rouge">command_list</code>를 차례로 실행</p>
      </li>
    </ul>
  </li>
  <li>
    <p>목록 외 입력:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">A</code>(Add): label / path / command_list(<code class="language-plaintext highlighter-rouge">;</code>로 구분) <strong>인터랙티브 입력</strong></p>

        <ul>
          <li>
            <p>Path 기본값은 <strong>현재 디렉터리</strong></p>

            <ul>
              <li>
                <p><code class="language-plaintext highlighter-rouge">Enter</code> → 현재 디렉터리 사용</p>
              </li>
              <li>
                <p><code class="language-plaintext highlighter-rouge">-</code>(하이픈) → <strong>cd 하지 않음</strong></p>
              </li>
              <li>
                <p>그 외 직접 경로 입력</p>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">D</code>(Delete): 숫자(들)로 삭제</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">Q</code> 또는 빈 입력 → 종료</p>
      </li>
    </ul>
  </li>
  <li>
    <p>내부 동작 방식</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">today.csh</code>(tcsh 스크립트) → <code class="language-plaintext highlighter-rouge">python3 today.py</code> 실행</p>
      </li>
      <li>
        <p>사용자가 번호를 골랐을 때만, 파이썬이 <code class="language-plaintext highlighter-rouge">cd</code>와 커맨드를 담은 <strong>임시 .csh 파일</strong> 을 작성</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">today.csh</code>가 그 파일을 <strong>source</strong> 해서 <strong>현재 쉘</strong> 에서 실행되도록 함</p>
      </li>
      <li>
        <p>실행 후 임시 파일 삭제</p>
      </li>
    </ul>
  </li>
  <li>
    <p>데이터 저장 형식</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">~/.config/today/shortcuts.json</code> (JSON)
        <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="nl">"label"</span><span class="p">:</span><span class="s2">"예시"</span><span class="p">,</span><span class="nl">"path"</span><span class="p">:</span><span class="s2">"/path/to/dir"</span><span class="p">,</span><span class="nl">"command_list"</span><span class="p">:[</span><span class="s2">"ls -al"</span><span class="p">,</span><span class="s2">"git status"</span><span class="p">]}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>        </div>
      </li>
      <li>파일 없으면 자동 생성</li>
    </ul>
  </li>
</ol>

<hr />

<h1 id="2-설치">2) 설치</h1>

<ol>
  <li>위의 압축 폴더에서 두 파일을 복사:</li>
</ol>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">today.py</code> → <code class="language-plaintext highlighter-rouge">~/.local/bin/today.py</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">today.csh</code> → <code class="language-plaintext highlighter-rouge">~/.local/bin/today.csh</code></p>
  </li>
</ul>

<ol>
  <li>실행 권한:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

chmod +x ~/.local/bin/today.py
chmod +x ~/.local/bin/today.csh
</code></pre></div></div>

<ol>
  <li>tcsh에 <strong>alias</strong> 추가(현재 쉘에서 동작시키려면 source 필요):</li>
</ol>

<ul>
  <li><code class="language-plaintext highlighter-rouge">~/.tcshrc</code>에 다음 한 줄을 넣고 새 세션을 열거나 <code class="language-plaintext highlighter-rouge">source ~/.tcshrc</code>:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

alias today 'source ~/.local/bin/today.csh'
</code></pre></div></div>

<blockquote>
  <p>참고: <code class="language-plaintext highlighter-rouge">today.csh</code>는 기본적으로 <code class="language-plaintext highlighter-rouge">~/.local/bin/today.py</code>를 찾습니다. 위치를 바꿨다면 <code class="language-plaintext highlighter-rouge">today.csh</code> 안의 <code class="language-plaintext highlighter-rouge">set script_path = ...</code> 경로만 수정하면 돼요.</p>
</blockquote>

<hr />

<h1 id="3-사용법">3) 사용법</h1>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">today</code> 입력 → 등록 목록 표시</p>

    <ul>
      <li>
        <p><strong>번호</strong> 입력 → 해당 항목 실행(필요 시 <code class="language-plaintext highlighter-rouge">cd</code> 후 커맨드 순차 실행)</p>
      </li>
      <li>
        <p><strong>A</strong> → 추가 모드</p>

        <ul>
          <li>
            <p>Label: 필수</p>
          </li>
          <li>
            <p>Path: 프롬프트에 <code class="language-plaintext highlighter-rouge">[현재경로]</code> 표시</p>

            <ul>
              <li>
                <p><code class="language-plaintext highlighter-rouge">Enter</code> → 표시된 현재경로 사용</p>
              </li>
              <li>
                <p><code class="language-plaintext highlighter-rouge">-</code> → <strong>cd 생략(= path 없음)</strong></p>
              </li>
              <li>
                <p>그 외 직접 입력</p>
              </li>
            </ul>
          </li>
          <li>
            <p>Commands: <code class="language-plaintext highlighter-rouge">;</code>로 구분 (예: <code class="language-plaintext highlighter-rouge">git pull; npm run start</code>)</p>
          </li>
        </ul>
      </li>
      <li>
        <p><strong>D</strong> → 삭제(여러 개면 공백/콤마 구분)</p>
      </li>
      <li>
        <p><strong>Q</strong> 또는 빈 입력 → 종료</p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h1 id="4-코드-개요-요점만">4) 코드 개요 (요점만)</h1>

<h3 id="todaycsh-tcsh-래퍼">today.csh (tcsh 래퍼)</h3>

<ul>
  <li>
    <p>설정 디렉터리 <code class="language-plaintext highlighter-rouge">~/.config/today</code> 생성</p>
  </li>
  <li>
    <p>타임스탬프 기반 임시 실행 파일 경로 생성: <code class="language-plaintext highlighter-rouge">command_YYMMDD_HHMMSS.csh</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">python3 today.py --db ~/.config/today/shortcuts.json --out &lt;임시파일&gt;</code> 호출</p>
  </li>
  <li>
    <p>파이썬이 임시파일을 만들었으면 <strong>source</strong> 하고 삭제<br />
(→ <code class="language-plaintext highlighter-rouge">cd</code>/커맨드가 <strong>현재 쉘</strong> 에서 실행됨)</p>
  </li>
</ul>

<h3 id="todaypy-인터랙티브-ui--실행-스크립트-생성">today.py (인터랙티브 UI + 실행 스크립트 생성)</h3>

<ul>
  <li>
    <p>목록 출력 → 입력 처리(번호/A/D/Q)</p>
  </li>
  <li>
    <p>Add:</p>

    <ul>
      <li>
        <p>Path 입력 가이드: <code class="language-plaintext highlighter-rouge">Enter=현재경로</code>, <code class="language-plaintext highlighter-rouge">- = cd하지 않음</code>, 그 외 수동입력</p>
      </li>
      <li>
        <p>Commands: <code class="language-plaintext highlighter-rouge">;</code>로 split, 공백 트림</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Delete:</p>

    <ul>
      <li>여러 번호 처리, 역순 삭제</li>
    </ul>
  </li>
  <li>
    <p>Run(번호):</p>

    <ul>
      <li>
        <p>선택 항목의 <code class="language-plaintext highlighter-rouge">cd</code>와 커맨드를 담은 <strong>tcsh 스크립트</strong> 생성</p>

        <ul>
          <li>
            <p><code class="language-plaintext highlighter-rouge">if ( -d "&lt;path&gt;" ) cd "&lt;path&gt;"</code></p>
          </li>
          <li>
            <p>명령어들은 줄바꿈으로 한 줄씩 출력</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>DB 저장은 <strong>원자적 저장</strong>(임시파일 → <code class="language-plaintext highlighter-rouge">os.replace</code>)</p>
  </li>
</ul>

<hr />

<h1 id="5-작은-예시">5) 작은 예시</h1>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">today</code> → <code class="language-plaintext highlighter-rouge">A</code></p>

    <ul>
      <li>
        <p>Label: <code class="language-plaintext highlighter-rouge">work-log</code></p>
      </li>
      <li>
        <p>Path: <code class="language-plaintext highlighter-rouge">Enter</code> (현재 디렉터리)</p>
      </li>
      <li>
        <p>Commands: <code class="language-plaintext highlighter-rouge">git pull; code .</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p>다시 <code class="language-plaintext highlighter-rouge">today</code> → <code class="language-plaintext highlighter-rouge">1</code> 입력</p>

    <ul>
      <li>현재 디렉터리로 <code class="language-plaintext highlighter-rouge">cd</code> (또는 생략됨) → <code class="language-plaintext highlighter-rouge">git pull</code> → <code class="language-plaintext highlighter-rouge">code .</code></li>
    </ul>
  </li>
</ol>

<hr />

<h1 id="6-확장-아이디어-선택">6) 확장 아이디어 (선택)</h1>

<ul>
  <li>
    <p><strong>Edit (E)</strong> 지원: 기존 항목 수정(오늘 스펙엔 없어서 기본 미구현)</p>
  </li>
  <li>
    <p><strong>검색 (/) 지원</strong> : label 키워드로 필터 표시</p>
  </li>
  <li>
    <p><strong>label 바로 실행</strong> : <code class="language-plaintext highlighter-rouge">today some-label</code> 같은 논옵션 실행(현재는 인터랙티브만)</p>
  </li>
  <li>
    <p><strong>백업/복원</strong> : <code class="language-plaintext highlighter-rouge">~/.config/today/shortcuts.json</code> 버전 관리</p>
  </li>
</ul>

<hr />

<p>필요하시면 <code class="language-plaintext highlighter-rouge">Edit</code> 기능이나 비인터랙티브 실행(<code class="language-plaintext highlighter-rouge">today 3</code>/<code class="language-plaintext highlighter-rouge">today label</code>)도 바로 추가해 드릴게요.</p>

<p class="chat--user">

두 파일 그냥 본문에 써줘.

</p>

<p><strong>today.csh</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

#!/bin/tcsh
# today.csh - tcsh wrapper that calls today.py and sources the generated command file
# Usage: type `today` in your tcsh (after setting alias) to run interactively.

# Ensure config directory exists
if ( ! -d "$HOME/.config/today" ) then
    mkdir -p "$HOME/.config/today"
endif

set config_dir = "$HOME/.config/today"
set timestamp = `date +"%y%m%d_%H%M%S"`
set out_file = "$config_dir/command_$timestamp.csh"

# Prefer python3
set python = `which python3`
if ( "$python" == "" ) then
    echo "python3 not found in PATH"
    exit 1
endif

# Default install path for today.py (adjust if you put it elsewhere)
set script_path = "$HOME/.local/bin/today.py"
if ( ! -e "$script_path" ) then
    echo "today.py not found at $script_path"
    echo "Please place today.py there or edit today.csh to point to the correct path."
    exit 1
endif

# Run the Python helper (it writes $out_file if you selected a shortcut to run)
"$python" "$script_path" --db "$config_dir/shortcuts.json" --out "$out_file"
set code = $status
if ( $code != 0 ) then
    exit $code
endif

# If a command file was produced, source it in the CURRENT shell, then remove it
if ( -e "$out_file" ) then
    source "$out_file"
    /bin/rm -f "$out_file"
endif
</code></pre></div></div>

<p><strong>today.py</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
# today.py - interactive shortcut runner/editor for tcsh via today.csh
</span><span class="kn">import</span> <span class="n">argparse</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">tempfile</span><span class="p">,</span> <span class="n">shutil</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="k">def</span> <span class="nf">load_db</span><span class="p">(</span><span class="n">db_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">db_path</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">db_path</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="c1"># Normalize
</span>        <span class="n">norm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">norm</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">,</span><span class="sh">""</span><span class="p">).</span><span class="nf">strip</span><span class="p">(),</span>
                <span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]</span>
            <span class="p">})</span>
        <span class="k">return</span> <span class="n">norm</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[today] Failed to read DB: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">save_db</span><span class="p">(</span><span class="n">db_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
    <span class="n">db_path</span><span class="p">.</span><span class="n">parent</span><span class="p">.</span><span class="nf">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">db_path</span><span class="p">.</span><span class="nf">with_suffix</span><span class="p">(</span><span class="sh">"</span><span class="s">.tmp</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">tmp</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">db_path</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">print_list</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">등록된 shortcut이 없습니다. (A로 추가)</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">== Shortcuts ==</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">it</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">(no label)</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">path</span>  <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">(no cd)</span><span class="sh">"</span>
        <span class="n">cmds</span>  <span class="o">=</span> <span class="sh">"</span><span class="s">; </span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">,</span> <span class="p">[]))</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">(no commands)</span><span class="sh">"</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="o">&gt;</span><span class="mi">3</span><span class="si">}</span><span class="s">) </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="se">\n</span><span class="s">     path: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="se">\n</span><span class="s">     cmd : </span><span class="si">{</span><span class="n">cmds</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">prompt</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">input</span><span class="p">(</span><span class="n">msg</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s"> [</span><span class="si">{</span><span class="n">default</span><span class="si">}</span><span class="s">] </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="sh">""</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>
        <span class="k">return</span> <span class="n">s</span>

<span class="k">def</span> <span class="nf">do_add</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">--- Add Shortcut ---</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Label: </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Label은 비어 있을 수 없습니다.</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">PWD</span><span class="sh">"</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="nf">getcwd</span><span class="p">())</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Path 입력 방법: Enter=현재 경로 사용, </span><span class="sh">'</span><span class="s">-</span><span class="sh">'</span><span class="s">=cd 하지 않음, 그 외 직접 경로 입력</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">raw_path</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Path [</span><span class="si">{</span><span class="n">cwd</span><span class="si">}</span><span class="s">]: </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">raw_path</span> <span class="o">==</span> <span class="sh">""</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">cwd</span>
    <span class="k">elif</span> <span class="n">raw_path</span> <span class="o">==</span> <span class="sh">"</span><span class="s">-</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">raw_path</span>

    <span class="n">raw_cmds</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Command list (</span><span class="sh">'</span><span class="s">;</span><span class="sh">'</span><span class="s">로 구분, 비우면 없음): </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="n">command_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">raw_cmds</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">;</span><span class="sh">"</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span><span class="p">.</span><span class="nf">strip</span><span class="p">()]</span> <span class="k">if</span> <span class="n">raw_cmds</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="n">items</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span><span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">:</span> <span class="n">label</span><span class="p">,</span> <span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">:</span> <span class="n">command_list</span><span class="p">})</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">추가됨: </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">items</span>

<span class="k">def</span> <span class="nf">do_delete</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">삭제할 항목이 없습니다.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span>
    <span class="nf">print_list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">삭제할 번호(여러 개는 공백/콤마로 구분): </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">items</span>
    <span class="n">picks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">s</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">).</span><span class="nf">split</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">tok</span><span class="p">.</span><span class="nf">isdigit</span><span class="p">():</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">tok</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">idx</span> <span class="o">&lt;=</span> <span class="nf">len</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
                <span class="n">picks</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">picks</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">유효한 번호가 없습니다.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">sorted</span><span class="p">(</span><span class="nf">set</span><span class="p">(</span><span class="n">picks</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">removed</span> <span class="o">=</span> <span class="n">items</span><span class="p">.</span><span class="nf">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">삭제됨: </span><span class="si">{</span><span class="n">removed</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">label</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">(no label)</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">items</span>

<span class="k">def</span> <span class="nf">write_tcsh</span><span class="p">(</span><span class="n">out_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">command_list</span><span class="p">):</span>
    <span class="n">out_path</span><span class="p">.</span><span class="n">parent</span><span class="p">.</span><span class="nf">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">out_path</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">"</span><span class="s">#!/bin/tcsh</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">"</span><span class="s"># Auto-generated by today.py</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
            <span class="c1"># Quote path safely
</span>            <span class="n">qpath</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'"'</span><span class="p">,</span> <span class="sa">r</span><span class="sh">'</span><span class="s">\"</span><span class="sh">'</span><span class="p">)</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">if ( -d </span><span class="sh">"</span><span class="si">{</span><span class="n">qpath</span><span class="si">}</span><span class="sh">"</span><span class="s"> ) cd </span><span class="sh">"</span><span class="si">{</span><span class="n">qpath</span><span class="si">}</span><span class="sh">"</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">command_list</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">cmd</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">chmod</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="mo">0o700</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">ap</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="nc">ArgumentParser</span><span class="p">()</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--db</span><span class="sh">"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Path to shortcuts.json</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--out</span><span class="sh">"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Path to write the tcsh command file</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">ap</span><span class="p">.</span><span class="nf">parse_args</span><span class="p">()</span>
    <span class="n">db_path</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">expanduser</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">db</span><span class="p">))</span>
    <span class="n">out_path</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">expanduser</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">out</span><span class="p">))</span>
    <span class="n">items</span> <span class="o">=</span> <span class="nf">load_db</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>

    <span class="c1"># UI
</span>    <span class="nf">print_list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">선택: 번호=실행, A=추가, D=삭제, Q=종료</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">choice</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">&gt; </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">choice</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">q</span><span class="sh">"</span> <span class="ow">or</span> <span class="n">choice</span> <span class="o">==</span> <span class="sh">""</span><span class="p">:</span>
        <span class="c1"># No action; do not write out file
</span>        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">choice</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nf">do_add</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="nf">save_db</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">choice</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nf">do_delete</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="nf">save_db</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">choice</span><span class="p">.</span><span class="nf">isdigit</span><span class="p">():</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">choice</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
            <span class="n">picked</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="nf">write_tcsh</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="n">picked</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">),</span> <span class="n">picked</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">,</span> <span class="p">[]))</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">실행 준비: </span><span class="si">{</span><span class="n">picked</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">label</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">잘못된 번호입니다.</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">알 수 없는 입력입니다.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">2</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<p class="chat--user">

출력 화면에 색깔이나 표 형식같은 포매팅을 넣어서 가시성을 높이는거 가능해?

</p>

<p>가능해요! 컬러와 표 형태를 지원하도록 <code class="language-plaintext highlighter-rouge">today.py</code>를 업데이트한 버전을 아래에 넣었습니다.</p>

<ul>
  <li>
    <p><strong>기본은 자동 감지</strong>(TTY + <code class="language-plaintext highlighter-rouge">NO_COLOR</code> 미설정이면 컬러 가능).</p>
  </li>
  <li>
    <p><strong>선택적으로<code class="language-plaintext highlighter-rouge">rich</code>가 설치되어 있으면 더 예쁜 표</strong>로 보여주고, 없으면 <strong>ANSI 컬러 + ASCII 표</strong> 로 깔끔히 출력합니다.</p>
  </li>
  <li>
    <p>컬러를 끄고 싶으면 <code class="language-plaintext highlighter-rouge">--no-color</code> 옵션이나 환경변수 <code class="language-plaintext highlighter-rouge">NO_COLOR=1</code>을 사용하세요.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">today.csh</code>는 그대로 쓰시면 됩니다.</p>
  </li>
</ul>

<hr />

<p><strong>today.py (포매팅 강화 버전)</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
# today.py - interactive shortcut runner/editor for tcsh via today.csh
</span><span class="kn">import</span> <span class="n">argparse</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">shutil</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># -------- Color / Table detection --------
</span><span class="n">HAVE_RICH</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">console</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Optional pretty output if 'rich' is available
</span>    <span class="kn">from</span> <span class="n">rich.console</span> <span class="kn">import</span> <span class="n">Console</span>
    <span class="kn">from</span> <span class="n">rich.table</span> <span class="kn">import</span> <span class="n">Table</span>
    <span class="kn">from</span> <span class="n">rich</span> <span class="kn">import</span> <span class="n">box</span>
    <span class="n">HAVE_RICH</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">console</span> <span class="o">=</span> <span class="nc">Console</span><span class="p">()</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="n">HAVE_RICH</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">console</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">term_width</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">shutil</span><span class="p">.</span><span class="nf">get_terminal_size</span><span class="p">((</span><span class="n">default</span><span class="p">,</span> <span class="mi">20</span><span class="p">)).</span><span class="n">columns</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>

<span class="k">def</span> <span class="nf">ansi_enabled</span><span class="p">(</span><span class="n">no_color_flag</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="c1"># Enable ANSI if stdout is a TTY, NO_COLOR not set, and user didn't pass --no-color
</span>    <span class="k">if</span> <span class="n">no_color_flag</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">NO_COLOR</span><span class="sh">"</span><span class="p">):</span> <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="nf">isatty</span><span class="p">()</span>

<span class="c1"># Basic ANSI styles
</span><span class="k">class</span> <span class="nc">S</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">on</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">on</span> <span class="o">=</span> <span class="n">on</span>
        <span class="n">self</span><span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\033</span><span class="s">[0m</span><span class="sh">"</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="sh">""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">header</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\033</span><span class="s">[1;36m</span><span class="sh">"</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="sh">""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">index</span>  <span class="o">=</span> <span class="sh">"</span><span class="se">\033</span><span class="s">[1;33m</span><span class="sh">"</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="sh">""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">ok</span>     <span class="o">=</span> <span class="sh">"</span><span class="se">\033</span><span class="s">[1;32m</span><span class="sh">"</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="sh">""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">warn</span>   <span class="o">=</span> <span class="sh">"</span><span class="se">\033</span><span class="s">[1;31m</span><span class="sh">"</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="sh">""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">dim</span>    <span class="o">=</span> <span class="sh">"</span><span class="se">\033</span><span class="s">[2m</span><span class="sh">"</span>    <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="sh">""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">bold</span>   <span class="o">=</span> <span class="sh">"</span><span class="se">\033</span><span class="s">[1m</span><span class="sh">"</span>    <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="sh">""</span>

<span class="c1"># -------- Data IO --------
</span><span class="k">def</span> <span class="nf">load_db</span><span class="p">(</span><span class="n">db_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">db_path</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">db_path</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">norm</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">,</span><span class="sh">""</span><span class="p">).</span><span class="nf">strip</span><span class="p">(),</span>
                <span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]</span>
            <span class="p">})</span>
        <span class="k">return</span> <span class="n">norm</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[today] Failed to read DB: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">save_db</span><span class="p">(</span><span class="n">db_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
    <span class="n">db_path</span><span class="p">.</span><span class="n">parent</span><span class="p">.</span><span class="nf">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">db_path</span><span class="p">.</span><span class="nf">with_suffix</span><span class="p">(</span><span class="sh">"</span><span class="s">.tmp</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">tmp</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">db_path</span><span class="p">)</span>

<span class="c1"># -------- Rendering --------
</span><span class="k">def</span> <span class="nf">ellipsize</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">maxlen</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span>
    <span class="k">if</span> <span class="n">maxlen</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span><span class="p">[:</span><span class="n">maxlen</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">[:</span><span class="n">maxlen</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="sh">"</span><span class="s">…</span><span class="sh">"</span>

<span class="k">def</span> <span class="nf">render_list</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">styles</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">use_rich</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sh">"</span><span class="s">등록된 shortcut이 없습니다. (A로 추가)</span><span class="sh">"</span>
        <span class="k">if</span> <span class="n">use_rich</span> <span class="ow">and</span> <span class="n">HAVE_RICH</span><span class="p">:</span>
            <span class="n">console</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[bold yellow]</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">[/bold yellow]</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">styles</span><span class="p">.</span><span class="n">index</span><span class="si">}{</span><span class="n">msg</span><span class="si">}{</span><span class="n">styles</span><span class="p">.</span><span class="n">reset</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Decide column widths
</span>    <span class="n">width</span> <span class="o">=</span> <span class="nf">term_width</span><span class="p">()</span>
    <span class="c1"># Base min widths
</span>    <span class="n">w_idx</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">items</span><span class="p">))))</span>
    <span class="c1"># we'll allocate remaining width among label/path/cmds heuristically
</span>    <span class="n">remaining</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="n">w_idx</span> <span class="o">+</span> <span class="mi">6</span><span class="p">))</span>  <span class="c1"># borders + spacing allowance
</span>    <span class="n">w_label</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">remaining</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">))</span>
    <span class="n">w_path</span>  <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">remaining</span> <span class="o">*</span> <span class="mf">0.35</span><span class="p">))</span>
    <span class="n">w_cmds</span>  <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">remaining</span> <span class="o">-</span> <span class="n">w_label</span> <span class="o">-</span> <span class="n">w_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">use_rich</span> <span class="ow">and</span> <span class="n">HAVE_RICH</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="nc">Table</span><span class="p">(</span><span class="n">box</span><span class="o">=</span><span class="n">box</span><span class="p">.</span><span class="n">SIMPLE</span><span class="p">,</span> <span class="n">show_lines</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">table</span><span class="p">.</span><span class="nf">add_column</span><span class="p">(</span><span class="sh">"</span><span class="s">#</span><span class="sh">"</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="sh">"</span><span class="s">right</span><span class="sh">"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">bold yellow</span><span class="sh">"</span><span class="p">,</span> <span class="n">no_wrap</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">table</span><span class="p">.</span><span class="nf">add_column</span><span class="p">(</span><span class="sh">"</span><span class="s">Label</span><span class="sh">"</span><span class="p">,</span> <span class="n">overflow</span><span class="o">=</span><span class="sh">"</span><span class="s">fold</span><span class="sh">"</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">w_label</span><span class="p">)</span>
        <span class="n">table</span><span class="p">.</span><span class="nf">add_column</span><span class="p">(</span><span class="sh">"</span><span class="s">Path</span><span class="sh">"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">dim</span><span class="sh">"</span><span class="p">,</span> <span class="n">overflow</span><span class="o">=</span><span class="sh">"</span><span class="s">fold</span><span class="sh">"</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">w_path</span><span class="p">)</span>
        <span class="n">table</span><span class="p">.</span><span class="nf">add_column</span><span class="p">(</span><span class="sh">"</span><span class="s">Commands</span><span class="sh">"</span><span class="p">,</span> <span class="n">overflow</span><span class="o">=</span><span class="sh">"</span><span class="s">fold</span><span class="sh">"</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">w_cmds</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">it</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">(no label)</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">(no label)</span><span class="sh">"</span>
            <span class="n">path</span>  <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">(no cd)</span><span class="sh">"</span>
            <span class="n">cmds</span>  <span class="o">=</span> <span class="sh">"</span><span class="s">; </span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">,</span> <span class="p">[]))</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">(no commands)</span><span class="sh">"</span>
            <span class="n">table</span><span class="p">.</span><span class="nf">add_row</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">label</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">cmds</span><span class="p">)</span>
        <span class="n">console</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Plain ASCII table with optional ANSI header
</span>        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">#</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Label</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Path</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Commands</span><span class="sh">"</span><span class="p">]</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">it</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="nf">ellipsize</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">(no label)</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">(no label)</span><span class="sh">"</span><span class="p">,</span> <span class="n">w_label</span><span class="p">)</span>
            <span class="n">path</span>  <span class="o">=</span> <span class="nf">ellipsize</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">(no cd)</span><span class="sh">"</span><span class="p">,</span> <span class="n">w_path</span><span class="p">)</span>
            <span class="n">cmds</span>  <span class="o">=</span> <span class="nf">ellipsize</span><span class="p">(</span><span class="sh">"</span><span class="s">; </span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">,</span> <span class="p">[]))</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">(no commands)</span><span class="sh">"</span><span class="p">,</span> <span class="n">w_cmds</span><span class="p">)</span>
            <span class="n">rows</span><span class="p">.</span><span class="nf">append</span><span class="p">([</span><span class="nf">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">label</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">cmds</span><span class="p">])</span>

        <span class="n">widths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nf">max</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nf">max</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">)),</span>
            <span class="nf">max</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nf">max</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">)),</span>
            <span class="nf">max</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nf">max</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">)),</span>
            <span class="nf">max</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="nf">max</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">)),</span>
        <span class="p">]</span>

        <span class="k">def</span> <span class="nf">sep</span><span class="p">():</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">+</span><span class="sh">"</span> <span class="o">+</span> <span class="sh">"</span><span class="s">+</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span><span class="o">*</span><span class="p">(</span><span class="n">w</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">widths</span><span class="p">)</span> <span class="o">+</span> <span class="sh">"</span><span class="s">+</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">row_print</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">is_header</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s"> </span><span class="si">{</span><span class="n">v</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="n">widths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="si">}</span><span class="s"> </span><span class="sh">"</span>
                <span class="n">out</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="sh">"</span><span class="s">|</span><span class="sh">"</span> <span class="o">+</span> <span class="sh">"</span><span class="s">|</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">+</span> <span class="sh">"</span><span class="s">|</span><span class="sh">"</span>
            <span class="k">if</span> <span class="n">is_header</span> <span class="ow">and</span> <span class="n">styles</span><span class="p">.</span><span class="n">on</span><span class="p">:</span>
                <span class="c1"># Header accent
</span>                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">styles</span><span class="p">.</span><span class="n">header</span><span class="si">}{</span><span class="n">line</span><span class="si">}{</span><span class="n">styles</span><span class="p">.</span><span class="n">reset</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="nf">sep</span><span class="p">()</span>
        <span class="nf">row_print</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">is_header</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="nf">sep</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="nf">row_print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="nf">sep</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">info_line</span><span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">styles</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="sh">"</span><span class="s">ok</span><span class="sh">"</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">HAVE_RICH</span> <span class="ow">and</span> <span class="n">console</span><span class="p">:</span>
        <span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">ok</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">bold green</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">warn</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">bold red</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">note</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">bold cyan</span><span class="sh">"</span><span class="p">}.</span><span class="nf">get</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
        <span class="n">console</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[</span><span class="si">{</span><span class="n">style</span><span class="si">}</span><span class="s">]</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">[/</span><span class="si">{</span><span class="n">style</span><span class="si">}</span><span class="s">]</span><span class="sh">"</span> <span class="k">if</span> <span class="n">style</span> <span class="k">else</span> <span class="n">msg</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">styles</span><span class="p">.</span><span class="n">ok</span> <span class="k">if</span> <span class="n">kind</span><span class="o">==</span><span class="sh">"</span><span class="s">ok</span><span class="sh">"</span> <span class="k">else</span> <span class="n">styles</span><span class="p">.</span><span class="n">warn</span> <span class="k">if</span> <span class="n">kind</span><span class="o">==</span><span class="sh">"</span><span class="s">warn</span><span class="sh">"</span> <span class="k">else</span> <span class="n">styles</span><span class="p">.</span><span class="n">header</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">color</span><span class="si">}{</span><span class="n">msg</span><span class="si">}{</span><span class="n">styles</span><span class="p">.</span><span class="n">reset</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># -------- Interactive ops --------
</span><span class="k">def</span> <span class="nf">do_add</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">styles</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">use_rich</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">HAVE_RICH</span> <span class="ow">and</span> <span class="n">console</span> <span class="ow">and</span> <span class="n">use_rich</span><span class="p">:</span>
        <span class="n">console</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[bold cyan]</span><span class="se">\n</span><span class="s">--- Add Shortcut ---[/bold cyan]</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">--- Add Shortcut ---</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Label: </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="nf">info_line</span><span class="p">(</span><span class="sh">"</span><span class="s">Label은 비어 있을 수 없습니다.</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">warn</span><span class="sh">"</span><span class="p">)</span>

    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">PWD</span><span class="sh">"</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="nf">getcwd</span><span class="p">())</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Path 입력 방법: Enter=현재 경로 사용, </span><span class="sh">'</span><span class="s">-</span><span class="sh">'</span><span class="s">=cd 하지 않음, 그 외 직접 경로 입력</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">raw_path</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Path [</span><span class="si">{</span><span class="n">cwd</span><span class="si">}</span><span class="s">]: </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">raw_path</span> <span class="o">==</span> <span class="sh">""</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">cwd</span>
    <span class="k">elif</span> <span class="n">raw_path</span> <span class="o">==</span> <span class="sh">"</span><span class="s">-</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">raw_path</span>

    <span class="n">raw_cmds</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Command list (</span><span class="sh">'</span><span class="s">;</span><span class="sh">'</span><span class="s">로 구분, 비우면 없음): </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="n">command_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">raw_cmds</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">;</span><span class="sh">"</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span><span class="p">.</span><span class="nf">strip</span><span class="p">()]</span> <span class="k">if</span> <span class="n">raw_cmds</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="n">items</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span><span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">:</span> <span class="n">label</span><span class="p">,</span> <span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">:</span> <span class="n">command_list</span><span class="p">})</span>
    <span class="nf">info_line</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">추가됨: </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">ok</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">items</span>

<span class="k">def</span> <span class="nf">do_delete</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">styles</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">use_rich</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span>
        <span class="nf">info_line</span><span class="p">(</span><span class="sh">"</span><span class="s">삭제할 항목이 없습니다.</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">warn</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span>
    <span class="nf">render_list</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="n">use_rich</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">삭제할 번호(여러 개는 공백/콤마로 구분): </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">items</span>
    <span class="n">picks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">s</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">).</span><span class="nf">split</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">tok</span><span class="p">.</span><span class="nf">isdigit</span><span class="p">():</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">tok</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">idx</span> <span class="o">&lt;=</span> <span class="nf">len</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
                <span class="n">picks</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">picks</span><span class="p">:</span>
        <span class="nf">info_line</span><span class="p">(</span><span class="sh">"</span><span class="s">유효한 번호가 없습니다.</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">warn</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">sorted</span><span class="p">(</span><span class="nf">set</span><span class="p">(</span><span class="n">picks</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">removed</span> <span class="o">=</span> <span class="n">items</span><span class="p">.</span><span class="nf">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="nf">info_line</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">삭제됨: </span><span class="si">{</span><span class="n">removed</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">label</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">(no label)</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">ok</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">items</span>

<span class="k">def</span> <span class="nf">write_tcsh</span><span class="p">(</span><span class="n">out_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">command_list</span><span class="p">):</span>
    <span class="n">out_path</span><span class="p">.</span><span class="n">parent</span><span class="p">.</span><span class="nf">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">out_path</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">"</span><span class="s">#!/bin/tcsh</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">"</span><span class="s"># Auto-generated by today.py</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
            <span class="c1"># Quote path safely
</span>            <span class="n">qpath</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'"'</span><span class="p">,</span> <span class="sa">r</span><span class="sh">'</span><span class="s">\"</span><span class="sh">'</span><span class="p">)</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">if ( -d </span><span class="sh">"</span><span class="si">{</span><span class="n">qpath</span><span class="si">}</span><span class="sh">"</span><span class="s"> ) cd </span><span class="sh">"</span><span class="si">{</span><span class="n">qpath</span><span class="si">}</span><span class="sh">"</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">command_list</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">cmd</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">chmod</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="mo">0o700</span><span class="p">)</span>

<span class="c1"># -------- Main --------
</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">ap</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="nc">ArgumentParser</span><span class="p">()</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--db</span><span class="sh">"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Path to shortcuts.json</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--out</span><span class="sh">"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Path to write the tcsh command file</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--no-color</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Disable colored/pretty output</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">ap</span><span class="p">.</span><span class="nf">parse_args</span><span class="p">()</span>

    <span class="n">db_path</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">expanduser</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">db</span><span class="p">))</span>
    <span class="n">out_path</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">expanduser</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">out</span><span class="p">))</span>

    <span class="n">use_rich</span> <span class="o">=</span> <span class="n">HAVE_RICH</span> <span class="ow">and</span> <span class="nf">ansi_enabled</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">no_color</span><span class="p">)</span>
    <span class="n">styles</span> <span class="o">=</span> <span class="nc">S</span><span class="p">(</span><span class="nf">ansi_enabled</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">no_color</span><span class="p">))</span>

    <span class="n">items</span> <span class="o">=</span> <span class="nf">load_db</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>

    <span class="c1"># UI
</span>    <span class="k">if</span> <span class="n">HAVE_RICH</span> <span class="ow">and</span> <span class="n">use_rich</span><span class="p">:</span>
        <span class="n">console</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[bold cyan]== Shortcuts ==[/bold cyan]</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">styles</span><span class="p">.</span><span class="n">header</span><span class="si">}</span><span class="s">== Shortcuts ==</span><span class="si">{</span><span class="n">styles</span><span class="p">.</span><span class="n">reset</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">render_list</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="n">use_rich</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">선택: 번호=실행, A=추가, D=삭제, Q=종료</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">choice</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">&gt; </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">choice</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">q</span><span class="sh">"</span> <span class="ow">or</span> <span class="n">choice</span> <span class="o">==</span> <span class="sh">""</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">choice</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nf">do_add</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="n">use_rich</span><span class="p">)</span>
        <span class="nf">save_db</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">choice</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nf">do_delete</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="n">use_rich</span><span class="p">)</span>
        <span class="nf">save_db</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">choice</span><span class="p">.</span><span class="nf">isdigit</span><span class="p">():</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">choice</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
            <span class="n">picked</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="nf">write_tcsh</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="n">picked</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">),</span> <span class="n">picked</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">,</span> <span class="p">[]))</span>
            <span class="nf">info_line</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">실행 준비: </span><span class="si">{</span><span class="n">picked</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">label</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">ok</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">info_line</span><span class="p">(</span><span class="sh">"</span><span class="s">잘못된 번호입니다.</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">warn</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">info_line</span><span class="p">(</span><span class="sh">"</span><span class="s">알 수 없는 입력입니다.</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">warn</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">2</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<hr />

<h1 id="사용-팁-짧게-step-by-step">사용 팁 (짧게, step-by-step)</h1>

<ol>
  <li>
    <p>그냥 써도 컬러/표가 적용됩니다.</p>
  </li>
  <li>
    <p>더 예쁜 표를 원하면 <code class="language-plaintext highlighter-rouge">pip install rich</code> 해두세요(없어도 동작).</p>
  </li>
  <li>
    <p>컬러 끄기:</p>

    <ul>
      <li>
        <p>일시: <code class="language-plaintext highlighter-rouge">today</code> 실행 시 자동(현재는 파이썬 스크립트가 실행될 때 <code class="language-plaintext highlighter-rouge">--no-color</code> 전달 옵션이 없음) → 직접 테스트하려면 <code class="language-plaintext highlighter-rouge">today.csh</code>에서 <code class="language-plaintext highlighter-rouge">--no-color</code>를 today.py 호출 뒤에 붙여도 됩니다.</p>
      </li>
      <li>
        <p>영구: <code class="language-plaintext highlighter-rouge">NO_COLOR=1</code> 환경변수 설정.</p>
      </li>
    </ul>
  </li>
</ol>

<p>원하시면 <code class="language-plaintext highlighter-rouge">today.csh</code>에서 <code class="language-plaintext highlighter-rouge">--no-color</code>를 전달하도록 바꾸거나, 라벨/경로 너비 고정값을 조정하는 옵션도 바로 넣어드릴게요.</p>

<p class="chat--user">

1. json 말고 일반인이 직관적으로 config 편집하기 좋은 포맷은 없을까 2. remove를 빼고 edit 선택 시 에디터로 config가 열리고 거기서 편집/삭제하는게 더 편할 것 같아.

</p>

<p>좋은 아이디어예요. 정리하면:</p>

<ol>
  <li>
    <p><strong>JSON 대신 편집 친화 포맷</strong> → <strong>TOML</strong> 추천</p>

    <ul>
      <li>
        <p>배열과 문자열을 직관적으로 쓰기 좋고, 주석도 달 수 있어요.</p>
      </li>
      <li>
        <p>예:</p>
        <div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ~/.config/today/shortcuts.toml</span>
<span class="c"># path를 빼면(cd 생략) 현재 디렉터리를 유지합니다.</span>
       
<span class="nn">[[shortcut]]</span>
<span class="py">label</span> <span class="p">=</span> <span class="s">"repo"</span>
<span class="py">path</span> <span class="p">=</span> <span class="s">"/work/repo"</span>
<span class="py">commands</span> <span class="p">=</span> <span class="p">[</span><span class="s">"git status"</span><span class="p">,</span> <span class="s">"git pull"</span><span class="p">]</span>
       
<span class="nn">[[shortcut]]</span>
<span class="py">label</span> <span class="p">=</span> <span class="s">"here-no-cd"</span>
<span class="py">commands</span> <span class="p">=</span> <span class="p">[</span><span class="s">"ls -al"</span><span class="p">]</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Remove 대신 Edit</strong></p>

    <ul>
      <li>
        <p>메뉴에서 <code class="language-plaintext highlighter-rouge">D</code>를 없애고 <strong>E(편집)</strong> 추가 → <strong>$VISUAL/$EDITOR</strong>(없으면 vi)로 TOML을 열어 <strong>직접 수정/삭제</strong>.</p>
      </li>
      <li>
        <p>저장 후 닫으면 파서로 검증하고, <strong>실패 시 백업에서 복원</strong>.</p>
      </li>
    </ul>
  </li>
</ol>

<p>아래는 그 기능까지 반영한 최종 코드입니다. (이전 컬러/표 출력도 그대로 지원; <code class="language-plaintext highlighter-rouge">rich</code> 있으면 더 예쁘게 표 출력)</p>

<hr />

<h2 id="todaycsh">today.csh</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

#!/bin/tcsh
# today.csh - tcsh wrapper that calls today.py and sources the generated command file
# Usage: type `today` in your tcsh (after setting alias) to run interactively.

# Ensure config directory exists
if ( ! -d "$HOME/.config/today" ) then
    mkdir -p "$HOME/.config/today"
endif

set config_dir = "$HOME/.config/today"
set config_file = "$config_dir/shortcuts.toml"
set timestamp = `date +"%y%m%d_%H%M%S"`
set out_file = "$config_dir/command_$timestamp.csh"

# Prefer python3
set python = `which python3`
if ( "$python" == "" ) then
    echo "python3 not found in PATH"
    exit 1
endif

# Default install path for today.py (adjust if you put it elsewhere)
set script_path = "$HOME/.local/bin/today.py"
if ( ! -e "$script_path" ) then
    echo "today.py not found at $script_path"
    echo "Please place today.py there or edit today.csh to point to the correct path."
    exit 1
endif

# Run the Python helper (it writes $out_file if you selected a shortcut to run)
"$python" "$script_path" --db "$config_file" --out "$out_file"
set code = $status
if ( $code != 0 ) then
    exit $code
endif

# If a command file was produced, source it in the CURRENT shell, then remove it
if ( -e "$out_file" ) then
    source "$out_file"
    /bin/rm -f "$out_file"
endif
</code></pre></div></div>

<hr />

<h2 id="todaypy">today.py</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
# today.py - interactive shortcut runner/editor for tcsh via today.csh
# - Config: TOML (~/.config/today/shortcuts.toml)
# - E(편집): $VISUAL/$EDITOR(없으면 vi)로 TOML을 열어 수정/삭제
# - Optional pretty list with 'rich' if available
</span><span class="kn">import</span> <span class="n">argparse</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">shutil</span><span class="p">,</span> <span class="n">subprocess</span><span class="p">,</span> <span class="n">shlex</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># ---------- Optional pretty output ----------
</span><span class="n">HAVE_RICH</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">console</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="n">rich.console</span> <span class="kn">import</span> <span class="n">Console</span>
    <span class="kn">from</span> <span class="n">rich.table</span> <span class="kn">import</span> <span class="n">Table</span>
    <span class="kn">from</span> <span class="n">rich</span> <span class="kn">import</span> <span class="n">box</span>
    <span class="n">HAVE_RICH</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">console</span> <span class="o">=</span> <span class="nc">Console</span><span class="p">()</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="n">HAVE_RICH</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">console</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">term_width</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">shutil</span><span class="p">.</span><span class="nf">get_terminal_size</span><span class="p">((</span><span class="n">default</span><span class="p">,</span> <span class="mi">20</span><span class="p">)).</span><span class="n">columns</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>

<span class="k">def</span> <span class="nf">ansi_enabled</span><span class="p">(</span><span class="n">no_color_flag</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">no_color_flag</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">NO_COLOR</span><span class="sh">"</span><span class="p">):</span> <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="nf">isatty</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">S</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">on</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">on</span> <span class="o">=</span> <span class="n">on</span>
        <span class="n">self</span><span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\033</span><span class="s">[0m</span><span class="sh">"</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="sh">""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">header</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\033</span><span class="s">[1;36m</span><span class="sh">"</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="sh">""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">index</span>  <span class="o">=</span> <span class="sh">"</span><span class="se">\033</span><span class="s">[1;33m</span><span class="sh">"</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="sh">""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">ok</span>     <span class="o">=</span> <span class="sh">"</span><span class="se">\033</span><span class="s">[1;32m</span><span class="sh">"</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="sh">""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">warn</span>   <span class="o">=</span> <span class="sh">"</span><span class="se">\033</span><span class="s">[1;31m</span><span class="sh">"</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="sh">""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">dim</span>    <span class="o">=</span> <span class="sh">"</span><span class="se">\033</span><span class="s">[2m</span><span class="sh">"</span>    <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="sh">""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">bold</span>   <span class="o">=</span> <span class="sh">"</span><span class="se">\033</span><span class="s">[1m</span><span class="sh">"</span>    <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="sh">""</span>

<span class="c1"># ---------- TOML parsing/writing ----------
# Parse: prefer tomllib (py3.11+), fallback tomli
</span><span class="n">_TOML</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomllib</span> <span class="k">as</span> <span class="n">_TOML</span>  <span class="c1"># Python 3.11+
</span><span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="n">tomli</span> <span class="k">as</span> <span class="n">_TOML</span>  <span class="c1"># pip install tomli
</span>    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="n">_TOML</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">parse_toml</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">shortcut</span><span class="sh">"</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="k">if</span> <span class="n">_TOML</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nc">RuntimeError</span><span class="p">(</span><span class="sh">"</span><span class="s">TOML parser not found. Use Python 3.11+ or `pip install tomli`.</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">path</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_TOML</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">shortcut</span><span class="sh">"</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="n">data</span><span class="p">.</span><span class="nf">setdefault</span><span class="p">(</span><span class="sh">"</span><span class="s">shortcut</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">_escape_toml_string</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="nf">return </span><span class="p">(</span>
        <span class="n">s</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\\</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\\\\</span><span class="sh">"</span><span class="p">)</span>
         <span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\"</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\\\"</span><span class="sh">"</span><span class="p">)</span>
         <span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\t</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\\</span><span class="s">t</span><span class="sh">"</span><span class="p">)</span>
         <span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\\</span><span class="s">n</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">dump_toml</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Write as:
    [[shortcut]]
    label = </span><span class="sh">"</span><span class="s">...</span><span class="sh">"</span><span class="s">
    path = </span><span class="sh">"</span><span class="s">/path</span><span class="sh">"</span><span class="s">   # optional; omit for </span><span class="sh">'</span><span class="s">no cd</span><span class="sh">'</span><span class="s">
    commands = [</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="s">]
    </span><span class="sh">"""</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s"># today shortcuts (TOML)</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s"># path 키를 생략하면(cd 생략) 현재 디렉터리를 유지합니다.</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">,</span><span class="sh">""</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
        <span class="n">pathv</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">cmds</span>  <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">[[shortcut]]</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">label = </span><span class="sh">"</span><span class="si">{</span><span class="nf">_escape_toml_string</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="si">}</span><span class="sh">"'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pathv</span><span class="p">:</span>
            <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">path = </span><span class="sh">"</span><span class="si">{</span><span class="nf">_escape_toml_string</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">pathv</span><span class="p">))</span><span class="si">}</span><span class="sh">"'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cmds</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\"</span><span class="si">{</span><span class="nf">_escape_toml_string</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="si">}</span><span class="se">\"</span><span class="sh">"</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cmds</span><span class="p">)</span>
            <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">commands = [</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s">]</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">commands = []</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    <span class="n">path</span><span class="p">.</span><span class="n">parent</span><span class="p">.</span><span class="nf">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="nf">with_suffix</span><span class="p">(</span><span class="sh">"</span><span class="s">.tmp</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">tmp</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

<span class="c1"># ---------- Data IO with migration ----------
</span><span class="k">def</span> <span class="nf">load_items_from_toml</span><span class="p">(</span><span class="n">db_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nf">parse_toml</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">shortcut</span><span class="sh">"</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> 
            <span class="k">continue</span>
        <span class="n">label</span> <span class="o">=</span> <span class="p">(</span><span class="n">ent</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">""</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
        <span class="n">pathv</span> <span class="o">=</span> <span class="n">ent</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">cmds</span>  <span class="o">=</span> <span class="n">ent</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">commands</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">cmds</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">cmds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cmds</span> <span class="o">=</span> <span class="p">[</span><span class="nf">str</span><span class="p">(</span><span class="n">c</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cmds</span> <span class="k">if</span> <span class="nf">str</span><span class="p">(</span><span class="n">c</span><span class="p">).</span><span class="nf">strip</span><span class="p">()]</span>
        <span class="n">items</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span><span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">:</span> <span class="n">label</span><span class="p">,</span> <span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">:</span> <span class="n">pathv</span><span class="p">,</span> <span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">:</span> <span class="n">cmds</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">items</span>

<span class="k">def</span> <span class="nf">load_items</span><span class="p">(</span><span class="n">db_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
    <span class="c1"># If TOML exists -&gt; load TOML
</span>    <span class="k">if</span> <span class="n">db_path</span><span class="p">.</span><span class="n">suffix</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">.toml</span><span class="sh">"</span> <span class="ow">and</span> <span class="n">db_path</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="nf">load_items_from_toml</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
    <span class="c1"># If TOML missing but legacy JSON exists -&gt; migrate
</span>    <span class="k">if</span> <span class="n">db_path</span><span class="p">.</span><span class="n">suffix</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">.toml</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">legacy_json</span> <span class="o">=</span> <span class="n">db_path</span><span class="p">.</span><span class="nf">with_suffix</span><span class="p">(</span><span class="sh">"</span><span class="s">.json</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">legacy_json</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">legacy_json</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">items</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">,</span><span class="sh">""</span><span class="p">).</span><span class="nf">strip</span><span class="p">(),</span>
                        <span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">),</span>
                        <span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]</span>
                    <span class="p">})</span>
                <span class="c1"># Write TOML immediately
</span>                <span class="nf">dump_toml</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">db_path</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">items</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="c1"># Fallback empty
</span>    <span class="k">return</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">save_items_to_toml</span><span class="p">(</span><span class="n">db_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
    <span class="nf">dump_toml</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">db_path</span><span class="p">)</span>

<span class="c1"># ---------- Rendering ----------
</span><span class="k">def</span> <span class="nf">ellipsize</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">maxlen</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span>
    <span class="k">if</span> <span class="n">maxlen</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span><span class="p">[:</span><span class="n">maxlen</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">[:</span><span class="n">maxlen</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="sh">"</span><span class="s">…</span><span class="sh">"</span>

<span class="k">def</span> <span class="nf">render_list</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">styles</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">use_rich</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sh">"</span><span class="s">등록된 shortcut이 없습니다. (A로 추가, E로 편집)</span><span class="sh">"</span>
        <span class="k">if</span> <span class="n">use_rich</span> <span class="ow">and</span> <span class="n">HAVE_RICH</span><span class="p">:</span>
            <span class="n">console</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[bold yellow]</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">[/bold yellow]</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">styles</span><span class="p">.</span><span class="n">index</span><span class="si">}{</span><span class="n">msg</span><span class="si">}{</span><span class="n">styles</span><span class="p">.</span><span class="n">reset</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">width</span> <span class="o">=</span> <span class="nf">term_width</span><span class="p">()</span>
    <span class="n">w_idx</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">items</span><span class="p">))))</span>
    <span class="n">remaining</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="n">w_idx</span> <span class="o">+</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">w_label</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">remaining</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">))</span>
    <span class="n">w_path</span>  <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">remaining</span> <span class="o">*</span> <span class="mf">0.35</span><span class="p">))</span>
    <span class="n">w_cmds</span>  <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">remaining</span> <span class="o">-</span> <span class="n">w_label</span> <span class="o">-</span> <span class="n">w_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">use_rich</span> <span class="ow">and</span> <span class="n">HAVE_RICH</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="nc">Table</span><span class="p">(</span><span class="n">box</span><span class="o">=</span><span class="n">box</span><span class="p">.</span><span class="n">SIMPLE</span><span class="p">,</span> <span class="n">show_lines</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">table</span><span class="p">.</span><span class="nf">add_column</span><span class="p">(</span><span class="sh">"</span><span class="s">#</span><span class="sh">"</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="sh">"</span><span class="s">right</span><span class="sh">"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">bold yellow</span><span class="sh">"</span><span class="p">,</span> <span class="n">no_wrap</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">table</span><span class="p">.</span><span class="nf">add_column</span><span class="p">(</span><span class="sh">"</span><span class="s">Label</span><span class="sh">"</span><span class="p">,</span> <span class="n">overflow</span><span class="o">=</span><span class="sh">"</span><span class="s">fold</span><span class="sh">"</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">w_label</span><span class="p">)</span>
        <span class="n">table</span><span class="p">.</span><span class="nf">add_column</span><span class="p">(</span><span class="sh">"</span><span class="s">Path</span><span class="sh">"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">dim</span><span class="sh">"</span><span class="p">,</span> <span class="n">overflow</span><span class="o">=</span><span class="sh">"</span><span class="s">fold</span><span class="sh">"</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">w_path</span><span class="p">)</span>
        <span class="n">table</span><span class="p">.</span><span class="nf">add_column</span><span class="p">(</span><span class="sh">"</span><span class="s">Commands</span><span class="sh">"</span><span class="p">,</span> <span class="n">overflow</span><span class="o">=</span><span class="sh">"</span><span class="s">fold</span><span class="sh">"</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">w_cmds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">it</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">(no label)</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">(no label)</span><span class="sh">"</span>
            <span class="n">path</span>  <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">(no cd)</span><span class="sh">"</span>
            <span class="n">cmds</span>  <span class="o">=</span> <span class="sh">"</span><span class="s">; </span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">,</span> <span class="p">[]))</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">(no commands)</span><span class="sh">"</span>
            <span class="n">table</span><span class="p">.</span><span class="nf">add_row</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">label</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">cmds</span><span class="p">)</span>
        <span class="n">console</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">#</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Label</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Path</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Commands</span><span class="sh">"</span><span class="p">]</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">it</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="nf">ellipsize</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">(no label)</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">(no label)</span><span class="sh">"</span><span class="p">,</span> <span class="n">w_label</span><span class="p">)</span>
            <span class="n">path</span>  <span class="o">=</span> <span class="nf">ellipsize</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">(no cd)</span><span class="sh">"</span><span class="p">,</span> <span class="n">w_path</span><span class="p">)</span>
            <span class="n">cmds</span>  <span class="o">=</span> <span class="nf">ellipsize</span><span class="p">(</span><span class="sh">"</span><span class="s">; </span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">,</span> <span class="p">[]))</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">(no commands)</span><span class="sh">"</span><span class="p">,</span> <span class="n">w_cmds</span><span class="p">)</span>
            <span class="n">rows</span><span class="p">.</span><span class="nf">append</span><span class="p">([</span><span class="nf">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">label</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">cmds</span><span class="p">])</span>

        <span class="n">widths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nf">max</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nf">max</span><span class="p">((</span><span class="nf">len</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
            <span class="nf">max</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nf">max</span><span class="p">((</span><span class="nf">len</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
            <span class="nf">max</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nf">max</span><span class="p">((</span><span class="nf">len</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
            <span class="nf">max</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="nf">max</span><span class="p">((</span><span class="nf">len</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
        <span class="p">]</span>

        <span class="k">def</span> <span class="nf">sep</span><span class="p">():</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">+</span><span class="sh">"</span> <span class="o">+</span> <span class="sh">"</span><span class="s">+</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span><span class="o">*</span><span class="p">(</span><span class="n">w</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">widths</span><span class="p">)</span> <span class="o">+</span> <span class="sh">"</span><span class="s">+</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">row_print</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">is_header</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s"> </span><span class="si">{</span><span class="n">v</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="n">widths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="si">}</span><span class="s"> </span><span class="sh">"</span>
                <span class="n">out</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="sh">"</span><span class="s">|</span><span class="sh">"</span> <span class="o">+</span> <span class="sh">"</span><span class="s">|</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">+</span> <span class="sh">"</span><span class="s">|</span><span class="sh">"</span>
            <span class="k">if</span> <span class="n">is_header</span> <span class="ow">and</span> <span class="n">styles</span><span class="p">.</span><span class="n">on</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">styles</span><span class="p">.</span><span class="n">header</span><span class="si">}{</span><span class="n">line</span><span class="si">}{</span><span class="n">styles</span><span class="p">.</span><span class="n">reset</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="nf">sep</span><span class="p">();</span> <span class="nf">row_print</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">is_header</span><span class="o">=</span><span class="bp">True</span><span class="p">);</span> <span class="nf">sep</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="nf">row_print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="nf">sep</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">info_line</span><span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">styles</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="sh">"</span><span class="s">ok</span><span class="sh">"</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">HAVE_RICH</span> <span class="ow">and</span> <span class="n">console</span><span class="p">:</span>
        <span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">ok</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">bold green</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">warn</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">bold red</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">note</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">bold cyan</span><span class="sh">"</span><span class="p">}.</span><span class="nf">get</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
        <span class="n">console</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[</span><span class="si">{</span><span class="n">style</span><span class="si">}</span><span class="s">]</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">[/</span><span class="si">{</span><span class="n">style</span><span class="si">}</span><span class="s">]</span><span class="sh">"</span> <span class="k">if</span> <span class="n">style</span> <span class="k">else</span> <span class="n">msg</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">styles</span><span class="p">.</span><span class="n">ok</span> <span class="k">if</span> <span class="n">kind</span><span class="o">==</span><span class="sh">"</span><span class="s">ok</span><span class="sh">"</span> <span class="k">else</span> <span class="n">styles</span><span class="p">.</span><span class="n">warn</span> <span class="k">if</span> <span class="n">kind</span><span class="o">==</span><span class="sh">"</span><span class="s">warn</span><span class="sh">"</span> <span class="k">else</span> <span class="n">styles</span><span class="p">.</span><span class="n">header</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">color</span><span class="si">}{</span><span class="n">msg</span><span class="si">}{</span><span class="n">styles</span><span class="p">.</span><span class="n">reset</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ---------- Editor ----------
</span><span class="k">def</span> <span class="nf">choose_editor</span><span class="p">():</span>
    <span class="n">ed</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">VISUAL</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">EDITOR</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">""</span>
    <span class="k">if</span> <span class="n">ed</span><span class="p">.</span><span class="nf">strip</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">ed</span>
    <span class="c1"># fallbacks
</span>    <span class="k">for</span> <span class="n">cand</span> <span class="ow">in</span> <span class="p">[</span><span class="sh">"</span><span class="s">vi</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">nano</span><span class="sh">"</span><span class="p">]:</span>
        <span class="kn">from</span> <span class="n">shutil</span> <span class="kn">import</span> <span class="n">which</span>
        <span class="k">if</span> <span class="nf">which</span><span class="p">(</span><span class="n">cand</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cand</span>
    <span class="k">return</span> <span class="sh">"</span><span class="s">vi</span><span class="sh">"</span>

<span class="k">def</span> <span class="nf">open_in_editor</span><span class="p">(</span><span class="n">db_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">styles</span><span class="p">:</span> <span class="n">S</span><span class="p">):</span>
    <span class="c1"># Ensure file exists with current content (and comments)
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">db_path</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
        <span class="nf">dump_toml</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">db_path</span><span class="p">)</span>
    <span class="n">bak</span> <span class="o">=</span> <span class="n">db_path</span><span class="p">.</span><span class="nf">with_suffix</span><span class="p">(</span><span class="n">db_path</span><span class="p">.</span><span class="n">suffix</span> <span class="o">+</span> <span class="sh">"</span><span class="s">.bak</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">db_path</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
            <span class="n">shutil</span><span class="p">.</span><span class="nf">copy2</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="n">bak</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">editor</span> <span class="o">=</span> <span class="nf">choose_editor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">shlex</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">editor</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">shlex</span><span class="p">.</span><span class="nf">quote</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">db_path</span><span class="p">))</span><span class="si">}</span><span class="sh">"</span><span class="p">),</span> <span class="n">check</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">info_line</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">에디터 실행 실패: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">warn</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Validate edited TOML
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Just parse; if ok we keep it. If parser missing -&gt; warn but keep.
</span>        <span class="k">if</span> <span class="n">_TOML</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nf">info_line</span><span class="p">(</span><span class="sh">"</span><span class="s">TOML parser가 없어 변경 사항을 검증하지 못했습니다. (Python 3.11+ 또는 `pip install tomli` 권장)</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">warn</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">_</span> <span class="o">=</span> <span class="nf">load_items_from_toml</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>  <span class="c1"># raise if invalid format/types handled in parse
</span>        <span class="nf">info_line</span><span class="p">(</span><span class="sh">"</span><span class="s">저장 완료.</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">ok</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">info_line</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">파싱 실패로 변경을 되돌립니다: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">warn</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bak</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
                <span class="n">shutil</span><span class="p">.</span><span class="nf">copy2</span><span class="p">(</span><span class="n">bak</span><span class="p">,</span> <span class="n">db_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="nf">info_line</span><span class="p">(</span><span class="sh">"</span><span class="s">백업 복원 실패. 파일을 수동으로 확인하세요.</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">warn</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ---------- Interactive ops ----------
</span><span class="k">def</span> <span class="nf">do_add</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">styles</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">use_rich</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">HAVE_RICH</span> <span class="ow">and</span> <span class="n">console</span> <span class="ow">and</span> <span class="n">use_rich</span><span class="p">:</span>
        <span class="n">console</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[bold cyan]</span><span class="se">\n</span><span class="s">--- Add Shortcut ---[/bold cyan]</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">--- Add Shortcut ---</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Label: </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="nf">info_line</span><span class="p">(</span><span class="sh">"</span><span class="s">Label은 비어 있을 수 없습니다.</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">warn</span><span class="sh">"</span><span class="p">)</span>

    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">PWD</span><span class="sh">"</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="nf">getcwd</span><span class="p">())</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Path 입력: Enter=현재 경로, </span><span class="sh">'</span><span class="s">-</span><span class="sh">'</span><span class="s">=cd 하지 않음(키 생략), 그 외 직접 입력</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">raw_path</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Path [</span><span class="si">{</span><span class="n">cwd</span><span class="si">}</span><span class="s">]: </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">raw_path</span> <span class="o">==</span> <span class="sh">""</span><span class="p">:</span>
        <span class="n">pathv</span> <span class="o">=</span> <span class="n">cwd</span>
    <span class="k">elif</span> <span class="n">raw_path</span> <span class="o">==</span> <span class="sh">"</span><span class="s">-</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">pathv</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pathv</span> <span class="o">=</span> <span class="n">raw_path</span>

    <span class="n">raw_cmds</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Command list (</span><span class="sh">'</span><span class="s">;</span><span class="sh">'</span><span class="s">로 구분, 비우면 없음): </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="n">command_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">raw_cmds</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">;</span><span class="sh">"</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span><span class="p">.</span><span class="nf">strip</span><span class="p">()]</span> <span class="k">if</span> <span class="n">raw_cmds</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="n">items</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span><span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">:</span> <span class="n">label</span><span class="p">,</span> <span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">:</span> <span class="n">pathv</span><span class="p">,</span> <span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">:</span> <span class="n">command_list</span><span class="p">})</span>
    <span class="nf">info_line</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">추가됨: </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">ok</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">items</span>

<span class="k">def</span> <span class="nf">write_tcsh</span><span class="p">(</span><span class="n">out_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">pathv</span><span class="p">,</span> <span class="n">command_list</span><span class="p">):</span>
    <span class="n">out_path</span><span class="p">.</span><span class="n">parent</span><span class="p">.</span><span class="nf">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">out_path</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">"</span><span class="s">#!/bin/tcsh</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">"</span><span class="s"># Auto-generated by today.py</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pathv</span><span class="p">:</span>
            <span class="n">qpath</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">pathv</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'"'</span><span class="p">,</span> <span class="sa">r</span><span class="sh">'</span><span class="s">\"</span><span class="sh">'</span><span class="p">)</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">if ( -d </span><span class="sh">"</span><span class="si">{</span><span class="n">qpath</span><span class="si">}</span><span class="sh">"</span><span class="s"> ) cd </span><span class="sh">"</span><span class="si">{</span><span class="n">qpath</span><span class="si">}</span><span class="sh">"</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">command_list</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">cmd</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">chmod</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="mo">0o700</span><span class="p">)</span>

<span class="c1"># ---------- Main ----------
</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">ap</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="nc">ArgumentParser</span><span class="p">()</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--db</span><span class="sh">"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Path to shortcuts.toml (or legacy .json)</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--out</span><span class="sh">"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Path to write the tcsh command file</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--no-color</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Disable colored/pretty output</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">ap</span><span class="p">.</span><span class="nf">parse_args</span><span class="p">()</span>

    <span class="n">db_path</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">expanduser</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">db</span><span class="p">))</span>
    <span class="n">out_path</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">expanduser</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">out</span><span class="p">))</span>

    <span class="n">use_rich</span> <span class="o">=</span> <span class="n">HAVE_RICH</span> <span class="ow">and</span> <span class="nf">ansi_enabled</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">no_color</span><span class="p">)</span>
    <span class="n">styles</span> <span class="o">=</span> <span class="nc">S</span><span class="p">(</span><span class="nf">ansi_enabled</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">no_color</span><span class="p">))</span>

    <span class="n">items</span> <span class="o">=</span> <span class="nf">load_items</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>

    <span class="c1"># UI
</span>    <span class="k">if</span> <span class="n">HAVE_RICH</span> <span class="ow">and</span> <span class="n">use_rich</span><span class="p">:</span>
        <span class="n">console</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[bold cyan]== Shortcuts ==[/bold cyan]</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">styles</span><span class="p">.</span><span class="n">header</span><span class="si">}</span><span class="s">== Shortcuts ==</span><span class="si">{</span><span class="n">styles</span><span class="p">.</span><span class="n">reset</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">render_list</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="n">use_rich</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">선택: 번호=실행, A=추가, E=편집(에디터), Q=종료</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">choice</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">&gt; </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">choice</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">q</span><span class="sh">"</span> <span class="ow">or</span> <span class="n">choice</span> <span class="o">==</span> <span class="sh">""</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">choice</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nf">do_add</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="n">use_rich</span><span class="p">)</span>
        <span class="nf">save_items_to_toml</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">choice</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">e</span><span class="sh">"</span><span class="p">:</span>
        <span class="nf">open_in_editor</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">styles</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">choice</span><span class="p">.</span><span class="nf">isdigit</span><span class="p">():</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">choice</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
            <span class="n">picked</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="nf">write_tcsh</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="n">picked</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">),</span> <span class="n">picked</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">command_list</span><span class="sh">"</span><span class="p">,</span> <span class="p">[]))</span>
            <span class="nf">info_line</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">실행 준비: </span><span class="si">{</span><span class="n">picked</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">label</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">ok</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">info_line</span><span class="p">(</span><span class="sh">"</span><span class="s">잘못된 번호입니다.</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">warn</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">info_line</span><span class="p">(</span><span class="sh">"</span><span class="s">알 수 없는 입력입니다.</span><span class="sh">"</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="sh">"</span><span class="s">warn</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">2</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<hr />

<h3 id="요약-step-by-step">요약 (step-by-step)</h3>

<ul>
  <li>
    <p>포맷: <strong>TOML</strong> 로 변경 → 사람이 읽고 수정하기 쉬움(주석 가능, 배열 직관적).</p>
  </li>
  <li>
    <p>메뉴: <code class="language-plaintext highlighter-rouge">D</code> 제거, <strong><code class="language-plaintext highlighter-rouge">E</code>로 에디터 열어</strong> 편집/삭제.</p>
  </li>
  <li>
    <p>안정성: 저장 전/후 <strong>백업 &amp; 파싱 검증</strong>, 실패 시 <strong>자동 복원</strong>.</p>
  </li>
  <li>
    <p>호환: 기존 <code class="language-plaintext highlighter-rouge">shortcuts.json</code> 있으면 처음 읽을 때 <strong>자동 TOML로 마이그레이션</strong>.</p>
  </li>
</ul>

<p>원하시면 <strong>라벨 바로 실행</strong>(<code class="language-plaintext highlighter-rouge">today label</code>)이나, <strong>검색 필터</strong> , <strong>멀티프로필</strong>(<code class="language-plaintext highlighter-rouge">~/.config/today/*.toml</code>)도 붙여 드릴게요.</p>

        
      </section>

      <footer class="page__meta">
        
        


  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#utils" class="page__taxonomy-item p-category" rel="tag">utils</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2025-08-29T16:18:01+09:00">2025-08-29</time></p>

      </footer>

      

      
  <nav class="pagination">
    
      <a href="/linux/tcsh-run-check/" class="pagination--pager" title="tcsh 스크립트 실행 및 위치 파악">Previous</a>
    
    
      <a href="/misc/work-directory-structure/" class="pagination--pager" title="작업 폴더 구성 추천">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You may also enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025-08-19-python-repr-vs-str/" rel="permalink">
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <!-- hvppyarchive: remove date icon
        <i class="far fa-calendar-alt" aria-hidden="true"></i> 
        -->
        
        <time datetime="2025-10-29T13:03:13+09:00">2025-10-29</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/llm/unified-mcp-interface/" rel="permalink">Python MCP 연결 방법
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <!-- hvppyarchive: remove date icon
        <i class="far fa-calendar-alt" aria-hidden="true"></i> 
        -->
        
        <time datetime="2025-10-29T13:03:08+09:00">2025-10-29</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">

</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/llm/unified-mcp-interface/" rel="permalink">Python MCP 연결 방법
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <!-- hvppyarchive: remove date icon
        <i class="far fa-calendar-alt" aria-hidden="true"></i> 
        -->
        
        <time datetime="2025-10-28T20:16:40+09:00">2025-10-28</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">

</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/python/python-decorator/" rel="permalink">Python 데코레이터 설명
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <!-- hvppyarchive: remove date icon
        <i class="far fa-calendar-alt" aria-hidden="true"></i> 
        -->
        
        <time datetime="2025-10-28T16:53:51+09:00">2025-10-28</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">

</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
  </ul>
</div>


<div class="page__footer-copyright">&copy; 2013 - 2025 <a href="https://hvppyarchive.github.io">ARCHIVE</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>






  </body>
</html>
