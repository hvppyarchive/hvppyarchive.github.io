<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.27.1 by Michael Rose
  Copyright 2013-2025 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Asyncio 사용법 설명 - ARCHIVE</title>
<meta name="description" content="">


  <meta name="author" content="hvppyarchive">
  
  <meta property="article:author" content="hvppyarchive">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="ARCHIVE">
<meta property="og:title" content="Asyncio 사용법 설명">
<meta property="og:url" content="https://hvppyarchive.github.io/python/python-asyncio-basic/">


  <meta property="og:description" content="">







  <meta property="article:published_time" content="2025-10-13T14:06:20+09:00">





  

  


<link rel="canonical" href="https://hvppyarchive.github.io/python/python-asyncio-basic/">












<!-- end _includes/seo.html -->


<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->
<!-- hvppyarchive: add fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@200..900&display=swap" rel="stylesheet">

<!-- insert favicons. use https://realfavicongenerator.net/ -->
 <!-- hvppyarchive: add favicons -->
<link rel="icon" type="image/png" href="/assets/favicon/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/assets/favicon/favicon.svg" />
<link rel="shortcut icon" href="/assets/favicon/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png" />
<link rel="manifest" href="/assets/favicon/site.webmanifest" />

<!-- end custom head snippets -->

  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          ARCHIVE
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/year-archive/"
                
                
              >Posts</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Asyncio 사용법 설명">
    <meta itemprop="description" content="">
    <meta itemprop="datePublished" content="2025-10-13T14:06:20+09:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://hvppyarchive.github.io/python/python-asyncio-basic/" itemprop="url">Asyncio 사용법 설명
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <!-- hvppyarchive: remove date icon
        <i class="far fa-calendar-alt" aria-hidden="true"></i> 
        -->
        
        <time datetime="2025-10-13T14:06:20+09:00">2025-10-13</time>
      </span>
    

    

    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="chat--user">

python asyncio를 이용한 프로그래밍 하는 법 알려줘. 파이썬은 많이 써봤지만 이건 한 번 도 안 써본 사람 기준으로 쉽게 설명해줘.

</p>

<p>좋아요! “asyncio”는 <strong>단일 스레드에서 I/O를 동시에 처리</strong> 하게 해주는 파이썬 표준 라이브러리예요. 처음 쓰는 분 기준으로, 개념→예제→자주 쓰는 패턴 순서로 아주 천천히 갈게요.</p>

<hr />

<h1 id="1-핵심-개념-3가지만-먼저">1) 핵심 개념 3가지만 먼저</h1>

<ol>
  <li>
    <p><strong>코루틴(coroutine)</strong> : <code class="language-plaintext highlighter-rouge">async def</code>로 만든 함수. 내부에서 <code class="language-plaintext highlighter-rouge">await</code>로 “잠깐 쉬었다가 다시”를 할 수 있어요.</p>
  </li>
  <li>
    <p><strong>await</strong> : “이 작업 끝날 때까지 다른 일 좀 하다가 올게!”라는 뜻. 주로 네트워크/디스크 I/O처럼 <strong>기다리는 시간</strong> 이 있는 일에 사용.</p>
  </li>
  <li>
    <p><strong>이벤트 루프(event loop)</strong> : 코루틴들을 돌려주는 엔진. 보통 <code class="language-plaintext highlighter-rouge">asyncio.run(main())</code>으로 시작해요.</p>
  </li>
</ol>

<blockquote>
  <p>기억법: “<code class="language-plaintext highlighter-rouge">async def</code>로 코루틴 만들고, 느린 곳에서 <code class="language-plaintext highlighter-rouge">await</code>, 전체는 <code class="language-plaintext highlighter-rouge">asyncio.run()</code>으로 시작!”</p>
</blockquote>

<hr />

<h1 id="2-첫-번째-예제-순차-vs-동시">2) 첫 번째 예제: 순차 vs. 동시</h1>

<p>아래는 네트워크 대기를 흉내 내려고 <code class="language-plaintext highlighter-rouge">asyncio.sleep()</code>을 사용해요.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># sequential.py (순차 실행)
</span><span class="kn">import</span> <span class="n">asyncio</span><span class="p">,</span> <span class="n">time</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">work</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">sec</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">sec</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s"> 완료</span><span class="sh">"</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">perf_counter</span><span class="p">()</span>
    <span class="k">await</span> <span class="nf">work</span><span class="p">(</span><span class="sh">"</span><span class="s">A</span><span class="sh">"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>   <span class="c1"># 2초
</span>    <span class="k">await</span> <span class="nf">work</span><span class="p">(</span><span class="sh">"</span><span class="s">B</span><span class="sh">"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>   <span class="c1"># 또 2초 (총 4초)
</span>    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">걸린 시간: </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="nf">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">s</span><span class="sh">"</span><span class="p">)</span>

<span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># concurrent.py (동시 실행)
</span><span class="kn">import</span> <span class="n">asyncio</span><span class="p">,</span> <span class="n">time</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">work</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">sec</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">sec</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s"> 완료</span><span class="sh">"</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">perf_counter</span><span class="p">()</span>
    <span class="c1"># 동시 실행 핵심: gather 또는 create_task
</span>    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">gather</span><span class="p">(</span>
        <span class="nf">work</span><span class="p">(</span><span class="sh">"</span><span class="s">A</span><span class="sh">"</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="nf">work</span><span class="p">(</span><span class="sh">"</span><span class="s">B</span><span class="sh">"</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">걸린 시간: </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="nf">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">s</span><span class="sh">"</span><span class="p">)</span>

<span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<ul>
  <li>
    <p>순차: 약 <strong>4초</strong></p>
  </li>
  <li>
    <p>동시: 약 <strong>2초</strong><br />
→ <strong>I/O 대기 시간을 겹쳐서</strong> 줄이는 게 asyncio의 본질이에요.</p>
  </li>
</ul>

<hr />

<h1 id="3-어떻게-동시로-돌리나-gather--create_task">3) 어떻게 동시로 돌리나? (gather / create_task)</h1>

<h3 id="asynciogather"><code class="language-plaintext highlighter-rouge">asyncio.gather(...)</code></h3>

<ul>
  <li>
    <p>여러 코루틴을 한 번에 돌리고 <strong>모두 끝날 때까지</strong> 기다려요.</p>
  </li>
  <li>
    <p>실패하면 <code class="language-plaintext highlighter-rouge">gather</code>가 예외를 올려줘서 한 번에 처리하기 편해요.</p>
  </li>
</ul>

<h3 id="asynciocreate_taskcoro"><code class="language-plaintext highlighter-rouge">asyncio.create_task(coro)</code></h3>

<ul>
  <li>
    <p>코루틴을 <strong>백그라운드 태스크</strong> 로 등록하고 <strong>즉시 제어권을 반환</strong> 해요.</p>
  </li>
  <li>
    <p>나중에 <code class="language-plaintext highlighter-rouge">await task</code>로 결과를 받거나, 필요하면 <code class="language-plaintext highlighter-rouge">task.cancel()</code>로 취소할 수 있어요.</p>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">say</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">delay</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">msg</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">create_task</span><span class="p">(</span><span class="nf">say</span><span class="p">(</span><span class="sh">"</span><span class="s">hello</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">create_task</span><span class="p">(</span><span class="nf">say</span><span class="p">(</span><span class="sh">"</span><span class="s">world</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1"># 다른 일 하다가...
</span>    <span class="n">res1</span> <span class="o">=</span> <span class="k">await</span> <span class="n">t1</span>
    <span class="n">res2</span> <span class="o">=</span> <span class="k">await</span> <span class="n">t2</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">res1</span><span class="p">,</span> <span class="n">res2</span><span class="p">)</span>

<span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<hr />

<h1 id="4-타임아웃과-취소-실무에서-진짜-자주-씀">4) 타임아웃과 취소 (실무에서 진짜 자주 씀)</h1>

<p>네트워크는 항상 느려질 수 있으니, <strong>타임아웃</strong> 은 기본 장착!</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">slow</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">42</span>
    <span class="k">except</span> <span class="n">asyncio</span><span class="p">.</span><span class="n">CancelledError</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">작업이 취소됨</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">raise</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># 1초 넘으면 TimeoutError
</span>        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">wait_for</span><span class="p">(</span><span class="nf">slow</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">asyncio</span><span class="p">.</span><span class="nb">TimeoutError</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">타임아웃!</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># 임의 취소도 가능
</span>    <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">create_task</span><span class="p">(</span><span class="nf">slow</span><span class="p">())</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">task</span><span class="p">.</span><span class="nf">cancel</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">task</span>
    <span class="k">except</span> <span class="n">asyncio</span><span class="p">.</span><span class="n">CancelledError</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">직접 취소 완료</span><span class="sh">"</span><span class="p">)</span>

<span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<hr />

<h1 id="5-실제-네트워크-예제-아주-간단한-에코-서버클라이언트">5) 실제 네트워크 예제: 아주 간단한 에코 서버/클라이언트</h1>

<h2 id="1-서버-asynciostart_server">(1) 서버: <code class="language-plaintext highlighter-rouge">asyncio.start_server</code></h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># echo_server.py
</span><span class="kn">import</span> <span class="n">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">reader</span><span class="p">:</span> <span class="n">asyncio</span><span class="p">.</span><span class="n">StreamReader</span><span class="p">,</span> <span class="n">writer</span><span class="p">:</span> <span class="n">asyncio</span><span class="p">.</span><span class="n">StreamWriter</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">reader</span><span class="p">.</span><span class="nf">readline</span><span class="p">()</span>           <span class="c1"># 클라이언트 한 줄 읽기
</span>    <span class="n">msg</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">decode</span><span class="p">().</span><span class="nf">strip</span><span class="p">()</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="n">writer</span><span class="p">.</span><span class="nf">get_extra_info</span><span class="p">(</span><span class="sh">'</span><span class="s">peername</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[서버] </span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s"> -&gt; </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="n">writer</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Echo: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">encode</span><span class="p">())</span>  <span class="c1"># 다시 돌려주기
</span>    <span class="k">await</span> <span class="n">writer</span><span class="p">.</span><span class="nf">drain</span><span class="p">()</span>                     <span class="c1"># 송신 버퍼 비우기
</span>    <span class="n">writer</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">writer</span><span class="p">.</span><span class="nf">wait_closed</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">server</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">start_server</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="sh">"</span><span class="s">127.0.0.1</span><span class="sh">"</span><span class="p">,</span> <span class="mi">8888</span><span class="p">)</span>
    <span class="n">addrs</span> <span class="o">=</span> <span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">sock</span><span class="p">.</span><span class="nf">getsockname</span><span class="p">())</span> <span class="k">for</span> <span class="n">sock</span> <span class="ow">in</span> <span class="n">server</span><span class="p">.</span><span class="n">sockets</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[서버] </span><span class="si">{</span><span class="n">addrs</span><span class="si">}</span><span class="s">에서 대기중</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">server</span><span class="p">:</span>                       <span class="c1"># 안전한 종료를 위해 context 사용
</span>        <span class="k">await</span> <span class="n">server</span><span class="p">.</span><span class="nf">serve_forever</span><span class="p">()</span>

<span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<h2 id="2-클라이언트-asyncioopen_connection">(2) 클라이언트: <code class="language-plaintext highlighter-rouge">asyncio.open_connection</code></h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># echo_client.py
</span><span class="kn">import</span> <span class="n">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">reader</span><span class="p">,</span> <span class="n">writer</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">open_connection</span><span class="p">(</span><span class="sh">"</span><span class="s">127.0.0.1</span><span class="sh">"</span><span class="p">,</span> <span class="mi">8888</span><span class="p">)</span>
    <span class="n">writer</span><span class="p">.</span><span class="nf">write</span><span class="p">((</span><span class="n">msg</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">).</span><span class="nf">encode</span><span class="p">())</span>
    <span class="k">await</span> <span class="n">writer</span><span class="p">.</span><span class="nf">drain</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">reader</span><span class="p">.</span><span class="nf">readline</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[클라이언트] 응답: </span><span class="si">{</span><span class="n">data</span><span class="p">.</span><span class="nf">decode</span><span class="p">().</span><span class="nf">strip</span><span class="p">()</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">writer</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">writer</span><span class="p">.</span><span class="nf">wait_closed</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># 여러 메시지를 동시 전송
</span>    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">gather</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="nf">send</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">hello </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>

<span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<ul>
  <li>
    <p>터미널 1에서 <code class="language-plaintext highlighter-rouge">python echo_server.py</code> 실행</p>
  </li>
  <li>
    <p>터미널 2에서 <code class="language-plaintext highlighter-rouge">python echo_client.py</code> 실행<br />
→ 서버와 클라이언트가 <strong>비동기 스트림</strong> 으로 주고받는 걸 볼 수 있어요.</p>
  </li>
</ul>

<hr />

<h1 id="6-동기블로킹-코드와-섞을-때">6) 동기(블로킹) 코드와 섞을 때</h1>

<p><code class="language-plaintext highlighter-rouge">time.sleep()</code>처럼 루프를 <strong>막아버리는</strong> 코드는 <code class="language-plaintext highlighter-rouge">await asyncio.to_thread(...)</code>로 <strong>스레드에 밀어 넣기</strong> :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">asyncio</span><span class="p">,</span> <span class="n">time</span>

<span class="k">def</span> <span class="nf">blocking_io</span><span class="p">():</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>         <span class="c1"># 절대 이벤트 루프에서 직접 호출 X
</span>    <span class="k">return</span> <span class="sh">"</span><span class="s">완료</span><span class="sh">"</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">to_thread</span><span class="p">(</span><span class="n">blocking_io</span><span class="p">)</span>  <span class="c1"># 별도 스레드에서 실행
</span>    <span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<blockquote>
  <p>CPU 바운드(예: 대규모 계산)는 <strong>멀티프로세싱</strong>(또는 <code class="language-plaintext highlighter-rouge">ProcessPoolExecutor</code>)을 고려하세요. asyncio는 <strong>I/O 동시성</strong> 이 주특기입니다.</p>
</blockquote>

<hr />

<h1 id="7-선택-파이썬-311의-taskgroup-로-구조화된-동시성">7) (선택) 파이썬 3.11의 <strong>TaskGroup</strong> 로 구조화된 동시성</h1>

<p>여러 태스크를 “그룹”으로 안전하게 관리하고, 하나가 실패하면 나머지를 알아서 정리해 줘요.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">job</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">job </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">asyncio</span><span class="p">.</span><span class="nc">TaskGroup</span><span class="p">()</span> <span class="k">as</span> <span class="n">tg</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">tg</span><span class="p">.</span><span class="nf">create_task</span><span class="p">(</span><span class="nf">job</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="c1"># TaskGroup을 나오면 전부 끝난 상태
</span>    <span class="c1"># (반환값을 모으려면 큐/리스트/콜백으로 저장하거나, 별도 구조 사용)
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">모든 작업 완료</span><span class="sh">"</span><span class="p">)</span>

<span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<hr />

<h1 id="8-자주-하는-실수-체크리스트">8) 자주 하는 실수 체크리스트</h1>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">asyncio.run()</code>은 <strong>프로세스 당 한 번의 진입점</strong> 으로 사용 (중첩 금지).</p>
  </li>
  <li>
    <p><strong>반드시<code class="language-plaintext highlighter-rouge">await</code> 가능한 것만</strong> await 하기 (코루틴/Task/Future).</p>
  </li>
  <li>
    <p>이벤트 루프 안에서 <code class="language-plaintext highlighter-rouge">time.sleep()</code>/블로킹 I/O 사용 금지 → <code class="language-plaintext highlighter-rouge">await asyncio.sleep()</code> / <code class="language-plaintext highlighter-rouge">await asyncio.to_thread(...)</code>.</p>
  </li>
  <li>
    <p>네트워크/외부 API는 <strong>타임아웃</strong> (<code class="language-plaintext highlighter-rouge">asyncio.wait_for</code>) 걸기.</p>
  </li>
  <li>
    <p>오래 가는 백그라운드 태스크는 <strong>취소 처리</strong>(try/except <code class="language-plaintext highlighter-rouge">CancelledError</code>)를 넣어 안정적으로 종료.</p>
  </li>
</ul>

<hr />

<h1 id="9-학습-루트권장-순서">9) 학습 루트(권장 순서)</h1>

<ol>
  <li>
    <p>위의 <strong>순차 vs 동시</strong> 예제를 실행해 체감</p>
  </li>
  <li>
    <p><strong>gather / create_task</strong> 패턴 익히기</p>
  </li>
  <li>
    <p><strong>타임아웃/취소</strong> 넣어보기</p>
  </li>
  <li>
    <p><strong>에코 서버/클라이언트</strong> 로 스트림 I/O 맛보기</p>
  </li>
  <li>
    <p>기존 코드의 블로킹 부분을 <strong>to_thread</strong> 로 분리해 보기</p>
  </li>
  <li>
    <p>(3.11+) <strong>TaskGroup</strong> 으로 코드 구조 정리</p>
  </li>
</ol>

<hr />

<h1 id="10-연습-문제-직접-해보기">10) 연습 문제 (직접 해보기)</h1>

<ol>
  <li>
    <p>URL 리스트(예: 5개)에 대해 “요청→1초 대기→결과 출력”을 <strong>가짜로</strong> 흉내 내는 <code class="language-plaintext highlighter-rouge">fetch(url)</code> 코루틴을 만들고,</p>

    <ul>
      <li>(a) 순차 실행, (b) <code class="language-plaintext highlighter-rouge">gather</code> 동시 실행의 시간을 비교해 보세요.</li>
    </ul>
  </li>
  <li>
    <p>위 (1)에 <strong>타임아웃 0.5초</strong> 를 걸고, 타임아웃 난 URL만 따로 모아 출력해 보세요.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">time.sleep(1)</code>을 실수로 넣었을 때 프로그램이 느려지는 걸 관찰하고, <code class="language-plaintext highlighter-rouge">await asyncio.sleep(1)</code>로 바꿔보세요.</p>
  </li>
</ol>

<hr />

<p>필요하면 위 예제 중 원하는 걸 더 확장(예: HTTP 클라이언트는 <code class="language-plaintext highlighter-rouge">aiohttp</code> 사용)해서 보여드릴게요. 어떤 작업을 비동기로 바꾸고 싶은지 알려주시면, <strong>당장 적용 가능한 구조</strong> 로 같이 리팩터링해 드릴게요.</p>

<p class="chat--user">

create_task랑 그냥 gather 하는 것의 차이

</p>

<p>좋은 질문! 한 줄 요약부터:</p>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">create_task</code></strong> : “코루틴을 <strong>지금 바로</strong> 백그라운드로 돌리게 하고, <strong>핸들(Task)</strong> 을 돌려줘. 나중에 개별적으로 <code class="language-plaintext highlighter-rouge">await</code>/취소/타임아웃/이름붙이기 등 <strong>세밀 제어</strong> 를 할 때 써.”</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">gather</code></strong> : “여러 작업을 <strong>묶어서 동시에 시작</strong> 하고, <strong>전부 끝날 때까지</strong> 기다린 뒤 <strong>결과 리스트</strong> 를 돌려줘. <strong>한 번에 기다릴 때</strong> 써.”</p>
  </li>
</ul>

<p>아래를 단계별로 짚어볼게요.</p>

<hr />

<h2 id="1-무엇을-반환하나">1) 무엇을 반환하나?</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">asyncio.create_task(coro)</code> → <strong>Task 객체</strong> 를 반환.<br />
이 Task는 곧바로 스케줄링되고 “백그라운드”에서 돌아요.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">await asyncio.gather(*aws)</code> → <strong>결과 리스트</strong> 를 반환.<br />
입력 순서 그대로 <code class="language-plaintext highlighter-rouge">[res1, res2, ...]</code>가 와요(완료 순서 아님).</p>
  </li>
</ul>

<hr />

<h2 id="2-언제-시작되나">2) 언제 시작되나?</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">create_task</code>는 <strong>호출 즉시</strong> 스케줄링 시작. (곧 실행됨)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">gather</code>도 내부적으로 코루틴을 Task로 만들어 <strong>즉시</strong> 시작하지만,<br />
<strong>우리는<code class="language-plaintext highlighter-rouge">gather</code> 자체를 <code class="language-plaintext highlighter-rouge">await</code></strong> 하기에 “모두 끝날 때까지 기다리는” 패턴이 자연스러워요.</p>
  </li>
</ul>

<hr />

<h2 id="3-예외취소-동작-차이">3) 예외/취소 동작 차이</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">gather(..., return_exceptions=False)</code>(기본):</p>

    <ul>
      <li>
        <p><strong>하나라도 실패</strong> 하면 <code class="language-plaintext highlighter-rouge">gather</code>가 <strong>예외를 올리고</strong> , 나머지 작업은 <strong>자동 취소</strong> 해요.</p>
      </li>
      <li>
        <p>즉, <strong>“올-오어-낫싱”</strong> 느낌.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">gather(..., return_exceptions=True)</code>:</p>

    <ul>
      <li>예외도 결과 리스트에 <strong>값처럼</strong> 담아줘요. 개별 후처리 가능.</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">create_task</code>:</p>

    <ul>
      <li>
        <p>각 Task는 <strong>독립적</strong>. 어떤 Task가 실패해도 다른 Task는 계속 돔.</p>
      </li>
      <li>
        <p>다만 <strong>결국<code class="language-plaintext highlighter-rouge">await task</code>를 해야 예외가 전파</strong>돼요. 안 받으면 로그에<br />
“Task exception was never retrieved” 경고가 나올 수 있어요.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>취소</strong> :</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">gather</code>에 걸린 걸 <strong>한 번에</strong> 취소 → <strong>모든 자식 Task 자동 취소</strong>.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">create_task</code>로 만든 건 <strong>각각</strong> <code class="language-plaintext highlighter-rouge">task.cancel()</code> 호출해서 관리.</p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="4-언제-무엇을-쓰나-의사결정-표">4) 언제 무엇을 쓰나? (의사결정 표)</h2>

<table>
  <thead>
    <tr>
      <th>상황</th>
      <th>추천</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>동시에 여러 일을 시키고, <strong>모두 끝난 뒤 결과</strong> 가 필요</td>
      <td><code class="language-plaintext highlighter-rouge">await asyncio.gather(a(), b(), c())</code></td>
    </tr>
    <tr>
      <td>일을 <strong>지금 시작</strong> 해 놓고, 중간에 <strong>다른 일도</strong> 하다가 <strong>나중에</strong> 합류</td>
      <td><code class="language-plaintext highlighter-rouge">t1 = create_task(a()); …; res = await t1</code></td>
    </tr>
    <tr>
      <td>각 작업을 <strong>개별적으로</strong> 취소/타임아웃/이름으로 추적</td>
      <td><code class="language-plaintext highlighter-rouge">create_task</code> (필요시 나중에 <code class="language-plaintext highlighter-rouge">gather(*tasks)</code>)</td>
    </tr>
    <tr>
      <td>하나 실패 시 <strong>전체를 취소</strong> 하고 싶다 (기본 동작 선호)</td>
      <td><code class="language-plaintext highlighter-rouge">gather</code></td>
    </tr>
    <tr>
      <td>실패해도 다른 작업은 <strong>계속</strong> 가게 하고 싶다</td>
      <td><code class="language-plaintext highlighter-rouge">create_task</code> + 개별 <code class="language-plaintext highlighter-rouge">await</code>/예외처리, 또는 <code class="language-plaintext highlighter-rouge">gather(..., return_exceptions=True)</code></td>
    </tr>
    <tr>
      <td><strong>완료되는 순서대로</strong> 결과를 받고 싶다(스트리밍 처리)</td>
      <td><code class="language-plaintext highlighter-rouge">asyncio.as_completed(...)</code> + (대개 <code class="language-plaintext highlighter-rouge">create_task</code>와 함께)</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="5-코드로-보는-차이">5) 코드로 보는 차이</h2>

<h3 id="a-gather-한-번에-시작--전부-끝날-때까지-기다림">A) <code class="language-plaintext highlighter-rouge">gather</code>: 한 번에 시작 → 전부 끝날 때까지 기다림</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">work</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span><span class="o">*</span><span class="n">n</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">gather</span><span class="p">(</span><span class="nf">work</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nf">work</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nf">work</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>  <span class="c1"># [1, 4, 9]  (입력 순서대로)
</span>
<span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<h3 id="b-create_task-지금-시작--중간에-다른-일--나중에-개별묶음-합류">B) <code class="language-plaintext highlighter-rouge">create_task</code>: 지금 시작 → 중간에 다른 일 → 나중에 개별/묶음 합류</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">work</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s"> done</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">name</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">create_task</span><span class="p">(</span><span class="nf">work</span><span class="p">(</span><span class="sh">"</span><span class="s">A</span><span class="sh">"</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">create_task</span><span class="p">(</span><span class="nf">work</span><span class="p">(</span><span class="sh">"</span><span class="s">B</span><span class="sh">"</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="c1"># 다른 일도 병행
</span>    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">doing something else...</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># 개별로 합류 가능
</span>    <span class="n">r1</span> <span class="o">=</span> <span class="k">await</span> <span class="n">t1</span>
    <span class="c1"># 남은 것들만 묶어서 기다리기도 가능
</span>    <span class="n">r2</span><span class="p">,</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">gather</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">)</span>

<span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<hr />

<h2 id="6-실무-팁">6) 실무 팁</h2>

<ul>
  <li>
    <p><strong>둘을 섞어 쓰는 패턴</strong> 이 흔해요: 먼저 <code class="language-plaintext highlighter-rouge">create_task</code>로 “미리” 태워두고,<br />
나중에 <code class="language-plaintext highlighter-rouge">await asyncio.gather(*tasks, return_exceptions=True)</code>로 <strong>한 번에 회수</strong>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">create_task</code>로 만든 <strong>장수(長壽) 백그라운드 태스크</strong>(예: 소비자 루프, 하트비트)는<br />
종료 시 <code class="language-plaintext highlighter-rouge">task.cancel()</code> + <code class="language-plaintext highlighter-rouge">try/except CancelledError</code>로 <strong>정리 코드</strong> 를 꼭 넣기.</p>
  </li>
  <li>
    <p><strong>결과가 필요 없더라도</strong> Task 참조를 잡아두고 예외/취소를 처리하세요.<br />
완전한 “fire-and-forget”은 권장되지 않아요(누수·미처리 예외 위험).</p>
  </li>
  <li>
    <p>(3.11+) <strong><code class="language-plaintext highlighter-rouge">asyncio.TaskGroup</code></strong>은 “<code class="language-plaintext highlighter-rouge">gather</code> + 구조화된 취소/정리” 느낌의 <strong>현대적 대안</strong>.<br />
그룹 스코프를 벗어날 때 <strong>모두 정리</strong> 돼서 복잡한 수명 관리가 쉬워요.</p>
  </li>
</ul>

<hr />

<h2 id="7-한-문장으로-다시-요약">7) 한 문장으로 다시 요약</h2>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">gather</code> = 결과를 한 번에 모을 때.</strong></p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">create_task</code> = 지금 태워서 나중에/개별로 관리할 때.</strong></p>
  </li>
</ul>

<p>원하는 시나리오가 있으면(예: “N개의 API 호출을 순차·동시·시간제한·부분실패 허용으로 처리”) 바로 그 패턴으로 코드를 짜서 보여줄게요.</p>

<p class="chat--user">

async def main(): t1 = asyncio.create_task(work("A", 2)) t2 = asyncio.create_task(work("B", 3)) # 다른 일도 병행 await asyncio.sleep(1) print("doing something else…") # 개별로 합류 가능 r1 = await t1 # 남은 것들만 묶어서 기다리기도 가능 r2, = await asyncio.gather(t2) print(r1, r2) asyncio.run(main()) async def main(): # 다른 일도 병행 await asyncio.sleep(1) print("doing something else…") # 개별로 합류 가능 r1 = await work("A", 2) # 남은 것들만 묶어서 기다리기도 가능 r2, = await asyncio.gather(work("B", 3)) print(r1, r2) asyncio.run(main()) 이 두 코드는 같은거 아니냐는 질문이야.

</p>

<p>아니요, <strong>같지 않습니다.</strong><br />
핵심 차이는 “<strong>언제가 작업을 시작하느냐</strong>(스케줄링 시점)”에 있어요.</p>

<p>아래처럼 <strong>타임라인으로</strong> 비교해 볼게요. (A=2초, B=3초)</p>

<hr />

<h1 id="1-코드-1-create_task로-즉시-시작">1) 코드 1: <code class="language-plaintext highlighter-rouge">create_task</code>로 즉시 시작</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t1</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">create_task</span><span class="p">(</span><span class="nf">work</span><span class="p">(</span><span class="sh">"</span><span class="s">A</span><span class="sh">"</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># A 바로 시작
</span><span class="n">t2</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">create_task</span><span class="p">(</span><span class="nf">work</span><span class="p">(</span><span class="sh">"</span><span class="s">B</span><span class="sh">"</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># B 바로 시작
</span><span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                   <span class="c1"># 그 사이 A,B는 진행 중
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">doing something else...</span><span class="sh">"</span><span class="p">)</span>
<span class="n">r1</span> <span class="o">=</span> <span class="k">await</span> <span class="n">t1</span>                            <span class="c1"># t=1에서 A는 1초 남음 → t=2에 완료
</span><span class="n">r2</span><span class="p">,</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">gather</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>           <span class="c1"># 그때 B는 1초 남음 → t=3에 완료
</span></code></pre></div></div>

<p><strong>타임라인</strong></p>

<ul>
  <li>
    <p>t=0~1: A와 B 둘 다 진행 중, main은 1초 잠깐 쉼</p>
  </li>
  <li>
    <p>t=1~2: <code class="language-plaintext highlighter-rouge">await t1</code> (A 마무리), B는 계속 진행</p>
  </li>
  <li>
    <p>t=2~3: <code class="language-plaintext highlighter-rouge">await t2</code> (B 마무리)<br />
→ <strong>총 ~3초</strong></p>
  </li>
</ul>

<hr />

<h1 id="2-코드-2-await-work로-순차-시작">2) 코드 2: <code class="language-plaintext highlighter-rouge">await work(...)</code>로 순차 시작</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                   <span class="c1"># 이때는 아무 작업도 시작 안 됨
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">doing something else...</span><span class="sh">"</span><span class="p">)</span>
<span class="n">r1</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">work</span><span class="p">(</span><span class="sh">"</span><span class="s">A</span><span class="sh">"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>                  <span class="c1"># 이제서야 A 시작 → t=1~3
</span><span class="n">r2</span><span class="p">,</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">gather</span><span class="p">(</span><span class="nf">work</span><span class="p">(</span><span class="sh">"</span><span class="s">B</span><span class="sh">"</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="c1"># 그 다음에야 B 시작 → t=3~6
</span></code></pre></div></div>

<p><strong>타임라인</strong></p>

<ul>
  <li>
    <p>t=0~1: main만 쉼(아직 A,B 시작 X)</p>
  </li>
  <li>
    <p>t=1~3: A 실행</p>
  </li>
  <li>
    <p>t=3~6: B 실행<br />
→ <strong>총 ~6초</strong></p>
  </li>
</ul>

<hr />

<h1 id="왜-이런-차이가-나나-step-by-step-요점">왜 이런 차이가 나나? (step-by-step 요점)</h1>

<ul>
  <li>
    <p><strong>코루틴은 생성만 하면 “시작”이 아닙니다.</strong><br />
<code class="language-plaintext highlighter-rouge">work("B", 3)</code>는 <em>코루틴 객체</em> 를 만들 뿐, <strong>스케줄링(실행 예약)</strong> 은 <code class="language-plaintext highlighter-rouge">create_task(...)</code>나 <code class="language-plaintext highlighter-rouge">gather(...)</code> 같은 함수가 할 때 이뤄져요.</p>
  </li>
  <li>
    <p><strong>코드 1</strong> 은 <code class="language-plaintext highlighter-rouge">create_task</code>가 코루틴을 <strong>즉시 스케줄링</strong> 해서 A,B가 <strong>동시에</strong> 달립니다.</p>
  </li>
  <li>
    <p><strong>코드 2</strong> 는 A를 다 기다린 <strong>다음에야</strong> <code class="language-plaintext highlighter-rouge">gather(work("B",3))</code>로 B를 <strong>그때</strong> 시작하니 <strong>순차</strong> 가 됩니다.</p>
  </li>
</ul>

<hr />

<h1 id="목적에-따라-어떻게-써야-하나">목적에 따라 어떻게 써야 하나?</h1>

<ul>
  <li>
    <p><strong>동시 실행</strong> 이 목적이면</p>

    <ul>
      <li>
        <p>바로 묶어서: <code class="language-plaintext highlighter-rouge">await asyncio.gather(work("A",2), work("B",3))</code></p>
      </li>
      <li>
        <p>또는 먼저 태우고 나중에 회수:</p>
        <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t1</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">create_task</span><span class="p">(</span><span class="nf">work</span><span class="p">(</span><span class="sh">"</span><span class="s">A</span><span class="sh">"</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">create_task</span><span class="p">(</span><span class="nf">work</span><span class="p">(</span><span class="sh">"</span><span class="s">B</span><span class="sh">"</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">doing something else...</span><span class="sh">"</span><span class="p">)</span>
<span class="n">r1</span><span class="p">,</span> <span class="n">r2</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">gather</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>순차 실행</strong> 이 목적이면 지금 작성하신 코드 2처럼 <code class="language-plaintext highlighter-rouge">await work(...)</code>를 차례로 호출하면 됩니다.</p>
  </li>
</ul>

<hr />

<h1 id="한-줄-정리">한 줄 정리</h1>

<ul>
  <li>
    <p><strong>코드 1 = 동시(겹치기)</strong> : <code class="language-plaintext highlighter-rouge">create_task</code>로 <strong>지금</strong> 출발시킴 → 총 ~3초</p>
  </li>
  <li>
    <p><strong>코드 2 = 순차</strong> : 각 작업을 <strong>기다린 뒤 다음 작업 시작</strong> → 총 ~6초</p>
  </li>
</ul>

<p>즉, 두 코드는 겉보기 형태만 비슷하고, <strong>스케줄링 시점</strong> 이 달라서 동작과 실행 시간이 완전히 다릅니다.</p>

<p class="chat--user">

아 create_task를 하고 즉시 실행되는건 아니고, 다음에 코드 내에서 await를 할 때 그 때 task들이 시작되는구나

</p>

<p>완전 그렇게 이해하면 <strong>반쯤만 맞고 중요한 포인트가 하나 빠져요.</strong><br />
정확히는:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">create_task()</code>는 <strong>즉시 “스케줄링”</strong> 합니다.</p>
  </li>
  <li>
    <p><strong>실행(코드가 실제로 돌아가기)</strong> 은 <strong>이벤트 루프에 제어권이 돌아오는 순간</strong> 시작돼요.</p>
  </li>
  <li>
    <p>그 “제어권 반환”은 보통 <strong>당신이 어디선가<code class="language-plaintext highlighter-rouge">await</code> 해서 양보할 때</strong> 발생하죠.<br />
(혹은 현재 코루틴이 끝나서 루프가 다음 턴으로 넘어갈 때.)</p>
  </li>
</ul>

<p>즉, <strong>그 태스크를<code class="language-plaintext highlighter-rouge">await</code>할 때 시작하는 게 아니라, “루프에 양보하는 순간”</strong> 시작합니다. 그래서 <strong>당신이<code class="language-plaintext highlighter-rouge">t</code>를 절대 <code class="language-plaintext highlighter-rouge">await</code>하지 않아도</strong>, 중간에 다른 <code class="language-plaintext highlighter-rouge">await</code>가 있다면 <code class="language-plaintext highlighter-rouge">t</code>는 이미 돌기 시작해요.</p>

<hr />

<h2 id="미세-타이밍을-눈으로-확인해보기">미세 타이밍을 눈으로 확인해보기</h2>

<h3 id="1-create_task-후-다른-곳에서-await만-해도-태스크는-이미-달린다">1) <code class="language-plaintext highlighter-rouge">create_task</code> 후 다른 곳에서 <code class="language-plaintext highlighter-rouge">await</code>만 해도, 태스크는 이미 달린다</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">work</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">work: start</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">work: after sleep</span><span class="sh">"</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">create_task</span><span class="p">(</span><span class="nf">work</span><span class="p">())</span>   <span class="c1"># 🔸 바로 스케줄링
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">main: after create_task</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>            <span class="c1"># 🔸 여기서 루프에 양보 → work가 'start' 찍음
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">main: after first await</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">t</span>                           <span class="c1"># 🔸 이제서야 결과 수거(이미 실행은 진행 중)
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">main: after awaiting t</span><span class="sh">"</span><span class="p">)</span>

<span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<p><strong>출력 순서(전형적)</strong><br />
<code class="language-plaintext highlighter-rouge">main: after create_task</code> → <code class="language-plaintext highlighter-rouge">work: start</code> → <code class="language-plaintext highlighter-rouge">main: after first await</code> → <code class="language-plaintext highlighter-rouge">work: after sleep</code> → <code class="language-plaintext highlighter-rouge">main: after awaiting t</code></p>

<blockquote>
  <p>포인트: <code class="language-plaintext highlighter-rouge">t</code>를 <code class="language-plaintext highlighter-rouge">await</code>하기 전에 이미 <code class="language-plaintext highlighter-rouge">work</code>가 실행됐죠.</p>
</blockquote>

<hr />

<h3 id="2-루프를-막으면timesleep-태스크는-못-돈다">2) 루프를 막으면(<code class="language-plaintext highlighter-rouge">time.sleep</code>) 태스크는 못 돈다</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">asyncio</span><span class="p">,</span> <span class="n">time</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">work</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">work: start</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">work: done</span><span class="sh">"</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">create_task</span><span class="p">(</span><span class="nf">work</span><span class="p">())</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">main: blocking...</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>        <span class="c1"># 🔴 이벤트 루프가 멈춤 → work 못 달림
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">main: unblocked</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">t</span>

<span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<p>여기서는 <code class="language-plaintext highlighter-rouge">work: start</code>가 <strong><code class="language-plaintext highlighter-rouge">time.sleep</code>이 끝난 뒤</strong>에나 찍힐 거예요.<br />
왜냐면 그동안 루프가 <strong>한 번도 돌 기회가 없었기 때문</strong> 이죠.</p>

<hr />

<h2 id="규칙-요약-step-by-step">규칙 요약 (step-by-step)</h2>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">create_task(coro)</code> → <strong>즉시 스케줄링</strong> (대기열에 올림).</p>
  </li>
  <li>
    <p><strong>현재 코루틴이<code class="language-plaintext highlighter-rouge">await</code> 등으로 루프에 양보</strong>하는 순간, 새 태스크가 <strong>실행 시작</strong>.</p>
  </li>
  <li>
    <p>그 태스크를 <strong>반드시<code class="language-plaintext highlighter-rouge">await</code>해야만</strong> 실행되는 건 아님.</p>

    <ul>
      <li>다만 <strong>예외/결과 회수와 누수 방지</strong> 를 위해 보통 <code class="language-plaintext highlighter-rouge">await t</code>(또는 <code class="language-plaintext highlighter-rouge">gather</code>)로 <strong>회수</strong> 하는 게 안전.</li>
    </ul>
  </li>
  <li>
    <p>이벤트 루프를 <strong>막지 말기</strong> (<code class="language-plaintext highlighter-rouge">time.sleep</code>, 블로킹 I/O 금지).</p>

    <ul>
      <li>필요하면 <code class="language-plaintext highlighter-rouge">await asyncio.sleep(...)</code> 또는 <code class="language-plaintext highlighter-rouge">await asyncio.to_thread(blocking_fn)</code>.</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="한-줄로-다시">한 줄로 다시</h2>

<ul>
  <li>
    <p><strong>시작 시점</strong> : “<code class="language-plaintext highlighter-rouge">await t</code>일 때”가 아니라 <strong>“루프에 양보하는 다음 턴”</strong>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">create_task</code>는 <strong>바로 달리게 예약</strong> 하고, <strong>당신이 어딘가에서<code class="language-plaintext highlighter-rouge">await</code>하는 순간</strong> 실제로 뛰기 시작합니다.</p>
  </li>
</ul>

<p>원하면 위 예제를 당신 환경에 맞게 살짝 변형해서(타이밍/로그) 더 보여드릴게요!</p>

        
      </section>

      <footer class="page__meta">
        
        


  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#python" class="page__taxonomy-item p-category" rel="tag">python</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2025-10-13T14:06:20+09:00">2025-10-13</time></p>

      </footer>

      

      
  <nav class="pagination">
    
      <a href="/comfyui/comfyui-lsf-job-submit/" class="pagination--pager" title="ComfyUI LSF Job Submit">Previous</a>
    
    
      <a href="/python/python-lsf-package/" class="pagination--pager" title="IBM LSF Python 패키지 개발">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You may also enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025-08-19-python-repr-vs-str/" rel="permalink">
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <!-- hvppyarchive: remove date icon
        <i class="far fa-calendar-alt" aria-hidden="true"></i> 
        -->
        
        <time datetime="2025-11-05T12:51:19+09:00">2025-11-05</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/llm/python-interpreter-tool-calling/" rel="permalink">Python 코드 실행 Tool Calling
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <!-- hvppyarchive: remove date icon
        <i class="far fa-calendar-alt" aria-hidden="true"></i> 
        -->
        
        <time datetime="2025-11-05T12:51:13+09:00">2025-11-05</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">

</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/llm/vllm-pdf/" rel="permalink">vLLM에 pdf 넣는법
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <!-- hvppyarchive: remove date icon
        <i class="far fa-calendar-alt" aria-hidden="true"></i> 
        -->
        
        <time datetime="2025-11-04T14:13:34+09:00">2025-11-04</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">

</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/comfyui/comfyui-debug-node-refactor/" rel="permalink">ComfyUI Debug 노드 리팩터링
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <!-- hvppyarchive: remove date icon
        <i class="far fa-calendar-alt" aria-hidden="true"></i> 
        -->
        
        <time datetime="2025-11-04T12:48:12+09:00">2025-11-04</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">

</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
  </ul>
</div>


<div class="page__footer-copyright">&copy; 2013 - 2025 <a href="https://hvppyarchive.github.io">ARCHIVE</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>






  </body>
</html>
