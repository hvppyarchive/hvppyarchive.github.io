<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="https://hvppyarchive.github.io/feed.xml" rel="self" type="application/atom+xml" /><link href="https://hvppyarchive.github.io/" rel="alternate" type="text/html" /><updated>2025-10-02T12:45:03+09:00</updated><id>https://hvppyarchive.github.io/feed.xml</id><title type="html">ARCHIVE</title><subtitle>An amazing archive.</subtitle><author><name>hvppyarchive</name></author><entry><title type="html"></title><link href="https://hvppyarchive.github.io/2025-08-19-python-repr-vs-str/" rel="alternate" type="text/html" title="" /><published>2025-10-02T12:45:03+09:00</published><updated>2025-10-02T12:45:03+09:00</updated><id>https://hvppyarchive.github.io/2025-08-19-python-repr-vs-str</id><content type="html" xml:base="https://hvppyarchive.github.io/2025-08-19-python-repr-vs-str/"><![CDATA[<p class="chat--user">

Python에서 <code class="language-plaintext highlighter-rouge">__repr__</code> 함수와 <code class="language-plaintext highlighter-rouge">__str__</code> 함수의 차이점

</p>

<p>Python에서 <code class="language-plaintext highlighter-rouge">__repr__</code> 과 <code class="language-plaintext highlighter-rouge">__str__</code> 의 차이점은 <strong>객체를 문자열로 표현하는 목적</strong> 에서 달라집니다. 차이를 단계적으로 정리해드릴게요.</p>

<hr />

<h2 id="1-__repr__-의-목적">1. <code class="language-plaintext highlighter-rouge">__repr__</code> 의 목적</h2>

<ul>
  <li>
    <p><strong>개발자 중심</strong> : 객체를 "개발자"가 보고 이해할 수 있도록 표현합니다.</p>
  </li>
  <li>
    <p><strong>재현 가능(reproducible)</strong> : 가능한 한 객체를 다시 만들 수 있는 코드 형태로 보여주는 것이 목표입니다.</p>
  </li>
  <li>
    <p>보통 <code class="language-plaintext highlighter-rouge">eval(repr(obj)) == obj</code> 가 성립하는 형태를 지향합니다 (꼭 항상 그런 건 아니지만 권장).</p>
  </li>
  <li>
    <p>디버깅할 때 주로 사용됩니다.</p>
  </li>
</ul>

<p>예시:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Person(name=</span><span class="sh">'</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="sh">'</span><span class="s">, age=</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">age</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span>

<span class="n">p</span> <span class="o">=</span> <span class="nc">Person</span><span class="p">(</span><span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">repr</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>  <span class="c1"># Person(name='Alice', age=30)
</span></code></pre></div></div>

<hr />

<h2 id="2-__str__-의-목적">2. <code class="language-plaintext highlighter-rouge">__str__</code> 의 목적</h2>

<ul>
  <li>
    <p><strong>사용자 중심</strong> : 객체를 "사용자"가 보기 좋은 문자열로 표현합니다.</p>
  </li>
  <li>
    <p>읽기 쉽고 깔끔하게 출력하는 데 초점을 둡니다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">print(obj)</code> 를 호출했을 때 보여지는 값이 <code class="language-plaintext highlighter-rouge">__str__</code> 입니다.</p>
  </li>
</ul>

<p>예시:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">age</span><span class="si">}</span><span class="s"> years old)</span><span class="sh">"</span>

<span class="n">p</span> <span class="o">=</span> <span class="nc">Person</span><span class="p">(</span><span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>  <span class="c1"># Alice (30 years old)
</span></code></pre></div></div>

<hr />

<h2 id="3-__repr__-vs-__str__-비교">3. <code class="language-plaintext highlighter-rouge">__repr__</code> vs <code class="language-plaintext highlighter-rouge">__str__</code> 비교</h2>

<table>
  <thead>
    <tr>
      <th>특징</th>
      <th><code class="language-plaintext highlighter-rouge">__repr__</code></th>
      <th><code class="language-plaintext highlighter-rouge">__str__</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>목적</td>
      <td>개발자용, 디버깅</td>
      <td>사용자용, 가독성</td>
    </tr>
    <tr>
      <td>출력 대상</td>
      <td><code class="language-plaintext highlighter-rouge">repr(obj)</code>, 대화형 쉘에서 기본</td>
      <td><code class="language-plaintext highlighter-rouge">str(obj)</code>, <code class="language-plaintext highlighter-rouge">print(obj)</code></td>
    </tr>
    <tr>
      <td>형식</td>
      <td>객체 재현 가능하거나 상세</td>
      <td>읽기 쉬운 설명 위주</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="4-구현-시-주의사항">4. 구현 시 주의사항</h2>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">__str__</code> 가 없으면 <code class="language-plaintext highlighter-rouge">__repr__</code> 가 대신 사용</strong>됩니다.</p>
  </li>
  <li>
    <p>따라서 최소한 <code class="language-plaintext highlighter-rouge">__repr__</code> 은 정의해 두는 것이 좋습니다.</p>
  </li>
</ul>

<hr />

<p>👉 정리하면,</p>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">__repr__</code></strong> : “개발자가 디버깅할 때” 객체의 정확한 표현.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">__str__</code></strong> : “사용자가 출력물을 볼 때” 보기 좋게 표현.</p>
  </li>
</ul>

<hr />

<p>원하시면 <code class="language-plaintext highlighter-rouge">__repr__</code> 와 <code class="language-plaintext highlighter-rouge">__str__</code> 를 동시에 구현했을 때 <code class="language-plaintext highlighter-rouge">print(obj)</code> 와 <code class="language-plaintext highlighter-rouge">obj</code> (쉘 출력) 의 차이를 직접 실행해 보여드릴 수도 있는데, 예제 코드 시연을 원하시나요?</p>]]></content><author><name>hvppyarchive</name></author></entry><entry><title type="html">ComfyUI 설정 파일 개발</title><link href="https://hvppyarchive.github.io/comfyui/comfyui-custom-node-config/" rel="alternate" type="text/html" title="ComfyUI 설정 파일 개발" /><published>2025-10-02T12:44:58+09:00</published><updated>2025-10-02T12:44:58+09:00</updated><id>https://hvppyarchive.github.io/comfyui/comfyui-custom-node-config</id><content type="html" xml:base="https://hvppyarchive.github.io/comfyui/comfyui-custom-node-config/"><![CDATA[<p class="chat--user">

ComfyUI Custom Node의 Config들을 저장 파일을 개발해줘. config 파일을 사람이 수정하기 쉬운 파일 형식으로 수정 해줘. 파일을 저장하지 않고 설정을 읽기만 하는 readonly 모드로 동작하면 돼. 여러 설정을 저장할거지만 주 용도는 LLM 엔드포인트 정보를 담을거야. 각 LLM Model 별로 (디스플레이용 모델명, 실제 모델명(request시), base url, api key)를 저장하면 돼. Config 정보에 관한 요청이 들어오면(e.g. api 날릴 때 등) 해당하는 값을 리턴하면 돼. 이 때 config 파일이 초기 read했을 때와 바뀌었을 수도 있어. 조금 반영이 늦더라도 1분 이내에는 변경된 값을 리턴해야해. 

</p>

<p>좋아요! “사람이 직접 수정하기 쉬운 설정 파일” + “읽기 전용(파일 저장 X)” + “최대 1분 내 최신값 반영” 조건을 만족하는 ComfyUI 커스텀 노드 패키지를 설계/구현해 드릴게요.<br />
아래 그대로 복사해 넣으면 바로 동작합니다.</p>

<hr />

<h1 id="1-파일-구조">1) 파일 구조</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ComfyUI/
└─ custom_nodes/
   └─ comfyui_llm_config_reader/
      ├─ __init__.py
      ├─ llm_config_reader.py     <span class="c"># 커스텀 노드 + 설정 로더</span>
      └─ llm_config.toml          <span class="c"># 사람이 읽고 수정하기 쉬운 TOML 설정 파일</span>
</code></pre></div></div>

<blockquote>
  <p>기본 경로는 <code class="language-plaintext highlighter-rouge">llm_config.toml</code> 이고, <code class="language-plaintext highlighter-rouge">LLM_CONFIG_PATH</code> 환경변수로 바꿀 수 있어요.</p>
</blockquote>

<hr />

<h1 id="2-설정-파일-예시-toml">2) 설정 파일 예시 (TOML)</h1>

<p>사람이 손으로 편집하기 쉽고, 주석도 넣기 좋은 TOML을 사용합니다.<br />
(API Key는 깃에 올리지 않도록 환경변수 치환도 지원해요.)</p>

<p><code class="language-plaintext highlighter-rouge">llm_config.toml</code></p>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 버전 정보(선택)</span>
<span class="py">version</span> <span class="p">=</span> <span class="mi">1</span>

<span class="nn">[settings]</span>
<span class="c"># 파일 변경 반영 주기(초). 60초 이내 최신값 요구이므로 기본 30초로 여유 있게.</span>
<span class="py">refresh_interval_seconds</span> <span class="p">=</span> <span class="mi">30</span>

<span class="nn">[llm_models."gpt-4o-mini"]</span>
<span class="py">display_name</span>  <span class="p">=</span> <span class="s">"GPT-4o mini"</span>
<span class="py">request_model</span> <span class="p">=</span> <span class="s">"gpt-4o-mini"</span>
<span class="py">base_url</span>      <span class="p">=</span> <span class="s">"https://api.openai.com/v1"</span>
<span class="py">api_key</span>       <span class="p">=</span> <span class="s">"${OPENAI_API_KEY}"</span>   <span class="c"># 환경변수로 안전하게 주입</span>

<span class="nn">[llm_models."claude-3-5-sonnet"]</span>
<span class="py">display_name</span>  <span class="p">=</span> <span class="s">"Claude 3.5 Sonnet"</span>
<span class="py">request_model</span> <span class="p">=</span> <span class="s">"claude-3-5-sonnet"</span>
<span class="py">base_url</span>      <span class="p">=</span> <span class="s">"https://api.anthropic.com"</span>
<span class="py">api_key</span>       <span class="p">=</span> <span class="s">"${ANTHROPIC_API_KEY}"</span>

<span class="c"># 원하는 만큼 모델을 계속 추가</span>
<span class="c"># [llm_models."문자열키"] ...</span>
</code></pre></div></div>

<ul>
  <li>
    <p>키 선택 규칙: <code class="language-plaintext highlighter-rouge">llm_models."&lt;키&gt;"</code> 의 <code class="language-plaintext highlighter-rouge">&lt;키&gt;</code> 는 자유로운 문자열입니다.<br />
조회 시 <code class="language-plaintext highlighter-rouge">&lt;키&gt;</code>, <code class="language-plaintext highlighter-rouge">display_name</code>, <code class="language-plaintext highlighter-rouge">request_model</code> 셋 중 어느 걸로 입력해도 매칭되도록 했어요.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">${ENV_NAME}</code> 형태는 환경변수로 치환됩니다.</p>
  </li>
</ul>

<hr />

<h1 id="3-커스텀-노드로더-코드">3) 커스텀 노드/로더 코드</h1>

<p><code class="language-plaintext highlighter-rouge">comfyui_llm_config_reader/llm_config_reader.py</code></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">threading</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="c1"># Python 3.11+ tomllib, 3.10 이하면 tomli 사용
</span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomllib</span>  <span class="c1"># type: ignore
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomllib</span><span class="p">.</span><span class="n">loads</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomli</span>  <span class="c1"># type: ignore
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomli</span><span class="p">.</span><span class="n">loads</span>

<span class="k">def</span> <span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">문자열 내 ${ENV} 패턴을 환경변수로 치환. 그 외 타입은 그대로 반환.</span><span class="sh">"""</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="sh">""</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">${</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">"</span><span class="s">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">env_name</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">env_name</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="k">def</span> <span class="nf">_normalize_key</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">매칭 편의를 위한 정규화(소문자, 앞뒤 공백 제거).</span><span class="sh">"""</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="nf">strip</span><span class="p">().</span><span class="nf">lower</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">ReadOnlyConfig</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    - TOML 설정을 읽어서 메모리에 캐시
    - 파일이 바뀌었거나 refresh_interval이 지났으면 재로드
    - 쓰기는 절대 하지 않음 (read-only)
    </span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="ow">or</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span>
            <span class="sh">"</span><span class="s">LLM_CONFIG_PATH</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="sh">"</span><span class="s">llm_config.toml</span><span class="sh">"</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># 기본 30초(&lt;= 60초 요구 충족)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_index</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 정규화 키 -&gt; 모델 dict
</span>
    <span class="k">def</span> <span class="nf">_read_text</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">,</span> <span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_build_index</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_index</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
        <span class="n">models</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">llm_models</span><span class="sh">"</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">model_key</span><span class="p">,</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="n">models</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># 환경변수 치환
</span>            <span class="n">cfg</span> <span class="o">=</span> <span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

            <span class="c1"># 필수 필드 체크
</span>            <span class="n">required</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">required</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cfg</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">k</span><span class="p">]).</span><span class="nf">strip</span><span class="p">()]</span>
            <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
                <span class="c1"># 불완전한 엔트리는 스킵 (명확한 로그가 필요하면 print 가능)
</span>                <span class="k">continue</span>

            <span class="c1"># 모델 접근을 위한 다양한 키들 인덱싱
</span>            <span class="n">candidates</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nf">str</span><span class="p">(</span><span class="n">model_key</span><span class="p">),</span>
                <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)),</span>
                <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)),</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">candidates</span><span class="p">):</span>
                <span class="n">self</span><span class="p">.</span><span class="n">_index</span><span class="p">[</span><span class="nf">_normalize_key</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]),</span>
                    <span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">]),</span>
                    <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">]),</span>
                    <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]),</span>
                <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_reload_locked</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_read_text</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nf">_TOML_LOADS</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="c1"># settings.refresh_interval_seconds 반영 (최소 5초, 최대 60초로 가드)
</span>        <span class="n">refresh</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span>
            <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">settings</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">refresh_interval_seconds</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">refresh</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">refresh</span><span class="p">))</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh_interval</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span>
            <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">LLM_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">,</span> <span class="n">refresh</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span> <span class="o">=</span> <span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_build_index</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stale_or_changed</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mtime</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">mtime</span> <span class="o">!=</span> <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">&gt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">_refresh_interval</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ensure_loaded</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="nf">_stale_or_changed</span><span class="p">():</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">key는 모델 키/표시명/요청용 모델명 중 아무거나 가능.</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sh">"</span><span class="s">model key is empty</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_index</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_normalize_key</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="c1"># 최신 반영 지연 가능성을 고려해 한 번 더 강제 리로드 후 재시도
</span>            <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>
                <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_index</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_normalize_key</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">model not found: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hit</span>

    <span class="k">def</span> <span class="nf">list_models</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="sh">"""</span><span class="s">디버그/인스펙션용: (표시명, 요청모델, base_url만 노출하는 안전 리스트).</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># 역으로 display_name 기준 집계
</span>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">_index</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">dn</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]</span>
            <span class="n">out</span><span class="p">[</span><span class="n">dn</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">],</span>
                <span class="c1"># api_key는 보안상 미노출
</span>            <span class="p">}</span>
        <span class="k">return</span> <span class="n">out</span>

<span class="c1"># 전역 싱글톤 로더 (ComfyUI 노드들이 공유)
</span><span class="n">_CONFIG</span> <span class="o">=</span> <span class="nc">ReadOnlyConfig</span><span class="p">()</span>

<span class="c1"># ===== ComfyUI Custom Nodes =====
</span><span class="k">class</span> <span class="nc">LLMConfigLookup</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    입력: model_key (문자열)  — 예: </span><span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span><span class="s"> 또는 </span><span class="sh">"</span><span class="s">GPT-4o mini</span><span class="sh">"</span><span class="s"> 또는 </span><span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span><span class="s">(request_model)
    출력: display_name, request_model, base_url, api_key (모두 STRING)
    </span><span class="sh">"""</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">INPUT_TYPES</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">required</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">model_key</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="sh">"</span><span class="s">default</span><span class="sh">"</span><span class="p">:</span> <span class="sh">""</span><span class="p">,</span> <span class="sh">"</span><span class="s">multiline</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">}),</span>
            <span class="p">},</span>
        <span class="p">}</span>

    <span class="n">RETURN_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">RETURN_NAMES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="sh">"</span><span class="s">lookup</span><span class="sh">"</span>
    <span class="n">CATEGORY</span> <span class="o">=</span> <span class="sh">"</span><span class="s">LLM/Config</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">model_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">_CONFIG</span><span class="p">.</span><span class="nf">get_model</span><span class="p">(</span><span class="n">model_key</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># ComfyUI에서 에러가 보이도록 예외 전달
</span>            <span class="k">raise</span> <span class="nc">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[LLMConfigLookup] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">])</span>

<span class="k">class</span> <span class="nc">LLMConfigListModels</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    디버그용: 사용 가능한 모델들의 (표시명, 요청모델, base_url) JSON을 반환.
    </span><span class="sh">"""</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">INPUT_TYPES</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">required</span><span class="sh">"</span><span class="p">:</span> <span class="p">{}}</span>

    <span class="n">RETURN_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,)</span>
    <span class="n">RETURN_NAMES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">models_json</span><span class="sh">"</span><span class="p">,)</span>
    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="sh">"</span><span class="s">list_models</span><span class="sh">"</span>
    <span class="n">CATEGORY</span> <span class="o">=</span> <span class="sh">"</span><span class="s">LLM/Config</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">list_models</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="n">json</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_CONFIG</span><span class="p">.</span><span class="nf">list_models</span><span class="p">()</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">),)</span>

<span class="c1"># ComfyUI 등록용 매핑
</span><span class="n">NODE_CLASS_MAPPINGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">LLMConfigLookup</span><span class="sh">"</span><span class="p">:</span> <span class="n">LLMConfigLookup</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">LLMConfigListModels</span><span class="sh">"</span><span class="p">:</span> <span class="n">LLMConfigListModels</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">NODE_DISPLAY_NAME_MAPPINGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">LLMConfigLookup</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">LLM: Config Lookup (ReadOnly)</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">LLMConfigListModels</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">LLM: List Models (ReadOnly)</span><span class="sh">"</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">comfyui_llm_config_reader/__init__.py</code></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 빈 파일이면 충분합니다. (패키지 인식용)
</span></code></pre></div></div>

<hr />

<h1 id="4-동작-보장요구사항-매핑">4) 동작 보장(요구사항 매핑)</h1>

<ol>
  <li>
    <p><strong>사람이 수정하기 쉬운 포맷</strong> : TOML 사용 + 주석 가능 + 간결한 키/값 구조.</p>
  </li>
  <li>
    <p><strong>읽기 전용</strong> : 코드 어디에서도 파일을 쓰지 않음. 오직 읽기/파싱만 수행.</p>
  </li>
  <li>
    <p><strong>다중 설정(특히 LLM 엔드포인트)</strong> : <code class="language-plaintext highlighter-rouge">llm_models."&lt;키&gt;"</code>마다</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">display_name</code>, <code class="language-plaintext highlighter-rouge">request_model</code>, <code class="language-plaintext highlighter-rouge">base_url</code>, <code class="language-plaintext highlighter-rouge">api_key</code> 저장.</li>
    </ul>
  </li>
  <li>
    <p><strong>요청 시 해당 값 리턴</strong> : <code class="language-plaintext highlighter-rouge">LLMConfigLookup</code> 노드가 입력 <code class="language-plaintext highlighter-rouge">model_key</code>로 검색하여 4개 값을 출력.</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">&lt;키&gt;</code> / <code class="language-plaintext highlighter-rouge">display_name</code> / <code class="language-plaintext highlighter-rouge">request_model</code> 중 무엇으로 넣어도 매칭됨.</li>
    </ul>
  </li>
  <li>
    <p><strong>변경 반영(최대 1분)</strong> :</p>

    <ul>
      <li>
        <p>파일 <code class="language-plaintext highlighter-rouge">mtime</code> 변화 감지 + <code class="language-plaintext highlighter-rouge">refresh_interval_seconds</code>(기본 30초) 또는 <code class="language-plaintext highlighter-rouge">LLM_CONFIG_REFRESH_SECONDS</code>(env) 기준 TTL 캐시.</p>
      </li>
      <li>
        <p>호출 시마다 <strong>stale 또는 변경</strong> 이면 즉시 재로드 → <strong>최대 60초 이내</strong> 최신값 보장.</p>
      </li>
      <li>
        <p>신규 항목이 추가된 직후에도, 다음 호출 때 최대 TTL 뒤에는 반영.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>보안 고려</strong> :</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">${ENV}</code> 치환 지원으로 API Key를 환경변수에서 주입 가능.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">ListModels</code> 노드에서는 API Key 미노출.</p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h1 id="5-사용-방법-간단">5) 사용 방법 (간단)</h1>

<ol>
  <li>
    <p>위 파일 구조대로 복사 → ComfyUI 재실행.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">llm_config.toml</code> 에 모델들을 추가/수정.</p>
  </li>
  <li>
    <p>워크플로우에서 <strong>LLM: Config Lookup (ReadOnly)</strong> 노드 배치 → <code class="language-plaintext highlighter-rouge">model_key</code> 입력(예: <code class="language-plaintext highlighter-rouge">gpt-4o-mini</code>).</p>
  </li>
  <li>
    <p>노드 출력 4개(표시명/요청모델/base_url/api_key)를 원하는 LLM 호출 노드에 연결.</p>
  </li>
  <li>
    <p>설정 파일을 수정하면, <strong>최대 30초(기본) 내</strong> 새 값이 자동 반영됩니다. (환경변수로 5~60초 사이 튜닝 가능)</p>
  </li>
</ol>

<hr />

<h1 id="6-커스터마이징-팁">6) 커스터마이징 팁</h1>

<ul>
  <li>
    <p><strong>YAML 선호 시</strong> : <code class="language-plaintext highlighter-rouge">tomllib</code> 대신 <code class="language-plaintext highlighter-rouge">yaml.safe_load</code>로 바꾸고 파일 확장자만 <code class="language-plaintext highlighter-rouge">.yaml</code>로 바꾸면 됩니다.</p>
  </li>
  <li>
    <p><strong>모델 키 자동 드롭다운</strong> : ComfyUI의 동적 입력 UI가 필요하면, <code class="language-plaintext highlighter-rouge">INPUT_TYPES</code>를 주기적으로 재구성하는 커스텀 프론트엔드가 필요합니다. 기본 구현은 문자열 입력으로 단순/견고하게 처리했습니다.</p>
  </li>
  <li>
    <p><strong>필드 확장</strong> : per-model 타임아웃, 헤더 등 추가 필드가 필요하면 TOML에 키를 늘리고 <code class="language-plaintext highlighter-rouge">_build_index</code>에서 그대로 통과시켜 출력을 늘리면 됩니다.</p>
  </li>
</ul>

<hr />

<p>원하시면 YAML 버전 또는 특정 LLM 호출 노드(예: OpenAI/Anthropic 커넥터)까지 바로 연결되는 노드도 추가로 만들어 드릴게요.</p>

<p class="chat--user">

좋은데 LLM 말고도 다른 설정들도 저장할 수 있는 범용적 config 파일이라서 파일명을 바꿔주면 좋겠어

</p>

<p>좋은 포인트예요! 범용 설정 파일로 쓰기 좋게 <strong>파일명을 <code class="language-plaintext highlighter-rouge">config.toml</code></strong>로 바꾸고, 코드/환경변수도 <strong>일반화</strong> 했습니다. (이전 <code class="language-plaintext highlighter-rouge">llm_config.toml</code>·<code class="language-plaintext highlighter-rouge">LLM_CONFIG_PATH</code>도 자동 하위 호환)</p>

<p>아래 그대로 교체/추가하면 됩니다.</p>

<hr />

<h1 id="변경-요약-step-by-step">변경 요약 (step-by-step)</h1>

<ol>
  <li>
    <p>설정 파일 기본명을 <code class="language-plaintext highlighter-rouge">config.toml</code>로 변경</p>
  </li>
  <li>
    <p>경로 환경변수도 일반화: <strong><code class="language-plaintext highlighter-rouge">COMFY_CONFIG_PATH</code></strong> (구 <code class="language-plaintext highlighter-rouge">LLM_CONFIG_PATH</code>도 인식)</p>
  </li>
  <li>
    <p>새로고침 주기 환경변수: <strong><code class="language-plaintext highlighter-rouge">COMFY_CONFIG_REFRESH_SECONDS</code></strong> (구 <code class="language-plaintext highlighter-rouge">LLM_CONFIG_REFRESH_SECONDS</code>도 인식)</p>
  </li>
  <li>
    <p>코드가 <code class="language-plaintext highlighter-rouge">config.toml</code>을 우선 사용, 없으면 기존 <code class="language-plaintext highlighter-rouge">llm_config.toml</code> 자동 폴백</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">[llm_models]</code> 외에 임의 섹션(<code class="language-plaintext highlighter-rouge">[feature_flags]</code>, <code class="language-plaintext highlighter-rouge">[storage]</code> 등) 자유 확장 가능</p>
  </li>
</ol>

<hr />

<h1 id="디렉토리-구조">디렉토리 구조</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ComfyUI/
└─ custom_nodes/
   └─ comfyui_llm_config_reader/
      ├─ __init__.py
      ├─ llm_config_reader.py     <span class="c"># (교체본) 범용 config 로더 + LLM 조회 노드</span>
      └─ config.toml              <span class="c"># ← 새 기본 설정 파일명 (범용)</span>
      <span class="c"># └─ llm_config.toml        # (선택) 기존 파일명도 계속 동작(폴백)</span>
</code></pre></div></div>

<hr />

<h1 id="예시-configtoml-범용">예시 <code class="language-plaintext highlighter-rouge">config.toml</code> (범용)</h1>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">version</span> <span class="p">=</span> <span class="mi">1</span>

<span class="nn">[settings]</span>
<span class="c"># 파일 변경 반영 주기(초). 1분 이내 요구 → 기본 30초.</span>
<span class="py">refresh_interval_seconds</span> <span class="p">=</span> <span class="mi">30</span>

<span class="c"># ── LLM 엔드포인트들 ──────────────────────────────────────────────</span>
<span class="nn">[llm_models."gpt-4o-mini"]</span>
<span class="py">display_name</span>  <span class="p">=</span> <span class="s">"GPT-4o mini"</span>
<span class="py">request_model</span> <span class="p">=</span> <span class="s">"gpt-4o-mini"</span>
<span class="py">base_url</span>      <span class="p">=</span> <span class="s">"https://api.openai.com/v1"</span>
<span class="py">api_key</span>       <span class="p">=</span> <span class="s">"${OPENAI_API_KEY}"</span>

<span class="nn">[llm_models."claude-3-5-sonnet"]</span>
<span class="py">display_name</span>  <span class="p">=</span> <span class="s">"Claude 3.5 Sonnet"</span>
<span class="py">request_model</span> <span class="p">=</span> <span class="s">"claude-3-5-sonnet"</span>
<span class="py">base_url</span>      <span class="p">=</span> <span class="s">"https://api.anthropic.com"</span>
<span class="py">api_key</span>       <span class="p">=</span> <span class="s">"${ANTHROPIC_API_KEY}"</span>

<span class="c"># ── (예) 다른 범용 설정 섹션들 ───────────────────────────────────</span>
<span class="nn">[feature_flags]</span>
<span class="py">use_cache</span> <span class="p">=</span> <span class="kc">true</span>
<span class="py">show_beta</span> <span class="p">=</span> <span class="kc">false</span>

<span class="nn">[storage.s3]</span>
<span class="py">bucket</span> <span class="p">=</span> <span class="s">"my-bucket"</span>
<span class="py">region</span> <span class="p">=</span> <span class="s">"ap-northeast-2"</span>
<span class="py">access_key</span> <span class="p">=</span> <span class="s">"${S3_ACCESS_KEY}"</span>
<span class="py">secret_key</span> <span class="p">=</span> <span class="s">"${S3_SECRET_KEY}"</span>
</code></pre></div></div>

<ul>
  <li>
    <p>임의 섹션은 <strong>그대로 저장</strong> 되며, LLM 노드는 <code class="language-plaintext highlighter-rouge">[llm_models]</code>만 사용합니다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">${ENV}</code> 표기값은 환경변수로 치환됩니다.</p>
  </li>
</ul>

<hr />

<h1 id="교체본-코드-llm_config_readerpy">교체본 코드: <code class="language-plaintext highlighter-rouge">llm_config_reader.py</code></h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">threading</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>

<span class="c1"># Python 3.11+ tomllib, 3.10 이하면 tomli 사용
</span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomllib</span>  <span class="c1"># type: ignore
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomllib</span><span class="p">.</span><span class="n">loads</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomli</span>  <span class="c1"># type: ignore
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomli</span><span class="p">.</span><span class="n">loads</span>

<span class="k">def</span> <span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">문자열 내 ${ENV} 패턴을 환경변수로 치환. 그 외 타입은 그대로.</span><span class="sh">"""</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="sh">""</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">${</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">"</span><span class="s">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">env_name</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">env_name</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="k">def</span> <span class="nf">_normalize_key</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="nf">str</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="nf">strip</span><span class="p">().</span><span class="nf">lower</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">ReadOnlyConfig</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    - TOML 설정을 읽어 메모리 캐시
    - 파일 mtime/TTL(최소 5s, 최대 60s) 기반 자동 재로드
    - 절대 쓰기 없음 (read-only)
    - 파일명 일반화:
        * 우선순위: COMFY_CONFIG_PATH &gt; LLM_CONFIG_PATH(하위호환) &gt;
                    ./config.toml &gt; ./llm_config.toml(하위호환)
    </span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="c1"># 1) 명시적 인자
</span>        <span class="n">explicit</span> <span class="o">=</span> <span class="n">path</span>

        <span class="c1"># 2) 환경변수 (일반화 + 하위호환)
</span>        <span class="n">env_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_PATH</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">LLM_CONFIG_PATH</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># 3) 기본 경로 탐색 (우선 config.toml, 없으면 llm_config.toml)
</span>        <span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
        <span class="n">default_primary</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="sh">"</span><span class="s">config.toml</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">default_legacy</span>  <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="sh">"</span><span class="s">llm_config.toml</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">explicit</span><span class="p">:</span>
            <span class="n">chosen</span> <span class="o">=</span> <span class="n">explicit</span>
        <span class="k">elif</span> <span class="n">env_path</span><span class="p">:</span>
            <span class="n">chosen</span> <span class="o">=</span> <span class="n">env_path</span>
        <span class="k">elif</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">default_primary</span><span class="p">):</span>
            <span class="n">chosen</span> <span class="o">=</span> <span class="n">default_primary</span>
        <span class="k">elif</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">default_legacy</span><span class="p">):</span>
            <span class="n">chosen</span> <span class="o">=</span> <span class="n">default_legacy</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># 파일이 아직 없을 수 있으니 새 표준명으로 고정
</span>            <span class="n">chosen</span> <span class="o">=</span> <span class="n">default_primary</span>

        <span class="n">self</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">chosen</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># 기본 30초 (&lt;=60초 요구 충족)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_index</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 정규화 키 -&gt; LLM 모델 dict
</span>
    <span class="k">def</span> <span class="nf">_read_text</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">,</span> <span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_build_index_llm</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">[llm_models] 섹션만 인덱싱. 다른 섹션은 그대로 self._raw에 보존.</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_index</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
        <span class="n">models</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">llm_models</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">model_key</span><span class="p">,</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="n">models</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># 환경변수 치환
</span>            <span class="n">cfg</span> <span class="o">=</span> <span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

            <span class="c1"># 필수 필드 체크
</span>            <span class="n">required</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">required</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cfg</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">k</span><span class="p">]).</span><span class="nf">strip</span><span class="p">()]</span>
            <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
                <span class="c1"># 불완전 항목은 스킵
</span>                <span class="k">continue</span>

            <span class="c1"># 접근 키(모델키/표시명/요청모델) 인덱싱
</span>            <span class="n">candidates</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nf">str</span><span class="p">(</span><span class="n">model_key</span><span class="p">),</span>
                <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)),</span>
                <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)),</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">candidates</span><span class="p">):</span>
                <span class="n">self</span><span class="p">.</span><span class="n">_index</span><span class="p">[</span><span class="nf">_normalize_key</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]),</span>
                    <span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">]),</span>
                    <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">]),</span>
                    <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]),</span>
                <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_reload_locked</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_read_text</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nf">_TOML_LOADS</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="c1"># refresh_interval_seconds (최소 5, 최대 60) + env override(일반/하위호환)
</span>        <span class="n">conf_val</span> <span class="o">=</span> <span class="nf">int</span><span class="p">((</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">settings</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">refresh_interval_seconds</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
        <span class="n">conf_val</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">conf_val</span><span class="p">))</span>
        <span class="n">env_override</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">LLM_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">env_override</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">conf_val</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">env_override</span><span class="p">)))</span>
            <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_refresh_interval</span> <span class="o">=</span> <span class="n">conf_val</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span> <span class="o">=</span> <span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_build_index_llm</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">_stale_or_changed</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mtime</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">mtime</span> <span class="o">!=</span> <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">&gt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">_refresh_interval</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ensure_loaded</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="nf">_stale_or_changed</span><span class="p">():</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>

    <span class="c1"># ── LLM 전용 헬퍼 (기존 API 유지) ─────────────────────────────
</span>    <span class="k">def</span> <span class="nf">get_llm_model</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sh">"</span><span class="s">model key is empty</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_index</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_normalize_key</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="c1"># 갱신 지연 가능성 → 강제 리로드 1회 재시도
</span>            <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>
                <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_index</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_normalize_key</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">model not found: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hit</span>

    <span class="k">def</span> <span class="nf">list_llm_models</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">out</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">_index</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">dn</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]</span>
            <span class="n">out</span><span class="p">[</span><span class="n">dn</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">],</span>
                <span class="c1"># api_key는 보안상 미노출
</span>            <span class="p">}</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="c1"># ── 범용 접근(옵션): 원본 트리에서 임의 섹션 읽기 ─────────────
</span>    <span class="k">def</span> <span class="nf">get_raw_config</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">전체 설정 트리를 그대로(ENV 확장 후) 반환. 읽기 전용.</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_raw</span>

<span class="c1"># 전역 싱글톤
</span><span class="n">_CONFIG</span> <span class="o">=</span> <span class="nc">ReadOnlyConfig</span><span class="p">()</span>

<span class="c1"># ===== ComfyUI Custom Nodes =====
</span><span class="k">class</span> <span class="nc">LLMConfigLookup</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    입력: model_key (문자열) — </span><span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span><span class="s"> / </span><span class="sh">"</span><span class="s">GPT-4o mini</span><span class="sh">"</span><span class="s"> / </span><span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span><span class="s">(request_model)
    출력: display_name, request_model, base_url, api_key
    </span><span class="sh">"""</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">INPUT_TYPES</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">required</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">model_key</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="sh">"</span><span class="s">default</span><span class="sh">"</span><span class="p">:</span> <span class="sh">""</span><span class="p">,</span> <span class="sh">"</span><span class="s">multiline</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">})}}</span>

    <span class="n">RETURN_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">RETURN_NAMES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="sh">"</span><span class="s">lookup</span><span class="sh">"</span>
    <span class="n">CATEGORY</span> <span class="o">=</span> <span class="sh">"</span><span class="s">LLM/Config</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">model_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">_CONFIG</span><span class="p">.</span><span class="nf">get_llm_model</span><span class="p">(</span><span class="n">model_key</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[LLMConfigLookup] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">])</span>

<span class="k">class</span> <span class="nc">LLMConfigListModels</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">디버그용: 사용 가능한 LLM 모델 목록(JSON) 반환 (API Key 미포함).</span><span class="sh">"""</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">INPUT_TYPES</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">required</span><span class="sh">"</span><span class="p">:</span> <span class="p">{}}</span>

    <span class="n">RETURN_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,)</span>
    <span class="n">RETURN_NAMES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">models_json</span><span class="sh">"</span><span class="p">,)</span>
    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="sh">"</span><span class="s">list_models</span><span class="sh">"</span>
    <span class="n">CATEGORY</span> <span class="o">=</span> <span class="sh">"</span><span class="s">LLM/Config</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">list_models</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="n">json</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_CONFIG</span><span class="p">.</span><span class="nf">list_llm_models</span><span class="p">()</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">),)</span>

<span class="c1"># (선택) 범용 조회 노드: 임의 경로를 JSONPath 유사 키로 조회하고 STRING 반환
</span><span class="k">class</span> <span class="nc">ConfigGetRawJSON</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    예) path=</span><span class="sh">"</span><span class="s">feature_flags.use_cache</span><span class="sh">"</span><span class="s"> → </span><span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="s">
        path=</span><span class="sh">"</span><span class="s">storage.s3.region</span><span class="sh">"</span><span class="s"> → </span><span class="sh">"</span><span class="s">ap-northeast-2</span><span class="sh">"</span><span class="s">
    </span><span class="sh">"""</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">INPUT_TYPES</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">required</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="sh">"</span><span class="s">default</span><span class="sh">"</span><span class="p">:</span> <span class="sh">""</span><span class="p">,</span> <span class="sh">"</span><span class="s">multiline</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">})}}</span>

    <span class="n">RETURN_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,)</span>
    <span class="n">RETURN_NAMES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">,)</span>
    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="sh">"</span><span class="s">get_raw</span><span class="sh">"</span>
    <span class="n">CATEGORY</span> <span class="o">=</span> <span class="sh">"</span><span class="s">LLM/Config</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">get_raw</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="kn">import</span> <span class="n">json</span>
        <span class="k">def</span> <span class="nf">get_in</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dotted</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">d</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">dotted</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">.</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
                    <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="n">part</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">config path not found: </span><span class="si">{</span><span class="n">dotted</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cur</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">raw</span> <span class="o">=</span> <span class="n">_CONFIG</span><span class="p">.</span><span class="nf">get_raw_config</span><span class="p">()</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nf">get_in</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">path</span> <span class="k">else</span> <span class="n">raw</span>
            <span class="c1"># 스칼라면 문자열화, 그 외엔 JSON 문자열로 반환
</span>            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">))</span> <span class="ow">or</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="nf">return </span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">val</span><span class="p">),)</span>
            <span class="nf">return </span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">),)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[ConfigGetRawJSON] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="n">NODE_CLASS_MAPPINGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">LLMConfigLookup</span><span class="sh">"</span><span class="p">:</span> <span class="n">LLMConfigLookup</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">LLMConfigListModels</span><span class="sh">"</span><span class="p">:</span> <span class="n">LLMConfigListModels</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">ConfigGetRawJSON</span><span class="sh">"</span><span class="p">:</span> <span class="n">ConfigGetRawJSON</span><span class="p">,</span>  <span class="c1"># ← 범용 읽기 노드(선택)
</span><span class="p">}</span>

<span class="n">NODE_DISPLAY_NAME_MAPPINGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">LLMConfigLookup</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">LLM: Config Lookup (ReadOnly)</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">LLMConfigListModels</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">LLM: List Models (ReadOnly)</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">ConfigGetRawJSON</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Config: Get Raw JSON (ReadOnly)</span><span class="sh">"</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>노드/패키지명은 그대로 두고, <strong>파일명/환경변수/로더</strong> 만 일반화했습니다. 원하시면 패키지/노드 이름도 <code class="language-plaintext highlighter-rouge">comfyui_config_reader</code>로 리네임해 드릴 수 있어요.</p>
</blockquote>

<hr />

<h1 id="사용-방법-요약">사용 방법 (요약)</h1>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">config.toml</code>로 설정 저장(범용 섹션 자유 추가 가능).</p>
  </li>
  <li>
    <p>필요 시 경로 오버라이드: <code class="language-plaintext highlighter-rouge">COMFY_CONFIG_PATH=/abs/path/to/config.toml</code></p>
  </li>
  <li>
    <p>새로고침 주기 조정: <code class="language-plaintext highlighter-rouge">COMFY_CONFIG_REFRESH_SECONDS=10</code> (5~60 유효)</p>
  </li>
  <li>
    <p>ComfyUI에서</p>

    <ul>
      <li>
        <p><strong>LLM: Config Lookup</strong> → LLM 엔드포인트 4종 값 출력</p>
      </li>
      <li>
        <p><strong>Config: Get Raw JSON</strong> → 임의 설정 값 읽기 (예: <code class="language-plaintext highlighter-rouge">feature_flags.use_cache</code>)</p>
      </li>
    </ul>
  </li>
  <li>
    <p>파일을 수정하면 <strong>최대 1분 내</strong>(기본 30초) 반영됩니다.</p>
  </li>
</ol>

<p>필요하면 폴더/노드 이름까지 “LLM”을 빼고 전면 리네이밍한 버전도 만들어 드릴게요.</p>

<p class="chat--user">

응 다 빼줘

</p>

<p>좋아—이제 “LLM” 흔적 전부 뺐어요. 패키지/노드/환경변수/카테고리/필드 이름까지 전부 <strong>범용(config/endpoint)</strong>으로 바꾼 최종본을 드립니다. 그대로 넣으면 작동합니다.</p>

<hr />

<h1 id="0-한눈에-보기-step-by-step">0) 한눈에 보기 (step-by-step)</h1>

<ol>
  <li>
    <p><strong>폴더명 변경</strong> : <code class="language-plaintext highlighter-rouge">comfyui_config_reader</code> (이전 폴더 삭제해도 됨)</p>
  </li>
  <li>
    <p><strong>설정 파일명</strong> : <code class="language-plaintext highlighter-rouge">config.toml</code></p>
  </li>
  <li>
    <p><strong>환경변수</strong> :</p>

    <ul>
      <li>
        <p>경로: <code class="language-plaintext highlighter-rouge">COMFY_CONFIG_PATH</code></p>
      </li>
      <li>
        <p>새로고침: <code class="language-plaintext highlighter-rouge">COMFY_CONFIG_REFRESH_SECONDS</code> (5~60초)</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>섹션 이름</strong> : <code class="language-plaintext highlighter-rouge">[endpoints."&lt;키&gt;"]</code> (필드: <code class="language-plaintext highlighter-rouge">display_name</code>, <code class="language-plaintext highlighter-rouge">request_name</code>, <code class="language-plaintext highlighter-rouge">base_url</code>, <code class="language-plaintext highlighter-rouge">api_key</code>)</p>
  </li>
  <li>
    <p><strong>노드 이름</strong> :</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">ConfigEndpointLookup</code> (엔드포인트 4종 값 반환)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">ConfigListEndpoints</code> (엔드포인트 목록 JSON)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">ConfigGetValue</code> (임의 경로 값 가져오기)</p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h1 id="1-디렉토리-구조">1) 디렉토리 구조</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ComfyUI/
└─ custom_nodes/
   └─ comfyui_config_reader/
      ├─ __init__.py
      ├─ config_reader.py       <span class="c"># 커스텀 노드 + 읽기 전용 로더</span>
      └─ config.toml            <span class="c"># 사람이 편집하기 쉬운 TOML</span>
</code></pre></div></div>

<hr />

<h1 id="2-예시-configtoml-범용">2) 예시 <code class="language-plaintext highlighter-rouge">config.toml</code> (범용)</h1>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">version</span> <span class="p">=</span> <span class="mi">1</span>

<span class="nn">[settings]</span>
<span class="c"># 파일 변경 반영 주기(초). "1분 내 반영" 요건 → 기본 30초.</span>
<span class="py">refresh_interval_seconds</span> <span class="p">=</span> <span class="mi">30</span>

<span class="c"># ── 엔드포인트(예: 텍스트 모델, 임베딩 서비스, 사내 API 등) ─────────────</span>
<span class="nn">[endpoints."text-model-a"]</span>
<span class="py">display_name</span>  <span class="p">=</span> <span class="s">"Text Model A"</span>
<span class="py">request_name</span>  <span class="p">=</span> <span class="s">"gpt-4o-mini"</span>         <span class="c"># 실제 요청에 쓸 식별자/모델명/버전 등</span>
<span class="py">base_url</span>      <span class="p">=</span> <span class="s">"https://api.openai.com/v1"</span>
<span class="py">api_key</span>       <span class="p">=</span> <span class="s">"${OPENAI_API_KEY}"</span>   <span class="c"># 환경변수 치환 지원</span>

<span class="nn">[endpoints."text-model-b"]</span>
<span class="py">display_name</span>  <span class="p">=</span> <span class="s">"Text Model B"</span>
<span class="py">request_name</span>  <span class="p">=</span> <span class="s">"claude-3-5-sonnet"</span>
<span class="py">base_url</span>      <span class="p">=</span> <span class="s">"https://api.anthropic.com"</span>
<span class="py">api_key</span>       <span class="p">=</span> <span class="s">"${ANTHROPIC_API_KEY}"</span>

<span class="c"># ── 다른 범용 설정들 ────────────────────────────────────────────────</span>
<span class="nn">[feature_flags]</span>
<span class="py">use_cache</span> <span class="p">=</span> <span class="kc">true</span>
<span class="py">show_beta</span> <span class="p">=</span> <span class="kc">false</span>

<span class="nn">[storage.s3]</span>
<span class="py">bucket</span> <span class="p">=</span> <span class="s">"my-bucket"</span>
<span class="py">region</span> <span class="p">=</span> <span class="s">"ap-northeast-2"</span>
<span class="py">access_key</span> <span class="p">=</span> <span class="s">"${S3_ACCESS_KEY}"</span>
<span class="py">secret_key</span> <span class="p">=</span> <span class="s">"${S3_SECRET_KEY}"</span>
</code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">${ENV}</code> 표기는 환경변수로 자동 치환됩니다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">endpoints."&lt;키&gt;"</code>의 <code class="language-plaintext highlighter-rouge">&lt;키&gt;</code>로, <code class="language-plaintext highlighter-rouge">display_name</code>·<code class="language-plaintext highlighter-rouge">request_name</code> 까지 <strong>모두 조회 키</strong> 로 사용할 수 있어요.</p>
  </li>
</ul>

<hr />

<h1 id="3-코드-config_readerpy">3) 코드: <code class="language-plaintext highlighter-rouge">config_reader.py</code></h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">threading</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>

<span class="c1"># Python 3.11+ tomllib / 3.10-: tomli
</span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomllib</span>  <span class="c1"># type: ignore
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomllib</span><span class="p">.</span><span class="n">loads</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomli</span>  <span class="c1"># type: ignore
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomli</span><span class="p">.</span><span class="n">loads</span>

<span class="k">def</span> <span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">문자열 내 ${ENV} 패턴을 환경변수로 치환. 그 외 타입은 그대로.</span><span class="sh">"""</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="sh">""</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">${</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">"</span><span class="s">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">env_name</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">env_name</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="k">def</span> <span class="nf">_norm</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="nf">str</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="nf">strip</span><span class="p">().</span><span class="nf">lower</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">ReadOnlyConfig</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    - TOML을 읽어 메모리에 캐시
    - mtime/TTL(최소 5s, 최대 60s)로 자동 재로드
    - 파일 쓰기 없음(read-only)
    - 파일 결정 우선순위:  (1) 인자 path &gt; (2) COMFY_CONFIG_PATH &gt; (3) ./config.toml
    </span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
        <span class="n">chosen</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">path</span>
            <span class="ow">or</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_PATH</span><span class="sh">"</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="sh">"</span><span class="s">config.toml</span><span class="sh">"</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">chosen</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># 기본 30초(&lt;=60s 요건 충족)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_endpoint_index</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 정규화 키 -&gt; endpoint dict
</span>
    <span class="k">def</span> <span class="nf">_read_text</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">,</span> <span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_build_index_endpoints</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_endpoint_index</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">endpoints</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">ep_key</span><span class="p">,</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="n">eps</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">cfg</span> <span class="o">=</span> <span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

            <span class="c1"># 필수 필드
</span>            <span class="n">required</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">required</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cfg</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">k</span><span class="p">]).</span><span class="nf">strip</span><span class="p">()]</span>
            <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
                <span class="c1"># 불완전 항목은 스킵
</span>                <span class="k">continue</span>

            <span class="c1"># 접근 키: 정의 키 / display_name / request_name
</span>            <span class="n">candidates</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nf">str</span><span class="p">(</span><span class="n">ep_key</span><span class="p">),</span>
                <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)),</span>
                <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)),</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">candidates</span><span class="p">):</span>
                <span class="n">self</span><span class="p">.</span><span class="n">_endpoint_index</span><span class="p">[</span><span class="nf">_norm</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]),</span>
                    <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">]),</span>
                    <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">]),</span>
                    <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]),</span>
                <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_reload_locked</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_read_text</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nf">_TOML_LOADS</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="c1"># refresh_interval_seconds (5~60) + env override
</span>        <span class="n">conf_val</span> <span class="o">=</span> <span class="nf">int</span><span class="p">((</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">settings</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">refresh_interval_seconds</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
        <span class="n">conf_val</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">conf_val</span><span class="p">))</span>
        <span class="n">env_override</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env_override</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">conf_val</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">env_override</span><span class="p">)))</span>
            <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_refresh_interval</span> <span class="o">=</span> <span class="n">conf_val</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span> <span class="o">=</span> <span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_build_index_endpoints</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">_stale_or_changed</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mtime</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">mtime</span> <span class="o">!=</span> <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">&gt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">_refresh_interval</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ensure_loaded</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="nf">_stale_or_changed</span><span class="p">():</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>

    <span class="c1"># ── Endpoints 전용 API ─────────────────────────────────────────
</span>    <span class="k">def</span> <span class="nf">get_endpoint</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sh">"</span><span class="s">endpoint key is empty</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_endpoint_index</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_norm</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="c1"># 갱신 지연 가능성 → 강제 리로드 1회 재시도
</span>            <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>
                <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_endpoint_index</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_norm</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">endpoint not found: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hit</span>

    <span class="k">def</span> <span class="nf">list_endpoints</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">out</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">_endpoint_index</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">dn</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]</span>
            <span class="n">out</span><span class="p">[</span><span class="n">dn</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">],</span>
                <span class="c1"># api_key는 보안상 미노출
</span>            <span class="p">}</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="c1"># ── 범용 읽기 ──────────────────────────────────────────────────
</span>    <span class="k">def</span> <span class="nf">get_raw</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_raw</span>

<span class="c1"># 전역 싱글톤
</span><span class="n">_CONFIG</span> <span class="o">=</span> <span class="nc">ReadOnlyConfig</span><span class="p">()</span>

<span class="c1"># ===== ComfyUI Custom Nodes =====
</span><span class="k">class</span> <span class="nc">ConfigEndpointLookup</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    입력: key — </span><span class="sh">"</span><span class="s">text-model-a</span><span class="sh">"</span><span class="s"> / </span><span class="sh">"</span><span class="s">Text Model A</span><span class="sh">"</span><span class="s"> / </span><span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span><span class="s">(request_name)
    출력: display_name, request_name, base_url, api_key (모두 STRING)
    </span><span class="sh">"""</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">INPUT_TYPES</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">required</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="sh">"</span><span class="s">default</span><span class="sh">"</span><span class="p">:</span> <span class="sh">""</span><span class="p">,</span> <span class="sh">"</span><span class="s">multiline</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">})}}</span>

    <span class="n">RETURN_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">RETURN_NAMES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="sh">"</span><span class="s">lookup</span><span class="sh">"</span>
    <span class="n">CATEGORY</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Config/Endpoints (ReadOnly)</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ep</span> <span class="o">=</span> <span class="n">_CONFIG</span><span class="p">.</span><span class="nf">get_endpoint</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[ConfigEndpointLookup] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">ep</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">],</span> <span class="n">ep</span><span class="p">[</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">],</span> <span class="n">ep</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">],</span> <span class="n">ep</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">])</span>

<span class="k">class</span> <span class="nc">ConfigListEndpoints</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">디버그/인스펙션용: 엔드포인트 목록(JSON, api_key 미포함).</span><span class="sh">"""</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">INPUT_TYPES</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">required</span><span class="sh">"</span><span class="p">:</span> <span class="p">{}}</span>

    <span class="n">RETURN_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,)</span>
    <span class="n">RETURN_NAMES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">endpoints_json</span><span class="sh">"</span><span class="p">,)</span>
    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="sh">"</span><span class="s">list_endpoints</span><span class="sh">"</span>
    <span class="n">CATEGORY</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Config/Endpoints (ReadOnly)</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">list_endpoints</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="n">json</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_CONFIG</span><span class="p">.</span><span class="nf">list_endpoints</span><span class="p">()</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">),)</span>

<span class="k">class</span> <span class="nc">ConfigGetValue</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    임의 경로 값 읽기 (</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="s"> 구분)
    예) path=</span><span class="sh">"</span><span class="s">feature_flags.use_cache</span><span class="sh">"</span><span class="s">  → </span><span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="s">
        path=</span><span class="sh">"</span><span class="s">storage.s3.region</span><span class="sh">"</span><span class="s">        → </span><span class="sh">"</span><span class="s">ap-northeast-2</span><span class="sh">"</span><span class="s">
        path=</span><span class="sh">"</span><span class="s">endpoints.text-model-a</span><span class="sh">"</span><span class="s">   → 해당 엔드포인트 JSON
    </span><span class="sh">"""</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">INPUT_TYPES</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">required</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="sh">"</span><span class="s">default</span><span class="sh">"</span><span class="p">:</span> <span class="sh">""</span><span class="p">,</span> <span class="sh">"</span><span class="s">multiline</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">})}}</span>

    <span class="n">RETURN_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,)</span>
    <span class="n">RETURN_NAMES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">,)</span>
    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="sh">"</span><span class="s">get_value</span><span class="sh">"</span>
    <span class="n">CATEGORY</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Config/General (ReadOnly)</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="kn">import</span> <span class="n">json</span>
        <span class="k">def</span> <span class="nf">get_in</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dotted</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">d</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">dotted</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">.</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
                    <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="n">part</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">config path not found: </span><span class="si">{</span><span class="n">dotted</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cur</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">raw</span> <span class="o">=</span> <span class="n">_CONFIG</span><span class="p">.</span><span class="nf">get_raw</span><span class="p">()</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nf">get_in</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">path</span> <span class="k">else</span> <span class="n">raw</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">))</span> <span class="ow">or</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="nf">return </span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">val</span><span class="p">),)</span>
            <span class="nf">return </span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">),)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[ConfigGetValue] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="n">NODE_CLASS_MAPPINGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">ConfigEndpointLookup</span><span class="sh">"</span><span class="p">:</span> <span class="n">ConfigEndpointLookup</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">ConfigListEndpoints</span><span class="sh">"</span><span class="p">:</span>  <span class="n">ConfigListEndpoints</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">ConfigGetValue</span><span class="sh">"</span><span class="p">:</span>       <span class="n">ConfigGetValue</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">NODE_DISPLAY_NAME_MAPPINGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">ConfigEndpointLookup</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Config: Endpoint Lookup</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">ConfigListEndpoints</span><span class="sh">"</span><span class="p">:</span>  <span class="sh">"</span><span class="s">Config: List Endpoints</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">ConfigGetValue</span><span class="sh">"</span><span class="p">:</span>       <span class="sh">"</span><span class="s">Config: Get Value</span><span class="sh">"</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">__init__.py</code></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 패키지 인식용 (비워두면 됩니다)
</span></code></pre></div></div>

<hr />

<h1 id="4-요구사항-대응-체크">4) 요구사항 대응 체크</h1>

<ul>
  <li>
    <p>사람이 편집하기 쉬움: <strong>TOML + 주석 가능</strong></p>
  </li>
  <li>
    <p>읽기 전용: <strong>파일 쓰기 없음</strong></p>
  </li>
  <li>
    <p>주요 용도(모델/서비스 엔드포인트): <strong><code class="language-plaintext highlighter-rouge">endpoints</code> 섹션 표준화</strong></p>
  </li>
  <li>
    <p>필요한 값 반환: <code class="language-plaintext highlighter-rouge">ConfigEndpointLookup</code>가 <strong>display_name, request_name, base_url, api_key</strong> 출력</p>
  </li>
  <li>
    <p>변경 반영: <strong>mtime + TTL(기본 30초, 5~60초 조정)</strong> → <strong>최대 1분 내 반영</strong> 보장</p>
  </li>
  <li>
    <p>보안: <strong>환경변수 치환</strong> , 목록 노드에서 <strong>api_key 미노출</strong></p>
  </li>
</ul>

<hr />

<h1 id="5-마이그레이션-가이드">5) 마이그레이션 가이드</h1>

<ul>
  <li>
    <p>예전 파일/이름을 쓰셨다면:</p>

    <ul>
      <li>
        <p>폴더: <code class="language-plaintext highlighter-rouge">custom_nodes/comfyui_llm_config_reader</code> → <strong>삭제</strong> 또는 보관</p>
      </li>
      <li>
        <p>설정: <code class="language-plaintext highlighter-rouge">[llm_models]</code> → <strong><code class="language-plaintext highlighter-rouge">[endpoints]</code> 로 바꾸고 <code class="language-plaintext highlighter-rouge">request_model</code> → <code class="language-plaintext highlighter-rouge">request_name</code></strong></p>
      </li>
      <li>
        <p>노드: 기존 워크플로우에선 새 노드로 교체</p>

        <ul>
          <li>
            <p><code class="language-plaintext highlighter-rouge">LLMConfigLookup</code> → <strong><code class="language-plaintext highlighter-rouge">ConfigEndpointLookup</code></strong></p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">LLMConfigListModels</code> → <strong><code class="language-plaintext highlighter-rouge">ConfigListEndpoints</code></strong></p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">ConfigGetRawJSON</code> → <strong><code class="language-plaintext highlighter-rouge">ConfigGetValue</code></strong></p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<hr />

<p>필요하면, 기존 워크플로우 자동 변환 스크립트(YAML/JSON 경로 교체)도 만들어 드릴게요.</p>

<p class="chat--user">

다른 노드 “파일들”에서 설정을 읽어야하는데 이건 어떻게 해? 싱글톤 인터페이스가 좀 어색해보여

</p>

<p>좋은 피드백! “여러 노드/파일에서 자연스럽게 읽는” 패턴으로 바꿔줄게요.<br />
싱글톤 대신 <strong>경로별 Multiton 레지스트리 + 얇은 함수형 API</strong> 를 제공합니다.<br />
즉, 어디서든 <code class="language-plaintext highlighter-rouge">from comfyui_config_reader.config import endpoint, get</code>만 임포트해 쓰면 됩니다.</p>

<p>아래 세 파일만 추가/교체하면 끝!</p>

<hr />

<h1 id="1-구조">1) 구조</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ComfyUI/
└─ custom_nodes/
   └─ comfyui_config_reader/
      ├─ __init__.py
      ├─ config_core.py     <span class="c"># 핵심: ReadOnlyStore (경로별 캐시/자동 리로드)</span>
      ├─ config.py          <span class="c"># 공용 API: endpoint()/get()/get_store()</span>
      └─ config_nodes.py    <span class="c"># (옵션) 데모 노드들: Lookup/List/Get</span>
</code></pre></div></div>

<hr />

<h1 id="2-핵심-스토어-경로별-multiton-아님--인스턴스형-thread-safe">2) 핵심 스토어 (경로별 Multiton 아님 — “인스턴스형”, thread-safe)</h1>

<p><code class="language-plaintext highlighter-rouge">config_core.py</code></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">threading</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>

<span class="c1"># Python 3.11+: tomllib / 이하: tomli
</span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomllib</span>  <span class="c1"># type: ignore
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomllib</span><span class="p">.</span><span class="n">loads</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomli</span>  <span class="c1"># type: ignore
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomli</span><span class="p">.</span><span class="n">loads</span>

<span class="k">def</span> <span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="sh">""</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">${</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">"</span><span class="s">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">env_name</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">env_name</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="k">def</span> <span class="nf">_norm</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="nf">str</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="nf">strip</span><span class="p">().</span><span class="nf">lower</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">ReadOnlyStore</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    - TOML 읽기 전용 스토어
    - mtime/TTL(5~60s) 기반 자동 재로드 → </span><span class="sh">'</span><span class="s">1분 내 반영</span><span class="sh">'</span><span class="s"> 보장
    - 엔드포인트 인덱싱 + 임의 경로 접근
    - 파일 쓰기 없음
    </span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># 기본 30s
</span>        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_endpoint_index</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># 리로드마다 증가
</span>
    <span class="c1"># ---------- 내부 로딩 ----------
</span>    <span class="k">def</span> <span class="nf">_read_text</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">,</span> <span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_build_index_endpoints</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_endpoint_index</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">endpoints</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">ep_key</span><span class="p">,</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="n">eps</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
            <span class="n">required</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]</span>
            <span class="k">if</span> <span class="nf">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cfg</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">k</span><span class="p">]).</span><span class="nf">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">required</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">{</span><span class="nf">str</span><span class="p">(</span><span class="n">ep_key</span><span class="p">),</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span><span class="sh">""</span><span class="p">)),</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">,</span><span class="sh">""</span><span class="p">))}:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">_endpoint_index</span><span class="p">[</span><span class="nf">_norm</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]),</span>
                        <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">]),</span>
                        <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">]),</span>
                        <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]),</span>
                    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_reload_locked</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_read_text</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nf">_TOML_LOADS</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="c1"># refresh_interval_seconds (5~60) + env override
</span>        <span class="n">conf_val</span> <span class="o">=</span> <span class="nf">int</span><span class="p">((</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">settings</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">refresh_interval_seconds</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
        <span class="n">conf_val</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">conf_val</span><span class="p">))</span>
        <span class="n">env_override</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env_override</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">conf_val</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">env_override</span><span class="p">)))</span>
            <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_refresh_interval</span> <span class="o">=</span> <span class="n">conf_val</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span> <span class="o">=</span> <span class="nf">_expand_env_vars</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_build_index_endpoints</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_version</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_stale_or_changed</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mtime</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">mtime</span> <span class="o">!=</span> <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">&gt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">_refresh_interval</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ensure_loaded</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="nf">_stale_or_changed</span><span class="p">():</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>

    <span class="c1"># ---------- 퍼블릭 API ----------
</span>    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_version</span>

    <span class="k">def</span> <span class="nf">snapshot</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">ENV 치환 후 전체 트리의 </span><span class="sh">'</span><span class="s">일관된 스냅샷</span><span class="sh">'</span><span class="s">을 반환(얕은 복사).</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="k">return</span> <span class="nf">dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dotted_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_raw</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">dotted_path</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">.</span><span class="sh">"</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="n">part</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">config path not found: </span><span class="si">{</span><span class="n">dotted_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cur</span>

    <span class="k">def</span> <span class="nf">get_endpoint</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sh">"</span><span class="s">endpoint key is empty</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_endpoint_index</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_norm</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="c1"># 갱신 지연 가능성 → 강제 리로드 1회 재시도
</span>            <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>
                <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_endpoint_index</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_norm</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">endpoint not found: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hit</span>

    <span class="k">def</span> <span class="nf">list_endpoints</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">out</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">_endpoint_index</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">dn</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]</span>
            <span class="n">out</span><span class="p">[</span><span class="n">dn</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">],</span>
                <span class="c1"># api_key는 미노출
</span>            <span class="p">}</span>
        <span class="k">return</span> <span class="n">out</span>
</code></pre></div></div>

<hr />

<h1 id="3-공용-api-어디서든-임포트해-쓰는-함수형-인터페이스">3) 공용 API (어디서든 임포트해 쓰는 “함수형” 인터페이스)</h1>

<p><code class="language-plaintext highlighter-rouge">config.py</code></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="n">.config_core</span> <span class="kn">import</span> <span class="n">ReadOnlyStore</span>

<span class="c1"># 경로별 Multiton 레지스트리
</span><span class="n">_REGISTRY</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ReadOnlyStore</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">_default_path</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_PATH</span><span class="sh">"</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="sh">"</span><span class="s">config.toml</span><span class="sh">"</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">get_store</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReadOnlyStore</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    - 경로별로 ReadOnlyStore 인스턴스를 재사용(멀티톤)
    - 명시 path 없으면 COMFY_CONFIG_PATH 또는 패키지 기본 config.toml
    </span><span class="sh">"""</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">abspath</span><span class="p">(</span><span class="n">path</span> <span class="ow">or</span> <span class="nf">_default_path</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_REGISTRY</span><span class="p">:</span>
        <span class="n">_REGISTRY</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="nc">ReadOnlyStore</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_REGISTRY</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>

<span class="c1"># ---- 얇은 함수형 헬퍼들 (권장) ----
</span><span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="sh">"""</span><span class="s">엔드포인트 dict 반환: display_name, request_name, base_url, api_key</span><span class="sh">"""</span>
    <span class="k">return</span> <span class="nf">get_store</span><span class="p">(</span><span class="n">path</span><span class="p">).</span><span class="nf">get_endpoint</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">endpoints</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
    <span class="sh">"""</span><span class="s">엔드포인트 목록(JSON용)</span><span class="sh">"""</span>
    <span class="k">return</span> <span class="nf">get_store</span><span class="p">(</span><span class="n">path</span><span class="p">).</span><span class="nf">list_endpoints</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">dotted_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">임의 설정값 반환: </span><span class="sh">'</span><span class="s">section.sub.key</span><span class="sh">'"""</span>
    <span class="k">return</span> <span class="nf">get_store</span><span class="p">(</span><span class="n">path</span><span class="p">).</span><span class="nf">get_value</span><span class="p">(</span><span class="n">dotted_path</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">snapshot</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sh">"""</span><span class="s">전체 트리 스냅샷</span><span class="sh">"""</span>
    <span class="k">return</span> <span class="nf">get_store</span><span class="p">(</span><span class="n">path</span><span class="p">).</span><span class="nf">snapshot</span><span class="p">()</span>
</code></pre></div></div>

<blockquote>
  <p>포인트: <strong>다른 노드 파일</strong> 에서는 <code class="language-plaintext highlighter-rouge">config.endpoint()</code>, <code class="language-plaintext highlighter-rouge">config.get()</code> 같은 <strong>함수형 API만</strong> 쓰면 됩니다.<br />
 내부적으로는 경로별 인스턴스를 재사용하지만, 노드 코드에서는 싱글톤에 의존하지 않습니다.</p>
</blockquote>

<hr />

<h1 id="4-옵션-데모-노드--기존-노드를-이-api로-얇게-래핑">4) (옵션) 데모 노드 — 기존 노드를 이 API로 얇게 래핑</h1>

<p><code class="language-plaintext highlighter-rouge">config_nodes.py</code></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">.config</span> <span class="kn">import</span> <span class="n">endpoint</span> <span class="k">as</span> <span class="n">_endpoint</span><span class="p">,</span> <span class="n">endpoints</span> <span class="k">as</span> <span class="n">_endpoints</span><span class="p">,</span> <span class="n">get</span> <span class="k">as</span> <span class="n">_get</span>
<span class="kn">import</span> <span class="n">json</span>

<span class="k">class</span> <span class="nc">ConfigEndpointLookup</span><span class="p">:</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">INPUT_TYPES</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">required</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="sh">"</span><span class="s">default</span><span class="sh">"</span><span class="p">:</span> <span class="sh">""</span><span class="p">,</span> <span class="sh">"</span><span class="s">multiline</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">}),</span>
                             <span class="sh">"</span><span class="s">config_path</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="sh">"</span><span class="s">default</span><span class="sh">"</span><span class="p">:</span> <span class="sh">""</span><span class="p">,</span> <span class="sh">"</span><span class="s">multiline</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">})}}</span>
    <span class="n">RETURN_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">RETURN_NAMES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="sh">"</span><span class="s">lookup</span><span class="sh">"</span>
    <span class="n">CATEGORY</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Config/Endpoints (ReadOnly)</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">config_path</span> <span class="ow">or</span> <span class="bp">None</span>
        <span class="n">ep</span> <span class="o">=</span> <span class="nf">_endpoint</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">ep</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">],</span> <span class="n">ep</span><span class="p">[</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">],</span> <span class="n">ep</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">],</span> <span class="n">ep</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">])</span>

<span class="k">class</span> <span class="nc">ConfigListEndpoints</span><span class="p">:</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">INPUT_TYPES</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">required</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">config_path</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="sh">"</span><span class="s">default</span><span class="sh">"</span><span class="p">:</span> <span class="sh">""</span><span class="p">,</span> <span class="sh">"</span><span class="s">multiline</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">})}}</span>
    <span class="n">RETURN_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,)</span>
    <span class="n">RETURN_NAMES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">endpoints_json</span><span class="sh">"</span><span class="p">,)</span>
    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="sh">"</span><span class="s">list_endpoints</span><span class="sh">"</span>
    <span class="n">CATEGORY</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Config/Endpoints (ReadOnly)</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">list_endpoints</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">config_path</span> <span class="ow">or</span> <span class="bp">None</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nf">_endpoints</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">),)</span>

<span class="k">class</span> <span class="nc">ConfigGetValue</span><span class="p">:</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">INPUT_TYPES</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">required</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="sh">"</span><span class="s">default</span><span class="sh">"</span><span class="p">:</span> <span class="sh">""</span><span class="p">,</span> <span class="sh">"</span><span class="s">multiline</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">}),</span>
                             <span class="sh">"</span><span class="s">config_path</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="sh">"</span><span class="s">default</span><span class="sh">"</span><span class="p">:</span> <span class="sh">""</span><span class="p">,</span> <span class="sh">"</span><span class="s">multiline</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">})}}</span>
    <span class="n">RETURN_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,)</span>
    <span class="n">RETURN_NAMES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">,)</span>
    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="sh">"</span><span class="s">get_value</span><span class="sh">"</span>
    <span class="n">CATEGORY</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Config/General (ReadOnly)</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">config_path</span> <span class="ow">or</span> <span class="bp">None</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nf">_get</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">))</span> <span class="ow">or</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nf">return </span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">val</span><span class="p">),)</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">),)</span>

<span class="n">NODE_CLASS_MAPPINGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">ConfigEndpointLookup</span><span class="sh">"</span><span class="p">:</span> <span class="n">ConfigEndpointLookup</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">ConfigListEndpoints</span><span class="sh">"</span><span class="p">:</span>  <span class="n">ConfigListEndpoints</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">ConfigGetValue</span><span class="sh">"</span><span class="p">:</span>       <span class="n">ConfigGetValue</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">NODE_DISPLAY_NAME_MAPPINGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">ConfigEndpointLookup</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Config: Endpoint Lookup</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">ConfigListEndpoints</span><span class="sh">"</span><span class="p">:</span>  <span class="sh">"</span><span class="s">Config: List Endpoints</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">ConfigGetValue</span><span class="sh">"</span><span class="p">:</span>       <span class="sh">"</span><span class="s">Config: Get Value</span><span class="sh">"</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h1 id="5-다른-노드-파일들에서-쓰는-법-가장-깔끔한-패턴">5) 다른 노드 “파일들”에서 쓰는 법 (가장 깔끔한 패턴)</h1>

<p>다른 플러그인/노드 파일 어디에서든:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 예: OpenAI 호출 노드 파일 내부
</span><span class="kn">from</span> <span class="n">comfyui_config_reader.config</span> <span class="kn">import</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">get</span>

<span class="k">def</span> <span class="nf">_prepare_client</span><span class="p">():</span>
    <span class="n">ep</span> <span class="o">=</span> <span class="nf">endpoint</span><span class="p">(</span><span class="sh">"</span><span class="s">text-model-a</span><span class="sh">"</span><span class="p">)</span>   <span class="c1"># 또는 display_name / request_name로 조회
</span>    <span class="n">api_key</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">]</span>
    <span class="c1"># ... 클라이언트 생성
</span>    <span class="k">return</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">base_url</span>

<span class="k">def</span> <span class="nf">_s3_settings</span><span class="p">():</span>
    <span class="n">region</span> <span class="o">=</span> <span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">storage.s3.region</span><span class="sh">"</span><span class="p">)</span>    <span class="c1"># 범용 설정 접근
</span>    <span class="n">bucket</span> <span class="o">=</span> <span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">storage.s3.bucket</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">region</span><span class="p">,</span> <span class="n">bucket</span>
</code></pre></div></div>

<ul>
  <li>
    <p>기본 경로는 <code class="language-plaintext highlighter-rouge">COMFY_CONFIG_PATH</code> 또는 <code class="language-plaintext highlighter-rouge">comfyui_config_reader/config.toml</code>.</p>
  </li>
  <li>
    <p>특정 파일을 쓰고 싶으면 <code class="language-plaintext highlighter-rouge">endpoint("text-model-a", path="/abs/path/to/config.toml")</code>처럼 <strong>함수 인자</strong> 로 주면 됩니다.</p>
  </li>
  <li>
    <p>내부는 <strong>경로별 레지스트리(Multiton)</strong>라 같은 경로는 인스턴스를 공유(성능↑)하지만, 호출부는 <strong>함수형</strong> 이라 싱글톤에 종속되지 않아요.</p>
  </li>
</ul>

<hr />

<h1 id="6-요건-체크">6) 요건 체크</h1>

<ul>
  <li>
    <p>여러 노드/파일에서 공통 사용: <strong>함수형 API</strong> 로 간단 임포트</p>
  </li>
  <li>
    <p>싱글톤 어색함 제거: <strong>경로별 Multiton + helper 함수</strong> → 명시적 DI도 가능(<code class="language-plaintext highlighter-rouge">get_store(path)</code>)</p>
  </li>
  <li>
    <p>읽기 전용 + 1분 내 반영: <strong>mtime + 5~60s TTL(기본 30s)</strong></p>
  </li>
  <li>
    <p>사람이 편집 쉬움: <strong>TOML + ENV 치환</strong></p>
  </li>
  <li>
    <p>엔드포인트 4필드: <code class="language-plaintext highlighter-rouge">display_name, request_name, base_url, api_key</code></p>
  </li>
</ul>

<hr />

<p>필요하면 <code class="language-plaintext highlighter-rouge">get_store(path)</code>로 <strong>명시적 의존성 주입(DI)</strong>도 가능해요. 예컨대 프레임워크 초기화 시:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">comfyui_config_reader.config</span> <span class="kn">import</span> <span class="n">get_store</span>
<span class="n">STORE</span> <span class="o">=</span> <span class="nf">get_store</span><span class="p">(</span><span class="sh">"</span><span class="s">/path/to/config.toml</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 이후 어디서든:
</span><span class="n">ep</span> <span class="o">=</span> <span class="n">STORE</span><span class="p">.</span><span class="nf">get_endpoint</span><span class="p">(</span><span class="sh">"</span><span class="s">text-model-a</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p>이렇게 하면 아예 전역 함수도 안 쓰고, “내가 주입한 스토어”만 참조하는 형태로 완전히 분리할 수 있습니다.</p>

<p class="chat--user">

아니 싱글톤은 괜찮은데 외부에서 접근이 쉽지 않아보여서. 싱글톤이 낫지 않아?

</p>

<p>좋아, <strong>싱글톤으로 단순·직관 접근</strong> 가능하게 정리해줄게.<br />
외부 노드 “파일들” 어디서든 한 줄 임포트로 바로 쓰는 형태야:</p>

<ul>
  <li>
    <p>함수형: <code class="language-plaintext highlighter-rouge">from comfyui_config_reader import endpoint, get</code></p>
  </li>
  <li>
    <p>객체형: <code class="language-plaintext highlighter-rouge">from comfyui_config_reader import CONFIG</code></p>
  </li>
</ul>

<p>둘 다 같은 싱글톤 인스턴스를 뒤에서 사용해. (thread-safe, read-only, 1분 내 반영)</p>

<hr />

<h1 id="1-파일-구조-심플">1) 파일 구조 (심플)</h1>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ComfyUI/
└─ custom_nodes/
   └─ comfyui_config_reader/
      ├─ __init__.py
      ├─ config_singleton.py   # 싱글톤 본체
      └─ config.toml
</code></pre></div></div>

<hr />

<h1 id="2-configtoml-예시-범용">2) <code class="language-plaintext highlighter-rouge">config.toml</code> 예시 (범용)</h1>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">version</span> <span class="p">=</span> <span class="mi">1</span>

<span class="nn">[settings]</span>
<span class="py">refresh_interval_seconds</span> <span class="p">=</span> <span class="mi">30</span>  <span class="c"># 5~60 사이 권장</span>

<span class="nn">[endpoints."text-model-a"]</span>
<span class="py">display_name</span>  <span class="p">=</span> <span class="s">"Text Model A"</span>
<span class="py">request_name</span>  <span class="p">=</span> <span class="s">"gpt-4o-mini"</span>
<span class="py">base_url</span>      <span class="p">=</span> <span class="s">"https://api.openai.com/v1"</span>
<span class="py">api_key</span>       <span class="p">=</span> <span class="s">"${OPENAI_API_KEY}"</span>

<span class="nn">[feature_flags]</span>
<span class="py">use_cache</span> <span class="p">=</span> <span class="kc">true</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">${ENV}</code> 는 환경변수 치환됨.</li>
</ul>

<hr />

<h1 id="3-싱글톤-구현-config_singletonpy">3) 싱글톤 구현: <code class="language-plaintext highlighter-rouge">config_singleton.py</code></h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">threading</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>

<span class="c1"># Python 3.11+: tomllib / 이하: tomli
</span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomllib</span>  <span class="c1"># type: ignore
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomllib</span><span class="p">.</span><span class="n">loads</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomli</span>  <span class="c1"># type: ignore
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomli</span><span class="p">.</span><span class="n">loads</span>

<span class="k">def</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="sh">""</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">${</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">"</span><span class="s">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">j</span><span class="p">],</span> <span class="sh">""</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="nf">_expand_env</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">v</span>

<span class="k">def</span> <span class="nf">_norm</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="nf">str</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="nf">strip</span><span class="p">().</span><span class="nf">lower</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">_ReadOnlyConfig</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    - TOML 파일 읽기 전용
    - mtime 변경 + TTL(5~60s, 기본 30s) 자동 재로드
    - endpoints 4필드 인덱싱(display_name, request_name, base_url, api_key)
    - 임의 경로 접근 가능 (</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="s"> 구분)
    </span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_ep_index</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># -------- 내부 로딩 --------
</span>    <span class="k">def</span> <span class="nf">_read_text</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">,</span> <span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_build_index</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_ep_index</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">endpoints</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="k">return</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="n">eps</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="k">continue</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
            <span class="n">req</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]</span>
            <span class="k">if</span> <span class="nf">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cfg</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">k</span><span class="p">]).</span><span class="nf">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">req</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">{</span><span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span><span class="sh">""</span><span class="p">)),</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">,</span><span class="sh">""</span><span class="p">))}:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">_ep_index</span><span class="p">[</span><span class="nf">_norm</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]),</span>
                        <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">]),</span>
                        <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">]),</span>
                        <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]),</span>
                    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_reload_locked</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_read_text</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nf">_TOML_LOADS</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="c1"># refresh_interval_seconds (5~60) + env override
</span>        <span class="n">r</span> <span class="o">=</span> <span class="nf">int</span><span class="p">((</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">settings</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">refresh_interval_seconds</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
        <span class="n">env_r</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env_r</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">r</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">env_r</span><span class="p">)))</span>
            <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span> <span class="k">pass</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span> <span class="o">=</span> <span class="n">r</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span> <span class="o">=</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_build_index</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">_stale_or_changed</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">m</span> <span class="o">!=</span> <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">&gt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ensure_loaded</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="nf">_stale_or_changed</span><span class="p">():</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>

    <span class="c1"># -------- 퍼블릭 API --------
</span>    <span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sh">"</span><span class="s">endpoint key is empty</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_ep_index</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_norm</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="c1"># 즉시 재시도(갱신 지연 보정)
</span>            <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>
                <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_ep_index</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_norm</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">endpoint not found: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hit</span>

    <span class="k">def</span> <span class="nf">endpoints</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">out</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">_ep_index</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">out</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">out</span>  <span class="c1"># api_key 미노출
</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dotted</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_raw</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">dotted</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">.</span><span class="sh">"</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="n">part</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">config path not found: </span><span class="si">{</span><span class="n">dotted</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cur</span>

    <span class="k">def</span> <span class="nf">snapshot</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="k">return</span> <span class="nf">dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>

<span class="c1"># ===== 모듈 전역 싱글톤 =====
</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
<span class="n">_instance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ReadOnlyConfig</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">_default_path</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># configure()로 지정 가능
</span>
<span class="k">def</span> <span class="nf">_resolve_default_path</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_default_path</span> <span class="ow">or</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_PATH</span><span class="sh">"</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="sh">"</span><span class="s">config.toml</span><span class="sh">"</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_get_instance</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">_ReadOnlyConfig</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">_instance</span>
    <span class="k">if</span> <span class="n">_instance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_instance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">_instance</span> <span class="o">=</span> <span class="nf">_ReadOnlyConfig</span><span class="p">(</span><span class="nf">_resolve_default_path</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">_instance</span>

<span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">refresh_seconds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    싱글톤 설정(선택): 경로/TTL 오버라이드.
    - 가능한 한 </span><span class="sh">'</span><span class="s">초기화 시 1회</span><span class="sh">'</span><span class="s">만 호출 추천.
    - 이후에도 호출 가능하며, 새 인스턴스로 교체됨( thread-safe ).
    </span><span class="sh">"""</span>
    <span class="k">global</span> <span class="n">_instance</span><span class="p">,</span> <span class="n">_default_path</span>
    <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">_default_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">refresh_seconds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sh">"</span><span class="s">COMFY_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">refresh_seconds</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">_lock</span><span class="p">:</span>
        <span class="n">_instance</span> <span class="o">=</span> <span class="nf">_ReadOnlyConfig</span><span class="p">(</span><span class="nf">_resolve_default_path</span><span class="p">())</span>

<span class="c1"># ---- 외부에 노출할 얇은 API (가장 쉬운 접근) ----
</span><span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">endpoint</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">endpoints</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
    <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">endpoints</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">dotted</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">get</span><span class="p">(</span><span class="n">dotted</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">snapshot</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">snapshot</span><span class="p">()</span>

<span class="c1"># ---- 객체형 접근을 위한 프록시(CONFIG) ----
</span><span class="k">class</span> <span class="nc">_ConfigProxy</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># CONFIG.endpoint(...), CONFIG.get(...) 형태 지원
</span>        <span class="k">return</span> <span class="nf">getattr</span><span class="p">(</span><span class="nf">_get_instance</span><span class="p">(),</span> <span class="n">name</span><span class="p">)</span>

<span class="n">CONFIG</span> <span class="o">=</span> <span class="nf">_ConfigProxy</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h1 id="4-__init__py-한-줄-임포트-지원">4) <code class="language-plaintext highlighter-rouge">__init__.py</code> (한 줄 임포트 지원)</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 외부에서 아주 간단히 접근 가능하게 re-export
</span><span class="kn">from</span> <span class="n">.config_singleton</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CONFIG</span><span class="p">,</span>        <span class="c1"># 객체형: CONFIG.endpoint(...), CONFIG.get(...)
</span>    <span class="n">configure</span><span class="p">,</span>     <span class="c1"># 선택: 초기화 시 경로/TTL 지정
</span>    <span class="n">endpoint</span><span class="p">,</span>      <span class="c1"># 함수형: endpoint("text-model-a")
</span>    <span class="n">endpoints</span><span class="p">,</span>
    <span class="n">get</span><span class="p">,</span>
    <span class="n">snapshot</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<hr />

<h1 id="5-외부-노드-파일들에서-쓰는-법">5) 외부 노드 “파일들”에서 쓰는 법</h1>

<h2 id="가장-간단-함수형">가장 간단 (함수형)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">comfyui_config_reader</span> <span class="kn">import</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">get</span>

<span class="k">def</span> <span class="nf">build_client</span><span class="p">():</span>
    <span class="n">ep</span> <span class="o">=</span> <span class="nf">endpoint</span><span class="p">(</span><span class="sh">"</span><span class="s">text-model-a</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># 키 / display_name / request_name 중 아무거나 OK
</span>    <span class="n">base_url</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">]</span>
    <span class="n">api_key</span>  <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]</span>
    <span class="c1"># ... 클라이언트 생성
</span></code></pre></div></div>

<h2 id="객체형이-익숙하다면">객체형이 익숙하다면</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">comfyui_config_reader</span> <span class="kn">import</span> <span class="n">CONFIG</span>

<span class="k">def</span> <span class="nf">build_client</span><span class="p">():</span>
    <span class="n">ep</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="p">.</span><span class="nf">endpoint</span><span class="p">(</span><span class="sh">"</span><span class="s">text-model-a</span><span class="sh">"</span><span class="p">)</span>
    <span class="c1"># CONFIG.get("storage.s3.region") 등도 동일
</span></code></pre></div></div>

<h2 id="시작-시-경로ttl-지정선택">시작 시 경로/TTL 지정(선택)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 예: __init__ 혹은 ComfyUI 부팅 초기에 한 번
</span><span class="kn">from</span> <span class="n">comfyui_config_reader</span> <span class="kn">import</span> <span class="n">configure</span>
<span class="nf">configure</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="sh">"</span><span class="s">/abs/path/to/config.toml</span><span class="sh">"</span><span class="p">,</span> <span class="n">refresh_seconds</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>  <span class="c1"># 5~60 사이
</span></code></pre></div></div>

<ul>
  <li>이후 모든 모듈에서 같은 싱글톤을 사용하고, 파일 변경은 <strong>최대 1분 내</strong> 반영돼요(기본 30초, env/설정으로 조절).</li>
</ul>

<hr />

<h1 id="6-요건-재확인">6) 요건 재확인</h1>

<ul>
  <li>
    <p>✅ 외부 접근 쉬움: <code class="language-plaintext highlighter-rouge">from comfyui_config_reader import endpoint</code> 또는 <code class="language-plaintext highlighter-rouge">CONFIG.endpoint</code></p>
  </li>
  <li>
    <p>✅ 싱글톤: 모듈 전역 한 개 인스턴스, thread-safe lazy init</p>
  </li>
  <li>
    <p>✅ 읽기 전용: 쓰기 없음</p>
  </li>
  <li>
    <p>✅ 1분 내 반영: mtime + TTL(기본 30s, 5~60s)</p>
  </li>
  <li>
    <p>✅ 사람이 편집 쉬움: TOML + <code class="language-plaintext highlighter-rouge">${ENV}</code> 치환</p>
  </li>
  <li>
    <p>✅ 엔드포인트 4필드: <code class="language-plaintext highlighter-rouge">display_name</code>, <code class="language-plaintext highlighter-rouge">request_name</code>, <code class="language-plaintext highlighter-rouge">base_url</code>, <code class="language-plaintext highlighter-rouge">api_key</code></p>
  </li>
</ul>

<p>필요하면, 지금 구조 위에 “엔드포인트 호출용 노드”도 바로 얹어줄게.</p>

<p class="chat--user">

endpoint 말고 좀 더 좋은 용어 선정해줘. 그리고 model configuration (parameter 등도 설정에 같이 포함시키면 좋겠어)

</p>

<p>좋아! “endpoint” 대신 더 자연스러운 용어로 <strong>profile(프로필)</strong> 을 쓰고, 여기에 <strong>model configuration(파라미터 등)</strong> 까지 함께 담는 방향으로 정리했어.<br />
외부 노드/파일에서는 <strong>싱글톤</strong> 을 아주 간단히 쓰면 되고, 기존 endpoint 명칭은 <strong>하위 호환 별칭</strong> 도 제공해둘게.</p>

<hr />

<h1 id="1-용어-선정-step-by-step">1) 용어 선정 (step-by-step)</h1>

<ol>
  <li>
    <p><strong>profile (프로필)</strong> — 사람이 이해하기 쉬움. “연결 정보 + 호출 규칙 + 모델 파라미터 묶음”을 한 세트로 보기에 적합.</p>
  </li>
  <li>
    <p>대안(참고): provider, backend, connector, target.</p>

    <ul>
      <li>기술적으로는 <em>backend</em> 도 괜찮지만, “설정 묶음” 뉘앙스는 <em>profile</em> 이 가장 직관적.</li>
    </ul>
  </li>
  <li>
    <p>결론: <strong>profiles</strong> 섹션으로 표준화하고, <strong>endpoints</strong> 는 자동 인식(하위 호환) 유지.</p>
  </li>
</ol>

<hr />

<h1 id="2-configtoml-스키마-모델-파라미터-포함">2) config.toml 스키마 (모델 파라미터 포함)</h1>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">version</span> <span class="p">=</span> <span class="mi">1</span>

<span class="nn">[settings]</span>
<span class="c"># 파일 변경 감지 주기(초). 5~60 권장. "1분 내 반영" 요건 만족.</span>
<span class="py">refresh_interval_seconds</span> <span class="p">=</span> <span class="mi">30</span>

<span class="c"># 모든 프로필에 공통 적용될 기본값(선택)</span>
<span class="nn">[defaults.params]</span>
<span class="py">temperature</span> <span class="p">=</span> <span class="mf">0.3</span>
<span class="py">max_tokens</span>  <span class="p">=</span> <span class="mi">2048</span>

<span class="nn">[defaults.http]</span>
<span class="py">timeout_seconds</span> <span class="p">=</span> <span class="mi">30</span>
<span class="nn">[defaults.http.headers]</span>
<span class="py">User-Agent</span> <span class="p">=</span> <span class="s">"ComfyUI-ConfigReader/1.0"</span>
<span class="nn">[defaults.http.query]</span>
<span class="c"># 공통 쿼리 파라미터가 필요하면 여기에</span>

<span class="c"># ── 프로필들 ─────────────────────────────────────────────</span>
<span class="nn">[profiles."text-model-a"]</span>
<span class="py">display_name</span>  <span class="p">=</span> <span class="s">"Text Model A"</span>
<span class="py">request_name</span>  <span class="p">=</span> <span class="s">"gpt-4o-mini"</span>
<span class="py">base_url</span>      <span class="p">=</span> <span class="s">"https://api.openai.com/v1"</span>
<span class="py">api_key</span>       <span class="p">=</span> <span class="s">"${OPENAI_API_KEY}"</span>

<span class="c"># 이 프로필의 모델 파라미터(기본값 위에 덮어쓰기)</span>
<span class="nn">[profiles."text-model-a".params]</span>
<span class="py">temperature</span> <span class="p">=</span> <span class="mf">0.2</span>
<span class="py">top_p</span>       <span class="p">=</span> <span class="mf">0.9</span>
<span class="py">stop</span>        <span class="p">=</span> <span class="p">[</span><span class="s">"</span><span class="se">\n\n</span><span class="s">Human:"</span><span class="p">,</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">Assistant:"</span><span class="p">]</span>

<span class="c"># HTTP 관련(선택): 헤더, 타임아웃, 쿼리 등</span>
<span class="nn">[profiles."text-model-a".http]</span>
<span class="py">timeout_seconds</span> <span class="p">=</span> <span class="mi">20</span>
<span class="nn">[profiles."text-model-a".http.headers]</span>
<span class="py">X-Org-Id</span> <span class="p">=</span> <span class="s">"${ORG_ID}"</span>
<span class="nn">[profiles."text-model-a".http.query]</span>
<span class="py">apiVersion</span> <span class="p">=</span> <span class="s">"2024-06-01"</span>

<span class="nn">[profiles."text-model-b"]</span>
<span class="py">display_name</span>  <span class="p">=</span> <span class="s">"Text Model B"</span>
<span class="py">request_name</span>  <span class="p">=</span> <span class="s">"claude-3-5-sonnet"</span>
<span class="py">base_url</span>      <span class="p">=</span> <span class="s">"https://api.anthropic.com"</span>
<span class="py">api_key</span>       <span class="p">=</span> <span class="s">"${ANTHROPIC_API_KEY}"</span>
<span class="c"># params/http 섹션이 없으면 defaults만 적용</span>
</code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">${ENV}</code> 는 환경변수 치환됨.</p>
  </li>
  <li>
    <p><strong>params</strong> : temperature/top_p/max_tokens/stop/seed 등 원하는 파라미터 자유 확장.</p>
  </li>
  <li>
    <p><strong>http</strong> : timeout_seconds / headers / query 등 요청 관련 옵션.</p>
  </li>
  <li>
    <p>상단의 <strong>[defaults]</strong> 는 모든 프로필에 <strong>병합(merge)</strong> 되어 기본값 역할.</p>
  </li>
</ul>

<hr />

<h1 id="3-싱글톤-api-drop-in-profile--params--http">3) 싱글톤 API (drop-in): profile + params + http</h1>

<p>외부 어디서든 한 줄로 접근:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">comfyui_config_reader</span> <span class="kn">import</span> <span class="n">profile</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">http</span><span class="p">,</span> <span class="n">get</span>
<span class="c1"># 또는 객체형:
</span><span class="kn">from</span> <span class="n">comfyui_config_reader</span> <span class="kn">import</span> <span class="n">CONFIG</span>
</code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">profile(key)</code> → 연결정보 + 모델파라미터 + http 설정까지 <strong>한 번에</strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">params(key)</code> → 해당 프로필의 <strong>모델 파라미터 dict</strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">http(key)</code> → 해당 프로필의 <strong>HTTP 옵션 dict</strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">get("storage.s3.region")</code> 처럼 범용 키 접근도 유지</p>
  </li>
  <li>
    <p>하위 호환: <code class="language-plaintext highlighter-rouge">endpoint</code>, <code class="language-plaintext highlighter-rouge">endpoints</code> 별칭도 남겨둠(기존 코드 안깨짐)</p>
  </li>
</ul>

<hr />

<h1 id="4-교체본-코드-config_singletonpy">4) 교체본 코드 (<code class="language-plaintext highlighter-rouge">config_singleton.py</code>)</h1>

<p>아래 파일 하나로 기존 싱글톤 구현을 대체하면 돼. (기능: profiles + defaults 병합 + params/http 지원 + legacy <code class="language-plaintext highlighter-rouge">endpoints</code> 인식)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">threading</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>

<span class="c1"># Python 3.11+: tomllib / 이하: tomli
</span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomllib</span>  <span class="c1"># type: ignore
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomllib</span><span class="p">.</span><span class="n">loads</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomli</span>  <span class="c1"># type: ignore
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomli</span><span class="p">.</span><span class="n">loads</span>

<span class="k">def</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="sh">""</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">${</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">"</span><span class="s">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">j</span><span class="p">],</span> <span class="sh">""</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="nf">_expand_env</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">v</span>

<span class="k">def</span> <span class="nf">_norm</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="nf">str</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="nf">strip</span><span class="p">().</span><span class="nf">lower</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_deep_merge</span><span class="p">(</span><span class="n">base</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">over</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sh">"""</span><span class="s">얕은 dict update가 아닌, 중첩 dict까지 병합.</span><span class="sh">"""</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="n">over</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nf">_deep_merge</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="k">class</span> <span class="nc">_ReadOnlyConfig</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    - 읽기 전용 TOML
    - mtime + TTL(5~60s, 기본 30s) 자동 재로드 → 1분 내 변경 반영
    - </span><span class="sh">'</span><span class="s">profiles</span><span class="sh">'</span><span class="s"> 표준 + </span><span class="sh">'</span><span class="s">endpoints</span><span class="sh">'</span><span class="s"> 레거시도 자동 인식
    - 각 profile에:
        * display_name, request_name, base_url, api_key (필수)
        * params(dict)  : 모델 파라미터
        * http(dict)    : timeout_seconds, headers{}, query{}
    </span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 정규화 키 -&gt; profile dict
</span>
    <span class="c1"># -------- 내부 로딩 --------
</span>    <span class="k">def</span> <span class="nf">_read_text</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">,</span> <span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_profiles_table</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="c1"># 표준 'profiles' 우선, 없으면 'endpoints'(하위 호환)
</span>        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">profiles</span><span class="sh">"</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">profiles</span><span class="sh">"</span><span class="p">]</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">endpoints</span><span class="sh">"</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">endpoints</span><span class="sh">"</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_build_index</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>

        <span class="c1"># defaults (ENV 확장 포함)
</span>        <span class="n">defaults</span> <span class="o">=</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">defaults</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">defaults_params</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">defaults_http</span>   <span class="o">=</span> <span class="n">defaults</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">)</span>   <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="sh">"</span><span class="s">headers</span><span class="sh">"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defaults_http</span><span class="p">:</span> <span class="n">defaults_http</span><span class="p">[</span><span class="sh">"</span><span class="s">headers</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="sh">"</span><span class="s">query</span><span class="sh">"</span>   <span class="ow">not</span> <span class="ow">in</span> <span class="n">defaults_http</span><span class="p">:</span> <span class="n">defaults_http</span><span class="p">[</span><span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">]</span>   <span class="o">=</span> <span class="p">{}</span>

        <span class="n">profiles_tbl</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_extract_profiles_table</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">profiles_tbl</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">raw_cfg</span> <span class="ow">in</span> <span class="n">profiles_tbl</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">raw_cfg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">cfg</span> <span class="o">=</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">raw_cfg</span><span class="p">)</span>  <span class="c1"># ENV 치환
</span>            <span class="c1"># 필수 필드
</span>            <span class="n">req</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]</span>
            <span class="k">if</span> <span class="nf">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cfg</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">k</span><span class="p">]).</span><span class="nf">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">req</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># params/http 병합 (defaults → profile override)
</span>            <span class="n">p_params</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
            <span class="n">p_http</span>   <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">)</span>   <span class="ow">or</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="sh">"</span><span class="s">headers</span><span class="sh">"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p_http</span><span class="p">:</span> <span class="n">p_http</span><span class="p">[</span><span class="sh">"</span><span class="s">headers</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="sh">"</span><span class="s">query</span><span class="sh">"</span>   <span class="ow">not</span> <span class="ow">in</span> <span class="n">p_http</span><span class="p">:</span> <span class="n">p_http</span><span class="p">[</span><span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">]</span>   <span class="o">=</span> <span class="p">{}</span>

            <span class="n">merged_params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">defaults_params</span><span class="p">,</span> <span class="o">**</span><span class="n">p_params</span><span class="p">}</span>
            <span class="n">merged_http</span>   <span class="o">=</span> <span class="nf">_deep_merge</span><span class="p">(</span><span class="n">defaults_http</span><span class="p">,</span> <span class="n">p_http</span><span class="p">)</span>

            <span class="n">entry</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]),</span>
                <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">]),</span>
                <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span>     <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">]),</span>
                <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">:</span>      <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]),</span>
                <span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">:</span>       <span class="n">merged_params</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">:</span>         <span class="n">merged_http</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="c1"># 접근 키: 정의 키 / display_name / request_name
</span>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">{</span><span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span><span class="sh">""</span><span class="p">)),</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">,</span><span class="sh">""</span><span class="p">))}:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">[</span><span class="nf">_norm</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="o">=</span> <span class="n">entry</span>

    <span class="k">def</span> <span class="nf">_reload_locked</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_read_text</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nf">_TOML_LOADS</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="c1"># refresh_interval_seconds (5~60) + env override
</span>        <span class="n">r</span> <span class="o">=</span> <span class="nf">int</span><span class="p">((</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">settings</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">refresh_interval_seconds</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
        <span class="n">env_r</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env_r</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">r</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">env_r</span><span class="p">)))</span>
            <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span> <span class="k">pass</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span> <span class="o">=</span> <span class="n">r</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span> <span class="o">=</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_build_index</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">_stale_or_changed</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">m</span> <span class="o">!=</span> <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">&gt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ensure_loaded</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="nf">_stale_or_changed</span><span class="p">():</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>

    <span class="c1"># -------- 퍼블릭 API --------
</span>    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sh">"</span><span class="s">profile key is empty</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_norm</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="c1"># 즉시 재시도(갱신 지연 보정)
</span>            <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>
                <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_norm</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">profile not found: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hit</span>

    <span class="k">def</span> <span class="nf">profiles</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sh">"""</span><span class="s">api_key는 숨기고, 나머지 메타/params/http는 노출.</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">out</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">dn</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dn</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>  <span class="c1"># display_name 중복 키 방지
</span>                <span class="k">continue</span>
            <span class="n">seen</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">dn</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="n">dn</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span>     <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">:</span>       <span class="n">v</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}),</span>
                <span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">:</span>         <span class="n">v</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nf">dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">profile</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}))</span>

    <span class="k">def</span> <span class="nf">http</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nf">dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">profile</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}))</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dotted</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_raw</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">dotted</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">.</span><span class="sh">"</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="n">part</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">config path not found: </span><span class="si">{</span><span class="n">dotted</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cur</span>

    <span class="k">def</span> <span class="nf">snapshot</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="k">return</span> <span class="nf">dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>

<span class="c1"># ===== 모듈 전역 싱글톤 =====
</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
<span class="n">_instance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ReadOnlyConfig</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">_default_path</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># configure()로 지정 가능
</span>
<span class="k">def</span> <span class="nf">_resolve_default_path</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_default_path</span> <span class="ow">or</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_PATH</span><span class="sh">"</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="sh">"</span><span class="s">config.toml</span><span class="sh">"</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_get_instance</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">_ReadOnlyConfig</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">_instance</span>
    <span class="k">if</span> <span class="n">_instance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_instance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">_instance</span> <span class="o">=</span> <span class="nf">_ReadOnlyConfig</span><span class="p">(</span><span class="nf">_resolve_default_path</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">_instance</span>

<span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">refresh_seconds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">선택: 경로/TTL 오버라이드(초기화 시 1회 권장).</span><span class="sh">"""</span>
    <span class="k">global</span> <span class="n">_instance</span><span class="p">,</span> <span class="n">_default_path</span>
    <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">_default_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">refresh_seconds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sh">"</span><span class="s">COMFY_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">refresh_seconds</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">_lock</span><span class="p">:</span>
        <span class="n">_instance</span> <span class="o">=</span> <span class="nf">_ReadOnlyConfig</span><span class="p">(</span><span class="nf">_resolve_default_path</span><span class="p">())</span>

<span class="c1"># ---- 외부에 노출할 간단 API ----
</span><span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">profile</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">profiles</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
    <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">profiles</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">params</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">http</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">http</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">dotted</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">get</span><span class="p">(</span><span class="n">dotted</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">snapshot</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">snapshot</span><span class="p">()</span>

<span class="c1"># ---- 하위 호환 별칭 (endpoint*) ----
</span><span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="k">return</span> <span class="nf">profile</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">endpoints</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
    <span class="k">return</span> <span class="nf">profiles</span><span class="p">()</span>

<span class="c1"># ---- 객체형 접근 프록시(CONFIG) ----
</span><span class="k">class</span> <span class="nc">_ConfigProxy</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="nf">getattr</span><span class="p">(</span><span class="nf">_get_instance</span><span class="p">(),</span> <span class="n">name</span><span class="p">)</span>

<span class="n">CONFIG</span> <span class="o">=</span> <span class="nf">_ConfigProxy</span><span class="p">()</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">__init__.py</code> (re-export)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">.config_singleton</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CONFIG</span><span class="p">,</span>
    <span class="n">configure</span><span class="p">,</span>
    <span class="n">profile</span><span class="p">,</span> <span class="n">profiles</span><span class="p">,</span>
    <span class="n">params</span><span class="p">,</span> <span class="n">http</span><span class="p">,</span>
    <span class="n">get</span><span class="p">,</span> <span class="n">snapshot</span><span class="p">,</span>
    <span class="c1"># legacy alias
</span>    <span class="n">endpoint</span><span class="p">,</span> <span class="n">endpoints</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<hr />

<h1 id="5-외부에서-쓰는-법-예시">5) 외부에서 쓰는 법 (예시)</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">comfyui_config_reader</span> <span class="kn">import</span> <span class="n">profile</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">http</span>

<span class="c1"># (1) 한 번에 전부 받기
</span><span class="n">cfg</span> <span class="o">=</span> <span class="nf">profile</span><span class="p">(</span><span class="sh">"</span><span class="s">Text Model A</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># 또는 "text-model-a" / "gpt-4o-mini"
</span><span class="n">api_key</span>   <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]</span>
<span class="n">base_url</span>  <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">]</span>
<span class="n">req_name</span>  <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">]</span>
<span class="n">p</span>         <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">]</span>      <span class="c1"># dict (temperature/top_p/...)
</span><span class="n">h</span>         <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">]</span>        <span class="c1"># dict (timeout_seconds/headers/query)
</span>
<span class="c1"># (2) 필요만 따로
</span><span class="n">p</span> <span class="o">=</span> <span class="nf">params</span><span class="p">(</span><span class="sh">"</span><span class="s">text-model-a</span><span class="sh">"</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="nf">http</span><span class="p">(</span><span class="sh">"</span><span class="s">text-model-a</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h1 id="6-포인트-정리">6) 포인트 정리</h1>

<ul>
  <li>
    <p>“endpoint” → <strong>“profile”</strong> 로 명확화 (설정 묶음)</p>
  </li>
  <li>
    <p><strong>model configuration(params)</strong> 을 프로필 내부에 포함, <strong>defaults</strong> 로 공통값 지원</p>
  </li>
  <li>
    <p>싱글톤 그대로 유지 + <strong>외부 접근 간단화</strong>(함수/객체형 모두)</p>
  </li>
  <li>
    <p>하위 호환: <code class="language-plaintext highlighter-rouge">endpoint(s)</code> 별칭 제공</p>
  </li>
  <li>
    <p>파일 변경은 <strong>최대 1분 내 반영</strong>(mtime + TTL 5~60s, 기본 30s)</p>
  </li>
</ul>

<p>원하면, ComfyUI 노드(시각적)도 <code class="language-plaintext highlighter-rouge">params/http</code>를 JSON으로 같이 내보내는 <code class="language-plaintext highlighter-rouge">ConfigProfileLookup</code> 노드 버전도 바로 만들어 줄게!</p>

<p class="chat--user">

profile은 좀 너무 범용적인데

</p>

<p>좋아, “profile”이 너무 범용적으로 느껴진다면 더 목적에 딱 맞는 <strong>preset(프리셋)</strong> 으로 용어를 좁히자고 제안할게. “프리셋”은 <em>모델 연결 정보 + 요청 식별자 + 모델 파라미터 + HTTP 옵션</em> 을 한 세트로 담는 의미가 분명하고, UI/워크플로우에서도 흔히 쓰이는 표현이라 직관적이야.<br />
아래는 <strong>용어/스키마/코드 전부 ‘preset’으로 정리한 최종본</strong> 이야. (기존 <code class="language-plaintext highlighter-rouge">profile(s)</code>/<code class="language-plaintext highlighter-rouge">endpoint(s)</code>는 하위 호환 별칭 유지)</p>

<hr />

<h1 id="1-이름--스키마-결정-step-by-step">1) 이름 · 스키마 결정 (step-by-step)</h1>

<ul>
  <li>
    <p>섹션명: <strong><code class="language-plaintext highlighter-rouge">[presets."키"]</code></strong></p>
  </li>
  <li>
    <p>필수 필드: <code class="language-plaintext highlighter-rouge">display_name</code>, <code class="language-plaintext highlighter-rouge">request_name</code>, <code class="language-plaintext highlighter-rouge">base_url</code>, <code class="language-plaintext highlighter-rouge">api_key</code></p>
  </li>
  <li>
    <p>선택 필드: <code class="language-plaintext highlighter-rouge">params</code>(모델 파라미터), <code class="language-plaintext highlighter-rouge">http</code>(timeout/headers/query 등)</p>
  </li>
  <li>
    <p>공통 기본값 병합: <code class="language-plaintext highlighter-rouge">defaults.params</code>, <code class="language-plaintext highlighter-rouge">defaults.http</code>를 각 프리셋에 <strong>머지</strong></p>
  </li>
</ul>

<p>예시 <code class="language-plaintext highlighter-rouge">config.toml</code></p>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">version</span> <span class="p">=</span> <span class="mi">1</span>

<span class="nn">[settings]</span>
<span class="py">refresh_interval_seconds</span> <span class="p">=</span> <span class="mi">30</span>  <span class="c"># (5~60) 1분 내 반영 요건 충족</span>

<span class="c"># 모든 프리셋 공통 기본값(선택)</span>
<span class="nn">[defaults.params]</span>
<span class="py">temperature</span> <span class="p">=</span> <span class="mf">0.3</span>
<span class="py">max_tokens</span>  <span class="p">=</span> <span class="mi">2048</span>

<span class="nn">[defaults.http]</span>
<span class="py">timeout_seconds</span> <span class="p">=</span> <span class="mi">30</span>
<span class="nn">[defaults.http.headers]</span>
<span class="py">User-Agent</span> <span class="p">=</span> <span class="s">"ComfyUI-ConfigReader/1.0"</span>

<span class="c"># ── 프리셋들 ─────────────────────────────────────────────────────</span>
<span class="nn">[presets."text-model-a"]</span>
<span class="py">display_name</span>  <span class="p">=</span> <span class="s">"Text Model A"</span>
<span class="py">request_name</span>  <span class="p">=</span> <span class="s">"gpt-4o-mini"</span>
<span class="py">base_url</span>      <span class="p">=</span> <span class="s">"https://api.openai.com/v1"</span>
<span class="py">api_key</span>       <span class="p">=</span> <span class="s">"${OPENAI_API_KEY}"</span>

<span class="nn">[presets."text-model-a".params]</span>
<span class="py">temperature</span> <span class="p">=</span> <span class="mf">0.2</span>
<span class="py">top_p</span>       <span class="p">=</span> <span class="mf">0.9</span>

<span class="nn">[presets."text-model-a".http]</span>
<span class="py">timeout_seconds</span> <span class="p">=</span> <span class="mi">20</span>
<span class="nn">[presets."text-model-a".http.headers]</span>
<span class="py">X-Org-Id</span> <span class="p">=</span> <span class="s">"${ORG_ID}"</span>

<span class="nn">[presets."text-model-b"]</span>
<span class="py">display_name</span>  <span class="p">=</span> <span class="s">"Text Model B"</span>
<span class="py">request_name</span>  <span class="p">=</span> <span class="s">"claude-3-5-sonnet"</span>
<span class="py">base_url</span>      <span class="p">=</span> <span class="s">"https://api.anthropic.com"</span>
<span class="py">api_key</span>       <span class="p">=</span> <span class="s">"${ANTHROPIC_API_KEY}"</span>

<span class="c"># ── 다른 일반 설정 섹션들도 자유롭게 ─────────────────────────────</span>
<span class="nn">[feature_flags]</span>
<span class="py">use_cache</span> <span class="p">=</span> <span class="kc">true</span>
</code></pre></div></div>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">${ENV}</code> 표기는 환경변수로 치환돼.<br />
 <strong>하위 호환</strong> : <code class="language-plaintext highlighter-rouge">[profiles]</code>나 <code class="language-plaintext highlighter-rouge">[endpoints]</code>를 써도 자동 인식(내부에서 <code class="language-plaintext highlighter-rouge">presets</code>로 취급).</p>
</blockquote>

<hr />

<h1 id="2-외부-접근-api-싱글톤-한-줄로-끝">2) 외부 접근 API (싱글톤, 한 줄로 끝)</h1>

<ul>
  <li>
    <p>함수형:<br />
<code class="language-plaintext highlighter-rouge">from comfyui_config_reader import preset, presets, params, http, get</code></p>
  </li>
  <li>
    <p>객체형(원하면):<br />
<code class="language-plaintext highlighter-rouge">from comfyui_config_reader import CONFIG</code> → <code class="language-plaintext highlighter-rouge">CONFIG.preset("...")</code></p>
  </li>
</ul>

<h3 id="사용-예">사용 예</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">comfyui_config_reader</span> <span class="kn">import</span> <span class="n">preset</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">http</span><span class="p">,</span> <span class="n">get</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="nf">preset</span><span class="p">(</span><span class="sh">"</span><span class="s">text-model-a</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># "키" / "display_name" / "request_name" 아무거나 OK
</span><span class="n">api_key</span>   <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]</span>
<span class="n">base_url</span>  <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">]</span>
<span class="n">req_name</span>  <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">]</span>
<span class="n">p</span>         <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">]</span>   <span class="c1"># 모델 파라미터 dict
</span><span class="n">h</span>         <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">]</span>     <span class="c1"># HTTP 옵션 dict
</span>
<span class="n">temperature</span> <span class="o">=</span> <span class="nf">params</span><span class="p">(</span><span class="sh">"</span><span class="s">text-model-a</span><span class="sh">"</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">temperature</span><span class="sh">"</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
<span class="n">timeout</span>     <span class="o">=</span> <span class="nf">http</span><span class="p">(</span><span class="sh">"</span><span class="s">text-model-a</span><span class="sh">"</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">timeout_seconds</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">region</span> <span class="o">=</span> <span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">feature_flags.use_cache</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># 범용 키 접근
</span></code></pre></div></div>

<hr />

<h1 id="3-드롭인-교체-코드">3) 드롭인 교체 코드</h1>

<p>아래 두 파일만 교체하면 끝이야.</p>

<h2 id="custom_nodescomfyui_config_reader__init__py"><code class="language-plaintext highlighter-rouge">custom_nodes/comfyui_config_reader/__init__.py</code></h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">.config_singleton</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CONFIG</span><span class="p">,</span>
    <span class="n">configure</span><span class="p">,</span>
    <span class="n">preset</span><span class="p">,</span> <span class="n">presets</span><span class="p">,</span>
    <span class="n">params</span><span class="p">,</span> <span class="n">http</span><span class="p">,</span>
    <span class="n">get</span><span class="p">,</span> <span class="n">snapshot</span><span class="p">,</span>
    <span class="c1"># legacy alias (하위 호환)
</span>    <span class="n">profile</span> <span class="k">as</span> <span class="n">profile</span><span class="p">,</span> <span class="n">profiles</span> <span class="k">as</span> <span class="n">profiles</span><span class="p">,</span>
    <span class="n">endpoint</span> <span class="k">as</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">endpoints</span> <span class="k">as</span> <span class="n">endpoints</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="custom_nodescomfyui_config_readerconfig_singletonpy"><code class="language-plaintext highlighter-rouge">custom_nodes/comfyui_config_reader/config_singleton.py</code></h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">threading</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomllib</span>  <span class="c1"># py3.11+
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomllib</span><span class="p">.</span><span class="n">loads</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomli</span>     <span class="c1"># py3.10-
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomli</span><span class="p">.</span><span class="n">loads</span>

<span class="k">def</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="sh">""</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">${</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">"</span><span class="s">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">j</span><span class="p">],</span> <span class="sh">""</span><span class="p">);</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>  <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>  <span class="k">return</span> <span class="p">[</span><span class="nf">_expand_env</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">v</span>

<span class="k">def</span> <span class="nf">_norm</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="nf">str</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="nf">strip</span><span class="p">().</span><span class="nf">lower</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_deep_merge</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="n">b</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nf">_deep_merge</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="k">class</span> <span class="nc">_ReadOnlyConfig</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    - 읽기 전용 TOML (파일 쓰기 없음)
    - mtime + TTL(5~60s, 기본 30s) 자동 재로드 → 1분 내 변경 반영
    - 표준: [presets]; 레거시: [profiles], [endpoints] 자동 인식
    - preset 필수 필드: display_name, request_name, base_url, api_key
      + params(dict), http(dict: timeout_seconds, headers{}, query{})
    </span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># --- 내부 로딩 ---
</span>    <span class="k">def</span> <span class="nf">_read_text</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">,</span> <span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_presets_table</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">presets</span><span class="sh">"</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>   <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">presets</span><span class="sh">"</span><span class="p">]</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">profiles</span><span class="sh">"</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>  <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">profiles</span><span class="sh">"</span><span class="p">]</span>   <span class="c1"># legacy
</span>        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">endpoints</span><span class="sh">"</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span> <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">endpoints</span><span class="sh">"</span><span class="p">]</span>  <span class="c1"># legacy
</span>        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_build_index</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
        <span class="c1"># defaults
</span>        <span class="n">defaults</span> <span class="o">=</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">defaults</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">d_params</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">d_http</span>   <span class="o">=</span> <span class="n">defaults</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">)</span>   <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="sh">"</span><span class="s">headers</span><span class="sh">"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d_http</span><span class="p">:</span> <span class="n">d_http</span><span class="p">[</span><span class="sh">"</span><span class="s">headers</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="sh">"</span><span class="s">query</span><span class="sh">"</span>   <span class="ow">not</span> <span class="ow">in</span> <span class="n">d_http</span><span class="p">:</span> <span class="n">d_http</span><span class="p">[</span><span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">]</span>   <span class="o">=</span> <span class="p">{}</span>

        <span class="n">tbl</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_extract_presets_table</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">tbl</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="k">return</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">raw</span> <span class="ow">in</span> <span class="n">tbl</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="k">continue</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
            <span class="n">req</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]</span>
            <span class="k">if</span> <span class="nf">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cfg</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">k</span><span class="p">]).</span><span class="nf">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">req</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">p_params</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
            <span class="n">p_http</span>   <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">)</span>   <span class="ow">or</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="sh">"</span><span class="s">headers</span><span class="sh">"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p_http</span><span class="p">:</span> <span class="n">p_http</span><span class="p">[</span><span class="sh">"</span><span class="s">headers</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="sh">"</span><span class="s">query</span><span class="sh">"</span>   <span class="ow">not</span> <span class="ow">in</span> <span class="n">p_http</span><span class="p">:</span> <span class="n">p_http</span><span class="p">[</span><span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">]</span>   <span class="o">=</span> <span class="p">{}</span>

            <span class="n">merged_params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">d_params</span><span class="p">,</span> <span class="o">**</span><span class="n">p_params</span><span class="p">}</span>
            <span class="n">merged_http</span>   <span class="o">=</span> <span class="nf">_deep_merge</span><span class="p">(</span><span class="n">d_http</span><span class="p">,</span> <span class="n">p_http</span><span class="p">)</span>

            <span class="n">entry</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]),</span>
                <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">]),</span>
                <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span>     <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">]),</span>
                <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">:</span>      <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]),</span>
                <span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">:</span>       <span class="n">merged_params</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">:</span>         <span class="n">merged_http</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">{</span><span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span><span class="sh">""</span><span class="p">)),</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">,</span><span class="sh">""</span><span class="p">))}:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">[</span><span class="nf">_norm</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="o">=</span> <span class="n">entry</span>

    <span class="k">def</span> <span class="nf">_reload_locked</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_read_text</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nf">_TOML_LOADS</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nf">int</span><span class="p">((</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">settings</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">refresh_interval_seconds</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
        <span class="n">env_r</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env_r</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">r</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">env_r</span><span class="p">)))</span>
            <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span> <span class="k">pass</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span> <span class="o">=</span> <span class="n">r</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span> <span class="o">=</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_build_index</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">_stale_or_changed</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">m</span> <span class="o">!=</span> <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">&gt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ensure_loaded</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="nf">_stale_or_changed</span><span class="p">():</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>

    <span class="c1"># --- 퍼블릭 API ---
</span>    <span class="k">def</span> <span class="nf">preset</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sh">"</span><span class="s">preset key is empty</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_norm</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>
                <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_norm</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">preset not found: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hit</span>

    <span class="k">def</span> <span class="nf">presets</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">out</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">dn</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dn</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">seen</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">dn</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="n">dn</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span>     <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">:</span>       <span class="n">v</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}),</span>
                <span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">:</span>         <span class="n">v</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nf">dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">preset</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}))</span>

    <span class="k">def</span> <span class="nf">http</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nf">dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">preset</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}))</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dotted</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_raw</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">dotted</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">.</span><span class="sh">"</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="n">part</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">config path not found: </span><span class="si">{</span><span class="n">dotted</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cur</span>

    <span class="k">def</span> <span class="nf">snapshot</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="k">return</span> <span class="nf">dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>

<span class="c1"># ----- 싱글톤 -----
</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
<span class="n">_instance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ReadOnlyConfig</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">_default_path</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">_resolve_default_path</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_default_path</span> <span class="ow">or</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_PATH</span><span class="sh">"</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="sh">"</span><span class="s">config.toml</span><span class="sh">"</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_get_instance</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">_ReadOnlyConfig</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">_instance</span>
    <span class="k">if</span> <span class="n">_instance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_instance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">_instance</span> <span class="o">=</span> <span class="nf">_ReadOnlyConfig</span><span class="p">(</span><span class="nf">_resolve_default_path</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">_instance</span>

<span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">refresh_seconds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">_instance</span><span class="p">,</span> <span class="n">_default_path</span>
    <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">_default_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">refresh_seconds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sh">"</span><span class="s">COMFY_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">refresh_seconds</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">_lock</span><span class="p">:</span>
        <span class="n">_instance</span> <span class="o">=</span> <span class="nf">_ReadOnlyConfig</span><span class="p">(</span><span class="nf">_resolve_default_path</span><span class="p">())</span>

<span class="c1"># ---- 외부 API ----
</span><span class="k">def</span> <span class="nf">preset</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>     <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">preset</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">presets</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span> <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">presets</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>     <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">params</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">http</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>       <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">http</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">dotted</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>                <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">get</span><span class="p">(</span><span class="n">dotted</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">snapshot</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>           <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">snapshot</span><span class="p">()</span>

<span class="c1"># ---- 하위 호환 별칭 ----
</span><span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>    <span class="k">return</span> <span class="nf">preset</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">profiles</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span><span class="k">return</span> <span class="nf">presets</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>   <span class="k">return</span> <span class="nf">preset</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">endpoints</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span> <span class="k">return</span> <span class="nf">presets</span><span class="p">()</span>

<span class="c1"># ---- 객체형 프록시 ----
</span><span class="k">class</span> <span class="nc">_ConfigProxy</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="nf">getattr</span><span class="p">(</span><span class="nf">_get_instance</span><span class="p">(),</span> <span class="n">name</span><span class="p">)</span>
<span class="n">CONFIG</span> <span class="o">=</span> <span class="nf">_ConfigProxy</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h1 id="4-원하면-comfyui-노드도-용어-맞춰-변경">4) (원하면) ComfyUI 노드도 용어 맞춰 변경</h1>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ConfigPresetLookup</code> : <code class="language-plaintext highlighter-rouge">display_name</code>, <code class="language-plaintext highlighter-rouge">request_name</code>, <code class="language-plaintext highlighter-rouge">base_url</code>, <code class="language-plaintext highlighter-rouge">api_key</code>, <code class="language-plaintext highlighter-rouge">params(json)</code>, <code class="language-plaintext highlighter-rouge">http(json)</code> 출력</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ConfigListPresets</code> : 모든 프리셋 JSON</p>
  </li>
</ul>

<p>원하시면 바로 생성해 줄게.</p>

<hr />

<h1 id="5-마이그레이션-정리">5) 마이그레이션 정리</h1>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">profile(s)</code> / <code class="language-plaintext highlighter-rouge">endpoint(s)</code> 호출 코드는 그대로 동작(별칭 제공).</p>
  </li>
  <li>
    <p>설정 파일에서 <code class="language-plaintext highlighter-rouge">[profiles]</code>/<code class="language-plaintext highlighter-rouge">[endpoints]</code> 유지해도 인식하지만, 앞으로는 <strong><code class="language-plaintext highlighter-rouge">[presets]</code> 권장</strong>.</p>
  </li>
  <li>
    <p>모델 파라미터/HTTP 옵션은 프리셋 내부(<code class="language-plaintext highlighter-rouge">params</code>/<code class="language-plaintext highlighter-rouge">http</code>)에 넣으면 되고, 공통값은 <code class="language-plaintext highlighter-rouge">defaults</code>에 두면 자동 병합돼.</p>
  </li>
</ul>

<hr />

<p>필요하면 “preset” 대신 <strong><code class="language-plaintext highlighter-rouge">deployment</code></strong> , <strong><code class="language-plaintext highlighter-rouge">model_preset</code></strong> 같은 더 구체적인 대안도 줄 수 있어. 하지만 <em>모델 호출용 세팅 묶음</em> 이라는 관점에서 사용자/오퍼레이터 모두에게 가장 익숙하고 짧은 용어는 “preset”이라 이걸 기본 권장으로 뒀어.</p>

<p class="chat--user">

아니 llm endpoint 라는 느낌이 전혀 안들어서

</p>

<p>오케이—“LLM 엔드포인트” 느낌을 확실히 주도록 <strong>용어를 <code class="language-plaintext highlighter-rouge">llm_endpoints</code></strong>로 표준화했어요.<br />
(이전 <code class="language-plaintext highlighter-rouge">presets</code>/<code class="language-plaintext highlighter-rouge">profiles</code>/<code class="language-plaintext highlighter-rouge">endpoints</code>는 <strong>자동 하위 호환</strong> 으로 계속 읽습니다.)</p>

<p>아래 두 파일만 교체하면 끝! 외부에서는 <code class="language-plaintext highlighter-rouge">llm_endpoint(...)</code>, <code class="language-plaintext highlighter-rouge">llm_params(...)</code> 같은 이름으로 바로 씁니다.</p>

<hr />

<h1 id="1-스키마-configtoml">1) 스키마 (config.toml)</h1>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">version</span> <span class="p">=</span> <span class="mi">1</span>

<span class="nn">[settings]</span>
<span class="c"># 파일 변경 감지 주기(초) — 5~60 권장. "1분 이내 반영" 요건 충족.</span>
<span class="py">refresh_interval_seconds</span> <span class="p">=</span> <span class="mi">30</span>

<span class="c"># 공통 기본값(선택): 모든 LLM 엔드포인트에 병합됨</span>
<span class="nn">[defaults.params]</span>
<span class="py">temperature</span> <span class="p">=</span> <span class="mf">0.3</span>
<span class="py">max_tokens</span>  <span class="p">=</span> <span class="mi">2048</span>

<span class="nn">[defaults.http]</span>
<span class="py">timeout_seconds</span> <span class="p">=</span> <span class="mi">30</span>
<span class="nn">[defaults.http.headers]</span>
<span class="py">User-Agent</span> <span class="p">=</span> <span class="s">"ComfyUI-ConfigReader/1.0"</span>

<span class="c"># ── LLM 엔드포인트들 ─────────────────────────────────────────</span>
<span class="nn">[llm_endpoints."gpt-4o-mini-a"]</span>
<span class="py">display_name</span> <span class="p">=</span> <span class="s">"OpenAI GPT-4o mini A"</span>
<span class="py">model</span>        <span class="p">=</span> <span class="s">"gpt-4o-mini"</span>             <span class="c"># (= request_name 별칭)</span>
<span class="py">base_url</span>     <span class="p">=</span> <span class="s">"https://api.openai.com/v1"</span>
<span class="py">api_key</span>      <span class="p">=</span> <span class="s">"${OPENAI_API_KEY}"</span>

<span class="nn">[llm_endpoints."gpt-4o-mini-a".params]</span>
<span class="py">temperature</span> <span class="p">=</span> <span class="mf">0.2</span>
<span class="py">top_p</span>       <span class="p">=</span> <span class="mf">0.9</span>

<span class="nn">[llm_endpoints."gpt-4o-mini-a".http]</span>
<span class="py">timeout_seconds</span> <span class="p">=</span> <span class="mi">20</span>
<span class="nn">[llm_endpoints."gpt-4o-mini-a".http.headers]</span>
<span class="py">X-Org-Id</span> <span class="p">=</span> <span class="s">"${ORG_ID}"</span>

<span class="nn">[llm_endpoints."claude-sonnet"]</span>
<span class="py">display_name</span> <span class="p">=</span> <span class="s">"Anthropic Claude 3.5 Sonnet"</span>
<span class="py">model</span>        <span class="p">=</span> <span class="s">"claude-3-5-sonnet"</span>
<span class="py">base_url</span>     <span class="p">=</span> <span class="s">"https://api.anthropic.com"</span>
<span class="py">api_key</span>      <span class="p">=</span> <span class="s">"${ANTHROPIC_API_KEY}"</span>

<span class="c"># ── 다른 일반 설정도 자유롭게 ────────────────────────────────</span>
<span class="nn">[feature_flags]</span>
<span class="py">use_cache</span> <span class="p">=</span> <span class="kc">true</span>
</code></pre></div></div>

<ul>
  <li>
    <p>필수: <code class="language-plaintext highlighter-rouge">display_name</code>, <code class="language-plaintext highlighter-rouge">model(=request_name)</code>, <code class="language-plaintext highlighter-rouge">base_url</code>, <code class="language-plaintext highlighter-rouge">api_key</code></p>
  </li>
  <li>
    <p>선택: <code class="language-plaintext highlighter-rouge">params</code>(모델 파라미터), <code class="language-plaintext highlighter-rouge">http</code>(timeout/headers/query 등)</p>
  </li>
  <li>
    <p><strong>병합 규칙</strong> : <code class="language-plaintext highlighter-rouge">defaults.params</code>/<code class="language-plaintext highlighter-rouge">defaults.http</code> → 각 엔드포인트의 <code class="language-plaintext highlighter-rouge">params</code>/<code class="language-plaintext highlighter-rouge">http</code>에 <strong>덮어쓰기 병합</strong></p>
  </li>
</ul>

<blockquote>
  <p>하위 호환: <code class="language-plaintext highlighter-rouge">[presets]</code>, <code class="language-plaintext highlighter-rouge">[profiles]</code>, <code class="language-plaintext highlighter-rouge">[endpoints]</code>도 자동 인식합니다.<br />
 필드도 <code class="language-plaintext highlighter-rouge">request_name</code>/<code class="language-plaintext highlighter-rouge">request_model</code>/<code class="language-plaintext highlighter-rouge">model</code> 중 아무거나 써도 OK(내부에서 <code class="language-plaintext highlighter-rouge">model</code>로 통일).</p>
</blockquote>

<hr />

<h1 id="2-외부-접근-api-싱글톤-직관적">2) 외부 접근 API (싱글톤, 직관적)</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">comfyui_config_reader</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">llm_endpoint</span><span class="p">,</span> <span class="n">llm_endpoints</span><span class="p">,</span>   <span class="c1"># 메타 + 연결 정보
</span>    <span class="n">llm_params</span><span class="p">,</span> <span class="n">llm_http</span><span class="p">,</span>          <span class="c1"># 모델 파라미터 / HTTP 옵션만
</span>    <span class="n">get</span><span class="p">,</span> <span class="n">CONFIG</span><span class="p">,</span>                   <span class="c1"># 범용 키 접근 / 객체형 접근
</span><span class="p">)</span>
</code></pre></div></div>

<p>사용 예:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cfg</span> <span class="o">=</span> <span class="nf">llm_endpoint</span><span class="p">(</span><span class="sh">"</span><span class="s">gpt-4o-mini-a</span><span class="sh">"</span><span class="p">)</span>     <span class="c1"># 키 / display_name / model 아무거나
</span><span class="n">api_key</span>  <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]</span>
<span class="n">base_url</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">]</span>
<span class="n">model</span>    <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">]</span>
<span class="n">params</span>   <span class="o">=</span> <span class="nf">llm_params</span><span class="p">(</span><span class="sh">"</span><span class="s">gpt-4o-mini-a</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># {"temperature": 0.2, "top_p": 0.9, ...}
</span><span class="n">http</span>     <span class="o">=</span> <span class="nf">llm_http</span><span class="p">(</span><span class="sh">"</span><span class="s">gpt-4o-mini-a</span><span class="sh">"</span><span class="p">)</span>    <span class="c1"># {"timeout_seconds": ..., "headers": {...}, ...}
</span>
<span class="c1"># 범용 설정
</span><span class="n">use_cache</span> <span class="o">=</span> <span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">feature_flags.use_cache</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h1 id="3-드롭인-교체-코드-1">3) 드롭인 교체 코드</h1>

<h2 id="custom_nodescomfyui_config_reader__init__py-1"><code class="language-plaintext highlighter-rouge">custom_nodes/comfyui_config_reader/__init__.py</code></h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">.config_singleton</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CONFIG</span><span class="p">,</span>
    <span class="n">configure</span><span class="p">,</span>
    <span class="n">llm_endpoint</span><span class="p">,</span> <span class="n">llm_endpoints</span><span class="p">,</span>
    <span class="n">llm_params</span><span class="p">,</span> <span class="n">llm_http</span><span class="p">,</span>
    <span class="n">get</span><span class="p">,</span> <span class="n">snapshot</span><span class="p">,</span>
    <span class="c1"># legacy alias (하위 호환)
</span>    <span class="n">preset</span> <span class="k">as</span> <span class="n">preset</span><span class="p">,</span> <span class="n">presets</span> <span class="k">as</span> <span class="n">presets</span><span class="p">,</span>
    <span class="n">profile</span> <span class="k">as</span> <span class="n">profile</span><span class="p">,</span> <span class="n">profiles</span> <span class="k">as</span> <span class="n">profiles</span><span class="p">,</span>
    <span class="n">endpoint</span> <span class="k">as</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">endpoints</span> <span class="k">as</span> <span class="n">endpoints</span><span class="p">,</span>
    <span class="n">params</span> <span class="k">as</span> <span class="n">params</span><span class="p">,</span> <span class="n">http</span> <span class="k">as</span> <span class="n">http</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="custom_nodescomfyui_config_readerconfig_singletonpy-1"><code class="language-plaintext highlighter-rouge">custom_nodes/comfyui_config_reader/config_singleton.py</code></h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">threading</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomllib</span>  <span class="c1"># py3.11+
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomllib</span><span class="p">.</span><span class="n">loads</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomli</span>     <span class="c1"># py3.10-
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomli</span><span class="p">.</span><span class="n">loads</span>

<span class="k">def</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="sh">""</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">${</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">"</span><span class="s">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">j</span><span class="p">],</span> <span class="sh">""</span><span class="p">);</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>  <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>  <span class="k">return</span> <span class="p">[</span><span class="nf">_expand_env</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">v</span>

<span class="k">def</span> <span class="nf">_norm</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="nf">str</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="nf">strip</span><span class="p">().</span><span class="nf">lower</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_deep_merge</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="n">b</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nf">_deep_merge</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="c1"># --- 필드 별칭 정규화 (model / request_name / request_model) ---
</span><span class="k">def</span> <span class="nf">_normalize_model_field</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">cfg</span> <span class="ow">and</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">k</span><span class="p">]).</span><span class="nf">strip</span><span class="p">():</span>
            <span class="k">return</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">k</span><span class="p">]).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="sh">""</span>

<span class="k">class</span> <span class="nc">_ReadOnlyConfig</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    - 읽기 전용 TOML
    - mtime + TTL(5~60s, 기본 30s) 자동 재로드 → 1분 내 변경 반영
    - 표준 섹션: [llm_endpoints]
      (하위 호환: [presets], [profiles], [endpoints] 도 자동 인식)
    - 각 엔드포인트:
        * display_name, model(=request_name/… 별칭), base_url, api_key
        * params(dict), http(dict: timeout_seconds, headers{}, query{})
    </span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># --- 내부 로딩 ---
</span>    <span class="k">def</span> <span class="nf">_read_text</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">,</span> <span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_llm_table</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="c1"># 1순위 표준
</span>        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">llm_endpoints</span><span class="sh">"</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span> <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">llm_endpoints</span><span class="sh">"</span><span class="p">]</span>
        <span class="c1"># 하위 호환
</span>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">presets</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">profiles</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">endpoints</span><span class="sh">"</span><span class="p">):</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span> <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_build_index</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>

        <span class="c1"># defaults
</span>        <span class="n">defaults</span> <span class="o">=</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">defaults</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">d_params</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">d_http</span>   <span class="o">=</span> <span class="n">defaults</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">)</span>   <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="sh">"</span><span class="s">headers</span><span class="sh">"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d_http</span><span class="p">:</span> <span class="n">d_http</span><span class="p">[</span><span class="sh">"</span><span class="s">headers</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="sh">"</span><span class="s">query</span><span class="sh">"</span>   <span class="ow">not</span> <span class="ow">in</span> <span class="n">d_http</span><span class="p">:</span> <span class="n">d_http</span><span class="p">[</span><span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">]</span>   <span class="o">=</span> <span class="p">{}</span>

        <span class="n">tbl</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_extract_llm_table</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">tbl</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="k">return</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">raw</span> <span class="ow">in</span> <span class="n">tbl</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="k">continue</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>

            <span class="n">display</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)).</span><span class="nf">strip</span><span class="p">()</span>
            <span class="n">model</span>   <span class="o">=</span> <span class="nf">_normalize_model_field</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
            <span class="n">base</span>    <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)).</span><span class="nf">strip</span><span class="p">()</span>
            <span class="n">api</span>     <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)).</span><span class="nf">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">display</span> <span class="ow">and</span> <span class="n">model</span> <span class="ow">and</span> <span class="n">base</span> <span class="ow">and</span> <span class="n">api</span><span class="p">):</span>
                <span class="k">continue</span>  <span class="c1"># 필수 누락은 스킵
</span>
            <span class="n">p_params</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
            <span class="n">p_http</span>   <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">)</span>   <span class="ow">or</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="sh">"</span><span class="s">headers</span><span class="sh">"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p_http</span><span class="p">:</span> <span class="n">p_http</span><span class="p">[</span><span class="sh">"</span><span class="s">headers</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="sh">"</span><span class="s">query</span><span class="sh">"</span>   <span class="ow">not</span> <span class="ow">in</span> <span class="n">p_http</span><span class="p">:</span> <span class="n">p_http</span><span class="p">[</span><span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">]</span>   <span class="o">=</span> <span class="p">{}</span>

            <span class="n">merged_params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">d_params</span><span class="p">,</span> <span class="o">**</span><span class="n">p_params</span><span class="p">}</span>
            <span class="n">merged_http</span>   <span class="o">=</span> <span class="nf">_deep_merge</span><span class="p">(</span><span class="n">d_http</span><span class="p">,</span> <span class="n">p_http</span><span class="p">)</span>

            <span class="n">entry</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">display</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">:</span>        <span class="n">model</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span>     <span class="n">base</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">:</span>      <span class="n">api</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">:</span>       <span class="n">merged_params</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">:</span>         <span class="n">merged_http</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="c1"># 접근 키: 정의 키 / display_name / model
</span>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">{</span><span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">display</span><span class="p">,</span> <span class="n">model</span><span class="p">}:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">[</span><span class="nf">_norm</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="o">=</span> <span class="n">entry</span>

    <span class="k">def</span> <span class="nf">_reload_locked</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_read_text</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nf">_TOML_LOADS</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nf">int</span><span class="p">((</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">settings</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">refresh_interval_seconds</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
        <span class="n">env_r</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env_r</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">r</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">env_r</span><span class="p">)))</span>
            <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span> <span class="k">pass</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span> <span class="o">=</span> <span class="n">r</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span> <span class="o">=</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_build_index</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">_stale_or_changed</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">m</span> <span class="o">!=</span> <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">&gt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ensure_loaded</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="nf">_stale_or_changed</span><span class="p">():</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>

    <span class="c1"># --- 퍼블릭 API ---
</span>    <span class="k">def</span> <span class="nf">llm_endpoint</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sh">"</span><span class="s">llm_endpoint key is empty</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_norm</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>
                <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_norm</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">llm_endpoint not found: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hit</span>

    <span class="k">def</span> <span class="nf">llm_endpoints</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">out</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">dn</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dn</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">seen</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">dn</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="n">dn</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">:</span>        <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span>     <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">:</span>       <span class="n">v</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}),</span>
                <span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">:</span>         <span class="n">v</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">llm_params</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nf">dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">llm_endpoint</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}))</span>

    <span class="k">def</span> <span class="nf">llm_http</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nf">dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">llm_endpoint</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}))</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dotted</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_raw</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">dotted</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">.</span><span class="sh">"</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="n">part</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">config path not found: </span><span class="si">{</span><span class="n">dotted</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cur</span>

    <span class="k">def</span> <span class="nf">snapshot</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="k">return</span> <span class="nf">dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>

<span class="c1"># ----- 싱글톤 -----
</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
<span class="n">_instance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ReadOnlyConfig</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">_default_path</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">_resolve_default_path</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_default_path</span> <span class="ow">or</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_PATH</span><span class="sh">"</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="sh">"</span><span class="s">config.toml</span><span class="sh">"</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_get_instance</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">_ReadOnlyConfig</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">_instance</span>
    <span class="k">if</span> <span class="n">_instance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_instance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">_instance</span> <span class="o">=</span> <span class="nf">_ReadOnlyConfig</span><span class="p">(</span><span class="nf">_resolve_default_path</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">_instance</span>

<span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">refresh_seconds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">_instance</span><span class="p">,</span> <span class="n">_default_path</span>
    <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">_default_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">refresh_seconds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sh">"</span><span class="s">COMFY_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">refresh_seconds</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">_lock</span><span class="p">:</span>
        <span class="n">_instance</span> <span class="o">=</span> <span class="nf">_ReadOnlyConfig</span><span class="p">(</span><span class="nf">_resolve_default_path</span><span class="p">())</span>

<span class="c1"># ---- 외부 API ----
</span><span class="k">def</span> <span class="nf">llm_endpoint</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>     <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">llm_endpoint</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">llm_endpoints</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span> <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">llm_endpoints</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">llm_params</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>       <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">llm_params</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">llm_http</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>         <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">llm_http</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">dotted</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>                      <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">get</span><span class="p">(</span><span class="n">dotted</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">snapshot</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>                 <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">snapshot</span><span class="p">()</span>

<span class="c1"># ---- 하위 호환 별칭 (필요 시 기존 코드 그대로 동작) ----
</span><span class="k">def</span> <span class="nf">preset</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span>   <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>         <span class="k">return</span> <span class="nf">llm_endpoint</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">presets</span><span class="p">()</span>          <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span> <span class="k">return</span> <span class="nf">llm_endpoints</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span>  <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>         <span class="k">return</span> <span class="nf">llm_endpoint</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">profiles</span><span class="p">()</span>         <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span> <span class="k">return</span> <span class="nf">llm_endpoints</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>         <span class="k">return</span> <span class="nf">llm_endpoint</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">endpoints</span><span class="p">()</span>        <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span> <span class="k">return</span> <span class="nf">llm_endpoints</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span>   <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>         <span class="k">return</span> <span class="nf">llm_params</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">http</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span>     <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>         <span class="k">return</span> <span class="nf">llm_http</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="c1"># ---- 객체형 프록시 ----
</span><span class="k">class</span> <span class="nc">_ConfigProxy</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="nf">getattr</span><span class="p">(</span><span class="nf">_get_instance</span><span class="p">(),</span> <span class="n">name</span><span class="p">)</span>
<span class="n">CONFIG</span> <span class="o">=</span> <span class="nf">_ConfigProxy</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h1 id="4-왜-이게-좋은가-짧게">4) 왜 이게 좋은가 (짧게)</h1>

<ul>
  <li>
    <p>이름부터 <strong>LLM 엔드포인트</strong> 임이 분명 (<code class="language-plaintext highlighter-rouge">llm_endpoints</code>)</p>
  </li>
  <li>
    <p>모델 파라미터/HTTP 옵션을 <strong>같은 묶음</strong> 에서 관리 (<code class="language-plaintext highlighter-rouge">params</code>, <code class="language-plaintext highlighter-rouge">http</code>)</p>
  </li>
  <li>
    <p>기존 설정/코드 <strong>안 깨짐</strong>(자동 호환)</p>
  </li>
  <li>
    <p>읽기 전용 + mtime/TTL(5~60s)로 <strong>최대 1분 내 변경 반영</strong></p>
  </li>
  <li>
    <p>외부 사용은 <strong>한 줄 임포트</strong> 로 끝: <code class="language-plaintext highlighter-rouge">llm_endpoint("...")</code></p>
  </li>
</ul>

<p>원하면 ComfyUI 노드 이름도 <code class="language-plaintext highlighter-rouge">Config: LLM Endpoint Lookup</code>, <code class="language-plaintext highlighter-rouge">Config: List LLM Endpoints</code>로 맞춰서 출력(파라미터/HTTP JSON 포함) 버전까지 바로 만들어줄게!</p>

<p class="chat--user">

api_providers display_name, model_id, base_url, api_key 이걸로 해줘.

</p>

<p>좋아! <strong>이름은<code class="language-plaintext highlighter-rouge">api_providers</code></strong>, 필드는 <strong><code class="language-plaintext highlighter-rouge">display_name</code>, <code class="language-plaintext highlighter-rouge">model_id</code>, <code class="language-plaintext highlighter-rouge">base_url</code>, <code class="language-plaintext highlighter-rouge">api_key</code></strong>로 딱 맞춰서 정리했어.<br />
(읽기 전용 · 최대 1분 내 변경 반영 · 다른 노드/파일에서 한 줄로 접근)</p>

<p>아래 코드/예시 그대로 교체하면 동작해.</p>

<hr />

<h1 id="1-configtoml-스키마">1) <code class="language-plaintext highlighter-rouge">config.toml</code> 스키마</h1>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">version</span> <span class="p">=</span> <span class="mi">1</span>

<span class="nn">[settings]</span>
<span class="c"># 파일 변경 감지 주기(초) — 5~60 권장. "1분 이내 반영" 요건 충족.</span>
<span class="py">refresh_interval_seconds</span> <span class="p">=</span> <span class="mi">30</span>

<span class="c"># ── API Providers ─────────────────────────────────────</span>
<span class="nn">[api_providers."openai-mini"]</span>
<span class="py">display_name</span> <span class="p">=</span> <span class="s">"OpenAI GPT-4o mini"</span>
<span class="py">model_id</span>     <span class="p">=</span> <span class="s">"gpt-4o-mini"</span>
<span class="py">base_url</span>     <span class="p">=</span> <span class="s">"https://api.openai.com/v1"</span>
<span class="py">api_key</span>      <span class="p">=</span> <span class="s">"${OPENAI_API_KEY}"</span>

<span class="nn">[api_providers."anthropic-sonnet"]</span>
<span class="py">display_name</span> <span class="p">=</span> <span class="s">"Anthropic Claude 3.5 Sonnet"</span>
<span class="py">model_id</span>     <span class="p">=</span> <span class="s">"claude-3-5-sonnet"</span>
<span class="py">base_url</span>     <span class="p">=</span> <span class="s">"https://api.anthropic.com"</span>
<span class="py">api_key</span>      <span class="p">=</span> <span class="s">"${ANTHROPIC_API_KEY}"</span>

<span class="c"># ── 다른 범용 설정도 자유롭게 ─────────────────────────</span>
<span class="nn">[feature_flags]</span>
<span class="py">use_cache</span> <span class="p">=</span> <span class="kc">true</span>
</code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">${ENV}</code> 표기는 환경변수로 치환.</p>
  </li>
  <li>
    <p>조회 키는 <strong>정의 키 /<code class="language-plaintext highlighter-rouge">display_name</code> / <code class="language-plaintext highlighter-rouge">model_id</code></strong> 중 아무거나 사용 가능.</p>
  </li>
</ul>

<hr />

<h1 id="2-외부에서-쓰는-법-싱글톤-한-줄">2) 외부에서 쓰는 법 (싱글톤, 한 줄)</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">comfyui_config_reader</span> <span class="kn">import</span> <span class="n">api_provider</span><span class="p">,</span> <span class="n">api_providers</span><span class="p">,</span> <span class="n">get</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="nf">api_provider</span><span class="p">(</span><span class="sh">"</span><span class="s">openai-mini</span><span class="sh">"</span><span class="p">)</span>   <span class="c1"># 또는 "OpenAI GPT-4o mini" / "gpt-4o-mini"
</span><span class="n">api_key</span>  <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]</span>
<span class="n">base_url</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">]</span>
<span class="n">model_id</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">model_id</span><span class="sh">"</span><span class="p">]</span>

<span class="n">listing</span> <span class="o">=</span> <span class="nf">api_providers</span><span class="p">()</span>           <span class="c1"># {display_name: {display_name, model_id, base_url}}
</span><span class="n">use_cache</span> <span class="o">=</span> <span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">feature_flags.use_cache</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p>선택(초기화 시 한 번):</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">comfyui_config_reader</span> <span class="kn">import</span> <span class="n">configure</span>
<span class="nf">configure</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="sh">"</span><span class="s">/abs/path/to/config.toml</span><span class="sh">"</span><span class="p">,</span> <span class="n">refresh_seconds</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>  <span class="c1"># 5~60
</span></code></pre></div></div>

<hr />

<h1 id="3-드롭인-코드">3) 드롭인 코드</h1>

<h2 id="custom_nodescomfyui_config_reader__init__py-2"><code class="language-plaintext highlighter-rouge">custom_nodes/comfyui_config_reader/__init__.py</code></h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">.config_singleton</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CONFIG</span><span class="p">,</span>
    <span class="n">configure</span><span class="p">,</span>
    <span class="n">api_provider</span><span class="p">,</span> <span class="n">api_providers</span><span class="p">,</span>
    <span class="n">get</span><span class="p">,</span> <span class="n">snapshot</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="custom_nodescomfyui_config_readerconfig_singletonpy-2"><code class="language-plaintext highlighter-rouge">custom_nodes/comfyui_config_reader/config_singleton.py</code></h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">threading</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomllib</span>  <span class="c1"># py3.11+
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomllib</span><span class="p">.</span><span class="n">loads</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomli</span>     <span class="c1"># py3.10-
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomli</span><span class="p">.</span><span class="n">loads</span>

<span class="k">def</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="sh">""</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">${</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">"</span><span class="s">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">j</span><span class="p">],</span> <span class="sh">""</span><span class="p">);</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>  <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>  <span class="k">return</span> <span class="p">[</span><span class="nf">_expand_env</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">v</span>

<span class="k">def</span> <span class="nf">_norm</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="nf">str</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="nf">strip</span><span class="p">().</span><span class="nf">lower</span><span class="p">()</span>

<span class="c1"># 레거시 필드 호환: model_id 대신 model/request_name/request_model 이 들어와도 인식
</span><span class="k">def</span> <span class="nf">_normalize_model_id</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">model_id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">cfg</span> <span class="ow">and</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">k</span><span class="p">]).</span><span class="nf">strip</span><span class="p">():</span>
            <span class="k">return</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">k</span><span class="p">]).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="sh">""</span>

<span class="k">class</span> <span class="nc">_ReadOnlyConfig</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    - 읽기 전용 TOML 로더 (파일 쓰기 없음)
    - mtime + TTL(5~60s, 기본 30s) 자동 재로드 → 1분 내 변경 반영
    - 표준 섹션: [api_providers]
      (참고: 원하면 하위 호환 섹션을 추가로 인식하도록 확장 가능)
    - 각 provider 필수 필드: display_name, model_id, base_url, api_key
    </span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># --- 내부 로딩 ---
</span>    <span class="k">def</span> <span class="nf">_read_text</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">,</span> <span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_providers_table</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">tbl</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">api_providers</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tbl</span> <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">tbl</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_build_index</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
        <span class="n">tbl</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_providers_table</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">tbl</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="k">return</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">raw</span> <span class="ow">in</span> <span class="n">tbl</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="k">continue</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>

            <span class="n">display</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)).</span><span class="nf">strip</span><span class="p">()</span>
            <span class="n">model</span>   <span class="o">=</span> <span class="nf">_normalize_model_id</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
            <span class="n">base</span>    <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)).</span><span class="nf">strip</span><span class="p">()</span>
            <span class="n">api</span>     <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)).</span><span class="nf">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">display</span> <span class="ow">and</span> <span class="n">model</span> <span class="ow">and</span> <span class="n">base</span> <span class="ow">and</span> <span class="n">api</span><span class="p">):</span>
                <span class="k">continue</span>  <span class="c1"># 필수 누락은 스킵
</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">display</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">model_id</span><span class="sh">"</span><span class="p">:</span>     <span class="n">model</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span>     <span class="n">base</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">:</span>      <span class="n">api</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="c1"># 접근 키: 정의 키 / display_name / model_id
</span>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">{</span><span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">display</span><span class="p">,</span> <span class="n">model</span><span class="p">}:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">[</span><span class="nf">_norm</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="o">=</span> <span class="n">entry</span>

    <span class="k">def</span> <span class="nf">_reload_locked</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_read_text</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nf">_TOML_LOADS</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="nf">int</span><span class="p">((</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">settings</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">refresh_interval_seconds</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
        <span class="n">env_r</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env_r</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">r</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">env_r</span><span class="p">)))</span>
            <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span> <span class="k">pass</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span> <span class="o">=</span> <span class="n">r</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span> <span class="o">=</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_build_index</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">_stale_or_changed</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">m</span> <span class="o">!=</span> <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">&gt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ensure_loaded</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="nf">_stale_or_changed</span><span class="p">():</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>

    <span class="c1"># --- 퍼블릭 API ---
</span>    <span class="k">def</span> <span class="nf">api_provider</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sh">"</span><span class="s">api_provider key is empty</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_norm</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>
                <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_norm</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">api_provider not found: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hit</span>

    <span class="k">def</span> <span class="nf">api_providers</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="sh">"""</span><span class="s">API Key는 목록에선 숨김.</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">out</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">dn</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dn</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">seen</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">dn</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="n">dn</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">model_id</span><span class="sh">"</span><span class="p">:</span>     <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">model_id</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span>     <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dotted</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_raw</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">dotted</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">.</span><span class="sh">"</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="n">part</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">config path not found: </span><span class="si">{</span><span class="n">dotted</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cur</span>

    <span class="k">def</span> <span class="nf">snapshot</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="k">return</span> <span class="nf">dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>

<span class="c1"># ----- 싱글톤 -----
</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
<span class="n">_instance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ReadOnlyConfig</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">_default_path</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">_resolve_default_path</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_default_path</span> <span class="ow">or</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_PATH</span><span class="sh">"</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="sh">"</span><span class="s">config.toml</span><span class="sh">"</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_get_instance</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">_ReadOnlyConfig</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">_instance</span>
    <span class="k">if</span> <span class="n">_instance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_instance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">_instance</span> <span class="o">=</span> <span class="nf">_ReadOnlyConfig</span><span class="p">(</span><span class="nf">_resolve_default_path</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">_instance</span>

<span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">refresh_seconds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">_instance</span><span class="p">,</span> <span class="n">_default_path</span>
    <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">_default_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">refresh_seconds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sh">"</span><span class="s">COMFY_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">refresh_seconds</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">_lock</span><span class="p">:</span>
        <span class="n">_instance</span> <span class="o">=</span> <span class="nf">_ReadOnlyConfig</span><span class="p">(</span><span class="nf">_resolve_default_path</span><span class="p">())</span>

<span class="c1"># ---- 외부 API ----
</span><span class="k">def</span> <span class="nf">api_provider</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>         <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">api_provider</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">api_providers</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>     <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">api_providers</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">dotted</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>                          <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">get</span><span class="p">(</span><span class="n">dotted</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">snapshot</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>                     <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">snapshot</span><span class="p">()</span>

<span class="c1"># ---- 객체형 프록시 ----
</span><span class="k">class</span> <span class="nc">_ConfigProxy</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="nf">getattr</span><span class="p">(</span><span class="nf">_get_instance</span><span class="p">(),</span> <span class="n">name</span><span class="p">)</span>
<span class="n">CONFIG</span> <span class="o">=</span> <span class="nf">_ConfigProxy</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h1 id="4-선택-comfyui-노드도-용어-맞춰-제공">4) (선택) ComfyUI 노드도 용어 맞춰 제공</h1>

<p>원한다면 <code class="language-plaintext highlighter-rouge">custom_nodes/comfyui_config_reader/config_nodes.py</code>에 아래처럼:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">.config_singleton</span> <span class="kn">import</span> <span class="n">api_provider</span><span class="p">,</span> <span class="n">api_providers</span>
<span class="kn">import</span> <span class="n">json</span>

<span class="k">class</span> <span class="nc">ConfigAPIProviderLookup</span><span class="p">:</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">INPUT_TYPES</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">required</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="sh">"</span><span class="s">default</span><span class="sh">"</span><span class="p">:</span> <span class="sh">""</span><span class="p">,</span> <span class="sh">"</span><span class="s">multiline</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">})}}</span>
    <span class="n">RETURN_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">RETURN_NAMES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">model_id</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="sh">"</span><span class="s">lookup</span><span class="sh">"</span>
    <span class="n">CATEGORY</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Config/API Providers (ReadOnly)</span><span class="sh">"</span>
    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nf">api_provider</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="sh">"</span><span class="s">model_id</span><span class="sh">"</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">])</span>

<span class="k">class</span> <span class="nc">ConfigListAPIProviders</span><span class="p">:</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">INPUT_TYPES</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">required</span><span class="sh">"</span><span class="p">:</span> <span class="p">{}}</span>
    <span class="n">RETURN_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">STRING</span><span class="sh">"</span><span class="p">,)</span>
    <span class="n">RETURN_NAMES</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">providers_json</span><span class="sh">"</span><span class="p">,)</span>
    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="sh">"</span><span class="s">list_providers</span><span class="sh">"</span>
    <span class="n">CATEGORY</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Config/API Providers (ReadOnly)</span><span class="sh">"</span>
    <span class="k">def</span> <span class="nf">list_providers</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="nf">api_providers</span><span class="p">(),</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">),)</span>

<span class="n">NODE_CLASS_MAPPINGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">ConfigAPIProviderLookup</span><span class="sh">"</span><span class="p">:</span> <span class="n">ConfigAPIProviderLookup</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">ConfigListAPIProviders</span><span class="sh">"</span><span class="p">:</span>  <span class="n">ConfigListAPIProviders</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">NODE_DISPLAY_NAME_MAPPINGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">ConfigAPIProviderLookup</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Config: API Provider Lookup</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">ConfigListAPIProviders</span><span class="sh">"</span><span class="p">:</span>  <span class="sh">"</span><span class="s">Config: List API Providers</span><span class="sh">"</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h1 id="5-체크리스트">5) 체크리스트</h1>

<ul>
  <li>
    <p>✅ 섹션/필드명: <strong><code class="language-plaintext highlighter-rouge">api_providers</code> / (display_name, model_id, base_url, api_key)</strong></p>
  </li>
  <li>
    <p>✅ 읽기 전용 + 파일 변경 <strong>최대 1분 내 반영</strong> (mtime + TTL 5~60, 기본 30)</p>
  </li>
  <li>
    <p>✅ 어디서든 간단 접근: <code class="language-plaintext highlighter-rouge">api_provider("키|표시명|model_id")</code></p>
  </li>
  <li>
    <p>✅ 사람이 편집 쉬운 TOML + <code class="language-plaintext highlighter-rouge">${ENV}</code> 치환</p>
  </li>
  <li>
    <p>✅ 목록 노드는 <strong>api_key 비노출</strong></p>
  </li>
</ul>

<p>필요하면, 기존 워크플로우(노드 그래프)에서 자동으로 이 이름들로 바꿔주는 스크립트도 만들어줄게.</p>

<p class="chat--user">

아 params도 포함해줘. 그런데 [api_providers."anthropic-sonnet"] 이 안에 parameters를 dictionary로 넣을 수 없나? 따로 항목을 빼니까 보기가 불편한데 이런건 yaml에서만 가능?

</p>

<p>좋아, <strong>TOML에서도 딕셔너리(맵)를 한 섹션 안에</strong> 넣을 수 있어.<br />
YAML만 되는 게 아니고, TOML은 두 가지 방법을 지원해:</p>

<ol>
  <li>
    <p><strong>인라인 테이블</strong> : 한 줄 <code class="language-plaintext highlighter-rouge">{ ... }</code> 로 딕셔너리 값을 넣기</p>
  </li>
  <li>
    <p><strong>점 표기(dotted keys)</strong> : <code class="language-plaintext highlighter-rouge">parameters.temperature = 0.7</code> 처럼 같은 섹션 안에서 키를 점으로 이어 쓰기</p>
  </li>
</ol>

<p>아래에 둘 다 예시 + 코드를 싱글톤 API에 반영해줄게. <code class="language-plaintext highlighter-rouge">api_providers</code> 항목 안에 <code class="language-plaintext highlighter-rouge">parameters</code>를 그대로 넣고, 기본값 병합도 지원해.</p>

<hr />

<h1 id="1-toml-작성법-step-by-step">1) TOML 작성법 (step-by-step)</h1>

<h2 id="a-인라인-테이블깔끔-한-줄">A. 인라인 테이블(깔끔, 한 줄)</h2>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[api_providers."anthropic-sonnet"]</span>
<span class="py">display_name</span> <span class="p">=</span> <span class="s">"Anthropic Claude 3.5 Sonnet"</span>
<span class="py">model_id</span>     <span class="p">=</span> <span class="s">"claude-3-5-sonnet"</span>
<span class="py">base_url</span>     <span class="p">=</span> <span class="s">"https://api.anthropic.com"</span>
<span class="py">api_key</span>      <span class="p">=</span> <span class="s">"${ANTHROPIC_API_KEY}"</span>
<span class="py">parameters</span>   <span class="o">=</span> <span class="p">{</span> <span class="py">temperature</span> <span class="p">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="py">top_p</span> <span class="p">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="py">stop</span> <span class="p">=</span> <span class="p">[</span><span class="s">"</span><span class="se">\n\n</span><span class="s">Human:"</span><span class="p">,</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">Assistant:"</span><span class="p">]</span> <span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>장점: 한눈에 보기 좋음.</p>
  </li>
  <li>
    <p>유의: <strong>TOML 1.0 스펙상 인라인 테이블은 한 줄</strong> 이어야 해. (줄바꿈/주석 넣기 어려움)</p>
  </li>
</ul>

<h2 id="b-점-표기dotted-keys-같은-섹션-내부-다줄">B. 점 표기(dotted keys, 같은 섹션 내부 다줄)</h2>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[api_providers."anthropic-sonnet"]</span>
<span class="py">display_name</span> <span class="p">=</span> <span class="s">"Anthropic Claude 3.5 Sonnet"</span>
<span class="py">model_id</span>     <span class="p">=</span> <span class="s">"claude-3-5-sonnet"</span>
<span class="py">base_url</span>     <span class="p">=</span> <span class="s">"https://api.anthropic.com"</span>
<span class="py">api_key</span>      <span class="p">=</span> <span class="s">"${ANTHROPIC_API_KEY}"</span>
<span class="py">parameters.temperature</span> <span class="p">=</span> <span class="mf">0.2</span>
<span class="py">parameters.top_p</span>       <span class="p">=</span> <span class="mf">0.9</span>
<span class="py">parameters.stop</span>        <span class="p">=</span> <span class="p">[</span><span class="s">"</span><span class="se">\n\n</span><span class="s">Human:"</span><span class="p">,</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">Assistant:"</span><span class="p">]</span>  <span class="c"># ← 주석 OK</span>
</code></pre></div></div>

<ul>
  <li>
    <p>장점: 여러 줄로 읽기 편하고 <strong>주석 가능</strong>.</p>
  </li>
  <li>
    <p>내부적으로는 딕셔너리로 파싱됨. (YAML 필요 없음)</p>
  </li>
</ul>

<h2 id="선택-공통-기본값-병합">(선택) 공통 기본값 병합</h2>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[defaults.parameters]</span>
<span class="py">temperature</span> <span class="p">=</span> <span class="mf">0.3</span>
<span class="py">max_tokens</span>  <span class="p">=</span> <span class="mi">2048</span>
</code></pre></div></div>

<ul>
  <li>각 provider의 <code class="language-plaintext highlighter-rouge">parameters</code> 위에 <strong>덮어쓰기 병합</strong> 돼서 최종값이 만들어져.</li>
</ul>

<hr />

<h1 id="2-전체-예시-configtoml">2) 전체 예시 <code class="language-plaintext highlighter-rouge">config.toml</code></h1>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">version</span> <span class="p">=</span> <span class="mi">1</span>

<span class="nn">[settings]</span>
<span class="py">refresh_interval_seconds</span> <span class="p">=</span> <span class="mi">30</span>  <span class="c"># 5~60(요구: 1분 내 반영)</span>

<span class="nn">[defaults.parameters]</span>
<span class="py">temperature</span> <span class="p">=</span> <span class="mf">0.3</span>
<span class="py">max_tokens</span>  <span class="p">=</span> <span class="mi">2048</span>

<span class="c"># ── OpenAI (인라인 테이블) ───────────────────────────</span>
<span class="nn">[api_providers."openai-mini"]</span>
<span class="py">display_name</span> <span class="p">=</span> <span class="s">"OpenAI GPT-4o mini"</span>
<span class="py">model_id</span>     <span class="p">=</span> <span class="s">"gpt-4o-mini"</span>
<span class="py">base_url</span>     <span class="p">=</span> <span class="s">"https://api.openai.com/v1"</span>
<span class="py">api_key</span>      <span class="p">=</span> <span class="s">"${OPENAI_API_KEY}"</span>
<span class="py">parameters</span>   <span class="o">=</span> <span class="p">{</span> <span class="py">temperature</span> <span class="p">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="py">top_p</span> <span class="p">=</span> <span class="mf">0.95</span> <span class="p">}</span>

<span class="c"># ── Anthropic (점 표기) ───────────────────────────────</span>
<span class="nn">[api_providers."anthropic-sonnet"]</span>
<span class="py">display_name</span> <span class="p">=</span> <span class="s">"Anthropic Claude 3.5 Sonnet"</span>
<span class="py">model_id</span>     <span class="p">=</span> <span class="s">"claude-3-5-sonnet"</span>
<span class="py">base_url</span>     <span class="p">=</span> <span class="s">"https://api.anthropic.com"</span>
<span class="py">api_key</span>      <span class="p">=</span> <span class="s">"${ANTHROPIC_API_KEY}"</span>
<span class="py">parameters.temperature</span> <span class="p">=</span> <span class="mf">0.2</span>
<span class="py">parameters.top_p</span>       <span class="p">=</span> <span class="mf">0.9</span>
<span class="py">parameters.stop</span>        <span class="p">=</span> <span class="p">[</span><span class="s">"</span><span class="se">\n\n</span><span class="s">Human:"</span><span class="p">,</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">Assistant:"</span><span class="p">]</span>
</code></pre></div></div>

<hr />

<h1 id="3-외부-사용-방법-그대로--parameters-지원">3) 외부 사용 방법 (그대로, + <code class="language-plaintext highlighter-rouge">parameters</code> 지원)</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">comfyui_config_reader</span> <span class="kn">import</span> <span class="n">api_provider</span><span class="p">,</span> <span class="n">api_providers</span><span class="p">,</span> <span class="n">api_parameters</span><span class="p">,</span> <span class="n">get</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="nf">api_provider</span><span class="p">(</span><span class="sh">"</span><span class="s">anthropic-sonnet</span><span class="sh">"</span><span class="p">)</span>   <span class="c1"># 키 / display_name / model_id 아무거나
</span><span class="nf">print</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">model_id</span><span class="sh">"</span><span class="p">],</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">],</span> <span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">])</span>
<span class="nf">print</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">parameters</span><span class="sh">"</span><span class="p">])</span>                  <span class="c1"># ← 최종 병합된 dict
</span>
<span class="c1"># 파라미터만 바로
</span><span class="n">params</span> <span class="o">=</span> <span class="nf">api_parameters</span><span class="p">(</span><span class="sh">"</span><span class="s">openai-mini</span><span class="sh">"</span><span class="p">)</span>    <span class="c1"># {"temperature": 0.25, "top_p": 0.95, "max_tokens": 2048}
</span><span class="n">use_cache</span> <span class="o">=</span> <span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">feature_flags.use_cache</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h1 id="4-드롭인-교체-코드">4) 드롭인 교체 코드</h1>

<h2 id="custom_nodescomfyui_config_reader__init__py-3"><code class="language-plaintext highlighter-rouge">custom_nodes/comfyui_config_reader/__init__.py</code></h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">.config_singleton</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CONFIG</span><span class="p">,</span>
    <span class="n">configure</span><span class="p">,</span>
    <span class="n">api_provider</span><span class="p">,</span> <span class="n">api_providers</span><span class="p">,</span>
    <span class="n">api_parameters</span><span class="p">,</span>                  <span class="c1"># ← 추가
</span>    <span class="n">get</span><span class="p">,</span> <span class="n">snapshot</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="custom_nodescomfyui_config_readerconfig_singletonpy-3"><code class="language-plaintext highlighter-rouge">custom_nodes/comfyui_config_reader/config_singleton.py</code></h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">threading</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomllib</span>  <span class="c1"># py3.11+
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomllib</span><span class="p">.</span><span class="n">loads</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">tomli</span>     <span class="c1"># py3.10-
</span>    <span class="n">_TOML_LOADS</span> <span class="o">=</span> <span class="n">tomli</span><span class="p">.</span><span class="n">loads</span>

<span class="k">def</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="sh">""</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">${</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">"</span><span class="s">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">j</span><span class="p">],</span> <span class="sh">""</span><span class="p">);</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>  <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>  <span class="k">return</span> <span class="p">[</span><span class="nf">_expand_env</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">v</span>

<span class="k">def</span> <span class="nf">_norm</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="nf">str</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="nf">strip</span><span class="p">().</span><span class="nf">lower</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_normalize_model_id</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">model_id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">request_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">request_model</span><span class="sh">"</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">cfg</span> <span class="ow">and</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">k</span><span class="p">]).</span><span class="nf">strip</span><span class="p">():</span>
            <span class="k">return</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">k</span><span class="p">]).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="sh">""</span>

<span class="k">def</span> <span class="nf">_deep_merge</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="n">b</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nf">_deep_merge</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="k">class</span> <span class="nc">_ReadOnlyConfig</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    - 읽기 전용 TOML
    - mtime + TTL(5~60s, 기본 30s) 자동 재로드 → 1분 내 변경 반영
    - 표준 섹션: [api_providers]
    - 각 provider 필수: display_name, model_id, base_url, api_key
      + 선택: parameters(dict)  # 인라인 테이블 또는 dotted keys 모두 지원
    - [defaults.parameters] 병합 지원(개별 provider.parameters가 우선)
    </span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># --- 내부 로딩 ---
</span>    <span class="k">def</span> <span class="nf">_read_text</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">,</span> <span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_providers_table</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">tbl</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">api_providers</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tbl</span> <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">tbl</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_build_index</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>

        <span class="c1"># defaults.parameters (alias: defaults.params도 지원)
</span>        <span class="n">defaults</span> <span class="o">=</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">defaults</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">d_params</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">parameters</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">defaults</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">tbl</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_providers_table</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">tbl</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="k">return</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">raw</span> <span class="ow">in</span> <span class="n">tbl</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="k">continue</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>

            <span class="n">display</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)).</span><span class="nf">strip</span><span class="p">()</span>
            <span class="n">model</span>   <span class="o">=</span> <span class="nf">_normalize_model_id</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
            <span class="n">base</span>    <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)).</span><span class="nf">strip</span><span class="p">()</span>
            <span class="n">api</span>     <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)).</span><span class="nf">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">display</span> <span class="ow">and</span> <span class="n">model</span> <span class="ow">and</span> <span class="n">base</span> <span class="ow">and</span> <span class="n">api</span><span class="p">):</span>
                <span class="k">continue</span>  <span class="c1"># 필수 누락 스킵
</span>
            <span class="c1"># provider.parameters (alias: params) 추출 + defaults 병합
</span>            <span class="n">p_params</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">parameters</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p_params</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">p_params</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># 과거 명칭 호환
</span>            <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">p_params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">p_params</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">merged_params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">d_params</span><span class="p">,</span> <span class="o">**</span><span class="n">p_params</span><span class="p">}</span>

            <span class="n">entry</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">display</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">model_id</span><span class="sh">"</span><span class="p">:</span>     <span class="n">model</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span>     <span class="n">base</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">:</span>      <span class="n">api</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">parameters</span><span class="sh">"</span><span class="p">:</span>   <span class="n">merged_params</span><span class="p">,</span>  <span class="c1"># ← 포함
</span>            <span class="p">}</span>

            <span class="c1"># 접근 키: 정의 키 / display_name / model_id
</span>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">{</span><span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">display</span><span class="p">,</span> <span class="n">model</span><span class="p">}:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">[</span><span class="nf">_norm</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="o">=</span> <span class="n">entry</span>

    <span class="k">def</span> <span class="nf">_reload_locked</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_read_text</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nf">_TOML_LOADS</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="nf">int</span><span class="p">((</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">settings</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">refresh_interval_seconds</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
        <span class="n">env_r</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env_r</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">r</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">env_r</span><span class="p">)))</span>
            <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span> <span class="k">pass</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span> <span class="o">=</span> <span class="n">r</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_raw</span> <span class="o">=</span> <span class="nf">_expand_env</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_build_index</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">_stale_or_changed</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getmtime</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">m</span> <span class="o">!=</span> <span class="n">self</span><span class="p">.</span><span class="n">_last_mtime</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">&gt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">_refresh</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ensure_loaded</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_loaded_at</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="nf">_stale_or_changed</span><span class="p">():</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>

    <span class="c1"># --- 퍼블릭 API ---
</span>    <span class="k">def</span> <span class="nf">api_provider</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">str</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sh">"</span><span class="s">api_provider key is empty</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_norm</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_reload_locked</span><span class="p">()</span>
                <span class="n">hit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">_norm</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">api_provider not found: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hit</span>

    <span class="k">def</span> <span class="nf">api_providers</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sh">"""</span><span class="s">목록에서는 api_key 숨김, parameters는 노출.</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">out</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">_idx</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">dn</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dn</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">seen</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">dn</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="n">dn</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">display_name</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">model_id</span><span class="sh">"</span><span class="p">:</span>     <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">model_id</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">:</span>     <span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">base_url</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">parameters</span><span class="sh">"</span><span class="p">:</span>   <span class="n">v</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">parameters</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">api_parameters</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nf">dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">api_provider</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">parameters</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}))</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dotted</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_raw</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">dotted</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">.</span><span class="sh">"</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="n">part</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nc">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">config path not found: </span><span class="si">{</span><span class="n">dotted</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cur</span>

    <span class="k">def</span> <span class="nf">snapshot</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_ensure_loaded</span><span class="p">()</span>
        <span class="k">return</span> <span class="nf">dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_raw</span><span class="p">)</span>

<span class="c1"># ----- 싱글톤 -----
</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
<span class="n">_instance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ReadOnlyConfig</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">_default_path</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">_resolve_default_path</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_default_path</span> <span class="ow">or</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">COMFY_CONFIG_PATH</span><span class="sh">"</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="sh">"</span><span class="s">config.toml</span><span class="sh">"</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_get_instance</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">_ReadOnlyConfig</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">_instance</span>
    <span class="k">if</span> <span class="n">_instance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_instance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">_instance</span> <span class="o">=</span> <span class="nf">_ReadOnlyConfig</span><span class="p">(</span><span class="nf">_resolve_default_path</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">_instance</span>

<span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">refresh_seconds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">_instance</span><span class="p">,</span> <span class="n">_default_path</span>
    <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">_default_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">refresh_seconds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sh">"</span><span class="s">COMFY_CONFIG_REFRESH_SECONDS</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">refresh_seconds</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">_lock</span><span class="p">:</span>
        <span class="n">_instance</span> <span class="o">=</span> <span class="nf">_ReadOnlyConfig</span><span class="p">(</span><span class="nf">_resolve_default_path</span><span class="p">())</span>

<span class="c1"># ---- 외부 API ----
</span><span class="k">def</span> <span class="nf">api_provider</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>         <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">api_provider</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">api_providers</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>     <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">api_providers</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">api_parameters</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>       <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">api_parameters</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">dotted</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>                          <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">get</span><span class="p">(</span><span class="n">dotted</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">snapshot</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>                     <span class="k">return</span> <span class="nf">_get_instance</span><span class="p">().</span><span class="nf">snapshot</span><span class="p">()</span>

<span class="c1"># ---- 객체형 프록시 ----
</span><span class="k">class</span> <span class="nc">_ConfigProxy</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="nf">getattr</span><span class="p">(</span><span class="nf">_get_instance</span><span class="p">(),</span> <span class="n">name</span><span class="p">)</span>
<span class="n">CONFIG</span> <span class="o">=</span> <span class="nf">_ConfigProxy</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h1 id="5-정리">5) 정리</h1>

<ul>
  <li>
    <p>✅ <strong>TOML에서도 딕셔너리 가능</strong> : 인라인 테이블 <code class="language-plaintext highlighter-rouge">{...}</code> 또는 점 표기 <code class="language-plaintext highlighter-rouge">parameters.foo =</code></p>
  </li>
  <li>
    <p>✅ <code class="language-plaintext highlighter-rouge">api_providers</code> 각 항목에 <strong><code class="language-plaintext highlighter-rouge">parameters</code> 포함</strong> 지원 (인라인/점표기 모두 OK)</p>
  </li>
  <li>
    <p>✅ <code class="language-plaintext highlighter-rouge">defaults.parameters</code>로 공통값 병합</p>
  </li>
  <li>
    <p>✅ 외부 접근: <code class="language-plaintext highlighter-rouge">api_provider("키")["parameters"]</code> 또는 <code class="language-plaintext highlighter-rouge">api_parameters("키")</code></p>
  </li>
  <li>
    <p>✅ 읽기 전용 + 파일 변경 <strong>최대 1분 내 반영</strong></p>
  </li>
</ul>

<p>원하면 <code class="language-plaintext highlighter-rouge">parameters</code> 외에 <code class="language-plaintext highlighter-rouge">http</code> 같은 섹션도 같은 방식으로 붙여서 병합 지원해줄 수 있어!</p>]]></content><author><name>hvppyarchive</name></author><category term="comfyui" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">openai api Raw 데이터 확인 방법</title><link href="https://hvppyarchive.github.io/python/openai-package-data-hook/" rel="alternate" type="text/html" title="openai api Raw 데이터 확인 방법" /><published>2025-10-01T18:38:56+09:00</published><updated>2025-10-01T18:38:56+09:00</updated><id>https://hvppyarchive.github.io/python/openai-package-data-hook</id><content type="html" xml:base="https://hvppyarchive.github.io/python/openai-package-data-hook/"><![CDATA[<p class="chat--user">

openai python package에서 내가 보내는 패킷을 가능한 raw 데이터 형태로 보고 싶어

</p>

<p>좋아요. “openai” Python 패키지로 API를 호출할 때, 내가 보낸 <strong>HTTP 요청(=패킷)에 최대한 가까운 raw 데이터</strong> 를 보는 대표적인 방법을 단계별로 정리했어요. 상황/보안 요구에 따라 골라 쓰시면 됩니다.</p>

<hr />

<h1 id="1-가장-간단한-방법-sdk-디버그-로그-켜기">1) 가장 간단한 방법: SDK 디버그 로그 켜기</h1>

<p>OpenAI Python SDK는 환경변수 한 줄로 상세 로그를 뿌릴 수 있어요.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">OPENAI_LOG</span><span class="o">=</span>debug
python your_script.py
</code></pre></div></div>

<ul>
  <li>이러면 SDK 내부와 함께 <strong>httpx</strong>(OpenAI SDK의 HTTP 클라이언트) 디버그 로그도 활성화돼서 요청/응답 흐름을 확인할 수 있습니다. <a href="https://stackoverflow.com/questions/76256249/logging-in-the-open-ai-python-library?utm_source=chatgpt.com">Stack Overflow</a></li>
</ul>

<blockquote>
  <p>장점: 코드 수정 없음<br />
 단점: 바디 전문을 항상 보여주진 않음(민감정보 보호 차원에서 마스킹/생략될 수 있음)</p>
</blockquote>

<hr />

<h1 id="2-표준-로깅으로-httpx-디버깅요청응답-라인헤더">2) 표준 로깅으로 httpx 디버깅(요청/응답 라인·헤더)</h1>

<p><code class="language-plaintext highlighter-rouge">logging</code>으로 httpx 로거를 DEBUG로 켜면, 연결/요청/응답의 내부 동작을 자세히 볼 수 있어요.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">logging</span>

<span class="n">logging</span><span class="p">.</span><span class="nf">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="sh">"</span><span class="s">httpx</span><span class="sh">"</span><span class="p">).</span><span class="nf">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="kn">from</span> <span class="n">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="n">client</span> <span class="o">=</span> <span class="nc">OpenAI</span><span class="p">()</span>

<span class="c1"># 평소처럼 호출
</span><span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">chat</span><span class="p">.</span><span class="n">completions</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ping</span><span class="sh">"</span><span class="p">}],</span>
<span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>위처럼 하면 httpx가 출력하는 <strong>요청 메서드/URL, 응답 상태, 일부 헤더 등</strong> 을 확인할 수 있습니다. 필요한 경우 포맷을 더 꾸밀 수 있어요. <a href="https://www.python-httpx.org/logging/?utm_source=chatgpt.com">python-httpx.org</a></li>
</ul>

<blockquote>
  <p>장점: 표준 파이썬 로깅으로 손쉽게 제어<br />
 단점: 바디 전문은 기본 로그에 안 나옴</p>
</blockquote>

<hr />

<h1 id="3-진짜-raw에-가깝게--커스텀-httpx-client--이벤트-훅">3) “진짜 raw에 가깝게” — 커스텀 httpx Client + 이벤트 훅</h1>

<p>가장 투명한 방법은 SDK에 <strong>커스텀 httpx.Client</strong> 를 주입하고, <strong>event_hooks</strong> 로 요청·응답 시점에 <strong>바디까지 포함</strong> 해서 찍는 겁니다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">httpx</span>
<span class="kn">from</span> <span class="n">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>

<span class="k">def</span> <span class="nf">log_request</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">httpx</span><span class="p">.</span><span class="n">Request</span><span class="p">):</span>
    <span class="c1"># 주의: 여기서 body를 출력하면 프롬프트/키 등 민감정보가 노출될 수 있음
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== HTTP REQUEST ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">request</span><span class="p">.</span><span class="n">url</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="c1"># request.content는 bytes일 수 있음
</span>    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">content</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">-- body (utf-8) --</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">))</span>
        <span class="k">except</span> <span class="nb">UnicodeDecodeError</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">-- body (bytes) --</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">log_response</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">httpx</span><span class="p">.</span><span class="n">Response</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== HTTP RESPONSE ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">HTTP/</span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">http_version</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="c1"># 주의: 응답 바디에는 토큰/텍스트 등 민감정보 포함 가능
</span>    <span class="n">body</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">content</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">-- body (utf-8 pretty) --</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">(),</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">-- body (raw) --</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">body</span><span class="p">[:</span><span class="mi">2000</span><span class="p">])</span>  <span class="c1"># 너무 길면 샘플만
</span>
<span class="n">hooks</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">log_request</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">log_response</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">http_client</span> <span class="o">=</span> <span class="n">httpx</span><span class="p">.</span><span class="nc">Client</span><span class="p">(</span><span class="n">event_hooks</span><span class="o">=</span><span class="n">hooks</span><span class="p">)</span>

<span class="n">client</span> <span class="o">=</span> <span class="nc">OpenAI</span><span class="p">(</span><span class="n">http_client</span><span class="o">=</span><span class="n">http_client</span><span class="p">)</span>

<span class="c1"># 테스트 호출
</span><span class="n">_</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">chat</span><span class="p">.</span><span class="n">completions</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Hello</span><span class="sh">"</span><span class="p">}],</span>
<span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>핵심은 <code class="language-plaintext highlighter-rouge">OpenAI(http_client=...)</code> 로 <strong>내 httpx 클라이언트를 주입</strong> 하는 부분입니다. 이런 식으로 요청/응답 <strong>헤더 + 바디</strong> 를 원하는 형식으로 덤프할 수 있어요. <a href="https://til.simonwillison.net/httpx/openai-log-requests-responses?utm_source=chatgpt.com">TIL+2</a></li>
</ul>

<blockquote>
  <p>장점: 가장 “raw”에 가까움(내용·헤더·상태 전부 내가 통제)<br />
 단점: 직접 마스킹 처리를 해야 안전</p>
</blockquote>

<hr />

<h1 id="4-외부-프록시패킷-캡처로-와이어-그대로-보기">4) 외부 프록시(패킷 캡처)로 “와이어 그대로” 보기</h1>

<p>코드를 건드리고 싶지 않거나, <strong>진짜 전송되는 TLS 트래픽</strong> 까지 관찰하고 싶다면 <strong>프록시/패킷 도구</strong> 를 쓰세요.</p>

<ul>
  <li>
    <p>예: <strong>Proxyman</strong> , <strong>mitmproxy</strong> , <strong>Charles</strong> , <strong>Fiddler</strong> 등</p>
  </li>
  <li>
    <p>방법: 도구에서 루트 인증서를 신뢰하도록 설정 → Python이 해당 프록시를 쓰게 <code class="language-plaintext highlighter-rouge">HTTPS_PROXY</code>/<code class="language-plaintext highlighter-rouge">HTTP_PROXY</code> 환경변수 설정 → 스크립트 실행 → 도구에서 <strong>요청 라인/헤더/압축 전/후 바디</strong> 까지 열람</p>
  </li>
  <li>
    <p>httpx/requests 기반 파이썬 코드에서 이런 프록시로 <strong>HTTPS 트래픽 캡처</strong> 가 가능합니다. <a href="https://proxyman.com/posts/2025-01-29-How-To-Capture-HTTPS-Traffic-From-Python-Requests-httpx?utm_source=chatgpt.com">Proxyman</a></p>
  </li>
</ul>

<blockquote>
  <p>장점: SDK/코드 수정 최소화, 실제 전송 형태를 GUI로 직관적으로 확인<br />
 단점: 사내 정책/루트 인증서 설치 이슈 가능</p>
</blockquote>

<hr />

<h1 id="5-비교-기준-정리-언제-무엇을-쓸까">5) 비교 기준 정리 (언제 무엇을 쓸까?)</h1>

<ul>
  <li>
    <p><strong>빠른 확인</strong> : <code class="language-plaintext highlighter-rouge">OPENAI_LOG=debug</code> (1분 컷). <a href="https://stackoverflow.com/questions/76256249/logging-in-the-open-ai-python-library?utm_source=chatgpt.com">Stack Overflow</a></p>
  </li>
  <li>
    <p><strong>파이썬 로그에 일원화</strong> : httpx 로거 DEBUG (Step 2). <a href="https://www.python-httpx.org/logging/?utm_source=chatgpt.com">python-httpx.org</a></p>
  </li>
  <li>
    <p><strong>요청/응답 바디까지 100% 통제</strong> : 커스텀 httpx Client + event_hooks (Step 3). <a href="https://til.simonwillison.net/httpx/openai-log-requests-responses?utm_source=chatgpt.com">TIL+1</a></p>
  </li>
  <li>
    <p><strong>진짜 패킷 관점(프록시)</strong> : Proxyman/mitmproxy (Step 4). <a href="https://proxyman.com/posts/2025-01-29-How-To-Capture-HTTPS-Traffic-From-Python-Requests-httpx?utm_source=chatgpt.com">Proxyman</a></p>
  </li>
</ul>

<hr />

<h1 id="6-보안컴플라이언스-주의중요">6) 보안/컴플라이언스 주의(중요)</h1>

<ul>
  <li>
    <p><strong>API 키</strong> 와 <strong>프롬프트/응답 내용</strong> 이 로그에 남을 수 있어요.</p>

    <ul>
      <li>
        <p>로컬만, 접근 제한된 환경에서만 출력하세요.</p>
      </li>
      <li>
        <p>저장 시엔 <strong>마스킹/암호화</strong> 또는 <strong>임시 파일</strong> 사용을 권장.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>회사/조직 정책상 <strong>중간자 프록시 툴</strong> 사용이 제한될 수 있습니다(특히 클라우드/생산환경). 사전 승인 필요.</p>
  </li>
</ul>

<hr />

<h1 id="7-참고-문서">7) 참고 문서</h1>

<ul>
  <li>
    <p>OpenAI SDK 디버깅 개요/레퍼런스: <a href="https://platform.openai.com/docs/api-reference/debugging-requests?utm_source=chatgpt.com">OpenAI 플랫폼+1</a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">OPENAI_LOG=debug</code> 안내(Q&amp;A): <a href="https://stackoverflow.com/questions/76256249/logging-in-the-open-ai-python-library?utm_source=chatgpt.com">Stack Overflow</a></p>
  </li>
  <li>
    <p>httpx 로깅/트랜스포트 심화: <a href="https://www.python-httpx.org/logging/?utm_source=chatgpt.com">python-httpx.org+1</a></p>
  </li>
  <li>
    <p>외부 프록시로 httpx 트래픽 캡처: <a href="https://proxyman.com/posts/2025-01-29-How-To-Capture-HTTPS-Traffic-From-Python-Requests-httpx?utm_source=chatgpt.com">Proxyman</a></p>
  </li>
</ul>

<hr />

<p>원하시면, 위 ③ 커스텀 클라이언트 코드를 <strong>바디 마스킹(예: 토큰/이메일 제거)</strong> 포함 버전으로 바로 만들어 드릴게요.</p>

<p class="chat--user">

string에 데이터가 담기게 하고 싶어 요청을 보낼때 / 받을때 각각

</p>

<p>좋습니다 — <strong>요청 보낼 때(request)와 받을 때(response)</strong> 각각의 바디를 <strong>문자열(string)</strong>으로 저장하는 실전 코드(동기 + 비동기)를 바로 드릴게요. 민감정보(Authorization/API Key 등) 마스킹도 포함되어 있으니 안전하게 쓰실 수 있습니다. 단계별로 설명도 덧붙였어요 — 요청하신 대로 <strong>step-by-step</strong> 방식으로요.</p>

<hr />

<h1 id="1-핵심-아이디어-간단-요약">1) 핵심 아이디어 (간단 요약)</h1>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">httpx.Client</code>(또는 <code class="language-plaintext highlighter-rouge">httpx.AsyncClient</code>)를 만들어 <code class="language-plaintext highlighter-rouge">event_hooks</code>에 요청/응답 훅을 붙입니다.</p>
  </li>
  <li>
    <p>훅에서 <code class="language-plaintext highlighter-rouge">request.content</code> / <code class="language-plaintext highlighter-rouge">response.content</code>를 읽어 <code class="language-plaintext highlighter-rouge">str</code>로 변환해서 전역 변수나 캡처용 변수에 저장합니다.</p>
  </li>
  <li>
    <p>로그로 출력하기 전 민감 필드(헤더의 Authorization 등)와 바디 내부 키(예: <code class="language-plaintext highlighter-rouge">"api_key"</code>, <code class="language-plaintext highlighter-rouge">"key"</code>)를 마스킹합니다.</p>
  </li>
</ol>

<hr />

<h1 id="2-동기synchronous-예제--바로-복사해서-쓰세요">2) 동기(synchronous) 예제 — 바로 복사해서 쓰세요</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">httpx</span>
<span class="kn">from</span> <span class="n">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>    <span class="c1"># 설치된 최신 openai 패키지 사용
</span>
<span class="c1"># 저장할 문자열 변수(요청/응답)
</span><span class="n">captured_request_body</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">captured_response_body</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">redacted</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">api-key</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">k</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
            <span class="n">redacted</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">REDACTED</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">redacted</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">redacted</span>

<span class="k">def</span> <span class="nf">redact_json_text</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="c1"># 시도: JSON이면 파싱해서 특정 키 마스킹
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">sensitive</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">apiKey</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sensitive</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                    <span class="n">obj</span><span class="p">[</span><span class="n">sensitive</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">REDACTED</span><span class="sh">"</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="c1"># JSON이 아니면 간단 치환(헤더처럼)
</span>        <span class="c1"># 예: URL-encoded form/body에서 key=값 형태를 가볍게 마스킹
</span>        <span class="k">for</span> <span class="n">sensitive</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">apiKey</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">sensitive</span> <span class="o">+</span> <span class="sh">"</span><span class="s">=</span><span class="sh">"</span><span class="p">,</span> <span class="n">sensitive</span> <span class="o">+</span> <span class="sh">"</span><span class="s">=REDACTED</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>

<span class="k">def</span> <span class="nf">request_hook</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">httpx</span><span class="p">.</span><span class="n">Request</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">captured_request_body</span>
    <span class="c1"># 헤더 마스킹
</span>    <span class="n">safe_headers</span> <span class="o">=</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">))</span>
    <span class="c1"># 바디 읽기 (bytes -&gt; str)
</span>    <span class="n">body_str</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># request.content는 bytes 또는 None
</span>    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">replace</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="nf">repr</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># 준비되지 않은 스트림(rare)인 경우
</span>        <span class="n">body_str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">&lt;no request.content available or streaming body&gt;</span><span class="sh">"</span>
    <span class="c1"># 민감정보 마스킹
</span>    <span class="n">body_str</span> <span class="o">=</span> <span class="nf">redact_json_text</span><span class="p">(</span><span class="n">body_str</span><span class="p">)</span>
    <span class="n">captured_request_body</span> <span class="o">=</span> <span class="n">body_str</span>

    <span class="c1"># (선택) 콘솔 출력
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">---- REQUEST ----</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">request</span><span class="p">.</span><span class="n">url</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">safe_headers</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">-- body --</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">body_str</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">-----------------</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">response_hook</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">httpx</span><span class="p">.</span><span class="n">Response</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">captured_response_body</span>
    <span class="c1"># 헤더 마스킹
</span>    <span class="n">safe_headers</span> <span class="o">=</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">))</span>
    <span class="c1"># 응답 바디 읽음 (bytes -&gt; str)
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># response.content는 전체 바디(이미 수신된 상태의 hook에서는 안전)
</span>        <span class="n">body_str</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">replace</span><span class="sh">"</span><span class="p">)</span>
        <span class="c1"># 시도해서 JSON 예쁘게
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">body_str</span><span class="p">)</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="n">body_str</span> <span class="o">=</span> <span class="nf">repr</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">body_str</span> <span class="o">=</span> <span class="nf">redact_json_text</span><span class="p">(</span><span class="n">body_str</span><span class="p">)</span>
    <span class="n">captured_response_body</span> <span class="o">=</span> <span class="n">body_str</span>

    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">---- RESPONSE ----</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">HTTP/</span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">http_version</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">safe_headers</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">-- body --</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">body_str</span><span class="p">[:</span><span class="mi">4000</span><span class="p">])</span>  <span class="c1"># 너무 길면 잘라서 보이게
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">------------------</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 이벤트 훅 등록
</span><span class="n">hooks</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">request_hook</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">response_hook</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">http_client</span> <span class="o">=</span> <span class="n">httpx</span><span class="p">.</span><span class="nc">Client</span><span class="p">(</span><span class="n">event_hooks</span><span class="o">=</span><span class="n">hooks</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span>

<span class="c1"># OpenAI 클라이언트에 주입
</span><span class="n">client</span> <span class="o">=</span> <span class="nc">OpenAI</span><span class="p">(</span><span class="n">http_client</span><span class="o">=</span><span class="n">http_client</span><span class="p">)</span>

<span class="c1"># 실제 요청 (예시)
</span><span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">chat</span><span class="p">.</span><span class="n">completions</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">안녕</span><span class="sh">"</span><span class="p">}],</span>
<span class="p">)</span>

<span class="c1"># 함수 외부에서 문자열 접근 가능
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Captured request body (string):</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">captured_request_body</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Captured response body (string):</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">captured_response_body</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h1 id="3-비동기async-예제--asyncawait-환경에서">3) 비동기(async) 예제 — async/await 환경에서</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">httpx</span>
<span class="kn">import</span> <span class="n">asyncio</span>
<span class="kn">from</span> <span class="n">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>

<span class="n">captured_request_body</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">captured_response_body</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">redacted</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">api-key</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">k</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
            <span class="n">redacted</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">REDACTED</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">redacted</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">redacted</span>

<span class="k">def</span> <span class="nf">redact_json_text</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">sensitive</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">apiKey</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sensitive</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                    <span class="n">obj</span><span class="p">[</span><span class="n">sensitive</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">REDACTED</span><span class="sh">"</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">sensitive</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">apiKey</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">sensitive</span> <span class="o">+</span> <span class="sh">"</span><span class="s">=</span><span class="sh">"</span><span class="p">,</span> <span class="n">sensitive</span> <span class="o">+</span> <span class="sh">"</span><span class="s">=REDACTED</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">request_hook</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">httpx</span><span class="p">.</span><span class="n">Request</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">captured_request_body</span>
    <span class="n">safe_headers</span> <span class="o">=</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">))</span>
    <span class="n">body_str</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">replace</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="nf">repr</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">body_str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">&lt;no request.content available or streaming body&gt;</span><span class="sh">"</span>
    <span class="n">body_str</span> <span class="o">=</span> <span class="nf">redact_json_text</span><span class="p">(</span><span class="n">body_str</span><span class="p">)</span>
    <span class="n">captured_request_body</span> <span class="o">=</span> <span class="n">body_str</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">REQ</span><span class="sh">"</span><span class="p">,</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span> <span class="n">request</span><span class="p">.</span><span class="n">url</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">body_str</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">response_hook</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">httpx</span><span class="p">.</span><span class="n">Response</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">captured_response_body</span>
    <span class="n">safe_headers</span> <span class="o">=</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">body_str</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">replace</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="n">body_str</span> <span class="o">=</span> <span class="nf">repr</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">body_str</span> <span class="o">=</span> <span class="nf">redact_json_text</span><span class="p">(</span><span class="n">body_str</span><span class="p">)</span>
    <span class="n">captured_response_body</span> <span class="o">=</span> <span class="n">body_str</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">RES</span><span class="sh">"</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">body_str</span><span class="p">[:</span><span class="mi">2000</span><span class="p">])</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">hooks</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">request_hook</span><span class="p">],</span> <span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">response_hook</span><span class="p">]}</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="p">.</span><span class="nc">AsyncClient</span><span class="p">(</span><span class="n">event_hooks</span><span class="o">=</span><span class="n">hooks</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">async_http</span><span class="p">:</span>
        <span class="n">client</span> <span class="o">=</span> <span class="nc">OpenAI</span><span class="p">(</span><span class="n">http_client</span><span class="o">=</span><span class="n">async_http</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">chat</span><span class="p">.</span><span class="n">completions</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">안녕</span><span class="sh">"</span><span class="p">}],</span>
        <span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Done</span><span class="sh">"</span><span class="p">)</span>

<span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<hr />

<h1 id="4-주의사항--팁-중요">4) 주의사항 &amp; 팁 (중요)</h1>

<ul>
  <li>
    <p>대부분 경우 <code class="language-plaintext highlighter-rouge">request.content</code> / <code class="language-plaintext highlighter-rouge">response.content</code>는 훅에서 읽을 수 있고 문자열로 변환 가능합니다. 다만 <strong>파일 업로드(멀티파트)</strong> 혹은 <strong>스트리밍 바디</strong> 라면 처리 방식이 달라집니다.</p>
  </li>
  <li>
    <p>스트리밍(예: chunked transfer / SSE)으로 동작하는 경우: 훅에서 전체 바디가 아직 완성되지 않았을 수 있습니다. 이런 상황이면 SDK의 스트리밍 API(또는 httpx의 <code class="language-plaintext highlighter-rouge">stream()</code> 사용)를 직접 감싸서 각 청크를 캡처하는 로직을 추가해야 합니다. 원하시면 스트리밍 캡처 예제도 드릴게요.</p>
  </li>
  <li>
    <p><strong>민감정보 보호</strong> : 콘솔/파일에 직접 남기면 안 됩니다. 로컬 전용, 접근 제어된 환경에서만 보관하세요. 저장해야 한다면 마스킹 또는 암호화 권장.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">event_hooks</code>에서 바디를 읽는 건 일반적으로 안전하지만, 일부 경우(특히 request가 generator/stream로 만들어졌다면) 읽으면 원래 전송을 망칠 수 있으니 주의하세요. 위 예제는 일반 JSON/폼/멀티파트 전송에 적합합니다.</p>
  </li>
</ul>

<hr />

<h1 id="5-추가-요청-가능한-것들-원하시면-바로-만듭니다">5) 추가 요청 가능한 것들 (원하시면 바로 만듭니다)</h1>

<ul>
  <li>
    <p>요청/응답을 <strong>파일 대신 문자열 변수</strong> 에 안전하게 누적(rolling buffer)하는 버전</p>
  </li>
  <li>
    <p><strong>스트리밍(서버-전송 이벤트)</strong> 응답을 청크 단위로 캡처해서 단일 문자열로 합치는 예제</p>
  </li>
  <li>
    <p>바디에서 <strong>특정 키만</strong>(예: <code class="language-plaintext highlighter-rouge">messages</code> or <code class="language-plaintext highlighter-rouge">prompt</code>)만 캡처해서 저장하고 나머지는 마스킹하는 예제</p>
  </li>
  <li>
    <p>멀티파트(파일 업로드) 요청의 각 파트(파일 메타/콘텐츠)를 캡처해 문자열로 변환하는 예제</p>
  </li>
</ul>

<p>원하시는 걸 알려주시면(예: 스트리밍 캡처, 멀티파트 처리, 혹은 바로 적용 가능한 <strong>마스킹 규칙</strong>) 지금 바로 코드로 만들어 드릴게요. 어떤 걸 먼저 드릴까요?</p>

<p class="chat--user">

전역 변수 말고 main 안에서 스트링 저장하는 방밥

</p>

<p>좋아요 — <strong>전역 변수 없이<code class="language-plaintext highlighter-rouge">main()</code> 안에서 요청/응답 바디를 문자열로 저장하는 방법</strong>을 바로 드릴게요. 핵심은 <strong>클로저(or 로컬 가변 컨테이너)</strong> 를 사용해 훅이 <code class="language-plaintext highlighter-rouge">main</code> 안의 변수에 접근하게 하는 것입니다. 스트리밍 예외는 마지막에 짧게 언급합니다.</p>

<p>아래 코드는 (1) 동기(synchronous)와 (2) 비동기(async) 두 버전 모두 제공하고, 민감정보(Authorization 헤더, 몇몇 바디 키)를 <strong>마스킹</strong> 합니다. 그대로 복사해서 쓰시면 됩니다.</p>

<h1 id="1-원리요약-step-by-step">1) 원리(요약, step-by-step)</h1>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">main()</code> 안에 <code class="language-plaintext highlighter-rouge">captured = {"request": None, "response": None}</code> 같은 <strong>가변 dict</strong> 를 만든다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">request_hook</code> / <code class="language-plaintext highlighter-rouge">response_hook</code> 함수는 클로저로서 그 <code class="language-plaintext highlighter-rouge">captured</code>를 수정한다. (<code class="language-plaintext highlighter-rouge">nonlocal</code> 불필요 — dict는 가변이므로)</p>
  </li>
  <li>
    <p>훅에서 <code class="language-plaintext highlighter-rouge">request.content</code> / <code class="language-plaintext highlighter-rouge">response.content</code>를 문자열로 변환 → 민감정보 마스킹 → <code class="language-plaintext highlighter-rouge">captured[...] = body_str</code> 저장.</p>
  </li>
  <li>
    <p>요청이 끝난 뒤 <code class="language-plaintext highlighter-rouge">main()</code>에서 <code class="language-plaintext highlighter-rouge">captured</code> 값을 사용(또는 반환)한다.</p>
  </li>
</ol>

<hr />

<h1 id="2-동기sync-예제">2) 동기(sync) 예제</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">httpx</span>
<span class="kn">from</span> <span class="n">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>

<span class="k">def</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">api-key</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">k</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">REDACTED</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="k">def</span> <span class="nf">redact_json_text</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">sensitive</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">apiKey</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sensitive</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                    <span class="n">obj</span><span class="p">[</span><span class="n">sensitive</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">REDACTED</span><span class="sh">"</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">sensitive</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">apiKey</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">sensitive</span> <span class="o">+</span> <span class="sh">"</span><span class="s">=</span><span class="sh">"</span><span class="p">,</span> <span class="n">sensitive</span> <span class="o">+</span> <span class="sh">"</span><span class="s">=REDACTED</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># 1) 로컬 캡처 컨테이너 (전역 아님)
</span>    <span class="n">captured</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>

    <span class="c1"># 2) 훅들 (클로저로 captured에 접근)
</span>    <span class="k">def</span> <span class="nf">request_hook</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">httpx</span><span class="p">.</span><span class="n">Request</span><span class="p">):</span>
        <span class="c1"># headers 마스킹(여기서는 저장용; 실제 출력은 안전하게)
</span>        <span class="n">safe_headers</span> <span class="o">=</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">))</span>
        <span class="c1"># body를 문자열로 읽기
</span>        <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">body_str</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">replace</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="n">body_str</span> <span class="o">=</span> <span class="nf">repr</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">&lt;no request.content available or streaming body&gt;</span><span class="sh">"</span>
        <span class="n">body_str</span> <span class="o">=</span> <span class="nf">redact_json_text</span><span class="p">(</span><span class="n">body_str</span><span class="p">)</span>
        <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">method</span><span class="sh">"</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">url</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">url</span><span class="p">),</span>
            <span class="sh">"</span><span class="s">headers</span><span class="sh">"</span><span class="p">:</span> <span class="n">safe_headers</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">:</span> <span class="n">body_str</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">response_hook</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">httpx</span><span class="p">.</span><span class="n">Response</span><span class="p">):</span>
        <span class="n">safe_headers</span> <span class="o">=</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">replace</span><span class="sh">"</span><span class="p">)</span>
            <span class="c1"># 예쁘게 포맷(JSON이면)
</span>            <span class="k">try</span><span class="p">:</span>
                <span class="n">parsed</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">body_str</span><span class="p">)</span>
                <span class="n">body_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="nf">repr</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">body_str</span> <span class="o">=</span> <span class="nf">redact_json_text</span><span class="p">(</span><span class="n">body_str</span><span class="p">)</span>
        <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">status_code</span><span class="sh">"</span><span class="p">:</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">headers</span><span class="sh">"</span><span class="p">:</span> <span class="n">safe_headers</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">:</span> <span class="n">body_str</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="n">hooks</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">request_hook</span><span class="p">],</span> <span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">response_hook</span><span class="p">]}</span>
    <span class="n">http_client</span> <span class="o">=</span> <span class="n">httpx</span><span class="p">.</span><span class="nc">Client</span><span class="p">(</span><span class="n">event_hooks</span><span class="o">=</span><span class="n">hooks</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span>
    <span class="n">client</span> <span class="o">=</span> <span class="nc">OpenAI</span><span class="p">(</span><span class="n">http_client</span><span class="o">=</span><span class="n">http_client</span><span class="p">)</span>

    <span class="c1"># 3) 실제 호출 (동기)
</span>    <span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">chat</span><span class="p">.</span><span class="n">completions</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">안녕하세요</span><span class="sh">"</span><span class="p">}],</span>
    <span class="p">)</span>

    <span class="c1"># 4) main 내부에서 문자열로 활용 / 출력 / 반환 가능
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Captured request body (string):</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">]</span> <span class="k">if</span> <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">]</span> <span class="k">else</span> <span class="sh">"</span><span class="s">&lt;none&gt;</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Captured response body (string):</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">]</span> <span class="k">if</span> <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">]</span> <span class="k">else</span> <span class="sh">"</span><span class="s">&lt;none&gt;</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">captured</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">captured</span> <span class="o">=</span> <span class="nf">main</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h1 id="3-비동기async-예제">3) 비동기(async) 예제</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">httpx</span>
<span class="kn">import</span> <span class="n">asyncio</span>
<span class="kn">from</span> <span class="n">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>

<span class="k">def</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">api-key</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">k</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">REDACTED</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="k">def</span> <span class="nf">redact_json_text</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">sensitive</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">apiKey</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sensitive</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                    <span class="n">obj</span><span class="p">[</span><span class="n">sensitive</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">REDACTED</span><span class="sh">"</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">sensitive</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">apiKey</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">sensitive</span> <span class="o">+</span> <span class="sh">"</span><span class="s">=</span><span class="sh">"</span><span class="p">,</span> <span class="n">sensitive</span> <span class="o">+</span> <span class="sh">"</span><span class="s">=REDACTED</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">captured</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">request_hook</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">httpx</span><span class="p">.</span><span class="n">Request</span><span class="p">):</span>
        <span class="n">safe_headers</span> <span class="o">=</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">body_str</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">replace</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="n">body_str</span> <span class="o">=</span> <span class="nf">repr</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">&lt;no request.content available or streaming body&gt;</span><span class="sh">"</span>
        <span class="n">body_str</span> <span class="o">=</span> <span class="nf">redact_json_text</span><span class="p">(</span><span class="n">body_str</span><span class="p">)</span>
        <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">method</span><span class="sh">"</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">url</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">url</span><span class="p">),</span>
            <span class="sh">"</span><span class="s">headers</span><span class="sh">"</span><span class="p">:</span> <span class="n">safe_headers</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">:</span> <span class="n">body_str</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">response_hook</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">httpx</span><span class="p">.</span><span class="n">Response</span><span class="p">):</span>
        <span class="n">safe_headers</span> <span class="o">=</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">replace</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">parsed</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">body_str</span><span class="p">)</span>
                <span class="n">body_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="nf">repr</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">body_str</span> <span class="o">=</span> <span class="nf">redact_json_text</span><span class="p">(</span><span class="n">body_str</span><span class="p">)</span>
        <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">status_code</span><span class="sh">"</span><span class="p">:</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">headers</span><span class="sh">"</span><span class="p">:</span> <span class="n">safe_headers</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">:</span> <span class="n">body_str</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="n">hooks</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">request_hook</span><span class="p">],</span> <span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">response_hook</span><span class="p">]}</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="p">.</span><span class="nc">AsyncClient</span><span class="p">(</span><span class="n">event_hooks</span><span class="o">=</span><span class="n">hooks</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">async_http</span><span class="p">:</span>
        <span class="n">client</span> <span class="o">=</span> <span class="nc">OpenAI</span><span class="p">(</span><span class="n">http_client</span><span class="o">=</span><span class="n">async_http</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">chat</span><span class="p">.</span><span class="n">completions</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">안녕하세요 (async)</span><span class="sh">"</span><span class="p">}],</span>
        <span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Captured request (local):</span><span class="sh">"</span><span class="p">,</span> <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">]</span> <span class="k">if</span> <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">]</span> <span class="k">else</span> <span class="sh">"</span><span class="s">&lt;none&gt;</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Captured response (local):</span><span class="sh">"</span><span class="p">,</span> <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">]</span> <span class="k">if</span> <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">]</span> <span class="k">else</span> <span class="sh">"</span><span class="s">&lt;none&gt;</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">captured</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<hr />

<h1 id="4-주의사항중요">4) 주의사항(중요)</h1>

<ul>
  <li>
    <p><strong>스트리밍 응답</strong>(SSE/청크) 또는 <strong>파일 업로드(멀티파트)</strong> 의 경우 <code class="language-plaintext highlighter-rouge">request.content</code> / <code class="language-plaintext highlighter-rouge">response.content</code>가 훅에서 바로 전체로 읽히지 않거나, 읽으면 스트림이 소모되어 전송에 영향이 생길 수 있음. 그런 경우는 <strong>별도 스트리밍 훅</strong>(청크마다 append)이나 httpx의 <code class="language-plaintext highlighter-rouge">stream()</code> 사용 방식으로 처리해야 합니다. 필요하시면 스트리밍 버전도 바로 제공할게요.</p>
  </li>
  <li>
    <p>훅에서 바디를 읽는 행위가 일부 전송 파이프라인을 바꿀 수 있으니(특히 generator/파일 스트림 전송) 안전한 환경에서 먼저 테스트하세요.</p>
  </li>
  <li>
    <p>로그/파일에 저장하면 API 키나 민감한 사용자 입력이 유출될 수 있으니 <strong>로컬 전용 또는 접근 제한 환경</strong> 에서만 저장하세요.</p>
  </li>
</ul>

<hr />

<p>원하시면:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">messages</code> 필드(프롬프트)만 캡처하고 나머지는 완전 마스킹하는 버전</p>
  </li>
  <li>
    <p><strong>청크 스트리밍</strong>(streaming response)을 로컬 문자열로 합치는 예제</p>
  </li>
  <li>
    <p>멀티파트(파일 업로드)에서 각 파트 별로 문자열로 저장하는 예제</p>
  </li>
</ul>

<p>이 중 어떤 걸 먼저 드릴까요?</p>

<p class="chat--user">

response.aread()를 해야 읽을 수 있는거 아니야?

</p>

<p>좋은 지적입니다 — 상황에 따라 <strong><code class="language-plaintext highlighter-rouge">response.aread()</code>를 <code class="language-plaintext highlighter-rouge">await</code>해야만 바디를 읽을 수 있는 경우</strong>가 맞습니다. 요점만 먼저 정리하고, 바로 쓸 수 있는 코드 예제(비동기 훅에서 <code class="language-plaintext highlighter-rouge">await response.aread()</code> 사용)를 보여드릴게요.</p>

<h1 id="핵심-요약">핵심 요약</h1>

<ol>
  <li>
    <p><strong>동기(httpx.Client)</strong> : 훅에서 <code class="language-plaintext highlighter-rouge">response.content</code>를 읽으면 내부에서 내용을 가져와 캐시하므로 바로 읽을 수 있습니다.</p>
  </li>
  <li>
    <p><strong>비동기(httpx.AsyncClient)</strong> : 훅이 <code class="language-plaintext highlighter-rouge">async def</code>이면 <code class="language-plaintext highlighter-rouge">await response.aread()</code>로 바디(바이트)를 가져와야 안전합니다. (<code class="language-plaintext highlighter-rouge">response.content</code>는 동기 속성이라 async 컨텍스트에선 권장되지 않음.)</p>
  </li>
  <li>
    <p><strong>주의 — 스트리밍(SSE / chunked / streaming API)</strong> : <code class="language-plaintext highlighter-rouge">aread()</code>는 <strong>전체 바디를 한 번에</strong> 읽습니다. 만약 응답이 실시간 스트리밍(예: 서버-전송-이벤트)이라면 <code class="language-plaintext highlighter-rouge">aread()</code>로 전체를 읽어버리면 스트리밍 처리를 망칠 수 있습니다. 스트리밍은 <code class="language-plaintext highlighter-rouge">response.aiter_bytes()</code> / <code class="language-plaintext highlighter-rouge">response.aiter_text()</code>로 청크 단위로 처리하세요.</p>
  </li>
  <li>
    <p>httpx는 한 번 읽은 바디를 캐시하므로 <code class="language-plaintext highlighter-rouge">aread()</code>로 읽은 뒤에도 <code class="language-plaintext highlighter-rouge">response.content</code>/<code class="language-plaintext highlighter-rouge">response.text</code>로 접근해도 됩니다(대부분의 경우).</p>
  </li>
</ol>

<hr />

<h1 id="바로-쓸-수-있는-비동기-훅-예제-await-responsearead-사용">바로 쓸 수 있는 비동기 훅 예제 (<code class="language-plaintext highlighter-rouge">await response.aread()</code> 사용)</h1>

<p>아래는 이전 예제의 <code class="language-plaintext highlighter-rouge">response_hook</code>를 <code class="language-plaintext highlighter-rouge">await response.aread()</code> 로 안전하게 바꾼 코드입니다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">httpx</span>
<span class="kn">import</span> <span class="n">asyncio</span>
<span class="kn">from</span> <span class="n">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>

<span class="k">def</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">api-key</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">k</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">REDACTED</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="k">def</span> <span class="nf">redact_text</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="c1"># 간단 마스킹 예시
</span>    <span class="k">for</span> <span class="n">sensitive</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">apiKey</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">sensitive</span> <span class="o">+</span> <span class="sh">"</span><span class="s">=</span><span class="sh">"</span><span class="p">,</span> <span class="n">sensitive</span> <span class="o">+</span> <span class="sh">"</span><span class="s">=REDACTED</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">apiKey</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                    <span class="n">obj</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">REDACTED</span><span class="sh">"</span>
            <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">text</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">captured</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">request_hook</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">httpx</span><span class="p">.</span><span class="n">Request</span><span class="p">):</span>
        <span class="c1"># request.content는 이미 bytes일 가능성 높음
</span>        <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">body_str</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">replace</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="n">body_str</span> <span class="o">=</span> <span class="nf">repr</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">&lt;no request.content available or streaming body&gt;</span><span class="sh">"</span>
        <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">method</span><span class="sh">"</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">url</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">url</span><span class="p">),</span>
            <span class="sh">"</span><span class="s">headers</span><span class="sh">"</span><span class="p">:</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">)),</span>
            <span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">:</span> <span class="nf">redact_text</span><span class="p">(</span><span class="n">body_str</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">response_hook</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">httpx</span><span class="p">.</span><span class="n">Response</span><span class="p">):</span>
        <span class="c1"># 스트리밍 응답인지 간단 체크 (Content-Type 또는 Transfer-Encoding 참고)
</span>        <span class="n">ct</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">content-type</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
        <span class="n">te</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">transfer-encoding</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
        <span class="n">is_streaming</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">text/event-stream</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">ct</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="sh">"</span><span class="s">chunked</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">te</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_streaming</span><span class="p">:</span>
            <span class="c1"># 스트리밍은 전체 aread() 하지 않고 청크 단위로 처리해야 함
</span>            <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">async</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="p">.</span><span class="nf">aiter_bytes</span><span class="p">():</span>
                <span class="n">chunks</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="n">body_bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># 일반적인 비동기 응답: 전체 바디를 안전하게 읽음
</span>            <span class="n">body_bytes</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="nf">aread</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="n">body_bytes</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">replace</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="nf">repr</span><span class="p">(</span><span class="n">body_bytes</span><span class="p">)</span>

        <span class="c1"># 예쁘게 JSON 포맷 시도
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">body_str</span><span class="p">)</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">status_code</span><span class="sh">"</span><span class="p">:</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">headers</span><span class="sh">"</span><span class="p">:</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">)),</span>
            <span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">:</span> <span class="nf">redact_text</span><span class="p">(</span><span class="n">body_str</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="n">hooks</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">request_hook</span><span class="p">],</span> <span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">response_hook</span><span class="p">]}</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="p">.</span><span class="nc">AsyncClient</span><span class="p">(</span><span class="n">event_hooks</span><span class="o">=</span><span class="n">hooks</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">async_http</span><span class="p">:</span>
        <span class="n">client</span> <span class="o">=</span> <span class="nc">OpenAI</span><span class="p">(</span><span class="n">http_client</span><span class="o">=</span><span class="n">async_http</span><span class="p">)</span>
        <span class="c1"># OpenAI 호출(비동기)
</span>        <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">chat</span><span class="p">.</span><span class="n">completions</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">안녕하세요 (async aread 예제)</span><span class="sh">"</span><span class="p">}],</span>
        <span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Captured request:</span><span class="sh">"</span><span class="p">,</span> <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">])</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Captured response:</span><span class="sh">"</span><span class="p">,</span> <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">][:</span><span class="mi">2000</span><span class="p">]</span> <span class="k">if</span> <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">]</span> <span class="k">else</span> <span class="sh">"</span><span class="s">&lt;none&gt;</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<hr />

<h1 id="추가-팁--주의">추가 팁 / 주의</h1>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">await response.aread()</code>는 <strong>응답이 이미 어느 정도 읽혀있지 않다면 전체 바디를 한 번에</strong> 읽어 캐시합니다. 대부분의 REST 호출(전체 바디가 작음)에는 이 방법이 편하고 안전합니다.</p>
  </li>
  <li>
    <p><strong>스트리밍 API</strong>(SSE, OpenAI의 일부 스트리밍 인터페이스 등)는 <code class="language-plaintext highlighter-rouge">aread()</code>로 읽어버리면 스트림 소비로 인해 원래 의도한 스트리밍 처리(실시간 청크 수신)가 불가능해집니다. 그럴 땐 <code class="language-plaintext highlighter-rouge">aiter_bytes()</code>/<code class="language-plaintext highlighter-rouge">aiter_text()</code>로 청크를 순회하거나 SDK가 제공하는 스트리밍 콜백을 사용하세요.</p>
  </li>
  <li>
    <p>httpx는 바디를 읽어 캐시에 보관하니, 훅에서 <code class="language-plaintext highlighter-rouge">aread()</code>로 읽어도 이후에 <code class="language-plaintext highlighter-rouge">response.text</code>/<code class="language-plaintext highlighter-rouge">response.json()</code>로 접근 가능하긴 합니다(일반적 동작).</p>
  </li>
</ul>

<hr />

<p>원하시면 지금 바로:</p>

<ul>
  <li>
    <p><strong>스트리밍(서버-전송-이벤트)</strong> 를 청크 단위로 안전하게 캡처해 <code class="language-plaintext highlighter-rouge">main()</code> 안의 문자열로 합치는 예제,</p>
  </li>
  <li>
    <p>혹은 <strong>OpenAI SDK의 스트리밍(예:<code class="language-plaintext highlighter-rouge">stream=True</code>)</strong> 에 특화된 캡처 코드(청크마다 처리해서 단일 문자열로 결합)도 만들어 드릴게요. 어떤 걸 원하시나요?</p>
  </li>
</ul>

<p class="chat--user">

1. request쪽 한글이 깨져보여. 그리고 여기도 aread로 바꿔줘. 2. body쪽 내용이 모두 하나의 string으로만 나와서 읽기가 힘들어. 그냥 nested json으로 보이는게 읽기 편할 것 같아.

</p>

<p>좋은 포인트 두 가지 정리해서 바로 반영했어요.</p>

<ul>
  <li>
    <p><strong>(1) 요청(request) 쪽 한글 깨짐</strong> → <code class="language-plaintext highlighter-rouge">Content-Type</code>의 <code class="language-plaintext highlighter-rouge">charset</code>을 확인해 <strong>정확한 인코딩</strong> 으로 디코딩하고, 기본값은 <code class="language-plaintext highlighter-rouge">utf-8</code>로 처리합니다. (OpenAI SDK는 JSON 바디를 기본적으로 UTF-8로 보냅니다.)</p>
  </li>
  <li>
    <p><strong>(2) body를 “한 줄짜리 문자열”이 아니라 “중첩 JSON(파이썬 dict)”</strong> 으로 저장 → 파싱이 되면 <code class="language-plaintext highlighter-rouge">dict/list</code>로 저장하고, 안 되면 텍스트 그대로 둡니다.</p>
  </li>
</ul>

<p>또, <strong>응답(response)</strong> 은 비동기 환경에서 확실히 <code class="language-plaintext highlighter-rouge">await response.aread()</code>로 읽도록 바꿨습니다.<br />
<strong>요청(request)</strong> 객체는 httpx에서 <code class="language-plaintext highlighter-rouge">aread()</code>가 없어서(응답에만 있음) 대신 <strong>바이트 바디를 정확한 인코딩으로 디코딩</strong> 하는 방식으로 처리합니다. (OpenAI SDK처럼 일반 JSON 요청이면 <code class="language-plaintext highlighter-rouge">request.content</code>에서 안전하게 읽힙니다. 진짜 “스트리밍 업로드”를 하신다면 별도 tee 래퍼가 필요합니다—아래에 간단 주석 있습니다.)</p>

<hr />

<h3 id="업데이트된-비동기-예제-전역-변수-없이-main-내부-보관-request-한글인코딩-개선-response는-aread-사용-body는-nested-json으로-저장">업데이트된 비동기 예제 (전역 변수 없이 <code class="language-plaintext highlighter-rouge">main()</code> 내부 보관, request 한글/인코딩 개선, response는 <code class="language-plaintext highlighter-rouge">aread()</code> 사용, body는 nested JSON으로 저장)</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">httpx</span>
<span class="kn">import</span> <span class="n">asyncio</span>
<span class="kn">from</span> <span class="n">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>

<span class="k">def</span> <span class="nf">pick_charset</span><span class="p">(</span><span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="c1"># e.g. "application/json; charset=utf-8"
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">content_type</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">;</span><span class="sh">"</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">.</span><span class="nf">lower</span><span class="p">().</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">charset=</span><span class="sh">"</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nf">strip</span><span class="p">()</span> <span class="ow">or</span> <span class="n">default</span>
    <span class="k">return</span> <span class="n">default</span>

<span class="k">def</span> <span class="nf">try_parse_json</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">api-key</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">k</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">REDACTED</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="k">def</span> <span class="nf">redact_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="c1"># dict/list를 재귀적으로 돌며 민감 키 마스킹
</span>    <span class="n">SENSITIVE_KEYS</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">apiKey</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">}</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="sh">"</span><span class="s">REDACTED</span><span class="sh">"</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">SENSITIVE_KEYS</span> <span class="k">else</span> <span class="nf">redact_obj</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="nf">redact_obj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">obj</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">captured</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">request_hook</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">httpx</span><span class="p">.</span><span class="n">Request</span><span class="p">):</span>
        <span class="c1"># 1) charset 결정
</span>        <span class="n">req_ct</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">content-type</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
        <span class="n">req_charset</span> <span class="o">=</span> <span class="nf">pick_charset</span><span class="p">(</span><span class="n">req_ct</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># 2) 바디 바이트 → 텍스트
</span>        <span class="c1">#    (OpenAI SDK의 JSON 호출이라면 request.content가 bytes로 채워져 있습니다)
</span>        <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">body_text</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="n">req_charset</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">replace</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="c1"># 혹시 모를 인코딩 이슈 대비: 마지막 fallback
</span>                <span class="n">body_text</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">replace</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># 스트리밍 업로드(제너레이터/파일 스트림 등)인 경우 여기에 None이 들어옵니다.
</span>            <span class="c1"># 그런 경우, 별도 "tee stream" 래퍼로 `request.stream`을 감싸서 전송되며 캡처해야 합니다.
</span>            <span class="n">body_text</span> <span class="o">=</span> <span class="sh">"</span><span class="s">&lt;streaming or no request.content&gt;</span><span class="sh">"</span>

        <span class="c1"># 3) nested JSON으로 저장(가능하면)
</span>        <span class="n">body_obj</span> <span class="o">=</span> <span class="nf">try_parse_json</span><span class="p">(</span><span class="n">body_text</span><span class="p">)</span>
        <span class="n">body_saved</span> <span class="o">=</span> <span class="nf">redact_obj</span><span class="p">(</span><span class="n">body_obj</span><span class="p">)</span> <span class="k">if</span> <span class="n">body_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">body_text</span>  <span class="c1"># dict/list면 마스킹, 아니면 원문
</span>
        <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">method</span><span class="sh">"</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">url</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">url</span><span class="p">),</span>
            <span class="sh">"</span><span class="s">headers</span><span class="sh">"</span><span class="p">:</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">)),</span>
            <span class="c1"># 문자열이 아니라, 가능하면 dict/list로 저장됩니다.
</span>            <span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">:</span> <span class="n">body_saved</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">response_hook</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">httpx</span><span class="p">.</span><span class="n">Response</span><span class="p">):</span>
        <span class="c1"># 1) 전체 바디를 비동기로 안전하게 읽음
</span>        <span class="n">body_bytes</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="nf">aread</span><span class="p">()</span>

        <span class="c1"># 2) charset 결정
</span>        <span class="n">res_ct</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">content-type</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
        <span class="n">res_charset</span> <span class="o">=</span> <span class="nf">pick_charset</span><span class="p">(</span><span class="n">res_ct</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># 3) 바디 바이트 → 텍스트
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">body_text</span> <span class="o">=</span> <span class="n">body_bytes</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="n">res_charset</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">replace</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="n">body_text</span> <span class="o">=</span> <span class="n">body_bytes</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">replace</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># 4) nested JSON으로 저장(가능하면)
</span>        <span class="n">body_obj</span> <span class="o">=</span> <span class="nf">try_parse_json</span><span class="p">(</span><span class="n">body_text</span><span class="p">)</span>
        <span class="n">body_saved</span> <span class="o">=</span> <span class="nf">redact_obj</span><span class="p">(</span><span class="n">body_obj</span><span class="p">)</span> <span class="k">if</span> <span class="n">body_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">body_text</span>

        <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">status_code</span><span class="sh">"</span><span class="p">:</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">headers</span><span class="sh">"</span><span class="p">:</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">)),</span>
            <span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">:</span> <span class="n">body_saved</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="n">hooks</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">request_hook</span><span class="p">],</span> <span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">response_hook</span><span class="p">]}</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="p">.</span><span class="nc">AsyncClient</span><span class="p">(</span><span class="n">event_hooks</span><span class="o">=</span><span class="n">hooks</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">async_http</span><span class="p">:</span>
        <span class="n">client</span> <span class="o">=</span> <span class="nc">OpenAI</span><span class="p">(</span><span class="n">http_client</span><span class="o">=</span><span class="n">async_http</span><span class="p">)</span>

        <span class="c1"># 실제 호출(예: chat.completions)
</span>        <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">chat</span><span class="p">.</span><span class="n">completions</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">한글이 제대로 보이는지 확인합니다 😊</span><span class="sh">"</span><span class="p">}],</span>
        <span class="p">)</span>

    <span class="c1"># 여기서 captured["request"]["body"], captured["response"]["body"]는
</span>    <span class="c1"># 가능한 경우 "중첩 JSON(dict/list)"로 저장되어 있습니다.
</span>    <span class="c1"># (JSON이 아니면 디코딩된 텍스트 문자열)
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">REQUEST (nested JSON or text):</span><span class="sh">"</span><span class="p">,</span> <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">])</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">RESPONSE (nested JSON or text):</span><span class="sh">"</span><span class="p">,</span> <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">captured</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<hr />

<h3 id="스트리밍-업로드다운로드를-쓰는-특수-케이스">스트리밍 업로드/다운로드를 쓰는 특수 케이스</h3>

<ul>
  <li>
    <p><strong>요청이 스트리밍 업로드</strong>(파일 제너레이터 등)면 <code class="language-plaintext highlighter-rouge">request.content</code>가 <code class="language-plaintext highlighter-rouge">None</code>일 수 있어요. 이때는 <code class="language-plaintext highlighter-rouge">request.stream</code>(비공개 구현일 수 있음)을 <strong>tee 래퍼</strong> 로 감싸서 전송되는 바이트를 옆에서 모아야 합니다. 필요하시면 tee 래퍼(비동기 제너레이터로 감싸서 bytes를 <code class="language-plaintext highlighter-rouge">yield</code>하면서 내부 버퍼에도 <code class="language-plaintext highlighter-rouge">append</code>) 코드를 만들어 드릴게요.</p>
  </li>
  <li>
    <p><strong>응답이 스트리밍(SSE/청크)</strong> 이면 <code class="language-plaintext highlighter-rouge">await response.aread()</code>로 한 번에 읽지 말고, <code class="language-plaintext highlighter-rouge">async for chunk in response.aiter_bytes():</code> 식으로 <strong>청크를 누적</strong> 해 nested JSON으로 복원(가능시)하거나, 청크 리스트를 합쳐서 나중에 <code class="language-plaintext highlighter-rouge">json.loads()</code>를 시도하세요. 이것도 원하시면 바로 예제 드릴게요.</p>
  </li>
</ul>

<hr />

<p>필요하신 경우:</p>

<ul>
  <li>
    <p><strong>요청/응답 모두 “반드시 dict로만 보관”</strong>하도록 강제하는 버전</p>
  </li>
  <li>
    <p><strong>특정 키만 남기고 나머지 마스킹</strong>(예: <code class="language-plaintext highlighter-rouge">messages</code>만 유지)</p>
  </li>
  <li>
    <p><strong>스트리밍 업/다운로드 tee 래퍼</strong></p>
  </li>
</ul>

<p>어떤 걸 더 원하세요?</p>

<p class="chat--user">

참고로 body_str을 json.load하고 dump 하니 한글이 제대로 보였었어.

</p>

<p>맞아요 — <strong><code class="language-plaintext highlighter-rouge">json.loads()</code> → <code class="language-plaintext highlighter-rouge">json.dumps()</code></strong> 를 거치면 한글이 “정상 글자”로 보이는 이유가 있습니다. 핵심만 정리하고, 바로 적용 가능한 패치도 드릴게요.</p>

<h1 id="왜-load--dump-하면-한글이-제대로-보일까">왜 load → dump 하면 한글이 제대로 보일까?</h1>

<ol>
  <li>
    <p><strong>요청/응답 바이트를 올바른 문자셋(대개 UTF-8)</strong> 으로 <code class="language-plaintext highlighter-rouge">str</code>로 디코딩해야 합니다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">json.loads()</code>로 파싱하면 <strong>파이썬 내부 객체(dict/list)</strong> 가 됩니다. 이 상태에서는 한글이 이미 유니코드로 올바르게 보존돼 있어요.</p>
  </li>
  <li>
    <p>그런데 <code class="language-plaintext highlighter-rouge">json.dumps()</code>의 기본값은 <code class="language-plaintext highlighter-rouge">ensure_ascii=True</code>라서, <strong>비 ASCII 문자를<code class="language-plaintext highlighter-rouge">\uXXXX</code>로 이스케이프</strong>합니다.<br />
→ 이러면 다시 “깨져 보이거나” <code class="language-plaintext highlighter-rouge">\uac00</code> 같은 코드값으로 보일 수 있죠.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">ensure_ascii=False</code>로 <code class="language-plaintext highlighter-rouge">json.dumps(..., ensure_ascii=False, indent=2)</code></strong> 를 쓰면 한글이 그대로 출력됩니다(이스케이프 없이).</p>
  </li>
</ol>

<blockquote>
  <p>즉, “디코딩 → 파싱 → <code class="language-plaintext highlighter-rouge">ensure_ascii=False</code>로 직렬화” 순서가 중요합니다.</p>
</blockquote>

<hr />

<h1 id="바로-적용-1-nested-json-저장--2-보기-좋게-출력ensure_asciifalse">바로 적용: (1) nested JSON 저장 + (2) 보기 좋게 출력(ensure_ascii=False)</h1>

<p>아래는 앞서 드린 비동기 훅 예제에서, <strong>nested JSON으로 저장</strong> 하고 <strong>볼 때는<code class="language-plaintext highlighter-rouge">ensure_ascii=False</code>로 덤프</strong>하도록 살짝 손 본 버전입니다. (응답은 <code class="language-plaintext highlighter-rouge">await response.aread()</code> 유지)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">httpx</span>
<span class="kn">import</span> <span class="n">asyncio</span>
<span class="kn">from</span> <span class="n">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">import</span> <span class="n">sys</span>

<span class="k">def</span> <span class="nf">pick_charset</span><span class="p">(</span><span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">content_type</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">;</span><span class="sh">"</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">.</span><span class="nf">lower</span><span class="p">().</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">charset=</span><span class="sh">"</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nf">strip</span><span class="p">()</span> <span class="ow">or</span> <span class="n">default</span>
    <span class="k">return</span> <span class="n">default</span>

<span class="k">def</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">api-key</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">k</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">REDACTED</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="k">def</span> <span class="nf">redact_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="n">SENSITIVE</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">apiKey</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">}</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="sh">"</span><span class="s">REDACTED</span><span class="sh">"</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">SENSITIVE</span> <span class="k">else</span> <span class="nf">redact_obj</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="nf">redact_obj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">obj</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># (선택) 터미널이 UTF-8이 아닐 수 있으므로 보정
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="nf">reconfigure</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">captured</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">request_hook</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">httpx</span><span class="p">.</span><span class="n">Request</span><span class="p">):</span>
        <span class="n">req_ct</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">content-type</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
        <span class="n">charset</span> <span class="o">=</span> <span class="nf">pick_charset</span><span class="p">(</span><span class="n">req_ct</span><span class="p">,</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">body_text</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="n">charset</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">replace</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">body_text</span> <span class="o">=</span> <span class="sh">"</span><span class="s">&lt;streaming or no request.content&gt;</span><span class="sh">"</span>

        <span class="c1"># 가능하면 nested JSON(dict/list)로 저장
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">body_obj</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">body_text</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="n">body_obj</span> <span class="o">=</span> <span class="n">body_text</span>  <span class="c1"># JSON이 아니면 원문 문자열
</span>
        <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">method</span><span class="sh">"</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">url</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">url</span><span class="p">),</span>
            <span class="sh">"</span><span class="s">headers</span><span class="sh">"</span><span class="p">:</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">)),</span>
            <span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">:</span> <span class="nf">redact_obj</span><span class="p">(</span><span class="n">body_obj</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">response_hook</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">httpx</span><span class="p">.</span><span class="n">Response</span><span class="p">):</span>
        <span class="n">body_bytes</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="nf">aread</span><span class="p">()</span>
        <span class="n">res_ct</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">content-type</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
        <span class="n">charset</span> <span class="o">=</span> <span class="nf">pick_charset</span><span class="p">(</span><span class="n">res_ct</span><span class="p">,</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

        <span class="n">body_text</span> <span class="o">=</span> <span class="n">body_bytes</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="n">charset</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">replace</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">body_obj</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">body_text</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="n">body_obj</span> <span class="o">=</span> <span class="n">body_text</span>

        <span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">status_code</span><span class="sh">"</span><span class="p">:</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">headers</span><span class="sh">"</span><span class="p">:</span> <span class="nf">redact_headers</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">)),</span>
            <span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">:</span> <span class="nf">redact_obj</span><span class="p">(</span><span class="n">body_obj</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="n">hooks</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">request_hook</span><span class="p">],</span> <span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">response_hook</span><span class="p">]}</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="p">.</span><span class="nc">AsyncClient</span><span class="p">(</span><span class="n">event_hooks</span><span class="o">=</span><span class="n">hooks</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">async_http</span><span class="p">:</span>
        <span class="n">client</span> <span class="o">=</span> <span class="nc">OpenAI</span><span class="p">(</span><span class="n">http_client</span><span class="o">=</span><span class="n">async_http</span><span class="p">)</span>

        <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">chat</span><span class="p">.</span><span class="n">completions</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">한글이 잘 보이는지 테스트합니다. 😄</span><span class="sh">"</span><span class="p">}],</span>
        <span class="p">)</span>

    <span class="c1"># === 보기 좋게 출력: ensure_ascii=False + indent ===
</span>    <span class="k">def</span> <span class="nf">pretty</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== REQUEST ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">pretty</span><span class="p">(</span><span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">request</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">]))</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== RESPONSE ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">pretty</span><span class="p">(</span><span class="n">captured</span><span class="p">[</span><span class="sh">"</span><span class="s">response</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">captured</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<h3 id="포인트">포인트</h3>

<ul>
  <li>
    <p><strong>저장 단계</strong> : 가능하면 <code class="language-plaintext highlighter-rouge">dict/list</code> 형태로 <strong>그대로 저장</strong> 합니다(“한 줄 문자열” 대신 중첩 구조).</p>
  </li>
  <li>
    <p><strong>출력/확인 단계</strong> : <code class="language-plaintext highlighter-rouge">json.dumps(..., ensure_ascii=False, indent=2)</code> 로 덤프하면 <strong>한글이 그대로</strong> 나오고 <strong>가독성</strong> 도 좋아집니다.</p>
  </li>
  <li>
    <p><strong>콘솔 인코딩</strong> : Windows 등에서 콘솔 인코딩 문제로 깨질 수 있으니 <code class="language-plaintext highlighter-rouge">sys.stdout.reconfigure(encoding="utf-8")</code> 시도(실패해도 무시).</p>
  </li>
</ul>

<hr />

<h1 id="빠른-체크리스트-step-by-step">빠른 체크리스트 (step-by-step)</h1>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Content-Type</code>에서 <strong>charset 확인</strong> (없으면 UTF-8 가정).</p>
  </li>
  <li>
    <p>바이트 → 문자열 <strong>디코딩</strong>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">json.loads()</code>로 <strong>객체화</strong>(되면 dict/list로 저장).</p>
  </li>
  <li>
    <p>출력할 때 <code class="language-plaintext highlighter-rouge">json.dumps(..., ensure_ascii=False, indent=2)</code> 사용.</p>
  </li>
  <li>
    <p>콘솔 인코딩이 UTF-8인지 확인(필요 시 <code class="language-plaintext highlighter-rouge">PYTHONIOENCODING=UTF-8</code> 환경변수 또는 위 코드).</p>
  </li>
</ol>

<p>원하시면 <strong>요청/응답에서 특정 키만 골라서 pretty-print</strong> 하도록 필터링까지 넣어드릴게요. 어떤 키들만 보이면 좋을까요?</p>]]></content><author><name>hvppyarchive</name></author><category term="python" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">Pickle to JSON 변환</title><link href="https://hvppyarchive.github.io/python/pickle-to-json/" rel="alternate" type="text/html" title="Pickle to JSON 변환" /><published>2025-09-29T10:41:41+09:00</published><updated>2025-09-29T10:41:41+09:00</updated><id>https://hvppyarchive.github.io/python/pickle-to-json</id><content type="html" xml:base="https://hvppyarchive.github.io/python/pickle-to-json/"><![CDATA[<p class="chat--user">

너는 파이썬 프로그래밍 전문가야. python pickle로 저장된 데이터가 있어. 이걸 읽어서 그 안의 모든 객체 tree를 json 형태로 뱉도록 하고 싶어. 이 때 pickle은 커스텀 클래스를 담고 있어. 이걸 해내기 위해서 어떻게 접근해야할까? 최대한 에러가 없이 동작하도록 고민해줘. Step by Step으로 생각해줘.

</p>

<p>좋아, “피클 → 안전하고 튼튼한 JSON”을 목표로 단계별로 설계해볼게. (코드 샘플도 아래에 한 방에 넣어뒀어.)</p>

<h1 id="step-by-step-접근">Step by Step 접근</h1>

<h2 id="1-위협-모델전략-먼저-결정">1) 위협 모델/전략 먼저 결정</h2>

<ul>
  <li>
    <p><strong>pickle은 임의 코드 실행 위험</strong> 이 있어. <em>출처가 100% 신뢰되는 파일만</em> 바로 <code class="language-plaintext highlighter-rouge">pickle.load</code> 하면 되고, 그 외에는 “제한 해제”를 절대 하지 말아야 해.</p>
  </li>
  <li>
    <p>따라서 두 가지 모드를 추천:</p>

    <ol>
      <li>
        <p><strong>신뢰 모드(trusted)</strong> : 그냥 로드 → 직렬화.</p>
      </li>
      <li>
        <p><strong>세이프 모드(safe/whitelist)</strong> : 허용 목록(모듈.클래스)을 지정한 <code class="language-plaintext highlighter-rouge">RestrictedUnpickler</code>로만 언피클.</p>
      </li>
    </ol>
  </li>
</ul>

<h2 id="2-미리-무엇이-들어있는지-검사">2) 미리 “무엇이 들어있는지” 검사</h2>

<ul>
  <li>
    <p>언피클을 실행하지 않고 <code class="language-plaintext highlighter-rouge">pickletools.genops</code>로 피클 스트림의 <code class="language-plaintext highlighter-rouge">GLOBAL/STACK_GLOBAL</code> opcode를 스캔해서, 필요한 클래스/모듈 목록을 뽑아본다.</p>
  </li>
  <li>
    <p>그 결과를 보고 <strong>화이트리스트</strong> 를 만든다. (예: <code class="language-plaintext highlighter-rouge">{"mymodels.User", "numpy.ndarray"}</code>)</p>
  </li>
</ul>

<h2 id="3-안전한-로더-만들기">3) 안전한 로더 만들기</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">pickle.Unpickler</code>를 상속해서 <code class="language-plaintext highlighter-rouge">find_class</code>를 오버라이드.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">builtins</code>의 기본 컨테이너 정도만 허용하고, 나머지는 <strong>화이트리스트에 있는 것만 통과</strong>.</p>
  </li>
  <li>
    <p>화이트리스트에 없는 건 <code class="language-plaintext highlighter-rouge">UnpicklingError</code>로 막는다.</p>
  </li>
</ul>

<h2 id="4-json-가능-형태로-변환기-설계">4) “JSON 가능 형태”로 변환기 설계</h2>

<p>JSON은 다음을 그대로 표현 못 하거나 깨지기 쉬워:</p>

<ul>
  <li>
    <p>순환/공유 참조(cycles/aliases), 사용자 정의 객체, <code class="language-plaintext highlighter-rouge">set/tuple</code>, <code class="language-plaintext highlighter-rouge">bytes</code>, <code class="language-plaintext highlighter-rouge">datetime</code>, <code class="language-plaintext highlighter-rouge">Decimal/UUID</code>, <code class="language-plaintext highlighter-rouge">numpy/pandas/torch</code> 등.</p>
  </li>
  <li>
    <p><strong>원칙</strong> : “가능하면 손실 없이”, “그래도 항상 직렬화되게”.</p>

    <ul>
      <li>
        <p><strong>순환/공유 참조</strong> : <code class="language-plaintext highlighter-rouge">"$id"</code>/<code class="language-plaintext highlighter-rouge">"$ref"</code> 프로토콜을 사용 (예: <code class="language-plaintext highlighter-rouge">{"$id":"obj1", "value": ...}</code>, 참조는 <code class="language-plaintext highlighter-rouge">{"$ref":"obj1"}</code>).</p>
      </li>
      <li>
        <p><strong>커스텀 클래스</strong> : 우선 순위대로</p>

        <ol>
          <li>
            <p><code class="language-plaintext highlighter-rouge">__json__()</code> → 딕트/리스트 등</p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">to_json()</code> / <code class="language-plaintext highlighter-rouge">to_dict()</code> / <code class="language-plaintext highlighter-rouge">model_dump()</code>(pydantic)</p>
          </li>
          <li>
            <p>dataclass → <code class="language-plaintext highlighter-rouge">asdict</code></p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">__getstate__()</code> or <code class="language-plaintext highlighter-rouge">__dict__</code></p>
          </li>
          <li>
            <p>마지막 수단: <code class="language-plaintext highlighter-rouge">repr(obj)</code>에 타입 메타(<code class="language-plaintext highlighter-rouge">"$type"</code>).</p>
          </li>
        </ol>
      </li>
      <li>
        <p><strong>특수 타입들</strong> (가능한 한 보존):</p>

        <ul>
          <li>
            <p><code class="language-plaintext highlighter-rouge">set/frozenset</code> → <code class="language-plaintext highlighter-rouge">{"$type":"set","items":[...]}</code></p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">tuple</code> → <code class="language-plaintext highlighter-rouge">{"$type":"tuple","items":[...]}</code></p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">bytes/bytearray</code> → <code class="language-plaintext highlighter-rouge">{"$type":"bytes","base64":"..."}</code></p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">datetime/date/time</code> → <code class="language-plaintext highlighter-rouge">{"$type":"datetime","iso":"..."}</code></p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">Decimal</code> → <code class="language-plaintext highlighter-rouge">{"$type":"decimal","value":"..."}</code></p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">UUID</code> → <code class="language-plaintext highlighter-rouge">{"$type":"uuid","value":"..."}</code></p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">Path</code> → <code class="language-plaintext highlighter-rouge">{"$type":"path","value":"..."}</code></p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">re.Pattern</code> → 패턴/플래그 보존</p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">Enum</code> → 이름/값 보존</p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">Exception</code> → 타입/args/str</p>
          </li>
          <li>
            <p><strong>NumPy</strong> : <code class="language-plaintext highlighter-rouge">ndarray</code>는 <code class="language-plaintext highlighter-rouge">.tolist()</code> + shape/dtype 메타</p>
          </li>
          <li>
            <p><strong>pandas</strong> : DataFrame/Series는 <code class="language-plaintext highlighter-rouge">to_dict(orient="records")</code> 등 + 메타</p>
          </li>
          <li>
            <p><strong>PyTorch/TensorFlow</strong> 텐서는 <code class="language-plaintext highlighter-rouge">.detach().cpu().numpy().tolist()</code> 등으로 값만 (가능하면 dtype/shape 메타 포함)</p>
          </li>
        </ul>
      </li>
      <li>
        <p><strong>dict의 비문자열 키</strong> : JSON은 키가 문자열만 되므로</p>

        <ul>
          <li>
            <p>전부 문자열이면 그대로 유지</p>
          </li>
          <li>
            <p>아니면 <code class="language-plaintext highlighter-rouge">{"$type":"dict","entries":[[key,value], ...]}</code> 형태로 보존</p>
          </li>
        </ul>
      </li>
      <li>
        <p><strong>깊이 제한/메모</strong> : 무한 재귀 방지 위해 <code class="language-plaintext highlighter-rouge">seen</code>(id→$id) 메모와 <code class="language-plaintext highlighter-rouge">max_depth</code> 도입.</p>
      </li>
      <li>
        <p><strong>마지막 안전판</strong> : 무엇이든 실패하면 <code class="language-plaintext highlighter-rouge">repr</code> + <code class="language-plaintext highlighter-rouge">"$error"</code> 메타를 달아 절대 실패하지 않게.</p>
      </li>
    </ul>
  </li>
</ul>

<h2 id="5-덤프-옵션">5) 덤프 옵션</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">json.dumps(jsonable, ensure_ascii=False, indent=2, allow_nan=False)</code>를 권장.</p>
  </li>
  <li>
    <p>파일이 크면 <code class="language-plaintext highlighter-rouge">indent=None</code>로 용량 최소화.</p>
  </li>
  <li>
    <p>덤프 후 한 번 <code class="language-plaintext highlighter-rouge">json.loads</code>로 <strong>역파싱 검증</strong> 하면 실수 줄일 수 있어.</p>
  </li>
</ul>

<h2 id="6-대안-라이브러리-사용">6) 대안: 라이브러리 사용</h2>

<ul>
  <li>
    <p><strong>jsonpickle</strong> 은 자체적으로 클래스/참조를 잘 처리한다. 빠르게 되고 범용성이 좋지만, <em>언피클 단계의 보안은 별도 처리</em> 가 필요하다(즉, <code class="language-plaintext highlighter-rouge">RestrictedUnpickler</code>는 여전히 필요).</p>
  </li>
  <li>
    <p>직접 규칙을 통제하고 싶으면 아래 커스텀 직렬화기를 쓰는 게 안전/예측 가능.</p>
  </li>
</ul>

<hr />

<h1 id="견고한-예시-코드-스크립트-1개로-동작">견고한 예시 코드 (스크립트 1개로 동작)</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
# pickle_to_json.py
</span><span class="kn">import</span> <span class="n">io</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">base64</span><span class="p">,</span> <span class="n">math</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">pickle</span><span class="p">,</span> <span class="n">pickletools</span><span class="p">,</span> <span class="n">importlib</span>
<span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">is_dataclass</span><span class="p">,</span> <span class="n">asdict</span>
<span class="kn">from</span> <span class="n">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<span class="kn">from</span> <span class="n">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="n">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="c1"># --- Optional dependencies detection ---
</span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="n">np</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="n">pd</span> <span class="o">=</span> <span class="bp">None</span>

<span class="c1"># ---------- 1) 분석: 피클 안의 글로벌 심볼 스캔 ----------
</span><span class="k">def</span> <span class="nf">audit_pickle_globals</span><span class="p">(</span><span class="n">pkl_bytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">언피클 없이 GLOBAL/STACK_GLOBAL 사용 내역을 (module.name) 집합으로 리턴.</span><span class="sh">"""</span>
    <span class="n">refs</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">pickletools</span><span class="p">.</span><span class="nf">genops</span><span class="p">(</span><span class="n">pkl_bytes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">op</span><span class="p">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">GLOBAL</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">STACK_GLOBAL</span><span class="sh">"</span><span class="p">):</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">mod</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">arg</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># For GLOBAL, arg like "module\nname\n"
</span>                <span class="n">parts</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">arg</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">mod</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">refs</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">mod</span><span class="si">}</span><span class="s">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">refs</span>

<span class="c1"># ---------- 2) 화이트리스트 기반 Restricted Unpickler ----------
</span><span class="k">class</span> <span class="nc">RestrictedUnpickler</span><span class="p">(</span><span class="n">pickle</span><span class="p">.</span><span class="n">Unpickler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">allowed</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">allowed</span> <span class="o">=</span> <span class="nf">set</span><span class="p">(</span><span class="n">allowed</span> <span class="ow">or</span> <span class="p">[])</span>

    <span class="k">def</span> <span class="nf">find_class</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">full</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="sh">"</span>
        <span class="c1"># 빌트인 컨테이너/예외/기본 타입 일부 허용
</span>        <span class="n">allowed_builtins</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">builtins.set</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">builtins.frozenset</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">builtins.bytes</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">builtins.bytearray</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">builtins.complex</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">builtins.Exception</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">builtins.slice</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">builtins.range</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">builtins.dict</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">builtins.list</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">builtins.tuple</span><span class="sh">"</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">full</span> <span class="ow">in</span> <span class="n">allowed_builtins</span> <span class="ow">or</span> <span class="n">full</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">allowed</span><span class="p">:</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">importlib</span><span class="p">.</span><span class="nf">import_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">pickle</span><span class="p">.</span><span class="nc">UnpicklingError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">forbidden global: </span><span class="si">{</span><span class="n">full</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">restricted_loads</span><span class="p">(</span><span class="n">pkl_bytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">allowed</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="nc">RestrictedUnpickler</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="nc">BytesIO</span><span class="p">(</span><span class="n">pkl_bytes</span><span class="p">),</span> <span class="n">allowed</span><span class="o">=</span><span class="n">allowed</span><span class="p">).</span><span class="nf">load</span><span class="p">()</span>

<span class="c1"># ---------- 3) JSON 직렬화기 ----------
</span><span class="n">JSON_PRIMITIVES</span> <span class="o">=</span> <span class="p">(</span><span class="nf">type</span><span class="p">(</span><span class="bp">None</span><span class="p">),</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">is_primitive</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">JSON_PRIMITIVES</span><span class="p">):</span>
        <span class="c1"># NaN/Inf는 allow_nan=False에 막히므로 문자열 처리
</span>        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="nf">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="n">math</span><span class="p">.</span><span class="nf">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="c1"># 너무 큰 int는 JS에서 안전하지 않지만 JSON 스펙엔 문제 없음. 필요시 문자열화 가능.
</span>        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">_pattern_type</span><span class="p">():</span>
    <span class="c1"># Py&gt;=3.8: re.Pattern, Py&lt;3.8: type(re.compile(''))
</span>    <span class="n">pat</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="sh">"</span><span class="s">Pattern</span><span class="sh">"</span><span class="p">,</span> <span class="nf">type</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="nf">compile</span><span class="p">(</span><span class="sh">""</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">pat</span>

<span class="k">def</span> <span class="nf">to_jsonable</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">seen</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">객체 그래프를 JSON 가능 구조로 변환(+ 순환/참조 보존). 절대 예외 던지지 않음.</span><span class="sh">"""</span>
    <span class="k">if</span> <span class="n">seen</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># 깊이 보호
</span>    <span class="k">if</span> <span class="n">_depth</span> <span class="o">&gt;</span> <span class="n">max_depth</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">depth_truncated</span><span class="sh">"</span><span class="p">}</span>

    <span class="c1"># 기본형
</span>    <span class="k">if</span> <span class="nf">is_primitive</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="n">oid</span> <span class="o">=</span> <span class="nf">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="c1"># 불변이지만 큰 튜플/프리미티브 아닌 객체에도 id를 부여해 참조 보존
</span>    <span class="k">if</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$ref</span><span class="sh">"</span><span class="p">:</span> <span class="n">seen</span><span class="p">[</span><span class="n">oid</span><span class="p">]}</span>

    <span class="c1"># 새 객체에 $id 할당
</span>    <span class="n">sid</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">obj</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">seen</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="sh">"</span>
    <span class="n">seen</span><span class="p">[</span><span class="n">oid</span><span class="p">]</span> <span class="o">=</span> <span class="n">sid</span>

    <span class="c1"># bytes/bytearray
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">,</span> <span class="nb">memoryview</span><span class="p">)):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nf">bytes</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">bytes</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">base64</span><span class="sh">"</span><span class="p">:</span> <span class="n">base64</span><span class="p">.</span><span class="nf">b64encode</span><span class="p">(</span><span class="n">b</span><span class="p">).</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">ascii</span><span class="sh">"</span><span class="p">),</span> <span class="sh">"</span><span class="s">length</span><span class="sh">"</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">b</span><span class="p">)}</span>

    <span class="c1"># datetime-like
</span>    <span class="kn">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">_dt</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">_dt</span><span class="p">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">_dt</span><span class="p">.</span><span class="n">date</span><span class="p">,</span> <span class="n">_dt</span><span class="p">.</span><span class="n">time</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">iso</span> <span class="o">=</span> <span class="n">obj</span><span class="p">.</span><span class="nf">isoformat</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="n">iso</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">.</span><span class="nf">lower</span><span class="p">(),</span> <span class="sh">"</span><span class="s">iso</span><span class="sh">"</span><span class="p">:</span> <span class="n">iso</span><span class="p">}</span>

    <span class="c1"># Decimal / UUID / Path
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">decimal</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)}</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">UUID</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">uuid</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)}</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">path</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)}</span>

    <span class="c1"># 정규식 패턴
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nf">_pattern_type</span><span class="p">()):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">regex</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">pattern</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">pattern</span><span class="p">,</span> <span class="sh">"</span><span class="s">flags</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">flags</span><span class="p">}</span>

    <span class="c1"># Enum
</span>    <span class="kn">import</span> <span class="n">enum</span> <span class="k">as</span> <span class="n">_enum</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">_enum</span><span class="p">.</span><span class="n">Enum</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">enum:</span><span class="si">{</span><span class="n">obj</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">value</span><span class="p">}</span>

    <span class="c1"># 예외
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">BaseException</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">exception:</span><span class="si">{</span><span class="n">obj</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">args</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="nf">to_jsonable</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">_depth</span><span class="o">=</span><span class="n">_depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">.</span><span class="n">args</span><span class="p">],</span>
            <span class="sh">"</span><span class="s">str</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="c1"># NumPy
</span>    <span class="k">if</span> <span class="n">np</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">numpy.ndarray</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">shape</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span> <span class="sh">"</span><span class="s">dtype</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">dtype</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="nf">tolist</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">generic</span><span class="p">):</span>  <span class="c1"># numpy scalar
</span>            <span class="k">return</span> <span class="n">obj</span><span class="p">.</span><span class="nf">item</span><span class="p">()</span>

    <span class="c1"># pandas
</span>    <span class="k">if</span> <span class="n">pd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">pandas.DataFrame</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="nf">tolist</span><span class="p">(),</span>
                <span class="sh">"</span><span class="s">records</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="nf">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="sh">"</span><span class="s">records</span><span class="sh">"</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">pandas.Series</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">values</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="nf">to_list</span><span class="p">(),</span>
                <span class="sh">"</span><span class="s">index</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="nf">tolist</span><span class="p">(),</span>
            <span class="p">}</span>

    <span class="c1"># torch / tf 텐서 (가능하면 값만)
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="n">torch</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">torch</span><span class="p">.</span><span class="n">Tensor</span><span class="p">):</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">obj</span><span class="p">.</span><span class="nf">detach</span><span class="p">().</span><span class="nf">cpu</span><span class="p">().</span><span class="nf">numpy</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">torch.Tensor</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">shape</span><span class="sh">"</span><span class="p">:</span> <span class="nf">list</span><span class="p">(</span><span class="n">arr</span><span class="p">.</span><span class="n">shape</span><span class="p">),</span> <span class="sh">"</span><span class="s">dtype</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">arr</span><span class="p">.</span><span class="n">dtype</span><span class="p">),</span> <span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">:</span> <span class="n">arr</span><span class="p">.</span><span class="nf">tolist</span><span class="p">()}</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="n">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">Tensor</span><span class="p">,)):</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">obj</span><span class="p">.</span><span class="nf">numpy</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">tf.Tensor</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">shape</span><span class="sh">"</span><span class="p">:</span> <span class="nf">list</span><span class="p">(</span><span class="n">arr</span><span class="p">.</span><span class="n">shape</span><span class="p">),</span> <span class="sh">"</span><span class="s">dtype</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">arr</span><span class="p">.</span><span class="n">dtype</span><span class="p">),</span> <span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">:</span> <span class="n">arr</span><span class="p">.</span><span class="nf">tolist</span><span class="p">()}</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># set / frozenset
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">)):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">items</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="nf">to_jsonable</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">_depth</span><span class="o">=</span><span class="n">_depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">],</span>
        <span class="p">}</span>

    <span class="c1"># tuple / list
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="nf">to_jsonable</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">_depth</span><span class="o">=</span><span class="n">_depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">]</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">tuple</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">items</span><span class="sh">"</span><span class="p">:</span> <span class="n">items</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">items</span>  <span class="c1"># list는 흔히 그대로
</span>
    <span class="c1"># dict / mapping
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="c1"># 모든 키가 문자열이면 평범한 dict 유지
</span>        <span class="k">if</span> <span class="nf">all</span><span class="p">(</span><span class="nf">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">.</span><span class="nf">keys</span><span class="p">()):</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nf">to_jsonable</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">_depth</span><span class="o">=</span><span class="n">_depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>
        <span class="c1"># 아니면 entries로 보존
</span>        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">dict</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">entries</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">[</span><span class="nf">to_jsonable</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">_depth</span><span class="o">=</span><span class="n">_depth</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                 <span class="nf">to_jsonable</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">_depth</span><span class="o">=</span><span class="n">_depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span>
            <span class="p">],</span>
        <span class="p">}</span>

    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">OrderedDict</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">entries</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">[</span><span class="nf">to_jsonable</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">_depth</span><span class="o">=</span><span class="n">_depth</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                 <span class="nf">to_jsonable</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">_depth</span><span class="o">=</span><span class="n">_depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span>
            <span class="p">],</span>
        <span class="p">}</span>

    <span class="c1"># dataclass / attrs / pydantic / 사용자 정의 클래스
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># dataclass
</span>        <span class="k">if</span> <span class="nf">is_dataclass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="nf">asdict</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">,</span> <span class="sh">"</span><span class="s">fields</span><span class="sh">"</span><span class="p">:</span>
                    <span class="nf">to_jsonable</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">_depth</span><span class="o">=</span><span class="n">_depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)}</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># attrs
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="n">attr</span>
        <span class="k">if</span> <span class="n">attr</span><span class="p">.</span><span class="nf">has</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">attr</span><span class="p">.</span><span class="nf">asdict</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">,</span> <span class="sh">"</span><span class="s">fields</span><span class="sh">"</span><span class="p">:</span>
                    <span class="nf">to_jsonable</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">_depth</span><span class="o">=</span><span class="n">_depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)}</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># pydantic
</span>    <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sh">"</span><span class="s">model_dump</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="nf">callable</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sh">"</span><span class="s">model_dump</span><span class="sh">"</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">obj</span><span class="p">.</span><span class="nf">model_dump</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">,</span> <span class="sh">"</span><span class="s">fields</span><span class="sh">"</span><span class="p">:</span>
                    <span class="nf">to_jsonable</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">_depth</span><span class="o">=</span><span class="n">_depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)}</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1"># 커스텀 메서드들
</span>    <span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">__json__</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">to_json</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">to_dict</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">meth</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nf">callable</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">payload</span> <span class="o">=</span> <span class="nf">fn</span><span class="p">()</span>
                <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">,</span> <span class="sh">"</span><span class="s">fields</span><span class="sh">"</span><span class="p">:</span>
                        <span class="nf">to_jsonable</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">_depth</span><span class="o">=</span><span class="n">_depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)}</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="c1"># __getstate__ / __dict__
</span>    <span class="n">state</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sh">"</span><span class="s">__getstate__</span><span class="sh">"</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">obj</span><span class="p">.</span><span class="nf">__getstate__</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sh">"</span><span class="s">__dict__</span><span class="sh">"</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">__dict__</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">,</span> <span class="sh">"</span><span class="s">state</span><span class="sh">"</span><span class="p">:</span>
                <span class="nf">to_jsonable</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">_depth</span><span class="o">=</span><span class="n">_depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)}</span>

    <span class="c1"># 마지막 안전판
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="nf">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">&lt;unreprable </span><span class="si">{</span><span class="n">obj</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="si">}</span><span class="s">&gt;</span><span class="sh">"</span>
    <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">$id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sid</span><span class="p">,</span> <span class="sh">"</span><span class="s">$type</span><span class="sh">"</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">,</span> <span class="sh">"</span><span class="s">repr</span><span class="sh">"</span><span class="p">:</span> <span class="n">rep</span><span class="p">,</span> <span class="sh">"</span><span class="s">$error</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">fallback_repr</span><span class="sh">"</span><span class="p">}</span>

<span class="c1"># ---------- 4) 최종 유틸 ----------
</span><span class="k">def</span> <span class="nf">pickle_to_json_bytes</span><span class="p">(</span><span class="n">pkl_bytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">safe</span><span class="sh">"</span><span class="p">,</span> <span class="n">allow</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                         <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">safe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">trusted</span><span class="sh">"</span><span class="p">):</span>
        <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">mode must be </span><span class="sh">'</span><span class="s">safe</span><span class="sh">'</span><span class="s"> or </span><span class="sh">'</span><span class="s">trusted</span><span class="sh">'"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="sh">"</span><span class="s">safe</span><span class="sh">"</span><span class="p">:</span>
        <span class="c1"># 사전 점검: 어떤 클래스가 필요한지
</span>        <span class="n">needed</span> <span class="o">=</span> <span class="nf">audit_pickle_globals</span><span class="p">(</span><span class="n">pkl_bytes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">allow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">allow</span> <span class="o">=</span> <span class="nf">set</span><span class="p">(</span><span class="n">allow</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">allow</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
        <span class="c1"># numpy/pandas 등 자동 허용 (있을 때)
</span>        <span class="k">if</span> <span class="n">np</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">allow</span><span class="p">.</span><span class="nf">update</span><span class="p">({</span><span class="sh">"</span><span class="s">numpy.ndarray</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">numpy.dtype</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">numpy.core.numeric.complexfloating</span><span class="sh">"</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">pd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">allow</span><span class="p">.</span><span class="nf">update</span><span class="p">({</span><span class="sh">"</span><span class="s">pandas.core.frame.DataFrame</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">pandas.core.series.Series</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">pandas.core.indexes.base.Index</span><span class="sh">"</span><span class="p">})</span>
        <span class="c1"># 필요하지만 화이트리스트에 없는 것 있으면 경고(여기선 예외로 명확히)
</span>        <span class="n">missing</span> <span class="o">=</span> <span class="n">needed</span> <span class="o">-</span> <span class="n">allow</span> <span class="o">-</span> <span class="p">{</span>
            <span class="c1"># 종종 피클 스트림에 등장하는 builtins/eval 보조들 (이미 Restricted에서 기본 거름)
</span>        <span class="p">}</span>
        <span class="c1"># 실제로는 사용자에게 리스트를 보여주고 승인받는 게 가장 안전
</span>        <span class="c1"># 여기서는 '허용 안 된 심볼이 있다'면 실패 처리
</span>        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">pickle</span><span class="p">.</span><span class="nc">UnpicklingError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Unapproved classes in pickle: </span><span class="si">{</span><span class="nf">sorted</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="nf">restricted_loads</span><span class="p">(</span><span class="n">pkl_bytes</span><span class="p">,</span> <span class="n">allowed</span><span class="o">=</span><span class="n">allow</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># trusted
</span>        <span class="n">obj</span> <span class="o">=</span> <span class="n">pickle</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">pkl_bytes</span><span class="p">)</span>

    <span class="n">jsonable</span> <span class="o">=</span> <span class="nf">to_jsonable</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">jsonable</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="n">ensure_ascii</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span> <span class="n">allow_nan</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c1"># 역파싱 검증
</span>    <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">txt</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ---------- 5) CLI ----------
</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="kn">import</span> <span class="n">argparse</span><span class="p">,</span> <span class="n">os</span>
    <span class="n">ap</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="nc">ArgumentParser</span><span class="p">()</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">input</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">input .pkl file</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">output</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">output .json file</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--mode</span><span class="sh">"</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">safe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">trusted</span><span class="sh">"</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="sh">"</span><span class="s">safe</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--allow</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">extra allowed </span><span class="sh">'</span><span class="s">module.Class</span><span class="sh">'</span><span class="s"> (repeatable)</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--no-indent</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">ap</span><span class="p">.</span><span class="nf">parse_args</span><span class="p">()</span>

    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="nb">input</span><span class="p">,</span> <span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pkl</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>

    <span class="n">indent</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">no_indent</span> <span class="k">else</span> <span class="mi">2</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nf">pickle_to_json_bytes</span><span class="p">(</span><span class="n">pkl</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">allow</span><span class="o">=</span><span class="nf">set</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">allow</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>

    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">output</span><span class="p">,</span> <span class="sh">"</span><span class="s">wb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Wrote </span><span class="si">{</span><span class="n">args</span><span class="p">.</span><span class="n">output</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="사용-예">사용 예</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1) 먼저 어떤 클래스가 필요한지 확인만 해보려면 (스크립트 수정 없이 간단 확인)</span>
python <span class="nt">-c</span> <span class="s2">"import sys, pickletools; import pathlib; p=pathlib.Path(sys.argv[1]).read_bytes(); </span><span class="se">\</span><span class="s2">
print({(a.split('</span><span class="se">\n</span><span class="s2">')[0]+'.'+a.split('</span><span class="se">\n</span><span class="s2">')[1]) for (op,a,_) in pickletools.genops(p) if op.name in ('GLOBAL','STACK_GLOBAL')})"</span> mydata.pkl

<span class="c"># 2) 안전 모드에서 허용 클래스 지정 후 변환</span>
python pickle_to_json.py mydata.pkl mydata.json <span class="nt">--mode</span> safe <span class="nt">--allow</span> mypkg.models.User <span class="nt">--allow</span> mypkg.models.Order

<span class="c"># 3) 신뢰 모드(출처가 확실할 때만)</span>
python pickle_to_json.py mydata.pkl mydata.json <span class="nt">--mode</span> trusted
</code></pre></div></div>

<hr />

<h1 id="실무-팁-에러-최소화-포인트">실무 팁 (에러 최소화 포인트)</h1>

<ol>
  <li>
    <p><strong>화이트리스트는 점진적으로 넓혀라</strong><br />
먼저 “막고 → 필요한 것만 허용”이 안전하고, 에러도 찾기 쉽다. 허용할 때는 <strong>정확한 풀네임(module.Class)</strong> 로.</p>
  </li>
  <li>
    <p><strong>커스텀 클래스에<code class="language-plaintext highlighter-rouge">__json__</code> 또는 <code class="language-plaintext highlighter-rouge">to_dict()</code> 추가</strong><br />
프로젝트 내부 클래스라면 여기에 직렬화 규칙을 넣어두면, 변환기가 알아서 호출하므로 실패율이 크게 준다.</p>
  </li>
  <li>
    <p><strong>순환 참조가 많은 그래프는<code class="language-plaintext highlighter-rouge">$id/$ref</code> 스킴 필수</strong><br />
JSON 순환은 불가하니, 위 스킴 같은 <strong>참조 표현</strong> 을 반드시 도입해야 데이터 손실/오류가 없다.</p>
  </li>
  <li>
    <p><strong>거대한 배열/데이터프레임은 별도 파일 고려</strong><br />
JSON은 용량/속도에 약하다. 정말 크면 <code class="language-plaintext highlighter-rouge">.npy</code>나 <code class="language-plaintext highlighter-rouge">.parquet</code>를 <strong>사이드카</strong> 로 저장하고 JSON에는 메타/경로만 넣는 전략이 좋다.</p>
  </li>
  <li>
    <p><strong>덤프 전에 변환만 먼저 실행해보기</strong><br />
<code class="language-plaintext highlighter-rouge">to_jsonable(obj)</code> 결과를 한 번 찍어보면 어떤 타입이 어떻게 나오는지 바로 파악 가능. 실패 지점이 드러난다.</p>
  </li>
  <li>
    <p><strong>로스리스가 중요하면 타입 메타를 꼭 남겨라</strong><br />
<code class="language-plaintext highlighter-rouge">"$type"</code>, <code class="language-plaintext highlighter-rouge">shape</code>, <code class="language-plaintext highlighter-rouge">dtype</code> 같은 메타가 재구성에 필수다.</p>
  </li>
  <li>
    <p><strong>테스트</strong></p>

    <ul>
      <li>
        <p>작은 샘플 피클로 시작 → 점진 확대</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">json.loads(dumps(...))</code> 역파싱 검증</p>
      </li>
      <li>
        <p>대표 케이스: set/tuple/bytes/datetime/enum/numpy/pandas/커스텀 클래스를 모두 포함하는 합성 테스트</p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<p>원하면 위 스크립트를 네 상황에 맞게 더 최소/간결화하거나, <code class="language-plaintext highlighter-rouge">jsonpickle</code>을 활용한 초간단 버전도 만들어줄게.</p>

<p class="chat--user">

1. 그냥 모든걸 trust로 하고 싶어. 모두 내가 만든 파일들이야. 2. 질문. 파이썬 버전은 상관 없을까? 3. jsonpickle을 사용해서 간단해진다면 그렇게 해줘

</p>

<p>좋아! 네 3가지 조건(1. 전부 trust 모드, 2. 파이썬 버전 이슈, 3. jsonpickle로 간단히) 기준으로, 에러를 최소화하는 <strong>실전용 절차 + 바로 쓸 수 있는 스크립트</strong> 까지 준비했어.</p>

<h1 id="step-by-step">Step by Step</h1>

<h2 id="1-전략-요약-trust-모드">1) 전략 요약 (Trust 모드)</h2>

<ul>
  <li>
    <p><strong>전제</strong> : 피클은 전부 네가 만든 파일 → <code class="language-plaintext highlighter-rouge">pickle.load</code>로 곧바로 로드하고, 그 객체를 <strong>jsonpickle</strong> 로 JSON 변환.</p>
  </li>
  <li>
    <p><strong>이점</strong> : 커스텀 클래스/순환 참조/공유 참조를 jsonpickle이 자동 처리(<code class="language-plaintext highlighter-rouge">py/object</code>, <code class="language-plaintext highlighter-rouge">py/id</code>, <code class="language-plaintext highlighter-rouge">py/ref</code> 메타).</p>
  </li>
  <li>
    <p><strong>선택지</strong> :</p>

    <ul>
      <li>
        <p>타입 복원 메타 포함(기본): <code class="language-plaintext highlighter-rouge">unpicklable=True</code> → 로스리스에 가까운 표현.</p>
      </li>
      <li>
        <p><strong>순수 JSON만</strong>(타입 메타 제거): <code class="language-plaintext highlighter-rouge">unpicklable=False</code> → 아주 깔끔하지만, 타입/참조 복원 불가.</p>
      </li>
    </ul>
  </li>
</ul>

<h2 id="2-파이썬-버전-호환성-필수-체크">2) 파이썬 버전 호환성 (필수 체크)</h2>

<ul>
  <li>
    <p><strong>같거나 더 새 버전의 파이썬</strong> 에서 로드하자. (예: Py 3.8에서 만든 피클 → Py 3.8 이상에서 로드 권장)</p>
  </li>
  <li>
    <p>피클 <strong>프로토콜</strong> 은 “신버전이 구버전 읽기 OK, 그 반대는 종종 불가”가 일반적.</p>
  </li>
  <li>
    <p><strong>클래스 import 가능성</strong> : 피클 안에 저장된 모듈/클래스 경로가 현재 환경에서 <strong>import</strong> 되어야 언피클 성공.</p>

    <ul>
      <li>즉, 프로젝트 코드가 <code class="language-plaintext highlighter-rouge">PYTHONPATH</code> 에 있어야 하고, <strong>모듈/클래스 이름이 바뀌지 않아야</strong> 해.</li>
    </ul>
  </li>
  <li>
    <p>(구피클) Python 2에서 만든 피클이라면 Py3에서 <code class="language-plaintext highlighter-rouge">encoding='latin1'</code> 옵션이 필요할 수 있음.</p>
  </li>
</ul>

<h2 id="3-jsonpickle로-간단튼튼하게-변환">3) jsonpickle로 간단/튼튼하게 변환</h2>

<ul>
  <li>
    <p><strong>핵심 한 줄</strong> : <code class="language-plaintext highlighter-rouge">jsonpickle.encode(obj, unpicklable=..., make_refs=..., max_depth=...)</code></p>
  </li>
  <li>
    <p><strong>핸들러 등록</strong> : NumPy/Pandas가 있다면 <code class="language-plaintext highlighter-rouge">jsonpickle.ext.numpy.register_handlers()</code>, <code class="language-plaintext highlighter-rouge">jsonpickle.ext.pandas.register_handlers()</code> 호출로 배열/데이터프레임을 자연스럽게 직렬화.</p>
  </li>
  <li>
    <p><strong>Strict JSON</strong> 필요하면: <code class="language-plaintext highlighter-rouge">allow_nan=False</code> (NaN/Infinity 금지) 를 백엔드 옵션으로 지정.</p>
  </li>
  <li>
    <p><strong>대용량</strong> 이면: 들여쓰기 <code class="language-plaintext highlighter-rouge">None</code>(압축), 필요 시 <code class="language-plaintext highlighter-rouge">sort_keys=False</code> 유지로 성능/용량 최소화.</p>
  </li>
</ul>

<hr />

<h1 id="바로-실행-가능한-스크립트">바로 실행 가능한 스크립트</h1>

<p>내가 <strong>trust 모드 전용 변환 스크립트</strong> 를 만들어 뒀어. 옵션으로 순수 JSON, 참조 트래킹, strict JSON, 들여쓰기 등 세밀 제어가 가능해.</p>

<p>Download: <code class="language-plaintext highlighter-rouge">pickle_to_json_trusted.py</code></p>

<h2 id="사용법-예시">사용법 예시</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1) 기본: 타입/참조 메타 유지 (권장: 로스리스에 가까움)</span>
python pickle_to_json_trusted.py mydata.pkl mydata.json

<span class="c"># 2) 순수 JSON(메타 제거) — 사람이 읽기/타 시스템 교환에 좋음</span>
python pickle_to_json_trusted.py mydata.pkl mydata.json <span class="nt">--pure</span>

<span class="c"># 3) 사이클이 없고 참조 추적이 불필요하다면 약간 더 단순화</span>
python pickle_to_json_trusted.py mydata.pkl mydata.json <span class="nt">--no-refs</span>

<span class="c"># 4) Strict JSON (NaN/Infinity 금지), 컴팩트 출력</span>
python pickle_to_json_trusted.py mydata.pkl mydata.json <span class="nt">--strict</span> <span class="nt">--no-indent</span>

<span class="c"># 5) NumPy/Pandas가 있다면 자동 핸들러 등록됨(별도 옵션 불필요)</span>

<span class="c"># 6) 정보 출력(프로토콜/글로벌 심볼 훑어보기)</span>
python pickle_to_json_trusted.py mydata.pkl mydata.json <span class="nt">--info</span>

<span class="c"># 7) (레거시) Python 2에서 만든 피클이라면</span>
python pickle_to_json_trusted.py mydata.pkl mydata.json <span class="nt">--py2-latin1</span>
</code></pre></div></div>

<p>출력 모드에 따른 JSON 형태는 대략 다음과 같아:</p>

<ul>
  <li>
    <p><strong>기본(메타 포함)</strong> : 각 객체에 <code class="language-plaintext highlighter-rouge">py/object</code>, 참조엔 <code class="language-plaintext highlighter-rouge">py/id</code>/<code class="language-plaintext highlighter-rouge">py/ref</code>가 붙음 → 복원 친화적.</p>
  </li>
  <li>
    <p><strong>--pure</strong> : 표준 JSON만 남김 → 최대 호환성, 대신 타입/참조 정보는 사라짐.</p>
  </li>
</ul>

<hr />

<h1 id="에러를-더-줄이는-팁">에러를 더 줄이는 팁</h1>

<ol>
  <li>
    <p><strong>런타임 정합성</strong></p>

    <ul>
      <li>
        <p>언피클 시 <code class="language-plaintext highlighter-rouge">ModuleNotFoundError</code>, <code class="language-plaintext highlighter-rouge">AttributeError</code>가 나면, 현재 환경에서 필요한 모듈/클래스가 <strong>그대로 import 가능</strong> 한지 확인.</p>
      </li>
      <li>
        <p>패키지/모듈 이름 변경, 클래스 이동이 있었다면 임시 호환 레이어(구이름 alias) 추가가 현실적.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>메모리/성능</strong></p>

    <ul>
      <li>
        <p>매우 큰 배열/프레임은 <code class="language-plaintext highlighter-rouge">--no-indent</code>로 용량 줄이기.</p>
      </li>
      <li>
        <p>정말 큰 수치 데이터는 JSON 대신 <strong>사이드카 포맷</strong>(예: <code class="language-plaintext highlighter-rouge">.npy</code>/<code class="language-plaintext highlighter-rouge">.parquet</code>) 고려 후 JSON에는 메타/경로만 담는 전략도 가능.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>안전/정합성 검증</strong></p>

    <ul>
      <li>생성된 JSON을 한 번 <code class="language-plaintext highlighter-rouge">json.loads</code>로 역파싱하면 문법 실수를 조기에 발견.</li>
    </ul>
  </li>
</ol>

<hr />

<h1 id="요약-답변">요약 답변</h1>

<ol>
  <li>
    <p><strong>Trust로 가자</strong> → <code class="language-plaintext highlighter-rouge">pickle.load</code> 후 <code class="language-plaintext highlighter-rouge">jsonpickle.encode</code> 가 가장 간단/범용.</p>
  </li>
  <li>
    <p><strong>파이썬 버전</strong> 은 “같거나 더 최신”을 쓰면 대부분 안전. (특히 Py ≥3.8이면 프로토콜 5 대응 OK.) 모듈/클래스 경로가 동일하게 import 가능해야 함.</p>
  </li>
  <li>
    <p><strong>jsonpickle 사용</strong> 이 가장 손쉬움. 위 스크립트로 바로 가능하고, 필요 시 <code class="language-plaintext highlighter-rouge">--pure</code>(메타 제거), <code class="language-plaintext highlighter-rouge">--strict</code>(NaN 금지), <code class="language-plaintext highlighter-rouge">--no-indent</code>(대용량) 등 옵션으로 상황 맞춤화하면 돼.</p>
  </li>
</ol>

<p>원하면 <code class="language-plaintext highlighter-rouge">py/object</code> 메타 포맷 대신, 아예 <code class="language-plaintext highlighter-rouge">$type</code> 같은 커스텀 스킴으로 바꾼 미니 직렬화기도 만들어줄 수 있어.</p>

<p class="chat--user">

본문에 그냥 써주고, 커스텀 클래스 import 는 어떤 식으로 해야해?

</p>

<p>좋아—<strong>trust 모드 + jsonpickle</strong> 로 “피클 → JSON”을 <strong>간단/튼튼</strong> 하게 처리하는 스크립트를 본문에 바로 넣어둘게.<br />
그리고 <strong>커스텀 클래스 import</strong> 는 어떻게 해야 언피클이 잘 되는지, 가장 실전적인 방법들을 아래에 정리했어.</p>

<hr />

<h1 id="step-by-step-1">Step by Step</h1>

<ol>
  <li>
    <p><strong>전제</strong> : 전부 네가 만든 피클 → <code class="language-plaintext highlighter-rouge">pickle.load</code>(trust)로 로드해도 됨.</p>
  </li>
  <li>
    <p><strong>버전</strong> : 피클을 만든 파이썬 <strong>동일 또는 더 최신 버전</strong> 에서 로드(특히 모듈 경로가 동일하게 import 가능해야 함).</p>
  </li>
  <li>
    <p><strong>핵심</strong> : 로드한 객체를 <code class="language-plaintext highlighter-rouge">jsonpickle.encode(...)</code>로 JSON 변환.</p>
  </li>
  <li>
    <p><strong>대용량/호환성 옵션</strong> :</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">--pure</code> → 타입 메타 제거(아주 깔끔한 JSON), 대신 복원 불가.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">--no-refs</code> → 참조/사이클 추적 비활성화(간단하지만 공유참조 정보 사라짐).</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">--strict</code> → NaN/Infinity 금지(정-표준 JSON).</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">--no-indent</code> → 용량 최소화.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>커스텀 클래스 import</strong> 는 “현재 프로세스에서 해당 모듈을 <strong>정확히 import 가능</strong> ”해야 함. 아래 “Import 요령” 참고.</p>
  </li>
</ol>

<hr />

<h1 id="신뢰-모드-전용-스크립트-jsonpickle-사용">신뢰 모드 전용 스크립트 (jsonpickle 사용)</h1>

<p>아래 코드를 <code class="language-plaintext highlighter-rouge">pickle_to_json_trusted.py</code>로 저장해서 바로 써.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
# pickle_to_json_trusted.py
# Trust-mode: loads your own pickle files, then encodes to JSON with jsonpickle.
</span>
<span class="kn">import</span> <span class="n">argparse</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">pickle</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">traceback</span><span class="p">,</span> <span class="n">importlib</span>
<span class="kn">import</span> <span class="n">pickletools</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">jsonpickle</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">ERROR: jsonpickle is required. Install with: pip install jsonpickle</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="k">raise</span>

<span class="k">def</span> <span class="nf">register_optional_exts</span><span class="p">():</span>
    <span class="c1"># Optional handlers for numpy/pandas if available
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="n">jsonpickle.ext</span> <span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">jsonpickle_numpy</span>
        <span class="n">jsonpickle_numpy</span><span class="p">.</span><span class="nf">register_handlers</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="n">jsonpickle.ext</span> <span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">jsonpickle_pandas</span>
        <span class="n">jsonpickle_pandas</span><span class="p">.</span><span class="nf">register_handlers</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="k">def</span> <span class="nf">peek_protocol</span><span class="p">(</span><span class="n">pkl_bytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">pickletools</span><span class="p">.</span><span class="nf">genops</span><span class="p">(</span><span class="n">pkl_bytes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">op</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="sh">"</span><span class="s">PROTO</span><span class="sh">"</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">arg</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">scan_globals</span><span class="p">(</span><span class="n">pkl_bytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
    <span class="n">refs</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">pickletools</span><span class="p">.</span><span class="nf">genops</span><span class="p">(</span><span class="n">pkl_bytes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">op</span><span class="p">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">GLOBAL</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">STACK_GLOBAL</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">mod</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">arg</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">arg</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">mod</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="n">refs</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">mod</span><span class="si">}</span><span class="s">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">ap</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="nc">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sh">"</span><span class="s">Trust-mode: Convert a Python pickle to JSON using jsonpickle.</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">input</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Input .pkl file path</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">output</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Output .json file path</span><span class="sh">"</span><span class="p">)</span>
    <span class="c1"># JSON shape options
</span>    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--pure</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Emit plain JSON (unpicklable=False) without py/object metadata.</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--no-refs</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Do not track object references/cycles (make_refs=False).</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--max-depth</span><span class="sh">"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Limit traversal depth (None = unlimited).</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--indent</span><span class="sh">"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Pretty-print indent (use 0 or --no-indent for compact).</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--no-indent</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Compact JSON (indent=None).</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--ensure-ascii</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Escape non-ASCII characters.</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--strict</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Disallow NaN/Infinity (allow_nan=False).</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--sort-keys</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Sort JSON object keys.</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--info</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Print pickle protocol &amp; referenced globals before converting.</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--py2-latin1</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">store_true</span><span class="sh">"</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">If the pickle came from Python 2, try encoding=</span><span class="sh">'</span><span class="s">latin1</span><span class="sh">'</span><span class="s">.</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Import help (for custom classes)
</span>    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--sys-path</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
                    <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Prepend a path to sys.path (repeatable).</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--preload</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
                    <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Import module(s) before unpickling, e.g. mypkg.models (repeatable).</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--alias</span><span class="sh">"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
                    <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Module alias mapping OLD=NEW (repeatable).</span><span class="sh">"</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">ap</span><span class="p">.</span><span class="nf">parse_args</span><span class="p">()</span>

    <span class="c1"># sys.path adjustments for project importability
</span>    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">args</span><span class="p">.</span><span class="n">sys_path</span><span class="p">:</span>
        <span class="n">sys</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">abspath</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

    <span class="c1"># module aliasing (module path changed)
</span>    <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">args</span><span class="p">.</span><span class="n">alias</span><span class="p">:</span>
        <span class="k">if</span> <span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pair</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">WARNING: --alias expects OLD=NEW, got </span><span class="si">{</span><span class="n">pair</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="o">=</span> <span class="n">pair</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">new_mod</span> <span class="o">=</span> <span class="n">importlib</span><span class="p">.</span><span class="nf">import_module</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="n">modules</span><span class="p">[</span><span class="n">old</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_mod</span>

    <span class="c1"># preload modules so that pickle can resolve classes
</span>    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">args</span><span class="p">.</span><span class="n">preload</span><span class="p">:</span>
        <span class="n">importlib</span><span class="p">.</span><span class="nf">import_module</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="c1"># read pickle bytes
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="nb">input</span><span class="p">,</span> <span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pkl_bytes</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ERROR: file not found: </span><span class="si">{</span><span class="n">args</span><span class="p">.</span><span class="nb">input</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">info</span><span class="p">:</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="nf">peek_protocol</span><span class="p">(</span><span class="n">pkl_bytes</span><span class="p">)</span>
        <span class="n">globs</span> <span class="o">=</span> <span class="nf">scan_globals</span><span class="p">(</span><span class="n">pkl_bytes</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[info] protocol: </span><span class="si">{</span><span class="n">proto</span> <span class="k">if</span> <span class="n">proto</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="sh">'</span><span class="s">unknown</span><span class="sh">'</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">globs</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[info] referenced globals (</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">globs</span><span class="p">)</span><span class="si">}</span><span class="s">):</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">globs</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  - </span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[info] referenced globals: (none found)</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># jsonpickle backend setup
</span>    <span class="nf">register_optional_exts</span><span class="p">()</span>
    <span class="n">jsonpickle</span><span class="p">.</span><span class="nf">set_preferred_backend</span><span class="p">(</span><span class="sh">'</span><span class="s">json</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">indent</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">no_indent</span> <span class="k">else</span> <span class="n">args</span><span class="p">.</span><span class="n">indent</span>
    <span class="c1"># encoder opts
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">jsonpickle</span><span class="p">.</span><span class="nf">set_encoder_options</span><span class="p">(</span>
            <span class="sh">'</span><span class="s">json</span><span class="sh">'</span><span class="p">,</span>
            <span class="n">ensure_ascii</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">ensure_ascii</span><span class="p">,</span>
            <span class="n">allow_nan</span><span class="o">=</span><span class="ow">not</span> <span class="n">args</span><span class="p">.</span><span class="n">strict</span><span class="p">,</span>
            <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span>
            <span class="n">sort_keys</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">sort_keys</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="nb">TypeError</span><span class="p">:</span>
        <span class="n">jsonpickle</span><span class="p">.</span><span class="nf">set_encoder_options</span><span class="p">(</span><span class="sh">'</span><span class="s">json</span><span class="sh">'</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">ensure_ascii</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>

    <span class="c1"># unpickle (TRUST)
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="n">io</span>
        <span class="n">bio</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="nc">BytesIO</span><span class="p">(</span><span class="n">pkl_bytes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">py2_latin1</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">pickle</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">bio</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">latin1</span><span class="sh">'</span><span class="p">,</span> <span class="n">fix_imports</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">pickle</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">bio</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">ModuleNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">ERROR: Required module isn</span><span class="sh">'</span><span class="s">t importable.</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Detail: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Tip: Use --sys-path/--preload/--alias or set PYTHONPATH.</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">ERROR: Class/attribute moved or renamed.</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Detail: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">ERROR: Unpickling failed.</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">traceback</span><span class="p">.</span><span class="nf">print_exc</span><span class="p">()</span>
        <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># encode with jsonpickle
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">json_str</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span>
            <span class="n">obj</span><span class="p">,</span>
            <span class="n">unpicklable</span><span class="o">=</span><span class="ow">not</span> <span class="n">args</span><span class="p">.</span><span class="n">pure</span><span class="p">,</span>
            <span class="n">make_refs</span><span class="o">=</span><span class="ow">not</span> <span class="n">args</span><span class="p">.</span><span class="n">no_refs</span><span class="p">,</span>
            <span class="n">max_depth</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">max_depth</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">ERROR: jsonpickle encoding failed.</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">traceback</span><span class="p">.</span><span class="nf">print_exc</span><span class="p">()</span>
        <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># write
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">output</span><span class="p">,</span> <span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ERROR: writing output failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Wrote </span><span class="si">{</span><span class="n">args</span><span class="p">.</span><span class="n">output</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="실행-예">실행 예</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># (가장 기본) 타입/참조 메타 유지: 복원 친화적</span>
python pickle_to_json_trusted.py data.pkl data.json

<span class="c"># 순수 JSON (메타 제거)</span>
python pickle_to_json_trusted.py data.pkl data.json <span class="nt">--pure</span>

<span class="c"># 사이클/참조 추적 끄기 + 컴팩트 + Strict JSON</span>
python pickle_to_json_trusted.py data.pkl data.json <span class="nt">--no-refs</span> <span class="nt">--no-indent</span> <span class="nt">--strict</span>

<span class="c"># 피클 정보(프로토콜/글로벌): 디버깅용</span>
python pickle_to_json_trusted.py data.pkl data.json <span class="nt">--info</span>
</code></pre></div></div>

<hr />

<h1 id="커스텀-클래스-import--이렇게-하면-된다-실전-레시피">커스텀 클래스 import — 이렇게 하면 된다 (실전 레시피)</h1>

<p>언피클이 커스텀 클래스를 복원하려면, <strong>피클에 기록된 “모듈.클래스”가 현재 런타임에서 import 가능</strong> 해야 해.</p>

<h2 id="1-가장-깔끔-프로젝트를-패키지로-설치">1) 가장 깔끔: 프로젝트를 패키지로 설치</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 프로젝트 루트에서</span>
pip <span class="nb">install</span> <span class="nt">-e</span> <span class="nb">.</span>
<span class="c"># 또는 PYTHONPATH로 임시 등록</span>
<span class="nv">PYTHONPATH</span><span class="o">=</span>/path/to/project python pickle_to_json_trusted.py data.pkl out.json
</code></pre></div></div>

<ul>
  <li>이러면 <code class="language-plaintext highlighter-rouge">mypkg.models.User</code> 같은 경로를 파이썬이 자연스럽게 찾음.</li>
</ul>

<h2 id="2-경로만-추가해서-import-가능하게-스크립트-옵션">2) 경로만 추가해서 import 가능하게 (스크립트 옵션)</h2>

<p>프로젝트 루트를 <code class="language-plaintext highlighter-rouge">sys.path</code> 앞에 추가:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python pickle_to_json_trusted.py data.pkl out.json <span class="se">\</span>
  <span class="nt">--sys-path</span> /absolute/path/to/project_root <span class="se">\</span>
  <span class="nt">--preload</span> mypkg.models
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">--preload</code>는 해당 모듈을 미리 import해서 클래스 등록을 확실히 해줘.</li>
</ul>

<h2 id="3-모듈-경로가-바뀐-경우리팩터링--모듈-alias">3) 모듈 경로가 바뀐 경우(리팩터링) → <strong>모듈 alias</strong></h2>

<p>예: 예전에는 <code class="language-plaintext highlighter-rouge">oldpkg.models</code>였는데 지금은 <code class="language-plaintext highlighter-rouge">newpkg.models</code>로 이동했다면:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python pickle_to_json_trusted.py data.pkl out.json <span class="se">\</span>
  <span class="nt">--sys-path</span> /path/to/project <span class="se">\</span>
  <span class="nt">--alias</span> oldpkg.models<span class="o">=</span>newpkg.models <span class="se">\</span>
  <span class="nt">--preload</span> newpkg.models
</code></pre></div></div>

<ul>
  <li>이러면 <code class="language-plaintext highlighter-rouge">pickle.load</code>가 <code class="language-plaintext highlighter-rouge">oldpkg.models</code>를 찾으려 할 때, 내부적으로 <code class="language-plaintext highlighter-rouge">newpkg.models</code>를 대신 사용.</li>
</ul>

<h2 id="4-클래스가-다른-모듈로-이동했다면--런타임-shim간단-예">4) 클래스가 다른 모듈로 이동했다면 → <strong>런타임 shim(간단 예)</strong></h2>

<p>모듈 alias만으로 부족할 때(클래스 이름도 바뀌었거나 세부 구조가 바뀐 경우), 언피클 전에 <strong>임시 shim 모듈</strong> 을 만들어 매핑해 줄 수 있어:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 예: OldClass가 oldpkg.models → newpkg.models.NewClass 로 이동/개명된 경우
</span><span class="kn">import</span> <span class="n">types</span><span class="p">,</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">newpkg.models</span> <span class="k">as</span> <span class="n">newmod</span>

<span class="n">shim</span> <span class="o">=</span> <span class="n">types</span><span class="p">.</span><span class="nc">ModuleType</span><span class="p">(</span><span class="sh">"</span><span class="s">oldpkg.models</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># 예전 이름을 새 클래스에 매핑
</span><span class="n">shim</span><span class="p">.</span><span class="n">OldClass</span> <span class="o">=</span> <span class="n">newmod</span><span class="p">.</span><span class="n">NewClass</span>
<span class="c1"># 언피클이 찾아쓰도록 sys.modules 등록
</span><span class="n">sys</span><span class="p">.</span><span class="n">modules</span><span class="p">[</span><span class="sh">"</span><span class="s">oldpkg.models</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">shim</span>

<span class="c1"># 이제 pickle.load를 호출
</span></code></pre></div></div>

<blockquote>
  <p>위 shim 코드는 <strong>스크립트 최상단(언피클 직전)</strong>에 넣으면 되고, 경우에 따라 여러 클래스를 넣어 매핑하면 된다.</p>
</blockquote>

<h2 id="5-python-2--3-피클일-때">5) Python 2 → 3 피클일 때</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python pickle_to_json_trusted.py data.pkl out.json <span class="nt">--py2-latin1</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">encoding='latin1'</code>, <code class="language-plaintext highlighter-rouge">fix_imports=True</code>로 과거 피클 호환을 시도.</li>
</ul>

<hr />

<h1 id="작게-요약">작게 요약</h1>

<ul>
  <li>
    <p><strong>Trust OK</strong> → <code class="language-plaintext highlighter-rouge">pickle.load</code> + <code class="language-plaintext highlighter-rouge">jsonpickle.encode</code>가 가장 간단.</p>
  </li>
  <li>
    <p><strong>버전</strong> 은 “같거나 최신” 권장 + 모듈/클래스 경로가 현재 환경에서 그대로 import 가능해야 함.</p>
  </li>
  <li>
    <p><strong>커스텀 클래스 import</strong> 는</p>

    <ol>
      <li>
        <p>패키지로 설치(또는 PYTHONPATH),</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">--sys-path</code> / <code class="language-plaintext highlighter-rouge">--preload</code>,</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">--alias 올드=뉴</code>(모듈 경로 변경),</p>
      </li>
      <li>
        <p>필요 시 <strong>shim 모듈</strong> 로 클래스 레벨 매핑.</p>
      </li>
    </ol>
  </li>
</ul>

<p>원하면 shim을 옵션화해서 스크립트에 바로 넣는 버전(예: <code class="language-plaintext highlighter-rouge">--shim oldpkg.models:OldClass=newpkg.models:NewClass</code>)도 만들어줄게.</p>]]></content><author><name>hvppyarchive</name></author><category term="python" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">md 한영 병기 표기 렌더링</title><link href="https://hvppyarchive.github.io/markdown/markdown-multilanguage/" rel="alternate" type="text/html" title="md 한영 병기 표기 렌더링" /><published>2025-09-13T11:23:46+09:00</published><updated>2025-09-13T11:23:46+09:00</updated><id>https://hvppyarchive.github.io/markdown/markdown-multilanguage</id><content type="html" xml:base="https://hvppyarchive.github.io/markdown/markdown-multilanguage/"><![CDATA[<p class="chat--user">

mkdocs-material에서 md 파일 글에 대해 한/영 병기를 하고 싶어. 안녕하세요. Hello. Everyone. 이런 식으로 말이야. 이 때 영어는 좀 연하고 작게 표기하고 싶은데, 이걸 md에 어떤 마크를 추가해서 자동으로 그렇게 렌더링 해줬으면 좋겠어. 안녕하세요. <en>Hello. Everyone</en> 이런 식으로 말이야. 이건 내가 생각한 예시니까 더 좋은 방안이 있으면 추천해도 좋아.

</p>

<p>좋아요! “한국어 원문 + 연하고 작은 영어 번역”은 <strong>마크다운 속성 리스트(attr_list)</strong> 를 쓰는 방법이 가장 간단하고, 원하시면 <code class="language-plaintext highlighter-rouge">&lt;en&gt;</code> 같은 커스텀 태그로도 가능합니다. 두 가지를 모두 보여드릴게요.</p>

<hr />

<h1 id="방법-a-가장-간단--문단에-클래스-붙이기-attr_list">방법 A: 가장 간단 — 문단에 클래스 붙이기 (attr_list)</h1>

<h2 id="1-mkdocsyml-설정">1) <code class="language-plaintext highlighter-rouge">mkdocs.yml</code> 설정</h2>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">theme</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">material</span>

<span class="na">markdown_extensions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">attr_list</span>          <span class="c1"># ← 이 줄 추가</span>

<span class="na">extra_css</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">stylesheets/translation.css</span>   <span class="c1"># ← 커스텀 CSS 등록</span>
</code></pre></div></div>

<h2 id="2-docsstylesheetstranslationcss-작성">2) <code class="language-plaintext highlighter-rouge">docs/stylesheets/translation.css</code> 작성</h2>
<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/* 영어 번역 공통 스타일 */</span>
<span class="nc">.md-typeset</span> <span class="nc">.en</span> <span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">0.85em</span><span class="p">;</span>   <span class="c">/* 조금 작게 */</span>
  <span class="nl">opacity</span><span class="p">:</span> <span class="m">0.65</span><span class="p">;</span>       <span class="c">/* 연하게 */</span>
<span class="p">}</span>

<span class="c">/* 한국어 문단 바로 다음에 오는 영어 번역은 간격을 조금만 */</span>
<span class="nc">.md-typeset</span> <span class="nt">p</span> <span class="o">+</span> <span class="nt">p</span><span class="nc">.en</span> <span class="p">{</span>
  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">0.25em</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="3-마크다운에서-사용">3) 마크다운에서 사용</h2>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.
Hello. Everyone. {.en}
</code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Hello… {.en}</code> 처럼 <strong>문장 끝에<code class="language-plaintext highlighter-rouge">{.en}</code></strong> 을 붙이면, 렌더링 시 <code class="language-plaintext highlighter-rouge">&lt;p class="en"&gt;…&lt;/p&gt;</code>가 되어 위 CSS가 적용됩니다.</p>
  </li>
  <li>
    <p>문장 중간 <strong>인라인</strong> 으로 쓰고 싶으면:</p>
    <div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요. <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"en"</span><span class="nt">&gt;</span>Hello. Everyone.<span class="nt">&lt;/span&gt;</span>
</code></pre></div>    </div>
  </li>
</ul>

<hr />

<h1 id="방법-b-커스텀-태그-en-그대로-쓰기">방법 B: 커스텀 태그 <code class="language-plaintext highlighter-rouge">&lt;en&gt;</code> 그대로 쓰기</h1>

<p>원하신 표기대로 써도 됩니다. Python-Markdown은 기본적으로 <strong>인라인 HTML 통과</strong> 를 허용하므로 아래처럼 작성하고 CSS에서 <code class="language-plaintext highlighter-rouge">&lt;en&gt;</code>을 스타일링하세요.</p>

<h2 id="1-마크다운">1) 마크다운</h2>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.
<span class="nt">&lt;en&gt;</span>Hello. Everyone.<span class="nt">&lt;/en&gt;</span>
</code></pre></div></div>

<h2 id="2-translationcss">2) <code class="language-plaintext highlighter-rouge">translation.css</code></h2>
<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/* 알 수 없는 태그도 CSS에서 그대로 선택 가능 */</span>
<span class="nc">.md-typeset</span> <span class="nt">en</span> <span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">0.85em</span><span class="p">;</span>
  <span class="nl">opacity</span><span class="p">:</span> <span class="m">0.65</span><span class="p">;</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>           <span class="c">/* 줄바꿈 형태라면 block이 보기 좋음 */</span>
  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">0.25em</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>참고: HTML 표준상 “커스텀 요소”는 보통 이름에 하이픈이 들어갑니다(<code class="language-plaintext highlighter-rouge">&lt;en-text&gt;</code> 등). 굳이 표준을 따르려면 <code class="language-plaintext highlighter-rouge">&lt;en-text&gt;</code>로 쓰고 CSS도 <code class="language-plaintext highlighter-rouge">en-text</code>로 지정해도 됩니다. 다만 실제 동작은 <code class="language-plaintext highlighter-rouge">&lt;en&gt;</code>도 문제없습니다.</p>
</blockquote>

<hr />

<h1 id="선택-접근성까지-고려한-버전">(선택) 접근성까지 고려한 버전</h1>

<p>번역 텍스트에 <code class="language-plaintext highlighter-rouge">lang="en"</code>을 더해주면 스크린리더가 언어 전환을 인지합니다.</p>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello. Everyone. { .en lang=en }
</code></pre></div></div>

<p>CSS는 그대로 <code class="language-plaintext highlighter-rouge">.en</code>에 걸려서 시각 스타일은 유지되고, 보조공학 친화성만 올라갑니다.</p>

<hr />

<h1 id="어떤-방법을-쓰면-좋을까">어떤 방법을 쓰면 좋을까?</h1>

<ul>
  <li>
    <p><strong>가장 권장:</strong> 방법 A (attr_list)</p>

    <ul>
      <li>마크다운 문법을 유지하면서도 깔끔하게 클래스만 부여 → 관리 쉬움</li>
    </ul>
  </li>
  <li>
    <p><strong>원하신 표기를 그대로 쓰고 싶다면:</strong> 방법 B (<code class="language-plaintext highlighter-rouge">&lt;en&gt;…&lt;/en&gt;</code>)</p>

    <ul>
      <li>취향/가독성 면에서 선호하면 사용, 다만 HTML 태그를 직접 쓰는 점만 유의</li>
    </ul>
  </li>
</ul>

<p>둘 중 하나만 채택하셔도 되고, <strong>문단은<code class="language-plaintext highlighter-rouge">{.en}</code></strong>, <strong>인라인은 <code class="language-plaintext highlighter-rouge">&lt;span class="en"&gt;…&lt;/span&gt;</code></strong>처럼 혼용해도 깔끔하게 관리됩니다.</p>

<p>필요하시면 목록/표/인용문 등에서의 미세 간격 조정용 CSS도 이어서 만들어 드릴게요.</p>

<p class="chat--user">

안 되는데 띄어쓰기나 줄바꿈 같은걸 잘 해야하나?

</p>

<p>가능해! 주로 <strong>띄어쓰기/줄바꿈</strong> 과 <strong>설정 로딩</strong> 에서 자주 미끄러져요. 아래 순서대로 한 번만 점검해보죠. (복붙용 최소 예제도 맨 아래에 넣었어요.)</p>

<hr />

<h2 id="1-설정이-진짜-켜졌는지-확인">1) 설정이 진짜 켜졌는지 확인</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">mkdocs.yml</code>에 <strong>정확히</strong> 다음이 있어야 해요.
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">theme</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">material</span>
    
<span class="na">markdown_extensions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">attr_list</span>        <span class="c1"># ← 이게 있어야 {.en}이 먹습니다.</span>
    
<span class="na">extra_css</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">stylesheets/translation.css</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">docs/stylesheets/translation.css</code> 파일이 실제로 존재하는지 확인.</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">mkdocs serve</code>를 돌리는 중에 <code class="language-plaintext highlighter-rouge">extra_css</code>를 추가했다면, <strong>서버를 한 번 재시작</strong> 해 주세요. (가끔 새 CSS를 못 읽고 있습니다.)</li>
</ul>

<hr />

<h2 id="2-줄바꿈-규칙-이해-여기서-많이-틀어집니다">2) 줄바꿈 규칙 이해 (여기서 많이 틀어집니다)</h2>

<p>마크다운에서:</p>

<ul>
  <li>
    <p><strong>빈 줄(공백 줄)</strong> = 새 문단(<code class="language-plaintext highlighter-rouge">&lt;p&gt;…&lt;/p&gt;</code>)</p>
  </li>
  <li>
    <p><strong>그냥 줄바꿈 하나</strong> = 같은 문단 안에서 <strong>공백 하나</strong>(줄바꿈이 사라짐)</p>
  </li>
  <li>
    <p><strong>줄 끝에 공백 두 칸 + 엔터</strong> = <strong>강제 줄바꿈(<code class="language-plaintext highlighter-rouge">&lt;br&gt;</code>)</strong></p>
  </li>
</ul>

<p>원하는 형태가 “한국어 한 줄 + (조금 연하고 작은) 영어 한 줄”이라면,</p>

<ul>
  <li>
    <p><strong>문단을 분리</strong> 하거나(<strong>빈 줄 1개</strong>),</p>
  </li>
  <li>
    <p><strong>강제 줄바꿈</strong> 을 쓰거나(한국어 줄 끝 <strong>두 칸</strong> + 엔터)<br />
둘 중 하나를 반드시 해 주세요.</p>
  </li>
</ul>

<hr />

<h2 id="3-실제-작성-예제-3가지">3) 실제 작성 예제 3가지</h2>

<h3 id="a-가장-간단-문단-분리--en">A. 가장 간단: 문단 분리 + <code class="language-plaintext highlighter-rouge">{.en}</code></h3>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.

Hello. Everyone. {.en}
</code></pre></div></div>

<blockquote>
  <p>포인트: <strong>한국어와 영어 사이에 빈 줄</strong> 이 있어야 영어가 <strong>별도 문단</strong> 이 되고, <code class="language-plaintext highlighter-rouge">{.en}</code>이 그 문단에 적용됩니다.</p>
</blockquote>

<h3 id="b-같은-문단-안에서-줄만-바꾸고-싶을-때-간격-더-촘촘">B. 같은 문단 안에서 줄만 바꾸고 싶을 때 (간격 더 촘촘)</h3>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.··
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"en"</span><span class="nt">&gt;</span>Hello. Everyone.<span class="nt">&lt;/span&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>한국어 줄 끝의 <code class="language-plaintext highlighter-rouge">··</code>(공백 두 칸)가 <strong>강제 줄바꿈</strong> 입니다.<br />
 <code class="language-plaintext highlighter-rouge">&lt;span&gt;</code>은 HTML이므로 줄바꿈을 위해 <code class="language-plaintext highlighter-rouge">&lt;br&gt;</code>를 써도 됩니다:</p>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>md

안녕하세요.&lt;br&gt;
&lt;span class="en"&gt;Hello. Everyone.&lt;/span&gt;

</code></pre></div>  </div>
</blockquote>

<h3 id="c-커스텀-태그-en-그대로">C. 커스텀 태그 <code class="language-plaintext highlighter-rouge">&lt;en&gt;</code> 그대로</h3>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.
<span class="nt">&lt;en&gt;</span>Hello. Everyone.<span class="nt">&lt;/en&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>인라인 HTML은 기본 허용이라 별도 확장 필요 없습니다. (블록 HTML로 감싸 복잡하게 쓰는 경우에만 <code class="language-plaintext highlighter-rouge">md_in_html</code>이 필요)</p>
</blockquote>

<hr />

<h2 id="4-css-material-테마-기준-복붙">4) CSS (Material 테마 기준, 복붙)</h2>

<p><code class="language-plaintext highlighter-rouge">docs/stylesheets/translation.css</code></p>
<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/* 영어 번역 공통 스타일 */</span>
<span class="nc">.md-typeset</span> <span class="nc">.en</span><span class="o">,</span>
<span class="nc">.md-typeset</span> <span class="nt">en</span><span class="o">,</span>
<span class="nc">.md-typeset</span> <span class="nt">span</span><span class="nc">.en</span> <span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">0.85em</span><span class="p">;</span>   <span class="c">/* 조금 작게 */</span>
  <span class="nl">opacity</span><span class="p">:</span> <span class="m">0.65</span><span class="p">;</span>       <span class="c">/* 연하게 */</span>
<span class="p">}</span>

<span class="c">/* 문단으로 분리한 경우: 한국어 문단 바로 뒤 영어 문단의 위 여백 줄이기 */</span>
<span class="nc">.md-typeset</span> <span class="nt">p</span> <span class="o">+</span> <span class="nt">p</span><span class="nc">.en</span> <span class="p">{</span>
  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">0.25em</span><span class="p">;</span>
<span class="p">}</span>

<span class="c">/* 줄바꿈(브레이크) 뒤에 오는 인라인 번역을 '한 줄'처럼 보이게 */</span>
<span class="nc">.md-typeset</span> <span class="nt">span</span><span class="nc">.en</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">inline-block</span><span class="p">;</span>   <span class="c">/* &lt;br&gt; 다음에 내려오면 한 줄로 떨어져 보임 */</span>
  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">0.25em</span><span class="p">;</span>
<span class="p">}</span>

<span class="c">/* 커스텀 태그 &lt;en&gt;을 블록처럼 쓰고 싶다면 */</span>
<span class="nc">.md-typeset</span> <span class="nt">en</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>
  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">0.25em</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="5-체크리스트문제-계속되면-여기서-잡힙니다">5) 체크리스트(문제 계속되면 여기서 잡힙니다)</h2>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">mkdocs.yml</code>에 <code class="language-plaintext highlighter-rouge">attr_list</code>가 <strong>정확히</strong> 들어가 있다. (오탈자, 들여쓰기 주의)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">extra_css</code> 경로가 실제 파일 위치와 <strong>일치</strong> 한다. (<code class="language-plaintext highlighter-rouge">docs/stylesheets/translation.css</code>)</p>
  </li>
  <li>
    <p><strong>서버 재시작</strong> 후 새 CSS가 로드된다.</p>
  </li>
  <li>
    <p>마크다운에서 영어 줄을 <strong>별도 문단</strong> 으로 만들려면 <strong>빈 줄 1개</strong> ,<br />
같은 문단 안 <strong>줄바꿈</strong> 이면 한국어 줄 끝에 <strong>공백 2칸</strong> 또는 <code class="language-plaintext highlighter-rouge">&lt;br&gt;</code>.</p>
  </li>
  <li>
    <p>개발자도구에서 <code class="language-plaintext highlighter-rouge">.en</code> 규칙이 <strong>실제로 적용</strong> 되는지 확인한다. (선택자 앞에 <code class="language-plaintext highlighter-rouge">.md-typeset</code>를 붙이면 우선순위 문제를 대부분 이깁니다.)</p>
  </li>
</ol>

<hr />

<h2 id="6-복붙용-완전-최소-예제">6) 복붙용 “완전 최소 예제”</h2>

<p><strong>mkdocs.yml</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">site_name</span><span class="pi">:</span> <span class="s">demo</span>
<span class="na">theme</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">material</span>
<span class="na">markdown_extensions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">attr_list</span>
<span class="na">extra_css</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">stylesheets/translation.css</span>
</code></pre></div></div>

<p><strong>docs/stylesheets/translation.css</strong> → 위 CSS 그대로</p>

<p><strong>docs/index.md</strong></p>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh"># 데모</span>

안녕하세요.

Hello. Everyone. {.en}
<span class="p">
---
</span>
안녕하세요.··
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"en"</span><span class="nt">&gt;</span>Hello. Everyone.<span class="nt">&lt;/span&gt;</span>
<span class="p">
---
</span>
안녕하세요.
<span class="nt">&lt;en&gt;</span>Hello. Everyone.<span class="nt">&lt;/en&gt;</span>
</code></pre></div></div>

<p>이대로 하면 3가지 방식 모두 “연하고 작게” 나옵니다.<br />
그래도 안 되면, 사용하신 <code class="language-plaintext highlighter-rouge">mkdocs.yml</code>과 한두 줄의 <code class="language-plaintext highlighter-rouge">md</code> 예제를 붙여주시면 바로 원인 pinpoint 해드릴게요!</p>

<p class="chat--user">

다음 줄에다가 {: .en}을 쓰니까 되네 안녕하세요. (공백 두개) Hello. Everyone. {: .en} 이런 식으로 말이야. 근데 문제는 한글까지 같이 연하게 변해버려.

</p>

<p>맞아요—그 증상은 <strong><code class="language-plaintext highlighter-rouge">{: .en}</code>이 “이전 블록 전체”에 붙어서</strong> 그래요.<br />
지금 쓰신 형태는 <code class="language-plaintext highlighter-rouge">안녕하세요.</code> 뒤의 <strong>공백 두 칸</strong> 때문에 한국어+영어가 <strong>같은 문단(<code class="language-plaintext highlighter-rouge">&lt;p&gt;…&lt;/p&gt;</code>)</strong> 안에 들어갑니다. 그러면 <code class="language-plaintext highlighter-rouge">{: .en}</code>이 그 <strong>문단 전체</strong> 에 적용되어 한글까지 연해져요.</p>

<p>아래 셋 중 하나로 고치면 딱 해결됩니다.</p>

<hr />

<h3 id="-방법-1-문단을-분리-하고-영어-줄에만-클래스-붙이기-가장-깔끔">✅ 방법 1: <strong>문단을 분리</strong> 하고 영어 줄에만 클래스 붙이기 (가장 깔끔)</h3>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.

Hello. Everyone. {.en}
</code></pre></div></div>

<ul>
  <li><strong>포인트:</strong> 한국어와 영어 사이에 <strong>빈 줄 1개</strong> → 서로 다른 문단이 되면서 <code class="language-plaintext highlighter-rouge">.en</code>은 영어 문단에만 적용.</li>
</ul>

<hr />

<h3 id="-방법-2-앞줄에-속성-배치-해서-다음-블록에만-적용">✅ 방법 2: <strong>앞줄에 속성 배치</strong> 해서 “다음 블록”에만 적용</h3>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.

{:.en lang=en}
Hello. Everyone.
</code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">{: .en}</code>을 <strong>영어 문단 앞줄</strong> 에 두면, 바로 <strong>아래 블록(영어 문단)</strong> 에만 적용됩니다.</p>
  </li>
  <li>
    <p>접근성까지 챙기려면 <code class="language-plaintext highlighter-rouge">lang=en</code>도 같이 두세요.</p>
  </li>
</ul>

<hr />

<h3 id="-방법-3-같은-문단을-유지-하려면-br--인라인-span">✅ 방법 3: <strong>같은 문단을 유지</strong> 하려면 <code class="language-plaintext highlighter-rouge">&lt;br&gt;</code> + 인라인 span</h3>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.<span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"en"</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>Hello. Everyone.<span class="nt">&lt;/span&gt;</span>
</code></pre></div></div>

<ul>
  <li>한국어 줄 끝 <strong>공백 두 칸</strong> 대신 <code class="language-plaintext highlighter-rouge">&lt;br&gt;</code>로 줄바꿈하고, 영어만 <code class="language-plaintext highlighter-rouge">&lt;span class="en"&gt;…&lt;/span&gt;</code>로 감싸면 됩니다.</li>
</ul>

<hr />

<h3 id="왜-이런가요-핵심-정리">왜 이런가요? (핵심 정리)</h3>

<ul>
  <li>
    <p><strong>공백 두 칸 + 엔터</strong> = 같은 문단 안의 <code class="language-plaintext highlighter-rouge">&lt;br&gt;</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">{: .en}</code> (단독 줄) = <strong>바로 앞 블록</strong> 에 붙음 → 같은 문단이면 <strong>한글+영어 모두</strong> 에 적용됨</p>
  </li>
  <li>
    <p>해결책은 <strong>블록을 나누거나</strong>(방법 1/2), <strong>인라인만 감싸기</strong>(방법 3)입니다.</p>
  </li>
</ul>

<p>필요하면, 지금 쓰시는 실제 한두 줄을 붙여 주시면 그 형태에 맞춰 가장 간단한 문법으로 딱 맞춰 드릴게요!</p>

<p class="chat--user">

아니 왜 자꾸 {.en}이라고 하는건데, 이거 동작하는거야?

</p>

<p>맞아요, 헷갈릴 만해요. 정리하면:</p>

<ol>
  <li><strong><code class="language-plaintext highlighter-rouge">{.en}</code> = <code class="language-plaintext highlighter-rouge">{:.en}</code></strong></li>
</ol>

<ul>
  <li>
    <p>둘 다 <strong>attr_list</strong> 확장 문법입니다. (콜론은 선택)</p>
  </li>
  <li>
    <p><strong>동작 조건:</strong> <code class="language-plaintext highlighter-rouge">mkdocs.yml</code>에 <code class="language-plaintext highlighter-rouge">markdown_extensions: - attr_list</code>가 있어야 합니다.</p>
  </li>
</ul>

<ol>
  <li><strong>붙는 위치 규칙(핵심)</strong></li>
</ol>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">{: .en}</code> 같은 <strong>속성 줄은 “바로 앞 블록”</strong>에 붙습니다.</p>
  </li>
  <li>
    <p>한글 줄 끝에 공백 두 개를 넣으면 <strong>한글+영어가 한 문단(같은 블록)</strong> 이라서, <code class="language-plaintext highlighter-rouge">{: .en}</code>이 둘 다에 적용돼요 → 그래서 한글까지 연해진 것.</p>
  </li>
</ul>

<ol>
  <li><strong>원하는 효과(영어만 연하게) 만드는 법 – 3가지 중 하나 선택</strong></li>
</ol>

<ul>
  <li>✅ <strong>문단 분리 + 영어에만 클래스</strong> (가장 간단)
    <div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.
    
Hello. Everyone. {.en}
</code></pre></div>    </div>
  </li>
</ul>

<p>또는
    ```md
    안녕하세요.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello. Everyone.
{:.en}
```
</code></pre></div></div>

<blockquote>
  <p>빈 줄 하나로 영어를 <strong>별도 문단</strong> 으로 만들면 <code class="language-plaintext highlighter-rouge">.en</code>이 영어 문단에만 적용됩니다.</p>
</blockquote>

<ul>
  <li>✅ <strong>같은 문단을 유지해야 한다면</strong> → 줄바꿈은 <code class="language-plaintext highlighter-rouge">&lt;br&gt;</code>로, 영어만 감싸기
    <div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.<span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"en"</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>Hello. Everyone.<span class="nt">&lt;/span&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>✅ <strong>커스텀 태그 선호 시</strong>
    <div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.
<span class="nt">&lt;en</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>Hello. Everyone.<span class="nt">&lt;/en&gt;</span>
</code></pre></div>    </div>
  </li>
</ul>

<ol>
  <li><strong>CSS 예시(Material 테마 기준)</strong></li>
</ol>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/* 영어 번역을 작고 연하게 */</span>
<span class="nc">.md-typeset</span> <span class="nc">.en</span><span class="o">,</span>
<span class="nc">.md-typeset</span> <span class="nt">en</span> <span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">0.85em</span><span class="p">;</span>
  <span class="nl">opacity</span><span class="p">:</span> <span class="m">0.65</span><span class="p">;</span>
<span class="p">}</span>

<span class="c">/* 한국어 문단 바로 다음 영어 문단 간격 다듬기 */</span>
<span class="nc">.md-typeset</span> <span class="nt">p</span> <span class="o">+</span> <span class="nt">p</span><span class="nc">.en</span> <span class="p">{</span> <span class="nl">margin-top</span><span class="p">:</span> <span class="m">0.25em</span><span class="p">;</span> <span class="p">}</span>

<span class="c">/* &lt;en&gt;을 줄바꿈 형태로 쓰려면 */</span>
<span class="nc">.md-typeset</span> <span class="nt">en</span> <span class="p">{</span> <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span> <span class="nl">margin-top</span><span class="p">:</span> <span class="m">0.25em</span><span class="p">;</span> <span class="p">}</span>
</code></pre></div></div>

<ol>
  <li><strong>빠른 체크리스트</strong></li>
</ol>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">mkdocs.yml</code>에 <code class="language-plaintext highlighter-rouge">- attr_list</code>가 있음?</p>
  </li>
  <li>
    <p>CSS가 <code class="language-plaintext highlighter-rouge">extra_css</code>로 로드됨?</p>
  </li>
  <li>
    <p>한글 줄 끝 <strong>공백 두 개</strong> 로 줄바꿈을 만들고 있지는 않음? (그럼 같은 문단이 됩니다)</p>
  </li>
  <li>
    <p>영어를 <strong>별도 문단</strong> 으로 만들었는지, 아니면 <code class="language-plaintext highlighter-rouge">&lt;span class="en"&gt;…&lt;/span&gt;</code>로 <strong>인라인만</strong> 감쌌는지</p>
  </li>
</ul>

<p>요약: <code class="language-plaintext highlighter-rouge">{.en}</code>/<strong><code class="language-plaintext highlighter-rouge">{:.en}</code>은 제대로 동작</strong>합니다. 다만 “속성은 <strong>바로 앞 블록 전체</strong> 에 붙는다”는 규칙 때문에, 영어만 스타일링하려면 <strong>영어를 별도 블록으로 분리</strong> 하거나 <strong>영어만 인라인으로 감싸야</strong> 합니다.</p>

<p class="chat--user">

아니 그냥 Hello. Everyone. {.en} 이렇게 최종 렌더링 되는데

</p>

<p>아하, 그럼 상황이 확실해요.<br />
<strong><code class="language-plaintext highlighter-rouge">Hello. Everyone. {.en}</code>가 그대로 글자로 보이는 건 MkDocs(=Python-Markdown)</strong>에서는 <strong>문단(paragraph) 끝에<code class="language-plaintext highlighter-rouge">{.en}</code>을 붙이는 문법이 동작하지 않기 때문</strong>입니다. 그건 주로 <strong>Kramdown(Jekyll)</strong> 쪽 문법이고, MkDocs에서는 <strong>단독 줄의 속성 블록</strong> 을 써야 해요.</p>

<p>아래처럼 고치면 됩니다—차근차근:</p>

<h2 id="1-결론부터-이렇게-쓰세요">1) 결론부터: 이렇게 쓰세요</h2>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.

{:.en lang=en}
Hello. Everyone.
</code></pre></div></div>

<ul>
  <li>
    <p>포인트 1: <strong>한국어와 영어 사이에 빈 줄 1개</strong> → 서로 <strong>다른 문단</strong> 이 됩니다.</p>
  </li>
  <li>
    <p>포인트 2: <code class="language-plaintext highlighter-rouge">{: .en}</code>은 <strong>“바로 아래 블록(영어 문단)”</strong> 에만 붙게 앞줄에 둡니다.</p>
  </li>
  <li>
    <p>포인트 3: 접근성용으로 <code class="language-plaintext highlighter-rouge">lang=en</code>도 같이 달아주면 좋아요.</p>
  </li>
</ul>

<h2 id="2-왜-hello-everyone-en가-안-먹나">2) 왜 <code class="language-plaintext highlighter-rouge">Hello. Everyone. {.en}</code>가 안 먹나?</h2>

<ul>
  <li>
    <p>MkDocs의 <strong>attr_list</strong> 는 “<strong>단독 줄</strong> 의 속성 블록”이나 “<strong>특정 요소 바로 뒤</strong>(예: 이미지, 링크, 헤더 등)”에서 주로 작동합니다.</p>
  </li>
  <li>
    <p><strong>평범한 문단 텍스트</strong> 뒤에 같은 줄로 <code class="language-plaintext highlighter-rouge">{.en}</code>을 붙이는 방식은 <strong>지원하지 않아서</strong> 그대로 렌더링돼요.</p>
  </li>
</ul>

<h2 id="3-공백-두-칸엔터-쓰면-왜-한글까지-흐려지나">3) 공백 두 칸(+엔터) 쓰면 왜 한글까지 흐려지나?</h2>

<ul>
  <li>
    <p>줄 끝 <strong>공백 두 칸</strong> 은 <strong>같은 문단 안 <code class="language-plaintext highlighter-rouge">&lt;br&gt;</code></strong>만 만들어요.</p>
  </li>
  <li>
    <p>그래서 “안녕하세요 + <code class="language-plaintext highlighter-rouge">&lt;br&gt;</code> + Hello …”가 <strong>한 문단</strong> 이 되고,<br />
뒤줄의 <code class="language-plaintext highlighter-rouge">{: .en}</code>을 쓰면 <strong>그 한 문단 전체</strong> 에 클래스가 붙어 <strong>한글까지 연해집니다.</strong></p>
  </li>
  <li>
    <p>해결: 공백 두 칸을 <strong>지우고 빈 줄</strong> 로 <strong>문단 분리</strong> 하거나, 같은 문단을 유지하고 싶다면 <strong>영어만 인라인으로 감싸기</strong> 👇</p>
  </li>
</ul>

<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.<span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"en"</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>Hello. Everyone.<span class="nt">&lt;/span&gt;</span>
</code></pre></div></div>

<h2 id="4-css그대로-쓰셔도-됩니다">4) CSS(그대로 쓰셔도 됩니다)</h2>
<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/* 영어 번역: 조금 작고 연하게 */</span>
<span class="nc">.md-typeset</span> <span class="nc">.en</span><span class="o">,</span>
<span class="nc">.md-typeset</span> <span class="nt">en</span> <span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">0.85em</span><span class="p">;</span>
  <span class="nl">opacity</span><span class="p">:</span> <span class="m">0.65</span><span class="p">;</span>
<span class="p">}</span>

<span class="c">/* &lt;en&gt; 커스텀 태그를 블록처럼 쓸 때 */</span>
<span class="nc">.md-typeset</span> <span class="nt">en</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>
  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">0.25em</span><span class="p">;</span>
<span class="p">}</span>

<span class="c">/* 문단 분리 케이스: 한글 문단 바로 뒤 영어 문단의 간격 */</span>
<span class="nc">.md-typeset</span> <span class="nt">p</span> <span class="o">+</span> <span class="nt">p</span><span class="nc">.en</span> <span class="p">{</span> <span class="nl">margin-top</span><span class="p">:</span> <span class="m">0.25em</span><span class="p">;</span> <span class="p">}</span>
</code></pre></div></div>

<h2 id="5-빠른-체크">5) 빠른 체크</h2>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">mkdocs.yml</code> → <code class="language-plaintext highlighter-rouge">markdown_extensions: - attr_list</code> 들어가 있나요?</p>
  </li>
  <li>
    <p>한국어 줄 끝 <strong>공백 두 칸</strong> 제거하고 <strong>빈 줄</strong> 로 문단 분리했나요?</p>
  </li>
  <li>
    <p>영어 문단 <strong>앞줄</strong> 에 <code class="language-plaintext highlighter-rouge">{: .en}</code>을 뒀나요? (뒤줄×, 같은 줄×)</p>
  </li>
</ol>

<p>원하시면 지금 문제 나는 실제 3~4줄 붙여 주시면, 그 형태에 딱 맞춰 “한 줄 수정” 버전으로 바로 고쳐드릴게요!</p>

<p class="chat--user">

markdown 패키지만 가지고 한 번 테스트 해보고 싶어. 쥬피터 노트북 예시 만들어줘

</p>

<p>좋아! <strong>Python-Markdown만</strong> 으로 테스트해볼 수 있는 쥬피터 노트북을 만들어 놨어.<br />
여기서 내려받아 로컬에서 실행해 보세요:</p>

<p>Download the Jupyter Notebook</p>

<h3 id="노트북에-들어있는-것-step-by-step">노트북에 들어있는 것 (step-by-step)</h3>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">!pip install markdown</code> — Python-Markdown 설치</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">attr_list</code> 확장 켠 렌더 함수 + CSS</p>
  </li>
  <li>
    <p>케이스별 미리보기:</p>

    <ul>
      <li>
        <p><strong>A</strong> : <code class="language-plaintext highlighter-rouge">Hello. Everyone. {.en}</code> → <em>동작 안 하는</em> 예시를 눈으로 확인</p>
      </li>
      <li>
        <p><strong>B</strong> : <code class="language-plaintext highlighter-rouge">{: .en}</code> 줄을 <strong>앞</strong> 에 두면 <strong>다음 블록</strong> 에 적용</p>
      </li>
      <li>
        <p><strong>C</strong> : <code class="language-plaintext highlighter-rouge">{: .en}</code> 줄을 <strong>뒤</strong> 에 두면 <strong>이전 블록</strong> 에 적용</p>
      </li>
      <li>
        <p><strong>D</strong> : 빈 줄로 문단 분리 후 영어 문단에만 <code class="language-plaintext highlighter-rouge">{:.en}</code> 적용</p>
      </li>
      <li>
        <p><strong>E</strong> : 같은 문단 유지 → <code class="language-plaintext highlighter-rouge">&lt;br&gt;</code> + <code class="language-plaintext highlighter-rouge">&lt;span class="en"&gt;…&lt;/span&gt;</code></p>
      </li>
      <li>
        <p><strong>F</strong> : <code class="language-plaintext highlighter-rouge">&lt;en&gt;…&lt;/en&gt;</code> 커스텀 태그</p>
      </li>
    </ul>
  </li>
</ol>

<h3 id="사용-팁-핵심만">사용 팁 (핵심만)</h3>

<ul>
  <li>
    <p><strong>문단 텍스트 같은 줄 끝의<code class="language-plaintext highlighter-rouge">{.en}</code></strong> 는 보통 <strong>문단에는 적용되지 않음</strong> → A 케이스로 확인 가능</p>
  </li>
  <li>
    <p>문단에 클래스 주려면 <strong>속성만 있는 줄</strong>(<code class="language-plaintext highlighter-rouge">{:.en}</code>)을 <strong>앞 또는 뒤</strong> 에 둬서 <strong>그 블록에 붙이기</strong>(B/C)</p>
  </li>
  <li>
    <p>한국어/영어를 <strong>다른 문단</strong> 으로 분리하면(D) 제어가 가장 깔끔</p>
  </li>
  <li>
    <p>한 문단 내 줄바꿈이면(E) 영어만 <code class="language-plaintext highlighter-rouge">&lt;span class="en"&gt;</code>로 감싸기</p>
  </li>
</ul>

<p>노트북 돌려보시고, 혹시 특정 케이스가 기대와 다르게 나오면 그 셀 출력 캡처나 원문을 붙여줘—원인 딱 집어서 고쳐드릴게!</p>

<p class="chat--user">

보기 힘들어 그냥 본문에 써줘

</p>

<p>오케이—노트북 파일 말고, <strong>그대로 복붙해서 돌릴 수 있는 셀</strong> 을 본문에 씁니다.<br />
아래 두 셀만 Jupyter에 순서대로 붙여넣고 실행하세요. (첫 셀은 설치, 두 번째 셀은 케이스 A~F를 한 번에 렌더/미리보기)</p>

<hr />

<h3 id="셀-1--설치">셀 1 — 설치</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">pip</span> <span class="o">-</span><span class="n">q</span> <span class="n">install</span> <span class="n">markdown</span>
</code></pre></div></div>

<h3 id="셀-2--렌더-도우미--케이스-af-미리보기">셀 2 — 렌더 도우미 + 케이스 A~F 미리보기</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span><span class="p">,</span> <span class="n">display</span>
<span class="kn">import</span> <span class="n">markdown</span>

<span class="n">CSS</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
.md-typeset .en,
.md-typeset en {
  font-size: 0.85em;
  opacity: 0.65;
}
.md-typeset en {
  display: block;
  margin-top: 0.25em;
}
.md-typeset p + p.en {  /* 한국어 문단 바로 다음 영어 문단 간격 */
  margin-top: 0.25em;
}
/* 보기 편하도록 테두리 */
.demo {
  border: 1px solid #ddd;
  padding: 12px;
  margin: 8px 0 24px 0;
  border-radius: 6px;
  background: #fafafa;
}
</span><span class="sh">'''</span>

<span class="k">def</span> <span class="nf">render_md</span><span class="p">(</span><span class="n">md_text</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sh">""</span><span class="p">):</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">markdown</span><span class="p">.</span><span class="nf">markdown</span><span class="p">(</span>
        <span class="n">md_text</span><span class="p">,</span>
        <span class="n">extensions</span><span class="o">=</span><span class="p">[</span>
            <span class="sh">"</span><span class="s">attr_list</span><span class="sh">"</span><span class="p">,</span>   <span class="c1"># 핵심 확장
</span>            <span class="c1"># "extra",     # 원하면 추가(여기에도 attr_list 포함됨)
</span>            <span class="c1"># "md_in_html" # 복잡한 HTML 블록 내 마크다운이 필요할 때
</span>        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">wrapped</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"""</span><span class="s">
    &lt;style&gt;</span><span class="si">{</span><span class="n">CSS</span><span class="si">}</span><span class="s">&lt;/style&gt;
    &lt;div class=</span><span class="sh">"</span><span class="s">demo</span><span class="sh">"</span><span class="s">&gt;
      &lt;div&gt;&lt;strong&gt;Markdown 원문&lt;/strong&gt;&lt;/div&gt;
      &lt;pre style=</span><span class="sh">"</span><span class="s">white-space:pre-wrap</span><span class="sh">"</span><span class="s">&gt;</span><span class="si">{</span><span class="n">md_text</span><span class="si">}</span><span class="s">&lt;/pre&gt;
      &lt;div style=</span><span class="sh">"</span><span class="s">margin-top:8px</span><span class="sh">"</span><span class="s">&gt;&lt;strong&gt;렌더 결과&lt;/strong&gt;&lt;/div&gt;
      &lt;div class=</span><span class="sh">"</span><span class="s">md-typeset</span><span class="sh">"</span><span class="s">&gt;</span><span class="si">{</span><span class="n">html</span><span class="si">}</span><span class="s">&lt;/div&gt;
    &lt;/div&gt;
    </span><span class="sh">"""</span>
    <span class="nf">display</span><span class="p">(</span><span class="nc">HTML</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">&lt;h3&gt;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s">&lt;/h3&gt;</span><span class="sh">"</span> <span class="o">+</span> <span class="n">wrapped</span><span class="p">))</span>

<span class="c1"># ───────── 테스트 케이스 ─────────
</span>
<span class="c1"># A) 같은 줄 끝에 {.en} → 일반 문단에서는 보통 "동작 안 함" (그대로 텍스트로 보임)
</span><span class="n">case_A</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">Hello. Everyone. {.en}</span><span class="sh">"""</span>

<span class="c1"># B) 속성 줄을 '앞'에 두면 → "다음 블록"에 적용
</span><span class="n">case_B</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">{:.en lang=en}
Hello. Everyone.</span><span class="sh">"""</span>

<span class="c1"># C) 속성 줄을 '뒤'에 두면 → "이전 블록"에 적용
</span><span class="n">case_C</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">Hello. Everyone.
{:.en lang=en}</span><span class="sh">"""</span>

<span class="c1"># D) 문단 분리(빈 줄) 후 영어 문단에만 적용
</span><span class="n">case_D</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">안녕하세요.

Hello. Everyone.
{:.en}</span><span class="sh">"""</span>

<span class="c1"># E) 같은 문단 유지: 줄바꿈은 &lt;br&gt;, 영어만 인라인으로 감싸기
</span><span class="n">case_E</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">안녕하세요.&lt;br&gt;
&lt;span class=</span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="s"> lang=</span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="s">&gt;Hello. Everyone.&lt;/span&gt;</span><span class="sh">"""</span>

<span class="c1"># F) 커스텀 태그 &lt;en&gt;
</span><span class="n">case_F</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">안녕하세요.
&lt;en lang=</span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="s">&gt;Hello. Everyone.&lt;/en&gt;</span><span class="sh">"""</span>

<span class="c1"># 렌더
</span><span class="nf">render_md</span><span class="p">(</span><span class="n">case_A</span><span class="p">,</span> <span class="sh">"</span><span class="s">A) same-line `{.en}` (문단에는 보통 적용 안 됨)</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">render_md</span><span class="p">(</span><span class="n">case_B</span><span class="p">,</span> <span class="sh">"</span><span class="s">B) attr 줄을 앞에 → 다음 블록에 적용</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">render_md</span><span class="p">(</span><span class="n">case_C</span><span class="p">,</span> <span class="sh">"</span><span class="s">C) attr 줄을 뒤에 → 이전 블록에 적용</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">render_md</span><span class="p">(</span><span class="n">case_D</span><span class="p">,</span> <span class="sh">"</span><span class="s">D) 문단 분리 + 영어 문단만 스타일</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">render_md</span><span class="p">(</span><span class="n">case_E</span><span class="p">,</span> <span class="sh">"</span><span class="s">E) 같은 문단 유지: &lt;br&gt; + &lt;span class=</span><span class="sh">'</span><span class="s">en</span><span class="sh">'</span><span class="s">&gt;</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">render_md</span><span class="p">(</span><span class="n">case_F</span><span class="p">,</span> <span class="sh">"</span><span class="s">F) 커스텀 태그 &lt;en&gt;</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="무엇이-보이면-정상인가-체크-포인트">무엇이 보이면 정상인가 (체크 포인트)</h2>

<ul>
  <li>
    <p><strong>A</strong> : <code class="language-plaintext highlighter-rouge">Hello. Everyone. {.en}</code> 가 <strong>그대로 글자</strong> 로 보임 → 일반 문단에서는 같은 줄 끝 <code class="language-plaintext highlighter-rouge">{.en}</code>이 <strong>안 먹는다</strong> 는 증거.</p>
  </li>
  <li>
    <p><strong>B</strong> : 영어 줄이 <strong>작고 연하게</strong> 보임 → <code class="language-plaintext highlighter-rouge">{:.en}</code> (속성만 있는 줄)이 <strong>아래 블록(다음 문단)</strong> 에 적용.</p>
  </li>
  <li>
    <p><strong>C</strong> : 영어 줄이 <strong>작고 연하게</strong> 보임 → <code class="language-plaintext highlighter-rouge">{:.en}</code>이 <strong>위 블록(이전 문단)</strong> 에 적용.</p>
  </li>
  <li>
    <p><strong>D</strong> : 한국어/영어가 <strong>서로 다른 문단</strong> 이며, <strong>영어만</strong> 작고 연함.</p>
  </li>
  <li>
    <p><strong>E</strong> : 한 문단으로 보이되, <code class="language-plaintext highlighter-rouge">&lt;br&gt;</code> 다음 줄의 영어만 <strong>작고 연함</strong>.</p>
  </li>
  <li>
    <p><strong>F</strong> : <code class="language-plaintext highlighter-rouge">&lt;en&gt;…&lt;/en&gt;</code>도 <strong>작고 연함</strong>. (커스텀 태그를 CSS에서 선택자로 잡음)</p>
  </li>
</ul>

<blockquote>
  <p>결론: <strong>문단 텍스트 같은 줄 끝의<code class="language-plaintext highlighter-rouge">{.en}</code>은 기대대로 동작하지 않습니다.</strong><br />
 문단에 클래스를 주려면 <strong>속성만 있는 줄(<code class="language-plaintext highlighter-rouge">{:.en}</code>)</strong> 을 <strong>앞/뒤</strong> 에 두거나,<br />
 같은 문단을 유지하려면 <strong><code class="language-plaintext highlighter-rouge">&lt;br&gt;</code> + <code class="language-plaintext highlighter-rouge">&lt;span class="en"&gt;…&lt;/span&gt;</code></strong> 방식이 가장 확실합니다.</p>
</blockquote>

<p>원하시면 이 케이스 중 딱 맞는 패턴을 골라 MkDocs에 그대로 이식하는 예시도 바로 적어드릴게요.</p>

<p class="chat--user">

아무리 해도 그냥 앞 뒤 줄 띄워야함

</p>

<p>맞아요. <strong>결론 = 블록 속성 줄(<code class="language-plaintext highlighter-rouge">{: .en}</code>)은 “독립 블록”이어야 해서 앞뒤로 빈 줄을 둬서 ‘완전히 분리’하면 가장 안전</strong>합니다. 특히 Python-Markdown/MkDocs 조합에서는 이 규칙이 까다로워서, 실전에서는 “앞·뒤 줄 띄우기”가 사실상 정석이에요.</p>

<p>아래 3가지 <strong>항상 잘 먹는 패턴</strong> 만 써주세요.</p>

<hr />

<h2 id="1-이전-문단영어에-적용--가장-추천">1) “이전 문단(영어)”에 적용 — 가장 추천</h2>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.

Hello. Everyone.

{: .en lang=en}
</code></pre></div></div>

<ul>
  <li>포인트: <code class="language-plaintext highlighter-rouge">{: .en}</code> <strong>위·아래 모두 빈 줄</strong> → 속성 줄이 완전히 독립된 단락이 되어 <strong>바로 위 문단(영어)</strong> 에만 붙습니다.</li>
</ul>

<hr />

<h2 id="2-다음-문단영어에-적용">2) “다음 문단(영어)”에 적용</h2>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.

{: .en lang=en}

Hello. Everyone.
</code></pre></div></div>

<ul>
  <li>포인트: 마찬가지로 속성 줄 <strong>앞·뒤 빈 줄</strong> → <strong>바로 아래 문단(영어)</strong> 에만 붙습니다.</li>
</ul>

<hr />

<h2 id="3-같은-문단을-유지해야-할-때줄바꿈만--인라인-방식">3) 같은 문단을 유지해야 할 때(줄바꿈만) — 인라인 방식</h2>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.<span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"en"</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>Hello. Everyone.<span class="nt">&lt;/span&gt;</span>
</code></pre></div></div>

<ul>
  <li>블록 속성 규칙을 건드리지 않아서 환경 차이에 덜 민감합니다.</li>
</ul>

<hr />

<h2 id="css-material-기준-공통">CSS (Material 기준, 공통)</h2>
<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.md-typeset</span> <span class="nc">.en</span><span class="o">,</span> <span class="nc">.md-typeset</span> <span class="nt">en</span> <span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">0.85em</span><span class="p">;</span>   <span class="c">/* 작게 */</span>
  <span class="nl">opacity</span><span class="p">:</span> <span class="m">0.65</span><span class="p">;</span>       <span class="c">/* 연하게 */</span>
<span class="p">}</span>
<span class="nc">.md-typeset</span> <span class="nt">en</span> <span class="p">{</span>        <span class="c">/* &lt;en&gt;을 블록처럼 쓰고 싶을 때 */</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>
  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">0.25em</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.md-typeset</span> <span class="nt">p</span> <span class="o">+</span> <span class="nt">p</span><span class="nc">.en</span> <span class="p">{</span>  <span class="c">/* 한글 문단 바로 뒤 영어 문단 간격 다듬기 */</span>
  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">0.25em</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h3 id="왜-이렇게-해야-하나-짧게">왜 이렇게 해야 하나? (짧게)</h3>

<ul>
  <li>
    <p>속성 줄은 <strong>그 자체가 하나의 “단락(block)”</strong>이어야 인식됩니다.</p>
  </li>
  <li>
    <p>빈 줄이 없으면 파서가 “같은 문단의 일반 텍스트”로 오해해서 <code class="language-plaintext highlighter-rouge">{:.en}</code>이 <strong>그대로 글자</strong> 로 보이거나, 한 문단 전체(한글+영어)에 적용되는 일이 생깁니다.</p>
  </li>
  <li>
    <p>그래서 <strong>속성 줄을 위/아래 빈 줄로 고립</strong> 시키는 습관을 들이면 어디서든 안정적으로 동작합니다.</p>
  </li>
</ul>

<p>원하시면 지금 작성하신 실제 몇 줄을 보내 주시면, 위 패턴으로 <strong>최소 수정</strong> 버전을 바로 잡아드릴게요.</p>

<p class="chat--user">

pymdownx의 caret 처럼 간단히 가만의 <span class="en"> </span>을 추가할 수 없을까

</p>

<p>좋아, <strong>caret(예:<code class="language-plaintext highlighter-rouge">^^text^^</code>)처럼</strong> 간단한 기호로<br />
<code class="language-plaintext highlighter-rouge">&lt;span class="en"&gt;…&lt;/span&gt;</code>을 자동으로 넣고 싶다면 <strong>작은 커스텀 Markdown 확장</strong> 을 하나 추가하면 딱 해결돼요.<br />
아래대로 하면 <code class="language-plaintext highlighter-rouge">%%영문%%</code>처럼 쓰기만 해도 <code class="language-plaintext highlighter-rouge">&lt;span class="en" lang="en"&gt;영문&lt;/span&gt;</code>으로 렌더됩니다.</p>

<hr />

<h1 id="1-파이썬-확장-파일-만들기-510줄짜리-핵심">1) 파이썬 확장 파일 만들기 (5~10줄짜리 핵심)</h1>

<p>프로젝트 루트(보통 <code class="language-plaintext highlighter-rouge">mkdocs.yml</code> 옆)에 <code class="language-plaintext highlighter-rouge">en_span.py</code> 파일을 만들고 아래를 복붙하세요.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># en_span.py
</span><span class="kn">import</span> <span class="n">re</span>
<span class="kn">from</span> <span class="n">markdown.extensions</span> <span class="kn">import</span> <span class="n">Extension</span>
<span class="kn">from</span> <span class="n">markdown.inlinepatterns</span> <span class="kn">import</span> <span class="n">InlineProcessor</span>
<span class="kn">from</span> <span class="n">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span> <span class="k">as</span> <span class="n">etree</span>

<span class="k">class</span> <span class="nc">EnSpanInline</span><span class="p">(</span><span class="n">InlineProcessor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">md</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">md</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">klass</span> <span class="o">=</span> <span class="n">klass</span>
        <span class="n">self</span><span class="p">.</span><span class="n">lang</span> <span class="o">=</span> <span class="n">lang</span>

    <span class="k">def</span> <span class="nf">handleMatch</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">\%%</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">%%</span><span class="sh">'</span><span class="p">)</span>  <span class="c1"># \%% → %
</span>        <span class="n">el</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="nc">Element</span><span class="p">(</span><span class="sh">"</span><span class="s">span</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">el</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">class</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">klass</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">lang</span><span class="p">:</span>
            <span class="n">el</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">lang</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">lang</span><span class="p">)</span>
        <span class="n">el</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="k">return</span> <span class="n">el</span><span class="p">,</span> <span class="n">m</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">m</span><span class="p">.</span><span class="nf">end</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">EnSpanExtension</span><span class="p">(</span><span class="n">Extension</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">delim</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">%%</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Inline delimiter, e.g. %%, ^^, !!</span><span class="sh">"</span><span class="p">],</span>
            <span class="sh">"</span><span class="s">class</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">CSS class name</span><span class="sh">"</span><span class="p">],</span>
            <span class="sh">"</span><span class="s">lang</span><span class="sh">"</span><span class="p">:</span>  <span class="p">[</span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">lang attribute (</span><span class="sh">''</span><span class="s"> to disable)</span><span class="sh">"</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extendMarkdown</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">md</span><span class="p">):</span>
        <span class="n">delim</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">getConfig</span><span class="p">(</span><span class="sh">"</span><span class="s">delim</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">rf</span><span class="sh">"</span><span class="s">(?&lt;!\\)</span><span class="si">{</span><span class="n">re</span><span class="p">.</span><span class="nf">escape</span><span class="p">(</span><span class="n">delim</span><span class="p">)</span><span class="si">}</span><span class="s">(.+?)(?&lt;!\\)</span><span class="si">{</span><span class="n">re</span><span class="p">.</span><span class="nf">escape</span><span class="p">(</span><span class="n">delim</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="nc">EnSpanInline</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">md</span><span class="p">,</span>
                            <span class="n">klass</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="nf">getConfig</span><span class="p">(</span><span class="sh">"</span><span class="s">class</span><span class="sh">"</span><span class="p">),</span>
                            <span class="n">lang</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="nf">getConfig</span><span class="p">(</span><span class="sh">"</span><span class="s">lang</span><span class="sh">"</span><span class="p">))</span>
        <span class="c1"># 175: em/strong(EMPHASIS)보다 살짝 앞서도록 등록
</span>        <span class="n">md</span><span class="p">.</span><span class="n">inlinePatterns</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="n">proc</span><span class="p">,</span> <span class="sh">"</span><span class="s">en-span</span><span class="sh">"</span><span class="p">,</span> <span class="mi">175</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">makeExtension</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="nc">EnSpanExtension</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>
    <p>기본 구분자는 <code class="language-plaintext highlighter-rouge">%%…%%</code> 입니다.</p>
  </li>
  <li>
    <p>텍스트 안에서 <code class="language-plaintext highlighter-rouge">%%</code>를 <strong>문자 그대로 쓰고 싶으면</strong> <code class="language-plaintext highlighter-rouge">\%%</code>로 이스케이프하세요.</p>
  </li>
  <li>
    <p>이미 <code class="language-plaintext highlighter-rouge">pymdownx.caret</code>(^^)을 쓰고 있다면, 충돌 없이 <code class="language-plaintext highlighter-rouge">%%</code>만 쓰면 됩니다. (원하면 <code class="language-plaintext highlighter-rouge">delim: "^^"</code>로 바꿀 수 있어요)</p>
  </li>
</ul>

<hr />

<h1 id="2-mkdocsyml에-확장-등록">2) <code class="language-plaintext highlighter-rouge">mkdocs.yml</code>에 확장 등록</h1>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">theme</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">material</span>

<span class="na">markdown_extensions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">attr_list</span>
  <span class="pi">-</span> <span class="s1">'</span><span class="s">en_span:EnSpanExtension'</span>   <span class="c1"># 또는 그냥 - en_span  (makeExtension가 있으므로)</span>
  <span class="c1"># 옵션을 바꾸고 싶다면:</span>
  <span class="c1"># - en_span:</span>
  <span class="c1">#     delim: "%%"   # 바꾸려면 "^^" 등</span>
  <span class="c1">#     class: "en"</span>
  <span class="c1">#     lang: "en"</span>

<span class="na">extra_css</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">stylesheets/translation.css</span>
</code></pre></div></div>

<blockquote>
  <p><strong>주의:</strong> MkDocs가 이 모듈을 import할 수 있어야 해요.<br />
 가장 간단히는 <strong>MkDocs 실행할 때</strong> 프로젝트 루트를 파이썬 경로에 추가하세요.</p>

  <ul>
    <li>
      <p>macOS/Linux: <code class="language-plaintext highlighter-rouge">PYTHONPATH=. mkdocs serve</code></p>
    </li>
    <li>
      <p>Windows(PowerShell): <code class="language-plaintext highlighter-rouge">$env:PYTHONPATH="."; mkdocs serve</code></p>
    </li>
  </ul>

</blockquote>

<p>(혹은 <code class="language-plaintext highlighter-rouge">en_span.py</code>를 패키지로 설치하거나, venv의 <code class="language-plaintext highlighter-rouge">site-packages</code>에 넣어도 됩니다.)</p>

<hr />

<h1 id="3-css-material-기준">3) CSS (Material 기준)</h1>

<p><code class="language-plaintext highlighter-rouge">docs/stylesheets/translation.css</code>:</p>
<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.md-typeset</span> <span class="nc">.en</span> <span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">0.85em</span><span class="p">;</span>   <span class="c">/* 조금 작게 */</span>
  <span class="nl">opacity</span><span class="p">:</span> <span class="m">0.65</span><span class="p">;</span>       <span class="c">/* 연하게 */</span>
<span class="p">}</span>
</code></pre></div></div>

<p>원하면 줄 간격 조정, 색상 등도 여기서 커스텀하면 됩니다.</p>

<hr />

<h1 id="4-사용법">4) 사용법</h1>

<p>그냥 본문에 이렇게 쓰면 끝:</p>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요. %%Hello. Everyone.%%
</code></pre></div></div>

<p>렌더링 결과(핵심만):</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;p&gt;</span>안녕하세요. <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"en"</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>Hello. Everyone.<span class="nt">&lt;/span&gt;&lt;/p&gt;</span>
</code></pre></div></div>

<ul>
  <li>
    <p><strong>블록으로</strong> 쓰고 싶으면 기존대로 <code class="language-plaintext highlighter-rouge">{:.en}</code>을 쓰거나, <code class="language-plaintext highlighter-rouge">&lt;en&gt;…&lt;/en&gt;</code>를 쓰세요(이미 해두신 CSS로 스타일 적용 가능).</p>
  </li>
  <li>
    <p><strong>같은 문단에서 줄을 바꾸고 싶다면</strong> 여전히 <code class="language-plaintext highlighter-rouge">&lt;br&gt;</code>을 쓰는 게 가장 확실합니다:</p>
    <div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요.<span class="nt">&lt;br&gt;</span>%%Hello. Everyone.%%
</code></pre></div>    </div>
  </li>
</ul>

<hr />

<h1 id="5-대안플러그인-없이-가능한-꼼수">5) 대안(플러그인 없이 가능한 꼼수)</h1>

<p>플러그인을 전혀 쓰기 싫다면, 아래 꼼수도 가능은 합니다.</p>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="ge">*Hello. Everyone.*</span>{.en}
</code></pre></div></div>

<p>CSS로 기울임을 제거:</p>
<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.md-typeset</span> <span class="nt">em</span><span class="nc">.en</span> <span class="p">{</span> <span class="nl">font-style</span><span class="p">:</span> <span class="nb">normal</span><span class="p">;</span> <span class="p">}</span>
</code></pre></div></div>

<p>이렇게 하면 <code class="language-plaintext highlighter-rouge">&lt;em class="en"&gt;…&lt;/em&gt;</code>이 되는데, 시맨틱이 살짝 어긋나므로 <strong>권장도는 낮고</strong> ,<br />
가능하면 위의 <strong>커스텀 확장(%%…%%)</strong> 방식을 추천합니다.</p>

<hr />

<p>필요하면 <strong>구분자</strong> 를 <code class="language-plaintext highlighter-rouge">^^</code>나 <code class="language-plaintext highlighter-rouge">!!</code> 등으로 바꾼 버전도 바로 만들어 드릴게요. (옵션 한 줄만 바꾸면 됩니다)</p>

<p class="chat--user">

No module names 'en_span' 파일을 여기 넣는거 맞아?

</p>

<p>맞아요, 그 에러는 <strong>MkDocs가<code class="language-plaintext highlighter-rouge">en_span</code> 모듈을 import 못 해서</strong> 나는 거예요.<br />
핵심은 <strong>파일 위치 + 실행 위치 + 파이썬 경로(PYTHONPATH)</strong> 입니다. 아래대로 차근차근 해보세요.</p>

<hr />

<h2 id="0-올바른-폴더-구조-가장-단순한-형태">0) 올바른 폴더 구조 (가장 단순한 형태)</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pgsql

your-project/
├─ mkdocs.yml
├─ en_span.py          ← 여기!
└─ docs/
   ├─ index.md
   └─ stylesheets/
      └─ translation.css
</code></pre></div></div>

<blockquote>
  <p><strong>중요:</strong> <code class="language-plaintext highlighter-rouge">en_span.py</code>는 <code class="language-plaintext highlighter-rouge">docs/</code> 안이 아니라 <strong><code class="language-plaintext highlighter-rouge">mkdocs.yml</code>과 같은 디렉터리(프로젝트 루트)</strong> 에 두세요.</p>
</blockquote>

<hr />

<h2 id="1-mkdocsyml-설정-1">1) <code class="language-plaintext highlighter-rouge">mkdocs.yml</code> 설정</h2>

<p>가장 기본:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">markdown_extensions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">en_span</span>
</code></pre></div></div>

<p>옵션을 쓰고 싶다면:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">markdown_extensions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">en_span</span><span class="pi">:</span>
      <span class="na">delim</span><span class="pi">:</span> <span class="s2">"</span><span class="s">%%"</span>
      <span class="na">class</span><span class="pi">:</span> <span class="s2">"</span><span class="s">en"</span>
      <span class="na">lang</span><span class="pi">:</span> <span class="s2">"</span><span class="s">en"</span>
</code></pre></div></div>

<p>또는 클래스 경로로도 가능:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">markdown_extensions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s1">'</span><span class="s">en_span:EnSpanExtension'</span>
</code></pre></div></div>

<hr />

<h2 id="2-올바른-실행-위치에서-서버-시작">2) 올바른 실행 위치에서 서버 시작</h2>

<p>반드시 <strong>프로젝트 루트(=<code class="language-plaintext highlighter-rouge">mkdocs.yml</code>이 있는 위치)</strong> 로 이동해서 실행하세요.</p>

<ul>
  <li>macOS / Linux
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>your-project
<span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nb">.</span> mkdocs serve
</code></pre></div>    </div>
  </li>
  <li>Windows PowerShell
    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cd</span><span class="w"> </span><span class="nx">your-project</span><span class="w">
</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="s2">"."</span><span class="p">;</span><span class="w"> </span><span class="n">mkdocs</span><span class="w"> </span><span class="nx">serve</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Windows CMD
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bat
    
cd your-project
set PYTHONPATH=.
mkdocs serve
</code></pre></div>    </div>
  </li>
</ul>

<blockquote>
  <p>왜? MkDocs가 확장 모듈을 <strong>현재 파이썬 경로</strong> 에서 찾는데, 환경/실행 방법에 따라 현재 디렉터리가 경로에 안 잡힐 수 있습니다. <code class="language-plaintext highlighter-rouge">PYTHONPATH=.</code> 로 프로젝트 루트를 확실히 넣어주면 import 에러가 사라집니다.</p>
</blockquote>

<hr />

<h2 id="3-빠른-자가-점검-문제-계속되면-여기서-잡힙니다">3) 빠른 자가 점검 (문제 계속되면 여기서 잡힙니다)</h2>

<ol>
  <li>
    <p><strong>파일명</strong> 이 정확히 <code class="language-plaintext highlighter-rouge">en_span.py</code> 인가요? (<code class="language-plaintext highlighter-rouge">en-span.py</code> ×)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">en_span.py</code> 안에 <strong><code class="language-plaintext highlighter-rouge">makeExtension(**kwargs)</code></strong> 함수가 존재하나요? (필수)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">mkdocs serve</code>를 <strong>프로젝트 루트</strong> 에서 실행했나요? (다른 폴더에서 실행 ×)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">mkdocs.yml</code>에 <code class="language-plaintext highlighter-rouge">markdown_extensions: - en_span</code> 이 들어갔나요? (오탈자 ×)</p>
  </li>
  <li>그래도 안 되면, <strong>완전한 모듈 경로</strong> 로 시도:
```yaml
markdown_extensions:
    <ul>
      <li>'en_span:EnSpanExtension'
```</li>
    </ul>
  </li>
  <li>여전히 안 되면, <strong>패키지 폴더로 감싸기</strong> :
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>your-project/
├─ mkdocs.yml
├─ local_ext/
│  ├─ __init__.py
│  └─ en_span.py
└─ docs/...
</code></pre></div>    </div>
  </li>
</ol>

<p>그리고 <code class="language-plaintext highlighter-rouge">mkdocs.yml</code>:
     <code class="language-plaintext highlighter-rouge">yaml
     markdown_extensions:
       - local_ext.en_span
    </code></p>

<p>(이때도 <code class="language-plaintext highlighter-rouge">PYTHONPATH=.</code> 권장)</p>

<hr />

<h2 id="4-동작-확인용-최소-예제">4) 동작 확인용 최소 예제</h2>

<p><strong><code class="language-plaintext highlighter-rouge">docs/index.md</code></strong></p>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요. %%Hello. Everyone.%%
</code></pre></div></div>

<p><strong><code class="language-plaintext highlighter-rouge">en_span.py</code></strong> (핵심 부분만 재확인)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">re</span>
<span class="kn">from</span> <span class="n">markdown.extensions</span> <span class="kn">import</span> <span class="n">Extension</span>
<span class="kn">from</span> <span class="n">markdown.inlinepatterns</span> <span class="kn">import</span> <span class="n">InlineProcessor</span>
<span class="kn">from</span> <span class="n">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span> <span class="k">as</span> <span class="n">etree</span>

<span class="k">class</span> <span class="nc">EnSpanInline</span><span class="p">(</span><span class="n">InlineProcessor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">md</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">md</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">klass</span> <span class="o">=</span> <span class="n">klass</span>
        <span class="n">self</span><span class="p">.</span><span class="n">lang</span> <span class="o">=</span> <span class="n">lang</span>
    <span class="k">def</span> <span class="nf">handleMatch</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">\%%</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">%%</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="nc">Element</span><span class="p">(</span><span class="sh">"</span><span class="s">span</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">el</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">class</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">klass</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">lang</span><span class="p">:</span>
            <span class="n">el</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">lang</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">lang</span><span class="p">)</span>
        <span class="n">el</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="k">return</span> <span class="n">el</span><span class="p">,</span> <span class="n">m</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">m</span><span class="p">.</span><span class="nf">end</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">EnSpanExtension</span><span class="p">(</span><span class="n">Extension</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">delim</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">%%</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Inline delimiter</span><span class="sh">"</span><span class="p">],</span>
            <span class="sh">"</span><span class="s">class</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">CSS class</span><span class="sh">"</span><span class="p">],</span>
            <span class="sh">"</span><span class="s">lang</span><span class="sh">"</span><span class="p">:</span>  <span class="p">[</span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">lang attribute</span><span class="sh">"</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">extendMarkdown</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">md</span><span class="p">):</span>
        <span class="n">delim</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">getConfig</span><span class="p">(</span><span class="sh">"</span><span class="s">delim</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">rf</span><span class="sh">"</span><span class="s">(?&lt;!\\)</span><span class="si">{</span><span class="n">re</span><span class="p">.</span><span class="nf">escape</span><span class="p">(</span><span class="n">delim</span><span class="p">)</span><span class="si">}</span><span class="s">(.+?)(?&lt;!\\)</span><span class="si">{</span><span class="n">re</span><span class="p">.</span><span class="nf">escape</span><span class="p">(</span><span class="n">delim</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span>
        <span class="n">md</span><span class="p">.</span><span class="n">inlinePatterns</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span>
            <span class="nc">EnSpanInline</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">md</span><span class="p">,</span>
                         <span class="n">klass</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="nf">getConfig</span><span class="p">(</span><span class="sh">"</span><span class="s">class</span><span class="sh">"</span><span class="p">),</span>
                         <span class="n">lang</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="nf">getConfig</span><span class="p">(</span><span class="sh">"</span><span class="s">lang</span><span class="sh">"</span><span class="p">)),</span>
            <span class="sh">"</span><span class="s">en-span</span><span class="sh">"</span><span class="p">,</span> <span class="mi">175</span>
        <span class="p">)</span>

<span class="k">def</span> <span class="nf">makeExtension</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="nc">EnSpanExtension</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="5-그래도-같은-에러면">5) 그래도 같은 에러면?</h2>

<ul>
  <li>
    <p>콘솔에서 한 번 직접 import 해보세요:</p>

    <ul>
      <li>macOS/Linux:
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>your-project
<span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nb">.</span> python <span class="nt">-c</span> <span class="s2">"import en_span; print(en_span)"</span>
</code></pre></div>        </div>
      </li>
      <li>Windows PowerShell:
        <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cd</span><span class="w"> </span><span class="nx">your-project</span><span class="w">
</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="s2">"."</span><span class="p">;</span><span class="w"> </span><span class="n">python</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="s2">"import en_span; print(en_span)"</span><span class="w">
</span></code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<p>이게 실패하면 <strong>경로 문제</strong> 가 확실합니다. 위 2)번(실행 위치)과 3)번(패키지 폴더) 방법으로 정리하면 해결됩니다.</p>

<hr />

<p>원하시면 지금 프로젝트 트리(대충 <code class="language-plaintext highlighter-rouge">tree</code> 결과나 스크린샷)와 <code class="language-plaintext highlighter-rouge">mkdocs.yml</code>의 해당 부분을 보내 주세요. 그대로 맞춰서 <strong>한 줄도 헷갈리지 않게</strong> 수정본 만들어 드릴게요.</p>

<p class="chat--user">

그냥 패키지 설치를 해버려야겠어. markdown_en_span 이라는 패키지로 만들어주고 src 폴더와 pyproject.toml을 여기에 포함시켜서 설치할 수 있게 해줘

</p>

<p>좋아—<strong>로컬에서 바로 설치 가능한 패키지</strong> 로 만들어 드릴게요.<br />
패키지명은 요청하신 대로 <code class="language-plaintext highlighter-rouge">markdown_en_span</code>, <strong>src 레이아웃</strong> + <code class="language-plaintext highlighter-rouge">pyproject.toml</code> 포함입니다.</p>

<hr />

<h1 id="1-디렉터리-구조-만들기">1) 디렉터리 구조 만들기</h1>
<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">your-project</span><span class="o">/</span>
<span class="err">├─</span> <span class="nt">pyproject</span><span class="nc">.toml</span>
<span class="err">└─</span> <span class="nt">src</span><span class="o">/</span>
   <span class="err">└─</span> <span class="nt">markdown_en_span</span><span class="o">/</span>
      <span class="err">└─</span> <span class="nt">__init__</span><span class="nc">.py</span>
</code></pre></div></div>

<hr />

<h1 id="2-pyprojecttoml">2) <code class="language-plaintext highlighter-rouge">pyproject.toml</code></h1>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[build-system]</span>
<span class="py">requires</span> <span class="p">=</span> <span class="py">["hatchling&gt;</span><span class="p">=</span><span class="mf">1.18</span><span class="s">"]</span><span class="err">
</span><span class="py">build-backend</span> <span class="p">=</span> <span class="s">"hatchling.build"</span>

<span class="nn">[project]</span>
<span class="py">name</span> <span class="p">=</span> <span class="s">"markdown_en_span"</span>
<span class="py">version</span> <span class="p">=</span> <span class="s">"0.1.0"</span>
<span class="py">description</span> <span class="p">=</span> <span class="s">"Python-Markdown inline extension to wrap %%text%% as &lt;span class='en' lang='en'&gt;text&lt;/span&gt;."</span>
<span class="py">readme</span> <span class="p">=</span> <span class="s">"README.md"</span>
<span class="py">requires-python</span> <span class="p">=</span> <span class="py">"&gt;</span><span class="p">=</span><span class="mf">3.8</span><span class="s">"</span><span class="err">
</span><span class="py">authors</span> <span class="p">=</span> <span class="py">[{name</span> <span class="p">=</span> <span class="s">"Your Name"</span><span class="err">}]</span>
<span class="py">dependencies</span> <span class="p">=</span> <span class="py">["Markdown&gt;</span><span class="p">=</span><span class="mf">3.3</span><span class="s">"]</span><span class="err">
</span>
<span class="nn">[project.urls]</span>
<span class="py">Homepage</span> <span class="p">=</span> <span class="s">"https://example.com/markdown_en_span"</span>

<span class="c"># Python-Markdown이 이 확장을 'en_span' 이름으로 인식하게 하는 엔트리포인트</span>
<span class="nn">[project.entry-points."markdown.extensions"]</span>
<span class="py">en_span</span> <span class="p">=</span> <span class="s">"markdown_en_span:makeExtension"</span>
</code></pre></div></div>

<blockquote>
  <p>포인트</p>

  <ul>
    <li>
      <p><strong>엔트리포인트</strong> 덕분에 <code class="language-plaintext highlighter-rouge">mkdocs.yml</code>에서 <code class="language-plaintext highlighter-rouge">markdown_extensions: - en_span</code>처럼 <strong>짧은 이름</strong> 으로 쓸 수 있어요.</p>
    </li>
    <li>
      <p>배포명(<code class="language-plaintext highlighter-rouge">name</code>)과 모듈명(폴더)은 둘 다 <code class="language-plaintext highlighter-rouge">markdown_en_span</code>로 통일.</p>
    </li>
  </ul>

</blockquote>

<hr />

<h1 id="3-srcmarkdown_en_span__init__py">3) <code class="language-plaintext highlighter-rouge">src/markdown_en_span/__init__.py</code></h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">re</span>
<span class="kn">from</span> <span class="n">markdown.extensions</span> <span class="kn">import</span> <span class="n">Extension</span>
<span class="kn">from</span> <span class="n">markdown.inlinepatterns</span> <span class="kn">import</span> <span class="n">InlineProcessor</span>
<span class="kn">from</span> <span class="n">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span> <span class="k">as</span> <span class="n">etree</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">EnSpanExtension</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">makeExtension</span><span class="sh">"</span><span class="p">]</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="sh">"</span><span class="s">0.1.0</span><span class="sh">"</span>

<span class="k">class</span> <span class="nc">EnSpanInline</span><span class="p">(</span><span class="n">InlineProcessor</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Wraps %%text%% (기본) → &lt;span class=</span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="s"> lang=</span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="s">&gt;text&lt;/span&gt;
    - 구분자는 옵션으로 변경 가능 (예: ^^ 또는 !!)
    - \%% 처럼 백슬래시로 이스케이프하면 리터럴 %% 출력
    </span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">delim</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">md</span><span class="p">,</span> <span class="n">css_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="p">,</span> <span class="n">lang</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="p">):</span>
        <span class="c1"># DOTALL 활성화: 필요 시 여러 줄도 매칭
</span>        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">rf</span><span class="sh">"</span><span class="s">(?s)(?&lt;!\\)</span><span class="si">{</span><span class="n">re</span><span class="p">.</span><span class="nf">escape</span><span class="p">(</span><span class="n">delim</span><span class="p">)</span><span class="si">}</span><span class="s">(.+?)(?&lt;!\\)</span><span class="si">{</span><span class="n">re</span><span class="p">.</span><span class="nf">escape</span><span class="p">(</span><span class="n">delim</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">md</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">delim</span> <span class="o">=</span> <span class="n">delim</span>
        <span class="n">self</span><span class="p">.</span><span class="n">css_class</span> <span class="o">=</span> <span class="n">css_class</span>
        <span class="n">self</span><span class="p">.</span><span class="n">lang</span> <span class="o">=</span> <span class="n">lang</span>

    <span class="k">def</span> <span class="nf">handleMatch</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># 본문 텍스트
</span>        <span class="n">text</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># \%% → %% (사용자가 리터럴 구분자를 넣고 싶을 때)
</span>        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\\</span><span class="sh">"</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">delim</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">delim</span><span class="p">)</span>

        <span class="n">el</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="nc">Element</span><span class="p">(</span><span class="sh">"</span><span class="s">span</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">el</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">class</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">css_class</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">lang</span><span class="p">:</span>
            <span class="n">el</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">lang</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">lang</span><span class="p">)</span>
        <span class="n">el</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="k">return</span> <span class="n">el</span><span class="p">,</span> <span class="n">m</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">m</span><span class="p">.</span><span class="nf">end</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">EnSpanExtension</span><span class="p">(</span><span class="n">Extension</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    확장 옵션:
      - delim: 기본 </span><span class="sh">"</span><span class="s">%%</span><span class="sh">"</span><span class="s">
      - class: 기본 </span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="s">
      - lang:  기본 </span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="s"> (빈 문자열이면 lang 속성 생략)
    </span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">delim</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">%%</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Inline delimiter, e.g. %%, ^^, !!</span><span class="sh">"</span><span class="p">],</span>
            <span class="sh">"</span><span class="s">class</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">CSS class name to set on &lt;span&gt;</span><span class="sh">"</span><span class="p">],</span>
            <span class="sh">"</span><span class="s">lang</span><span class="sh">"</span><span class="p">:</span>  <span class="p">[</span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">lang attribute value (</span><span class="sh">''</span><span class="s"> to disable)</span><span class="sh">"</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extendMarkdown</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">md</span><span class="p">):</span>
        <span class="n">delim</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">getConfig</span><span class="p">(</span><span class="sh">"</span><span class="s">delim</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">css_class</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">getConfig</span><span class="p">(</span><span class="sh">"</span><span class="s">class</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">lang</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">getConfig</span><span class="p">(</span><span class="sh">"</span><span class="s">lang</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="nc">EnSpanInline</span><span class="p">(</span><span class="n">delim</span><span class="o">=</span><span class="n">delim</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="n">md</span><span class="p">,</span> <span class="n">css_class</span><span class="o">=</span><span class="n">css_class</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span>
        <span class="c1"># emphasis(EMPHASIS=170)보다 약간 앞서도록 등록
</span>        <span class="n">md</span><span class="p">.</span><span class="n">inlinePatterns</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="n">proc</span><span class="p">,</span> <span class="sh">"</span><span class="s">en-span</span><span class="sh">"</span><span class="p">,</span> <span class="mi">175</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">makeExtension</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="nc">EnSpanExtension</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h1 id="4-설치-로컬">4) 설치 (로컬)</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 프로젝트 루트(= pyproject.toml 있는 곳)에서</span>
pip <span class="nb">install</span> <span class="nt">-e</span> <span class="nb">.</span>
<span class="c"># 또는</span>
pip <span class="nb">install</span> <span class="nb">.</span>
</code></pre></div></div>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">-e</code>는 개발 중 수정사항이 바로 반영되는 <strong>editable</strong> 설치.</p>
</blockquote>

<hr />

<h1 id="5-mkdocs-사용-예시">5) MkDocs 사용 예시</h1>

<h2 id="mkdocsyml"><code class="language-plaintext highlighter-rouge">mkdocs.yml</code></h2>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">theme</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">material</span>

<span class="na">markdown_extensions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">en_span</span>            <span class="c1"># ← 방금 만든 확장 (엔트리포인트로 인식)</span>
  <span class="c1"># - attr_list        # (선택) 다른 용도 필요 시</span>
  <span class="c1"># - en_span:</span>
  <span class="c1">#     delim: "^^"    # 구분자 바꾸고 싶을 때</span>
  <span class="c1">#     class: "en"</span>
  <span class="c1">#     lang: "en"</span>

<span class="na">extra_css</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">stylesheets/translation.css</span>
</code></pre></div></div>

<h2 id="docsstylesheetstranslationcss"><code class="language-plaintext highlighter-rouge">docs/stylesheets/translation.css</code></h2>
<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.md-typeset</span> <span class="nc">.en</span> <span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">0.85em</span><span class="p">;</span>
  <span class="nl">opacity</span><span class="p">:</span> <span class="m">0.65</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="docsindexmd"><code class="language-plaintext highlighter-rouge">docs/index.md</code></h2>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요. %%Hello. Everyone.%%
</code></pre></div></div>

<p>→ 렌더링:</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;p&gt;</span>안녕하세요. <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"en"</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>Hello. Everyone.<span class="nt">&lt;/span&gt;&lt;/p&gt;</span>
</code></pre></div></div>

<hr />

<h1 id="6-팁--트러블슈팅">6) 팁 &amp; 트러블슈팅</h1>

<ul>
  <li><strong>구분자 바꾸기</strong> : <code class="language-plaintext highlighter-rouge">mkdocs.yml</code>에
```yaml
markdown_extensions:
    <ul>
      <li>en_span:
  delim: "^^"
  class: "en"
  lang: "en"
```</li>
    </ul>
  </li>
</ul>

<p>→ <code class="language-plaintext highlighter-rouge">안녕하세요. ^^Hello. Everyone.^^</code></p>

<ul>
  <li>
    <p><strong>리터럴로<code class="language-plaintext highlighter-rouge">%%</code> 출력</strong>: <code class="language-plaintext highlighter-rouge">\%%</code> 처럼 이스케이프<br />
예) <code class="language-plaintext highlighter-rouge">가격은 \%%20 할인</code> → 실제 문서에 <code class="language-plaintext highlighter-rouge">%%20</code> 출력</p>
  </li>
  <li><strong>확장 로딩 확인</strong> (MkDocs 외에 순수 파이썬에서)
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">markdown</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">markdown</span><span class="p">.</span><span class="nf">markdown</span><span class="p">(</span><span class="sh">"</span><span class="s">안녕 %%Hello%%</span><span class="sh">"</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">en_span</span><span class="sh">"</span><span class="p">])</span>
<span class="nf">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>여전히 인식 안 되면</strong></p>

    <ul>
      <li>
        <p>설치 경로 확인: <code class="language-plaintext highlighter-rouge">pip show markdown_en_span</code></p>
      </li>
      <li>
        <p>가상환경 재시작 / MkDocs 재시작</p>
      </li>
      <li>
        <p>Markdown 버전 확인: <code class="language-plaintext highlighter-rouge">python -c "import markdown, sys; print(markdown.__version__)"</code> (3.3 이상 권장)</p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<p>필요하면 <code class="language-plaintext highlighter-rouge">README.md</code>/<code class="language-plaintext highlighter-rouge">LICENSE</code> 골격도 추가해 드릴게요. 원하시는 구분자(예: <code class="language-plaintext highlighter-rouge">||</code>), 기본 클래스명 변경 등 커스터마이즈 버전도 바로 만들어 줄 수 있어요.</p>

<p class="chat--user">

mkdocs 루트 폴더 밑에 너가 만들어준 패키지를 위치 시킬거야. requirements.txt에 상대경로로 인스톨 추가할 수 있어?

</p>

<p>가능해! <strong>requirements.txt</strong> 에서 <strong>상대경로</strong> 로 로컬 패키지를 설치할 수 있어요.<br />
요청하신 구조(패키지를 MkDocs 루트 바로 아래)에 맞춰 <strong>한 번에 되는</strong> 절차를 step-by-step으로 정리할게요.</p>

<hr />

<h1 id="0-폴더-구조예시">0) 폴더 구조(예시)</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>your-project/
├─ mkdocs.yml
├─ requirements.txt
├─ markdown_en_span/           <span class="c"># ← 여기 폴더가 “패키지 루트”</span>
│  ├─ pyproject.toml
│  └─ src/
│     └─ markdown_en_span/
│        └─ __init__.py
└─ docs/
   └─ stylesheets/translation.css
</code></pre></div></div>

<blockquote>
  <p>중요: <strong><code class="language-plaintext highlighter-rouge">pyproject.toml</code>이 들어있는 디렉터리</strong>(여기서는 <code class="language-plaintext highlighter-rouge">./markdown_en_span</code>)가 pip가 인식하는 “패키지 루트”예요.</p>
</blockquote>

<hr />

<h1 id="1-requirementstxt-작성">1) requirements.txt 작성</h1>

<h2 id="a-개발-중-수정사항을-바로-반영하고-싶을-때-editable">(A) 개발 중 수정사항을 바로 반영하고 싶을 때 (editable)</h2>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># MkDocs(원하면 버전 고정)</span>
mkdocs&gt;<span class="o">=</span>1.6
mkdocs-material&gt;<span class="o">=</span>9.5

<span class="c"># 로컬 확장 패키지(상대경로, editable 모드)</span>
<span class="nt">-e</span> ./markdown_en_span
</code></pre></div></div>

<h2 id="b-고정-설치수정-즉시-반영-필요-없을-때">(B) 고정 설치(수정 즉시 반영 필요 없을 때)</h2>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdocs&gt;<span class="o">=</span>1.6
mkdocs-material&gt;<span class="o">=</span>9.5

./markdown_en_span
</code></pre></div></div>

<blockquote>
  <p>두 경우 모두 <strong>상대경로는 requirements.txt 파일이 있는 위치 기준</strong> 으로 해석됩니다.</p>
</blockquote>

<hr />

<h1 id="2-설치">2) 설치</h1>

<p>프로젝트 루트에서:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-m</span> pip <span class="nb">install</span> <span class="nt">-U</span> pip          <span class="c"># 권장: 최신 pip (PEP 660 editable 지원)</span>
pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt
</code></pre></div></div>

<blockquote>
  <p><strong>editable(-e)</strong> 설치가 제대로 되려면 pip가 <strong>PEP 660</strong> 을 지원해야 합니다(대부분 최신 pip OK).</p>
</blockquote>

<hr />

<h1 id="3-mkdocsyml-설정">3) mkdocs.yml 설정</h1>

<p>엔트리포인트를 등록해둔 상태라면(제가 준 <code class="language-plaintext highlighter-rouge">pyproject.toml</code> 기준) 아래처럼 간단히 사용 가능:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">theme</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">material</span>

<span class="na">markdown_extensions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">en_span</span>               <span class="c1"># ← 방금 설치한 확장</span>
  <span class="c1"># - en_span:</span>
  <span class="c1">#     delim: "^^"       # 구분자 바꾸고 싶으면 옵션으로</span>
  <span class="c1">#     class: "en"</span>
  <span class="c1">#     lang: "en"</span>

<span class="na">extra_css</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">stylesheets/translation.css</span>
</code></pre></div></div>

<hr />

<h1 id="4-사용-예시">4) 사용 예시</h1>

<p><code class="language-plaintext highlighter-rouge">docs/index.md</code></p>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>안녕하세요. %%Hello. Everyone.%%
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">docs/stylesheets/translation.css</code></p>
<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.md-typeset</span> <span class="nc">.en</span> <span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">0.85em</span><span class="p">;</span>
  <span class="nl">opacity</span><span class="p">:</span> <span class="m">0.65</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h1 id="5-자주-생기는-이슈--체크리스트">5) 자주 생기는 이슈 &amp; 체크리스트</h1>

<ul>
  <li>
    <p><strong>설치가 안 된다면</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">pip --version</code>으로 최신인지 확인(가능하면 21.3+).</p>
      </li>
      <li>
        <p>프로젝트 루트에서 <code class="language-plaintext highlighter-rouge">pip install -r requirements.txt</code> 실행했는지 확인.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">markdown_en_span/pyproject.toml</code> 파일이 실제로 존재하는지 확인.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>MkDocs가 확장을 못 찾는다면</strong></p>

    <ul>
      <li>
        <p>설치 성공 여부: <code class="language-plaintext highlighter-rouge">pip show markdown_en_span</code></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">mkdocs.yml</code>의 <code class="language-plaintext highlighter-rouge">markdown_extensions:</code>에 <code class="language-plaintext highlighter-rouge">en_span</code>이 들어있는지 확인.</p>
      </li>
      <li>
        <p>서버 재시작: <code class="language-plaintext highlighter-rouge">mkdocs serve</code> 다시 실행.</p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<p>원하시면 제가 제공했던 <code class="language-plaintext highlighter-rouge">pyproject.toml</code>/<code class="language-plaintext highlighter-rouge">__init__.py</code> 샘플을 그대로 붙여드릴게요(파일 내용 다시 필요하면 말해줘!).</p>]]></content><author><name>hvppyarchive</name></author><category term="markdown" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">PySide6 웹 브라우저 만들기</title><link href="https://hvppyarchive.github.io/python/pyside6-browser/" rel="alternate" type="text/html" title="PySide6 웹 브라우저 만들기" /><published>2025-09-08T11:39:22+09:00</published><updated>2025-09-08T11:39:22+09:00</updated><id>https://hvppyarchive.github.io/python/pyside6-browser</id><content type="html" xml:base="https://hvppyarchive.github.io/python/pyside6-browser/"><![CDATA[<p class="chat--user">

PySide6 기반으로 가장 간단한 기능만 있는 가벼운 웹 브라우저를 만들고 싶어. 주요 기능은 앞/뒤 이동, 탭 관리, 주소창, 새 탭으로 열기(Ctrl 클릭 시), 탭 간 이동 단축키 등등 기초적인 기능만 있으면 돼.

</p>

<p>좋아! PySide6(Qt WebEngine)로 “가장 기본 기능만” 갖춘 가벼운 탭형 웹 브라우저 예제를 한 파일로 깔끔하게 준비했어.<br />
아래 스크립트 하나로 다음이 동작해:</p>

<ul>
  <li>
    <p>뒤로/앞으로, 새로고침/정지, 홈, 주소창</p>
  </li>
  <li>
    <p>탭 열기/닫기/이동(드래그 가능)</p>
  </li>
  <li>
    <p><strong>Ctrl+클릭 시 링크를 새 탭으로 열기</strong></p>
  </li>
  <li>
    <p>단축키:</p>

    <ul>
      <li>
        <p>새 탭 <code class="language-plaintext highlighter-rouge">Ctrl+T</code>, 탭 닫기 <code class="language-plaintext highlighter-rouge">Ctrl+W</code></p>
      </li>
      <li>
        <p>탭 순환 <code class="language-plaintext highlighter-rouge">Ctrl+Tab</code> / <code class="language-plaintext highlighter-rouge">Ctrl+Shift+Tab</code></p>
      </li>
      <li>
        <p>탭 번호로 이동 <code class="language-plaintext highlighter-rouge">Ctrl+1..8</code>, 마지막 탭 <code class="language-plaintext highlighter-rouge">Ctrl+9</code></p>
      </li>
      <li>
        <p>주소창 포커스 <code class="language-plaintext highlighter-rouge">Ctrl+L</code></p>
      </li>
      <li>
        <p>뒤로/앞으로 <code class="language-plaintext highlighter-rouge">Alt+←/→</code></p>
      </li>
      <li>
        <p>새로고침 <code class="language-plaintext highlighter-rouge">Ctrl+R</code> 또는 <code class="language-plaintext highlighter-rouge">F5</code></p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h1 id="설치">설치</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>PySide6
</code></pre></div></div>

<blockquote>
  <p>참고: PySide6에는 Qt WebEngine이 포함되어 있어요(일부 리눅스에선 <code class="language-plaintext highlighter-rouge">qtwebengine</code> 관련 시스템 패키지가 필요할 수 있음).</p>
</blockquote>

<hr />

<h1 id="실행">실행</h1>

<p>아래 코드를 <code class="language-plaintext highlighter-rouge">mini_browser.py</code>로 저장 후:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python mini_browser.py
</code></pre></div></div>

<hr />

<h1 id="코드-단일-파일">코드 (단일 파일)</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
# mini_browser.py
</span><span class="kn">from</span> <span class="n">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">re</span>
<span class="kn">from</span> <span class="n">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>

<span class="kn">from</span> <span class="n">PySide6.QtCore</span> <span class="kn">import</span> <span class="n">QUrl</span><span class="p">,</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">Slot</span>
<span class="kn">from</span> <span class="n">PySide6.QtGui</span> <span class="kn">import</span> <span class="n">QAction</span><span class="p">,</span> <span class="n">QKeySequence</span><span class="p">,</span> <span class="n">QIcon</span><span class="p">,</span> <span class="n">QCloseEvent</span><span class="p">,</span> <span class="n">QGuiApplication</span>
<span class="kn">from</span> <span class="n">PySide6.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">QApplication</span><span class="p">,</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QToolBar</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span>
    <span class="n">QTabWidget</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QStyle</span><span class="p">,</span> <span class="n">QShortcut</span><span class="p">,</span> <span class="n">QMessageBox</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="n">PySide6.QtWebEngineWidgets</span> <span class="kn">import</span> <span class="n">QWebEngineView</span><span class="p">,</span> <span class="n">QWebEnginePage</span>

<span class="n">DEFAULT_HOME</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://duckduckgo.com/</span><span class="sh">"</span>
<span class="n">DEFAULT_SEARCH</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://duckduckgo.com/?q=</span><span class="sh">"</span>

<span class="k">def</span> <span class="nf">is_probably_url</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">re</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">^[a-zA-Z]+://</span><span class="sh">"</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="c1"># domain-like without scheme (no spaces, has a dot)
</span>    <span class="nf">return </span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="sh">"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">t</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="sh">"</span><span class="s">.</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">t</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">BrowserPage</span><span class="p">(</span><span class="n">QWebEnginePage</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">링크 Ctrl+클릭을 가로채 새 탭으로 열기 위해 페이지를 살짝 커스터마이즈.</span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">on_open_new_tab</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_on_open_new_tab</span> <span class="o">=</span> <span class="n">on_open_new_tab</span>

    <span class="k">def</span> <span class="nf">acceptNavigationRequest</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="n">QUrl</span><span class="p">,</span> <span class="n">nav_type</span><span class="p">:</span> <span class="n">QWebEnginePage</span><span class="p">.</span><span class="n">NavigationType</span><span class="p">,</span> <span class="n">isMainFrame</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nav_type</span> <span class="o">==</span> <span class="n">QWebEnginePage</span><span class="p">.</span><span class="n">NavigationTypeLinkClicked</span><span class="p">:</span>
            <span class="n">mods</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">.</span><span class="nf">keyboardModifiers</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">mods</span> <span class="o">&amp;</span> <span class="n">Qt</span><span class="p">.</span><span class="n">ControlModifier</span><span class="p">:</span>
                <span class="c1"># Ctrl+클릭: 새 탭으로 열고 현재 탭은 그대로 유지
</span>                <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_on_open_new_tab</span><span class="p">:</span>
                    <span class="n">self</span><span class="p">.</span><span class="nf">_on_open_new_tab</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">switch_to</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>  <span class="c1"># 현재 뷰에선 네비게이션 취소
</span>        <span class="k">return</span> <span class="nf">super</span><span class="p">().</span><span class="nf">acceptNavigationRequest</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">nav_type</span><span class="p">,</span> <span class="n">isMainFrame</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">BrowserView</span><span class="p">(</span><span class="n">QWebEngineView</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">target=_blank 또는 window.open()을 탭으로 열도록 createWindow 오버라이드.</span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">main_window</span><span class="p">:</span> <span class="sh">"</span><span class="s">MainWindow</span><span class="sh">"</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="n">main_window</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_mw</span> <span class="o">=</span> <span class="n">main_window</span>

    <span class="k">def</span> <span class="nf">createWindow</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">_type</span><span class="p">):</span>
        <span class="c1"># 새 탭을 만들고 그 탭의 QWebEngineView를 반환
</span>        <span class="n">view</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_mw</span><span class="p">.</span><span class="nf">_create_tab_view</span><span class="p">(</span><span class="n">switch_to</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">view</span>

<span class="k">class</span> <span class="nc">BrowserTab</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">탭 하나 = QWebEngineView 하나(툴바는 메인 윈도우 공용).</span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">main_window</span><span class="p">:</span> <span class="sh">"</span><span class="s">MainWindow</span><span class="sh">"</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="n">main_window</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="o">=</span> <span class="nc">BrowserView</span><span class="p">(</span><span class="n">main_window</span><span class="p">)</span>
        <span class="c1"># 커스텀 페이지 부착 (Ctrl+클릭 새 탭용)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="nf">setPage</span><span class="p">(</span><span class="nc">BrowserPage</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">,</span> <span class="n">on_open_new_tab</span><span class="o">=</span><span class="n">main_window</span><span class="p">.</span><span class="n">open_in_new_tab</span><span class="p">))</span>

        <span class="n">lay</span> <span class="o">=</span> <span class="nc">QVBoxLayout</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="n">lay</span><span class="p">.</span><span class="nf">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">lay</span><span class="p">.</span><span class="nf">addWidget</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MainWindow</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">setWindowTitle</span><span class="p">(</span><span class="sh">"</span><span class="s">Mini Browser (PySide6)</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">resize</span><span class="p">(</span><span class="mi">1100</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span>

        <span class="c1"># 탭 위젯
</span>        <span class="n">self</span><span class="p">.</span><span class="n">tabs</span> <span class="o">=</span> <span class="nc">QTabWidget</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">setTabsClosable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">setMovable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="n">currentChanged</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_on_current_tab_changed</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="n">tabCloseRequested</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_close_tab_by_index</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">setCentralWidget</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">)</span>

        <span class="c1"># 툴바 + 주소창
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">_build_toolbar</span><span class="p">()</span>

        <span class="c1"># 단축키
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">_setup_shortcuts</span><span class="p">()</span>

        <span class="c1"># 시작 탭
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">new_tab</span><span class="p">(</span><span class="nc">QUrl</span><span class="p">(</span><span class="n">DEFAULT_HOME</span><span class="p">),</span> <span class="n">switch_to</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c1"># ---------- UI 구성 ----------
</span>
    <span class="k">def</span> <span class="nf">_build_toolbar</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">tb</span> <span class="o">=</span> <span class="nc">QToolBar</span><span class="p">(</span><span class="sh">"</span><span class="s">Navigation</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
        <span class="n">tb</span><span class="p">.</span><span class="nf">setMovable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">addToolBar</span><span class="p">(</span><span class="n">tb</span><span class="p">)</span>

        <span class="n">style</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">style</span><span class="p">()</span>

        <span class="n">self</span><span class="p">.</span><span class="n">act_back</span> <span class="o">=</span> <span class="nc">QAction</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="nf">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="p">.</span><span class="n">SP_ArrowBack</span><span class="p">),</span> <span class="sh">"</span><span class="s">뒤로</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">act_back</span><span class="p">.</span><span class="n">triggered</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_current_view</span><span class="p">().</span><span class="nf">back</span><span class="p">())</span>
        <span class="n">self</span><span class="p">.</span><span class="n">act_forward</span> <span class="o">=</span> <span class="nc">QAction</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="nf">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="p">.</span><span class="n">SP_ArrowForward</span><span class="p">),</span> <span class="sh">"</span><span class="s">앞으로</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">act_forward</span><span class="p">.</span><span class="n">triggered</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_current_view</span><span class="p">().</span><span class="nf">forward</span><span class="p">())</span>
        <span class="n">self</span><span class="p">.</span><span class="n">act_reload</span> <span class="o">=</span> <span class="nc">QAction</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="nf">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="p">.</span><span class="n">SP_BrowserReload</span><span class="p">),</span> <span class="sh">"</span><span class="s">새로고침</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">act_reload</span><span class="p">.</span><span class="n">triggered</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_current_view</span><span class="p">().</span><span class="nf">reload</span><span class="p">())</span>
        <span class="n">self</span><span class="p">.</span><span class="n">act_stop</span> <span class="o">=</span> <span class="nc">QAction</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="nf">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="p">.</span><span class="n">SP_BrowserStop</span><span class="p">),</span> <span class="sh">"</span><span class="s">정지</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">act_stop</span><span class="p">.</span><span class="n">triggered</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_current_view</span><span class="p">().</span><span class="nf">stop</span><span class="p">())</span>
        <span class="n">self</span><span class="p">.</span><span class="n">act_home</span> <span class="o">=</span> <span class="nc">QAction</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="nf">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="p">.</span><span class="n">SP_DirHomeIcon</span><span class="p">),</span> <span class="sh">"</span><span class="s">홈</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">act_home</span><span class="p">.</span><span class="n">triggered</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">navigate_to</span><span class="p">(</span><span class="nc">QUrl</span><span class="p">(</span><span class="n">DEFAULT_HOME</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">act_back</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">act_forward</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">act_reload</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">act_stop</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">act_home</span><span class="p">):</span>
            <span class="n">tb</span><span class="p">.</span><span class="nf">addAction</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="n">self</span><span class="p">.</span><span class="n">urlbar</span> <span class="o">=</span> <span class="nc">QLineEdit</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">urlbar</span><span class="p">.</span><span class="nf">setPlaceholderText</span><span class="p">(</span><span class="sh">"</span><span class="s">주소 또는 검색어 입력…</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">urlbar</span><span class="p">.</span><span class="n">returnPressed</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_on_return_pressed</span><span class="p">)</span>
        <span class="n">tb</span><span class="p">.</span><span class="nf">addWidget</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">urlbar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_shortcuts</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="c1"># 주소창 포커스
</span>        <span class="nc">QShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="sh">"</span><span class="s">Ctrl+L</span><span class="sh">"</span><span class="p">),</span> <span class="n">self</span><span class="p">,</span> <span class="n">activated</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">urlbar</span><span class="p">.</span><span class="nf">setFocus</span><span class="p">(),</span> <span class="n">self</span><span class="p">.</span><span class="n">urlbar</span><span class="p">.</span><span class="nf">selectAll</span><span class="p">()))</span>
        <span class="c1"># 새 탭 / 닫기
</span>        <span class="nc">QShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="sh">"</span><span class="s">Ctrl+T</span><span class="sh">"</span><span class="p">),</span> <span class="n">self</span><span class="p">,</span> <span class="n">activated</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">new_tab</span><span class="p">())</span>
        <span class="nc">QShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="sh">"</span><span class="s">Ctrl+W</span><span class="sh">"</span><span class="p">),</span> <span class="n">self</span><span class="p">,</span> <span class="n">activated</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_close_tab_by_index</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">currentIndex</span><span class="p">()))</span>
        <span class="c1"># 탭 순환
</span>        <span class="nc">QShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="sh">"</span><span class="s">Ctrl+Tab</span><span class="sh">"</span><span class="p">),</span> <span class="n">self</span><span class="p">,</span> <span class="n">activated</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_next_tab</span><span class="p">)</span>
        <span class="nc">QShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="sh">"</span><span class="s">Ctrl+Shift+Tab</span><span class="sh">"</span><span class="p">),</span> <span class="n">self</span><span class="p">,</span> <span class="n">activated</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_prev_tab</span><span class="p">)</span>
        <span class="c1"># 뒤/앞
</span>        <span class="nc">QShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="sh">"</span><span class="s">Alt+Left</span><span class="sh">"</span><span class="p">),</span> <span class="n">self</span><span class="p">,</span> <span class="n">activated</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_current_view</span><span class="p">().</span><span class="nf">back</span><span class="p">())</span>
        <span class="nc">QShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="sh">"</span><span class="s">Alt+Right</span><span class="sh">"</span><span class="p">),</span> <span class="n">self</span><span class="p">,</span> <span class="n">activated</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_current_view</span><span class="p">().</span><span class="nf">forward</span><span class="p">())</span>
        <span class="c1"># 새로고침
</span>        <span class="nc">QShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="sh">"</span><span class="s">Ctrl+R</span><span class="sh">"</span><span class="p">),</span> <span class="n">self</span><span class="p">,</span> <span class="n">activated</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_current_view</span><span class="p">().</span><span class="nf">reload</span><span class="p">())</span>
        <span class="nc">QShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="sh">"</span><span class="s">F5</span><span class="sh">"</span><span class="p">),</span> <span class="n">self</span><span class="p">,</span> <span class="n">activated</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_current_view</span><span class="p">().</span><span class="nf">reload</span><span class="p">())</span>
        <span class="c1"># 번호로 탭 전환
</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Ctrl+</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                <span class="nc">QShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">self</span><span class="p">,</span> <span class="n">activated</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">setCurrentIndex</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nc">QShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">self</span><span class="p">,</span> <span class="n">activated</span><span class="o">=</span><span class="k">lambda</span> <span class="n">idx</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_goto_tab</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>

    <span class="c1"># ---------- 탭 관리 ----------
</span>
    <span class="k">def</span> <span class="nf">_create_tab_view</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">switch_to</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QWebEngineView</span><span class="p">:</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="nc">BrowserTab</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">addTab</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="sh">"</span><span class="s">New Tab</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">switch_to</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="n">view</span> <span class="o">=</span> <span class="n">tab</span><span class="p">.</span><span class="n">view</span>
        <span class="c1"># 시그널 연결: 타이틀/URL 변경 시 탭 제목/주소창 갱신
</span>        <span class="n">view</span><span class="p">.</span><span class="n">titleChanged</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">title</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">view</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_update_tab_title</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">title</span><span class="p">))</span>
        <span class="n">view</span><span class="p">.</span><span class="n">urlChanged</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">url</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">view</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_maybe_update_urlbar</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
        <span class="c1"># 초기 네비게이션 버튼 상태 갱신
</span>        <span class="n">view</span><span class="p">.</span><span class="n">loadFinished</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_ok</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">view</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_update_nav_buttons</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="n">view</span><span class="p">.</span><span class="nf">history</span><span class="p">().</span><span class="n">changed</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="o">=</span><span class="n">view</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_update_nav_buttons</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">view</span>

    <span class="k">def</span> <span class="nf">new_tab</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="n">QUrl</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">switch_to</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_create_tab_view</span><span class="p">(</span><span class="n">switch_to</span><span class="o">=</span><span class="n">switch_to</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="nc">QUrl</span><span class="p">(</span><span class="n">DEFAULT_HOME</span><span class="p">)</span>
        <span class="n">view</span><span class="p">.</span><span class="nf">setUrl</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_close_tab_by_index</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># 마지막 탭을 닫으려 하면 새 빈 탭을 열어 일관성 유지
</span>            <span class="n">self</span><span class="p">.</span><span class="nf">new_tab</span><span class="p">(</span><span class="nc">QUrl</span><span class="p">(</span><span class="n">DEFAULT_HOME</span><span class="p">),</span> <span class="n">switch_to</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">removeTab</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">removeTab</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_current_tab_changed</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_current_view</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_maybe_update_urlbar</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="nf">url</span><span class="p">())</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_update_nav_buttons</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_tab_title</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">QWebEngineView</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># 해당 view가 포함된 탭의 제목을 갱신
</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">count</span><span class="p">()):</span>
            <span class="n">tab</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">BrowserTab</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tab</span><span class="p">.</span><span class="n">view</span> <span class="ow">is</span> <span class="n">view</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">setTabText</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">title</span> <span class="k">if</span> <span class="n">title</span> <span class="k">else</span> <span class="sh">"</span><span class="s">New Tab</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">setTabToolTip</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
                <span class="k">break</span>

    <span class="k">def</span> <span class="nf">_maybe_update_urlbar</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">QWebEngineView</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="n">QUrl</span><span class="p">):</span>
        <span class="c1"># 현재 탭일 때만 주소창 동기화
</span>        <span class="n">current</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">currentWidget</span><span class="p">()</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">BrowserTab</span><span class="p">)</span> <span class="ow">and</span> <span class="n">current</span><span class="p">.</span><span class="n">view</span> <span class="ow">is</span> <span class="n">view</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">urlbar</span><span class="p">.</span><span class="nf">blockSignals</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">urlbar</span><span class="p">.</span><span class="nf">setText</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span>
            <span class="n">self</span><span class="p">.</span><span class="n">urlbar</span><span class="p">.</span><span class="nf">blockSignals</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_update_nav_buttons</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_nav_buttons</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">QWebEngineView</span><span class="p">):</span>
        <span class="n">hist</span> <span class="o">=</span> <span class="n">view</span><span class="p">.</span><span class="nf">history</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">act_back</span><span class="p">.</span><span class="nf">setEnabled</span><span class="p">(</span><span class="n">hist</span><span class="p">.</span><span class="nf">canGoBack</span><span class="p">())</span>
        <span class="n">self</span><span class="p">.</span><span class="n">act_forward</span><span class="p">.</span><span class="nf">setEnabled</span><span class="p">(</span><span class="n">hist</span><span class="p">.</span><span class="nf">canGoForward</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_current_view</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QWebEngineView</span><span class="p">:</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">currentWidget</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tab</span><span class="p">.</span><span class="n">view</span> <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">BrowserTab</span><span class="p">)</span> <span class="k">else</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_next_tab</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">setCurrentIndex</span><span class="p">((</span><span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">currentIndex</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">count</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_prev_tab</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">setCurrentIndex</span><span class="p">((</span><span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">currentIndex</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">count</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_goto_tab</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">count</span><span class="p">():</span>
            <span class="n">self</span><span class="p">.</span><span class="n">tabs</span><span class="p">.</span><span class="nf">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

    <span class="c1"># ---------- 내비게이션 ----------
</span>
    <span class="k">def</span> <span class="nf">_on_return_pressed</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">urlbar</span><span class="p">.</span><span class="nf">text</span><span class="p">().</span><span class="nf">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nf">is_probably_url</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="n">qurl</span> <span class="o">=</span> <span class="n">QUrl</span><span class="p">.</span><span class="nf">fromUserInput</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qurl</span> <span class="o">=</span> <span class="nc">QUrl</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">DEFAULT_SEARCH</span><span class="si">}{</span><span class="nf">quote</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">navigate_to</span><span class="p">(</span><span class="n">qurl</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">navigate_to</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="n">QUrl</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_current_view</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="n">v</span><span class="p">.</span><span class="nf">setUrl</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="c1"># Ctrl+클릭 새 탭용 콜백
</span>    <span class="k">def</span> <span class="nf">open_in_new_tab</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="n">QUrl</span><span class="p">,</span> <span class="n">switch_to</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">new_tab</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">switch_to</span><span class="o">=</span><span class="n">switch_to</span><span class="p">)</span>

    <span class="c1"># 창 닫힘 확인(선택 사항)
</span>    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="n">QCloseEvent</span><span class="p">):</span>
        <span class="n">e</span><span class="p">.</span><span class="nf">accept</span><span class="p">()</span>  <span class="c1"># 필요 시 확인 대화상자 추가 가능
</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="nc">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="c1"># 하이 DPI 환경에서 폰트/스케일 자동 조정
</span>    <span class="n">QGuiApplication</span><span class="p">.</span><span class="nf">setHighDpiScaleFactorRoundingPolicy</span><span class="p">(</span>
        <span class="n">Qt</span><span class="p">.</span><span class="n">HighDpiScaleFactorRoundingPolicy</span><span class="p">.</span><span class="n">PassThrough</span>
    <span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="nc">MainWindow</span><span class="p">()</span>
    <span class="n">w</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="nf">exec</span><span class="p">())</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h1 id="작동-원리-짧고-단계적으로">작동 원리 (짧고 단계적으로)</h1>

<ol>
  <li>
    <p><strong>QMainWindow + QTabWidget</strong><br />
중앙에 <code class="language-plaintext highlighter-rouge">QTabWidget</code>을 두고 각 탭은 <code class="language-plaintext highlighter-rouge">BrowserTab</code>(= <code class="language-plaintext highlighter-rouge">QWebEngineView</code>) 하나로 구성.</p>
  </li>
  <li>
    <p><strong>툴바/주소창</strong><br />
뒤·앞·새로고침·정지·홈 액션과 <code class="language-plaintext highlighter-rouge">QLineEdit</code>(주소창)을 하나의 툴바에 배치.<br />
주소창 Enter → URL 판별(스킴/도메인) → 아니면 검색어로 DuckDuckGo 검색.</p>
  </li>
  <li>
    <p><strong>탭 생성/제거/이동</strong><br />
<code class="language-plaintext highlighter-rouge">new_tab()</code>이 새 탭을 만들고 URL을 로드. 탭은 닫기 버튼으로 제거, 드래그로 순서 변경.</p>
  </li>
  <li>
    <p><strong>target=_blank &amp; Ctrl+클릭</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">BrowserView.createWindow()</code>를 오버라이드해서 <code class="language-plaintext highlighter-rouge">target="_blank"</code>/<code class="language-plaintext highlighter-rouge">window.open()</code>은 항상 <strong>새 탭</strong> 으로.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">BrowserPage.acceptNavigationRequest()</code>에서 <strong>링크 클릭 시</strong> <code class="language-plaintext highlighter-rouge">QApplication.keyboardModifiers()</code>로 <code class="language-plaintext highlighter-rouge">Ctrl</code> 감지 → <strong>새 탭으로 열기</strong> 후 기존 탭 네비게이션은 취소.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>주소/제목 동기화</strong><br />
<code class="language-plaintext highlighter-rouge">urlChanged</code>/<code class="language-plaintext highlighter-rouge">titleChanged</code> 시그널을 탭과 주소창에 반영. 현재 탭 변경 시에도 동기화.</p>
  </li>
  <li>
    <p><strong>단축키</strong><br />
표준 브라우저처럼 <code class="language-plaintext highlighter-rouge">Ctrl+T/W/L</code>, <code class="language-plaintext highlighter-rouge">Ctrl+Tab/Shift+Tab</code>, <code class="language-plaintext highlighter-rouge">Ctrl+1..9</code>, <code class="language-plaintext highlighter-rouge">Alt+←/→</code>, <code class="language-plaintext highlighter-rouge">Ctrl+R</code>/<code class="language-plaintext highlighter-rouge">F5</code>를 연결.</p>
  </li>
</ol>

<hr />

<p>원하는 최소 기능만 담았고, 파일 하나로 바로 돌릴 수 있게 했어.<br />
추가로 원하면 다음도 금방 붙일 수 있어:</p>

<ul>
  <li>
    <p>다운로드 매니저/저장 위치 지정</p>
  </li>
  <li>
    <p>간단한 히스토리/즐겨찾기 저장</p>
  </li>
  <li>
    <p>프라이빗 모드(임시 프로필)</p>
  </li>
  <li>
    <p>다크 모드/아이콘 교체</p>
  </li>
</ul>

<p>필요한 추가 기능 있으면 바로 얹어서 만들어 줄게!</p>]]></content><author><name>hvppyarchive</name></author><category term="python" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">LangChain LangGraph 설치</title><link href="https://hvppyarchive.github.io/linux/redhat-langgraph-installation/" rel="alternate" type="text/html" title="LangChain LangGraph 설치" /><published>2025-09-03T12:34:30+09:00</published><updated>2025-09-03T12:34:30+09:00</updated><id>https://hvppyarchive.github.io/linux/redhat-langgraph-installation</id><content type="html" xml:base="https://hvppyarchive.github.io/linux/redhat-langgraph-installation/"><![CDATA[<p class="chat--user">

langchain &amp; langgraph(+langgraph studio) 설치하는 방법 알려줘. 환경 OS: redhat 8.x 특이 사항: - sudo 권한 없음 - offline 환경 (windows나 docker에서 파일 받아 전송은 가능) - 단, pip와 npm은 방화벽을 뚫어놔서 가능함

</p>

<p>좋아요. 아래는 <strong>RHEL 8.x + sudo 없음 + (대부분) 오프라인</strong> 전제에서 <strong>LangChain / LangGraph / LangGraph Studio</strong> 를 설치·구동하는 방법을 <strong>한 번에 끝내는</strong> 단계별 가이드입니다.<br />
(<em>pip/npm 트래픽은 허용된다고 하셨으니 그 경로를 기본으로, 완전 오프라인 대비책도 함께 적어둘게요.</em>)</p>

<hr />

<h1 id="0-사전-점검-필수">0) 사전 점검 (필수)</h1>

<ol>
  <li><strong>Python 버전</strong></li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-V</span>
</code></pre></div></div>

<ul>
  <li>LangChain / LangGraph 모두 <strong>Python ≥ 3.9</strong> 필요(권장 3.11+). <a href="https://pypi.org/project/langchain/?utm_source=chatgpt.com">PyPI+1</a></li>
</ul>

<ol>
  <li><strong>Node/npm (선택)</strong><br />
Studio 웹 UI 연결만 쓰면 꼭 필요하진 않지만, JS SDK나 UI 로컬 빌드가 필요할 땐 <strong>Node 18/20+</strong> 권장.</li>
</ol>

<hr />

<h1 id="1-가상환경-만들기-sudo-불필요">1) 가상환경 만들기 (sudo 불필요)</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 원하는 경로에 가상환경 생성</span>
python3 <span class="nt">-m</span> venv ~/venvs/langgraph
<span class="nb">source</span> ~/venvs/langgraph/bin/activate

<span class="c"># pip 최신화</span>
python <span class="nt">-m</span> pip <span class="nb">install</span> <span class="nt">--upgrade</span> pip
</code></pre></div></div>

<blockquote>
  <p>참고: 사용자 홈에 설치/실행하는 표준 방법입니다(시스템 PATH 오염 피함). 사용자 설치 경로 안내는 공식 문서에 요약되어 있어요. <a href="https://packaging.python.org/tutorials/installing-packages/?utm_source=chatgpt.com">packaging.python.org</a></p>
</blockquote>

<hr />

<h1 id="2-langchain--langgraph-설치">2) LangChain &amp; LangGraph 설치</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 필수</span>
pip <span class="nb">install</span> <span class="nt">-U</span> langchain langgraph

<span class="c"># (옵션) 프로바이더 패키지 예시 - OpenAI 사용 시</span>
pip <span class="nb">install</span> <span class="nt">-U</span> langchain-openai
</code></pre></div></div>

<ul>
  <li>
    <p>LangChain의 Python 지원 버전: <strong>&gt; =3.9,&lt;4.0</strong>. <a href="https://pypi.org/project/langchain/?utm_source=chatgpt.com">PyPI</a></p>
  </li>
  <li>
    <p>LangGraph의 Python 지원 버전: <strong>&gt; =3.9</strong>. <a href="https://pypi.org/project/langgraph/?utm_source=chatgpt.com">PyPI</a></p>
  </li>
  <li>
    <p>OpenAI 연동 패키지(<code class="language-plaintext highlighter-rouge">langchain-openai</code>)는 별도이며 Python ≥3.9. <a href="https://pypi.org/project/langchain-openai/?utm_source=chatgpt.com">PyPI</a></p>
  </li>
</ul>

<hr />

<h1 id="3-langgraph-cli--로컬-서버-dockersudo-없이-dev-모드">3) LangGraph CLI + 로컬 서버 (Docker·sudo 없이 “dev 모드”)</h1>

<p><strong>Studio를 쓰려면 서버가 있어야 합니다.</strong> <code class="language-plaintext highlighter-rouge">langgraph-cli</code>의 <strong>dev 모드</strong> 는 Docker 없이 로컬에서 바로 띄울 수 있어요(개발용). <a href="https://docs.langchain.com/langgraph-platform/cli">docs.langchain.com</a></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># dev 모드에 필요한 extra 포함 설치</span>
pip <span class="nb">install</span> <span class="nt">-U</span> <span class="s2">"langgraph-cli[inmem]"</span>

<span class="c"># 새 앱 템플릿으로 프로젝트 생성 (파이썬 버전 3.11+ 권장)</span>
langgraph new myapp <span class="nt">--template</span> new-langgraph-project-python
<span class="nb">cd </span>myapp

<span class="c"># 템플릿이 만든 요구사항 설치(있다면)</span>
pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt

<span class="c"># 로컬 API 서버 구동 (기본: 127.0.0.1:2024)</span>
langgraph dev
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">langgraph dev</code> 는 <strong>Docker 불필요</strong> , 개발/테스트 용 경량 서버이며 <strong>Python ≥ 3.11</strong> 에서 지원됩니다. 기본 포트 <strong>2024</strong>. <a href="https://docs.langchain.com/langgraph-platform/cli">docs.langchain.com</a></li>
</ul>

<hr />

<h1 id="4-langgraph-studio-연결">4) LangGraph <strong>Studio</strong> 연결</h1>

<p>Studio는 “LangGraph Server”에 붙는 웹 UI입니다. 로컬에서 <code class="language-plaintext highlighter-rouge">langgraph dev</code>를 띄우면, 브라우저에서 <strong>아래 URL</strong> 로 접속해 Studio를 바로 사용할 수 있어요:</p>
<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">https:</span><span class="sr">//smi</span><span class="nv">th</span><span class="o">.</span><span class="nv">langchain</span><span class="o">.</span><span class="nv">com</span><span class="sr">/studio/</span><span class="p">?</span><span class="nv">baseUrl</span><span class="o">=</span><span class="nv">http:</span><span class="sr">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">2024</span>
</code></pre></div></div>

<ul>
  <li>
    <p>다른 호스트/포트를 썼다면 <code class="language-plaintext highlighter-rouge">baseUrl</code>만 바꿔주세요. <a href="https://docs.langchain.com/langgraph-platform/quick-start-studio?utm_source=chatgpt.com">docs.langchain.com</a><a href="https://langchain-ai.github.io/langgraph/tutorials/langgraph-platform/local-server/?utm_source=chatgpt.com">langchain-ai.github.io</a></p>
  </li>
  <li>
    <p><strong>개발 환경이 오프라인</strong> 이라 위 도메인 접근이 막혀 있으면 아래 대안을 참고하세요.</p>
  </li>
</ul>

<hr />

<h1 id="5-오프라인폐쇄망-대안-studio-접근-대안">5) (오프라인/폐쇄망 대안) Studio 접근 대안</h1>

<p>A) <strong>데스크톱 앱(구 버전, 현재는 deprecated)</strong></p>

<ul>
  <li>예전 “LangGraph Studio Desktop”은 더 이상 주요 경로가 아니고 저장소가 <strong>아카이브</strong> 상태입니다. 대신 CLI(+Web Studio) 사용을 권장합니다. 그래도 필요하면 GitHub 릴리스에서 바이너리 받아서 옮겨 실행할 수 있습니다(지원 중단 공지 포함). <a href="https://github.com/langchain-ai/langgraph-studio">GitHub+1</a></li>
</ul>

<p>B) <strong>로컬/사설 UI 구성 (JS)</strong></p>

<ul>
  <li>
    <p>JS SDK로 간단한 <strong>Agent Chat UI</strong> 를 직접 띄우는 선택지도 있습니다. (LangGraph API 서버에 붙는 채팅 UI를 로컬로 개발/실행) <a href="https://docs.langchain.com/oss/javascript/langgraph/ui?utm_source=chatgpt.com">docs.langchain.com</a></p>
  </li>
  <li>
    <p>JS 설치 예시:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 새 디렉토리에서</span>
npm init <span class="nt">-y</span>
npm <span class="nb">install</span> @langchain/langgraph @langchain/core
</code></pre></div>    </div>
  </li>
</ul>

<p>(LangGraph JS 패키지 최신 설치법 · 버전 참고) <a href="https://docs.langchain.com/oss/javascript/langgraph/installation?utm_source=chatgpt.com">docs.langchain.com</a><a href="https://www.npmjs.com/package/%40langchain/langgraph?utm_source=chatgpt.com">npm</a></p>

<hr />

<h1 id="6-선택-완전-오프라인-대비--패키지-미리-모아서-옮기기">6) (선택) 완전 오프라인 대비 — 패키지 미리 모아서 옮기기</h1>

<h2 id="6-1-pip-휠-캐시wheelhouse-만들기">6-1) pip 휠 캐시(“wheelhouse”) 만들기</h2>

<p><strong>온라인이 되는 PC/컨테이너</strong> 에서:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-m</span> venv wheelenv <span class="o">&amp;&amp;</span> <span class="nb">source </span>wheelenv/bin/activate
pip <span class="nb">install</span> <span class="nt">--upgrade</span> pip
pip download <span class="nt">-d</span> wheelhouse <span class="se">\</span>
  <span class="s2">"langgraph-cli[inmem]"</span> langgraph langchain langchain-openai
<span class="c"># wheelhouse/ 아래에 모든 의존 휠이 모입니다.</span>
</code></pre></div></div>

<p><strong>RHEL 서버(오프라인)</strong>에서:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> ~/venvs/langgraph/bin/activate
pip <span class="nb">install</span> <span class="nt">--no-index</span> <span class="nt">--find-links</span> /path/to/wheelhouse <span class="se">\</span>
  <span class="s2">"langgraph-cli[inmem]"</span> langgraph langchain langchain-openai
</code></pre></div></div>

<blockquote>
  <p>pip의 사용자/오프라인 설치 동작과 경로 개념은 공식 패키징 가이드에 잘 정리돼 있습니다. <a href="https://packaging.python.org/tutorials/installing-packages/?utm_source=chatgpt.com">packaging.python.org</a></p>
</blockquote>

<h2 id="6-2-npm-패키지-묶기">6-2) npm 패키지 묶기</h2>

<p><strong>온라인 머신</strong> 에서 필요한 패키지 tarball 생성:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>npm_bundles <span class="o">&amp;&amp;</span> <span class="nb">cd </span>npm_bundles
npm pack @langchain/langgraph @langchain/core
<span class="c"># =&gt; .tgz 파일들이 생성됨</span>
</code></pre></div></div>

<p><strong>오프라인 머신</strong> 에서 tarball로 설치:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 프로젝트 디렉토리 내에서</span>
npm <span class="nb">install</span> ./@langchain-langgraph-<span class="k">*</span>.tgz ./@langchain-core-<span class="k">*</span>.tgz
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">npm pack</code>/로컬 tgz 설치는 npm 공식 문서에 있는 표준 흐름입니다. <a href="https://docs.npmjs.com/cli/v7/commands/npm-pack/?utm_source=chatgpt.com">docs.npmjs.com+1</a></li>
</ul>

<hr />

<h1 id="7-자주-막히는-포인트--해결">7) 자주 막히는 포인트 &amp; 해결</h1>

<ul>
  <li>
    <p><strong>Python 버전 부족(≤3.8)</strong></p>

    <ul>
      <li>RHEL 8 기본 Python이 낮을 수 있습니다. 시스템 Python 건드리지 말고, <strong>독립 실행형 Python 배포본</strong>(python-build-standalone)을 받아 홈 디렉터리에 풀어 쓰는 방법이 있습니다(루트 불필요). <a href="https://gregoryszorc.com/docs/python-build-standalone/main/?utm_source=chatgpt.com">gregoryszorc.com</a><a href="https://github.com/astral-sh/python-build-standalone/releases?utm_source=chatgpt.com">GitHub</a></li>
    </ul>
  </li>
  <li>
    <p><strong>Docker 필요 여부</strong></p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">langgraph up</code> 등 플랫폼 전용 명령은 Docker가 필요하지만, <strong>개발용<code class="language-plaintext highlighter-rouge">langgraph dev</code>는 Docker 없이 동작</strong>합니다(위 3번 단계). <a href="https://docs.langchain.com/langgraph-platform/cli">docs.langchain.com</a></li>
    </ul>
  </li>
  <li>
    <p><strong>Studio 접근 차단</strong></p>

    <ul>
      <li>사내 방화벽이 <code class="language-plaintext highlighter-rouge">smith.langchain.com</code>을 막으면 A/B 대안을 사용하세요(5번). Studio 웹은 LangGraph Server에 <strong>프런트</strong> 로 붙는 형태입니다. <a href="https://docs.langchain.com/langgraph-platform/langgraph-studio?utm_source=chatgpt.com">docs.langchain.com</a></li>
    </ul>
  </li>
  <li>
    <p><strong>기본 포트 충돌</strong></p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">langgraph dev --port 8080</code>처럼 포트를 바꾸면 됩니다(기본 2024). <a href="https://docs.langchain.com/langgraph-platform/cli">docs.langchain.com</a></li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="검증용-설치-후-빠른-점검">(검증용) 설치 후 빠른 점검</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 파이썬 라이브러리 import 확인</span>
python - <span class="o">&lt;&lt;</span><span class="sh">'</span><span class="no">PY</span><span class="sh">'
import langchain, langgraph
print("OK:", langchain.__version__, langgraph.__version__)
</span><span class="no">PY

</span><span class="c"># CLI 확인</span>
langgraph <span class="nt">--help</span>
<span class="c"># 서버 기동</span>
langgraph dev  <span class="c"># =&gt; 127.0.0.1:2024</span>
</code></pre></div></div>

<p>그 다음 브라우저에서<br />
<code class="language-plaintext highlighter-rouge">https://smith.langchain.com/studio/?baseUrl=http://127.0.0.1:2024</code> 접속 → 그래프/스레드/실행 과정을 시각화하며 테스트하세요. <a href="https://langchain-ai.github.io/langgraph/tutorials/langgraph-platform/local-server/?utm_source=chatgpt.com">langchain-ai.github.io</a></p>

<hr />

<p>필요하시면, <strong>완전 오프라인(내부 레지스트리/미러 구축)</strong> 시나리오(예: 사설 PyPI, Verdaccio 등)까지 포함한 배포 체크리스트도 정리해 드릴게요.</p>]]></content><author><name>hvppyarchive</name></author><category term="linux" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">tcsh 메시지 색 지정</title><link href="https://hvppyarchive.github.io/linux/tcsh-term-color/" rel="alternate" type="text/html" title="tcsh 메시지 색 지정" /><published>2025-09-03T12:31:52+09:00</published><updated>2025-09-03T12:31:52+09:00</updated><id>https://hvppyarchive.github.io/linux/tcsh-term-color</id><content type="html" xml:base="https://hvppyarchive.github.io/linux/tcsh-term-color/"><![CDATA[<p class="chat--user">

tcsh에서 메시지 출력할 때 color 지정하는 방법 총 정리해줘.

</p>

<p>좋아요! tcsh에서 “메시지 출력할 때 색을 지정하는” 방법을 가장 안정적이고 휴대성 있게 정리해드릴게요. (터미널이 색을 지원해야 합니다. 보통 <code class="language-plaintext highlighter-rouge">TERM=xterm-256color</code>면 OK)</p>

<h1 id="1-기본-원리-ansi-sgr-코드">1) 기본 원리 (ANSI SGR 코드)</h1>

<ul>
  <li>
    <p>색/스타일은 <strong>ESC[<code class="language-plaintext highlighter-rouge">[</code>] + 코드 + <code class="language-plaintext highlighter-rouge">m</code></strong> 으로 켭니다. 끝나면 <strong><code class="language-plaintext highlighter-rouge">ESC[0m</code></strong> 로 리셋.</p>
  </li>
  <li>
    <p>예: 빨강 글자 → <code class="language-plaintext highlighter-rouge">ESC[31m</code>, 굵게 → <code class="language-plaintext highlighter-rouge">ESC[1m</code>, 밑줄 → <code class="language-plaintext highlighter-rouge">ESC[4m</code></p>
  </li>
  <li>
    <p>여러 개를 동시에: <code class="language-plaintext highlighter-rouge">ESC[1;31m</code> (굵게+빨강)</p>
  </li>
</ul>

<h2 id="자주-쓰는-코드">자주 쓰는 코드</h2>

<table>
  <thead>
    <tr>
      <th>의미</th>
      <th>코드</th>
      <th>의미</th>
      <th>코드</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>리셋</td>
      <td>0</td>
      <td>굵게</td>
      <td>1</td>
    </tr>
    <tr>
      <td>밑줄</td>
      <td>4</td>
      <td>반전</td>
      <td>7</td>
    </tr>
    <tr>
      <td>전경색(기본)</td>
      <td>30~37</td>
      <td>배경색(기본)</td>
      <td>40~47</td>
    </tr>
    <tr>
      <td>전경색(밝게)</td>
      <td>90~97</td>
      <td>배경색(밝게)</td>
      <td>100~107</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>8색 번호: 30/40=검정, 31/41=빨강, 32/42=초록, 33/43=노랑, 34/44=파랑, 35/45=마젠타, 36/46=시안, 37/47=흰색</li>
</ul>

<h1 id="2-tcsh에서-출력하는-실전-방법-3가지">2) tcsh에서 출력하는 “실전” 방법 3가지</h1>

<h2 id="a-printf-사용-가장-권장">A. <code class="language-plaintext highlighter-rouge">printf</code> 사용 (가장 권장)</h2>

<p>tcsh 내장 <code class="language-plaintext highlighter-rouge">echo</code>는 백슬래시 해석이 들쭉날쭉합니다. <strong>외부<code class="language-plaintext highlighter-rouge">printf</code></strong> 가 가장 이식성이 좋아요.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

# 빨강으로 "ERROR" 출력
/bin/printf '\033[31m%s\033[0m\n' "ERROR"

# 굵고 노란 경고
/bin/printf '\033[1;33m%s\033[0m\n' "WARNING: Low disk space"
</code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">\033</code> = ESC</p>
  </li>
  <li>
    <p>가독성을 위해 항상 끝에 <code class="language-plaintext highlighter-rouge">\033[0m</code>(리셋) 붙이세요.</p>
  </li>
</ul>

<h2 id="b-tput-사용-터미널-능력-dbterminfo-기반">B. <code class="language-plaintext highlighter-rouge">tput</code> 사용 (터미널 능력 DB(terminfo) 기반)</h2>

<p>터미널마다 맞는 코드로 변환해 주므로 <strong>휴대성 최고</strong> 입니다.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

# 색/리셋 시퀀스를 변수에 담기 (명령치환은 백틱 `)
set c_red   = "`tput setaf 1`"   # 전경 빨강
set c_green = "`tput setaf 2`"
set c_yel   = "`tput setaf 3`"
set c_reset = "`tput sgr0`"

# 출력 (printf 권장)
printf "%s%s%s\n" "$c_red" "ERROR" "$c_reset"

# echo -n로도 가능
echo -n "$c_yel"; echo "building..."; echo -n "$c_reset"
</code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">setaf N</code> 전경색, <code class="language-plaintext highlighter-rouge">setab N</code> 배경색 (<code class="language-plaintext highlighter-rouge">N=0~7</code>)</p>
  </li>
  <li>
    <p>리셋은 <code class="language-plaintext highlighter-rouge">sgr0</code></p>
  </li>
</ul>

<h2 id="c-binecho--e-권장-x-환경-의존">C. <code class="language-plaintext highlighter-rouge">/bin/echo -e</code> (권장 X, 환경 의존)</h2>

<p>/bin/echo가 <code class="language-plaintext highlighter-rouge">-e</code>를 지원하는 환경에서만 동작합니다. 기대치 못 미칠 수 있음.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

/bin/echo -e "\033[34mblue text\033[0m"
</code></pre></div></div>

<p>가능하면 A 또는 B를 쓰세요.</p>

<h1 id="3-256색--truecolor24비트도-가능">3) 256색 &amp; TrueColor(24비트)도 가능</h1>

<p>터미널이 지원하면 더 풍부한 색을 쓸 수 있어요.</p>

<h2 id="256색">256색</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

# 전경 256색: 38;5;&lt;n&gt;   (n=0~255)
# 배경 256색: 48;5;&lt;n&gt;
/bin/printf '\033[38;5;202m%s\033[0m\n' "Tangerine"
/bin/printf '\033[48;5;24m\033[97m%s\033[0m\n' "White on deep blue bg"
</code></pre></div></div>

<h2 id="truecolor24비트">TrueColor(24비트)</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

# 전경: 38;2;R;G;B   배경: 48;2;R;G;B
/bin/printf '\033[38;2;255;105;180m%s\033[0m\n' "Hot Pink"
/bin/printf '\033[48;2;30;30;30m\033[38;2;200;200;200m%s\033[0m\n' "Grey on dark bg"
</code></pre></div></div>

<h1 id="4-매번-치기-귀찮다면-alias로-컬러-echo-만들기">4) 매번 치기 귀찮다면: alias로 “컬러 echo” 만들기</h1>

<h3 id="고정색-단축키">고정색 단축키</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

# 인자 전체(\!*)를 빨강으로
alias red    '/bin/printf "\033[31m%s\033[0m\n" \!*'
alias green  '/bin/printf "\033[32m%s\033[0m\n" \!*'
alias yellow '/bin/printf "\033[33m%s\033[0m\n" \!*'
alias blue   '/bin/printf "\033[34m%s\033[0m\n" \!*'
alias bold   '/bin/printf "\033[1m%s\033[0m\n" \!*'

# 사용 예
red "ERROR: something went wrong"
bold "=== build start ==="
</code></pre></div></div>

<h3 id="임의-코드--메시지두-인자--범용-함수형">임의 코드 + 메시지(두 인자) → 범용 함수형</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

# 첫 인자: SGR 코드(예: 1;31), 나머지: 메시지
alias cecho  '/bin/printf "\033[%sm%s\033[0m\n" \!:1 \!:2*'

# 사용 예
cecho 1;31 "FATAL"
cecho 4;36 "Underlined Cyan"
</code></pre></div></div>

<h3 id="tput-기반-alias-환경-휴대성-">tput 기반 alias (환경 휴대성 ↑)</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

alias rmsg 'set c="`tput setaf 1`"; set z="`tput sgr0`"; /bin/printf "%s%s%s\n" "$c" \!* "$z"'
rmsg "RED via terminfo"
</code></pre></div></div>

<h1 id="5-스크립트-안에서-쓰기-tcsh-shebang">5) 스크립트 안에서 쓰기 (tcsh shebang)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

#!/bin/tcsh

set RED   = '\033[31m'
set BOLD  = '\033[1m'
set RESET = '\033[0m'

# \033 같은 백슬래시는 printf의 %b로 해석시키거나 리터럴로 써야 합니다.
# 가장 간단: 리터럴 시퀀스를 따옴표에 넣고 printf로 출력.
# (tcsh의 echo는 이스케이프 해석이 들쭉날쭉)
printf "%b%s%b\n" "$BOLD$RED" "Building..." "$RESET"
</code></pre></div></div>

<blockquote>
  <p>참고: 변수에 <code class="language-plaintext highlighter-rouge">\033</code>를 넣었을 때는 <strong>printf의<code class="language-plaintext highlighter-rouge">%b</code></strong> 형식을 쓰면 백슬래시 이스케이프가 해석됩니다. 단순 <code class="language-plaintext highlighter-rouge">echo</code>는 기대대로 동작하지 않을 수 있습니다.</p>
</blockquote>

<h1 id="6-자주-쓰는-레시피-모음">6) 자주 쓰는 레시피 모음</h1>

<ul>
  <li>빨강 에러 한 줄:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh
    
/bin/printf '\033[31mERROR:\033[0m %s\n' "file not found"
</code></pre></div>    </div>
  </li>
  <li>성공(초록) + 굵게:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh
    
/bin/printf '\033[1;32m%s\033[0m\n' "OK"
</code></pre></div>    </div>
  </li>
  <li>상태 표시(노랑) → 작업 → 리셋:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh
    
/bin/printf '\033[33m%s\033[0m\n' "building..."
</code></pre></div>    </div>
  </li>
  <li>256색 팔레트 테스트:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh
    
@ i = 0
while ( $i &lt; 256 )
  /bin/printf '\033[38;5;%dm%3d ' $i $i
  @ i++
  if ( $i % 16 == 0 ) echo ""
end
/bin/printf '\033[0m'
</code></pre></div>    </div>
  </li>
</ul>

<h1 id="7-프롬프트는-별도-규칙참고">7) 프롬프트는 별도 규칙(참고)</h1>

<p>메시지 출력과 달리 <strong>프롬프트</strong>(<code class="language-plaintext highlighter-rouge">set prompt</code>)에 색을 넣을 땐 <strong><code class="language-plaintext highlighter-rouge">%{ … %}</code></strong> 로 <em>넓이 계산 제외</em> 구간을 감싸야 줄바꿈/커서 어긋남이 없습니다.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

# 예) 굵은 파랑 사용자명 + 흰색 디렉터리
set prompt = "%{\033[1;34m%}%n%{\033[0m%}:%{\033[97m%}%~%{\033[0m%}%# "
</code></pre></div></div>

<h1 id="8-팁--함정">8) 팁 &amp; 함정</h1>

<ul>
  <li>
    <p><strong>리셋(<code class="language-plaintext highlighter-rouge">\033[0m</code>)을 꼭 붙이기</strong>: 다음 출력에 색이 번지지 않게.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">/bin/printf</code> 선호</strong>: <code class="language-plaintext highlighter-rouge">echo -e</code>는 환경마다 동작 달라 “총정리” 관점에선 비권장.</p>
  </li>
  <li>
    <p><strong>터미널 지원 여부</strong> : 24비트 혹은 256색은 터미널 옵션(예: iTerm2, Windows Terminal)과 <code class="language-plaintext highlighter-rouge">TERM</code> 설정에 좌우됩니다. 일반적으로 <code class="language-plaintext highlighter-rouge">xterm-256color</code> 권장.</p>
  </li>
  <li>
    <p><strong>스크립트 이식성</strong> : 너무 특정 터미널에 의존하는 색은 제한적으로.</p>
  </li>
</ul>

<p>필요하시면, 원클릭용 <strong>컬러 alias 번들</strong>(.tcshrc에 붙여넣기)도 깔끔하게 만들어 드릴게요.</p>]]></content><author><name>hvppyarchive</name></author><category term="linux" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">작업 폴더 구성 추천</title><link href="https://hvppyarchive.github.io/misc/work-directory-structure/" rel="alternate" type="text/html" title="작업 폴더 구성 추천" /><published>2025-09-01T18:41:28+09:00</published><updated>2025-09-01T18:41:28+09:00</updated><id>https://hvppyarchive.github.io/misc/work-directory-structure</id><content type="html" xml:base="https://hvppyarchive.github.io/misc/work-directory-structure/"><![CDATA[<p class="chat--user">

회사에서 작업 폴더 구성을 도와줘. 뭔가 작업 폴더를 꾸미는 것에 대한 일반적인 추천 같은게 있을까?

</p>

<p>좋아—회사에서 쓸 “작업 폴더”는 한 번 잘 짜두면 팀 생산성이 확 달라져요. 아래처럼 <strong>단계별로</strong> 만들면 실패 확률이 낮습니다.</p>

<h1 id="1-먼저-원칙부터-정하기-짧고-강력한-룰-8가지">1) 먼저 원칙부터 정하기 (짧고 강력한 룰 8가지)</h1>

<ol>
  <li>
    <p><strong>최대 깊이 3단계</strong> : <code class="language-plaintext highlighter-rouge">팀 → 프로젝트 → 작업물</code>까지만. (깊어질수록 찾기·권한 관리가 어려워져요)</p>
  </li>
  <li>
    <p><strong>정렬되는 이름</strong> : 접두 번호(<code class="language-plaintext highlighter-rouge">00,10,20…</code>) + 한글/영문 키워드.</p>
  </li>
  <li>
    <p><strong>날짜 형식 고정</strong> : <code class="language-plaintext highlighter-rouge">YYYY-MM-DD</code> (예: <code class="language-plaintext highlighter-rouge">2025-08-26_회의록.md</code>)</p>
  </li>
  <li>
    <p><strong>버전 규칙</strong> : 최종본 금지. <code class="language-plaintext highlighter-rouge">v001, v002…</code> 또는 <code class="language-plaintext highlighter-rouge">draft/approved</code> 두 트랙.</p>
  </li>
  <li>
    <p><strong>원본 vs 산출물 분리</strong> : <code class="language-plaintext highlighter-rouge">source</code>(편집파일) / <code class="language-plaintext highlighter-rouge">export</code>(배포파일).</p>
  </li>
  <li>
    <p><strong>권한 레벨 분리</strong> : <code class="language-plaintext highlighter-rouge">Shared</code>(공유) / <code class="language-plaintext highlighter-rouge">Restricted</code>(민감·임원용) / <code class="language-plaintext highlighter-rouge">Private</code>(개인).</p>
  </li>
  <li>
    <p><strong>메타정보는 README에</strong> : 폴더마다 <code class="language-plaintext highlighter-rouge">README.md</code>로 목적·담당·태그 기록.</p>
  </li>
  <li>
    <p><strong>아카이브 주기</strong> : 완료 30일 후 <code class="language-plaintext highlighter-rouge">Archive/</code>로 이동, 1년 후 장기보관.</p>
  </li>
</ol>

<h1 id="2-상위-구조-선택-3가지-중-택1-또는-하이브리드">2) 상위 구조 선택 (3가지 중 택1 또는 하이브리드)</h1>

<ul>
  <li>
    <p><strong>프로젝트 중심(권장: 프로젝트형 조직)</strong><br />
<code class="language-plaintext highlighter-rouge">10_Projects/PRJ-코드_이름</code> 아래에 표준 하위 폴더.</p>
  </li>
  <li>
    <p><strong>기능 중심(권장: 기능별 팀조직)</strong><br />
<code class="language-plaintext highlighter-rouge">20_Product, 30_Design, 40_Engineering…</code> 아래에 연간/분기 폴더.</p>
  </li>
  <li>
    <p><strong>개인 작업공간 + 공유 허브(혼합형)</strong><br />
<code class="language-plaintext highlighter-rouge">90_People/홍길동/workspace</code>는 자유롭게, 산출물만 공유 폴더로 승격.</p>
  </li>
</ul>

<h1 id="3-바로-쓰는-표준-템플릿">3) 바로 쓰는 표준 템플릿</h1>

<p>아래 트리는 <strong>대부분 회사에서 바로 적용</strong> 가능한 최소·표준 구성입니다.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/Company
├─ 00_Admin
│  ├─ 01_Policies
│  └─ 02_Templates   ← 문서/슬라이드/회의록 템플릿
├─ 10_Projects
│  └─ PRJ-2025-012_신제품출시
│     ├─ 01_Plan        ← 일정/OKR/예산
│     ├─ 02_Research    ← 리서치, 경쟁/고객 인터뷰
│     ├─ 03_Design
│     │  ├─ source
│     │  └─ export
│     ├─ 04_Build
│     ├─ 05_Test
│     ├─ 06_Release
│     ├─ 80_Meetings    ← 2025-08-26_킥오프_메모.md
│     ├─ 90_Archive
│     └─ README.md
├─ 20_Product
├─ 30_SalesMarketing
├─ 40_Engineering
├─ 50_Data
│  ├─ 01_Raw
│  ├─ 02_Processed
│  └─ 03_Reports
├─ 60_SharedAssets     ← 로고, 폰트, 컬러가이드 등 공용
├─ 70_Restricted       ← 계약서/급여/법무(권한 제한)
├─ 90_People
│  └─ 홍길동
│     ├─ workspace
│     └─ handover      ← 인수인계용
└─ 99_Archive
</code></pre></div></div>

<h1 id="4-파일폴더-네이밍-규칙-복붙해서-팀-규칙으로">4) 파일·폴더 네이밍 규칙 (복붙해서 팀 규칙으로)</h1>

<ul>
  <li>
    <p><strong>폴더</strong> : <code class="language-plaintext highlighter-rouge">10_Projects</code>, <code class="language-plaintext highlighter-rouge">PRJ-2025-012_신제품출시</code></p>
  </li>
  <li>
    <p><strong>문서</strong> : <code class="language-plaintext highlighter-rouge">2025-08-26_프로젝트킥오프_회의록_v001.md</code></p>
  </li>
  <li>
    <p><strong>디자인</strong> :</p>

    <ul>
      <li>
        <p>원본: <code class="language-plaintext highlighter-rouge">홈페이지KV_v003_source.psd</code></p>
      </li>
      <li>
        <p>산출: <code class="language-plaintext highlighter-rouge">홈페이지KV_v003_1080x1080_export.png</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>데이터</strong> : <code class="language-plaintext highlighter-rouge">2025-08-월간DAU_v004_approved.csv</code></p>
  </li>
</ul>

<h1 id="5-폴더별-readme-템플릿-복붙">5) 폴더별 README 템플릿 (복붙)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 폴더 목적
- 신제품 출시 프로젝트 산출물 중앙 저장소

# 담당/권한
- 오너: 홍길동(@id) / 편집 권한: PM팀, 디자인팀 / 열람: 전사

# 구조
- 01_Plan: 일정·OKR·예산
- 02_Research: 고객/경쟁 리서치
- 03_Design: source/export 분리
...

# 공통 규칙
- 파일명: YYYY-MM-DD_제목_v### (source/export 구분)
- 완료 30일 후 90_Archive로 이동
- 의사결정은 /01_Plan/ADR에 기록
</code></pre></div></div>

<h1 id="6-협업운영-습관-실무-팁-8가지">6) 협업·운영 습관 (실무 팁 8가지)</h1>

<ol>
  <li>
    <p><strong>결정 기록(ADR)</strong> : 중요한 결정은 <code class="language-plaintext highlighter-rouge">/01_Plan/ADR/2025-08-26_결정_요약.md</code>.</p>
  </li>
  <li>
    <p><strong>회의록 표준화</strong> : <code class="language-plaintext highlighter-rouge">회의 목적 · 참석자 · 요약 · 액션아이템(담당/기한)</code> 섹션 고정.</p>
  </li>
  <li>
    <p><strong>액션 아이템은 도구로 이관</strong> : 회의록 내 체크리스트는 JIRA/Asana로 바로 링크.</p>
  </li>
  <li>
    <p><strong>링크만 저장</strong> : SaaS 산출물(Google Docs 등)은 링크 파일 <code class="language-plaintext highlighter-rouge">.url</code>로 두되, <strong>최종 PDF</strong> 도 함께 보관.</p>
  </li>
  <li>
    <p><strong>민감정보 분리</strong> : 계약/급여/개인정보는 <code class="language-plaintext highlighter-rouge">70_Restricted</code>로만. 접근 로그 관리.</p>
  </li>
  <li>
    <p><strong>아카이브 의식화</strong> : 매월 말 “폴더 다이어트” 30분—<code class="language-plaintext highlighter-rouge">Archive</code>로 이동 + README 갱신.</p>
  </li>
  <li>
    <p><strong>템플릿 먼저</strong> : 새 프로젝트 시작 시 <code class="language-plaintext highlighter-rouge">02_Templates</code>에서 복제해 시작.</p>
  </li>
  <li>
    <p><strong>검색 친화 태그</strong> : 파일 첫 줄에 <code class="language-plaintext highlighter-rouge">#태그</code>(예: <code class="language-plaintext highlighter-rouge">#런칭 #광고 #DAU</code>)를 넣어 검색 품질↑.</p>
  </li>
</ol>

<h1 id="7-역할별-미세튜닝">7) 역할별 미세튜닝</h1>

<ul>
  <li>
    <p><strong>PM/기획</strong> : <code class="language-plaintext highlighter-rouge">/01_Plan</code>에 <code class="language-plaintext highlighter-rouge">Roadmap.xlsx, KPI_Dashboard.pdf, ADR/</code> 고정 폴더.</p>
  </li>
  <li>
    <p><strong>디자인</strong> : <code class="language-plaintext highlighter-rouge">source/export</code>, <code class="language-plaintext highlighter-rouge">fonts/brand/refs</code> 3분리, 내보내기 규격 프리셋 같이 저장.</p>
  </li>
  <li>
    <p><strong>개발</strong> : 코드 저장소와 산출물 폴더는 링크로 연결(<code class="language-plaintext highlighter-rouge">docs/</code>, <code class="language-plaintext highlighter-rouge">release_notes/</code>). 빌드 산출물은 <code class="language-plaintext highlighter-rouge">06_Release</code>.</p>
  </li>
  <li>
    <p><strong>세일즈/마케팅</strong> : <code class="language-plaintext highlighter-rouge">campaigns/YYYY-QN/캠페인명/</code>로 분기 관리, 모든 크리에이티브는 <code class="language-plaintext highlighter-rouge">export</code>에만 배포.</p>
  </li>
</ul>

<hr />

<p>원하면, <strong>당신 팀의 업종/툴 체인(예: Google Drive/OneDrive, Notion, Jira, Figma)</strong>에 맞춰 위 구조를 1:1로 커스터마이즈해서 드릴게요. “팀 구성/업무 유형/민감자료 범위”만 알려주면 곧바로 맞춤 트리 만들어줄게요.</p>

<p class="chat--user">

나 혼자 쓰는 거긴 해

</p>

<p>좋아, “혼자 쓰는 회사 작업 폴더”라면 <strong>빠른 캡처 → 쉽게 찾기 → 가벼운 유지보수</strong> 만 잘 되면 끝이에요. 아래대로 <strong>단계별</strong> 로 세팅해보세요.</p>

<h1 id="1-목표-3가지-먼저-정리">1) 목표 3가지 먼저 정리</h1>

<ol>
  <li>
    <p><strong>캡처 속도</strong> : 생각/파일을 즉시 던져놓을 곳이 있어야 함(= <code class="language-plaintext highlighter-rouge">00_Inbox</code>).</p>
  </li>
  <li>
    <p><strong>검색 용이</strong> : 규칙적 네이밍 + 얕은 깊이(최대 3단).</p>
  </li>
  <li>
    <p><strong>관리 최소화</strong> : 주 1회 아카이브만 하면 버틸 구조.</p>
  </li>
</ol>

<h1 id="2-추천-상위-구조-parasolo">2) 추천 상위 구조 (PARA+Solo)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/Work (루트 폴더)
├─ 00_Inbox           ← 급하게 던져두는 임시함 (매일/격일 비우기)
├─ 10_Today           ← 오늘 집중: WIP, 임시 노트
├─ 20_Projects        ← 끝나면 Archive로 이동
├─ 30_Areas           ← 역할/지속업무(예: 리포트, 운영)
├─ 40_Resources       ← 참고자료(매뉴얼, 규정, 레퍼런스)
├─ 50_Snippets        ← 텍스트 스니펫/스크립트/쿼리 모음
├─ 60_Assets          ← 로고/템플릿/브랜드 리소스
├─ 70_Exports         ← 외부 전달본(PDF, PPT, 이미지)
└─ 99_Archive         ← 완료 프로젝트·옛 참고자료
</code></pre></div></div>

<ul>
  <li><strong>개념</strong> : Projects(유한), Areas(지속), Resources(참고), Archive(보관) + 혼자쓰는 맛을 위한 <code class="language-plaintext highlighter-rouge">Today/Inbox/Snippets/Exports</code>.</li>
</ul>

<h1 id="3-네이밍-규칙짧고-강력">3) 네이밍 규칙(짧고 강력)</h1>

<ul>
  <li>
    <p><strong>날짜</strong> : <code class="language-plaintext highlighter-rouge">YYYY-MM-DD</code> (예: <code class="language-plaintext highlighter-rouge">2025-08-26_주간리포트.md</code>)</p>
  </li>
  <li>
    <p><strong>버전</strong> : <code class="language-plaintext highlighter-rouge">_v001, v002…</code> (최종본 금지)</p>
  </li>
  <li>
    <p><strong>프로젝트 폴더</strong> : <code class="language-plaintext highlighter-rouge">PRJ-YYYY-번호_짧은이름</code> (예: <code class="language-plaintext highlighter-rouge">PRJ-2025-012_런칭준비</code>)</p>
  </li>
  <li>
    <p><strong>정렬용 접두</strong> : 폴더는 <code class="language-plaintext highlighter-rouge">00,10,20…</code> 사용 (이미 반영)</p>
  </li>
</ul>

<h1 id="4-프로젝트-폴더-템플릿복붙">4) 프로젝트 폴더 템플릿(복붙)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/20_Projects/PRJ-2025-012_런칭준비
├─ 01_Plan        ← 목표/타임라인/OKR
├─ 02_Work        ← 실작업(문서, 스프레드시트 등)
├─ 03_Meetings    ← 회의노트(날짜_제목.md)
├─ 04_Refs        ← 링크모음/연구자료(요약 필수)
├─ export         ← 대외공유본(PDF/이미지)
└─ README.md
</code></pre></div></div>

<p><strong>README.md 템플릿</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 목적
- (한 줄 요약) 런칭 준비 전 과정 관리

# 범위/완료조건
- (예) 9/30까지 광고·CS·릴리즈 노트 확정

# 링크
- 기획 문서: ...
- 대시보드: ...

# 진행 현황(요약)
- 2025-08-26: 킥오프 완료, 메시지 프레임 확정

# 다음 액션(담당/기한)
- 배너 시안 v002 (나 / 08-28)
</code></pre></div></div>

<h1 id="5-개인-작업-루틴하루주간월간">5) 개인 작업 루틴(하루·주간·월간)</h1>

<p><strong>매일</strong></p>

<ol>
  <li>
    <p><strong>캡처</strong> : 모든 파일/메모는 <code class="language-plaintext highlighter-rouge">00_Inbox</code>에 던지기.</p>
  </li>
  <li>
    <p><strong>집중 공간</strong> : 당일 작업은 <code class="language-plaintext highlighter-rouge">10_Today</code>에서 처리(완료/중간산출물은 해당 프로젝트로 이동).</p>
  </li>
  <li>
    <p><strong>로그</strong> : <code class="language-plaintext highlighter-rouge">30_Areas/worklog/2025/2025-08/2025-08-26.md</code>에 5줄 요약.</p>
  </li>
</ol>

<p><strong>주 1회(금요일 15분)</strong></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">00_Inbox</code> 비우기 → <code class="language-plaintext highlighter-rouge">20_Projects</code> 또는 <code class="language-plaintext highlighter-rouge">40_Resources</code>로 분류.</p>
  </li>
  <li>
    <p>끝난 프로젝트는 <code class="language-plaintext highlighter-rouge">99_Archive</code>로 이동.</p>
  </li>
</ul>

<p><strong>월 1회(첫 영업일 20분)</strong></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">40_Resources</code> 중 구식 자료는 아카이브.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">50_Snippets</code> 정리(재사용 가능한 제목으로 변경).</p>
  </li>
</ul>

<h1 id="6-자주-쓰는-노트-템플릿-2종">6) 자주 쓰는 노트 템플릿 2종</h1>

<p><strong>회의 노트</strong> (<code class="language-plaintext highlighter-rouge">03_Meetings/2025-08-26_파트너_콜.md</code>)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 목적
# 요약(3줄)
# 결정사항
# 액션(담당/기한)
# 참고 링크
</code></pre></div></div>

<p><strong>일일 작업로그</strong> (<code class="language-plaintext highlighter-rouge">worklog/2025/2025-08/2025-08-26.md</code>)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## 오늘 3줄 요약
- 
## 집중 작업(링크)
- 
## 배운 점 / 이슈
- 
## 내일 첫 태스크
- 
</code></pre></div></div>

<h1 id="7-단독-사용에-딱-맞는-팁">7) 단독 사용에 딱 맞는 팁</h1>

<ul>
  <li>
    <p><strong>링크만 두지 말고 “최종 PDF”도 함께</strong> <code class="language-plaintext highlighter-rouge">export</code>에 저장(나중에 권한 문제 방지).</p>
  </li>
  <li>
    <p><strong>검색 키워드</strong> 를 문서 첫 줄에 넣기: <code class="language-plaintext highlighter-rouge">tags: #런칭 #광고 #대시보드</code>.</p>
  </li>
  <li>
    <p><strong>스니펫 관리</strong> : <code class="language-plaintext highlighter-rouge">50_Snippets/sql</code>, <code class="language-plaintext highlighter-rouge">50_Snippets/text</code>, <code class="language-plaintext highlighter-rouge">50_Snippets/bash</code>로 분리.</p>
  </li>
  <li>
    <p><strong>깊이는 3단 이하</strong> 만 유지(찾기 속도↓ 방지).</p>
  </li>
  <li>
    <p><strong>바탕화면 금지, 북마크화면 2개</strong> 만: <code class="language-plaintext highlighter-rouge">00_Inbox</code>, <code class="language-plaintext highlighter-rouge">10_Today</code>.</p>
  </li>
</ul>

<hr />

<p>원하면 지금 구조를 <strong>당신 이름/업무에 맞춰 바로 커스터마이즈</strong> 해서 트리까지 만들어줄게요. (예: 직무/툴—기획, 데이터, 디자인—에 맞춘 하위 폴더와 스니펫 기본 세트)</p>

<p class="chat--user">

주 업무는 데스크탑 애플리케이션 툴 개발이야(파이썬 패키지 형태), 그리고 교육 자료나 논문 자료를 모을 수 있는 곳도 있으면 좋겠어. 그리고 필요한 툴 설치 공간도 있으면 좋겠어. 그리고 환경 세팅을 위한 공간도 있으면 좋겠어. 

</p>

<p>좋다—니 요구(데스크탑 앱용 파이썬 패키지 + 교육/논문 자료 + 툴 설치공간 + 환경 세팅)를 딱 맞춘 <strong>1인 개발용 작업 폴더</strong> 와 <strong>스타터 키트</strong> 까지 만들어놨어. 바로 받아서 쓰면 돼요.</p>

<p>starter kit 다운로드</p>

<hr />

<h1 id="1-상위-구조-혼자-쓰는-용--네가-원하는-추가공간">1) 상위 구조 (혼자 쓰는 용 + 네가 원하는 추가공간)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/Work
├─ 00_Inbox            ← 급히 던져놓는 임시함
├─ 10_Today            ← 오늘 집중(WIP)
├─ 20_Projects         ← 각 앱/도구별 프로젝트(파이썬 패키지 형식)
├─ 30_Areas
│  ├─ worklog          ← 일일/주간 로그
│  └─ environments     ← 공통 환경 메모
├─ 40_Resources
│  └─ edu              ← 교육/논문/튜토리얼 모음
│     ├─ courses
│     ├─ tutorials
│     └─ papers
│        ├─ to_read
│        ├─ reading_notes (템플릿 포함)
│        └─ summaries
├─ 50_Snippets         ← 재사용 스니펫(sql/text/bash)
├─ 60_Assets           ← 로고/템플릿 등 공용
├─ 70_Exports          ← 외부 전달용 산출물(PDF/실행파일)
├─ 80_Tools            ← 툴 설치/포터블/스크립트/devcontainer
│  ├─ installers       ← 오프라인 설치 파일 보관(체크섬 기록 권장)
│  ├─ bin              ← 포터블 실행파일
│  ├─ scripts          ← 설치 자동화 스크립트/메모
│  └─ devcontainer     ← VSCode devcontainer 등
├─ 85_Environments     ← conda/venv/docker 예시 구성
└─ 99_Archive
</code></pre></div></div>

<blockquote>
  <p>교육/논문: <code class="language-plaintext highlighter-rouge">40_Resources/edu/papers</code>에 <strong>읽을거리/메모/요약</strong> 3분리 + <code class="language-plaintext highlighter-rouge">reading_notes/TEMPLATE.md</code> 포함.<br />
 툴 설치: <code class="language-plaintext highlighter-rouge">80_Tools/installers</code> 폴더와 <code class="language-plaintext highlighter-rouge">scripts/install_notes.md</code> 준비.<br />
 환경 세팅: <code class="language-plaintext highlighter-rouge">85_Environments/conda/environment.yml</code>, <code class="language-plaintext highlighter-rouge">venv/README.md</code>, <code class="language-plaintext highlighter-rouge">docker/Dockerfile</code> 샘플 포함.</p>
</blockquote>

<hr />

<h1 id="2-프로젝트파이썬-패키지-템플릿--바로-실행-가능">2) 프로젝트(파이썬 패키지) 템플릿 — 바로 실행 가능</h1>

<p>starter kit 안에 예제로 <code class="language-plaintext highlighter-rouge">20_Projects/PRJ-2025-001_sample_app</code>를 넣어뒀어. 구조:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PRJ-2025-001_sample_app
├─ src/sample_app       ← 패키지 소스 (CLI/GUI 엔트리 포함)
├─ tests                ← pytest 예제
├─ scripts              ← OS별 설치/실행/빌드 스크립트(.sh/.ps1)
├─ .devcontainer        ← 컨테이너 개발환경 설정
├─ pyproject.toml       ← PEP621(setuptools) + extras(dev/gui)
├─ .env.example         ← 환경변수 예시
├─ .gitignore / .editorconfig
└─ README.md
</code></pre></div></div>

<h3 id="키-포인트">키 포인트</h3>

<ul>
  <li>
    <p><strong>엔트리포인트</strong></p>

    <ul>
      <li>
        <p>CLI: <code class="language-plaintext highlighter-rouge">sample-app</code> → <code class="language-plaintext highlighter-rouge">sample_app.cli:main</code></p>
      </li>
      <li>
        <p>GUI(선택): <code class="language-plaintext highlighter-rouge">sample-app-gui</code> → <code class="language-plaintext highlighter-rouge">sample_app.gui:main</code> (PySide6 필요)</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>옵션 의존성</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">.[dev]</code>: pytest/ruff/pyinstaller</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">.[gui]</code>: PySide6 (원하면 설치)</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>단일 실행파일 빌드</strong> : PyInstaller 스크립트 내장(윈도/맥/리눅스 공통)</p>
  </li>
</ul>

<hr />

<h1 id="3-시작-순서-한-번만-하면-끝">3) 시작 순서 (한 번만 하면 끝)</h1>

<h2 id="macos--linux">macOS / Linux</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>Work/20_Projects/PRJ-2025-001_sample_app
./scripts/install.sh         <span class="c"># venv 생성 + dev 의존성 설치</span>
./scripts/run_cli.sh         <span class="c"># CLI 동작 확인</span>
<span class="c"># GUI가 필요하면:</span>
<span class="nb">source</span> .venv/bin/activate
pip <span class="nb">install</span> <span class="s2">".[gui]"</span>
./scripts/run_gui.sh
</code></pre></div></div>

<h2 id="windows-powershell">Windows (PowerShell)</h2>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cd</span><span class="w"> </span><span class="nx">Work/20_Projects/PRJ-2025-001_sample_app</span><span class="w">
</span><span class="o">.</span><span class="n">/scripts/install.ps1</span><span class="w">
</span><span class="o">.</span><span class="nx">/scripts/run_cli.ps1</span><span class="w">
</span><span class="c"># GUI 필요 시:</span><span class="w">
</span><span class="o">.</span><span class="n">\.venv\Scripts\Activate.ps1</span><span class="w">
</span><span class="nx">pip</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="s2">".[gui]"</span><span class="w">
</span><span class="o">.</span><span class="n">/scripts/run_gui.ps1</span><span class="w">
</span></code></pre></div></div>

<h2 id="빌드실행파일-만들기">빌드(실행파일 만들기)</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># CLI</span>
./scripts/build_cli.sh    <span class="c"># dist/sample-app(또는 .exe)</span>
<span class="c"># GUI</span>
./scripts/build_gui.sh    <span class="c"># dist/sample-app-gui(또는 .exe)</span>
</code></pre></div></div>

<hr />

<h1 id="4-논문교육-자료-관리--최소-규칙">4) 논문/교육 자료 관리 — 최소 규칙</h1>

<ul>
  <li>
    <p><strong>PDF는<code class="language-plaintext highlighter-rouge">/papers/to_read</code></strong>, 메모는 <code class="language-plaintext highlighter-rouge">/papers/reading_notes/YYYY-MM-DD_제목.md</code></p>
  </li>
  <li>
    <p>한 달에 한 번 <strong><code class="language-plaintext highlighter-rouge">/summaries</code></strong>에 1~2페이지 요약(나중에 검색/레퍼런스로 최고)</p>
  </li>
  <li>
    <p>코스/튜토리얼은 <code class="language-plaintext highlighter-rouge">/edu/courses</code>, <code class="language-plaintext highlighter-rouge">/edu/tutorials</code>로 구분. 실습 산출물은 해당 프로젝트의 <code class="language-plaintext highlighter-rouge">/docs</code>나 <code class="language-plaintext highlighter-rouge">/export</code>로 링크</p>
  </li>
</ul>

<hr />

<h1 id="5-환경-세팅--툴-설치--실무-루틴">5) 환경 세팅 &amp; 툴 설치 — 실무 루틴</h1>

<ol>
  <li>
    <p><strong>툴 설치파일</strong> 은 <code class="language-plaintext highlighter-rouge">80_Tools/installers</code>에 보관 + <code class="language-plaintext highlighter-rouge">install_notes.md</code>에 버전/체크섬 기록</p>
  </li>
  <li>
    <p><strong>개별 프로젝트마다 로컬 venv</strong> (<code class="language-plaintext highlighter-rouge">.venv/</code>)로 독립 관리</p>
  </li>
  <li>
    <p>회사/외부 이동 대비해서 <strong><code class="language-plaintext highlighter-rouge">70_Exports</code>에 최종 산출물(실행파일/PDF)</strong> 같이 남기기</p>
  </li>
  <li>
    <p>컨테이너가 필요하면 <code class="language-plaintext highlighter-rouge">85_Environments/docker/Dockerfile</code>이나 프로젝트 내 <code class="language-plaintext highlighter-rouge">.devcontainer</code> 사용</p>
  </li>
</ol>

<hr />

<h1 id="6-네이밍-요약복붙-규칙">6) 네이밍 요약(복붙 규칙)</h1>

<ul>
  <li>
    <p>파일: <code class="language-plaintext highlighter-rouge">YYYY-MM-DD_제목_v001.ext</code></p>
  </li>
  <li>
    <p>프로젝트 폴더: <code class="language-plaintext highlighter-rouge">PRJ-연도-번호_짧은이름</code> 예) <code class="language-plaintext highlighter-rouge">PRJ-2025-012_GUI툴</code></p>
  </li>
  <li>
    <p>깊이: <strong>최대 3단</strong> 유지</p>
  </li>
</ul>

<hr />

<h1 id="7-다음-액션-3분-컷">7) 다음 액션 (3분 컷)</h1>

<ol>
  <li>
    <p>위 <strong>starter kit 압축 해제</strong> → 원하는 위치에 <code class="language-plaintext highlighter-rouge">/Work</code> 배치</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">PRJ-2025-001_sample_app</code>을 네 프로젝트명으로 <strong>폴더/pyproject 패키지명 변경</strong></p>
  </li>
  <li>
    <p>OS에 맞는 <strong>설치 스크립트 실행</strong> 후 바로 코딩 시작</p>
  </li>
</ol>

<p>필요하면 네가 쓰는 <strong>GUI 프레임워크(PySide6/PyQt/Tkinter), 배포 방식(PyInstaller/Briefcase), 테스트 전략</strong> 에 맞춰 템플릿을 더 다듬어 줄게. 원하는 스택만 알려줘—바로 적용한 버전으로 트리까지 만들어서 드릴게!</p>

<p class="chat--user">

그리고 툴 개발만 하는건 아니고 그 툴을 이용해서 어떤 실제 산출물을 만들어야 할 때도 있어.

</p>

<p>좋아—<strong>툴 개발 + 그 툴로 실제 산출물(레포트, 이미지, 패키지, 실행파일 등)까지 만드는</strong> 흐름을 깔끔하게 돌릴 수 있게 구조와 템플릿을 추가로 준비했어. (재현성·추적성·인수인계에 강함)</p>

<p>업데이트된 스타터(Jobs 포함) 다운로드</p>

<hr />

<h2 id="1-한눈에-보는-구조-툴--산출물-분리">1) 한눈에 보는 구조 (툴 ↔ 산출물 분리)</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/Work
├─ 20_Projects         ← 툴(파이썬 패키지) 개발
│   └─ PRJ-2025-001_sample_app/...
├─ 25_Jobs             ← 툴을 써서 만드는 “산출물 작업 단위”
│   └─ JOB-2025-001_sample_output/  ← 샘플 Job 포함
│      ├─ 01_Brief         요구사항/검수기준
│      ├─ 02_Input/raw     원천데이터
│      ├─ 03_Config        파라미터(yml/json)
│      ├─ 04_Run           실행 스크립트, 로그, 매니페스트
│      ├─ 05_Output        중간/최종 산출물(작업용)
│      └─ 06_Export        전달본(완성품)
├─ 40_Resources/edu     ← 교육/논문/튜토리얼
├─ 70_Exports           ← 여러 Job의 최종본 모아보기(선택)
└─ 85_Environments      ← conda/venv/docker 샘플
</code></pre></div></div>

<h3 id="왜-분리하나">왜 분리하나?</h3>

<ul>
  <li>
    <p><strong>Projects</strong> 는 코드 수명(버전·릴리즈) 중심, <strong>Jobs</strong> 는 <strong>요구사항·입력·설정 → 결과물</strong> 이라는 <strong>프로세스</strong> 중심.</p>
  </li>
  <li>
    <p>Job 단위로 매니페스트/체크섬이 남으니 <strong>나중에 같은 결과를 재현</strong> 하기 쉬움.</p>
  </li>
</ul>

<hr />

<h2 id="2-실행-흐름-step-by-step">2) 실행 흐름 (Step-by-step)</h2>

<ol>
  <li>
    <p><strong>툴 개발/업데이트</strong> : <code class="language-plaintext highlighter-rouge">20_Projects/PRJ-...</code>에서 기능 추가 후 <code class="language-plaintext highlighter-rouge">.[dev]</code> 설치.</p>
  </li>
  <li>
    <p><strong>Job 생성</strong> : <code class="language-plaintext highlighter-rouge">25_Jobs</code> 아래 새 <code class="language-plaintext highlighter-rouge">JOB-YYYY-###_이름</code> 폴더 복제.</p>
  </li>
  <li>
    <p><strong>입력/설정 배치</strong> : <code class="language-plaintext highlighter-rouge">02_Input/raw</code>에 데이터, <code class="language-plaintext highlighter-rouge">03_Config/config.yml</code>에 파라미터 작성.</p>
  </li>
  <li>
    <p><strong>실행</strong> :</p>

    <ul>
      <li>macOS/Linux:
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>25_Jobs/JOB-.../04_Run
bash run.sh
</code></pre></div>        </div>
      </li>
      <li>Windows (PowerShell):
        <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cd</span><span class="w"> </span><span class="nx">25_Jobs/JOB-.../04_Run</span><span class="w">
</span><span class="o">.</span><span class="n">/run.ps1</span><span class="w">
</span></code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ol>

<p>스크립트가 <code class="language-plaintext highlighter-rouge">run.py</code>를 호출 → <strong>산출물</strong> 을 <code class="language-plaintext highlighter-rouge">06_Export</code>에 생성 + <strong>manifest.json</strong> / <strong>run_log.txt</strong> 기록.</p>

<ol>
  <li><strong>검수/전달</strong> : <code class="language-plaintext highlighter-rouge">qa_checklist.md</code>로 확인 → 필요 시 <code class="language-plaintext highlighter-rouge">/Work/70_Exports</code>에도 복사.</li>
</ol>

<blockquote>
  <p>샘플 Job은 실제로 <strong>툴 패키지 버전(예:<code class="language-plaintext highlighter-rouge">sample_app.__version__</code>)을 읽어 매니페스트에 박아두고</strong>, 산출물 파일의 <strong>SHA256 체크섬</strong> 까지 저장하도록 되어 있어. (전달 후 변경 여부도 검증 가능)</p>
</blockquote>

<hr />

<h2 id="3-네이밍--버전-전략-산출물용">3) 네이밍 &amp; 버전 전략 (산출물용)</h2>

<ul>
  <li>
    <p><strong>Job 코드 접두</strong> : <code class="language-plaintext highlighter-rouge">JOB-2025-023_캠페인A_보고서_v003.pdf</code></p>
  </li>
  <li>
    <p><strong>세부 규칙</strong> : <code class="language-plaintext highlighter-rouge">JOB코드_YYYYMMDD[-run]_v###.ext</code></p>
  </li>
  <li>
    <p><strong>툴 버전 고정</strong> : 매니페스트에 <code class="language-plaintext highlighter-rouge">tool_version</code>, 파라미터 파일 경로, Python 버전, OS 정보 포함.</p>
  </li>
</ul>

<hr />

<h2 id="4-재현성-체크리스트">4) 재현성 체크리스트</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">03_Config/config.yml</code>에 모든 파라미터 기록</p>
  </li>
  <li>
    <p>입력 데이터 소스/버전 기록(가능하면 체크섬)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">85_Environments</code>(conda/venv/docker) 중 하나로 환경 고정</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">04_Run/manifest.json</code> 자동 생성 확인</p>
  </li>
  <li>
    <p>랜덤 사용 시 <strong>시드 고정</strong> 및 매니페스트에 기록</p>
  </li>
</ul>

<hr />

<h2 id="5-교육논문-자료와-실무-연결">5) 교육/논문 자료와 실무 연결</h2>

<ul>
  <li>
    <p>논문을 읽고 도입한 알고리즘/기법은 <strong>해당 툴 PRJ의 <code class="language-plaintext highlighter-rouge">/docs</code></strong>에 요약,<br />
실험·비교 결과는 <strong>개별 Job</strong> 으로 실행해 <strong>입력/설정/산출</strong> 을 남기면 <strong>논문→코드→결과</strong> 추적이 선명해짐.</p>
  </li>
  <li>
    <p>템플릿 포함: <code class="language-plaintext highlighter-rouge">40_Resources/edu/papers/reading_notes/TEMPLATE.md</code></p>
  </li>
</ul>

<hr />

<h2 id="6-바로-다음-액션">6) 바로 다음 액션</h2>

<ol>
  <li>
    <p>압축을 풀고 <code class="language-plaintext highlighter-rouge">/Work</code>를 원하는 위치에 둔다.</p>
  </li>
  <li>
    <p>샘플 툴 <code class="language-plaintext highlighter-rouge">PRJ-2025-001_sample_app</code>에서 설치 스크립트 실행 → 동작 확인.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">25_Jobs/JOB-2025-001_sample_output</code>을 복제해 너의 실제 산출물 작업에 맞춰 <code class="language-plaintext highlighter-rouge">brief/config</code>만 바꿔 실행.</p>
  </li>
</ol>

<p>원하면 네 도메인(예: 이미지 처리, 리포트 생성, 포맷 규격) 기준으로 <strong>Job 스캐폴드</strong>(검수 스텝·표준 파라미터·파일명 규칙)를 더 빡빡하게 커스터마이즈해서 만들어줄게.</p>

<p class="chat--user">

전체 다시 보여줘

</p>

<p>좋아! 지금까지 만든 걸 <strong>한눈에, 단계별로</strong> 싹 정리해 줄게.<br />
(바로 쓸 수 있는 스타터 포함)</p>

<p>최신 스타터(툴 + Jobs 포함) 다운로드</p>

<hr />

<h1 id="1-목표-3가지">1) 목표 3가지</h1>

<ol>
  <li>
    <p><strong>빠른 캡처</strong> : 어디서든 <code class="language-plaintext highlighter-rouge">00_Inbox</code>로 던져 넣기</p>
  </li>
  <li>
    <p><strong>쉽게 찾기</strong> : 얕은 깊이(최대 3단) + 규칙적 네이밍</p>
  </li>
  <li>
    <p><strong>가벼운 유지보수</strong> : 주 1회 정리·아카이브</p>
  </li>
</ol>

<hr />

<h1 id="2-상위-폴더-구조최종본">2) 상위 폴더 구조(최종본)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/Work
├─ 00_Inbox               # 급히 던지는 임시함
├─ 10_Today               # 오늘 집중 작업(WIP)
├─ 20_Projects            # 툴(파이썬 패키지) 개발
│   └─ PRJ-2025-001_sample_app/...
├─ 25_Jobs                # 툴을 사용해 만드는 실제 산출 작업 단위
│   └─ JOB-2025-001_sample_output/
│      ├─ 01_Brief
│      ├─ 02_Input/raw
│      ├─ 03_Config
│      ├─ 04_Run
│      ├─ 05_Output
│      └─ 06_Export
├─ 30_Areas
│   ├─ worklog
│   └─ environments
├─ 40_Resources
│   └─ edu
│      ├─ courses
│      ├─ tutorials
│      └─ papers
│         ├─ to_read
│         ├─ reading_notes (TEMPLATE.md 포함)
│         └─ summaries
├─ 50_Snippets           # sql/text/bash 재사용 스니펫
├─ 60_Assets             # 로고·템플릿 등 공용
├─ 70_Exports            # 여러 Job 최종 전달본 모아보기(선택)
├─ 80_Tools              # 설치파일·포터블·자동화 스크립트·devcontainer
│   ├─ installers
│   ├─ bin
│   ├─ scripts
│   └─ devcontainer
├─ 85_Environments       # conda/venv/docker 샘플
└─ 99_Archive
</code></pre></div></div>

<hr />

<h1 id="3-네이밍-규칙짧고-강력-1">3) 네이밍 규칙(짧고 강력)</h1>

<ul>
  <li>
    <p><strong>파일</strong> : <code class="language-plaintext highlighter-rouge">YYYY-MM-DD_제목_v001.ext</code></p>
  </li>
  <li>
    <p><strong>프로젝트 폴더</strong> : <code class="language-plaintext highlighter-rouge">PRJ-연도-번호_짧은이름</code> → 예) <code class="language-plaintext highlighter-rouge">PRJ-2025-012_GUI툴</code></p>
  </li>
  <li>
    <p><strong>Job 폴더</strong> : <code class="language-plaintext highlighter-rouge">JOB-연도-번호_짧은이름</code> → 예) <code class="language-plaintext highlighter-rouge">JOB-2025-023_보고서A</code></p>
  </li>
  <li>
    <p><strong>깊이 제한</strong> : 최대 3단</p>
  </li>
</ul>

<hr />

<h1 id="4-툴파이썬-패키지-템플릿-요약">4) 툴(파이썬 패키지) 템플릿 요약</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PRJ-2025-001_sample_app
├─ src/sample_app (cli.py, gui.py, __init__.py)
├─ tests/test_smoke.py
├─ scripts/ (install/run/build/test/lint: .sh / .ps1 모두)
├─ .devcontainer/devcontainer.json
├─ pyproject.toml (extras: dev/gui, entry points 등록)
├─ .env.example, .gitignore, .editorconfig
└─ README.md
</code></pre></div></div>

<ul>
  <li>
    <p><strong>엔트리포인트</strong> :</p>

    <ul>
      <li>
        <p>CLI: <code class="language-plaintext highlighter-rouge">sample-app</code> → <code class="language-plaintext highlighter-rouge">sample_app.cli:main</code></p>
      </li>
      <li>
        <p>GUI(옵션): <code class="language-plaintext highlighter-rouge">sample-app-gui</code> → <code class="language-plaintext highlighter-rouge">sample_app.gui:main</code> (PySide6)</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>개발 편의</strong> : <code class="language-plaintext highlighter-rouge">.[dev]</code>에 pytest/ruff/pyinstaller 포함</p>
  </li>
  <li>
    <p><strong>단일 실행파일</strong> : PyInstaller 스크립트 내장</p>
  </li>
</ul>

<p><strong>시작(맥/리눅스)</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>Work/20_Projects/PRJ-2025-001_sample_app
./scripts/install.sh
./scripts/run_cli.sh
<span class="c"># GUI 필요 시:</span>
<span class="nb">source</span> .venv/bin/activate <span class="o">&amp;&amp;</span> pip <span class="nb">install</span> <span class="s2">".[gui]"</span> <span class="o">&amp;&amp;</span> ./scripts/run_gui.sh
</code></pre></div></div>

<p><strong>시작(Windows PowerShell)</strong></p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cd</span><span class="w"> </span><span class="nx">Work/20_Projects/PRJ-2025-001_sample_app</span><span class="w">
</span><span class="o">.</span><span class="n">/scripts/install.ps1</span><span class="w">
</span><span class="o">.</span><span class="nx">/scripts/run_cli.ps1</span><span class="w">
</span><span class="c"># GUI 필요 시:</span><span class="w">
</span><span class="o">.</span><span class="n">\.venv\Scripts\Activate.ps1</span><span class="p">;</span><span class="w"> </span><span class="n">pip</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="s2">".[gui]"</span><span class="p">;</span><span class="w"> </span><span class="o">.</span><span class="n">/scripts/run_gui.ps1</span><span class="w">
</span></code></pre></div></div>

<p><strong>빌드</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./scripts/build_cli.sh     <span class="c"># CLI 실행파일</span>
./scripts/build_gui.sh     <span class="c"># GUI 실행파일</span>
</code></pre></div></div>

<hr />

<h1 id="5-실제-산출물job-파이프라인">5) 실제 산출물(Job) 파이프라인</h1>

<ul>
  <li>
    <p><strong>의도</strong> : Projects(코드)와 분리해 <strong>입력→설정→실행→산출</strong> 흐름을 <strong>재현 가능</strong> 하게 관리</p>
  </li>
  <li>
    <p><strong>실행 절차</strong></p>

    <ol>
      <li>
        <p><code class="language-plaintext highlighter-rouge">02_Input/raw</code>에 원천 데이터 배치</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">03_Config/config.yml</code>에 파라미터 기록</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">04_Run/run.sh</code>(또는 <code class="language-plaintext highlighter-rouge">run.ps1</code>) 실행</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">06_Export</code>에 전달본 생성 + <code class="language-plaintext highlighter-rouge">manifest.json</code>/<code class="language-plaintext highlighter-rouge">run_log.txt</code> 출력</p>
      </li>
      <li>
        <p>필요 시 <code class="language-plaintext highlighter-rouge">70_Exports</code>로도 복사(전사 공유)</p>
      </li>
    </ol>
  </li>
  <li>
    <p><strong>품질/추적</strong> :</p>

    <ul>
      <li>
        <p>매니페스트에 <code class="language-plaintext highlighter-rouge">tool_version</code>, Python/OS, 파라미터 파일, <strong>SHA256 체크섬</strong> 자동 저장</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">qa_checklist.md</code>로 규격·포맷·시드 고정 점검</p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h1 id="6-교육논문-자료-워크플로">6) 교육/논문 자료 워크플로</h1>

<ul>
  <li>
    <p>PDF는 <code class="language-plaintext highlighter-rouge">40_Resources/edu/papers/to_read</code></p>
  </li>
  <li>
    <p>메모는 <code class="language-plaintext highlighter-rouge">reading_notes/YYYY-MM-DD_제목.md</code> (템플릿 제공)</p>
  </li>
  <li>
    <p>1~2페이지 요약은 <code class="language-plaintext highlighter-rouge">summaries/</code></p>
  </li>
  <li>
    <p>논문에서 채택한 아이디어는 <strong>프로젝트 <code class="language-plaintext highlighter-rouge">/docs</code></strong>에 정리, 실험은 <strong>개별 Job</strong> 으로 기록(입력/설정/산출 연결)</p>
  </li>
</ul>

<hr />

<h1 id="7-환경툴-설치-공간-사용법">7) 환경·툴 설치 공간 사용법</h1>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">80_Tools/installers</code>: 오프라인 설치 파일 보관, <strong>버전·체크섬</strong> 을 <code class="language-plaintext highlighter-rouge">scripts/install_notes.md</code>에 메모</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">85_Environments</code>:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">conda/environment.yml</code></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">venv/README.md</code></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">docker/Dockerfile</code> (또는 프로젝트 내 <code class="language-plaintext highlighter-rouge">.devcontainer</code>)</p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h1 id="8-일주-운영-루틴">8) 일/주 운영 루틴</h1>

<p><strong>매일</strong></p>

<ul>
  <li>
    <p>모든 캡처는 <code class="language-plaintext highlighter-rouge">00_Inbox</code> → 당일 처리건은 <code class="language-plaintext highlighter-rouge">10_Today</code></p>
  </li>
  <li>
    <p>작업 끝난 파일은 프로젝트 또는 Job 위치로 이동</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">30_Areas/worklog/YYYY/YYYY-MM/날짜.md</code>에 5줄 로그</p>
  </li>
</ul>

<p><strong>주 1회</strong></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">00_Inbox</code> 정리, 완료 Job/Project는 <code class="language-plaintext highlighter-rouge">99_Archive</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">70_Exports</code> 정리(최종 전달본만 유지)</p>
  </li>
</ul>

<hr />

<h1 id="9-바로-다음-액션3단계">9) 바로 다음 액션(3단계)</h1>

<ol>
  <li>
    <p>압축 해제 후 <code class="language-plaintext highlighter-rouge">/Work</code> 배치</p>
  </li>
  <li>
    <p>툴 템플릿 폴더/패키지명(예: <code class="language-plaintext highlighter-rouge">sample_app</code>)을 네 프로젝트명으로 변경</p>
  </li>
  <li>
    <p>샘플 Job을 복제해 <code class="language-plaintext highlighter-rouge">brief/config</code>만 수정 → <code class="language-plaintext highlighter-rouge">04_Run</code> 실행</p>
  </li>
</ol>

<hr />

<p>필요하면 네 도메인(이미지 처리, 리포트 생성, 특정 포맷 규격 등)에 맞춰 <strong>Job 스캐폴드(검수 목록, 파라미터 스키마, 파일명 규칙)</strong>를 더 촘촘히 커스터마이즈해서 바로 쓸 버전으로 만들어줄게.</p>

<p class="chat--user">

1. 만약에 배포한 툴에 대한 제보가 버그가 들어와서 이에 대해 디버깅 수행이 필요해. 2. 배포한 툴에 대한 example을 만드는 작업을 하고 싶어. 3. 새로 설치한 툴에 대한 간단한 사용법 및 feasibility 검사용 테스트를 수행하고 싶어. 4. 파이썬 문법이 헷갈려서(regex) 등을 jupyter 띄워서 간단히 테스트하고 싶어. 5. 각종 유용한 팁을 모아두고 싶어. 6. 다른 여러 곳에서 참조할만한 Resource를 모아두고 싶어(설정 파일 등) 7. Manual 파일들을 모아두고 싶어. 각각의 업무에 대해 작업해야할 폴더를 알려줘. 없다면 추가해줘

</p>

<p>좋아! 네가 적어준 7가지 업무 각각에 대해 <strong>어디서 작업할지</strong> + <strong>없던 폴더는 추가</strong> 까지 다 해놨어.<br />
바로 쓸 수 있게 템플릿과 스크립트도 넣어 <strong>업데이트된 스타터</strong> 압축본을 만들었어.</p>

<p>업무별 확장 스타터(Tasks Extended) 다운로드</p>

<hr />

<h2 id="1-배포-툴-버그-제보-디버깅">1) “배포 툴 버그 제보” 디버깅</h2>

<ul>
  <li><strong>작업 위치(재현/증거 관리)</strong><br />
<code class="language-plaintext highlighter-rouge">25_Jobs/BUG-YYYY-###_이름/</code>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>01_Report/      # 제보 내용, 기대/실제, 환경
02_Repro/input  # 재현용 입력/파일
03_Config/      # 재현 파라미터(.yml/.json)
04_Run/         # repro.py + run 스크립트(sh/ps1)
05_Evidence/    # 로그/덤프/스크린샷/체크섬
06_FixValidation# 패치 검증 케이스
</code></pre></div>    </div>
  </li>
</ul>

<p>→ <strong>샘플 생성됨:</strong> <code class="language-plaintext highlighter-rouge">25_Jobs/BUG-2025-001_sample_bug/</code> (report.md, repro.py 포함)</p>

<ul>
  <li>
    <p><strong>작업 위치(코드 측 기록)</strong><br />
<code class="language-plaintext highlighter-rouge">20_Projects/PRJ-.../issues/BUG-YYYY-###/</code></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">triage.md</code>: 심각도/영향/추정 원인/다음 스텝</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">fix_notes.md</code>: 루트원인/커밋/테스트/릴리즈 계획</p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="2-배포한-툴의-example-제작">2) 배포한 툴의 example 제작</h2>

<ul>
  <li><strong>소스 예제(프로젝트 안)</strong><br />
<code class="language-plaintext highlighter-rouge">20_Projects/PRJ-.../examples/</code>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>data/      # 공개 가능한 소형 샘플 데이터
scripts/   # run_*.py: 기능별 최소 예제
docs/      # 각 예제의 기대 출력/설명
</code></pre></div>    </div>
  </li>
</ul>

<p>→ <strong>샘플 생성됨:</strong> <code class="language-plaintext highlighter-rouge">examples/scripts/run_hello.py</code>, <code class="language-plaintext highlighter-rouge">examples/docs/hello.md</code></p>

<ul>
  <li><strong>예제 결과물 패키징(선택)</strong><br />
실제 산출 패키지로 묶고 싶으면 <strong>Job으로 실행</strong> :<br />
<code class="language-plaintext highlighter-rouge">25_Jobs/EX-YYYY-###_툴예제/</code> (Job 스캐폴드 복제)</li>
</ul>

<hr />

<h2 id="3-새로-설치한-툴의-사용법feasibility-스모크-테스트">3) 새로 설치한 툴의 사용법·feasibility 스모크 테스트</h2>

<ul>
  <li>
    <p><strong>작업 위치</strong><br />
<code class="language-plaintext highlighter-rouge">25_Jobs/SMOKE-YYYY-###_toolname/</code></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">03_Config/commands.txt</code>에 버전 출력 등 <strong>통과 기준 명령</strong> 을 나열</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">04_Run/smoke.sh</code>/<code class="language-plaintext highlighter-rouge">smoke.ps1</code>가 순차 실행 → 결과 <code class="language-plaintext highlighter-rouge">06_Export/</code>에 남김<br />
→ <strong>샘플 생성됨:</strong> <code class="language-plaintext highlighter-rouge">SMOKE-2025-001_new_tool/</code> (commands.txt, smoke.sh 포함)</p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="4-파이썬regex-등-빠른-실험-용-jupyter">4) 파이썬/regex 등 <strong>빠른 실험</strong> 용 Jupyter</h2>

<ul>
  <li>
    <p><strong>작업 위치</strong><br />
<code class="language-plaintext highlighter-rouge">31_Labs/jupyter/</code></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">regex_scratch.ipynb</code>(생성됨): 소형 정규표현식 테스트 노트북</p>
      </li>
      <li>
        <p>실험은 <strong>작게</strong> 하고, 배운 건 <code class="language-plaintext highlighter-rouge">30_Areas/kb</code>로 옮겨 정리</p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="5-각종-유용한-팁-모음">5) 각종 <strong>유용한 팁</strong> 모음</h2>

<ul>
  <li><strong>작업 위치</strong><br />
<code class="language-plaintext highlighter-rouge">30_Areas/kb/</code>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tips/         # 단문 팁 (python.md, regex.md 샘플 생성)
cheatsheets/  # 한 장 요약
howtos/       # 절차형 가이드
</code></pre></div>    </div>

    <ul>
      <li>라이프로그성 메모는 여기, <strong>재사용 가능한 코드</strong> 는 <code class="language-plaintext highlighter-rouge">50_Snippets/</code>에 보관</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="6-여러-곳에서-참조할-resource설정-등-중앙-저장소">6) 여러 곳에서 참조할 <strong>Resource(설정 등) 중앙 저장소</strong></h2>

<ul>
  <li><strong>작업 위치</strong><br />
<code class="language-plaintext highlighter-rouge">40_Resources/reference/configs/</code>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vscode/ ruff/ pytest/ pyinstaller/ pyside6/ jupyter/
</code></pre></div>    </div>
  </li>
</ul>

<p>→ 샘플 <code class="language-plaintext highlighter-rouge">pytest.ini</code>, <code class="language-plaintext highlighter-rouge">ruff.toml</code>, <code class="language-plaintext highlighter-rouge">jupyter_notebook_config.py</code> 포함</p>

<ul>
  <li>실제 프로젝트에서 가져다 쓸 <strong>골든 설정</strong> 은 여기서 관리하고, 각 프로젝트에는 <strong>심볼릭 링크/복사</strong>.</li>
</ul>

<hr />

<h2 id="7-manual-파일-모음">7) <strong>Manual</strong> 파일 모음</h2>

<ul>
  <li>
    <p><strong>작업 위치</strong><br />
<code class="language-plaintext highlighter-rouge">40_Resources/manuals/&lt;벤더&gt;/&lt;제품&gt;/&lt;버전&gt;/</code><br />
→ 샘플: <code class="language-plaintext highlighter-rouge">manuals/AcmeTool/1.0/index.md</code></p>

    <ul>
      <li>PDF/HTML/마크다운 매뉴얼 정리, 루트 <code class="language-plaintext highlighter-rouge">README.md</code>에 규칙 설명</li>
    </ul>
  </li>
</ul>

<hr />

<h1 id="보너스-빠르게-쓰는-규칙요약">보너스: 빠르게 쓰는 규칙(요약)</h1>

<ul>
  <li>
    <p><strong>Job 네이밍</strong> :</p>

    <ul>
      <li>
        <p>버그: <code class="language-plaintext highlighter-rouge">BUG-2025-023_&lt;키워드&gt;</code></p>
      </li>
      <li>
        <p>예제: <code class="language-plaintext highlighter-rouge">EX-2025-011_&lt;기능&gt;</code></p>
      </li>
      <li>
        <p>스모크: <code class="language-plaintext highlighter-rouge">SMOKE-2025-004_&lt;툴이름&gt;</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>산출 파일명</strong> : <code class="language-plaintext highlighter-rouge">JOB코드_YYYYMMDD_v###.ext</code></p>
  </li>
  <li>
    <p><strong>증거 관리</strong> : <code class="language-plaintext highlighter-rouge">05_Evidence</code>에 로그/덤프/스크린샷 + <strong>SHA256</strong> 기록</p>
  </li>
  <li>
    <p><strong>지식 이전</strong> : <code class="language-plaintext highlighter-rouge">31_Labs</code> → 정리되면 <code class="language-plaintext highlighter-rouge">30_Areas/kb</code>로 승격</p>
  </li>
</ul>

<hr />

<p>원하면 니가 실제로 쓰는 <strong>툴 이름/도메인</strong>(예: 영상 처리, 리포트 생성, CAD 등)을 알려줘. 그러면 BUG/EX/SMOKE Job 템플릿을 그 도메인 규격(입력 포맷, QA 체크리스트, 파일명 규칙)으로 더 구체화해서 <strong>맞춤 스캐폴드</strong> 로 바로 내줄게.</p>

<p class="chat--user">

kb가 뭐야? 이제 정리된 구조를 하나의 plain text 파일로 정리해줘. 각 폴더별로 간단한 설명을 오른쪽에 붙여주면 좋겠어. 하위 폴더 구조 예시도 같이 주고

</p>

<p>좋아! 먼저 질문부터 답할게.</p>

<ul>
  <li><strong>kb가 뭐야?</strong><br />
<code class="language-plaintext highlighter-rouge">kb</code>는 <strong>knowledge base(지식 베이스)</strong>의 줄임말이야. 계속 쓰이는 팁·치트시트·가이드(How-to) 같은 <strong>축적형 지식</strong> 을 모아두는 폴더고, 우리 구조에서는 <code class="language-plaintext highlighter-rouge">30_Areas/kb/</code> 아래에 <code class="language-plaintext highlighter-rouge">tips/</code>, <code class="language-plaintext highlighter-rouge">cheatsheets/</code>, <code class="language-plaintext highlighter-rouge">howtos/</code>로 나눠서 정리해.</li>
</ul>

<p>요청한 대로, <strong>전체 구조를 plain text 파일</strong> 로 만들어 두었어. 각 폴더 오른쪽에 <strong>간단 설명</strong> 이 붙어 있고, <strong>하위 구조 예시</strong> 도 포함했어.</p>

<p>work_folder_structure.txt 다운로드</p>

<p>원본을 그대로 붙여넣어도 되지만, 파일로 받아두면 팀원에게 전송하거나 문서에 링크 걸기 편해. 필요하면 네 실제 프로젝트명/툴명으로 예시들을 자동 치환한 버전도 만들어 줄게.</p>

<p class="chat--user">

그냥 본문에 써줘

</p>

<p>아래 그대로 복붙해서 쓰면 돼요. (오른쪽은 간단 설명, 들여쓰기는 계층)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work 폴더 구조 요약 (생성: 2025-08-26)
※ 각 줄의 오른쪽은 간단 설명, 들여쓰기는 계층을 의미합니다.

Work/ - 1인 개발용 작업 루트
  00_Inbox/ - 급히 던져두는 임시함(매일 비우기)
  10_Today/ - 오늘 집중 작업(WIP), 끝나면 제자리 이동
  20_Projects/ - 툴(파이썬 패키지) 개발 공간
    PRJ-YYYY-NNN_name/ - 단일 프로젝트(패키지) 단위
      src/ - 패키지 소스 코드
        &lt;package_name&gt;/ - 모듈 디렉터리(예: sample_app)
      tests/ - pytest 테스트
      scripts/ - install/run/build/lint/test 스크립트(.sh/.ps1)
      examples/ - 배포용 예제 모음
        data/ - 공개 가능한 소형 샘플 데이터
        scripts/ - run_*.py 예제 스크립트
        docs/ - 예제 설명 및 기대 출력
      .devcontainer/ - 컨테이너 개발환경 설정(devcontainer.json 등)
      pyproject.toml - 프로젝트 메타, 의존성, 엔트리포인트
      README.md - 사용법/개요
      .gitignore, .editorconfig - 개발 편의
  25_Jobs/ - 툴을 사용해 만드는 실제 산출 작업 단위
    JOB-YYYY-NNN_name/ - 일반 산출 Job(입력→설정→실행→산출)
      01_Brief/ - 요구사항/검수기준/마감
      02_Input/
        raw/ - 원천 데이터
      03_Config/ - 파라미터(yml/json), 런 설정
      04_Run/ - 실행 스크립트(run.sh/ps1, run.py), 로그
      05_Output/ - 중간/최종 산출물(작업용)
      06_Export/ - 전달본(최종 산출물)
      90_Archive/ - 완료 후 보관
    BUG-YYYY-NNN_name/ - 배포 버그 재현/증거/수정 검증 용 Job
      01_Report/ - 제보 내용, 환경, 기대/실제
      02_Repro/
        input/ - 재현에 필요한 입력
      03_Config/ - 재현 파라미터
      04_Run/ - repro.py, repro.sh/ps1, repro_log.txt
      05_Evidence/
        logs/ - 콘솔/크래시 로그, 스크린샷, 체크섬
      06_FixValidation/ - 패치 검증 케이스
    EX-YYYY-NNN_name/ - 툴 예제 산출 Job(선택, 패키징 목적)
    SMOKE-YYYY-NNN_tool/ - 새 툴 설치 후 스모크/feasibility 테스트
      01_Brief/ - 성공 기준 정의
      03_Config/ - commands.txt: 테스트 명령 목록
      04_Run/ - smoke.sh/ps1로 일괄 실행
      06_Export/ - 결과 요약(result.txt 등)
  30_Areas/ - 지속 업무 영역(Projects와 달리 계속 유지)
    worklog/ - 일일/주간 작업 로그(YYYY/YY-MM/날짜.md)
    environments/ - 공통 환경 메모/전략
    kb/ - knowledge base(지식 베이스): 팁·문서·가이드 축적
      tips/ - 단문 팁 모음(예: python.md, regex.md)
      cheatsheets/ - 한 장 요약
      howtos/ - 절차형 가이드
  31_Labs/ - 실험실 영역(가벼운 테스트/실습)
    jupyter/ - 스크래치 노트북(예: regex_scratch.ipynb)
  40_Resources/ - 참고 자료(교육/레퍼런스/매뉴얼/설정)
    edu/ - 교육·논문·튜토리얼
      courses/ - 강의/코스 자료
      tutorials/ - 튜토리얼 모음
      papers/ - 논문 관리
        to_read/ - 읽을 논문 PDF
        reading_notes/ - 논문 메모(YYYY-MM-DD_제목.md, TEMPLATE.md 포함)
        summaries/ - 1~2페이지 요약
    reference/ - 여러 곳에서 참조할 공통 리소스
      configs/ - 표준 설정(프로젝트에서 재사용)
        vscode/ - VSCode 설정
        ruff/ - ruff.toml 예시
        pytest/ - pytest.ini 예시
        pyinstaller/ - 빌드 설정 템플릿
        pyside6/ - GUI 프레임워크 관련
        jupyter/ - jupyter_notebook_config.py 예시
    manuals/ - 매뉴얼/가이드(PDF/HTML/MD)
      &lt;vendor&gt;/&lt;product&gt;/&lt;version&gt;/ - 버전별 정리
  50_Snippets/ - 재사용 코드/문구
    sql/ - 쿼리 스니펫
    text/ - 문서/이메일 문구
    bash/ - 쉘 스니펫
  60_Assets/ - 로고/폰트/템플릿 등 공용 리소스
  70_Exports/ - 여러 Job의 최종 전달본 모아보기(옵션)
  80_Tools/ - 툴 설치/포터블/자동화
    installers/ - 오프라인 설치 파일, install_notes.md(버전·체크섬)
    bin/ - 포터블 실행파일
    scripts/ - 설치/유틸 스크립트
    devcontainer/ - 개발 컨테이너 관련
  85_Environments/ - 개발 환경 예시
    conda/
      environment.yml - conda 환경 정의
    venv/
      README.md - 표준 venv 사용 가이드
    docker/
      Dockerfile - 개발 컨테이너 베이스
  99_Archive/ - 완료 프로젝트/Job/자료 보관

[네이밍 요약]
- 프로젝트 폴더: PRJ-연도-번호_짧은이름 (예: PRJ-2025-012_GUItool)
- Job 폴더: JOB/BUG/EX/SMOKE-연도-번호_이름
- 파일: YYYY-MM-DD_제목_v001.ext (최종본 금지, 버전 증가)
- 깊이: 최대 3단 유지
</code></pre></div></div>

<p class="chat--user">

1. 내가 만든 툴을 유저들에게 배포할 장소도 있으면 좋겠어. 2. 골든 설정 뿐 아니라 내 개인 설정을 저장할 곳도 있으면 좋겠어. 두 가지를 어떻게 관리하면 될 지 알려줘. 폴더 추가가 필요하다면 추가해줘

</p>

<p>좋아—두 가지를 깔끔하게 나누자.</p>

<h1 id="1-배포-장소-유저에게-줄-최종물-보관">1) 배포 장소 (유저에게 줄 최종물 보관)</h1>

<h2 id="폴더-추가">폴더 추가</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/75_Releases                         ← “배포 전용” 중앙 보관소
  /&lt;project_slug&gt;/                   ← 예: sample-app
    /vX.Y.Z/                         ← 릴리스 버전별
      /installers/                   ← .exe/.msi/.pkg/.dmg 등
      /wheels/                       ← Python wheel(s)
      /portable/                     ← 포터블/압축본
      /docs/                         ← 설치 가이드, README, FAQ
      /licenses/                     ← LICENSE, ThirdPartyNotices.txt
      /checksums/                    ← *.sha256 (무결성 확인)
      ReleaseNotes.md                ← 릴리스 노트
    /latest/                         ← 최신 버전(심볼릭링크 or 복사)
  catalog.json                       ← (선택) 버전/파일 목록 인덱스
</code></pre></div></div>

<h2 id="운용-규칙짧게">운용 규칙(짧게)</h2>

<ol>
  <li>
    <p><strong>빌드 산출물</strong> 은 프로젝트 내부 <code class="language-plaintext highlighter-rouge">dist/</code>에 생성</p>
  </li>
  <li>
    <p><strong>QA 통과</strong> 후 <code class="language-plaintext highlighter-rouge">75_Releases/&lt;project&gt;/vX.Y.Z/</code>로 복사</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">checksums/</code>에 <code class="language-plaintext highlighter-rouge">*.sha256</code> 생성(무결성 검증)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ReleaseNotes.md</code>와 간단 설치 가이드 <code class="language-plaintext highlighter-rouge">/docs/</code> 배치</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">latest/</code>를 새 버전으로 갱신</p>
  </li>
  <li>
    <p>외부 공유 시엔 <strong>이 경로만 링크</strong> (프로젝트 내부 <code class="language-plaintext highlighter-rouge">dist/</code>는 개발용)</p>
  </li>
</ol>

<blockquote>
  <p>필요하면 <code class="language-plaintext highlighter-rouge">25_Jobs/REL-YYYY-###_&lt;project&gt;_vX.Y.Z/</code> 형태로 <strong>릴리스 Job</strong> 을 만들어 “체크섬 생성/노트 작성/배포 복사”를 자동화하면 좋아요.</p>
</blockquote>

<hr />

<h1 id="2-개인-설정-보관-골든-설정과-분리">2) 개인 설정 보관 (골든 설정과 분리)</h1>

<h2 id="폴더-추가-1">폴더 추가</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/40_Resources
  /reference/configs/                ← 골든 설정(공유·문서화 대상)
    vscode/ ruff/ pytest/ jupyter/ … 
  /personal/configs/                 ← 내 PC/취향/비밀 경로(비공유)
    /os/                             ← os별 설정
      mac/  win/  linux/
    /shell/                          ← bash/zsh/powershell 프로필
      bash/ zsh/ powershell/
    /editors/                        ← VSCode, PyCharm 사용자 설정
      vscode/settings.user.json
      vscode/keybindings.user.json
    /git/                            ← .gitconfig.local 등
    /python/                         ← pip.conf, poetry.toml, pypirc
    /tools/                          ← 각종 툴 개인 프리셋
    /secrets/README.md               ← (실제 비밀은 두지 말고 안내만)
    .gitignore                       ← 개인/민감 파일 커밋 방지
</code></pre></div></div>

<h3 id="레이어링권장-패턴">레이어링(권장 패턴)</h3>

<ul>
  <li>
    <p><strong>골든(Base)</strong> : <code class="language-plaintext highlighter-rouge">/40_Resources/reference/configs/...</code></p>
  </li>
  <li>
    <p><strong>개인(Override)</strong> : <code class="language-plaintext highlighter-rouge">/40_Resources/personal/configs/...</code></p>
  </li>
  <li>
    <p>로직/도구에서는 <code class="language-plaintext highlighter-rouge">base + personal</code>을 <strong>겹쳐 읽기</strong>(있으면 개인이 우선).</p>

    <ul>
      <li>
        <p>예: <code class="language-plaintext highlighter-rouge">config.yml</code> + <code class="language-plaintext highlighter-rouge">config.local.yml</code></p>
      </li>
      <li>
        <p>VSCode: <code class="language-plaintext highlighter-rouge">settings.json</code>(골든) + <code class="language-plaintext highlighter-rouge">settings.user.json</code>(개인)</p>
      </li>
    </ul>
  </li>
</ul>

<h3 id="안전편의-팁">안전/편의 팁</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">personal/configs/.gitignore</code>에 <code class="language-plaintext highlighter-rouge">*.local</code>, <code class="language-plaintext highlighter-rouge">secrets/*</code>, <code class="language-plaintext highlighter-rouge">*.key</code>, <code class="language-plaintext highlighter-rouge">*.pem</code>, <code class="language-plaintext highlighter-rouge">*.p12</code>, <code class="language-plaintext highlighter-rouge">id_*</code>, <code class="language-plaintext highlighter-rouge">*token*</code>, <code class="language-plaintext highlighter-rouge">.env*</code> 등 <strong>광범위 차단</strong></p>
  </li>
  <li>
    <p>진짜 비밀값은 저장하지 말고 <strong>예시만</strong>(e.g. <code class="language-plaintext highlighter-rouge">.env.example</code>) 남기기</p>
  </li>
  <li>
    <p>홈 디렉터리와 <strong>심볼릭 링크</strong> 로 연결하는 부트스트랩 스크립트를 <code class="language-plaintext highlighter-rouge">80_Tools/scripts/bootstrap_*</code>에 둬도 좋음</p>

    <ul>
      <li>예: <code class="language-plaintext highlighter-rouge">ln -s /Work/40_Resources/personal/configs/shell/zsh/.zshrc ~/.zshrc</code></li>
    </ul>
  </li>
</ul>

<hr />

<h1 id="빠른-요약한-줄씩">빠른 요약(한 줄씩)</h1>

<ul>
  <li>
    <p><strong>배포</strong> 는 <code class="language-plaintext highlighter-rouge">/75_Releases/&lt;project&gt;/vX.Y.Z/</code>에 버전/체크섬/문서까지 <strong>원스톱 정리</strong> , <code class="language-plaintext highlighter-rouge">latest/</code>로 최신 포인터 제공.</p>
  </li>
  <li>
    <p><strong>설정</strong> 은 “공유 가능한 골든”은 <code class="language-plaintext highlighter-rouge">/40_Resources/reference/configs/</code>, “내 취향/개인/민감”은 <code class="language-plaintext highlighter-rouge">/40_Resources/personal/configs/</code>로 <strong>이원화</strong> 하고, 툴은 <strong>개인 설정을 덮어쓰기 레이어</strong> 로 읽게 설계.</p>
  </li>
</ul>

<p>원하면 위 구조를 네 현재 스타터에 <strong>실제 폴더/샘플 파일까지 추가한 압축본</strong> 으로 바로 만들어 줄게.</p>

<p class="chat--user">

이제 마지막으로 지금까지의 모든 내용을 정리하자. 1. 최종 폴더 구조(각 폴더에 대한 설명과 예시 구조와 함께) 2. 주요 업무 flow

</p>

<p>좋아—지금까지 만든 걸 한 번에 보기 좋게 정리했어.<br />
필요하면 바로 복붙해서 팀 문서/Notion에 넣어도 돼.</p>

<h1 id="1-최종-폴더-구조-설명--예시-하위-구조">1) 최종 폴더 구조 (설명 + 예시 하위 구조)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/                                - 1인 개발용 작업 루트
  00_Inbox/                          - 급히 던져두는 임시함(매일 비우기)
  10_Today/                          - 오늘 집중 작업(WIP), 끝나면 제자리 이동

  20_Projects/                       - 툴(파이썬 패키지) 개발 공간
    PRJ-YYYY-NNN_name/               - 단일 프로젝트(패키지) 단위 (예: PRJ-2025-001_sample_app)
      src/&lt;package_name&gt;/            - 패키지 소스(예: sample_app/)
      tests/                         - pytest 테스트
      scripts/                       - install/run/build/lint/test 스크립트(.sh/.ps1)
      examples/                      - 배포용 예제 모음
        data/                        - 공개 가능한 소형 샘플 데이터
        scripts/                     - run_*.py 예제 스크립트
        docs/                        - 예제 설명 및 기대 출력
      issues/                        - 버그/개선 이슈 노트(예: BUG-2025-001/)
      .devcontainer/                 - 컨테이너 개발환경 설정
      docs/                          - 프로젝트 문서(설계/ADR/가이드)
      pyproject.toml                 - 메타/의존성/엔트리포인트
      .gitignore, .editorconfig, README.md

  25_Jobs/                           - 툴을 사용해 만드는 “산출물 작업 단위”
    JOB-YYYY-NNN_name/               - 일반 산출 Job(입력→설정→실행→산출)
      01_Brief/                      - 요구사항/검수기준/마감
      02_Input/
        raw/                         - 원천 데이터
      03_Config/                     - 파라미터(yml/json)
      04_Run/                        - run.sh/ps1, run.py, 로그
      05_Output/                     - 중간/최종 산출물(작업용)
      06_Export/                     - 전달본(최종 산출물)
      90_Archive/                    - 완료 후 보관
    BUG-YYYY-NNN_name/               - 배포 버그 재현/증거/수정 검증 Job
      01_Report/                     - 제보 내용, 환경, 기대/실제
      02_Repro/input/                - 재현 입력
      03_Config/                     - 재현 파라미터
      04_Run/                        - repro.py + 스크립트, repro_log.txt
      05_Evidence/logs/              - 콘솔/크래시 로그·스크린샷·체크섬
      06_FixValidation/              - 패치 검증 케이스
    EX-YYYY-NNN_name/                - “툴 예제” 산출 Job(패키징 목적)
    SMOKE-YYYY-NNN_tool/             - 새 툴 설치 후 스모크/feasibility 테스트
      01_Brief/                      - 성공 기준 정의
      03_Config/                     - commands.txt: 테스트 명령 목록
      04_Run/                        - smoke.sh/ps1로 일괄 실행
      06_Export/                     - 결과 요약(result.txt 등)

  30_Areas/                          - 지속 업무(Projects와 달리 계속 유지)
    worklog/YYYY/YY-MM/날짜.md       - 일일/주간 작업 로그(5줄 요약 권장)
    environments/                    - 공통 환경 메모/전략
    kb/                              - knowledge base(지식 베이스)
      tips/                          - 단문 팁(예: python.md, regex.md)
      cheatsheets/                   - 한 장 요약
      howtos/                        - 절차형 가이드

  31_Labs/                           - 실험실(가벼운 테스트/실습)
    jupyter/                         - 스크래치 노트북(예: regex_scratch.ipynb)

  40_Resources/                      - 참고 자료(교육/레퍼런스/설정/매뉴얼)
    edu/                             - 교육·논문·튜토리얼
      courses/                       - 강의/코스 자료
      tutorials/                     - 튜토리얼 모음
      papers/                        - 논문 관리
        to_read/                     - 읽을 논문 PDF
        reading_notes/               - 메모(YYYY-MM-DD_제목.md, TEMPLATE.md)
        summaries/                   - 1~2 페이지 요약
    reference/                       - “골든” 공용 설정(공유/문서화 대상)
      configs/                       - 표준 설정 모음
        vscode/ ruff/ pytest/ pyinstaller/ pyside6/ jupyter/
    personal/                        - 개인 설정(내 PC/취향/비공개)
      configs/
        os/{mac,win,linux}/          - OS별 설정
        shell/{bash,zsh,powershell}/ - 쉘 프로필
        editors/vscode/              - settings.user.json, keybindings.user.json
        git/                         - .gitconfig.local 등
        python/                      - pip.conf, poetry.toml, pypirc
        tools/                       - 각종 도구 개인 프리셋
        secrets/README.md            - (실제 비밀은 두지 않음)
        .gitignore                   - *.local, secrets/* 등 광범위 차단
    manuals/                         - 매뉴얼/가이드(PDF/HTML/MD)
      &lt;vendor&gt;/&lt;product&gt;/&lt;version&gt;/  - 버전별 정리

  50_Snippets/                       - 재사용 코드/문구
    sql/ text/ bash/

  60_Assets/                         - 로고/폰트/템플릿 등 공용 리소스

  70_Exports/                        - 여러 Job의 “최종 전달본” 모아보기(옵션)

  75_Releases/                       - 유저 배포 전용 중앙 보관소
    &lt;project_slug&gt;/                  - 예: sample-app
      vX.Y.Z/                        - 버전별 폴더
        installers/                  - .exe/.msi/.pkg/.dmg 등
        wheels/                      - Python wheel(s)
        portable/                    - 포터블/압축본
        docs/                        - 설치 가이드, README, FAQ
        licenses/                    - LICENSE, ThirdPartyNotices.txt
        checksums/                   - *.sha256 (무결성 확인)
        ReleaseNotes.md              - 릴리스 노트
      latest/                        - 최신 버전(심볼릭 링크 또는 복사)
    catalog.json                     - (선택) 버전/파일 인덱스

  80_Tools/                          - 툴 설치/포터블/자동화
    installers/                      - 오프라인 설치 파일, install_notes.md
    bin/                             - 포터블 실행파일
    scripts/                         - 설치/유틸/부트스트랩 스크립트
    devcontainer/                    - 개발 컨테이너 관련

  85_Environments/                   - 개발 환경 예시
    conda/environment.yml
    venv/README.md
    docker/Dockerfile

  99_Archive/                        - 완료 프로젝트/Job/자료 보관
</code></pre></div></div>

<h3 id="네이밍--버전-규칙요약">네이밍 &amp; 버전 규칙(요약)</h3>

<ul>
  <li>
    <p><strong>프로젝트 폴더</strong> : <code class="language-plaintext highlighter-rouge">PRJ-연도-번호_짧은이름</code> (예: <code class="language-plaintext highlighter-rouge">PRJ-2025-012_GUI툴</code>)</p>
  </li>
  <li>
    <p><strong>Job 폴더</strong> : <code class="language-plaintext highlighter-rouge">JOB/BUG/EX/SMOKE-연도-번호_이름</code></p>
  </li>
  <li>
    <p><strong>파일</strong> : <code class="language-plaintext highlighter-rouge">YYYY-MM-DD_제목_v001.ext</code> (최종본 금지, 버전 증가)</p>
  </li>
  <li>
    <p><strong>깊이</strong> : 최대 3단</p>
  </li>
  <li>
    <p><strong>설정 레이어링</strong> : <code class="language-plaintext highlighter-rouge">reference/configs</code>(공용 골든) + <code class="language-plaintext highlighter-rouge">personal/configs</code>(내 오버라이드)</p>
  </li>
</ul>

<hr />

<h1 id="2-주요-업무-flow-핵심-단계별">2) 주요 업무 Flow (핵심 단계별)</h1>

<h2 id="a-툴파이썬-패키지-개발--릴리스">A. 툴(파이썬 패키지) 개발 → 릴리스</h2>

<ol>
  <li>
    <p><strong>프로젝트 생성/진행</strong> : <code class="language-plaintext highlighter-rouge">20_Projects/PRJ-...</code></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">./scripts/install.(sh|ps1)</code>로 venv + dev 의존성 설치</p>
      </li>
      <li>
        <p>기능 추가 → <code class="language-plaintext highlighter-rouge">tests/</code>에 단위 테스트, <code class="language-plaintext highlighter-rouge">ruff</code>로 린트</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>실행파일 빌드(옵션)</strong> : <code class="language-plaintext highlighter-rouge">./scripts/build_cli.sh</code> / <code class="language-plaintext highlighter-rouge">build_gui.sh</code></p>
  </li>
  <li>
    <p><strong>릴리스 산출 정리</strong> : QA 통과 후 <code class="language-plaintext highlighter-rouge">75_Releases/&lt;project&gt;/vX.Y.Z/</code>에</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">installers/</code>, <code class="language-plaintext highlighter-rouge">wheels/</code>, <code class="language-plaintext highlighter-rouge">portable/</code> + <code class="language-plaintext highlighter-rouge">docs/</code>, <code class="language-plaintext highlighter-rouge">licenses/</code>, <code class="language-plaintext highlighter-rouge">checksums/*.sha256</code></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">ReleaseNotes.md</code> 작성, <code class="language-plaintext highlighter-rouge">latest/</code> 갱신</p>
      </li>
      <li>
        <p>(선택) <code class="language-plaintext highlighter-rouge">25_Jobs/REL-YYYY-###_...</code>로 릴리스 자동화 Job 운영</p>
      </li>
    </ul>
  </li>
</ol>

<h2 id="b-실제-산출물-만들기도구-사용--결과-전달">B. 실제 산출물 만들기(도구 사용 → 결과 전달)</h2>

<ol>
  <li>
    <p><strong>Job 생성</strong> : <code class="language-plaintext highlighter-rouge">25_Jobs/JOB-YYYY-###_이름</code> 복제</p>
  </li>
  <li>
    <p><strong>입력/설정</strong> : <code class="language-plaintext highlighter-rouge">02_Input/raw/</code>에 데이터, <code class="language-plaintext highlighter-rouge">03_Config/config.yml</code> 작성</p>
  </li>
  <li>
    <p><strong>실행</strong> : <code class="language-plaintext highlighter-rouge">04_Run/run.sh|ps1</code> → 결과 <code class="language-plaintext highlighter-rouge">06_Export/</code>, 로그·매니페스트 자동 생성</p>
  </li>
  <li>
    <p><strong>검수/전달</strong> : <code class="language-plaintext highlighter-rouge">qa_checklist.md</code> 확인 → 필요 시 <code class="language-plaintext highlighter-rouge">70_Exports/</code>에 모아두기</p>
  </li>
  <li>
    <p><strong>재현성 확보</strong> : 매니페스트에 <strong>툴 버전/파라미터/OS/Python/체크섬</strong> 기록</p>
  </li>
</ol>

<h2 id="c-배포-버그-제보--디버깅--수정-검증">C. 배포 버그 제보 → 디버깅 → 수정 검증</h2>

<ol>
  <li>
    <p><strong>수집/정리</strong> : <code class="language-plaintext highlighter-rouge">25_Jobs/BUG-YYYY-###_.../01_Report/</code>에 제보·환경·재현 절차 기록</p>
  </li>
  <li>
    <p><strong>재현 세팅</strong> : <code class="language-plaintext highlighter-rouge">02_Repro/input/</code>, <code class="language-plaintext highlighter-rouge">03_Config/</code> 구성 → <code class="language-plaintext highlighter-rouge">04_Run/repro.py</code> 실행</p>
  </li>
  <li>
    <p><strong>증거 수집</strong> : <code class="language-plaintext highlighter-rouge">05_Evidence/logs/</code>에 로그·덤프·스크린샷·체크섬</p>
  </li>
  <li>
    <p><strong>코드 작업</strong> : <code class="language-plaintext highlighter-rouge">20_Projects/.../issues/BUG-.../triage.md</code> → 원인/수정 방향</p>
  </li>
  <li>
    <p><strong>검증</strong> : <code class="language-plaintext highlighter-rouge">06_FixValidation/</code> 시나리오 통과 후 패치 릴리스(Flow A로 연결)</p>
  </li>
</ol>

<h2 id="d-배포-예제example-제작">D. 배포 예제(example) 제작</h2>

<ol>
  <li>
    <p><strong>프로젝트 내</strong> <code class="language-plaintext highlighter-rouge">examples/{data,scripts,docs}</code>에 <strong>최소 실행 예제</strong> 작성</p>
  </li>
  <li>
    <p>(선택) 패키징/전달용이면 <code class="language-plaintext highlighter-rouge">25_Jobs/EX-YYYY-###_...</code>로 Job 화 → 재현/전달 관리</p>
  </li>
</ol>

<h2 id="e-새로-설치한-툴-스모크feasibility-테스트">E. 새로 설치한 툴 스모크/feasibility 테스트</h2>

<ol>
  <li>
    <p><strong>Job 생성</strong> : <code class="language-plaintext highlighter-rouge">25_Jobs/SMOKE-YYYY-###_tool/</code></p>
  </li>
  <li>
    <p><strong>명령 정의</strong> : <code class="language-plaintext highlighter-rouge">03_Config/commands.txt</code>(예: <code class="language-plaintext highlighter-rouge">tool --version</code>)</p>
  </li>
  <li>
    <p><strong>실행</strong> : <code class="language-plaintext highlighter-rouge">04_Run/smoke.sh|ps1</code> → <code class="language-plaintext highlighter-rouge">06_Export/result.txt</code></p>
  </li>
  <li>
    <p><strong>판정</strong> : 성공 기준(시간/종료코드/출력) 충족 확인</p>
  </li>
</ol>

<h2 id="f-빠른-실험정규표현식파이썬-문법-등">F. 빠른 실험(정규표현식·파이썬 문법 등)</h2>

<ol>
  <li>
    <p><strong>스크래치</strong> : <code class="language-plaintext highlighter-rouge">31_Labs/jupyter/regex_scratch.ipynb</code> 등에서 <strong>작게</strong> 실험</p>
  </li>
  <li>
    <p><strong>지식화</strong> : 유효한 내용은 <code class="language-plaintext highlighter-rouge">30_Areas/kb/{tips,cheatsheets,howtos}</code>로 승격 정리</p>
  </li>
</ol>

<h2 id="g-지식설정-자산화골든-vs-개인">G. 지식/설정 자산화(골든 vs 개인)</h2>

<ul>
  <li>
    <p><strong>골든 설정</strong> : <code class="language-plaintext highlighter-rouge">40_Resources/reference/configs/</code>에서 <strong>공유 가능한 표준</strong> 을 관리</p>
  </li>
  <li>
    <p><strong>개인 설정</strong> : <code class="language-plaintext highlighter-rouge">40_Resources/personal/configs/</code>에 내 취향/PC별 설정 저장</p>
  </li>
  <li>
    <p><strong>레이어링 원칙</strong> : 도구가 <code class="language-plaintext highlighter-rouge">base(골든) + personal(오버라이드)</code>를 함께 읽도록 설계</p>
  </li>
  <li>
    <p><strong>부트스트랩</strong> : <code class="language-plaintext highlighter-rouge">80_Tools/scripts/</code>에 심볼릭 링크/복사 스크립트 두고 환경 신속 반영</p>
  </li>
</ul>

<h2 id="h-매뉴얼레퍼런스교육자료-관리">H. 매뉴얼/레퍼런스/교육자료 관리</h2>

<ul>
  <li>
    <p><strong>논문/교육</strong> : <code class="language-plaintext highlighter-rouge">40_Resources/edu/</code>에서 <code class="language-plaintext highlighter-rouge">to_read → reading_notes → summaries</code> 흐름</p>
  </li>
  <li>
    <p><strong>매뉴얼</strong> : <code class="language-plaintext highlighter-rouge">40_Resources/manuals/&lt;vendor&gt;/&lt;product&gt;/&lt;version&gt;/</code>에 버전별 정리</p>
  </li>
  <li>
    <p><strong>공통 참조 리소스</strong> : <code class="language-plaintext highlighter-rouge">40_Resources/reference/</code>(골든)와 <code class="language-plaintext highlighter-rouge">personal/</code>(개인)를 구분</p>
  </li>
</ul>

<h2 id="i-일상-운영-루틴">I. 일상 운영 루틴</h2>

<ul>
  <li>
    <p><strong>매일</strong> : 캡처는 <code class="language-plaintext highlighter-rouge">00_Inbox</code> → 당일 작업은 <code class="language-plaintext highlighter-rouge">10_Today</code>에서 처리 → 제자리 이동</p>
  </li>
  <li>
    <p><strong>주 1회</strong> : <code class="language-plaintext highlighter-rouge">00_Inbox</code> 비우기, 완료 Job/Project는 <code class="language-plaintext highlighter-rouge">99_Archive</code>로 이동, <code class="language-plaintext highlighter-rouge">70_Exports</code> 정리</p>
  </li>
  <li>
    <p><strong>월 1회</strong> : <code class="language-plaintext highlighter-rouge">40_Resources/edu</code>/<code class="language-plaintext highlighter-rouge">kb</code> 정리, 불용 자료 아카이브</p>
  </li>
</ul>

<hr />

<p>필요하면 네 환경/도메인(예: 영상·리포트·CAD) 기준으로 <strong>Job 템플릿의 QA 체크리스트/파일명 규격/파라미터 스키마</strong> 를 더 촘촘히 커스터마이즈해서 바로 쓸 버전으로 만들어줄게.</p>

<p class="chat--user">

근데 31_Labs랑 25_Jobs/SMOKE*랑 역할이 겹치진 않나?

</p>

<p>좋은 질문! 둘이 살짝 겹쳐 보이지만 <strong>목적·형식·보존성</strong> 이 다릅니다. 아래처럼 쓰면 깔끔해요.</p>

<h2 id="결론-먼저">결론 먼저</h2>

<ul>
  <li>
    <p><strong>31<em>Labs** = _개인용 스크래치 공간</em>. 빨리 시도하고 버려도 되는 **짧은 실험</strong>(regex, 파이썬 문법, 라이브러리 API 감 잡기).</p>
  </li>
  <li>
    <p><strong>25<em>Jobs/SMOKE-** * = _재현 가능한 점검 공간</em>. **새로 설치한 툴의 동작 확인/feasibility</strong> 를 <strong>증거와 함께</strong> 남기는 <strong>공식 스모크 테스트</strong>.</p>
  </li>
</ul>

<hr />

<h2 id="언제-어디에-결정-규칙">언제 어디에? (결정 규칙)</h2>

<ol>
  <li>
    <p><strong>5분/50줄 규칙</strong></p>

    <ul>
      <li>
        <p>5분 내, 50줄 이하의 즉흥 테스트 → <strong>31_Labs</strong></p>
      </li>
      <li>
        <p>설치·환경 의존, 통과 기준/로그/결과를 남겨야 함 → <strong>SMOKE Job</strong></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>재현 필요? 공유 필요?</strong></p>

    <ul>
      <li>
        <p>“나만 잠깐 확인” → <strong>31_Labs</strong></p>
      </li>
      <li>
        <p>“나중에 또 돌리거나 증빙/비교 필요” → <strong>SMOKE Job</strong></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>입력/설정/출력 구조가 필요?</strong></p>

    <ul>
      <li>
        <p>필요 없음(메모성/코드 조각) → <strong>31_Labs</strong></p>
      </li>
      <li>
        <p>필요 있음(명령 목록, 로그, 결과물, 매니페스트) → <strong>SMOKE Job</strong></p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="역할-차이-한눈에">역할 차이 한눈에</h2>

<table>
  <thead>
    <tr>
      <th>구분</th>
      <th>31_Labs</th>
      <th>25_Jobs/SMOKE-*</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>목적</td>
      <td>빠른 실험, 개념 확인</td>
      <td>설치 검증/feasibility, 재현/증빙</td>
    </tr>
    <tr>
      <td>형식</td>
      <td>자유(노트북/스크립트)</td>
      <td>정형(입력·설정·실행·결과 폴더)</td>
    </tr>
    <tr>
      <td>결과</td>
      <td>버려도 됨, 요약만 kb로 승격</td>
      <td>로그/결과/체크섬·통과기준 보존</td>
    </tr>
    <tr>
      <td>공유성</td>
      <td>개인 중심</td>
      <td>공유·재사용 전제</td>
    </tr>
    <tr>
      <td>예</td>
      <td>regex 패턴, pandas 한 줄 테스트</td>
      <td><code class="language-plaintext highlighter-rouge">tool --version</code>·샘플 실행·성능 스냅샷</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="충돌중복을-피하는-운용-룰">충돌/중복을 피하는 운용 룰</h2>

<ul>
  <li>
    <p><strong>프로모션 사다리</strong> : 31_Labs에서 시작 → “재현/공유 필요” 판단되면 <strong>SMOKE Job으로 승격</strong></p>

    <ol>
      <li>
        <p><code class="language-plaintext highlighter-rouge">25_Jobs/SMOKE-YYYY-###_&lt;tool&gt;/</code> 생성</p>
      </li>
      <li>
        <p>Labs에서 확인한 명령들을 <code class="language-plaintext highlighter-rouge">03_Config/commands.txt</code>로 옮김</p>
      </li>
      <li>
        <p>기대 출력/성공 기준을 <code class="language-plaintext highlighter-rouge">01_Brief/brief.md</code>에 명시</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">04_Run/smoke.sh|ps1</code> 실행 → <code class="language-plaintext highlighter-rouge">06_Export/result.txt</code>와 로그로 증빙</p>
      </li>
    </ol>
  </li>
  <li>
    <p><strong>보존 정책</strong> : 31_Labs 산출물은 <strong>7일 이내</strong> 에</p>

    <ul>
      <li>
        <p>지식은 <code class="language-plaintext highlighter-rouge">30_Areas/kb/{tips, cheatsheets, howtos}</code>로</p>
      </li>
      <li>
        <p>재현 테스트는 <strong>SMOKE Job</strong> 으로</p>
      </li>
      <li>
        <p>나머지는 삭제/아카이브</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>네이밍</strong> :</p>

    <ul>
      <li>
        <p>Labs 노트북: <code class="language-plaintext highlighter-rouge">YYYY-MM-DD_topic.ipynb</code></p>
      </li>
      <li>
        <p>SMOKE Job: <code class="language-plaintext highlighter-rouge">SMOKE-YYYY-###_&lt;tool&gt;</code> + 결과 파일 <code class="language-plaintext highlighter-rouge">result.txt</code>, 로그 <code class="language-plaintext highlighter-rouge">run_log.txt</code></p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="폴더-배치최종-권장">폴더 배치(최종 권장)</h2>

<ul>
  <li>
    <p><strong>31_Labs/jupyter/</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">regex_scratch.ipynb</code> (짧은 패턴/문법 테스트)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">proto_*.ipynb</code> (짧은 실험들)</p>
      </li>
    </ul>
  </li>
  <li>
    <p>**25<em>Jobs/SMOKE-YYYY-###</em> <tool>/**</tool></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">01_Brief/</code> (성공 기준)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">03_Config/commands.txt</code> (검증 명령 리스트)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">04_Run/smoke.sh|ps1</code> (일괄 실행)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">06_Export/result.txt</code> + 로그/매니페스트(증빙)</p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="예시-시나리오">예시 시나리오</h2>

<ul>
  <li>
    <p><strong>“ffmpeg 새 버전 깔았는데 옵션 잘 먹나?”</strong></p>

    <ul>
      <li>Labs에서 옵션 한두 개 <strong>즉석 확인</strong> → 정상이라도 <strong>SMOKE Job</strong> 으로 승격해 <code class="language-plaintext highlighter-rouge">ffmpeg -version</code>, 샘플 변환 1건, 처리시간, 출력 해시까지 기록.</li>
    </ul>
  </li>
  <li>
    <p><strong>“정규식 lookbehind 기억 안 나네?”</strong></p>

    <ul>
      <li><strong>Labs 노트북</strong> 에서 바로 테스트 → 유용한 패턴은 <code class="language-plaintext highlighter-rouge">kb/regex.md</code>에 추가.</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="미니멀을-원한다면">미니멀을 원한다면</h2>

<ul>
  <li>
    <p>31_Labs를 <strong>완전히 없애고</strong> 모든 검증을 SMOKE로만 해도 됩니다. 다만 초기 탐색 속도는 떨어져요.</p>
  </li>
  <li>
    <p>반대로 간단히 하고 싶다면, “설치 검증/증빙이 필요한 것만 SMOKE, 나머지는 Labs”로 유지하는 게 보통 가장 효율적입니다.</p>
  </li>
</ul>

<p>원하면 <strong>Labs→SMOKE 자동 승격 스크립트</strong>(노트북 코드 블록을 <code class="language-plaintext highlighter-rouge">commands.txt</code>로 변환, Job 스켈레톤 생성)도 만들어 줄게.</p>

<p class="chat--user">

kb 대신 한국인이 쉽게 이해할만한 쉬운 단어 추천해주고, 폴더 구조 다시 한 번 자세히 설명해줘. 몇몇 라인에 대한 설명이 빠져 있는것 같아

</p>

<p>좋은 포인트! 먼저 <strong>kb</strong> 대체어부터 정리하고, 그다음 <strong>폴더 구조를 한 줄도 빠짐없이 상세 설명</strong> 으로 다시 써줄게.</p>

<h2 id="kb-대체어한국어">kb 대체어(한국어)</h2>

<ul>
  <li>
    <p>1순위 추천: <strong>노하우</strong> — 가장 직관적이고 짧음</p>
  </li>
  <li>
    <p>대안: <strong>지식창고</strong> , <strong>메모모음</strong> , <strong>가이드북</strong><br />
→ 아래 구조에서는 <code class="language-plaintext highlighter-rouge">30_Areas/kb</code>를 <strong><code class="language-plaintext highlighter-rouge">30_Areas/노하우</code></strong>로 바꿔서 표기할게.</p>
  </li>
</ul>

<hr />

<h2 id="최종-폴더-구조-설명--예시-하위-구조-포함">최종 폴더 구조 (설명 + 예시 하위 구조 포함)</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/                                - 1인 개발용 작업 루트(모든 업무의 최고 루트)
  00_Inbox/                          - 급히 던져두는 임시함(매일/주 1회 비우기)
  10_Today/                          - 오늘 집중 작업(WIP) 임시 거점(끝나면 제자리로 이동)

  20_Projects/                       - 툴(파이썬 패키지) 개발 공간(코드 수명 중심)
    PRJ-YYYY-NNN_name/               - 개별 프로젝트(예: PRJ-2025-001_sample_app)
      src/&lt;package_name&gt;/            - 패키지 소스(예: sample_app/)
      tests/                         - pytest 테스트 케이스
      scripts/                       - install/run/build/lint/test 스크립트(.sh/.ps1)
      examples/                      - 배포용 예제(최소 실행 가능 샘플)
        data/                        - 공개 가능한 소형 샘플 데이터
        scripts/                     - run_*.py 예제 스크립트
        docs/                        - 예제 설명·기대 출력
      issues/                        - 버그/개선 이슈 노트(예: BUG-2025-001/)
      docs/                          - 설계 문서/ADR/가이드
      .devcontainer/                 - 컨테이너 개발환경(devcontainer.json 등)
      pyproject.toml                 - 메타/의존성/엔트리포인트(PEP 621)
      .gitignore, .editorconfig, README.md - 개발 편의·개요

  25_Jobs/                           - 툴을 사용해 만드는 “산출물 작업 단위”(프로세스 중심)
    JOB-YYYY-NNN_name/               - 일반 산출 Job(입력→설정→실행→산출)
      01_Brief/                      - 요구사항/수락 기준/마감 명시
      02_Input/
        raw/                         - 원천 데이터(읽기 전용 보관)
      03_Config/                     - 파라미터(yml/json), 실행 설정
      04_Run/                        - run.sh|ps1, run.py, 실행 로그
      05_Output/                     - 중간/최종 산출물(작업 영역)
      06_Export/                     - 전달본(최종 산출물)
      90_Archive/                    - 완료 후 장기 보관
    BUG-YYYY-NNN_name/               - 배포 버그 재현/증거/수정 검증 Job
      01_Report/                     - 제보 내용·환경·기대/실제 기록
      02_Repro/input/                - 재현에 필요한 입력 샘플
      03_Config/                     - 재현 파라미터·플래그
      04_Run/                        - repro.py + 스크립트, repro_log.txt
      05_Evidence/logs/              - 콘솔/크래시 로그·스크린샷·체크섬
      06_FixValidation/              - 패치 검증 시나리오/결과
    EX-YYYY-NNN_name/                - “툴 예제”를 패키징·배포하기 위한 Job(선택)
    SMOKE-YYYY-NNN_tool/             - 새 툴 설치 후 스모크/feasibility 테스트
      01_Brief/                      - 성공 기준(시간·종료코드·출력) 정의
      03_Config/                     - commands.txt: 검증 명령 목록
      04_Run/                        - smoke.sh|ps1로 일괄 실행(로그 남김)
      06_Export/                     - 결과 요약(result.txt 등)

  30_Areas/                          - 지속 업무(장기 유지되는 영역)
    worklog/YYYY/YY-MM/날짜.md       - 일일/주간 작업 로그(5줄 요약 권장)
    environments/                    - 공통 환경 메모/전략(예: Python 버전 정책)
    노하우/                          - Knowledge Base(축적형 지식, ‘kb’ 대체)
      팁/                             - 단문 팁(예: python.md, regex.md)
      요약표/                         - 한 장짜리 치트시트
      가이드/                         - 절차형 How-to(설치/배포/디버깅 절차)

  31_Labs/                           - 실험실(짧은 테스트/프로토타입; 재현 불필수)
    jupyter/                         - 스크래치 노트북(예: regex_scratch.ipynb)

  40_Resources/                      - 참고 자료(교육/레퍼런스/설정/매뉴얼)
    edu/                             - 교육·논문·튜토리얼
      courses/                       - 강의·코스 자료(슬라이드/노트)
      tutorials/                     - 튜토리얼 모음(링크/코드)
      papers/                        - 논문 관리(읽기→메모→요약 흐름)
        to_read/                     - 읽을 논문 PDF
        reading_notes/               - 메모(YYYY-MM-DD_제목.md, TEMPLATE.md 포함)
        summaries/                   - 1~2페이지 요약본
    reference/                       - “골든” 공용 설정(공유·문서화 대상)
      configs/                       - 표준 설정 모음(프로젝트에서 재사용)
        vscode/ ruff/ pytest/ pyinstaller/ pyside6/ jupyter/ - 도구별 샘플
    personal/                        - 개인 설정(내 PC/취향/비공개)
      configs/
        os/{mac,win,linux}/          - OS별 설정(예: 키보드/언어)
        shell/{bash,zsh,powershell}/ - 쉘 프로필(.zshrc/.bashrc 등)
        editors/vscode/              - settings.user.json, keybindings.user.json
        git/                         - .gitconfig.local 등
        python/                      - pip.conf, poetry.toml, pypirc
        tools/                       - 각종 도구 개인 프리셋
        secrets/README.md            - (실제 비밀은 두지 말고 안내만)
        .gitignore                   - *.local, secrets/*, *.pem 등 광범위 차단
    manuals/                         - 매뉴얼/가이드(PDF/HTML/MD)
      &lt;vendor&gt;/&lt;product&gt;/&lt;version&gt;/  - 벤더/제품/버전별 정리

  50_Snippets/                       - 재사용 코드·문구 조각
    sql/ text/ bash/                 - 카테고리별 스니펫

  60_Assets/                         - 로고/폰트/템플릿·브랜딩 리소스

  70_Exports/                        - 여러 Job의 “최종 전달본” 뷰(모아보기; 선택)

  75_Releases/                       - 유저 배포 전용 중앙 보관소(버전별)
    &lt;project_slug&gt;/                  - 예: sample-app
      vX.Y.Z/                        - 특정 버전 릴리스
        installers/                  - .exe/.msi/.pkg/.dmg 등 설치 프로그램
        wheels/                      - Python wheel(s)
        portable/                    - 포터블/압축 패키지
        docs/                        - README/설치 가이드/FAQ
        licenses/                    - LICENSE/ThirdPartyNotices.txt
        checksums/                   - *.sha256(무결성 검증용)
        ReleaseNotes.md              - 릴리스 노트(변경 사항)
      latest/                        - 최신 버전 포인터(심볼릭 링크/복사)
    catalog.json                     - (선택) 버전·파일 인덱스

  80_Tools/                          - 툴 설치/포터블/자동화 스크립트
    installers/                      - 오프라인 설치 파일 + install_notes.md
    bin/                             - 포터블 실행 파일(로컬 PATH로 연결 가능)
    scripts/                         - 설치·부트스트랩·유틸 스크립트
    devcontainer/                    - 개발 컨테이너 도구(공유 템플릿)

  85_Environments/                   - 개발 환경 예시(고정·재현 목적)
    conda/environment.yml            - conda 환경 정의
    venv/README.md                   - 표준 venv 사용 가이드
    docker/Dockerfile                - 개발 컨테이너 베이스 이미지

  99_Archive/                        - 완료 Project/Job/자료 장기 보관(읽기 전용)
</code></pre></div></div>

<hr />

<h3 id="네이밍운용-규칙요약">네이밍·운용 규칙(요약)</h3>

<ul>
  <li>
    <p><strong>프로젝트 폴더</strong> : <code class="language-plaintext highlighter-rouge">PRJ-연도-번호_짧은이름</code> (예: <code class="language-plaintext highlighter-rouge">PRJ-2025-012_GUI툴</code>)</p>
  </li>
  <li>
    <p><strong>Job 폴더</strong> : <code class="language-plaintext highlighter-rouge">JOB/BUG/EX/SMOKE-연도-번호_이름</code></p>
  </li>
  <li>
    <p><strong>파일명</strong> : <code class="language-plaintext highlighter-rouge">YYYY-MM-DD_제목_v001.ext</code> (최종본 대신 버전 넘김)</p>
  </li>
  <li>
    <p><strong>깊이 제한</strong> : 최대 3단(찾기/권한/동기화 이슈 최소화)</p>
  </li>
  <li>
    <p><strong>설정 레이어링</strong> : <code class="language-plaintext highlighter-rouge">reference/configs</code>(골든) + <code class="language-plaintext highlighter-rouge">personal/configs</code>(개인 오버라이드)</p>
  </li>
  <li>
    <p><strong>Labs ↔ SMOKE 경계</strong> : 5분/50줄 규칙—짧은 실험은 <code class="language-plaintext highlighter-rouge">31_Labs</code>, 재현·증빙 필요 시 <code class="language-plaintext highlighter-rouge">SMOKE Job</code>으로 승격</p>
  </li>
</ul>

<p>필요하면 위 구조에서 <strong>노하우 하위 폴더 이름</strong>(예: <code class="language-plaintext highlighter-rouge">팁</code>→<code class="language-plaintext highlighter-rouge">Tip</code>, <code class="language-plaintext highlighter-rouge">요약표</code>→<code class="language-plaintext highlighter-rouge">Cheatsheets</code>)을 영문으로 바꾼 변형판도 같이 정리해 줄게.</p>

<p class="chat--user">

응 영문으로 바꿔줘. 그리고 10_Today는 어떻게 쓰는거야? 내가 작업하는 것을 mv로 여기로 가져와?

</p>

<p>좋아! 요청대로 <strong>한국어 폴더명 → 영어</strong> 로 바꾸고, <strong><code class="language-plaintext highlighter-rouge">10_Today</code>의 실제 운용</strong>도 단계별로 정리해줄게.</p>

<hr />

<h1 id="1-영어로-바꾼-최종-폴더-구조-설명--예시-하위">1) 영어로 바꾼 최종 폴더 구조 (설명 + 예시 하위)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/                                - Solo dev workspace root
  00_Inbox/                          - Quick dump inbox (clear daily/weekly)
  10_Today/                          - Today's focus staging area (WIP dashboard)

  20_Projects/                       - Tool (Python package) development (code lifecycle)
    PRJ-YYYY-NNN_name/               - One project/package (e.g., PRJ-2025-001_sample_app)
      src/&lt;package_name&gt;/            - Package source (e.g., sample_app/)
      tests/                         - Pytest cases
      scripts/                       - install/run/build/lint/test (.sh/.ps1)
      examples/                      - Minimal runnable examples for users
        data/                        - Small public/sample datasets
        scripts/                     - run_*.py example scripts
        docs/                        - Example docs &amp; expected outputs
      issues/                        - Bug/feature notes (e.g., BUG-2025-001/)
      docs/                          - Design docs/ADR/guides
      .devcontainer/                 - Dev container config
      pyproject.toml                 - Metadata/deps/entry points (PEP 621)
      .gitignore, .editorconfig, README.md

  25_Jobs/                           - Real deliverable runs (process lifecycle)
    JOB-YYYY-NNN_name/               - General job (input → config → run → outputs)
      01_Brief/                      - Requirements/acceptance criteria/deadline
      02_Input/
        raw/                         - Source data (read-only)
      03_Config/                     - Params (yml/json) &amp; run settings
      04_Run/                        - run.sh|ps1, run.py, logs
      05_Output/                     - Intermediate/final (working area)
      06_Export/                     - Final deliverables for hand-off
      90_Archive/                    - Long-term storage after completion
    BUG-YYYY-NNN_name/               - Distributed-binary bug repro &amp; fix validation
      01_Report/                     - Report/env/expected vs actual
      02_Repro/input/                - Minimal repro inputs
      03_Config/                     - Repro flags/params
      04_Run/                        - repro.py + scripts, repro_log.txt
      05_Evidence/logs/              - Console/crash logs, screenshots, checksums
      06_FixValidation/              - Post-fix validation scenarios
    EX-YYYY-NNN_name/                - Packaged examples job (optional)
    SMOKE-YYYY-NNN_tool/             - New tool smoke/feasibility tests
      01_Brief/                      - Pass criteria (time/exit-code/output)
      03_Config/                     - commands.txt (test commands)
      04_Run/                        - smoke.sh|ps1 (batch run, logs)
      06_Export/                     - Result summary (result.txt)

  30_Areas/                          - Ongoing areas (long-lived)
    worklog/YYYY/YY-MM/DATE.md       - Daily/weekly 5-line logs
    environments/                    - Common env strategy (e.g., Python policy)
    knowledge_base/                  - Accumulated knowledge (was 'kb/노하우')
      tips/                          - Short tips (e.g., python.md, regex.md)
      cheatsheets/                   - One-pagers
      howtos/                        - Step-by-step guides (install/release/debug)

  31_Labs/                           - Scratch lab (quick experiments; non-repro)
    jupyter/                         - Scratch notebooks (e.g., regex_scratch.ipynb)

  40_Resources/                      - References (education/configs/manuals)
    edu/                             - Courses/tutorials/papers
      courses/                       - Course slides/notes
      tutorials/                     - Tutorial links &amp; code
      papers/                        - Paper flow (to_read → notes → summaries)
        to_read/                     - PDFs queued to read
        reading_notes/               - Notes (YYYY-MM-DD_Title.md, TEMPLATE.md)
        summaries/                   - 1–2 page summaries
    reference/                       - “Golden” shared configs (documented, reusable)
      configs/                       - Standard configs used across projects
        vscode/ ruff/ pytest/ pyinstaller/ pyside6/ jupyter/
    personal/                        - Private/personal configs (override layer)
      configs/
        os/{mac,win,linux}/          - OS-level settings
        shell/{bash,zsh,powershell}/ - Shell profiles
        editors/vscode/              - settings.user.json, keybindings.user.json
        git/                         - .gitconfig.local, etc.
        python/                      - pip.conf, poetry.toml, pypirc
        tools/                       - Personal presets per tool
        secrets/README.md            - (Pointers only; no real secrets)
        .gitignore                   - Broad ignore (e.g., *.local, secrets/*, *.pem)

    manuals/                         - Product manuals (PDF/HTML/MD)
      &lt;vendor&gt;/&lt;product&gt;/&lt;version&gt;/  - Vendor/product/version tree

  50_Snippets/                       - Reusable snippets
    sql/ text/ bash/

  60_Assets/                         - Logos/fonts/templates &amp; brand assets

  70_Exports/                        - Collected final deliverables (across jobs; optional)

  75_Releases/                       - Distribution hub for users (versioned)
    &lt;project_slug&gt;/
      vX.Y.Z/
        installers/                  - .exe/.msi/.pkg/.dmg
        wheels/                      - Python wheels
        portable/                    - Portable/zip packages
        docs/                        - README/install guide/FAQ
        licenses/                    - LICENSE/ThirdParty notices
        checksums/                   - *.sha256 (integrity)
        ReleaseNotes.md              - Changelog per release
      latest/                        - Pointer to current version
    catalog.json                     - (Optional) index of versions/files

  80_Tools/                          - Installers/portable/tools automation
    installers/                      - Offline installers + install_notes.md
    bin/                             - Portable binaries (optional PATH)
    scripts/                         - Bootstrap/utility scripts
    devcontainer/                    - Dev container tooling

  85_Environments/                   - Reproducible dev env samples
    conda/environment.yml
    venv/README.md
    docker/Dockerfile

  99_Archive/                        - Completed projects/jobs/resources (read-only)
</code></pre></div></div>

<hr />

<h1 id="2-10_today는-어떻게-쓰나-step-by-step-운용법">2) <code class="language-plaintext highlighter-rouge">10_Today</code>는 어떻게 쓰나? (step-by-step 운용법)</h1>

<h3 id="결론">결론</h3>

<ul>
  <li>
    <p><strong>정답은 “여기로 ‘이동(mv)’해서 작업하지 않는다.”</strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">10_Today</code>는 <strong>대시보드/런치패드</strong> 야. <strong>원본은 항상 제자리</strong>(Projects/Jobs/Resources)에 두고, Today에는 <strong>링크/체크리스트/임시 메모</strong> 만 둬.</p>
  </li>
</ul>

<h3 id="추천-방식-3가지">추천 방식 3가지</h3>

<p><strong>A) 링크 모드(권장)</strong> — 원본은 제자리, Today엔 <strong>바로가기(심볼릭 링크/바로가기 파일)</strong></p>

<ul>
  <li>macOS/Linux:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>Work/10_Today
<span class="nb">ln</span> <span class="nt">-s</span> ../20_Projects/PRJ-2025-001_sample_app/README.md README.today.md
<span class="nb">ln</span> <span class="nt">-s</span> ../25_Jobs/JOB-2025-010_report/04_Run/run.sh job_run.sh
</code></pre></div>    </div>
  </li>
  <li>Windows (PowerShell; 관리자/개발자 모드 권장):
    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cd</span><span class="w"> </span><span class="nx">Work\10_Today</span><span class="w">
</span><span class="n">cmd</span><span class="w"> </span><span class="nx">/c</span><span class="w"> </span><span class="nx">mklink</span><span class="w"> </span><span class="nx">README.today.md</span><span class="w"> </span><span class="o">..</span><span class="nx">\20_Projects\PRJ-2025-001_sample_app\README.md</span><span class="w">
</span><span class="n">cmd</span><span class="w"> </span><span class="nx">/c</span><span class="w"> </span><span class="nx">mklink</span><span class="w"> </span><span class="nx">job_run.ps1</span><span class="w"> </span><span class="o">..</span><span class="nx">\25_Jobs\JOB-2025-010_report\04_Run\run.ps1</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>장점: 경로 일관성, 중복/충돌 없음.</li>
</ul>

<p><strong>B) 인덱스 모드(가볍게)</strong> — Today에는 <code class="language-plaintext highlighter-rouge">today.md</code>만 두고 <strong>작업 링크</strong> 를 모음</p>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh"># 2025-08-26</span>
<span class="p">-</span> <span class="p">[</span><span class="nv">Run job</span><span class="p">](</span><span class="sx">../25_Jobs/JOB-2025-010_report/04_Run/run.sh</span><span class="p">)</span>
<span class="p">-</span> <span class="p">[</span><span class="nv">Spec</span><span class="p">](</span><span class="sx">../20_Projects/PRJ-2025-001_sample_app/docs/spec.md</span><span class="p">)</span>
<span class="p">-</span> Notes: ...
</code></pre></div></div>

<p><strong>C) 스테이징 모드(예외적)</strong> — 아주 잠깐 필요한 <strong>임시 파일</strong> 만 복사해서 사용하고, <strong>EOD(End Of Day)</strong>에 원위치 이동/삭제</p>

<ul>
  <li>규칙: 코드 리포/입력 데이터의 <strong>정본은 절대 이동 금지</strong>. 혼선/충돌 위험 큼.</li>
</ul>

<h3 id="하루-루틴10_today-중심">하루 루틴(10_Today 중심)</h3>

<ol>
  <li>
    <p><strong>아침 5분</strong> : <code class="language-plaintext highlighter-rouge">10_Today/today.md</code> 업데이트(Top 3, 주요 링크, 간단 체크리스트).</p>
  </li>
  <li>
    <p><strong>작업 중</strong> : 링크/노트를 Today에 추가. 실제 파일 편집은 <strong>원래 폴더</strong> 에서.</p>
  </li>
  <li>
    <p><strong>업무 종료 전 5분</strong> :</p>

    <ul>
      <li>
        <p>PR/커밋/아카이브는 본 위치에서 마무리</p>
      </li>
      <li>
        <p>Today의 임시 파일 삭제, <code class="language-plaintext highlighter-rouge">today.md</code>에 결과 요약 3줄</p>
      </li>
      <li>
        <p>남길 내용은 <code class="language-plaintext highlighter-rouge">30_Areas/knowledge_base</code>나 해당 Project/Job의 README로 <strong>승격</strong>.</p>
      </li>
    </ul>
  </li>
</ol>

<h3 id="do--dont">Do / Don’t</h3>

<ul>
  <li>
    <p><strong>Do</strong> : 링크/노트/짧은 To-Do, 오늘만 쓸 임시 스크립트</p>
  </li>
  <li>
    <p><strong>Don’t</strong> : 장기 보관, 깊은 하위 폴더, 정본 파일 이동</p>
  </li>
</ul>

<hr />

<p>필요하면 <code class="language-plaintext highlighter-rouge">10_Today/today.md</code> 템플릿이나 <strong>링크 생성/정리 자동화 스크립트</strong>(오늘 할 일 → 링크 묶음 생성)를 만들어줄게.</p>

<p class="chat--user">

그러면 PRJ 폴더 채로 링크하거나 하진 마?

</p>

<p>짧은 답: <strong>웬만하면 PRJ 폴더 “통째로” Today에 링크하지 않는 걸 추천</strong> 해.<br />
대신 “핵심 핸들(README, run 스크립트, 현재 작업 파일/노트, Export 폴더)”만 걸어두는 게 안전하고 깔끔해.</p>

<hr />

<h2 id="왜-통째-링크를-비추하나-step-by-step">왜 통째 링크를 비추하나 (step-by-step)</h2>

<ol>
  <li>
    <p><strong>혼선 위험</strong> : Today에서 열어놓고 작업하다가 “여기가 진짜 루트”처럼 느껴져서 경로가 꼬이거나 불필요한 새 파일이 Today 쪽에 생길 수 있어.</p>
  </li>
  <li>
    <p><strong>도구/인덱싱 문제</strong> : IDE, 검색 인덱서, 백업 툴이 <strong>원본+링크를 중복 스캔</strong> 해서 속도 저하/중복 결과가 나올 수 있어.</p>
  </li>
  <li>
    <p><strong>대청소 사고 방지</strong> : Today는 매일/주기적으로 비우는 공간인데, 폴더 통째 링크는 <strong>삭제/이동 실수</strong> 의 표면적을 넓혀. (링크만 지워도 되지만 헷갈리기 쉬움)</p>
  </li>
  <li>
    <p><strong>불필요한 깊이</strong> : Today는 “대시보드”라서 <strong>얕고 가벼워야</strong> 해. 통째 링크는 Today를 다시 트리로 만들어 버림.</p>
  </li>
</ol>

<hr />

<h2 id="그러면-어떻게-권장-패턴">그러면 어떻게? (권장 패턴)</h2>

<h3 id="1-핵심-핸들-링크만-둔다">1) “핵심 핸들” 링크만 둔다</h3>

<ul>
  <li>
    <p>프로젝트당 3~5개 정도:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">README.md</code> (프로젝트 개요/체크리스트)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">scripts/run.sh</code> 또는 <code class="language-plaintext highlighter-rouge">04_Run/run.sh</code> (자주 돌리는 엔트리)</p>
      </li>
      <li>
        <p>오늘 편집할 문서 1개 (예: <code class="language-plaintext highlighter-rouge">docs/spec.md</code>)</p>
      </li>
      <li>
        <p>산출 확인용 <code class="language-plaintext highlighter-rouge">06_Export/</code> 폴더 (있으면)</p>
      </li>
    </ul>
  </li>
  <li>macOS/Linux
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>Work/10_Today
<span class="nb">ln</span> <span class="nt">-s</span> ../20_Projects/PRJ-2025-001_sample_app/README.md PRJ1_README.md
<span class="nb">ln</span> <span class="nt">-s</span> ../20_Projects/PRJ-2025-001_sample_app/scripts/run.sh PRJ1_run.sh
<span class="nb">ln</span> <span class="nt">-s</span> ../25_Jobs/JOB-2025-010_report/04_Run/run.sh JOB10_run.sh
<span class="nb">ln</span> <span class="nt">-s</span> ../25_Jobs/JOB-2025-010_report/06_Export JOB10_Export
</code></pre></div>    </div>
  </li>
  <li>Windows (PowerShell, 관리자 권장)
    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cd</span><span class="w"> </span><span class="nx">Work\10_Today</span><span class="w">
</span><span class="n">cmd</span><span class="w"> </span><span class="nx">/c</span><span class="w"> </span><span class="nx">mklink</span><span class="w"> </span><span class="nx">PRJ1_README.md</span><span class="w"> </span><span class="o">..</span><span class="nx">\20_Projects\PRJ-2025-001_sample_app\README.md</span><span class="w">
</span><span class="n">cmd</span><span class="w"> </span><span class="nx">/c</span><span class="w"> </span><span class="nx">mklink</span><span class="w"> </span><span class="nx">PRJ1_run.ps1</span><span class="w"> </span><span class="o">..</span><span class="nx">\20_Projects\PRJ-2025-001_sample_app\scripts\run.ps1</span><span class="w">
</span><span class="n">cmd</span><span class="w"> </span><span class="nx">/c</span><span class="w"> </span><span class="nx">mklink</span><span class="w"> </span><span class="nx">/D</span><span class="w"> </span><span class="nx">JOB10_Export</span><span class="w"> </span><span class="o">..</span><span class="nx">\25_Jobs\JOB-2025-010_report\06_Export</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<h3 id="2-인덱스-노트-1장만-두고-링크-모음">2) 인덱스 노트 1장만 두고 링크 모음</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">10_Today/today.md</code>에 그날 핸들 링크만 나열:
```md
    <h1 id="2025-08-26">2025-08-26</h1>
    <ul>
      <li><a href="../20_Projects/PRJ-2025-001_sample_app/README.md">PRJ1 README</a></li>
      <li><a href="../25_Jobs/JOB-2025-010_report/04_Run/run.sh">Run JOB10</a></li>
      <li>Notes: …
```</li>
    </ul>
  </li>
</ul>

<h3 id="3-예외적으로-폴더-링크가-꼭-필요하다면">3) 예외적으로 폴더 링크가 꼭 필요하다면</h3>

<ul>
  <li>
    <p><strong>일시적으로만</strong> 쓰고 EOD에 정리.</p>
  </li>
  <li>
    <p>OS별 권장:</p>

    <ul>
      <li>
        <p>macOS: Finder <strong>Alias</strong>(자동 추적에 강함) 또는 <code class="language-plaintext highlighter-rouge">ln -s</code>(CLI 친화)</p>
      </li>
      <li>
        <p>Windows: <code class="language-plaintext highlighter-rouge">mklink /D</code>(디렉터리 심볼릭 링크) 또는 <strong>.lnk 바로가기</strong>(GUI 용이)</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>주의</strong> : VSCode 등 일부 도구는 <strong>심볼릭 루트로 연 프로젝트</strong> 에서 경로/디버깅이 살짝 헷갈릴 수 있으니, 가능하면 <strong>원본 경로를 워크스페이스 루트</strong> 로 여는 걸 추천.</p>
  </li>
</ul>

<hr />

<h2 id="today-운영-미니-규칙">Today 운영 미니 규칙</h2>

<ul>
  <li>
    <p><strong>5분/3핸들 룰</strong> : 아침에 3개 내외 핸들만 걸고, 퇴근 전 정리.</p>
  </li>
  <li>
    <p><strong>정본 불가침</strong> : 코드/데이터의 <strong>정본은 항상 원래 위치</strong>(Projects/Jobs/Resources). Today에는 링크·체크리스트·임시 메모만.</p>
  </li>
  <li>
    <p><strong>주 1회 리셋</strong> : 쓰지 않는 링크/임시 파일 제거.</p>
  </li>
</ul>

<hr />

<h2 id="요약">요약</h2>

<ul>
  <li>
    <p><strong>통째 링크?</strong> 기본은 <strong>No</strong>.</p>
  </li>
  <li>
    <p><strong>대안</strong> : “핵심 핸들”만 Today에 링크하거나, <code class="language-plaintext highlighter-rouge">today.md</code>로 링크 인덱스 관리.</p>
  </li>
  <li>
    <p><strong>예외</strong> : 정말 필요하면 일시적으로 폴더 링크를 쓰되, EOD에 반드시 정리하고 원본 루트로 작업 여는 습관 유지.</p>
  </li>
</ul>

<p class="chat--user">

근데 그럴거면 링크 만드는게 더 일일거 같은데. md에 저장해봐야 주로 console에서 작업을 하는데 별 편의적으로는 도움이 안될거 같고 그냥 메모용 정도로 쓰는건가

</p>

<p>맞아—링크 만들고 md 편집하는 게 오히려 일이면 안 쓰게 돼요. 그럴 땐 <strong>콘솔 중심</strong> 으로 <code class="language-plaintext highlighter-rouge">10_Today</code>를 “대시보드 명령팔레트”로 쓰면 딱 좋아요. 링크/MD 없이, <strong>단 하나의 스크립트 + 짧은 목록 파일</strong> 로 오늘 할 일을 실행하게요.</p>

<p>아래 중 하나(또는 둘 다)로 가자:</p>

<hr />

<h1 id="옵션-a-today-단일-스크립트--간단-목록-파일-가장-추천">옵션 A) <code class="language-plaintext highlighter-rouge">today</code> 단일 스크립트 + 간단 목록 파일 (가장 추천)</h1>

<h2 id="1-목록-파일편집만-하면-됨">1) 목록 파일(편집만 하면 됨)</h2>

<p><code class="language-plaintext highlighter-rouge">Work/10_Today/shortcuts.list</code> (형식: <code class="language-plaintext highlighter-rouge">라벨 | 경로(Work 기준) | 명령</code>)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 예시
Run PRJ tests          | 20_Projects/PRJ-2025-001_sample_app        | ./scripts/test.sh
Build GUI              | 20_Projects/PRJ-2025-001_sample_app        | ./scripts/build_gui.sh
Re-run sample JOB      | 25_Jobs/JOB-2025-001_sample_output/04_Run  | ./run.sh
Open JOB export        | 25_Jobs/JOB-2025-001_sample_output/06_Export | ls -al
</code></pre></div></div>

<h2 id="2-bashzsh용-today-의존성-없음-select-메뉴">2) Bash/Zsh용 <code class="language-plaintext highlighter-rouge">today</code> (의존성 없음: <code class="language-plaintext highlighter-rouge">select</code> 메뉴)</h2>

<p><code class="language-plaintext highlighter-rouge">Work/10_Today/today</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>
<span class="nb">set</span> <span class="nt">-euo</span> pipefail
<span class="nv">W</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">WORK_DIR</span><span class="k">:-</span><span class="nv">$HOME</span><span class="p">/Work</span><span class="k">}</span><span class="s2">"</span>
<span class="nv">LIST</span><span class="o">=</span><span class="s2">"</span><span class="nv">$W</span><span class="s2">/10_Today/shortcuts.list"</span>
<span class="o">[[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$LIST</span><span class="s2">"</span> <span class="o">]]</span> <span class="o">||</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">"No shortcuts.list"</span><span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="o">}</span>

<span class="nb">mapfile</span> <span class="nt">-t</span> ITEMS &lt; &lt;<span class="o">(</span><span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'^\s*#'</span> <span class="s2">"</span><span class="nv">$LIST</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'/^\s*$/d'</span><span class="o">)</span>
<span class="nv">PS3</span><span class="o">=</span><span class="s2">"today&gt; "</span>
<span class="k">select </span>CH <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">ITEMS</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span> <span class="s2">"Edit shortcuts"</span><span class="p">;</span> <span class="k">do
  if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$REPLY</span><span class="s2">"</span> <span class="nt">-eq</span> <span class="k">$((${#</span><span class="nv">ITEMS</span><span class="p">[@]</span><span class="k">}</span><span class="o">+</span><span class="m">1</span><span class="k">))</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span> <span class="k">${</span><span class="nv">EDITOR</span><span class="k">:-</span><span class="nv">vi</span><span class="k">}</span> <span class="s2">"</span><span class="nv">$LIST</span><span class="s2">"</span><span class="p">;</span> <span class="k">continue</span><span class="p">;</span> <span class="k">fi
  </span><span class="nv">IFS</span><span class="o">=</span><span class="s1">'|'</span> <span class="nb">read</span> <span class="nt">-r</span> LABEL REL CMD <span class="o">&lt;&lt;&lt;</span><span class="s2">"</span><span class="nv">$CH</span><span class="s2">"</span>
  <span class="nv">DIR</span><span class="o">=</span><span class="s2">"</span><span class="nv">$W</span><span class="s2">/</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$REL</span><span class="s2">"</span> | xargs<span class="si">)</span><span class="s2">"</span>
  <span class="o">(</span><span class="nb">cd</span> <span class="s2">"</span><span class="nv">$DIR</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">eval</span> <span class="s2">"</span><span class="nv">$CMD</span><span class="s2">"</span><span class="o">)</span>
  <span class="nb">break
</span><span class="k">done</span>
</code></pre></div></div>

<p>실행권한: <code class="language-plaintext highlighter-rouge">chmod +x Work/10_Today/today</code><br />
사용: <code class="language-plaintext highlighter-rouge">~/Work/10_Today/today</code></p>

<h3 id="빠른-추가용-pin-함수콘솔에서-1줄-등록">빠른 추가용 <code class="language-plaintext highlighter-rouge">pin</code> 함수(콘솔에서 1줄 등록)</h3>

<p><code class="language-plaintext highlighter-rouge">~/.bashrc</code> 또는 <code class="language-plaintext highlighter-rouge">~/.zshrc</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">WORK_DIR</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work"</span>
pin<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">label</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span><span class="p">;</span> <span class="nb">shift</span> <span class="o">||</span> <span class="nb">true
  local </span><span class="nv">cmd</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="p">*</span><span class="k">:-</span><span class="nv">$SHELL</span><span class="k">}</span><span class="s2">"</span>
  <span class="nb">local </span><span class="nv">rel</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">PWD</span><span class="p">#</span><span class="s2">"</span><span class="nv">$WORK_DIR</span><span class="s2">/"</span><span class="k">}</span><span class="s2">"</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$label</span><span class="s2"> | </span><span class="nv">$rel</span><span class="s2"> | </span><span class="nv">$cmd</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="s2">"</span><span class="nv">$WORK_DIR</span><span class="s2">/10_Today/shortcuts.list"</span>
  <span class="nb">echo</span> <span class="s2">"Pinned: </span><span class="nv">$label</span><span class="s2"> -&gt; </span><span class="nv">$rel</span><span class="s2"> | </span><span class="nv">$cmd</span><span class="s2">"</span>
<span class="o">}</span>
</code></pre></div></div>

<p>예) 현재 디렉터리에서 자주 돌리는 명령을 고정:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pin "This job run" "./run.sh"
pin "Open spec" "${EDITOR:-vi} docs/spec.md"
</code></pre></div></div>

<h2 id="3-powershell용-todayps1-윈도우">3) PowerShell용 <code class="language-plaintext highlighter-rouge">today.ps1</code> (윈도우)</h2>

<p><code class="language-plaintext highlighter-rouge">Work\10_Today\today.ps1</code>:</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">WORK_DIR</span><span class="p">;</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$W</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="nv">$L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="s2">"10_Today\shortcuts.list"</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="nv">$L</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"No shortcuts.list"</span><span class="p">;</span><span class="w"> </span><span class="kr">exit</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="nv">$items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Content</span><span class="w"> </span><span class="nv">$L</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="bp">$_</span><span class="w"> </span><span class="o">-notmatch</span><span class="w"> </span><span class="s1">'^\s*$|^\s*#'</span><span class="p">}</span><span class="w">
</span><span class="kr">for</span><span class="w"> </span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="nv">$items</span><span class="o">.</span><span class="nf">Count</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"{0}. {1}"</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="p">(</span><span class="nv">$i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="nv">$items</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="nv">$choice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"today&gt;"</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$choice</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s1">'^\d+$'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nv">$line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$items</span><span class="p">[</span><span class="nv">$choice</span><span class="nt">-1</span><span class="p">]</span><span class="w">
  </span><span class="nv">$parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$line</span><span class="w"> </span><span class="o">-split</span><span class="w"> </span><span class="s1">'\s*\|\s*'</span><span class="w">
  </span><span class="n">Set-Location</span><span class="w"> </span><span class="p">(</span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="nv">$parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w">
  </span><span class="n">Invoke-Expression</span><span class="w"> </span><span class="nv">$parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><strong>핀 기능</strong> :</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">function</span><span class="w"> </span><span class="nf">pin</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="kr">param</span><span class="p">([</span><span class="n">string</span><span class="p">]</span><span class="nv">$Label</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$Cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$null</span><span class="p">)</span><span class="w">
  </span><span class="nv">$W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">WORK_DIR</span><span class="p">;</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$W</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="nv">$rel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Resolve-Path</span><span class="w"> </span><span class="o">.</span><span class="p">)</span><span class="o">.</span><span class="nf">Path</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s2">"</span><span class="nv">$W</span><span class="s2">\"</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span><span class="w">
  </span><span class="nx">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$Cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$Cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$Host</span><span class="o">.</span><span class="nf">UI</span><span class="o">.</span><span class="nf">RawUI</span><span class="o">.</span><span class="nf">WindowTitle</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="s2">"</span><span class="nv">$Label</span><span class="s2"> | </span><span class="nv">$rel</span><span class="s2"> | </span><span class="nv">$Cmd</span><span class="s2">"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Add-Content</span><span class="w"> </span><span class="p">(</span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="s2">"10_Today\shortcuts.list"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>요약: 링크·md 없이 <strong>목록 파일에 라인만 추가</strong> → <code class="language-plaintext highlighter-rouge">today</code>로 선택 실행.</p>
</blockquote>

<hr />

<h1 id="옵션-b-아예-함수별칭만-쓰기-초간단">옵션 B) 아예 “함수/별칭”만 쓰기 (초간단)</h1>

<h2 id="bashzsh">Bash/Zsh</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">W</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work"</span>
p<span class="o">()</span> <span class="o">{</span> <span class="nb">cd</span> <span class="s2">"</span><span class="nv">$W</span><span class="s2">/20_Projects"</span> <span class="o">&amp;&amp;</span> <span class="k">select </span>d <span class="k">in </span>PRJ-<span class="k">*</span><span class="p">;</span> <span class="k">do </span><span class="nb">cd</span> <span class="s2">"</span><span class="nv">$d</span><span class="s2">"</span><span class="p">;</span> <span class="nb">break</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span> <span class="o">}</span>     <span class="c"># 프로젝트 이동</span>
j<span class="o">()</span> <span class="o">{</span> <span class="nb">cd</span> <span class="s2">"</span><span class="nv">$W</span><span class="s2">/25_Jobs"</span> <span class="o">&amp;&amp;</span> <span class="k">select </span>d <span class="k">in</span> <span class="o">{</span>JOB,BUG,EX,SMOKE<span class="o">}</span>-<span class="k">*</span> 2&gt;/dev/null<span class="p">;</span> <span class="k">do </span><span class="nb">cd</span> <span class="s2">"</span><span class="nv">$d</span><span class="s2">"</span><span class="p">;</span> <span class="nb">break</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span> <span class="o">}</span>  <span class="c"># 잡 이동</span>
prun<span class="o">()</span> <span class="o">{</span> <span class="o">(</span><span class="nb">cd</span> <span class="s2">"</span><span class="nv">$W</span><span class="s2">/25_Jobs/</span><span class="nv">$1</span><span class="s2">/04_Run"</span> <span class="o">&amp;&amp;</span> ./run.sh<span class="o">)</span><span class="p">;</span> <span class="o">}</span>  <span class="c"># 사용: prun JOB-2025-001_x</span>
pexport<span class="o">()</span> <span class="o">{</span> <span class="nb">cd</span> <span class="s2">"</span><span class="nv">$W</span><span class="s2">/25_Jobs/</span><span class="nv">$1</span><span class="s2">/06_Export"</span><span class="p">;</span> <span class="o">}</span>
</code></pre></div></div>

<h2 id="powershell">PowerShell</h2>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">WORK_DIR</span><span class="p">;</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$W</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Set-Location</span><span class="w"> </span><span class="s2">"</span><span class="nv">$W</span><span class="s2">\20_Projects"</span><span class="p">;</span><span class="w"> </span><span class="nv">$d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="nx">PRJ-</span><span class="o">*</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-GridView</span><span class="w"> </span><span class="nt">-PassThru</span><span class="p">;</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$d</span><span class="p">){</span><span class="w"> </span><span class="n">Set-Location</span><span class="w"> </span><span class="nv">$d</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Set-Location</span><span class="w"> </span><span class="s2">"</span><span class="nv">$W</span><span class="s2">\25_Jobs"</span><span class="p">;</span><span class="w"> </span><span class="nv">$d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="nt">-Directory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Name</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s1">'^(JOB|BUG|EX|SMOKE)-'</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-GridView</span><span class="w"> </span><span class="nt">-PassThru</span><span class="p">;</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$d</span><span class="p">){</span><span class="w"> </span><span class="n">Set-Location</span><span class="w"> </span><span class="nv">$d</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">prun</span><span class="p">(</span><span class="nv">$job</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Push-Location</span><span class="w"> </span><span class="s2">"</span><span class="nv">$W</span><span class="s2">\25_Jobs\</span><span class="nv">$job</span><span class="s2">\04_Run"</span><span class="p">;</span><span class="w"> </span><span class="o">.</span><span class="n">/run.ps1</span><span class="p">;</span><span class="w"> </span><span class="n">Pop-Location</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>완전 심플: <strong>링크도 md도 없음</strong>. 함수로 점프하고 스크립트만 실행.</p>
</blockquote>

<hr />

<h1 id="마무리-가이드-의사결정-규칙">마무리 가이드 (의사결정 규칙)</h1>

<ul>
  <li>
    <p><strong>링크/MD는 굳이 X.</strong> 콘솔 위주면 <code class="language-plaintext highlighter-rouge">today</code>(옵션 A)나 <strong>함수/별칭</strong>(옵션 B)이 가장 빠름.</p>
  </li>
  <li>
    <p><strong>등록은 1줄</strong> : <code class="language-plaintext highlighter-rouge">shortcuts.list</code>에 라인 추가(또는 <code class="language-plaintext highlighter-rouge">pin "라벨" "명령"</code>).</p>
  </li>
  <li>
    <p><strong>정본은 원래 위치</strong> : Today는 “출발점”일 뿐, 코드는 Projects/Jobs에서 실행.</p>
  </li>
  <li>
    <p><strong>주 1회 청소</strong> : 안 쓰는 단축 라인 삭제, 최신 작업만 남기기.</p>
  </li>
</ul>

<p>원하면 위 스크립트들을 네 스타터에 <strong>파일로 반영한 버전</strong> 을 바로 만들어 줄게. 어느 셸(Bash/Zsh/PowerShell) 주력인지만 알려줘!</p>

<p class="chat--user">

Work/10_Today/shortcuts.list 이걸 어떻게 쓰는거야?

</p>

<p>좋아 — <code class="language-plaintext highlighter-rouge">Work/10_Today/shortcuts.list</code>는 <strong>콘솔에서 자주 하는 작업들을 “메뉴처럼” 고르는 목록</strong> 이야.<br />
각 줄마다 <strong>라벨 | (Work 기준) 상대경로 | 실행 명령</strong> 3개를 <code class="language-plaintext highlighter-rouge">|</code> 로 구분해 적어두고, <code class="language-plaintext highlighter-rouge">today</code> 스크립트로 선택 실행해.</p>

<p>아래를 <strong>순서대로</strong> 하면 바로 써진다.</p>

<hr />

<h2 id="0-개념-한-줄">0) 개념 한 줄</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">shortcuts.list</code> = “오늘 쓸 단축키 목록”</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">today</code> = 이 목록을 읽어서 <strong>번호로 고르게 해주는 런처</strong></p>
  </li>
</ul>

<hr />

<h2 id="1-기본-설치-macoslinux">1) 기본 설치 (macOS/Linux)</h2>

<ol>
  <li><strong>환경 변수(Work 루트) 지정</strong></li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">WORK_DIR</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work"</span>   <span class="c"># Work 폴더가 다른 곳이면 그 경로로 바꿔줘</span>
</code></pre></div></div>

<ol>
  <li><strong>런처 스크립트 저장</strong><br />
<code class="language-plaintext highlighter-rouge">~/Work/10_Today/today</code> 파일을 만들고 아래 내용 붙여넣기:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>
<span class="nb">set</span> <span class="nt">-euo</span> pipefail
<span class="nv">W</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">WORK_DIR</span><span class="k">:-</span><span class="nv">$HOME</span><span class="p">/Work</span><span class="k">}</span><span class="s2">"</span>
<span class="nv">LIST</span><span class="o">=</span><span class="s2">"</span><span class="nv">$W</span><span class="s2">/10_Today/shortcuts.list"</span>
<span class="o">[[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$LIST</span><span class="s2">"</span> <span class="o">]]</span> <span class="o">||</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">"No shortcuts.list"</span><span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="o">}</span>

<span class="nb">mapfile</span> <span class="nt">-t</span> ITEMS &lt; &lt;<span class="o">(</span><span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'^\s*#'</span> <span class="s2">"</span><span class="nv">$LIST</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'/^\s*$/d'</span><span class="o">)</span>
<span class="nv">PS3</span><span class="o">=</span><span class="s2">"today&gt; "</span>
<span class="k">select </span>CH <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">ITEMS</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span> <span class="s2">"Edit shortcuts"</span><span class="p">;</span> <span class="k">do
  if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$REPLY</span><span class="s2">"</span> <span class="nt">-eq</span> <span class="k">$((${#</span><span class="nv">ITEMS</span><span class="p">[@]</span><span class="k">}</span><span class="o">+</span><span class="m">1</span><span class="k">))</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span> <span class="k">${</span><span class="nv">EDITOR</span><span class="k">:-</span><span class="nv">vi</span><span class="k">}</span> <span class="s2">"</span><span class="nv">$LIST</span><span class="s2">"</span><span class="p">;</span> <span class="k">continue</span><span class="p">;</span> <span class="k">fi
  </span><span class="nv">IFS</span><span class="o">=</span><span class="s1">'|'</span> <span class="nb">read</span> <span class="nt">-r</span> LABEL REL CMD <span class="o">&lt;&lt;&lt;</span><span class="s2">"</span><span class="nv">$CH</span><span class="s2">"</span>
  <span class="nv">DIR</span><span class="o">=</span><span class="s2">"</span><span class="nv">$W</span><span class="s2">/</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$REL</span><span class="s2">"</span> | xargs<span class="si">)</span><span class="s2">"</span>
  <span class="o">(</span><span class="nb">cd</span> <span class="s2">"</span><span class="nv">$DIR</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">eval</span> <span class="s2">"</span><span class="nv">$CMD</span><span class="s2">"</span><span class="o">)</span>
  <span class="nb">break
</span><span class="k">done</span>
</code></pre></div></div>

<p>실행 권한:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> +x ~/Work/10_Today/today
</code></pre></div></div>

<ol>
  <li><strong>목록 파일 만들기</strong><br />
<code class="language-plaintext highlighter-rouge">~/Work/10_Today/shortcuts.list</code>:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Label                | RelativePath(from Work)                       | Command
Run tests              | 20_Projects/PRJ-2025-001_sample_app           | ./scripts/test.sh
Build GUI              | 20_Projects/PRJ-2025-001_sample_app           | ./scripts/build_gui.sh
Re-run sample job      | 25_Jobs/JOB-2025-001_sample_output/04_Run     | ./run.sh
Open job export        | 25_Jobs/JOB-2025-001_sample_output/06_Export  | ls -al
</code></pre></div></div>

<ol>
  <li><strong>실행</strong></li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/Work/10_Today/today
<span class="c"># → 번호 메뉴가 뜨고, 고르면 해당 경로로 cd 후 명령을 실행</span>
</code></pre></div></div>

<blockquote>
  <p>(선택) 편하게 <code class="language-plaintext highlighter-rouge">t</code> 별칭 추가:<br />
 <code class="language-plaintext highlighter-rouge">echo "alias t='$HOME/Work/10_Today/today'" &gt;&gt; ~/.zshrc &amp;&amp; source ~/.zshrc</code><br />
 이제 <code class="language-plaintext highlighter-rouge">t</code>만 쳐도 된다.</p>
</blockquote>

<hr />

<h2 id="2-기본-설치-windows--powershell">2) 기본 설치 (Windows / PowerShell)</h2>

<ol>
  <li><strong>환경 변수(Work 루트) 지정</strong></li>
</ol>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">WORK_DIR</span><span class="o">=</span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work"</span><span class="w">
</span></code></pre></div></div>

<ol>
  <li><strong>런처 스크립트 저장</strong><br />
<code class="language-plaintext highlighter-rouge">$HOME\Work\10_Today\today.ps1</code>:</li>
</ol>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">WORK_DIR</span><span class="p">;</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$W</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="nv">$L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="s2">"10_Today\shortcuts.list"</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="nv">$L</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"No shortcuts.list"</span><span class="p">;</span><span class="w"> </span><span class="kr">exit</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="nv">$items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Content</span><span class="w"> </span><span class="nv">$L</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="bp">$_</span><span class="w"> </span><span class="o">-notmatch</span><span class="w"> </span><span class="s1">'^\s*$|^\s*#'</span><span class="p">}</span><span class="w">
</span><span class="kr">for</span><span class="w"> </span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="nv">$items</span><span class="o">.</span><span class="nf">Count</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"{0}. {1}"</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="p">(</span><span class="nv">$i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="nv">$items</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="nv">$choice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"today&gt;"</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$choice</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s1">'^\d+$'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nv">$line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$items</span><span class="p">[</span><span class="nv">$choice</span><span class="nt">-1</span><span class="p">]</span><span class="w">
  </span><span class="nv">$parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$line</span><span class="w"> </span><span class="o">-split</span><span class="w"> </span><span class="s1">'\s*\|\s*'</span><span class="w">
  </span><span class="n">Set-Location</span><span class="w"> </span><span class="p">(</span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="nv">$parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w">
  </span><span class="n">Invoke-Expression</span><span class="w"> </span><span class="nv">$parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>실행 정책 때문에 막히면(관리자 PowerShell에서):<br />
 <code class="language-plaintext highlighter-rouge">Set-ExecutionPolicy -Scope CurrentUser RemoteSigned</code></p>
</blockquote>

<ol>
  <li><strong>목록 파일 만들기</strong><br />
<code class="language-plaintext highlighter-rouge">$HOME\Work\10_Today\shortcuts.list</code> (형식 동일):</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Run tests              | 20_Projects/PRJ-2025-001_sample_app           | ./scripts/test.ps1
Build GUI              | 20_Projects/PRJ-2025-001_sample_app           | ./scripts/build_gui.ps1
Re-run sample job      | 25_Jobs/JOB-2025-001_sample_output/04_Run     | ./run.ps1
Open job export        | 25_Jobs/JOB-2025-001_sample_output/06_Export  | dir
</code></pre></div></div>

<ol>
  <li><strong>실행</strong></li>
</ol>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="bp">$HOME</span><span class="n">\Work\10_Today\today.ps1</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>(선택) <code class="language-plaintext highlighter-rouge">Set-Alias t "$HOME\Work\10_Today\today.ps1"</code> 추가 후 <code class="language-plaintext highlighter-rouge">t</code>로 실행.</p>
</blockquote>

<hr />

<h2 id="3-shortcutslist-작성-규칙-중요-포인트">3) <code class="language-plaintext highlighter-rouge">shortcuts.list</code> 작성 규칙 (중요 포인트)</h2>

<ul>
  <li>
    <p><strong>포맷</strong> : <code class="language-plaintext highlighter-rouge">라벨 | (Work 기준) 상대경로 | 명령</code></p>

    <ul>
      <li>
        <p><strong>라벨</strong> : 메뉴에서 보이는 이름. 자유 텍스트.</p>
      </li>
      <li>
        <p><strong>상대경로</strong> : <code class="language-plaintext highlighter-rouge">Work/</code> 기준. 예: <code class="language-plaintext highlighter-rouge">20_Projects/PRJ-.../scripts</code></p>
      </li>
      <li>
        <p><strong>명령</strong> : 해당 경로에서 실행할 콘솔 명령. 예: <code class="language-plaintext highlighter-rouge">./run.sh</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>주석/빈 줄</strong> : <code class="language-plaintext highlighter-rouge">#</code> 로 시작하면 무시, 빈 줄도 무시.</p>
  </li>
  <li>
    <p><strong>파이프 기호<code class="language-plaintext highlighter-rouge">|</code> 주의</strong>: 이 파일은 <code class="language-plaintext highlighter-rouge">|</code>로 구분하니, <strong>명령에 파이프가 필요하면</strong></p>

    <ul>
      <li>
        <p>작은 <strong>래퍼 스크립트</strong>(예: <code class="language-plaintext highlighter-rouge">scripts/mycmd.sh</code>)를 만들어 그걸 호출해.</p>
      </li>
      <li>
        <p>예) <code class="language-plaintext highlighter-rouge">scripts/mycmd.sh</code> 안에 <code class="language-plaintext highlighter-rouge">python x.py | grep foo</code> → 목록에는 <code class="language-plaintext highlighter-rouge">./scripts/mycmd.sh</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>상대경로는 Work 기준</strong> : <code class="language-plaintext highlighter-rouge">WORK_DIR</code>(기본 <code class="language-plaintext highlighter-rouge">~/Work</code>)를 바꾸면 자동으로 따라감.</p>
  </li>
  <li>
    <p><strong>환경변수/별칭</strong> : 명령 안에서 <code class="language-plaintext highlighter-rouge">${EDITOR}</code>(bash)나 <code class="language-plaintext highlighter-rouge">$env:EDITOR</code>(PowerShell) 사용 가능.</p>
  </li>
</ul>

<hr />

<h2 id="4-선택-콘솔에서-1줄로-빠르게-등록--pin-함수">4) (선택) 콘솔에서 1줄로 빠르게 등록 — <code class="language-plaintext highlighter-rouge">pin</code> 함수</h2>

<h3 id="bashzsh-1">Bash/Zsh</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">WORK_DIR</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work"</span>
pin<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">label</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span><span class="p">;</span> <span class="nb">shift</span> <span class="o">||</span> <span class="nb">true
  local </span><span class="nv">cmd</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="p">*</span><span class="k">:-</span><span class="nv">$SHELL</span><span class="k">}</span><span class="s2">"</span>
  <span class="nb">local </span><span class="nv">rel</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">PWD</span><span class="p">#</span><span class="s2">"</span><span class="nv">$WORK_DIR</span><span class="s2">/"</span><span class="k">}</span><span class="s2">"</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$label</span><span class="s2"> | </span><span class="nv">$rel</span><span class="s2"> | </span><span class="nv">$cmd</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="s2">"</span><span class="nv">$WORK_DIR</span><span class="s2">/10_Today/shortcuts.list"</span>
  <span class="nb">echo</span> <span class="s2">"Pinned: </span><span class="nv">$label</span><span class="s2"> -&gt; </span><span class="nv">$rel</span><span class="s2"> | </span><span class="nv">$cmd</span><span class="s2">"</span>
<span class="o">}</span>
<span class="c"># 사용 예시</span>
pin <span class="s2">"Run current job"</span> <span class="s2">"./run.sh"</span>
pin <span class="s2">"Edit spec"</span>      <span class="s1">'${EDITOR:-vi} docs/spec.md'</span>
</code></pre></div></div>

<h3 id="powershell-1">PowerShell</h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">function</span><span class="w"> </span><span class="nf">pin</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="kr">param</span><span class="p">([</span><span class="n">string</span><span class="p">]</span><span class="nv">$Label</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$Cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$null</span><span class="p">)</span><span class="w">
  </span><span class="nv">$W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">WORK_DIR</span><span class="p">;</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$W</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="nv">$rel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Resolve-Path</span><span class="w"> </span><span class="o">.</span><span class="p">)</span><span class="o">.</span><span class="nf">Path</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s2">"</span><span class="nv">$W</span><span class="s2">\"</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span><span class="w">
  </span><span class="nx">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$Cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$Cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"powershell"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="s2">"</span><span class="nv">$Label</span><span class="s2"> | </span><span class="nv">$rel</span><span class="s2"> | </span><span class="nv">$Cmd</span><span class="s2">"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Add-Content</span><span class="w"> </span><span class="p">(</span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="s2">"10_Today\shortcuts.list"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c"># 예시</span><span class="w">
</span><span class="n">pin</span><span class="w"> </span><span class="s2">"Run current job"</span><span class="w"> </span><span class="s2">"./run.ps1"</span><span class="w">
</span></code></pre></div></div>

<hr />

<h2 id="5-자주-쓰는-실전-예시-복붙">5) 자주 쓰는 실전 예시 (복붙)</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Open project README    | 20_Projects/PRJ-2025-001_sample_app           | ${EDITOR:-vi} README.md
Run CLI                | 20_Projects/PRJ-2025-001_sample_app           | ./scripts/run_cli.sh
Build (CLI onefile)    | 20_Projects/PRJ-2025-001_sample_app           | ./scripts/build_cli.sh
Run SMOKE              | 25_Jobs/SMOKE-2025-001_new_tool/04_Run        | ./smoke.sh
Re-run BUG repro       | 25_Jobs/BUG-2025-001_sample_bug/04_Run        | ./repro.sh
Check JOB exports      | 25_Jobs/JOB-2025-001_sample_output/06_Export  | ls -al
Release notes (edit)   | 75_Releases/sample-app/v0.1.0                 | ${EDITOR:-vi} ReleaseNotes.md
</code></pre></div></div>

<hr />

<h2 id="6-문제-해결">6) 문제 해결</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">No shortcuts.list</code> → 경로 확인: <code class="language-plaintext highlighter-rouge">~/Work/10_Today/shortcuts.list</code></p>
  </li>
  <li>
    <p>Permission denied → <code class="language-plaintext highlighter-rouge">chmod +x ~/Work/10_Today/today</code> (bash) / 실행정책 설정(PS)</p>
  </li>
  <li>
    <p>명령에서 파이프가 필요 → <strong>래퍼 스크립트</strong> 로 감싸서 실행</p>
  </li>
  <li>
    <p>다른 곳에 Work가 있을 때 → <code class="language-plaintext highlighter-rouge">export WORK_DIR="/path/to/Work"</code>(bash) / <code class="language-plaintext highlighter-rouge">$env:WORK_DIR="D:\Work"</code>(PS)</p>
  </li>
</ul>

<hr />

<p>요약: <strong><code class="language-plaintext highlighter-rouge">shortcuts.list</code>만 편집</strong>하고 <code class="language-plaintext highlighter-rouge">today</code>를 실행하면, 원하는 작업을 <strong>번호 선택</strong> 으로 바로 돌릴 수 있어. 링크/MD 필요 없다—완전 콘솔 친화 모드!</p>

<p class="chat--user">

tcsh용으로도 하나 만들어줘

</p>

<p>좋지! <strong>tcsh</strong> 에서도 똑같이 “번호 선택 메뉴”로 돌릴 수 있게 런처/핀 스크립트를 만들어 보자. 콘솔만으로 씁니다—링크/MD 불필요.</p>

<hr />

<h1 id="1-tcsh-런처-todaycsh">1) tcsh 런처: <code class="language-plaintext highlighter-rouge">today.csh</code></h1>

<h2 id="설치-macoslinux-tcsh">설치 (macOS/Linux, tcsh)</h2>

<ol>
  <li>Work 루트 환경변수(로그인 시 자동)</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

# ~/.cshrc
setenv WORK_DIR "$HOME/Work"
</code></pre></div></div>

<ol>
  <li>런처 스크립트 저장<br />
<code class="language-plaintext highlighter-rouge">$HOME/Work/10_Today/today.csh</code>:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

#!/bin/tcsh -f
# tcsh launcher for Work/10_Today/shortcuts.list
# Format per line: Label | RelativePath(from Work) | Command

# Resolve Work root
set W = "$HOME/Work"
if ( $?WORK_DIR ) set W = "$WORK_DIR"

set LIST = "$W/10_Today/shortcuts.list"
if ( ! -f "$LIST" ) then
  echo "No shortcuts.list at: $LIST"
  exit 1
endif

# Filter comments/blank lines into a temp file
set TMP = "$W/10_Today/.shortcuts.filtered.$$"
grep -v '^[[:space:]]*#' "$LIST" | sed '/^[[:space:]]*$/d' &gt; "$TMP"
set count = `wc -l &lt; "$TMP"`
if ( "$count" == 0 ) then
  echo "No items in shortcuts.list"
  /bin/rm -f "$TMP"
  exit 0
endif

# Show numbered menu
set i = 1
while ( $i &lt;= $count )
  set line = `sed -n "${i}p" "$TMP"`
  echo "$i. $line"
  @ i++
end
@ edit_idx = $count + 1
echo "$edit_idx. Edit shortcuts"
echo -n "today&gt; "
set choice = $&lt;

if ( "$choice" == "$edit_idx" ) then
  if ( $?EDITOR ) then
    eval "$EDITOR $LIST"
  else
    vi "$LIST"
  endif
  /bin/rm -f "$TMP"
  exit 0
endif

# Validate numeric choice
if ( "$choice" !~ [0-9]* ) then
  echo "Invalid choice"
  /bin/rm -f "$TMP"
  exit 1
endif

# Pick the selected line
set sel = `sed -n "${choice}p" "$TMP"`

# Extract Label | Relative | Command
set label = `echo "$sel" | awk -F '|' '{gsub(/^[ \t]+|[ \t]+$/, "", $1); print $1}'`
set rel   = `echo "$sel" | awk -F '|' '{gsub(/^[ \t]+|[ \t]+$/, "", $2); print $2}'`
set cmd   = `echo "$sel" | awk -F '|' '{sub(/^[ \t]+/, "", $3); print $3}'`

set dir = "$W/$rel"
if ( ! -d "$dir" ) then
  echo "Directory not found: $dir"
  /bin/rm -f "$TMP"
  exit 1
endif

cd "$dir"
# Run command in that dir
eval "$cmd"

# Cleanup
/bin/rm -f "$TMP"
</code></pre></div></div>

<p>실행 권한:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> +x <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/10_Today/today.csh"</span>
</code></pre></div></div>

<p>(선택) 단축 별칭:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

# ~/.cshrc
alias t '$HOME/Work/10_Today/today.csh'
source ~/.cshrc
</code></pre></div></div>

<ol>
  <li><strong>목록 파일</strong> 만들기<br />
<code class="language-plaintext highlighter-rouge">$HOME/Work/10_Today/shortcuts.list</code>:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Label                 | RelativePath(from Work)                      | Command
Run tests               | 20_Projects/PRJ-2025-001_sample_app          | ./scripts/test.sh
Build GUI               | 20_Projects/PRJ-2025-001_sample_app          | ./scripts/build_gui.sh
Re-run sample job       | 25_Jobs/JOB-2025-001_sample_output/04_Run    | ./run.sh
Open job export         | 25_Jobs/JOB-2025-001_sample_output/06_Export | ls -al
</code></pre></div></div>

<p>사용:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

$ ~/Work/10_Today/today.csh
# → 번호 선택 후, 해당 경로로 cd 하고 Command 실행
</code></pre></div></div>

<blockquote>
  <p><strong>파이프(|) 주의</strong> : 이 파일은 <code class="language-plaintext highlighter-rouge">|</code> 구분자를 쓰므로, 명령에 파이프가 필요하면<br />
 작은 래퍼 스크립트(예: <code class="language-plaintext highlighter-rouge">scripts/mycmd.sh</code>)를 만들어 그걸 호출해 주세요.</p>
</blockquote>

<hr />

<h1 id="2-tcsh-핀-유틸-한-줄로-목록에-추가하기">2) tcsh “핀” 유틸: 한 줄로 목록에 추가하기</h1>

<p><code class="language-plaintext highlighter-rouge">$HOME/Work/10_Today/pin.csh</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

#!/bin/tcsh -f
# Usage: pin.csh "Label" [command]
set W = "$HOME/Work"
if ( $?WORK_DIR ) set W = "$WORK_DIR"
set L = "$W/10_Today/shortcuts.list"

if ( "$#argv" == 0 ) then
  echo 'Usage: pin.csh "Label" [command]'
  exit 1
endif

set label = "$1"
shift
if ( "$#argv" &gt; 0 ) then
  set cmd = "$*"
else
  set cmd = "$SHELL"
endif

# Current dir relative to Work
set rel = `echo "$cwd" | sed "s#^$W/##"`
echo "$label | $rel | $cmd" &gt;&gt; "$L"
echo "Pinned: $label -&gt; $rel | $cmd"
</code></pre></div></div>

<p>권한:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> +x <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/10_Today/pin.csh"</span>
</code></pre></div></div>

<p>사용 예시:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

# 지금 폴더의 run.sh를 핀으로 등록
~/Work/10_Today/pin.csh "Run current job" "./run.sh"

# 스펙 문서 편집을 핀으로 등록(EDITOR가 설정되어 있다면 그걸 사용)
~/Work/10_Today/pin.csh "Edit spec" '${EDITOR} docs/spec.md'
</code></pre></div></div>

<hr />

<h2 id="자주-묻는-요점-정리">자주 묻는 요점 정리</h2>

<ul>
  <li>
    <table>
      <tbody>
        <tr>
          <td><code class="language-plaintext highlighter-rouge">shortcuts.list</code> 포맷: **Label</td>
          <td>RelativePath</td>
          <td>Command** (Work 기준 상대경로)</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p><strong>편집 키</strong> : 메뉴의 마지막 항목 <strong>“Edit shortcuts”</strong> 선택하면 <code class="language-plaintext highlighter-rouge">$EDITOR</code>(없으면 <code class="language-plaintext highlighter-rouge">vi</code>)로 바로 열림</p>
  </li>
  <li>
    <p><strong>WORK_DIR</strong> 를 옮겼다면: <code class="language-plaintext highlighter-rouge">setenv WORK_DIR "/새/경로/Work"</code> 만 바꾸면 자동으로 따라감</p>
  </li>
  <li>
    <p><strong>문제</strong> : “No shortcuts.list” → 경로 확인, 빈 파일이면 항목 추가</p>
  </li>
  <li><strong>권장</strong> : Today는 “실행 출발점”일 뿐, 정본 코드는 <code class="language-plaintext highlighter-rouge">20_Projects/</code>와 <code class="language-plaintext highlighter-rouge">25_Jobs/</code>에 둡니다</li>
</ul>

<p>필요하면 <code class="language-plaintext highlighter-rouge">today.csh</code>에 <strong>즐겨찾기 고정/검색/필터</strong> 같은 옵션(menu 검색, 번호 다중 실행 등)도 추가해 줄게.</p>

<p class="chat--user">

간단한 스크립트는 어디 모아야할까

</p>

<p>좋은 질문! “간단한 스크립트”는 <strong>쓰임새(범위·수명)</strong>로 나눠서 보관하면 헷갈림이 사라져요. 아래 <strong>결정표</strong> 대로 두면 됩니다. 필요에 따라 폴더 하나(▶ 추가 표시)도 제안했어요.</p>

<hr />

<h2 id="어디에-둘까-결정표">어디에 둘까? (결정표)</h2>

<table>
  <thead>
    <tr>
      <th>상황/목적</th>
      <th>보관 위치</th>
      <th>이유/메모</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>프로젝트 전용 작업</strong> (빌드/테스트/런)</td>
      <td><code class="language-plaintext highlighter-rouge">20_Projects/PRJ-…/scripts/</code></td>
      <td>프로젝트 루트 기준 경로가 고정. 팀/CI도 그대로 사용 가능.</td>
    </tr>
    <tr>
      <td><strong>Job 실행 파이프라인</strong> (입력→설정→실행→산출)</td>
      <td><code class="language-plaintext highlighter-rouge">25_Jobs/&lt;JOB&gt;/04_Run/</code></td>
      <td>재현·증빙 목적. 로그/매니페스트와 같은 맥락에 둠.</td>
    </tr>
    <tr>
      <td><strong>여러 프로젝트에서 재사용하는 범용 스크립트</strong></td>
      <td><code class="language-plaintext highlighter-rouge">80_Tools/scripts/</code></td>
      <td>공용(골든) 도구. <strong>PATH</strong> 에 추가해서 어디서든 호출.</td>
    </tr>
    <tr>
      <td><strong>오늘만 쓰는 임시 래퍼/런처</strong> (콘솔 중심)</td>
      <td>▶ <code class="language-plaintext highlighter-rouge">10_Today/wrappers/</code></td>
      <td><code class="language-plaintext highlighter-rouge">shortcuts.list</code>에서 부르는 작은 래퍼를 모아두는 임시 구역. EOD/주 1회 정리.</td>
    </tr>
    <tr>
      <td><strong>짧은 1~3줄 트릭/반복 명령(코드 조각)</strong></td>
      <td><code class="language-plaintext highlighter-rouge">50_Snippets/bash/</code></td>
      <td>‘실행파일’이 아니라 <strong>참고용 조각</strong>. 나중에 성숙하면 스크립트로 승격.</td>
    </tr>
    <tr>
      <td><strong>실험·프로토타입</strong> (버려도 되는 테스트)</td>
      <td><code class="language-plaintext highlighter-rouge">31_Labs/jupyter/</code> 또는 해당 실험 폴더</td>
      <td>아이디어 검증 단계. 유효해지면 상위 위치로 승격.</td>
    </tr>
    <tr>
      <td><strong>개인 셸 함수/별칭</strong> (환경 설정)</td>
      <td><code class="language-plaintext highlighter-rouge">40_Resources/personal/configs/shell/{bash,zsh,tcsh,powershell}/</code></td>
      <td>로그인 시 자동 로딩. 비공유/취향/OS별로 분리.</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>▶ <strong>신규 폴더 제안</strong> : <code class="language-plaintext highlighter-rouge">10_Today/wrappers/</code></p>

  <ul>
    <li>
      <p>예: <code class="language-plaintext highlighter-rouge">today</code>에서 파이프(<code class="language-plaintext highlighter-rouge">|</code>), 복잡한 인자 등이 필요할 때 짧은 래퍼(<code class="language-plaintext highlighter-rouge">*.sh</code>, <code class="language-plaintext highlighter-rouge">*.ps1</code>, <code class="language-plaintext highlighter-rouge">*.csh</code>)를 여기에 두고 <code class="language-plaintext highlighter-rouge">shortcuts.list</code>에서는 그 래퍼만 호출.</p>
    </li>
    <li>
      <p>정리 주기: <strong>하루~일주일</strong>. 재사용 가치가 생기면 <code class="language-plaintext highlighter-rouge">80_Tools/scripts/</code>나 <code class="language-plaintext highlighter-rouge">PRJ-…/scripts/</code>로 <strong>승격</strong>.</p>
    </li>
  </ul>

</blockquote>

<hr />

<h2 id="운용-규칙-간단실전형">운용 규칙 (간단·실전형)</h2>

<ol>
  <li><strong>PATH 설정</strong>(단 한 번)</li>
</ol>

<ul>
  <li>Bash/Zsh/tcsh:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/80_Tools/scripts:</span><span class="nv">$PATH</span><span class="s2">"</span>
</code></pre></div>    </div>
  </li>
  <li>PowerShell:
    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">Path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\80_Tools\scripts;"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">Path</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<blockquote>
  <p>이렇게 하면 어디서든 <code class="language-plaintext highlighter-rouge">my-tool.sh</code> 같은 공용 스크립트를 바로 실행.</p>
</blockquote>

<ol>
  <li><strong>승격 루트</strong></li>
</ol>

<ul>
  <li><code class="language-plaintext highlighter-rouge">50_Snippets/bash/one-liner.txt</code> → 좋아서 자주 쓰게 됨 →<br />
<code class="language-plaintext highlighter-rouge">10_Today/wrappers/say_hello.sh</code>로 임시 사용 → 여전히 유용 →<br />
<code class="language-plaintext highlighter-rouge">80_Tools/scripts/say_hello.sh</code>로 <strong>승격</strong> + <code class="language-plaintext highlighter-rouge">--help</code>/설명 추가.</li>
</ul>

<ol>
  <li><strong>이름 규칙</strong></li>
</ol>

<ul>
  <li>
    <p><strong>동사-목적</strong> : <code class="language-plaintext highlighter-rouge">build_cli.sh</code>, <code class="language-plaintext highlighter-rouge">release_copy.ps1</code>, <code class="language-plaintext highlighter-rouge">repro_bug.csh</code></p>
  </li>
  <li>
    <p><strong>OS/셸 태그</strong>(필요 시): <code class="language-plaintext highlighter-rouge">*_mac.sh</code>, <code class="language-plaintext highlighter-rouge">*_win.ps1</code>, <code class="language-plaintext highlighter-rouge">*_nix.sh</code>, <code class="language-plaintext highlighter-rouge">*_tcsh.csh</code></p>
  </li>
  <li>
    <p><strong>프로젝트 한정</strong> 이면 파일명에 <strong>프로젝트 약어</strong> 붙이기: <code class="language-plaintext highlighter-rouge">build_cli_app1.sh</code></p>
  </li>
</ul>

<ol>
  <li><strong>헤더/안전 옵션(필수)</strong></li>
</ol>

<ul>
  <li>Bash/Zsh:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>
<span class="nb">set</span> <span class="nt">-euo</span> pipefail
</code></pre></div>    </div>
  </li>
  <li>PowerShell:
    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="bp">$Error</span><span class="n">ActionPreference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Stop"</span><span class="w">
</span><span class="n">Set-StrictMode</span><span class="w"> </span><span class="nt">-Version</span><span class="w"> </span><span class="nx">Latest</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>tcsh:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh
    
#!/bin/tcsh -f
</code></pre></div>    </div>
  </li>
  <li>최상단 주석 3줄(설명/의존성/예시):
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># build_cli.sh - Build CLI as onefile with PyInstaller</span>
<span class="c"># deps: pyinstaller&gt;=6, Python 3.11 venv activated</span>
<span class="c"># usage: ./build_cli.sh</span>
</code></pre></div>    </div>
  </li>
</ul>

<ol>
  <li><strong>문서화 위치</strong></li>
</ol>

<ul>
  <li>
    <p>공용 스크립트 목록은 <code class="language-plaintext highlighter-rouge">80_Tools/scripts/INDEX.md</code> 한 장으로 관리<br />
(이름, 한줄 설명, 사용 예시).</p>
  </li>
  <li>
    <p>프로젝트 전용은 <code class="language-plaintext highlighter-rouge">PRJ-…/README.md</code>의 “Scripts” 섹션에 표로 정리.</p>
  </li>
</ul>

<hr />

<h2 id="예시-배치-샘플">예시 배치 (샘플)</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/
  10_Today/
    wrappers/
      hotfix_export.sh         # 오늘만 쓸 임시 래퍼 (EOD 삭제/승격)
  20_Projects/PRJ-2025-001_sample_app/
    scripts/
      install.sh | .ps1
      run_cli.sh | .ps1
      build_cli.sh | .ps1
  25_Jobs/JOB-2025-010_report/04_Run/
    run.sh | run.ps1            # Job 실행 진입점
  50_Snippets/bash/
    tmux_one_liners.md
    git_tricks.md
  80_Tools/scripts/
    release_copy.sh             # 공용: dist → 75_Releases 로 전개
    checksum_all.sh             # 공용: SHA256 생성
    today                       # 콘솔 런처(선택)
    today.csh                   # tcsh 런처(선택)
    today.ps1                   # PS 런처(선택)
  40_Resources/personal/configs/shell/
    .zshrc, .tcshrc, Microsoft.PowerShell_profile.ps1
</code></pre></div></div>

<hr />

<h2 id="shortcutslist와-궁합-좋게-쓰는-팁"><code class="language-plaintext highlighter-rouge">shortcuts.list</code>와 궁합 좋게 쓰는 팁</h2>

<ul>
  <li>
    <p>파이프/복잡 명령이 필요하면 <code class="language-plaintext highlighter-rouge">10_Today/wrappers/*.sh</code>에 래퍼로 만들고,<br />
<code class="language-plaintext highlighter-rouge">shortcuts.list</code>에서는 <code class="language-plaintext highlighter-rouge">./wrappers/that_task.sh</code>만 호출 → 깔끔.</p>
  </li>
  <li>
    <p>래퍼가 일주일 내내 유용하면 <code class="language-plaintext highlighter-rouge">80_Tools/scripts/</code>로 <strong>승격</strong> + PATH에서 직접 호출.</p>
  </li>
</ul>

<hr />

<p>원하면 지금 스타터에 <code class="language-plaintext highlighter-rouge">10_Today/wrappers/</code>와 <code class="language-plaintext highlighter-rouge">80_Tools/scripts/INDEX.md</code> 틀, 그리고 <code class="language-plaintext highlighter-rouge">checksum_all.sh</code>/<code class="language-plaintext highlighter-rouge">release_copy.sh</code> 같은 <strong>실사용 공용 스크립트</strong> 샘플까지 바로 만들어서 붙여줄게. 어느 셸(Bash/Zsh/tcsh/PowerShell)을 주력으로 쓰는지도 알려줘!</p>

<p class="chat--user">

근데 config를 교육자료랑 같은 폴더에 두는게 난 좀 이상해

</p>

<p>완전 공감해요. <strong>교육자료(edu)</strong>와 <strong>설정(config)</strong>은 성격이 달라서 분리하는 게 깔끔합니다.<br />
아래처럼 <strong>전용 루트 <code class="language-plaintext highlighter-rouge">32_Configs/</code></strong>를 새로 두고, 기존 구조를 살짝 조정해요.</p>

<hr />

<h1 id="왜-분리">왜 분리?</h1>

<ul>
  <li>
    <p><strong>의도 분리</strong> : 문서/학습(읽기) vs 설정/프리셋(실행·적용)</p>
  </li>
  <li>
    <p><strong>권한/백업</strong> : 개인설정은 민감·빈도 높음 → 별도 관리가 안전</p>
  </li>
  <li>
    <p><strong>레이어링 명확</strong> : <code class="language-plaintext highlighter-rouge">shared(골든)</code> ↔ <code class="language-plaintext highlighter-rouge">personal(오버라이드)</code> 우선순위가 뚜렷</p>
  </li>
</ul>

<hr />

<h1 id="수정된-최종-트리설정만-이동-나머지-동일">수정된 최종 트리(설정만 이동, 나머지 동일)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/
  00_Inbox/
  10_Today/
  20_Projects/
  25_Jobs/
  30_Areas/
    worklog/
    environments/
    knowledge_base/
      tips/ cheatsheets/ howtos/
  31_Labs/
  32_Configs/                         - ★ 설정 전용 루트
    shared/                           - 조직/프로젝트에 공유 가능한 '골든'
      global/                         - 도구별 표준 설정(전역)
        vscode/ ruff/ pytest/ pyinstaller/ pyside6/ jupyter/
      projects/                       - 특정 프로젝트 전용 기본설정
        sample-app/                   - 예: 프로젝트별 pytest.ini, ruff.toml 등
      README.md                       - 적용 원칙/우선순위
    personal/                         - 나만의 오버라이드(비공개)
      os/{mac,win,linux}/             - OS별 세팅(키보드/입력기 등)
      shell/{bash,zsh,tcsh,powershell}/ - 프로필·별칭
      editors/vscode/                 - settings.user.json, keybindings.user.json
      git/                            - .gitconfig.local 등
      python/                         - pip.conf, poetry.toml, pypirc
      tools/                          - 각 툴 개인 프리셋
      secrets/README.md               - (실제 비밀은 두지 말 것)
      .gitignore                      - *.local, secrets/*, *.pem 등 폭넓게 제외
  40_Resources/                       - 레퍼런스/교육/매뉴얼(설정 X)
    edu/ (courses, tutorials, papers/…)
    manuals/ (&lt;vendor&gt;/&lt;product&gt;/&lt;version&gt;/)
    reference/                        - (선택) 스펙/표준 문서 등 '읽을거리'만
  50_Snippets/
  60_Assets/
  70_Exports/
  75_Releases/
  80_Tools/
    installers/ bin/ scripts/ devcontainer/
  85_Environments/ (conda/ venv/ docker/)
  99_Archive/
</code></pre></div></div>

<blockquote>
  <p>포인트: <strong>설정은 전부<code class="language-plaintext highlighter-rouge">32_Configs/</code>로 이동</strong>. 40_Resources엔 더 이상 설정이 없고, 순수 레퍼런스/학습 자료만 남깁니다.</p>
</blockquote>

<hr />

<h1 id="레이어링우선순위-규칙">레이어링(우선순위) 규칙</h1>

<ol>
  <li>
    <p><strong>Project 로컬</strong>(리포 내부 설정)</p>
  </li>
  <li>
    <p><strong>32_Configs/personal/</strong> (내 오버라이드)</p>
  </li>
  <li>
    <p>**32_Configs/shared/projects/ <proj>/** (프로젝트용 골든)</proj></p>
  </li>
  <li>
    <p><strong>32_Configs/shared/global/</strong> (전역 골든)</p>
  </li>
</ol>

<p>예: pytest는 순서대로 <code class="language-plaintext highlighter-rouge">pytest.ini</code>를 찾고, 없으면 상위로 올라가며 대체.</p>

<hr />

<h1 id="마이그레이션3분-컷">마이그레이션(3분 컷)</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1) 디렉터리 생성</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> ~/Work/32_Configs/shared/<span class="o">{</span>global,projects<span class="o">}</span> ~/Work/32_Configs/personal

<span class="c"># 2) 기존 설정 이동</span>
<span class="c">#   (전역 골든)</span>
<span class="nb">mv</span> ~/Work/40_Resources/reference/configs/<span class="k">*</span> ~/Work/32_Configs/shared/global/ 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>
<span class="c">#   (개인)</span>
<span class="nb">mv</span> ~/Work/40_Resources/personal/configs/<span class="k">*</span>  ~/Work/32_Configs/personal/     2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>

<span class="c"># 3) 흔적 정리(선택)</span>
<span class="nb">rmdir</span> ~/Work/40_Resources/reference/configs ~/Work/40_Resources/personal/configs 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>
</code></pre></div></div>

<p>PowerShell:</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">New-Item</span><span class="w"> </span><span class="nt">-ItemType</span><span class="w"> </span><span class="nx">Directory</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\32_Configs\shared\global"</span><span class="p">,</span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\32_Configs\shared\projects"</span><span class="p">,</span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\32_Configs\personal"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-Null</span><span class="w">
</span><span class="nx">Move-Item</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\40_Resources\reference\configs\*"</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\32_Configs\shared\global"</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
</span><span class="n">Move-Item</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\40_Resources\personal\configs\*"</span><span class="w">  </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\32_Configs\personal"</span><span class="w">     </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
</span></code></pre></div></div>

<hr />

<h1 id="부트스트랩홈-설정-연결-예시">부트스트랩(홈 설정 연결 예시)</h1>

<p>Bash/Zsh:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">WORK_DIR</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work"</span>
<span class="nb">export </span><span class="nv">WORK_CONFIGS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$WORK_DIR</span><span class="s2">/32_Configs"</span>
<span class="c"># 예: zsh 개인설정 연결</span>
<span class="nb">ln</span> <span class="nt">-snf</span> <span class="s2">"</span><span class="nv">$WORK_CONFIGS</span><span class="s2">/personal/shell/zsh/.zshrc"</span> ~/.zshrc
<span class="c"># VSCode 사용자 설정</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> ~/Library/Application<span class="se">\ </span>Support/Code/User
<span class="nb">ln</span> <span class="nt">-snf</span> <span class="s2">"</span><span class="nv">$WORK_CONFIGS</span><span class="s2">/personal/editors/vscode/settings.user.json"</span> <span class="se">\</span>
        ~/Library/Application<span class="se">\ </span>Support/Code/User/settings.json
</code></pre></div></div>

<p>PowerShell:</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$W</span><span class="o">=</span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\32_Configs\personal"</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nt">-Type</span><span class="w"> </span><span class="nx">SymbolicLink</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Documents\PowerShell\Microsoft.PowerShell_profile.ps1"</span><span class="w"> </span><span class="nt">-Target</span><span class="w"> </span><span class="s2">"</span><span class="nv">$W</span><span class="s2">\shell\powershell\profile.ps1"</span><span class="w"> </span><span class="nt">-Force</span><span class="w">
</span></code></pre></div></div>

<p>tcsh:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

setenv WORK_CONFIGS "$HOME/Work/32_Configs"
ln -snf "$WORK_CONFIGS/personal/shell/tcsh/.tcshrc" ~/.tcshrc
</code></pre></div></div>

<hr />

<h1 id="프로젝트에서-설정-불러오기권장-패턴">프로젝트에서 설정 불러오기(권장 패턴)</h1>

<h3 id="패턴-a-base--local">패턴 A) <code class="language-plaintext highlighter-rouge">*.base.*</code> + <code class="language-plaintext highlighter-rouge">*.local.*</code></h3>

<ul>
  <li>
    <p>리포 내 <code class="language-plaintext highlighter-rouge">pyproject.toml</code>/<code class="language-plaintext highlighter-rouge">ruff.toml</code>/<code class="language-plaintext highlighter-rouge">pytest.ini</code>는 <strong>기본</strong></p>
  </li>
  <li>
    <p>내 개인 오버라이드는 같은 디렉터리의 <code class="language-plaintext highlighter-rouge">*.local.*</code></p>
  </li>
  <li>
    <p>스크립트에서 발견 시 병합:</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">test</span> <span class="nt">-f</span> ruff.local.toml <span class="o">&amp;&amp;</span> <span class="nb">export </span><span class="nv">RUFF_ARGS</span><span class="o">=</span><span class="s2">"--config ruff.local.toml"</span>
</code></pre></div></div>

<h3 id="패턴-b-configd-디렉터리-병합">패턴 B) <code class="language-plaintext highlighter-rouge">config.d/</code> 디렉터리 병합</h3>

<ul>
  <li>
    <p>프로젝트 내 <code class="language-plaintext highlighter-rouge">config.d/00-base.toml</code>, <code class="language-plaintext highlighter-rouge">10-ci.toml</code></p>
  </li>
  <li>
    <p>개인은 <code class="language-plaintext highlighter-rouge">config.d/90-local.toml</code>로 추가(깃 무시)</p>
  </li>
</ul>

<hr />

<h1 id="today런처에서도-바로-접근"><code class="language-plaintext highlighter-rouge">today</code>/런처에서도 바로 접근</h1>

<p><code class="language-plaintext highlighter-rouge">Work/10_Today/shortcuts.list</code>에 자주 쓰는 설정 편집/링크 추가:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Edit pytest (shared)   | 32_Configs/shared/global/pytest   | ${EDITOR:-vi} pytest.ini
Edit ruff (personal)   | 32_Configs/personal/python        | ${EDITOR:-vi} ruff.local.toml
Bootstrap dotfiles     | 80_Tools/scripts                  | ./bootstrap_configs.sh
</code></pre></div></div>

<hr />

<h1 id="요약-1">요약</h1>

<ul>
  <li>
    <p><strong>설정 =<code class="language-plaintext highlighter-rouge">32_Configs/</code>로 완전 분리</strong> (shared/personal, global/projects 계층)</p>
  </li>
  <li>
    <p><strong>교육/레퍼런스 =<code class="language-plaintext highlighter-rouge">40_Resources/</code></strong> (설정 없음)</p>
  </li>
  <li>
    <p><strong>우선순위</strong> : Project → personal → shared/projects → shared/global</p>
  </li>
  <li>
    <p><strong>부트스트랩 스크립트</strong> 로 홈/IDE에 심볼릭 링크나 복사 연결</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">today</code> 런처나 <code class="language-plaintext highlighter-rouge">pin</code>으로 <strong>설정 편집/적용을 콘솔 한 번</strong> 에</p>
  </li>
</ul>

<p>원하면 <code class="language-plaintext highlighter-rouge">bootstrap_configs.sh</code>/<code class="language-plaintext highlighter-rouge">.ps1</code>와 <code class="language-plaintext highlighter-rouge">32_Configs/shared</code> 템플릿 파일들(ruff/pytest/VSC)까지 <strong>실제 파일</strong> 로 생성한 압축본을 바로 만들어줄게.</p>

<p class="chat--user">

왜 하필 32야?

</p>

<p>짧게 말하면, <strong>정렬·근접성·확장성</strong> 때문에 <code class="language-plaintext highlighter-rouge">32_Configs</code>로 잡았어요.</p>

<h2 id="왜-하필-32">왜 하필 32?</h2>

<ul>
  <li><strong>정렬(시각적 그룹화)</strong><br />
상위 레벨을 10 단위로 끊어 두었죠.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>30_Areas   ← 장기 운영(업무 영역)
31_Labs    ← 가벼운 실험
32_Configs ← 설정(실행·적용 중심)
40_Resources ← 읽을거리/레퍼런스
</code></pre></div>    </div>
  </li>
</ul>

<p>→ <code class="language-plaintext highlighter-rouge">Configs</code>가 <strong>Labs와 Resources 사이</strong> 에 오도록 32를 줘서, “업무(30) → 실험(31) → 설정적용(32) → 참고자료(40)” 흐름으로 자연스럽게 스캔됩니다.</p>

<ul>
  <li>
    <p><strong>근접성(자주 손대는 것끼리)</strong><br />
설정은 주로 <strong>Areas/Labs에서 파생</strong> 돼요(실험하다 설정을 고치고, 운영하면서 정책을 조정). 그래서 30대에 붙여 <strong>손 닿는 데</strong> 두었습니다.</p>
  </li>
  <li>
    <p><strong>확장성(번호 남겨두기)</strong><br />
33~39 사이에 여유가 생겨요. 나중에 필요하면:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">33_Templates</code> (문서/코드 템플릿)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">34_Policies</code> (보안/품질 정책 문서)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">35_Checklists</code>(QA/릴리스 체크리스트)<br />
… 같은 식으로 <strong>중간번호를 끼워넣기</strong> 쉽습니다.</p>
      </li>
    </ul>
  </li>
</ul>

<h2 id="꼭-32여야-해">꼭 32여야 해?</h2>

<p>아니요. 아래처럼 취향대로 바꿔도 좋아요—핵심은 <strong>일관성</strong>.</p>

<ul>
  <li>
    <p><strong>35_Configs</strong> : 홀수만 써서 시각적으로 구분 원할 때</p>
  </li>
  <li>
    <p><strong>28_Configs</strong> : Projects(20대)와 운영(30대) 사이로 끌어당기고 싶을 때</p>
  </li>
  <li>
    <p><strong>82_Configs</strong> : Tools(80대)와 묶고 싶을 때(개인 취향/DevOps 성향)</p>
  </li>
</ul>

<h2 id="바꾸고-싶다면-안전하게-리네임">바꾸고 싶다면 (안전하게 리네임)</h2>

<blockquote>
  <p>두 곳 이상에서 쓰는 스크립트/런처가 있으면 경로만 함께 바꿔주면 됩니다.</p>
</blockquote>

<p><strong>bash/zsh</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mv</span> ~/Work/32_Configs ~/Work/35_Configs
<span class="c"># today 런처 목록 등 경로 업데이트</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">''</span> <span class="s1">'s#/32_Configs/#/35_Configs/#g'</span> ~/Work/10_Today/shortcuts.list 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>
</code></pre></div></div>

<p><strong>PowerShell</strong></p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Rename-Item</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\32_Configs"</span><span class="w"> </span><span class="s2">"35_Configs"</span><span class="w">
</span><span class="p">(</span><span class="n">Get-Content</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\10_Today\shortcuts.list"</span><span class="p">)</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'/32_Configs/'</span><span class="p">,</span><span class="w"> </span><span class="s1">'/35_Configs/'</span><span class="w"> </span><span class="o">|</span><span class="w">
  </span><span class="n">Set-Content</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\10_Today\shortcuts.list"</span><span class="w">
</span></code></pre></div></div>

<h2 id="현재-상위-번호-체계-요약기억용">현재 상위 번호 체계 요약(기억용)</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>00  Inbox         | 10  Today          | 20  Projects      | 25  Jobs
30  Areas         | 31  Labs            | 32  Configs       | 40  Resources
50  Snippets      | 60  Assets          | 70  Exports       | 75  Releases
80  Tools         | 85  Environments    | 99  Archive
</code></pre></div></div>

<p>원하면 네 취향(짝수만/홀수만/문자 프리픽스 등)에 맞춰 <strong>전체 번호 리패터닝 표</strong> 랑 자동 마이그레이션 스크립트도 같이 만들어줄게.</p>

<p class="chat--user">

90을 개인용 Configs 로 하자. 최종적으로 각 폴더명(영어)과 담을 내용(한글)을 정리해줘. 그리고 10가지 정도 업무 예시에 대해 Workflow를 작성해줘. 예를 들어 프로젝트 만들기, 분석 작업하기, 개인용 스크립트 만들기, 툴 설치하기, 개인 shell alias 설정하기 등등이 있을 수 있어.

</p>

<p>좋아—요청대로 <strong>폴더명은 영어</strong> , <strong>설명은 한글</strong> 로 정리하고, 마지막에 <strong>대표 업무 10가지 워크플로우</strong> 를 단계별로 붙일게.<br />
(개인용 설정은 <code class="language-plaintext highlighter-rouge">90_Configs</code>로 확정, “공유/골든 설정”은 <code class="language-plaintext highlighter-rouge">32_Configs</code>에 유지)</p>

<hr />

<h1 id="1-최종-폴더-구조-영문-이름--한글-설명--예시-하위">1) 최종 폴더 구조 (영문 이름 + 한글 설명 + 예시 하위)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/                                     - 1인 개발용 작업 루트
  00_Inbox/                               - 급히 던져두는 임시함(매일/주기적으로 비우기)

  10_Today/                               - 오늘 작업 대시보드(콘솔 중심 실행 출발점)
    shortcuts.list                        - today 런처가 읽는 “라벨|경로|명령” 목록
    (wrappers/)                           - 파이프/복잡 인자용 임시 래퍼 스크립트(단기 보관)

  20_Projects/                            - 툴(파이썬 패키지) 개발(코드 수명 중심)
    PRJ-YYYY-NNN_name/                    - 개별 프로젝트(예: PRJ-2025-001_sample_app)
      src/&lt;package_name&gt;/                 - 패키지 소스
      tests/                              - pytest 테스트
      scripts/                            - install/run/build/lint/test 스크립트(.sh/.ps1)
      examples/{data,scripts,docs}/       - 배포용 최소 실행 예제
      issues/BUG-YYYY-NNN/                - 버그/개선 이슈 노트
      docs/                               - 설계·ADR·가이드
      .devcontainer/                      - 개발 컨테이너 설정
      pyproject.toml, README.md, .gitignore, .editorconfig

  25_Jobs/                                - “산출물 작업 단위”(프로세스 수명 중심)
    JOB-YYYY-NNN_name/                    - 일반 산출 Job(입력→설정→실행→산출)
      01_Brief/                           - 요구사항/수락 기준/마감
      02_Input/raw/                       - 원천 데이터(읽기 전용 보관)
      03_Config/                          - 파라미터(yml/json), 실행 설정
      04_Run/                             - run.sh|ps1, run.py, 로그
      05_Output/                          - 중간/최종 산출물(작업 영역)
      06_Export/                          - 전달본(최종 산출물)
      90_Archive/                         - 완료 후 장기 보관
    BUG-YYYY-NNN_name/                    - 배포 버그 재현/증거/수정 검증
      01_Report/ 02_Repro/input/ 03_Config/ 04_Run/ 05_Evidence/logs/ 06_FixValidation/
    EX-YYYY-NNN_name/                     - “툴 예제” 패키징용 Job(선택)
    SMOKE-YYYY-NNN_tool/                  - 새 툴 설치 후 스모크/feasibility 테스트

  30_Areas/                               - 장기 운영 영역(지속 업무)
    worklog/YYYY/YY-MM/DATE.md            - 일일/주간 5줄 로그
    environments/                         - 공통 환경 메모/전략(예: 파이썬 버전 정책)
    knowledge_base/{tips,cheatsheets,howtos}/
                                           - 축적 지식: 팁/치트시트/가이드

  31_Labs/                                - 실험실(짧은 테스트/프로토; 재현 불필요)
    jupyter/                              - 스크래치 노트북(예: regex_scratch.ipynb)

  32_Configs/                             - 공유/골든 설정(문서화·재사용 대상)
    shared/
      global/{vscode,ruff,pytest,pyinstaller,pyside6,jupyter}/
                                           - 전역 표준 설정
      projects/&lt;project_slug&gt;/             - 특정 프로젝트 기본설정
      README.md                            - 적용 원칙/우선순위

  40_Resources/                           - 참고 자료(교육/매뉴얼/스펙—설정 제외)
    edu/{courses,tutorials,papers/…}/      - 강의·튜토리얼·논문(읽을거리 중심)
    manuals/&lt;vendor&gt;/&lt;product&gt;/&lt;version&gt;/  - 매뉴얼/가이드(PDF/HTML/MD)
    reference/                             - 표준/스펙 문서 등 레퍼런스

  50_Snippets/{sql,text,bash}/            - 재사용 코드/문구 조각(짧은 예제·원라이너)

  60_Assets/                              - 로고/폰트/템플릿 등 브랜딩 리소스

  70_Exports/                             - 여러 Job의 “최종 전달본” 모아보기(선택)

  75_Releases/                            - 유저 배포 전용 중앙 보관소(버전드)
    &lt;project_slug&gt;/vX.Y.Z/{installers,wheels,portable,docs,licenses,checksums}/
    &lt;project_slug&gt;/latest/                 - 최신 버전 포인터
    catalog.json                           - (선택) 버전/파일 인덱스

  80_Tools/                               - 설치파일/포터블/자동화 스크립트
    installers/                            - 오프라인 설치 파일 + install_notes.md(버전·체크섬)
    bin/                                   - 포터블 실행파일(PATH에 추가 가능)
    scripts/                               - bootstrap/release/checksum 등 공용 스크립트
    devcontainer/                          - 개발 컨테이너 툴

  85_Environments/                        - 재현 가능한 개발 환경 샘플
    conda/environment.yml
    venv/README.md
    docker/Dockerfile

  90_Configs/                             - ★개인 설정(오버라이드·비공개)
    os/{mac,win,linux}/                    - OS별 설정(키맵/입력기 등)
    shell/{bash,zsh,tcsh,powershell}/      - 프로필·별칭(개인용)
    editors/vscode/{settings.user.json,keybindings.user.json}
    git/.gitconfig.local
    python/{pip.conf,poetry.toml,pypirc}
    tools/                                 - 각 툴 개인 프리셋
    secrets/README.md                      - (실제 비밀은 두지 말고 안내만)
    .gitignore                             - *.local, secrets/*, *.pem 등 광범위 제외

  99_Archive/                             - 완료 Project/Job/자료 장기 보관(읽기 전용)
</code></pre></div></div>

<hr />

<h1 id="2-대표-업무-10가지-workflow-step-by-step">2) 대표 업무 10가지 Workflow (Step-by-step)</h1>

<h2 id="1-새-프로젝트-만들기-python-패키지데스크탑-툴">1) 새 프로젝트 만들기 (Python 패키지/데스크탑 툴)</h2>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">20_Projects/PRJ-YYYY-NNN_&lt;name&gt;/</code> 생성(템플릿 복사).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">./scripts/install.(sh|ps1)</code>로 venv + dev 의존성 설치.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">src/&lt;pkg&gt;/</code>, <code class="language-plaintext highlighter-rouge">pyproject.toml</code> 패키지명과 엔트리포인트 수정.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">tests/</code>에 최소 <code class="language-plaintext highlighter-rouge">test_smoke.py</code> 추가 → <code class="language-plaintext highlighter-rouge">./scripts/test.*</code> 실행.</p>
  </li>
  <li>
    <p>필요 시 GUI 의존성(<code class="language-plaintext highlighter-rouge">.[gui]</code>) 추가, <code class="language-plaintext highlighter-rouge">scripts/run_gui.*</code>로 확인.</p>
  </li>
  <li>
    <p>README에 사용법/예제/버전 정책 기입.</p>
  </li>
</ol>

<h2 id="2-분석산출물-작업-수행도구-사용--결과-전달">2) 분석·산출물 작업 수행(도구 사용 → 결과 전달)</h2>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">25_Jobs/JOB-YYYY-NNN_&lt;title&gt;/</code> 생성.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">01_Brief/</code>에 요구사항·마감·검수 기준 작성.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">02_Input/raw/</code>에 입력 배치, <code class="language-plaintext highlighter-rouge">03_Config/config.yml</code> 작성.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">04_Run/run.(sh|ps1)</code> 실행 → <code class="language-plaintext highlighter-rouge">06_Export/</code>에 최종본, 로그/manifest 생성.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">qa_checklist.md</code> 통과 → 필요 시 <code class="language-plaintext highlighter-rouge">70_Exports/</code>에도 복사.</p>
  </li>
</ol>

<h2 id="3-개인용-스크립트-만들기">3) 개인용 스크립트 만들기</h2>

<ol>
  <li>
    <p>오늘만 쓸 임시면 <code class="language-plaintext highlighter-rouge">10_Today/wrappers/</code>에 작성 → <code class="language-plaintext highlighter-rouge">shortcuts.list</code>에서 호출.</p>
  </li>
  <li>
    <p>여러 프로젝트에서 재사용되면 <code class="language-plaintext highlighter-rouge">80_Tools/scripts/</code>로 <strong>승격</strong> + <code class="language-plaintext highlighter-rouge">--help</code>/README 작성.</p>
  </li>
  <li>
    <p>PATH에 <code class="language-plaintext highlighter-rouge">80_Tools/scripts</code> 추가.</p>
  </li>
  <li>
    <p>프로젝트 전용이면 <code class="language-plaintext highlighter-rouge">20_Projects/PRJ-…/scripts/</code>에 두고 README의 Scripts 섹션에 문서화.</p>
  </li>
</ol>

<h2 id="4-새-툴-설치-스모크-테스트">4) 새 툴 설치(+ 스모크 테스트)</h2>

<ol>
  <li>
    <p>설치파일을 <code class="language-plaintext highlighter-rouge">80_Tools/installers/</code>에 보관, <code class="language-plaintext highlighter-rouge">install_notes.md</code>에 버전·체크섬 기록.</p>
  </li>
  <li>
    <p>설치 후 <code class="language-plaintext highlighter-rouge">25_Jobs/SMOKE-YYYY-NNN_&lt;tool&gt;/</code> 생성.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">03_Config/commands.txt</code>에 <code class="language-plaintext highlighter-rouge">tool --version</code> 등 기본 명령 기입.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">04_Run/smoke.(sh|ps1)</code> 실행 → <code class="language-plaintext highlighter-rouge">06_Export/result.txt</code> 확인.</p>
  </li>
  <li>
    <p>통과하면 <code class="language-plaintext highlighter-rouge">10_Today/shortcuts.list</code>에 단축 명령 추가.</p>
  </li>
</ol>

<h2 id="5-개인-shell-alias프로필-설정">5) 개인 shell alias/프로필 설정</h2>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">90_Configs/shell/&lt;your_shell&gt;/</code>에 프로필·별칭 작성(예: <code class="language-plaintext highlighter-rouge">.zshrc</code>, <code class="language-plaintext highlighter-rouge">profile.ps1</code>).</p>
  </li>
  <li>
    <p>홈으로 심볼릭 링크 연결(또는 복사):</p>

    <ul>
      <li>
        <p>macOS/Linux: <code class="language-plaintext highlighter-rouge">ln -snf "$HOME/Work/90_Configs/shell/zsh/.zshrc" ~/.zshrc</code></p>
      </li>
      <li>
        <p>PowerShell: 프로필 링크/로드.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>재시작 또는 <code class="language-plaintext highlighter-rouge">source</code> 후 동작 확인.</p>
  </li>
  <li>
    <p>공용으로 권장하고 싶은 항목은 <code class="language-plaintext highlighter-rouge">32_Configs/shared/global/</code>에도 복제.</p>
  </li>
</ol>

<h2 id="6-배포-버전-만들기release">6) 배포 버전 만들기(Release)</h2>

<ol>
  <li>
    <p>프로젝트에서 <code class="language-plaintext highlighter-rouge">./scripts/build_cli.*</code>/<code class="language-plaintext highlighter-rouge">build_gui.*</code>로 빌드.</p>
  </li>
  <li>
    <p>릴리스 검증 Job(선택): <code class="language-plaintext highlighter-rouge">25_Jobs/REL-YYYY-NNN_&lt;proj&gt;_vX.Y.Z/</code>에서 체크섬·노트 자동화.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">75_Releases/&lt;project&gt;/vX.Y.Z/</code>에 <code class="language-plaintext highlighter-rouge">{installers,wheels,portable,docs,licenses,checksums}/</code> 정리.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ReleaseNotes.md</code> 작성, <code class="language-plaintext highlighter-rouge">latest/</code> 갱신.</p>
  </li>
  <li>
    <p>필요 시 사내/외부 배포 링크 공지.</p>
  </li>
</ol>

<h2 id="7-버그-제보--디버깅--패치">7) 버그 제보 → 디버깅 → 패치</h2>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">25_Jobs/BUG-YYYY-NNN_&lt;title&gt;/01_Report/</code>에 제보/환경/재현절차 작성.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">02_Repro/input/</code>, <code class="language-plaintext highlighter-rouge">03_Config/</code> 준비 → <code class="language-plaintext highlighter-rouge">04_Run/repro.*</code>로 재현.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">05_Evidence/logs/</code>에 로그·스크린샷·체크섬 수집.</p>
  </li>
  <li>
    <p>코드는 <code class="language-plaintext highlighter-rouge">20_Projects/.../issues/BUG-.../</code>에서 triage/fix_notes 관리.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">06_FixValidation/</code> 시나리오 통과 후 패치 릴리스(Workflow 6로 이동).</p>
  </li>
</ol>

<h2 id="8-빠른-실험정규식파이썬-문법-등">8) 빠른 실험(정규식/파이썬 문법 등)</h2>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">31_Labs/jupyter/</code>에서 스크래치(작게, 5분/50줄 규칙).</p>
  </li>
  <li>
    <p>가치가 있으면 <code class="language-plaintext highlighter-rouge">30_Areas/knowledge_base/{tips,cheatsheets,howtos}</code>로 <strong>승격 요약</strong>.</p>
  </li>
  <li>
    <p>재현/증빙이 필요해지면 <strong>SMOKE Job</strong> 이나 일반 <strong>JOB</strong> 으로 전환.</p>
  </li>
</ol>

<h2 id="9-교육논문-자료-관리">9) 교육·논문 자료 관리</h2>

<ol>
  <li>
    <p>PDF는 <code class="language-plaintext highlighter-rouge">40_Resources/edu/papers/to_read/</code>에 저장.</p>
  </li>
  <li>
    <p>읽으면서 <code class="language-plaintext highlighter-rouge">reading_notes/YYYY-MM-DD_Title.md</code> 작성(템플릿 사용).</p>
  </li>
  <li>
    <p>한 달에 한 번 <code class="language-plaintext highlighter-rouge">summaries/</code>에 1~2페이지 요약 정리.</p>
  </li>
  <li>
    <p>코드/알고리즘으로 채택되면 관련 PRJ의 <code class="language-plaintext highlighter-rouge">docs/</code> 또는 Job으로 연결하여 실험/결과 보관.</p>
  </li>
</ol>

<h2 id="10-설정-레이어링-적용골든--개인">10) 설정 레이어링 적용(골든 ↔ 개인)</h2>

<ol>
  <li>
    <p><strong>우선순위</strong> : Project 로컬 → <code class="language-plaintext highlighter-rouge">90_Configs/personal</code> → <code class="language-plaintext highlighter-rouge">32_Configs/shared/projects/&lt;proj&gt;</code> → <code class="language-plaintext highlighter-rouge">32_Configs/shared/global</code>.</p>
  </li>
  <li>
    <p>VSCode/ruff/pytest 등은 프로젝트에서 기본 설정, 개인은 <code class="language-plaintext highlighter-rouge">*.local.*</code> 오버라이드.</p>
  </li>
  <li>
    <p>부트스트랩 스크립트(<code class="language-plaintext highlighter-rouge">80_Tools/scripts/bootstrap_configs.*</code>)로 홈/IDE에 링크·복사 자동 적용.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">10_Today/shortcuts.list</code>에 “Edit ruff (personal)” 같은 단축키 추가.</p>
  </li>
</ol>

<hr />

<p>원하면 위 변경(특히 <code class="language-plaintext highlighter-rouge">90_Configs</code> 신설)까지 <strong>실제 폴더와 샘플 파일을 생성한 스타터 압축본</strong> 으로 바로 만들어 줄 수 있어. 어떤 셸을 주력으로 쓰는지만 알려줘(예: zsh, tcsh, PowerShell).</p>

<p class="chat--user">

90_Configs랑 32_Configs랑 이름이 겹쳐. rename이 필요해 보여

</p>

<p>좋은 지적! 이름 충돌을 없애고 <strong>의도가 한눈에 보이도록</strong> 이렇게 바꿉니다.</p>

<h1 id="새-이름-명확일관">새 이름 (명확·일관)</h1>

<ul>
  <li>
    <p>**32<em>SharedConfigs** → _공유/골든 설정</em> (팀·프로젝트가 재사용하는 표준)</p>
  </li>
  <li>
    <p>**90<em>PersonalConfigs** → _개인 설정</em> (내 취향/오버라이드/비공개)</p>
  </li>
</ul>

<p>둘 다 <code class="language-plaintext highlighter-rouge">Configs</code>를 유지하되 접두로 <strong>Shared / Personal</strong> 을 붙여 구분을 확실히 했어요.</p>

<hr />

<h1 id="최종-구조해당-부분만-발췌">최종 구조(해당 부분만 발췌)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/
  32_SharedConfigs/                     - 공유/골든 설정(문서화·재사용 대상)
    global/{vscode,ruff,pytest,pyinstaller,pyside6,jupyter}/
                                         - 전역 표준 설정
    projects/&lt;project_slug&gt;/             - 특정 프로젝트 기본설정
    README.md                            - 적용 원칙/우선순위

  90_PersonalConfigs/                   - 개인 설정(오버라이드·비공개)
    os/{mac,win,linux}/                  - OS별 설정
    shell/{bash,zsh,tcsh,powershell}/    - 프로필·별칭
    editors/vscode/{settings.user.json,keybindings.user.json}
    git/.gitconfig.local
    python/{pip.conf,poetry.toml,pypirc}
    tools/                               - 각 툴 개인 프리셋
    secrets/README.md                    - (실제 비밀은 두지 말 것)
    .gitignore                           - *.local, secrets/*, *.pem 등 폭넓게 제외
</code></pre></div></div>

<h2 id="설정-레이어링우선순위-그대로-유지">설정 레이어링(우선순위 그대로 유지)</h2>

<p>Project 로컬 → <strong>90_PersonalConfigs</strong> → 32_SharedConfigs/projects → 32_SharedConfigs/global</p>

<hr />

<h1 id="안전한-리네임3분-컷">안전한 리네임(3분 컷)</h1>

<h2 id="macoslinux-bashzsh">macOS/Linux (bash/zsh)</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/Work
<span class="nb">mv </span>32_Configs 32_SharedConfigs 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
mv </span>90_Configs 90_PersonalConfigs 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>

<span class="c"># today 목록 경로 일괄 치환</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">''</span> <span class="s1">'s#/32_Configs/#/32_SharedConfigs/#g'</span> 10_Today/shortcuts.list 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
sed</span> <span class="nt">-i</span> <span class="s1">''</span> <span class="s1">'s#/90_Configs/#/90_PersonalConfigs/#g'</span> 10_Today/shortcuts.list 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>

<span class="c"># 홈 심볼릭 링크 재연결 예시</span>
<span class="nb">ln</span> <span class="nt">-snf</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/90_PersonalConfigs/shell/zsh/.zshrc"</span> ~/.zshrc
</code></pre></div></div>

<h2 id="windows-powershell-1">Windows (PowerShell)</h2>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Rename-Item</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\32_Configs"</span><span class="w"> </span><span class="s2">"32_SharedConfigs"</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
</span><span class="n">Rename-Item</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\90_Configs"</span><span class="w"> </span><span class="s2">"90_PersonalConfigs"</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">

</span><span class="p">(</span><span class="n">Get-Content</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\10_Today\shortcuts.list"</span><span class="p">)</span><span class="w"> </span><span class="se">`
</span><span class="w">  </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'/32_Configs/'</span><span class="p">,</span><span class="w"> </span><span class="s1">'/32_SharedConfigs/'</span><span class="w"> </span><span class="se">`
</span><span class="w">  </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'/90_Configs/'</span><span class="p">,</span><span class="w"> </span><span class="s1">'/90_PersonalConfigs/'</span><span class="w"> </span><span class="se">`
</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Set-Content</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\10_Today\shortcuts.list"</span><span class="w">

</span><span class="c"># 예: 개인 프로필 링크 재설정</span><span class="w">
</span><span class="c"># New-Item -Type SymbolicLink -Path "$HOME\Documents\PowerShell\Microsoft.PowerShell_profile.ps1" `</span><span class="w">
</span><span class="c">#   -Target "$HOME\Work\90_PersonalConfigs\shell\powershell\profile.ps1" -Force</span><span class="w">
</span></code></pre></div></div>

<h2 id="tcsh">tcsh</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

cd ~/Work
if ( -d 32_Configs )  mv 32_Configs 32_SharedConfigs
if ( -d 90_Configs )  mv 90_Configs 90_PersonalConfigs
# shortcuts.list 내 경로는 수동 또는 sed로 치환
sed -i '' 's#/32_Configs/#/32_SharedConfigs/#g; s#/90_Configs/#/90_PersonalConfigs/#g' 10_Today/shortcuts.list
</code></pre></div></div>

<hr />

<h1 id="부트스트랩런처에서의-새-경로-사용-예">부트스트랩/런처에서의 새 경로 사용 예</h1>

<p><strong><code class="language-plaintext highlighter-rouge">shortcuts.list</code> 예시</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Edit pytest (shared)   | 32_SharedConfigs/global/pytest   | ${EDITOR:-vi} pytest.ini
Edit ruff (personal)   | 90_PersonalConfigs/python        | ${EDITOR:-vi} ruff.local.toml
Bootstrap dotfiles     | 80_Tools/scripts                 | ./bootstrap_configs.sh
</code></pre></div></div>

<p><strong>심볼릭 링크 예시</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># VSCode 사용자 설정</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> ~/Library/Application<span class="se">\ </span>Support/Code/User
<span class="nb">ln</span> <span class="nt">-snf</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/90_PersonalConfigs/editors/vscode/settings.user.json"</span> <span class="se">\</span>
        ~/Library/Application<span class="se">\ </span>Support/Code/User/settings.json
</code></pre></div></div>

<hr />

<h2 id="왜-이-이름이-좋은가-짧게">왜 이 이름이 좋은가 (짧게)</h2>

<ul>
  <li>
    <p><strong>가독성</strong> : 폴더를 보는 순간 “공유용 vs 개인용”이 즉시 구분.</p>
  </li>
  <li>
    <p><strong>검색성</strong> : <code class="language-plaintext highlighter-rouge">SharedConfigs</code>, <code class="language-plaintext highlighter-rouge">PersonalConfigs</code> 키워드로 코드·문서·스크립트에서 쉽게 grep.</p>
  </li>
  <li>
    <p><strong>확장성</strong> : 나중에 <code class="language-plaintext highlighter-rouge">33_Templates/</code>, <code class="language-plaintext highlighter-rouge">34_Policies/</code> 같은 디렉터리도 무리 없이 추가.</p>
  </li>
</ul>

<p>필요하면 위 리네임을 반영한 <strong>today 런처/핀 스크립트</strong> 샘플 업데이트와 <code class="language-plaintext highlighter-rouge">bootstrap_configs.(sh|ps1|csh)</code>까지 만들어서 드릴게.</p>

<p class="chat--user">

근데 shortcuts가 그렇게 유용해? 여러 군데서 사용하네

</p>

<p>좋은 포인트야. <strong>shortcuts.list</strong> 가 “유용하냐”는 건 작업 스타일/규모에 따라 갈려.<br />
정리하자면:</p>

<h2 id="결론-의사결정-매트릭스">결론 (의사결정 매트릭스)</h2>

<ul>
  <li>
    <p><strong>명령이 5~20개</strong> 정도로 “매일 반복”된다 → <code class="language-plaintext highlighter-rouge">shortcuts.list</code> 유지 (번호 선택 한 방, 쉘/OS 무관).</p>
  </li>
  <li>
    <p><strong>명령이 들쭉날쭉·많음( &gt;30)</strong> → <code class="language-plaintext highlighter-rouge">shortcuts.list</code> <em>없애고</em> <strong>자동 탐색 러너</strong> 로 전환.</p>
  </li>
  <li>
    <p><strong>프로젝트별로만 돌림</strong> → 각 PRJ에 <strong>Make/just/invoke/nox</strong> 같은 <strong>로컬 태스크 러너</strong> 두고, Today는 단순 점프만.</p>
  </li>
</ul>

<p>아래에 <strong>세 가지 운용안</strong> 을 다 줬어. 너한테 맞는 걸 골라 쓰면 돼.</p>

<hr />

<h1 id="옵션-a-shortcutslist-계속-쓸-때-유지비-최소-트릭">옵션 A) shortcuts.list 계속 쓸 때 (유지비 최소 트릭)</h1>

<ul>
  <li>
    <p><strong>등록은 1줄</strong> : <code class="language-plaintext highlighter-rouge">pin</code>(bash/zsh/ps/tcsh)로 현재 폴더·명령을 자동 추가 → 타이핑 부담 최소.</p>
  </li>
  <li>
    <p><strong>정리 주기</strong> : 금요일 5분에 <strong>TOP10만 남기고 나머지 아카이브</strong>.</p>
  </li>
  <li>
    <p><strong>한 곳에서만 사용</strong> : <code class="language-plaintext highlighter-rouge">today</code> 러너만 이 파일을 읽게 하고, 다른 스크립트/도구는 <strong>직접 파싱 금지</strong>(중복도입 방지).</p>
  </li>
</ul>

<blockquote>
  <p>이미 우리가 만든 <code class="language-plaintext highlighter-rouge">today</code>/<code class="language-plaintext highlighter-rouge">pin</code> 세트는 이 전제를 만족해. (=한 군데에서만 소비)</p>
</blockquote>

<hr />

<h1 id="옵션-b-자동-탐색-러너추천-명령이-많거나-자주-변할-때">옵션 B) <strong>자동 탐색 러너</strong>(추천: 명령이 많거나 자주 변할 때)</h1>

<blockquote>
  <p>리스트 관리 자체가 귀찮다면, <strong>Work 전체를 스캔</strong> 해서 “돌릴 수 있는 스크립트”를 <strong>자동으로</strong> 메뉴로 보여주면 끝이야.<br />
 <code class="language-plaintext highlighter-rouge">shortcuts.list</code> 없이 바로 사용.</p>
</blockquote>

<h2 id="bashzsh-work-run-fzf-있으면-퍼지-선택-없으면-번호-선택">bash/zsh: <code class="language-plaintext highlighter-rouge">work-run</code> (fzf 있으면 퍼지 선택, 없으면 번호 선택)</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>
<span class="nb">set</span> <span class="nt">-euo</span> pipefail
<span class="nv">W</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">WORK_DIR</span><span class="k">:-</span><span class="nv">$HOME</span><span class="p">/Work</span><span class="k">}</span><span class="s2">"</span>

<span class="c"># (1) 후보 수집: 자주 쓰는 엔트리 스크립트 패턴</span>
<span class="nb">mapfile</span> <span class="nt">-t</span> CANDIDATES &lt; &lt;<span class="o">(</span>
  find <span class="s2">"</span><span class="nv">$W</span><span class="s2">"</span> <span class="nt">-type</span> f <span class="se">\(</span> <span class="se">\</span>
      <span class="nt">-path</span> <span class="s2">"</span><span class="nv">$W</span><span class="s2">/20_Projects/*/scripts/*.sh"</span> <span class="nt">-o</span> <span class="se">\</span>
      <span class="nt">-path</span> <span class="s2">"</span><span class="nv">$W</span><span class="s2">/25_Jobs/*/04_Run/*.sh"</span> <span class="nt">-o</span> <span class="se">\</span>
      <span class="nt">-path</span> <span class="s2">"</span><span class="nv">$W</span><span class="s2">/25_Jobs/*/04_Run/*.ps1"</span> <span class="nt">-o</span> <span class="se">\</span>
      <span class="nt">-path</span> <span class="s2">"</span><span class="nv">$W</span><span class="s2">/80_Tools/scripts/*.sh"</span> <span class="se">\</span>
    <span class="se">\)</span> 2&gt;/dev/null <span class="se">\</span>
  | <span class="nb">sort</span>
<span class="o">)</span>

<span class="o">((</span> <span class="k">${#</span><span class="nv">CANDIDATES</span><span class="p">[@]</span><span class="k">}</span> <span class="o">))</span> <span class="o">||</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">"No runnable scripts found."</span><span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="o">}</span>

pick_with_fzf<span class="o">()</span> <span class="o">{</span>
  <span class="nb">command</span> <span class="nt">-v</span> fzf <span class="o">&gt;</span>/dev/null 2&gt;&amp;1 <span class="o">||</span> <span class="k">return </span>1
  <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="k">${</span><span class="nv">CANDIDATES</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span> <span class="se">\</span>
    | <span class="nb">sed</span> <span class="s2">"s|^</span><span class="nv">$W</span><span class="s2">/||"</span> <span class="se">\</span>
    | fzf <span class="nt">--prompt</span><span class="o">=</span><span class="s2">"work-run&gt; "</span> <span class="nt">--height</span><span class="o">=</span>40% <span class="nt">--reverse</span> <span class="se">\</span>
          <span class="nt">--preview</span><span class="o">=</span><span class="s2">"sed -n '1,80p' </span><span class="se">\"</span><span class="nv">$W</span><span class="s2">/{}</span><span class="se">\"</span><span class="s2">"</span> <span class="se">\</span>
    | <span class="nb">sed</span> <span class="s2">"s|^|</span><span class="nv">$W</span><span class="s2">/|"</span>
<span class="o">}</span>

<span class="nv">SEL</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>pick_with_fzf <span class="o">||</span> <span class="nb">true</span><span class="si">)</span><span class="s2">"</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SEL</span><span class="k">:-}</span><span class="s2">"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  <span class="c"># fallback: 번호 선택</span>
  <span class="nv">i</span><span class="o">=</span>1
  <span class="k">for </span>p <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">CANDIDATES</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
    </span><span class="nv">rel</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">p</span><span class="p">#</span><span class="nv">$W</span><span class="p">/</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="nb">printf</span> <span class="s2">"%2d) %s</span><span class="se">\n</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$rel</span><span class="s2">"</span><span class="p">;</span> <span class="o">((</span>i++<span class="o">))</span>
  <span class="k">done
  </span><span class="nb">read</span> <span class="nt">-rp</span> <span class="s2">"work-run&gt; "</span> idx
  <span class="o">[[</span> <span class="s2">"</span><span class="nv">$idx</span><span class="s2">"</span> <span class="o">=</span>~ ^[0-9]+<span class="nv">$ </span><span class="o">]]</span> <span class="o">||</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">"Invalid"</span><span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="o">}</span>
  <span class="nv">SEL</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">CANDIDATES</span><span class="p">[</span><span class="k">$((</span>idx-1<span class="k">))</span><span class="p">]</span><span class="k">}</span><span class="s2">"</span>
<span class="k">fi

</span><span class="nb">dir</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$SEL</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span><span class="p">;</span> <span class="nv">file</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$SEL</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">cd</span> <span class="s2">"</span><span class="nv">$dir</span><span class="s2">"</span>
<span class="k">case</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="k">in</span>
  <span class="k">*</span>.ps1<span class="p">)</span>  pwsh <span class="nt">-NoLogo</span> <span class="nt">-NoProfile</span> <span class="nt">-File</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="p">;;</span>   <span class="c"># pwsh있으면 PS 스크립트도 실행</span>
  <span class="k">*</span>.sh<span class="p">)</span>   <span class="nb">chmod</span> +x <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span><span class="p">;</span> <span class="s2">"./</span><span class="nv">$file</span><span class="s2">"</span> <span class="p">;;</span>
  <span class="k">*</span><span class="p">)</span>      <span class="nb">echo</span> <span class="s2">"Unknown type: </span><span class="nv">$file</span><span class="s2">"</span><span class="p">;</span> <span class="nb">exit </span>1 <span class="p">;;</span>
<span class="k">esac</span>
</code></pre></div></div>

<p>사용:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> +x ~/Work/80_Tools/scripts/work-run
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/80_Tools/scripts:</span><span class="nv">$PATH</span><span class="s2">"</span>
work-run
</code></pre></div></div>

<ul>
  <li>
    <p>패턴은 필요하면 추가해(예: <code class="language-plaintext highlighter-rouge">build_*.sh</code>, <code class="language-plaintext highlighter-rouge">repro.sh</code>, <code class="language-plaintext highlighter-rouge">smoke.sh</code> 등).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">fzf</code>가 있으면 퍼지 검색/프리뷰, 없으면 번호 메뉴.</p>
  </li>
</ul>

<h2 id="tcsh-work-runcsh-간단-번호-선택">tcsh: <code class="language-plaintext highlighter-rouge">work-run.csh</code> (간단 번호 선택)</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

#!/bin/tcsh -f
set W = "$HOME/Work"
if ( $?WORK_DIR ) set W = "$WORK_DIR"

set tmp = "/tmp/work-run.$$"
# 후보: scripts/*.sh, 04_Run/*.sh, 80_Tools/scripts/*.sh
find "$W" -type f \( \
  -path "$W/20_Projects/*/scripts/*.sh" -o \
  -path "$W/25_Jobs/*/04_Run/*.sh" -o \
  -path "$W/80_Tools/scripts/*.sh" \
\) | sort | sed "s|^$W/||" &gt; "$tmp"

set n = `wc -l &lt; "$tmp"`
if ( "$n" == 0 ) then
  echo "No runnable scripts found."; /bin/rm -f "$tmp"; exit 0
endif

set i = 1
foreach line (`cat "$tmp"`)
  echo "$i) $line"
  @ i++
end
echo -n "work-run&gt; "
set idx = $&lt;
set sel = `sed -n "${idx}p" "$tmp"`; /bin/rm -f "$tmp"
set full = "$W/$sel"
set dir = `dirname "$full"`; set file = `basename "$full"`
cd "$dir"
if ( "$file:e" == "sh" ) then
  chmod +x "$file" &gt;/dev/null
  ./"$file"
else
  echo "Unknown type: $file"
endif
</code></pre></div></div>

<p>사용:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

chmod +x ~/Work/80_Tools/scripts/work-run.csh
setenv PATH "$HOME/Work/80_Tools/scripts:$PATH"
work-run.csh
</code></pre></div></div>

<blockquote>
  <p>이 방식이면 <strong>여러 군데서 shortcuts를 쓰지 않아도</strong> 되고, 새 스크립트를 만들면 자동으로 메뉴에 잡혀.</p>
</blockquote>

<hr />

<h1 id="옵션-c-프로젝트-로컬-태스크-러너-로-통일">옵션 C) <strong>프로젝트 로컬 태스크 러너</strong> 로 통일</h1>

<ul>
  <li>
    <p>각 PRJ 루트에 아래 중 하나를 채택:</p>

    <ul>
      <li>
        <p><strong>Makefile</strong> : <code class="language-plaintext highlighter-rouge">make test</code>, <code class="language-plaintext highlighter-rouge">make build</code>, <code class="language-plaintext highlighter-rouge">make run</code></p>
      </li>
      <li>
        <p><strong>justfile</strong>(추천): 사람이 읽기 쉬운 문법, <code class="language-plaintext highlighter-rouge">just build</code>, <code class="language-plaintext highlighter-rouge">just test</code></p>
      </li>
      <li>
        <p><strong>Invoke/Fab</strong>(파이썬 태스크): <code class="language-plaintext highlighter-rouge">inv build</code>, <code class="language-plaintext highlighter-rouge">inv release</code></p>
      </li>
      <li>
        <p><strong>nox/tox</strong>(테스트/세션): <code class="language-plaintext highlighter-rouge">nox -s lint tests</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">10_Today</code>에서는 <strong>그 프로젝트로 cd만</strong> 하고, 나머지는 로컬 태스크로 실행.</p>
  </li>
  <li>
    <p>장점: <strong>유지보수 최소</strong> , CI/CD와 스크립트 공유 쉬움.</p>
  </li>
  <li>
    <p>단점: 프로젝트마다 태스크 정의 필요.</p>
  </li>
</ul>

<hr />

<h2 id="어느-걸-쓰면-좋을까-현실-규칙">어느 걸 쓰면 좋을까? (현실 규칙)</h2>

<ul>
  <li>
    <p><strong>초기 셋업/개인 워크스페이스</strong> : B(자동 탐색) → 관리 부담 0</p>
  </li>
  <li>
    <p><strong>안정화되면</strong> : C(프로젝트 태스크 러너)로 고정해 품질↑</p>
  </li>
  <li>
    <p><strong>매일 도는 Top10 명령이 뚜렷</strong> : A(shotcuts.list) 유지 + <code class="language-plaintext highlighter-rouge">pin</code>으로 등록을 “노가다 0”으로</p>
  </li>
</ul>

<hr />

<h2 id="보너스-혼용-예시-실전형">보너스: 혼용 예시 (실전형)</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">work-run</code>으로 전체 스크립트 <strong>퍼지 검색</strong> 해서 바로 실행</p>
  </li>
  <li>
    <p>자주 쓰는 5~10개는 <code class="language-plaintext highlighter-rouge">shortcuts.list</code>에 <strong>고정 슬롯</strong></p>
  </li>
  <li>
    <p>프로젝트 내부에는 <code class="language-plaintext highlighter-rouge">justfile</code>로 <code class="language-plaintext highlighter-rouge">build/test/run</code> 표준화</p>
  </li>
</ul>

<p>이렇게 잡으면 “여러 군데서 shortcuts를 쓴다”는 느낌 없이,<br />
<strong>한 가지 진입점(work-run 혹은 today)</strong> 만 기억하면 되고,<br />
필요할 때만 최소한으로 <code class="language-plaintext highlighter-rouge">shortcuts.list</code>를 운용하면 돼.</p>

<p class="chat--user">

만약에 교육 실험(LAB)을 따라해보고 싶다면 어디서 해야할까

</p>

<p>좋은 질문! <strong>교육 실험(LAB)</strong>은 “자료(읽기)”와 “실습(실행)”을 분리해서 관리하면 깔끔합니다.</p>

<h2 id="한-줄-결론">한 줄 결론</h2>

<ul>
  <li>
    <p><strong>자료(강의/튜토리얼/노트)</strong> : <code class="language-plaintext highlighter-rouge">40_Resources/edu/...</code> (읽기 전용 레퍼런스)</p>
  </li>
  <li>
    <p><strong>가벼운 따라하기·짧은 탐색( &lt;30분)</strong>: <code class="language-plaintext highlighter-rouge">31_Labs/jupyter/</code> (스크래치)</p>
  </li>
  <li>
    <p><strong>데이터·설정·결과를 남기는 제대로 된 실습</strong> : <code class="language-plaintext highlighter-rouge">25_Jobs/LAB-YYYY-NNN_&lt;topic&gt;/</code> (재현 가능한 구조)</p>
  </li>
</ul>

<hr />

<h1 id="어디서-무엇을-하나요">어디서 무엇을 하나요?</h1>

<h2 id="1-자료는-여기-40_resourcesedu">1) 자료는 여기: <code class="language-plaintext highlighter-rouge">40_Resources/edu/</code></h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">courses/&lt;provider&gt;/&lt;course-name&gt;/</code> : 강의 슬라이드/수업 링크</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">tutorials/&lt;topic&gt;/</code> : 튜토리얼 링크/README</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">papers/</code> : 논문 워크플로(to_read → reading_notes → summaries)</p>
  </li>
</ul>

<blockquote>
  <p>역할: “읽을거리/레퍼런스” 저장소. <strong>실행 파일이나 산출물은 두지 않음</strong>.</p>
</blockquote>

<h2 id="2-짧은-실습은-여기-31_labsjupyter">2) 짧은 실습은 여기: <code class="language-plaintext highlighter-rouge">31_Labs/jupyter/</code></h2>

<ul>
  <li>
    <p>파일 예: <code class="language-plaintext highlighter-rouge">2025-08-26_pytorch-tensor-basics.ipynb</code>, <code class="language-plaintext highlighter-rouge">regex_scratch.ipynb</code></p>
  </li>
  <li>
    <p>용도: API 감, 문법/정규식 테스트, 작은 코드 실험(5분/50줄 규칙)</p>
  </li>
  <li>
    <p>끝나고 유용하면 <strong>요약을</strong> <code class="language-plaintext highlighter-rouge">30_Areas/knowledge_base/{tips|cheatsheets|howtos}</code>로 <strong>승격</strong><br />
(예: “PyTorch 텐서 기본” 치트시트)</p>
  </li>
</ul>

<h2 id="3-본격-실습데이터산출리포트-필요은-여기-25_jobslab-yyyy-nnn_topic">3) 본격 실습(데이터·산출·리포트 필요)은 여기: <code class="language-plaintext highlighter-rouge">25_Jobs/LAB-YYYY-NNN_&lt;topic&gt;/</code></h2>

<blockquote>
  <p>LAB을 <strong>JOB의 한 타입</strong> 으로 보면 됩니다(재현성/증빙 목적).</p>
</blockquote>

<h3 id="권장-스켈레톤">권장 스켈레톤</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>25_Jobs/
  LAB-2025-012_pytorch-cnn/
    01_Brief/            - 학습 목표, 평가 기준(예: 정확도 ≥ 90%), 마감
    02_Input/
      raw/               - 원천 데이터(큰 파일은 심볼릭 링크 권장)
    03_Config/
      env.yml            - conda/venv 의존성 명세(또는 requirements.txt)
      params.yml         - 하이퍼파라미터/경로 설정
    04_Run/
      notebooks/         - 실습 노트북(실행 본문)
      run.sh|run.ps1     - 일괄실행/로그/시드고정
      manifest.json      - 자동 생성(환경/버전/체크섬)
    05_Output/
      intermediate/      - 체크포인트/중간 산출
      reports/           - 리포트 파일(HTML/PDF)
    06_Export/
      final/             - 제출/공유용 최종본
</code></pre></div></div>

<h3 id="왜-job-형태">왜 Job 형태?</h3>

<ul>
  <li>
    <p>입력/설정/실행/산출이 분리되어 <strong>다시 돌리기 쉬움</strong></p>
  </li>
  <li>
    <p>체크섬·환경 버전이 <strong>manifest로 기록</strong> → 결과 신뢰도↑</p>
  </li>
  <li>
    <p>팀/미래의 나에게 <strong>재현 가능한 증거</strong> 가 됨</p>
  </li>
</ul>

<hr />

<h1 id="실전-워크플로-lab-따라하기">실전 워크플로 (LAB 따라하기)</h1>

<h2 id="a-짧게-맛보기-유튜토리얼블로그-코드-몇-줄">A) “짧게 맛보기” (유튜토리얼/블로그 코드 몇 줄)</h2>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">40_Resources/edu/tutorials/&lt;topic&gt;/</code>에 링크/원문 저장</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">31_Labs/jupyter/2025-08-26_&lt;topic&gt;.ipynb</code>에서 바로 실습</p>
  </li>
  <li>
    <p>유용하면 → <code class="language-plaintext highlighter-rouge">30_Areas/knowledge_base/tips/&lt;topic&gt;.md</code>에 요약 10줄</p>
  </li>
</ol>

<h2 id="b-실제-데이터로-결과를-내야-함성능리포트-필요">B) “실제 데이터로 결과를 내야 함”(성능/리포트 필요)</h2>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">25_Jobs/LAB-YYYY-NNN_&lt;topic&gt;/</code> 생성</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">01_Brief/</code>에 목표/평가 기준/데이터 출처 작성</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">02_Input/raw/</code>에 데이터 배치(대용량은 경로만, 심링크 추천)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">03_Config/env.yml</code>, <code class="language-plaintext highlighter-rouge">params.yml</code> 작성</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">04_Run/notebooks/</code>에 노트북 저장, <code class="language-plaintext highlighter-rouge">run.sh</code>에서 순서·시드 고정</p>
  </li>
  <li>
    <p>실행 → <code class="language-plaintext highlighter-rouge">05_Output/</code>에 중간물, <code class="language-plaintext highlighter-rouge">06_Export/final/</code>에 최종 리포트/PDF</p>
  </li>
  <li>
    <p>성과가 재사용 가능하면, <strong>도구화</strong> 해서 <code class="language-plaintext highlighter-rouge">20_Projects/PRJ-...</code>로 승격</p>
  </li>
</ol>

<h2 id="c-lab이-결국-재사용-툴로-발전">C) “LAB이 결국 재사용 툴로 발전”</h2>

<ol>
  <li>
    <p>실습 코드에서 공통 로직을 <strong>패키지화</strong> → <code class="language-plaintext highlighter-rouge">20_Projects/PRJ-.../src/&lt;pkg&gt;/</code></p>
  </li>
  <li>
    <p>예제는 <code class="language-plaintext highlighter-rouge">20_Projects/.../examples/</code>로 옮겨 <strong>최소 실행 샘플</strong> 제공</p>
  </li>
  <li>
    <p>학습 기록/리포트는 기존 <code class="language-plaintext highlighter-rouge">LAB-...</code> Job에 그대로 보존(출처·증빙)</p>
  </li>
</ol>

<hr />

<h1 id="환경설정은-어디서">환경/설정은 어디서?</h1>

<ul>
  <li>
    <p><strong>공유/골든 설정</strong> : <code class="language-plaintext highlighter-rouge">32_SharedConfigs/</code> (예: 표준 <code class="language-plaintext highlighter-rouge">pytest.ini</code>, <code class="language-plaintext highlighter-rouge">ruff.toml</code>)</p>
  </li>
  <li>
    <p><strong>개인 설정(오버라이드)</strong> : <code class="language-plaintext highlighter-rouge">90_PersonalConfigs/</code> (셸 프로필, 개인 ruff/VSCode 등)</p>
  </li>
  <li>
    <p><strong>특정 LAB 전용 의존성</strong> : <code class="language-plaintext highlighter-rouge">LAB-.../03_Config/env.yml</code> 또는 <code class="language-plaintext highlighter-rouge">requirements.txt</code><br />
(프로젝트로 승격되면 PRJ 리포 안으로 옮기기)</p>
  </li>
</ul>

<hr />

<h1 id="today-런처자동-러너에-연결-선택">Today 런처/자동 러너에 연결 (선택)</h1>

<ul>
  <li>
    <p>그냥 콘솔에서 자주 돌리면:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">work-run</code> 자동 탐색 러너를 쓰면 <code class="language-plaintext highlighter-rouge">LAB-.../04_Run/*.sh</code>가 자동 후보에 올라옵니다.</p>
      </li>
      <li>
        <p>또는 <code class="language-plaintext highlighter-rouge">10_Today/shortcuts.list</code>에 한 줄 추가:</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Run LAB CNN | 25_Jobs/LAB-2025-012_pytorch-cnn/04_Run | ./run.sh
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h1 id="언제-어디서-할지-결정-규칙요약">언제 어디서 할지 결정 규칙(요약)</h1>

<ul>
  <li>
    <p><strong>&lt; 30분 / 재현 불요 / 개인 확인</strong> → <code class="language-plaintext highlighter-rouge">31_Labs/jupyter</code></p>
  </li>
  <li>
    <p><strong>데이터·결과·평가 필요 / 공유·재현 필요</strong> → <code class="language-plaintext highlighter-rouge">25_Jobs/LAB-YYYY-...</code></p>
  </li>
  <li>
    <p><strong>도구로 발전</strong> → <code class="language-plaintext highlighter-rouge">20_Projects/PRJ-...</code> (LAB은 기록으로 남김)</p>
  </li>
</ul>

<p>필요하면 <strong>LAB용 템플릿(Job 스캐폴드 + env/params 샘플 + run 스크립트)</strong>을 바로 만들어줄게. 어떤 주제(예: PyTorch, Pandas, NLP, 시각화)로 실습할지 알려주면 거기에 맞춰 뼈대까지 넣어 드릴 수 있어!</p>

<p class="chat--user">

25_Jobs가 엄청 뚱뚱해지네

</p>

<p>맞아—그 느낌 정상이에요. <strong>25_Jobs가 비대해지기 쉬운 폴더</strong> 라서, 구조·정책·자동화 3가지만 잡으면 금방 얇아집니다. 아래 그대로 적용해보자.</p>

<hr />

<h1 id="1-구조-25_jobs를-타입연도상태로-쪼개기">1) 구조: 25_Jobs를 “타입×연도×상태”로 쪼개기</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/
  25_Jobs/                          ← 산출 작업 루트
    _active/                        ← 지금 진행 중(12개 이내 유지)
    _templates/                     ← 복제용 스캐폴드(빈 템플릿)
    JOB/                            ← 일반 작업(연도별 보관)
      2025/
      2024/
    BUG/                            ← 배포 버그 재현/검증
      2025/
    SMOKE/                          ← 새 툴 스모크/feasibility
      2025/
    LAB/                            ← 교육 실습 중 “재현형” 실습
      2025/
    EX/                             ← 배포 예제 패키징
      2025/
    REL/                            ← 릴리스 준비/검증(Job 형태)
      2025/
</code></pre></div></div>

<ul>
  <li>
    <p>새 작업은 <strong>항상 <code class="language-plaintext highlighter-rouge">25_Jobs/_active/타입-YYYY-NNN_제목/</code></strong>로 시작 → 끝나면 <strong>동일 타입의 연도 폴더로 이동</strong>.</p>
  </li>
  <li>
    <p>템플릿은 전부 <strong><code class="language-plaintext highlighter-rouge">_templates/</code>에 모아두고</strong> 복제만 한다(중복 템플릿 방지).</p>
  </li>
</ul>

<blockquote>
  <p>예) 진행 중 버그: <code class="language-plaintext highlighter-rouge">_active/BUG-2025-013_crash_xxx/</code><br />
 완료 후 이동: <code class="language-plaintext highlighter-rouge">BUG/2025/BUG-2025-013_crash_xxx/</code></p>
</blockquote>

<hr />

<h1 id="2-정책-수명주기hot--warm--cold">2) 정책: 수명주기(Hot → Warm → Cold)</h1>

<table>
  <thead>
    <tr>
      <th>단계</th>
      <th>위치</th>
      <th>기간/기준</th>
      <th>해야 할 일</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Hot</strong></td>
      <td><code class="language-plaintext highlighter-rouge">_active/</code></td>
      <td>작업 중</td>
      <td>매일 편집, 로그/메모 살림</td>
    </tr>
    <tr>
      <td><strong>Warm</strong></td>
      <td><code class="language-plaintext highlighter-rouge">타입/2025/</code></td>
      <td><strong>완료 후 ~90일</strong></td>
      <td>중간산출물 정리, <code class="language-plaintext highlighter-rouge">05_Output/intermediate</code> 압축/삭제</td>
    </tr>
    <tr>
      <td><strong>Cold</strong></td>
      <td><code class="language-plaintext highlighter-rouge">99_Archive/25_Jobs/2025/</code></td>
      <td>90일↑ 또는 재사용 낮음</td>
      <td>전체 폴더 이동(읽기 전용), 필요 파일만 <code class="language-plaintext highlighter-rouge">70_Exports</code> 링크</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>
    <p><strong>상한선</strong> : <code class="language-plaintext highlighter-rouge">_active/</code>는 <strong>12개 이내</strong> (넘으면 가장 오래된 것부터 Warm으로 이동).</p>
  </li>
  <li>
    <p><strong>원천데이터</strong> : 큰 파일은 <code class="language-plaintext highlighter-rouge">02_Input/raw</code>에 <strong>심볼릭 링크/경로만</strong>(실파일은 별도 데이터 저장소; 아래 5번 참고).</p>
  </li>
</ul>

<hr />

<h1 id="3-인덱스-가벼운-카탈로그-1장검색정리용">3) 인덱스: 가벼운 카탈로그 1장(검색·정리용)</h1>

<p><code class="language-plaintext highlighter-rouge">25_Jobs/index.csv</code> (또는 <code class="language-plaintext highlighter-rouge">catalog.json</code>) — 최소 필드:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>job_code,type,year,title,status,owner,tags,start,end,path
JOB-2025-041,JOB,2025,"보고서 A",done,me,"report,pdf",2025-08-20,2025-08-22,25_Jobs/JOB/2025/JOB-2025-041_보고서A
BUG-2025-013,BUG,2025,"crash on save",warm,me,"win11,pyinstaller",2025-08-15,2025-08-16,25_Jobs/BUG/2025/BUG-2025-013_crash
</code></pre></div></div>

<ul>
  <li>
    <p>새 Job 만들 때 <strong>한 줄 추가</strong> → 완료 시 <code class="language-plaintext highlighter-rouge">status</code>만 <code class="language-plaintext highlighter-rouge">done</code>으로 바꿔도 검색이 편함.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">work-run</code>(자동 탐색 러너)나 간단 스크립트가 이 인덱스를 참고하면 더 빨라져요.</p>
  </li>
</ul>

<hr />

<h1 id="4-자동화-얇게-유지하는-4가지-루틴">4) 자동화: 얇게 유지하는 4가지 루틴</h1>

<h3 id="a-close--move핫--웜">A) “Close &amp; Move”(핫 → 웜)</h3>

<ul>
  <li>
    <p>종료 커밋/정리 후:</p>

    <ol>
      <li>
        <p><code class="language-plaintext highlighter-rouge">05_Output/intermediate</code> 압축 또는 삭제</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">06_Export</code>만 남기고 나머지 로그는 7~30일 보존</p>
      </li>
      <li>
        <p>폴더를 <code class="language-plaintext highlighter-rouge">타입/연도/</code>로 <strong>mv</strong></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">index.csv</code> 상태 <code class="language-plaintext highlighter-rouge">done</code> 업데이트</p>
      </li>
    </ol>
  </li>
</ul>

<h3 id="b-archive웜--콜드">B) “Archive”(웜 → 콜드)</h3>

<ul>
  <li>
    <p>90일 지난 <code class="language-plaintext highlighter-rouge">done</code> → <code class="language-plaintext highlighter-rouge">99_Archive/25_Jobs/연도/</code>로 이동</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">70_Exports</code>엔 최종본 링크 또는 복사</p>
  </li>
</ul>

<h3 id="c-thin-logs">C) “Thin Logs”</h3>

<ul>
  <li>
    <p>30일 지난 <code class="language-plaintext highlighter-rouge">*.log</code>는 <code class="language-plaintext highlighter-rouge">gzip</code></p>
  </li>
  <li>
    <p>대용량 <code class="language-plaintext highlighter-rouge">*.csv</code> 중간 산출은 해시만 남기고 삭제 가능</p>
  </li>
</ul>

<h3 id="d-top-n-active-rule">D) “Top-N Active Rule”</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">_active/</code>가 12개 초과 시 today에 경고: <strong>가장 오래된 3개</strong> 를 Warm로 이동</li>
</ul>

<blockquote>
  <p>원하면 위 4개를 묶은 <strong>주간 스윕 스크립트</strong> 도 내줄 수 있어요(쉘/PS/tcsh 버전).</p>
</blockquote>

<hr />

<h1 id="5-선택-대용량-데이터-분리">5) (선택) 대용량 데이터 분리</h1>

<p>대용량 원천/중간 데이터가 많은 편이면 아래처럼 분리하면 Jobs가 가벼워집니다.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/
  26_Data/
    raw/&lt;dataset or source&gt;/...
    cache/&lt;tool or proj&gt;/...
</code></pre></div></div>

<ul>
  <li>
    <p>Job의 <code class="language-plaintext highlighter-rouge">02_Input/raw</code>에는 <strong>심볼릭 링크</strong> 또는 <strong>경로만</strong> 두기</p>
  </li>
  <li>
    <p>데이터 버전 기록은 Job의 <code class="language-plaintext highlighter-rouge">03_Config/params.yml</code>에 해시/버전/경로로 남김</p>
  </li>
</ul>

<hr />

<h1 id="6-콘솔에서-빠르게-찾기열기-예시-스니펫">6) 콘솔에서 빠르게 찾기/열기 (예시 스니펫)</h1>

<h3 id="bashzsh-타입별상태별-리스트">Bash/Zsh: 타입별/상태별 리스트</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jobs-find<span class="o">()</span> <span class="o">{</span> find <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/25_Jobs/</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">_active</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-maxdepth</span> 2 <span class="nt">-type</span> d <span class="nt">-name</span> <span class="s2">"*-20*"</span> | <span class="nb">sort</span><span class="p">;</span> <span class="o">}</span>
jobs-open<span class="o">()</span> <span class="o">{</span> <span class="nb">cd</span> <span class="s2">"</span><span class="si">$(</span>jobs-find <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> | fzf<span class="si">)</span><span class="s2">"</span> <span class="o">||</span> <span class="k">return</span><span class="p">;</span> <span class="o">}</span>
<span class="c"># 사용: jobs-open _active  /  jobs-open BUG/2025</span>
</code></pre></div></div>

<h3 id="powershell-2">PowerShell:</h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">function</span><span class="w"> </span><span class="nf">JobsOpen</span><span class="p">(</span><span class="nv">$path</span><span class="o">=</span><span class="s2">"</span><span class="bp">$_</span><span class="s2">active"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nv">$root</span><span class="o">=</span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\25_Jobs\</span><span class="nv">$path</span><span class="s2">"</span><span class="w">
  </span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="nv">$root</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="nt">-Depth</span><span class="w"> </span><span class="nx">2</span><span class="w"> </span><span class="nt">-Directory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-GridView</span><span class="w"> </span><span class="nt">-PassThru</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-Location</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><em>(tcsh 버전도 원하면 줄게요.)</em></p>

<hr />

<h1 id="7-템플릿은-한-곳에만">7) 템플릿은 한 곳에만</h1>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">25_Jobs/_templates/</code> 에 <strong>JOB/BUG/SMOKE/LAB/EX/REL</strong> 스켈레톤 6개만 유지</p>
  </li>
  <li>
    <p>새 작업은 항상 여기서 <strong>복제</strong> → 템플릿 중복을 없애고 한 번만 관리</p>
  </li>
</ul>

<hr />

<h1 id="8-today런처와의-연동-가볍게">8) Today/런처와의 연동 (가볍게)</h1>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">_active/</code>만 <strong>런처 대상</strong> 에 포함 → 완료와 동시에 자동 제외</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">work-run</code> 자동 탐색 러너를 쓰면 <code class="language-plaintext highlighter-rouge">_active/**/04_Run/*.sh|ps1</code>만 우선 순위로 스캔</p>
  </li>
</ul>

<hr />

<h2 id="오늘-할-일3분-셋업">오늘 할 일(3분 셋업)</h2>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">25_Jobs</code> 안에 <strong><code class="language-plaintext highlighter-rouge">_active/</code>, <code class="language-plaintext highlighter-rouge">_templates/</code>, <code class="language-plaintext highlighter-rouge">JOB/2025</code>, <code class="language-plaintext highlighter-rouge">BUG/2025</code>, <code class="language-plaintext highlighter-rouge">SMOKE/2025</code>, <code class="language-plaintext highlighter-rouge">LAB/2025</code>, <code class="language-plaintext highlighter-rouge">EX/2025</code>, <code class="language-plaintext highlighter-rouge">REL/2025</code></strong> 만들기</p>
  </li>
  <li>
    <p>진행 중 Job을 전부 <code class="language-plaintext highlighter-rouge">_active/</code>로 옮기기(12개 이하로)</p>
  </li>
  <li>
    <p>완료된 것들은 타입/연도 폴더로 정리</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">index.csv</code> 초안 만들어 상단 10개만 우선 채우기</p>
  </li>
</ol>

<hr />

<h3 id="요약-2">요약</h3>

<ul>
  <li>
    <p><strong>모든 새 작업은<code class="language-plaintext highlighter-rouge">_active/</code>에서 시작 → 끝나면 타입/연도로 이동 → 오래되면 99_Archive.</strong></p>
  </li>
  <li>
    <p>템플릿은 <strong>한 군데</strong>(<code class="language-plaintext highlighter-rouge">_templates/</code>)만.</p>
  </li>
  <li>
    <p>(원하면) <strong>26_Data</strong> 로 대용량 분리.</p>
  </li>
  <li>
    <p>주간 스윕 스크립트/자동 탐색 러너로 <strong>손 가는 정리 작업 0에 가깝게</strong>.</p>
  </li>
</ul>

<p>필요하면 위 구조로 <strong>폴더/인덱스/스윕 스크립트 세트</strong> 를 바로 만들어 드릴게—쓰는 셸(bash/zsh/PowerShell/tcsh)만 알려줘!</p>

<p class="chat--user">

DB 같은 데이터셋들을 저장하고 싶을 땐 어디에 해야할까?

</p>

<p>좋은 질문! <strong>DB 같은 데이터셋</strong> 은 코드/산출과 분리해서 <strong>전용 루트</strong> 에 보관하는 게 최고예요.<br />
내역 추적·복구·용량 관리가 쉬워지고, 25_Jobs도 가벼워집니다.</p>

<hr />

<h1 id="추천-위치-work26_data-데이터-전용-루트">추천 위치: <code class="language-plaintext highlighter-rouge">Work/26_Data/</code> (데이터 전용 루트)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>26_Data/                                   ← 데이터셋 중앙 저장소
├─ registry/                               ← 카탈로그(메타데이터)
│  ├─ catalog.csv
│  └─ README.md
├─ raw/                                    ← 원본(불변) 스냅샷/덤프
│  ├─ db/
│  │  ├─ postgres/&lt;db_name&gt;/snapshots/YYYY/&lt;TS&gt;/  ← .dump(.gz) or .sql.gz
│  │  │  ├─ dump.sql.gz
│  │  │  ├─ SHA256SUMS
│  │  │  └─ manifest.yml                   ← 출처/버전/테이블/PII/라이선스 등
│  │  └─ mysql/&lt;db_name&gt;/snapshots/...
│  └─ files/&lt;source&gt;/&lt;dataset&gt;/&lt;YYYY-MM-DD&gt;/  ← CSV/JSON/ZIP 등 외부 파일 원본
├─ processed/                              ← 정제/정규화/파케이(Parquet) 등 2차 산출
│  └─ &lt;dataset&gt;/&lt;version&gt;/
├─ samples/                                ← 예제/테스트용 소용량 서브셋
│  └─ &lt;dataset&gt;/&lt;version&gt;/
├─ cache/                                  ← 일시 캐시(삭제 가능)
│  ├─ project/&lt;PRJ-slug&gt;/
│  └─ job/&lt;JOB-code&gt;/
└─ schemas/                                ← DDL/스키마(JSON/SQL)
   └─ &lt;engine&gt;/&lt;db_name&gt;/
</code></pre></div></div>

<blockquote>
  <p><strong>원칙</strong></p>

  <ul>
    <li>
      <p><code class="language-plaintext highlighter-rouge">raw/</code>는 <strong>불변(immutable)</strong> 로 취급: 덮어쓰지 말고 <strong>스냅샷을 추가</strong> 만 합니다.</p>
    </li>
    <li>
      <p><code class="language-plaintext highlighter-rouge">processed/</code>는 파생 데이터(정제/집계), <code class="language-plaintext highlighter-rouge">samples/</code>는 작은 학습/테스트셋.</p>
    </li>
    <li>
      <p><code class="language-plaintext highlighter-rouge">cache/</code>는 언제든 지워도 되는 중간물.</p>
    </li>
    <li>
      <p>큰 원본은 <strong>여기</strong> 에 두고, <strong>Job/Project에서는 경로 참조나 심볼릭 링크</strong> 만 사용.</p>
    </li>
  </ul>

</blockquote>

<hr />

<h2 id="db-덤프스냅샷-표준-네이밍">DB 덤프/스냅샷 표준 네이밍</h2>

<ul>
  <li>
    <p>디렉터리: <code class="language-plaintext highlighter-rouge">raw/db/&lt;engine&gt;/&lt;db_name&gt;/snapshots/&lt;YYYY&gt;/&lt;YYYYMMDD-HHMMSS&gt;/</code></p>
  </li>
  <li>
    <p>파일:</p>

    <ul>
      <li>
        <p>Postgres: <code class="language-plaintext highlighter-rouge">&lt;db_name&gt;_&lt;YYYYMMDD-HHMMSS&gt;.dump.gz</code> (pg_dump -Fc 후 gzip)</p>
      </li>
      <li>
        <p>MySQL: <code class="language-plaintext highlighter-rouge">&lt;db_name&gt;_&lt;YYYYMMDD-HHMMSS&gt;.sql.gz</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p>무결성: <code class="language-plaintext highlighter-rouge">SHA256SUMS</code> (여러 파일이면 모두 기록)</p>
  </li>
  <li>
    <p>메타: <code class="language-plaintext highlighter-rouge">manifest.yml</code> 예시
```yaml
dataset: postgres/salesdb
snapshot: 2025-08-26T10-20-00
source: prod-rds
pii_level: medium          # none/low/medium/high
license: internal
tables:</p>
    <ul>
      <li>customers: {rows: 120342}</li>
      <li>orders: {rows: 502113}
checksum:
  dump.sql.gz: "ab12…ef"
restore:
  engine: postgres
  target_db: salesdb_local
```</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="26_data-카탈로그인덱스-예시">26_Data 카탈로그(인덱스) 예시</h2>

<p><code class="language-plaintext highlighter-rouge">26_Data/registry/catalog.csv</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kind,engine,name,version_or_ts,tags,path,pii,notes
db,postgres,salesdb,2025-08-26T10-20-00,"prod,snapshot",raw/db/postgres/salesdb/snapshots/2025/20250826-102000,medium,"month-end"
files,ext,ad_events,2025-08-01,"ads,csv",raw/files/ad_platform/ad_events/2025-08-01,low,"export via API"
</code></pre></div></div>

<hr />

<h1 id="워크플로-db-기준-postgres-예시">워크플로 (DB 기준, Postgres 예시)</h1>

<h2 id="1-스냅샷덤프-만들기--26_data에-보관">1) 스냅샷(덤프) 만들기 → 26_Data에 보관</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 예: Postgres</span>
<span class="nv">TS</span><span class="o">=</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d-%H%M%S<span class="si">)</span>
<span class="nv">BASE</span><span class="o">=</span>~/Work/26_Data/raw/db/postgres/salesdb/snapshots/<span class="si">$(</span><span class="nb">date</span> +%Y<span class="si">)</span>
<span class="nv">DEST</span><span class="o">=</span><span class="nv">$BASE</span>/<span class="nv">$TS</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$DEST</span><span class="s2">"</span>
pg_dump <span class="nt">-Fc</span> <span class="s2">"postgresql://user:pass@host:5432/salesdb"</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$DEST</span><span class="s2">/dump.dump"</span>
<span class="nb">gzip</span> <span class="s2">"</span><span class="nv">$DEST</span><span class="s2">/dump.dump"</span>
<span class="nb">sha256sum</span> <span class="s2">"</span><span class="nv">$DEST</span><span class="s2">/dump.dump.gz"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$DEST</span><span class="s2">/SHA256SUMS"</span>
<span class="c"># manifest.yml 작성(템플릿 복사 후 수정)</span>
</code></pre></div></div>

<blockquote>
  <p><strong>MySQL</strong> : <code class="language-plaintext highlighter-rouge">mysqldump -u user -p --databases salesdb | gzip &gt; "$DEST/dump.sql.gz"</code></p>
</blockquote>

<ul>
  <li><strong>자격증명</strong> 은 <code class="language-plaintext highlighter-rouge">90_PersonalConfigs/secrets/.env-db.local</code> 같은 곳에 두고, 스크립트는 <strong>환경변수 참조</strong> 만 하세요(비밀 직접 기록 금지).</li>
</ul>

<h2 id="2-로컬-복원실험job용">2) 로컬 복원(실험/Job용)</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Postgres</span>
createdb salesdb_local
<span class="nb">gunzip</span> <span class="nt">-c</span> <span class="s2">"</span><span class="nv">$DEST</span><span class="s2">/dump.dump.gz"</span> | pg_restore <span class="nt">-d</span> salesdb_local
<span class="c"># 또는: pg_restore -d salesdb_local "$DEST/dump.dump.gz"</span>
</code></pre></div></div>

<ul>
  <li>컨테이너 사용 시(권장): <code class="language-plaintext highlighter-rouge">85_Environments/docker/docker-compose.yml</code>에 DB 서비스 정의하고,<br />
<code class="language-plaintext highlighter-rouge">26_Data/db/postgres/_volumes/&lt;name&gt;:/var/lib/postgresql/data</code> 볼륨으로 붙입니다.</li>
</ul>

<h2 id="3-jobproject에서-쓰기-링크-또는-경로-참조">3) Job/Project에서 쓰기 (링크 또는 경로 참조)</h2>

<ul>
  <li><strong>링크(맥/리눅스)</strong> :
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ln</span> <span class="nt">-s</span> ~/Work/26_Data/raw/db/postgres/salesdb/snapshots/2025/20250826-102000 <span class="se">\</span>
      ~/Work/25_Jobs/JOB-2025-041_report/02_Input/raw/salesdb_20250826
</code></pre></div>    </div>
  </li>
  <li><strong>경로 설정</strong> : <code class="language-plaintext highlighter-rouge">25_Jobs/.../03_Config/params.yml</code>에 기록
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">inputs</span><span class="pi">:</span>
  <span class="na">salesdb_snapshot</span><span class="pi">:</span> <span class="s2">"</span><span class="s">../../../26_Data/raw/db/postgres/salesdb/snapshots/2025/20250826-102000"</span>
</code></pre></div>    </div>
  </li>
  <li><strong>크레덴셜</strong> : <code class="language-plaintext highlighter-rouge">90_PersonalConfigs/secrets/.env-db.local</code>에, Job 스크립트는 <code class="language-plaintext highlighter-rouge">source</code>만.</li>
</ul>

<h2 id="4-샘플서브셋-만들기">4) 샘플/서브셋 만들기</h2>

<ul>
  <li>테이블 일부만 CSV로 덤프:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>psql salesdb_local <span class="nt">-c</span> <span class="s2">"</span><span class="se">\c</span><span class="s2">opy (SELECT * FROM customers LIMIT 1000) TO 'customers_sample.csv' CSV HEADER"</span>
<span class="nb">mv </span>customers_sample.csv ~/Work/26_Data/samples/salesdb/v2025.08/
</code></pre></div>    </div>
  </li>
  <li>반복 쓰면 스크립트화 → <code class="language-plaintext highlighter-rouge">80_Tools/scripts/make_sample_salesdb.sh</code>로 <strong>승격</strong>.</li>
</ul>

<h2 id="5-정제정규화-파이프라인">5) 정제/정규화 파이프라인</h2>

<ul>
  <li>
    <p>ETL/정제 결과는 <code class="language-plaintext highlighter-rouge">processed/&lt;dataset&gt;/&lt;version&gt;/...</code>에 저장(Parquet 권장).</p>
  </li>
  <li>
    <p>파라미터/코드/환경은 해당 Job/Project 쪽에 남기고, <strong>결과물만</strong> processed에.</p>
  </li>
</ul>

<hr />

<h1 id="보안거버넌스-체크리스트">보안/거버넌스 체크리스트</h1>

<ul>
  <li>
    <p><strong>PII/민감도 태깅</strong> : <code class="language-plaintext highlighter-rouge">manifest.yml</code>에 <code class="language-plaintext highlighter-rouge">pii_level</code> 필수.</p>
  </li>
  <li><strong>접근권한</strong> : 고(高) 민감도 스냅샷은 디스크 암호화 또는 gpg로 파일 단위 암호화:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">-c</span> dump.dump.gz   <span class="c"># 복호화는 gpg dump.dump.gz.gpg</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>보존 정책</strong> : <code class="language-plaintext highlighter-rouge">raw/</code>는 N개월 보관(예: 12개월); <code class="language-plaintext highlighter-rouge">cache/</code>는 7~30일 후 정리.</p>
  </li>
  <li><strong>.gitignore</strong> : Work 전체를 git에 올리지 않더라도, <code class="language-plaintext highlighter-rouge">26_Data</code> 루트에 보호용 <code class="language-plaintext highlighter-rouge">.gitignore</code> 권장:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>*
!registry/
!registry/catalog.csv
!.gitignore
</code></pre></div>    </div>
  </li>
</ul>

<p>(의도치 않은 업로드 방지)</p>

<hr />

<h1 id="25_jobs가-가벼워지는-이유">25_Jobs가 가벼워지는 이유</h1>

<ul>
  <li>
    <p><strong>대용량은 전부<code class="language-plaintext highlighter-rouge">26_Data</code></strong>: Job에는 <strong>링크/경로/manifest만</strong>.</p>
  </li>
  <li>
    <p>완료된 Job을 아카이브해도 데이터는 중앙(<code class="language-plaintext highlighter-rouge">26_Data</code>)에 남아 <strong>중복 저장 없음</strong>.</p>
  </li>
</ul>

<hr />

<h1 id="today런처-연결선택">Today/런처 연결(선택)</h1>

<p><code class="language-plaintext highlighter-rouge">10_Today/shortcuts.list</code> 또는 <code class="language-plaintext highlighter-rouge">work-run</code> 자동 러너에서 스냅샷·복원 스크립트를 호출:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Snapshot salesdb | 26_Data/raw/db/postgres/salesdb/snapshots | ./../../../../80_Tools/scripts/pg_snapshot_salesdb.sh
Restore salesdb  | 26_Data/raw/db/postgres/salesdb/snapshots/2025/20250826-102000 | ./../../../../80_Tools/scripts/pg_restore_local.sh
</code></pre></div></div>

<hr />

<h2 id="요약-3">요약</h2>

<ul>
  <li>
    <p><strong>데이터는<code class="language-plaintext highlighter-rouge">26_Data</code>로 일원화</strong>: <code class="language-plaintext highlighter-rouge">raw/</code>(불변) · <code class="language-plaintext highlighter-rouge">processed/</code> · <code class="language-plaintext highlighter-rouge">samples/</code> · <code class="language-plaintext highlighter-rouge">cache/</code> · <code class="language-plaintext highlighter-rouge">schemas/</code> · <code class="language-plaintext highlighter-rouge">registry/</code>.</p>
  </li>
  <li>
    <p><strong>DB 스냅샷은 엔진/DB/연도/타임스탬프</strong> 체계로 보관 + <code class="language-plaintext highlighter-rouge">manifest.yml</code> + <code class="language-plaintext highlighter-rouge">SHA256SUMS</code>.</p>
  </li>
  <li>
    <p><strong>Job/Project는 경로 참조/심링크</strong> 만 사용 → 25_Jobs 비대화 방지.</p>
  </li>
  <li>
    <p><strong>비밀/크레덴셜은<code class="language-plaintext highlighter-rouge">90_PersonalConfigs/secrets</code></strong>, 설정 표준은 <code class="language-plaintext highlighter-rouge">32_SharedConfigs</code>, 개인 오버라이드는 <code class="language-plaintext highlighter-rouge">90_PersonalConfigs</code>.</p>
  </li>
</ul>

<p>원하면 Postgres/MySQL 기준으로 <strong>스냅샷/복원 스크립트 두 개(리눅스·PowerShell·tcsh)</strong>와 <code class="language-plaintext highlighter-rouge">manifest.yml</code> 템플릿, 그리고 <code class="language-plaintext highlighter-rouge">registry/catalog.csv</code> 초기 파일까지 <strong>실제 파일</strong> 로 만들어줄게.</p>

<p class="chat--user">

그런 db는 아니고 dataset (input/output 등)을 저장하려고

</p>

<p>굿! <strong>DB 덤프가 아니라 ‘데이터셋(입력/출력)’</strong>을 보관하려는 거라면, 코드는 그대로 두고 <strong>데이터만 중앙화</strong> 하면 깔끔해요. 아래처럼 정리하면 됩니다.</p>

<hr />

<h1 id="한-줄-요약">한 줄 요약</h1>

<ul>
  <li>
    <p><strong>중앙 저장소</strong> : <code class="language-plaintext highlighter-rouge">Work/26_Data/</code></p>
  </li>
  <li>
    <p><strong>입력 데이터셋</strong> : <code class="language-plaintext highlighter-rouge">26_Data/datasets/…</code></p>
  </li>
  <li>
    <p><strong>가공/출력 데이터셋</strong>(여러 Job에서 재사용할 가치가 있는 결과): <code class="language-plaintext highlighter-rouge">26_Data/derived/…</code></p>
  </li>
  <li>
    <p><strong>Job/Project</strong> 에서는 <strong>경로 참조 또는 심볼릭 링크만 사용</strong> (복사 금지)</p>
  </li>
</ul>

<hr />

<h1 id="폴더-구조권장">폴더 구조(권장)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>26_Data/                                  ← 데이터 전용 루트
├─ registry/                               ← 카탈로그/색인
│  ├─ catalog.csv                          ← 데이터셋 목록/버전/경로
│  └─ README.md                            ← 등록 규칙
├─ datasets/                               ← “입력” 데이터셋(원본/정제)
│  └─ &lt;dataset_name&gt;/
│     └─ vYYYY.MMDD/                       ← 날짜 버전 추천(또는 semver)
│        ├─ raw/                           ← 주로 외부 원본(가급적 불변)
│        ├─ interim/                       ← 일시 정제(중간물)
│        ├─ processed/                     ← 분석/모델에 투입 가능한 정제본
│        ├─ samples/                       ← 소용량 서브셋(테스트/예제)
│        ├─ docs/                          ← README, dataset_card.md
│        ├─ manifest.yml                   ← 출처/라이선스/체크섬 등 메타
│        └─ SHA256SUMS                     ← 무결성
├─ derived/                                ← “출력/가공 결과” 데이터셋(재사용 가치 있음)
│  └─ &lt;artifact_name&gt;/
│     └─ vYYYY.MMDD/
│        ├─ data/                          ← 결과물(예: parquet/csv/images)
│        ├─ metrics/                       ← 점수/리포트/지표
│        ├─ docs/
│        ├─ manifest.yml
│        └─ SHA256SUMS
└─ cache/                                  ← 언제 지워도 되는 캐시(속도용)
</code></pre></div></div>

<blockquote>
  <p><strong>의미</strong></p>

  <ul>
    <li>
      <p><code class="language-plaintext highlighter-rouge">datasets/</code> = 입력 측 “공급원” 저장소</p>
    </li>
    <li>
      <p><code class="language-plaintext highlighter-rouge">derived/</code> = 여러 Job에서 재사용할 <strong>결과물</strong> 저장소(“출력 데이터셋” 승격본)</p>
    </li>
    <li>
      <p>Job 안의 <code class="language-plaintext highlighter-rouge">06_Export</code>는 <strong>전달본</strong> 이고, 장기 재사용 가치가 생기면 <code class="language-plaintext highlighter-rouge">derived/</code>로 승격</p>
    </li>
  </ul>

</blockquote>

<hr />

<h1 id="네이밍--메타짧게">네이밍 &amp; 메타(짧게)</h1>

<ul>
  <li>
    <p><strong>버전</strong> : <code class="language-plaintext highlighter-rouge">vYYYY.MMDD</code> (예: <code class="language-plaintext highlighter-rouge">v2025.0825</code>) 권장. 바꾸면 <code class="language-plaintext highlighter-rouge">manifest.yml</code>에 이유 기록.</p>
  </li>
  <li>
    <p><strong>파일 형식</strong> : 가능하면 <strong>Parquet</strong>(열 지향, 스키마/압축 유리), 그 외 CSV/JSON.</p>
  </li>
  <li><strong>manifest.yml 예시</strong>
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">ad_events</span>
<span class="na">version</span><span class="pi">:</span> <span class="s">v2025.0826</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">dataset</span>            <span class="c1"># or derived</span>
<span class="na">license</span><span class="pi">:</span> <span class="s">internal</span>
<span class="na">source</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ad_platform</span><span class="nv"> </span><span class="s">export</span><span class="nv"> </span><span class="s">API"</span>
<span class="na">schema</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">rows</span><span class="pi">:</span> <span class="nv">5_021_113</span><span class="pi">,</span> <span class="nv">format</span><span class="pi">:</span> <span class="nv">parquet</span><span class="pi">}</span>
<span class="na">pii_level</span><span class="pi">:</span> <span class="s">low</span>           <span class="c1"># none/low/medium/high</span>
<span class="na">checksum</span><span class="pi">:</span>
  <span class="na">processed/events.parquet</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ab12...ef"</span>
<span class="na">notes</span><span class="pi">:</span> <span class="s2">"</span><span class="s">tz</span><span class="nv"> </span><span class="s">normalized</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">UTC,</span><span class="nv"> </span><span class="s">invalid</span><span class="nv"> </span><span class="s">rows</span><span class="nv"> </span><span class="s">dropped"</span>
</code></pre></div>    </div>
  </li>
  <li><strong>dataset_card.md</strong> : 용도/전처리/열 설명/예시 쿼리 1~2개만.</li>
</ul>

<hr />

<h1 id="jobproject에서-쓰는-법복사-금지-링크경로-참조">Job/Project에서 쓰는 법(복사 금지! 링크/경로 참조)</h1>

<h3 id="심볼릭-링크맥리눅스">심볼릭 링크(맥/리눅스)</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ln</span> <span class="nt">-s</span> ~/Work/26_Data/datasets/ad_events/v2025.0826/processed <span class="se">\</span>
      ~/Work/25_Jobs/JOB-2025-041_report/02_Input/raw/ad_events
</code></pre></div></div>

<h3 id="powershell윈도우-디렉터리-링크">PowerShell(윈도우, 디렉터리 링크)</h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cmd</span><span class="w"> </span><span class="nx">/c</span><span class="w"> </span><span class="nx">mklink</span><span class="w"> </span><span class="nx">/D</span><span class="w"> </span><span class="err">^</span><span class="w">
  </span><span class="s2">"%USERPROFILE%\Work\25_Jobs\JOB-2025-041_report\02_Input\raw\ad_events"</span><span class="w"> </span><span class="err">^</span><span class="w">
  </span><span class="s2">"%USERPROFILE%\Work\26_Data\datasets\ad_events\v2025.0826\processed"</span><span class="w">
</span></code></pre></div></div>

<h3 id="job-설정에-경로-기입">Job 설정에 경로 기입</h3>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 25_Jobs/.../03_Config/params.yml</span>
<span class="na">inputs</span><span class="pi">:</span>
  <span class="na">ad_events_dir</span><span class="pi">:</span> <span class="s2">"</span><span class="s">../../../26_Data/datasets/ad_events/v2025.0826/processed"</span>
</code></pre></div></div>

<hr />

<h1 id="워크플로우간단">워크플로우(간단)</h1>

<h2 id="a-새-입력-데이터셋-추가">A) 새 “입력” 데이터셋 추가</h2>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">26_Data/datasets/&lt;name&gt;/vYYYY.MMDD/</code> 생성</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">raw/</code>에 원본 배치 → 필요 시 <code class="language-plaintext highlighter-rouge">interim/</code>→<code class="language-plaintext highlighter-rouge">processed/</code> 정제</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">manifest.yml</code>/<code class="language-plaintext highlighter-rouge">dataset_card.md</code>/<code class="language-plaintext highlighter-rouge">SHA256SUMS</code> 작성</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">registry/catalog.csv</code>에 한 줄 등록</p>
  </li>
</ol>

<h2 id="b-job에서-사용">B) Job에서 사용</h2>

<ol>
  <li>
    <p>심링크 or <code class="language-plaintext highlighter-rouge">params.yml</code>에 절대/상대 경로 지정</p>
  </li>
  <li>
    <p>실행 시 <strong>입력버전</strong> 을 매니페스트에 기록(재현성)</p>
  </li>
</ol>

<h2 id="c-job-출력을-재사용-데이터셋으로-승격">C) Job “출력”을 재사용 데이터셋으로 승격</h2>

<ol>
  <li>
    <p>Job의 <code class="language-plaintext highlighter-rouge">06_Export</code> 결과 중 <strong>일반화된 산출물</strong> 만 추려</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">26_Data/derived/&lt;artifact&gt;/vYYYY.MMDD/</code>에 배치</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">manifest.yml</code>과 지표(<code class="language-plaintext highlighter-rouge">metrics/</code>) 작성 → <code class="language-plaintext highlighter-rouge">catalog.csv</code> 등록</p>
  </li>
</ol>

<h2 id="d-정리청소">D) 정리/청소</h2>

<ul>
  <li>
    <p>60~90일 지난 <code class="language-plaintext highlighter-rouge">interim/</code>, 대용량 CSV는 <strong>압축 또는 삭제</strong>(hash/로그만 보존)</p>
  </li>
  <li>
    <p><strong>cache/</strong>는 언제든 삭제 가능</p>
  </li>
</ul>

<hr />

<h1 id="do--dont-1">Do / Don’t</h1>

<ul>
  <li>
    <p>✅ <strong>중앙화</strong> : 입력/출력 데이터셋은 <strong>26_Data</strong> 에만, Job/Project는 링크/경로만</p>
  </li>
  <li>
    <p>✅ <strong>버전 고정</strong> : Job 매니페스트에 <strong>dataset 버전</strong> 을 박아두기</p>
  </li>
  <li>
    <p>✅ <strong>작은 샘플</strong> : <code class="language-plaintext highlighter-rouge">samples/</code>를 만들어 테스트/예제에 활용</p>
  </li>
  <li>
    <p>❌ <strong>복사본 남기기</strong> : Job 안에 원본 데이터를 복제해서 쌓지 않기</p>
  </li>
  <li>
    <p>❌ <strong>비밀 넣기</strong> : 자격증명/토큰은 <code class="language-plaintext highlighter-rouge">90_PersonalConfigs/secrets/</code>에만</p>
  </li>
</ul>

<hr />

<p>원하면 <strong>초기 스캐폴드(폴더/manifest 템플릿/csv 카탈로그)</strong>와<br />
<code class="language-plaintext highlighter-rouge">symlink</code>/<code class="language-plaintext highlighter-rouge">catalog 등록</code>을 자동으로 해주는 간단 스크립트(bash·PowerShell·tcsh)도 바로 만들어 줄게.</p>

<p class="chat--user">

번호는 26번 괜찮아?

</p>

<p>짧은 결론: <strong>네, 26번 아주 괜찮아요.</strong><br />
지금 쓰는 번호 체계(20=Projects, 25=Jobs, 30대=운영/학습, 40=레퍼런스…)에서 <strong>데이터셋은 Jobs보다 살짝 뒤</strong> 에 두면 “코드→실행→데이터 자산” 흐름이 자연스럽고, 26은 그 목적에 딱 맞습니다.</p>

<hr />

<h2 id="왜-26인가-step-by-step">왜 26인가 (step-by-step)</h2>

<ol>
  <li>
    <p><strong>시각적 그룹화</strong> :<br />
<code class="language-plaintext highlighter-rouge">20_Projects → 25_Jobs → 26_(Data|Datasets) → 30_Areas</code><br />
= 코드 → 실행 → <strong>데이터 자산(공유 입력/출력)</strong> → 장기 운영 순서로 정렬.</p>
  </li>
  <li>
    <p><strong>근접성</strong> :<br />
Job이 쓰는 입력/출력 경로를 <strong>한 단계 옆(25↔26)</strong> 에 두면 경로 참조/심볼릭 링크가 짧고 관리가 쉬움.</p>
  </li>
  <li>
    <p><strong>확장 여지</strong> :<br />
27~29 비워둬서, 나중에 <code class="language-plaintext highlighter-rouge">27_ModelStore</code>, <code class="language-plaintext highlighter-rouge">28_FeatureStore</code> 같은 확장도 자연스럽게 끼워 넣기 가능.</p>
  </li>
</ol>

<hr />

<h2 id="이름은-26_data-vs-26_datasets-중-택1">이름은 <code class="language-plaintext highlighter-rouge">26_Data</code> vs <code class="language-plaintext highlighter-rouge">26_Datasets</code> 중 택1</h2>

<ul>
  <li>
    <p><strong>26_Datasets</strong> : “입력/출력 데이터셋”에 초점(당신 목적에 가장 명확)</p>
  </li>
  <li>
    <p><strong>26_Data</strong> : DB 덤프·원천 파일·캐시까지 <strong>넓게</strong> 포함할 때</p>
  </li>
</ul>

<blockquote>
  <p>지금 대화 맥락상 <strong><code class="language-plaintext highlighter-rouge">26_Datasets</code></strong> 추천. (원하면 <code class="language-plaintext highlighter-rouge">datasets/derived/cache/registry</code> 하위 그대로 유지)</p>
</blockquote>

<p>예시:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>26_Datasets/
  registry/         # 카탈로그
  datasets/         # 입력 데이터셋(버전별: vYYYY.MMDD)
  derived/          # 여러 Job에서 재사용할 출력 데이터셋(승격본)
  cache/            # 삭제 가능 캐시
</code></pre></div></div>

<hr />

<h2 id="이미-만들어-둔-구조와의-연결-규칙요약">이미 만들어 둔 구조와의 연결 규칙(요약)</h2>

<ul>
  <li>
    <p><strong>Job/Project에는 복사 금지</strong> → <strong>심볼릭 링크/경로만</strong> 참조</p>
  </li>
  <li>
    <p>Job 매니페스트에 <strong>dataset 버전</strong> 기록(재현성)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">06_Export</code>의 결과 중 “재사용 가치” 있는 건 <code class="language-plaintext highlighter-rouge">26_Datasets/derived</code>로 <strong>승격</strong></p>
  </li>
</ul>

<hr />

<h2 id="바꾸고-싶을-때안전-리네임">바꾸고 싶을 때(안전 리네임)</h2>

<p>bash/zsh:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/Work
<span class="nb">mv </span>26_Data 26_Datasets 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
sed</span> <span class="nt">-i</span> <span class="s1">''</span> <span class="s1">'s#/26_Data/#/26_Datasets/#g'</span> 10_Today/shortcuts.list 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>
</code></pre></div></div>

<p>PowerShell:</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Rename-Item</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\26_Data"</span><span class="w"> </span><span class="s2">"26_Datasets"</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
</span><span class="p">(</span><span class="n">Get-Content</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\10_Today\shortcuts.list"</span><span class="p">)</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'/26_Data/'</span><span class="p">,</span><span class="s1">'/26_Datasets/'</span><span class="w"> </span><span class="o">|</span><span class="w">
  </span><span class="n">Set-Content</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\10_Today\shortcuts.list"</span><span class="w">
</span></code></pre></div></div>

<hr />

<h2 id="최종-추천-한-줄">최종 추천 한 줄</h2>

<ul>
  <li><strong>번호는 26 유지</strong> , 이름은 <strong><code class="language-plaintext highlighter-rouge">26_Datasets</code></strong>로 명확성↑ — 지금 쓰는 워크플로(25_Jobs, 75_Releases, 32_SharedConfigs, 90_PersonalConfigs)와도 정렬이 아주 잘 맞습니다.</li>
</ul>

<p class="chat--user">

전체 구조를 마지막으로 한 번 만들어줘(띄어쓰기 대신에 폴더 선을 이용해서 표현해줬으면 좋겠어, 폴더명은 영어, 설명은 한글로). 그리고 사용 시 주요 주의점도 밑에 써줘.

</p>

<p>아래 트리를 그대로 복붙해서 문서에 쓰면 돼요.<br />
(좌측은 <strong>폴더명(영문)</strong> , <code class="language-plaintext highlighter-rouge">-</code> 오른쪽은 <strong>설명(한글)</strong> 입니다. 하위 예시도 넣었어요.)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/                                           - 1인 개발용 작업 루트
├─ 00_Inbox/                                    - 급히 던져두는 임시함(매일/주기적 비우기)
├─ 10_Today/                                    - 오늘 작업 대시보드(콘솔 실행 출발점)
│  ├─ shortcuts.list                             - today 런처가 읽는 "라벨 | 경로 | 명령" 목록
│  └─ wrappers/                                  - 파이프/복잡 인자용 임시 래퍼 스크립트(단기 보관)
├─ 20_Projects/                                 - 툴(파이썬 패키지) 개발(코드 수명 중심)
│  └─ PRJ-YYYY-NNN_name/                         - 개별 프로젝트(예: PRJ-2025-001_sample_app)
│     ├─ src/&lt;package_name&gt;/                     - 패키지 소스(예: sample_app/)
│     ├─ tests/                                  - pytest 테스트
│     ├─ scripts/                                - install/run/build/lint/test 스크립트(.sh/.ps1)
│     ├─ examples/{data,scripts,docs}/           - 배포용 최소 실행 예제
│     ├─ issues/BUG-YYYY-NNN/                    - 버그/개선 이슈 노트
│     ├─ docs/                                   - 설계·ADR·가이드
│     ├─ .devcontainer/                          - 개발 컨테이너 설정
│     └─ pyproject.toml, README.md, .gitignore, .editorconfig
├─ 25_Jobs/                                     - “산출물 작업 단위”(프로세스 수명 중심)
│  ├─ _active/                                   - 진행 중 작업(최대 12개 유지)
│  ├─ _templates/                                - 복제용 스캐폴드(JOB/BUG/SMOKE/LAB/EX/REL)
│  ├─ JOB/                                       - 일반 산출 작업(연도별 보관)
│  │  └─ 2025/
│  ├─ BUG/                                       - 배포 버그 재현/증거/검증
│  │  └─ 2025/
│  ├─ SMOKE/                                     - 새 툴 스모크/feasibility
│  │  └─ 2025/
│  ├─ LAB/                                       - 재현형 교육 실습
│  │  └─ 2025/
│  ├─ EX/                                        - 배포 예제 패키징
│  │  └─ 2025/
│  └─ REL/                                       - 릴리스 준비/검증(Job 형태)
│     └─ 2025/
├─ 26_Datasets/                                 - 데이터셋 중앙 저장소(입력/출력 자산)
│  ├─ registry/                                   - 카탈로그(색인)
│  │  ├─ catalog.csv                              - 데이터셋 목록/버전/경로
│  │  └─ README.md                                - 등록 규칙
│  ├─ datasets/                                   - “입력” 데이터셋(원본/정제)
│  │  └─ &lt;dataset_name&gt;/vYYYY.MMDD/               - 날짜 버전 권장(예: v2025.0826)
│  │     ├─ raw/                                  - 외부 원본(불변 취급)
│  │     ├─ interim/                              - 일시 정제(중간물)
│  │     ├─ processed/                            - 분석/모델 투입용 정제본
│  │     ├─ samples/                              - 소용량 서브셋(테스트/예제)
│  │     ├─ docs/                                 - README, dataset_card.md
│  │     ├─ manifest.yml                          - 출처/스키마/체크섬/라이선스
│  │     └─ SHA256SUMS                            - 무결성 체크섬
│  ├─ derived/                                    - 재사용 가치 있는 “출력” 데이터셋(승격본)
│  │  └─ &lt;artifact_name&gt;/vYYYY.MMDD/
│  │     ├─ data/                                 - 결과물(예: parquet/csv/images)
│  │     ├─ metrics/                              - 점수·지표·리포트
│  │     ├─ docs/, manifest.yml, SHA256SUMS
│  └─ cache/                                      - 언제 지워도 되는 캐시
├─ 30_Areas/                                    - 장기 운영 영역(지속 업무)
│  ├─ worklog/YYYY/YY-MM/DATE.md                 - 일일/주간 5줄 로그
│  ├─ environments/                               - 공통 환경 전략(예: 파이썬 버전 정책)
│  └─ knowledge_base/{tips,cheatsheets,howtos}/   - 축적 지식: 팁/치트시트/가이드
├─ 31_Labs/                                     - 실험실(짧은 실습/프로토타입; 재현 불필요)
│  └─ jupyter/                                   - 스크래치 노트북(예: regex_scratch.ipynb)
├─ 32_SharedConfigs/                            - 공유/골든 설정(문서화·재사용)
│  ├─ global/{vscode,ruff,pytest,pyinstaller,pyside6,jupyter}/
│  └─ projects/&lt;project_slug&gt;/                   - 특정 프로젝트 기본설정
├─ 40_Resources/                                - 참고 자료(교육/매뉴얼/스펙—설정 제외)
│  ├─ edu/{courses,tutorials,papers/{to_read,reading_notes,summaries}}/
│  ├─ manuals/&lt;vendor&gt;/&lt;product&gt;/&lt;version&gt;/      - 매뉴얼/가이드(PDF/HTML/MD)
│  └─ reference/                                 - 표준/스펙 문서 등 읽을거리
├─ 50_Snippets/{sql,text,bash}/                 - 재사용 코드/문구 조각(짧은 예제·원라이너)
├─ 60_Assets/                                   - 로고/폰트/템플릿 등 브랜딩 리소스
├─ 70_Exports/                                  - 여러 Job의 “최종 전달본” 모아보기(선택)
├─ 75_Releases/                                 - 유저 배포 전용(버전드)
│  └─ &lt;project_slug&gt;/
│     ├─ vX.Y.Z/{installers,wheels,portable,docs,licenses,checksums,ReleaseNotes.md}
│     └─ latest/                                - 최신 버전 포인터
├─ 80_Tools/                                    - 설치파일/포터블/자동화 스크립트
│  ├─ installers/                                - 오프라인 설치 + install_notes.md(버전·체크섬)
│  ├─ bin/                                       - 포터블 실행파일(PATH 추가 가능)
│  ├─ scripts/                                   - bootstrap/release/checksum 등 공용 스크립트
│  └─ devcontainer/                              - 개발 컨테이너 도구
├─ 85_Environments/                             - 재현 가능한 개발 환경 샘플
│  ├─ conda/environment.yml
│  ├─ venv/README.md
│  └─ docker/Dockerfile
├─ 90_PersonalConfigs/                          - 개인 설정(오버라이드·비공개)
│  ├─ os/{mac,win,linux}/                        - OS별 설정(키맵/입력기 등)
│  ├─ shell/{bash,zsh,tcsh,powershell}/          - 프로필·별칭
│  ├─ editors/vscode/{settings.user.json,keybindings.user.json}
│  ├─ git/.gitconfig.local
│  ├─ python/{pip.conf,poetry.toml,pypirc}
│  ├─ tools/                                     - 각 툴 개인 프리셋
│  ├─ secrets/README.md                          - (실제 비밀은 두지 말 것)
│  └─ .gitignore                                 - *.local, secrets/*, *.pem 등 넓게 제외
└─ 99_Archive/                                  - 완료 Project/Job/자료 장기 보관(읽기 전용)
</code></pre></div></div>

<hr />

<h2 id="사용-시-주요-주의점-핵심-체크리스트">사용 시 주요 주의점 (핵심 체크리스트)</h2>

<ol>
  <li>
    <p><strong>단일 정본 원칙</strong></p>

    <ul>
      <li>
        <p>코드 정본은 <code class="language-plaintext highlighter-rouge">20_Projects/</code>, 산출 파이프라인은 <code class="language-plaintext highlighter-rouge">25_Jobs/</code>, 데이터셋은 <code class="language-plaintext highlighter-rouge">26_Datasets/</code>에만 둡니다.</p>
      </li>
      <li>
        <p>다른 위치에는 <strong>복사하지 말고</strong> 경로 참조/심볼릭 링크만 사용하세요.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>10_Today는 ‘대시보드’</strong></p>

    <ul>
      <li>
        <p>원본을 옮기지 않습니다. 링크/런처만 두고, 편집은 본래 위치에서.</p>
      </li>
      <li>
        <p>콘솔 위주면 <code class="language-plaintext highlighter-rouge">shortcuts.list</code> 또는 <code class="language-plaintext highlighter-rouge">work-run</code> 자동 탐색 러너만 사용.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>25_Jobs 비대화 방지</strong></p>

    <ul>
      <li>
        <p>새 작업은 항상 <code class="language-plaintext highlighter-rouge">25_Jobs/_active/타입-YYYY-NNN_제목/</code>에서 시작 → 완료 즉시 <code class="language-plaintext highlighter-rouge">타입/연도/</code>로 이동.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">_active/</code>는 최대 12개 규칙, 30일 지난 로그는 압축, 중간물은 정리.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>데이터 버전/무결성</strong></p>

    <ul>
      <li>
        <p>입력/출력 데이터셋은 <code class="language-plaintext highlighter-rouge">vYYYY.MMDD</code> 버전으로 관리하고 <code class="language-plaintext highlighter-rouge">manifest.yml</code> + <code class="language-plaintext highlighter-rouge">SHA256SUMS</code>를 필수 기록.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">26_Datasets/cache/</code>는 언제든 삭제 가능. 중요한 데이터는 <code class="language-plaintext highlighter-rouge">raw/</code> 또는 <code class="language-plaintext highlighter-rouge">processed/</code>에.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>설정 레이어링(우선순위)</strong></p>

    <ul>
      <li>
        <p>Project 로컬 → <code class="language-plaintext highlighter-rouge">90_PersonalConfigs</code>(개인 오버라이드) → <code class="language-plaintext highlighter-rouge">32_SharedConfigs/projects/&lt;proj&gt;</code> → <code class="language-plaintext highlighter-rouge">32_SharedConfigs/global</code>.</p>
      </li>
      <li>
        <p>VSCode/ruff/pytest 등은 <code class="language-plaintext highlighter-rouge">*.local.*</code>로 개인 설정을 분리하면 충돌 최소화.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>보안/비밀 관리</strong></p>

    <ul>
      <li>
        <p>자격증명/토큰/키는 <code class="language-plaintext highlighter-rouge">90_PersonalConfigs/secrets/</code>에만 두고, 코드/스크립트는 <strong>환경변수로 읽기</strong>.</p>
      </li>
      <li>
        <p>레포에 올릴 땐 <code class="language-plaintext highlighter-rouge">.gitignore</code>가 비밀/대용량을 확실히 제외하는지 확인.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>깊이 제한 &amp; 네이밍</strong></p>

    <ul>
      <li>
        <p>폴더 깊이는 <strong>최대 3단</strong> 을 목표로(탐색/권한/동기화 이슈 감소).</p>
      </li>
      <li>
        <p>규칙적 네이밍: <code class="language-plaintext highlighter-rouge">PRJ-연도-번호_이름</code>, <code class="language-plaintext highlighter-rouge">JOB/BUG/SMOKE/LAB/EX/REL-연도-번호_이름</code>, 파일은 <code class="language-plaintext highlighter-rouge">YYYY-MM-DD_제목_v001.ext</code>.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>릴리스 품질 보장</strong></p>

    <ul>
      <li>
        <p>배포는 항상 <code class="language-plaintext highlighter-rouge">75_Releases/&lt;project&gt;/vX.Y.Z/</code>로만 공유. checksums/와 <code class="language-plaintext highlighter-rouge">ReleaseNotes.md</code> 포함.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">latest/</code> 업데이트 시 실제 버전 폴더 내용과 일치 확인.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>대용량 데이터 분리 고려</strong></p>

    <ul>
      <li>정말 큰 원천/캐시는 <code class="language-plaintext highlighter-rouge">26_Datasets</code> 하위에만 두고, Job/Project에는 링크로만 연결. 백업 정책도 별도로.</li>
    </ul>
  </li>
  <li>
    <p><strong>운영 루틴</strong></p>
  </li>
</ol>

<ul>
  <li>
    <p>매일: <code class="language-plaintext highlighter-rouge">00_Inbox</code> 비우기, Today 정리.</p>
  </li>
  <li>
    <p>주 1회: <code class="language-plaintext highlighter-rouge">_active</code> 슬림화, <code class="language-plaintext highlighter-rouge">shortcuts.list</code> Top10 유지, 로그 압축.</p>
  </li>
  <li>
    <p>월 1회: 데이터 카탈로그 갱신, 불용 Job/데이터 아카이브.</p>
  </li>
</ul>

<p>필요하면 이 구조를 <strong>초기 폴더/README/샘플 파일 세트</strong> 로 바로 생성해 드릴게요. (선호 셸: bash/zsh/tcsh/PowerShell 알려주면 해당 스크립트도 포함해서!)</p>

<p class="chat--user">

manifest.yml는 어떻게 작성해야해? 그리고 checksum는 어떻게 만들어?

</p>

<p>좋아! <strong>manifest.yml</strong> 은 “이 데이터셋이 무엇이며, 어디서 왔고, 어떻게 만들었고, 무엇으로 검증했는가”를 기록하는 <strong>증빙 카드</strong> 예요.<br />
<strong>checksum</strong> 은 파일 무결성을 확인하기 위한 <strong>지문</strong> 이고, 보통 <code class="language-plaintext highlighter-rouge">SHA256SUMS</code>라는 텍스트 파일로 함께 둡니다.</p>

<p>아래를 그대로 따라 하면 됩니다.</p>

<hr />

<h1 id="1-manifestyml-작성-가이드">1) <code class="language-plaintext highlighter-rouge">manifest.yml</code> 작성 가이드</h1>

<h2 id="위치">위치</h2>

<ul>
  <li>각 버전 루트에 둡니다.<br />
예:<br />
<code class="language-plaintext highlighter-rouge">Work/26_Datasets/datasets/&lt;dataset_name&gt;/vYYYY.MMDD/manifest.yml</code><br />
<code class="language-plaintext highlighter-rouge">Work/26_Datasets/derived/&lt;artifact_name&gt;/vYYYY.MMDD/manifest.yml</code></li>
</ul>

<h2 id="최소-필수-필드-작게-시작">최소 필수 필드 (작게 시작)</h2>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">ad_events</span>                  <span class="c1"># 데이터셋/아티팩트 이름</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">dataset</span>                    <span class="c1"># dataset | derived</span>
<span class="na">version</span><span class="pi">:</span> <span class="s">v2025.0826</span>             <span class="c1"># 버전(권장: vYYYY.MMDD)</span>
<span class="na">created_at</span><span class="pi">:</span> <span class="s">2025-08-26T14:30:00+09:00</span>
<span class="na">owner</span><span class="pi">:</span> <span class="s">your.name@company.com</span>

<span class="na">source</span><span class="pi">:</span>                          <span class="c1"># 어디서 왔는가(입력 데이터셋이면 필수)</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">external</span>                 <span class="c1"># external | internal | manual</span>
  <span class="na">detail</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ad_platform</span><span class="nv"> </span><span class="s">export</span><span class="nv"> </span><span class="s">API</span><span class="nv"> </span><span class="s">v3"</span>

<span class="na">schema</span><span class="pi">:</span>                          <span class="c1"># 간단 스키마(요약)</span>
  <span class="na">format</span><span class="pi">:</span> <span class="s">parquet</span>                <span class="c1"># parquet | csv | json | image | ...</span>
  <span class="na">rows</span><span class="pi">:</span> <span class="m">5021113</span>
  <span class="na">columns</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">{</span><span class="nv">name</span><span class="pi">:</span> <span class="nv">event_id</span><span class="pi">,</span> <span class="nv">type</span><span class="pi">:</span> <span class="nv">string</span><span class="pi">}</span>
    <span class="pi">-</span> <span class="pi">{</span><span class="nv">name</span><span class="pi">:</span> <span class="nv">ts_utc</span><span class="pi">,</span>   <span class="nv">type</span><span class="pi">:</span> <span class="nv">timestamp</span><span class="pi">}</span>
    <span class="pi">-</span> <span class="pi">{</span><span class="nv">name</span><span class="pi">:</span> <span class="nv">campaign</span><span class="pi">,</span> <span class="nv">type</span><span class="pi">:</span> <span class="nv">string</span><span class="pi">}</span>
    <span class="pi">-</span> <span class="pi">{</span><span class="nv">name</span><span class="pi">:</span> <span class="nv">cost</span><span class="pi">,</span>     <span class="nv">type</span><span class="pi">:</span> <span class="nv">float</span><span class="pi">}</span>

<span class="na">pii_level</span><span class="pi">:</span> <span class="s">low</span>                   <span class="c1"># none | low | medium | high</span>
<span class="na">license</span><span class="pi">:</span> <span class="s">internal</span>                <span class="c1"># 라이선스/사용 제한</span>

<span class="na">files</span><span class="pi">:</span>                           <span class="c1"># 포함 파일 요약(상대경로)</span>
  <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">processed/events.parquet</span>
    <span class="na">bytes</span><span class="pi">:</span> <span class="m">812345678</span>
    <span class="na">sha256</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ab12...ef"</span>          <span class="c1"># 선택(있으면 SHA256SUMS와 동일해야 함)</span>

<span class="na">notes</span><span class="pi">:</span> <span class="s2">"</span><span class="s">tz</span><span class="nv"> </span><span class="s">normalized</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">UTC,</span><span class="nv"> </span><span class="s">invalid</span><span class="nv"> </span><span class="s">rows</span><span class="nv"> </span><span class="s">dropped"</span>
</code></pre></div></div>

<h2 id="파생derived-데이터셋일-때의-추가-필드">파생(derived) 데이터셋일 때의 추가 필드</h2>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">kind</span><span class="pi">:</span> <span class="s">derived</span>
<span class="na">lineage</span><span class="pi">:</span>                          <span class="c1"># 어떤 입력/코드/실행에서 나왔는가</span>
  <span class="na">inputs</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">{</span><span class="nv">name</span><span class="pi">:</span> <span class="nv">ad_events</span><span class="pi">,</span> <span class="nv">version</span><span class="pi">:</span> <span class="nv">v2025.0826</span><span class="pi">,</span> <span class="nv">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">../../../datasets/ad_events/v2025.0826/processed"</span><span class="pi">}</span>
  <span class="na">code</span><span class="pi">:</span>
    <span class="na">repo</span><span class="pi">:</span> <span class="s2">"</span><span class="s">PRJ-2025-001_sample_app"</span>       <span class="c1"># 또는 Git URL</span>
    <span class="na">commit</span><span class="pi">:</span> <span class="s2">"</span><span class="s">a1b2c3d"</span>                     <span class="c1"># 생성에 사용한 커밋/태그</span>
  <span class="na">job</span><span class="pi">:</span>
    <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">JOB-2025-041_reportX"</span>            <span class="c1"># (있으면) 생산 Job 코드</span>

<span class="na">metrics</span><span class="pi">:</span>                          <span class="c1"># 품질/성능 요약(선택)</span>
  <span class="na">records_after_filters</span><span class="pi">:</span> <span class="m">4988333</span>
  <span class="na">null_rate_cost</span><span class="pi">:</span> <span class="m">0.0004</span>
  <span class="na">sanity_checks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">timestamp</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">null:</span><span class="nv"> </span><span class="s">pass"</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">cost</span><span class="nv"> </span><span class="s">&gt;=</span><span class="nv"> </span><span class="s">0:</span><span class="nv"> </span><span class="s">pass"</span>
</code></pre></div></div>

<h2 id="확장-필드필요할-때만">확장 필드(필요할 때만)</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">tool_versions</code>: Python/패키지/CLI 버전</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">constraints</code>: 사용 제한, 만료일</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">hash_tree</code>: 전체 디렉터리 해시(고급)</p>
  </li>
</ul>

<blockquote>
  <p><strong>규칙</strong></p>

  <ul>
    <li>
      <p><strong>짧게</strong> 시작(필수만) → 진짜 필요한 메타만 점진적으로 추가</p>
    </li>
    <li>
      <p><strong>경로는 상대경로</strong> 로 적되, 항상 <strong>버전 루트 기준</strong> 으로 기록</p>
    </li>
  </ul>

</blockquote>

<hr />

<h1 id="2-sha256sums-만들기-무결성-체크섬">2) <code class="language-plaintext highlighter-rouge">SHA256SUMS</code> 만들기 (무결성 체크섬)</h1>

<h2 id="파일-위치이름">파일 위치/이름</h2>

<ul>
  <li>
    <p>각 버전 루트에 <code class="language-plaintext highlighter-rouge">SHA256SUMS</code>(확장자 없음)로 둡니다.</p>
  </li>
  <li>
    <p>내용 포맷:</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;sha256&gt;  &lt;상대경로&gt;
</code></pre></div>    </div>
  </li>
</ul>

<p>예:<br />
<code class="language-plaintext highlighter-rouge">d2c7...9fa processed/events.parquet</code></p>

<h2 id="macos--linux-bashzsh">macOS / Linux (bash/zsh)</h2>

<p><strong>버전 루트에서 실행:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1) 기존 파일 제거(있다면)</span>
<span class="nb">rm</span> <span class="nt">-f</span> SHA256SUMS

<span class="c"># 2) 모든 파일에 대해 sha256 생성(숨김·SUMS 제외)</span>
find <span class="nb">.</span> <span class="nt">-type</span> f <span class="o">!</span> <span class="nt">-name</span> <span class="s1">'SHA256SUMS'</span> <span class="o">!</span> <span class="nt">-name</span> <span class="s1">'.*'</span> <span class="nt">-print0</span> <span class="se">\</span>
| xargs <span class="nt">-0</span> <span class="nb">sha256sum</span> <span class="o">&gt;</span> SHA256SUMS
<span class="c"># macOS에는 sha256sum이 없을 수 있음 → 대체:</span>
<span class="c"># find . -type f ! -name 'SHA256SUMS' ! -name '.*' -exec sh -c 'shasum -a 256 "$1" | sed "s#  #  #"' _ {} \; &gt; SHA256SUMS</span>

<span class="c"># 3) 검증(선택)</span>
<span class="nb">sha256sum</span> <span class="nt">-c</span> SHA256SUMS
<span class="c"># macOS 대체:</span>
<span class="c"># awk '{print $2}' SHA256SUMS | while read -r f; do</span>
<span class="c">#   calc=$(shasum -a 256 "$f" | awk '{print $1}')</span>
<span class="c">#   want=$(grep "  $f$" SHA256SUMS | awk '{print $1}')</span>
<span class="c">#   [[ "$calc" == "$want" ]] &amp;&amp; echo "OK  $f" || echo "FAIL  $f"</span>
<span class="c"># done</span>
</code></pre></div></div>

<h2 id="windows-powershell-2">Windows (PowerShell)</h2>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 버전 루트에서 실행:</span><span class="w">
</span><span class="n">Remove-Item</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="nx">SHA256SUMS</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
</span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="nt">-File</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Name</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="s1">'SHA256SUMS'</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="o">-not</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Name</span><span class="o">.</span><span class="nf">StartsWith</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nv">$h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Get-FileHash</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">FullName</span><span class="w"> </span><span class="nt">-Algorithm</span><span class="w"> </span><span class="nx">SHA256</span><span class="p">)</span><span class="o">.</span><span class="nf">Hash</span><span class="o">.</span><span class="nf">ToLower</span><span class="p">()</span><span class="w">
  </span><span class="nv">$rel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">FullName</span><span class="o">.</span><span class="nf">Substring</span><span class="p">((</span><span class="n">Get-Location</span><span class="p">)</span><span class="o">.</span><span class="nf">Path</span><span class="o">.</span><span class="nf">Length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">1</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'\'</span><span class="p">,</span><span class="s1">'/'</span><span class="p">)</span><span class="w">
  </span><span class="s2">"</span><span class="nv">$h</span><span class="s2">  </span><span class="nv">$rel</span><span class="s2">"</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-Content</span><span class="w"> </span><span class="nt">-NoNewline</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nx">SHA256SUMS</span><span class="w">

</span><span class="c"># 검증:</span><span class="w">
</span><span class="n">Get-Content</span><span class="w"> </span><span class="nx">SHA256SUMS</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nv">$parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="o">-split</span><span class="w"> </span><span class="s1">'\s\s'</span><span class="w">
  </span><span class="nv">$want</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$parts</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="nv">$file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w">
  </span><span class="nv">$got</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Get-FileHash</span><span class="w"> </span><span class="nv">$file</span><span class="w"> </span><span class="nt">-Algorithm</span><span class="w"> </span><span class="nx">SHA256</span><span class="p">)</span><span class="o">.</span><span class="nf">Hash</span><span class="o">.</span><span class="nf">ToLower</span><span class="p">()</span><span class="w">
  </span><span class="nx">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$got</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="nv">$want</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"OK  </span><span class="nv">$file</span><span class="s2">"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"FAIL  </span><span class="nv">$file</span><span class="s2">"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="tcsh-1">tcsh</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

# 버전 루트에서 실행:
rm -f SHA256SUMS
# GNU coreutils(sha256sum)가 있으면:
find . -type f ! -name 'SHA256SUMS' ! -name '.*' -print0 | xargs -0 sha256sum &gt; SHA256SUMS
# 없고 macOS 기본이라면:
# find . -type f ! -name 'SHA256SUMS' ! -name '.*' -exec sh -c 'shasum -a 256 "$1"' _ {} \; &gt; SHA256SUMS
</code></pre></div></div>

<h3 id="생성검증-스크립트로-고정추천">생성/검증 스크립트로 고정(추천)</h3>

<ul>
  <li>
    <p><strong>공용</strong> : <code class="language-plaintext highlighter-rouge">Work/80_Tools/scripts/checksum_all.sh|ps1|csh</code></p>
  </li>
  <li>
    <p><strong>사용법</strong> : 버전 루트에서 <code class="language-plaintext highlighter-rouge">checksum_all.sh</code> 실행 → <code class="language-plaintext highlighter-rouge">SHA256SUMS</code> 생성 → <code class="language-plaintext highlighter-rouge">-c</code> 옵션으로 검증</p>
  </li>
</ul>

<hr />

<h1 id="3-함께-쓰는-운영-팁">3) 함께 쓰는 운영 팁</h1>

<ul>
  <li>
    <p><strong>manifest vs SHA256SUMS</strong></p>

    <ul>
      <li>
        <p><strong>SHA256SUMS</strong> : 파일 <strong>전체 목록</strong> 과 해시(머신용, 검증 전용)</p>
      </li>
      <li>
        <p><strong>manifest.yml</strong> : 주요 파일 요약/메타(<strong>사람이 읽기 쉬운 카드</strong>)<br />
→ 둘 다 있되, manifest의 <code class="language-plaintext highlighter-rouge">files[].sha256</code>은 <strong>핵심 파일만</strong> 넣어도 충분</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>무결성 실패 시</strong></p>

    <ul>
      <li>
        <p>전송/압축/복사 과정에서 손상 가능 → 원본에서 다시 가져와 SUMS 재생성</p>
      </li>
      <li>
        <p>라인 엔딩/권한과 무관(바이너리 기준)이라 신뢰도 높음</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>제외 대상</strong></p>

    <ul>
      <li>
        <p>SUMS 만들 때 <strong>숨김파일(<code class="language-plaintext highlighter-rouge">.*</code>)</strong>과 <code class="language-plaintext highlighter-rouge">SHA256SUMS</code> 자신은 제외</p>
      </li>
      <li>
        <p>캐시/임시 파일은 <code class="language-plaintext highlighter-rouge">cache/</code>에만 두고 SUMS에서 자연히 제외되게</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>대용량 최적화</strong></p>

    <ul>
      <li>Parquet 등 대형 파일은 <strong>생성 직후</strong> SUMS를 만들어두고, 나중엔 변경 금지(불변 원칙)</li>
    </ul>
  </li>
  <li>
    <p><strong>버전 규칙</strong></p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">vYYYY.MMDD</code>로 <strong>스냅샷 의미</strong> 가 분명해짐. 파생물도 동일 규칙 사용</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="빠른-시작복붙용-템플릿">빠른 시작(복붙용 템플릿)</h2>

<p><strong>입력 데이터셋:<code class="language-plaintext highlighter-rouge">manifest.yml</code></strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">&lt;dataset_name&gt;</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">dataset</span>
<span class="na">version</span><span class="pi">:</span> <span class="s">vYYYY.MMDD</span>
<span class="na">created_at</span><span class="pi">:</span> <span class="s">2025-08-26T00:00:00+09:00</span>
<span class="na">owner</span><span class="pi">:</span> <span class="s">your.name@company.com</span>
<span class="na">source</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">&lt;external|internal|manual&gt;</span>
  <span class="na">detail</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;설명/링크&gt;"</span>
<span class="na">schema</span><span class="pi">:</span>
  <span class="na">format</span><span class="pi">:</span> <span class="s">&lt;parquet|csv|json|image|...&gt;</span>
  <span class="na">rows</span><span class="pi">:</span> <span class="s">&lt;int or unknown&gt;</span>
  <span class="na">columns</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">{</span><span class="nv">name</span><span class="pi">:</span> <span class="nv">&lt;col1&gt;</span><span class="pi">,</span> <span class="nv">type</span><span class="pi">:</span> <span class="nv">&lt;type&gt;</span><span class="pi">}</span>
<span class="na">pii_level</span><span class="pi">:</span> <span class="s">&lt;none|low|medium|high&gt;</span>
<span class="na">license</span><span class="pi">:</span> <span class="s">&lt;internal|...&gt;</span>
<span class="na">files</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="pi">{</span><span class="nv">path</span><span class="pi">:</span> <span class="nv">&lt;relative/file&gt;</span><span class="pi">,</span> <span class="nv">bytes</span><span class="pi">:</span> <span class="nv">&lt;int&gt;</span><span class="pi">,</span> <span class="nv">sha256</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;optional&gt;"</span><span class="pi">}</span>
<span class="na">notes</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;중요</span><span class="nv"> </span><span class="s">정제/전처리</span><span class="nv"> </span><span class="s">노트&gt;"</span>
</code></pre></div></div>

<p><strong>파생 데이터셋:<code class="language-plaintext highlighter-rouge">manifest.yml</code></strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">&lt;artifact_name&gt;</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">derived</span>
<span class="na">version</span><span class="pi">:</span> <span class="s">vYYYY.MMDD</span>
<span class="na">created_at</span><span class="pi">:</span> <span class="s">2025-08-26T00:00:00+09:00</span>
<span class="na">owner</span><span class="pi">:</span> <span class="s">your.name@company.com</span>
<span class="na">lineage</span><span class="pi">:</span>
  <span class="na">inputs</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">{</span><span class="nv">name</span><span class="pi">:</span> <span class="nv">&lt;dataset_a&gt;</span><span class="pi">,</span> <span class="nv">version</span><span class="pi">:</span> <span class="nv">vYYYY.MMDD</span><span class="pi">,</span> <span class="nv">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">../../../datasets/&lt;dataset_a&gt;/vYYYY.MMDD/processed"</span><span class="pi">}</span>
  <span class="na">code</span><span class="pi">:</span>
    <span class="na">repo</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;PRJ-...</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">git</span><span class="nv"> </span><span class="s">URL&gt;"</span>
    <span class="na">commit</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;hash</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">tag&gt;"</span>
  <span class="na">job</span><span class="pi">:</span>
    <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;JOB-YYYY-NNN_title&gt;"</span>
<span class="na">schema</span><span class="pi">:</span>
  <span class="na">format</span><span class="pi">:</span> <span class="s">&lt;parquet|csv|...&gt;</span>
  <span class="na">rows</span><span class="pi">:</span> <span class="s">&lt;int&gt;</span>
<span class="na">metrics</span><span class="pi">:</span>
  <span class="na">records_after_filters</span><span class="pi">:</span> <span class="s">&lt;int&gt;</span>
  <span class="na">sanity_checks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">rule:</span><span class="nv"> </span><span class="s">pass/fail"</span>
<span class="na">notes</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;변환</span><span class="nv"> </span><span class="s">요약/제약&gt;"</span>
</code></pre></div></div>

<p>필요하면 위 <strong>체크섬 생성/검증 스크립트</strong> 를 <code class="language-plaintext highlighter-rouge">80_Tools/scripts/</code>에 넣은 버전으로 만들어 줄게—쓰는 셸(bash/zsh/PowerShell/tcsh)만 말해줘!</p>

<p class="chat--user">

폰트 파일은 어디 저장해?

</p>

<p>짧게: <strong><code class="language-plaintext highlighter-rouge">Work/60_Assets/fonts/</code></strong> 아래에 둬요.<br />
여긴 로고/템플릿과 같은 “브랜딩/시각 자산” 영역이라 폰트의 <strong>정본 위치</strong> 로 딱 맞습니다.</p>

<hr />

<h1 id="권장-폴더-트리복붙">권장 폴더 트리(복붙)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/
└─ 60_Assets/                               - 브랜딩/시각 자산
   └─ fonts/                                - 폰트 정본 저장소
      ├─ _catalog.csv                       - (선택) 폰트 목록/버전/라이선스 인덱스
      ├─ &lt;FamilyName&gt;/                      - 예: Pretendard, Inter, NotoSansKR
      │  └─ vX.Y/                           - 폰트 패밀리 버전(없으면 v1.0 등)
      │     ├─ desktop/                     - 앱/문서용: OTF/TTF
      │     ├─ web/                         - 웹/경량 배포: WOFF2(권장), WOFF
      │     ├─ variable/                    - 가변 폰트(옵션)
      │     ├─ subsets/                     - 부분 서브셋(예: KR-basic, UI-only)
      │     ├─ license/                     - LICENSE, README-LICENSE.md
      │     ├─ specimen/                    - 샘플 이미지/미리보기
      │     └─ SHA256SUMS                   - 무결성 체크섬(옵션)
      └─ &lt;FamilyName2&gt;/
         └─ vX.Y/...
</code></pre></div></div>

<blockquote>
  <p><strong>프로젝트 전용 폰트?</strong><br />
 정본은 위에 두고, 프로젝트에서는 <strong>링크/빌드시 복사</strong> 만 해요. (복사본이 정본이 되지 않도록!)</p>
</blockquote>

<hr />

<h2 id="운용-규칙핵심">운용 규칙(핵심)</h2>

<ul>
  <li>
    <p><strong>정본은 60_Assets/fonts</strong> : 여기만 갱신하고, 나머지는 <strong>참조/동기화</strong>.</p>
  </li>
  <li>
    <p><strong>버저닝</strong> : 폰트 패밀리마다 <code class="language-plaintext highlighter-rouge">vX.Y</code> 폴더를 만들어 버전 충돌을 방지.</p>
  </li>
  <li>
    <p><strong>라이선스 동봉</strong> : <code class="language-plaintext highlighter-rouge">license/</code>에 LICENSE, 사용범위 메모(웹 임베드 가능 여부 등).</p>
  </li>
  <li>
    <p><strong>무결성(선택)</strong> : 대외 배포/릴리스에 들어가면 <code class="language-plaintext highlighter-rouge">SHA256SUMS</code> 생성(아래 예시).</p>
  </li>
  <li>
    <p><strong>개인 설치본</strong> 은 OS에 설치하되(시스템 폴더), <strong>정본은 변하지 않게</strong> 60_Assets에 유지.</p>
  </li>
</ul>

<hr />

<h2 id="프로젝트에서-쓰는-법">프로젝트에서 쓰는 법</h2>

<h3 id="1-데스크탑-앱pyside6qt-등에서-번들">1) 데스크탑 앱(PySide6/Qt 등)에서 번들</h3>

<ul>
  <li><strong>복사 방식(빌드 시)</strong> : 빌드 스크립트에서 필요한 파일만 프로젝트로 동기화.
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 예: Inter v4.0의 OTF만 앱 리포지토리로 동기화</span>
rsync <span class="nt">-av</span> <span class="se">\</span>
  <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/60_Assets/fonts/Inter/v4.0/desktop/"</span> <span class="se">\</span>
  <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/20_Projects/PRJ-2025-001_app/assets/fonts/"</span>
</code></pre></div>    </div>
  </li>
  <li><strong>런타임 로드(PySide6)</strong> :
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">PySide6.QtGui</span> <span class="kn">import</span> <span class="n">QFontDatabase</span><span class="p">,</span> <span class="n">QFont</span>
<span class="n">QFontDatabase</span><span class="p">.</span><span class="nf">addApplicationFont</span><span class="p">(</span><span class="sh">"</span><span class="s">:/assets/fonts/Inter-Regular.otf</span><span class="sh">"</span><span class="p">)</span>
<span class="n">QApplication</span><span class="p">.</span><span class="nf">setFont</span><span class="p">(</span><span class="nc">QFont</span><span class="p">(</span><span class="sh">"</span><span class="s">Inter</span><span class="sh">"</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="2-웹css에서-임베드">2) 웹/CSS에서 임베드</h3>
<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/* WOFF2 우선 */</span>
<span class="k">@font-face</span><span class="p">{</span>
  <span class="nl">font-family</span><span class="p">:</span><span class="s1">"Inter"</span><span class="p">;</span>
  <span class="nl">src</span><span class="p">:</span> <span class="nf">url</span><span class="p">(</span><span class="s1">"/assets/fonts/Inter/v4.0/web/Inter-Variable.woff2"</span><span class="p">)</span> <span class="nf">format</span><span class="p">(</span><span class="s1">"woff2"</span><span class="p">);</span>
  <span class="nl">font-weight</span><span class="p">:</span> <span class="m">100</span> <span class="m">900</span><span class="p">;</span> <span class="c">/* variable */</span>
  <span class="nl">font-style</span><span class="p">:</span> <span class="nb">normal</span><span class="p">;</span>
  <span class="nl">font-display</span><span class="p">:</span> <span class="nb">swap</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">body</span><span class="p">{</span> <span class="nl">font-family</span><span class="p">:</span> <span class="s1">"Inter"</span><span class="p">,</span> <span class="s1">"Noto Sans KR"</span><span class="p">,</span> <span class="n">system-ui</span><span class="p">,</span> <span class="o">-</span><span class="n">apple-system</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span> <span class="p">}</span>
</code></pre></div></div>

<h3 id="3-릴리스에-포함선택">3) 릴리스에 포함(선택)</h3>

<ul>
  <li>폰트를 앱과 함께 배포하면, 해당 프로젝트의 <code class="language-plaintext highlighter-rouge">75_Releases/&lt;project&gt;/vX.Y.Z/docs/</code>에<br />
<strong>라이선스 요약</strong> 을 반드시 포함하세요(배포권한 확인).</li>
</ul>

<hr />

<h2 id="서브셋가변-폰트-팁">서브셋/가변 폰트 팁</h2>

<ul>
  <li>
    <p><strong>가변 폰트(variable)</strong>가 있다면 우선 고려(파일 수↓, 품질↑).</p>
  </li>
  <li>
    <p>웹/경량 배포는 <strong>WOFF2만</strong> 으로 충분한 경우가 많음.</p>
  </li>
  <li>
    <p><strong>서브셋</strong> 은 UI에 필요한 글리프만 추출해 용량을 크게 줄일 수 있어요.<br />
(툴: <code class="language-plaintext highlighter-rouge">pyftsubset</code> 등—원하면 스크립트 만들어 드림)</p>
  </li>
</ul>

<hr />

<h2 id="라이선스보안-주의">라이선스/보안 주의</h2>

<ul>
  <li>
    <p>상업용/배포제한 폰트는 리포지토리에 올리지 말고,<br />
<code class="language-plaintext highlighter-rouge">60_Assets/fonts/&lt;Family&gt;/vX.Y/license/</code>에 <strong>사용범위 메모</strong> 를 명확히.</p>
  </li>
  <li>
    <p>팀 공유가 불가하면, 개인 환경에는 <strong>OS 설치</strong> 만 하고 정본은 내부 서버/스토리지에 두기.</p>
  </li>
  <li>
    <p>외부 배포 시 <code class="language-plaintext highlighter-rouge">README-LICENSE.md</code>에 출처/허용범위/금지사항 요약.</p>
  </li>
</ul>

<hr />

<h2 id="체크섬sha256-만들기옵션">체크섬(SHA256) 만들기(옵션)</h2>

<p>버전 루트에서:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># macOS/Linux (sha256sum 있을 때)</span>
find <span class="nb">.</span> <span class="nt">-type</span> f <span class="o">!</span> <span class="nt">-name</span> <span class="s1">'SHA256SUMS'</span> <span class="o">!</span> <span class="nt">-name</span> <span class="s1">'.*'</span> <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nb">sha256sum</span> <span class="o">&gt;</span> SHA256SUMS

<span class="c"># macOS 기본(shasum) 대체</span>
find <span class="nb">.</span> <span class="nt">-type</span> f <span class="o">!</span> <span class="nt">-name</span> <span class="s1">'SHA256SUMS'</span> <span class="o">!</span> <span class="nt">-name</span> <span class="s1">'.*'</span> <span class="nt">-exec</span> sh <span class="nt">-c</span> <span class="s1">'shasum -a 256 "$1" | sed "s#  #  #"'</span> _ <span class="o">{}</span> <span class="se">\;</span> <span class="o">&gt;</span> SHA256SUMS
</code></pre></div></div>

<p>Windows PowerShell:</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Remove-Item</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="nx">SHA256SUMS</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
</span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="nt">-File</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Name</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="s1">'SHA256SUMS'</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="o">-not</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Name</span><span class="o">.</span><span class="nf">StartsWith</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w">
  </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$h</span><span class="o">=</span><span class="p">(</span><span class="n">Get-FileHash</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">FullName</span><span class="w"> </span><span class="nt">-Algorithm</span><span class="w"> </span><span class="nx">SHA256</span><span class="p">)</span><span class="o">.</span><span class="nf">Hash</span><span class="o">.</span><span class="nf">ToLower</span><span class="p">()</span><span class="w">
    </span><span class="nv">$rel</span><span class="o">=</span><span class="bp">$_</span><span class="o">.</span><span class="nf">FullName</span><span class="o">.</span><span class="nf">Substring</span><span class="p">((</span><span class="n">Get-Location</span><span class="p">)</span><span class="o">.</span><span class="nf">Path</span><span class="o">.</span><span class="nf">Length</span><span class="o">+</span><span class="nx">1</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'\'</span><span class="p">,</span><span class="s1">'/'</span><span class="p">)</span><span class="w">
    </span><span class="s2">"</span><span class="nv">$h</span><span class="s2">  </span><span class="nv">$rel</span><span class="s2">"</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-Content</span><span class="w"> </span><span class="nt">-NoNewline</span><span class="w"> </span><span class="nx">SHA256SUMS</span><span class="w">
</span></code></pre></div></div>

<hr />

<h2 id="빠른-체크리스트">빠른 체크리스트</h2>

<ul>
  <li>
    <p>폰트 정본: <strong><code class="language-plaintext highlighter-rouge">60_Assets/fonts</code></strong> (버전·라이선스 동봉)</p>
  </li>
  <li>
    <p>프로젝트: <strong>빌드시 동기화/복사</strong> 또는 <strong>런타임 로드</strong>(정본은 건드리지 않기)</p>
  </li>
  <li>
    <p>웹: <strong>WOFF2 +<code class="language-plaintext highlighter-rouge">font-display: swap</code></strong>, 시스템 폰트 적절한 폴백</p>
  </li>
  <li>
    <p>데스크탑: 애플리케이션 번들에 포함하면 <strong>라이선스 확인 필수</strong></p>
  </li>
  <li>
    <p>서브셋/가변 폰트로 <strong>용량 최적화</strong> , 필요 시 스크립트화</p>
  </li>
</ul>

<p>원하면 네가 쓰는 폰트 패밀리(예: Pretendard, Noto Sans KR) 기준으로<br />
<strong>초기 트리 + 빌드 동기화 스크립트</strong>(bash/PowerShell/tcsh)까지 만들어줄게.</p>

<p class="chat--user">

다운로드 파일들 저장할 폴더도 추가해줘

</p>

<p>좋아, <strong>다운로드 전용 착륙지(Landing Zone)</strong>를 추가하자.<br />
기존 <code class="language-plaintext highlighter-rouge">00_Inbox</code>(수작업 스크랩/임시)와 구분해서, <strong>브라우저/CLI가 내려받는 파일</strong> 은 여기로 모으고 정리 후 각 “정본 위치”로 이동하는 흐름이 깔끔해.</p>

<hr />

<h2 id="추가-트리-복붙용--영문-폴더명--한글-설명">추가 트리 (복붙용) — <em>영문 폴더명 + 한글 설명</em></h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/
├─ 05_Downloads/                               - 다운로드 착륙지(Landing Zone, 정리 전 임시)
│  ├─ _inbox/                                  - 브라우저/툴 기본 저장 경로(정리 전)
│  ├─ installers/                              - 설치 파일 임시(.exe/.msi/.pkg/.dmg/.whl/.zip)
│  ├─ datasets/                                - 데이터셋 압축/CSV 임시(해제 전)
│  ├─ manuals/                                 - 매뉴얼/가이드 PDF/HTML 임시
│  ├─ assets/                                  - 폰트/아이콘/템플릿 등 임시
│  ├─ quarantine/                              - 의심 파일(검사 전 격리)
│  └─ README_SORTING.md                        - 분류 규칙 요약(어디로 옮길지 안내)
├─ 10_Today/
├─ 20_Projects/
├─ 25_Jobs/
├─ 26_Datasets/
├─ 30_Areas/
├─ 31_Labs/
├─ 32_SharedConfigs/
├─ 40_Resources/
├─ 50_Snippets/
├─ 60_Assets/
├─ 70_Exports/
├─ 75_Releases/
├─ 80_Tools/
├─ 85_Environments/
├─ 90_PersonalConfigs/
└─ 99_Archive/
</code></pre></div></div>

<hr />

<h2 id="라우팅-규칙다운로드--정본-위치">라우팅 규칙(다운로드 → 정본 위치)</h2>

<table>
  <thead>
    <tr>
      <th>분류(05_Downloads 하위)</th>
      <th>정리 완료 시 최종 위치(정본)</th>
      <th>비고</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>installers/</strong></td>
      <td><code class="language-plaintext highlighter-rouge">80_Tools/installers/</code></td>
      <td>버전·체크섬 기록(install_notes.md, SHA256)</td>
    </tr>
    <tr>
      <td><strong>datasets/</strong></td>
      <td><code class="language-plaintext highlighter-rouge">26_Datasets/datasets/&lt;name&gt;/vYYYY.MMDD/{raw→processed}</code></td>
      <td>압축 해제 후 manifest.yml 작성</td>
    </tr>
    <tr>
      <td><strong>manuals/</strong></td>
      <td><code class="language-plaintext highlighter-rouge">40_Resources/manuals/&lt;vendor&gt;/&lt;product&gt;/&lt;version&gt;/</code></td>
      <td>PDF/HTML/MD</td>
    </tr>
    <tr>
      <td><strong>assets/</strong> (폰트 등)</td>
      <td><code class="language-plaintext highlighter-rouge">60_Assets/fonts/…</code> <code class="language-plaintext highlighter-rouge">60_Assets/...</code></td>
      <td>라이선스 동봉, 버전 폴더 유지</td>
    </tr>
    <tr>
      <td><strong>_inbox/</strong> 기타</td>
      <td>용도에 따라 위 카테고리로 이동</td>
      <td>스크린샷/메모는 <code class="language-plaintext highlighter-rouge">00_Inbox</code>가 더 적합</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>원칙: <strong>05_Downloads는 임시</strong>. 정리 끝나면 <strong>비워서 가볍게</strong> 유지!</p>
</blockquote>

<hr />

<h2 id="브라우저툴-연동선택">브라우저/툴 연동(선택)</h2>

<ul>
  <li>
    <p><strong>기본 다운로드 경로</strong> 를 <code class="language-plaintext highlighter-rouge">Work/05_Downloads/_inbox</code>로 지정.</p>
  </li>
  <li>
    <p>시스템 “다운로드” 폴더를 바꾸고 싶다면, <strong>심볼릭 링크</strong> 로 연결:</p>
  </li>
</ul>

<p><strong>macOS/Linux</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 기존 ~/Downloads를 백업/삭제 후 Today 착륙지로 링크</span>
<span class="nb">mv</span> ~/Downloads ~/Downloads.bak 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
ln</span> <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/05_Downloads/_inbox"</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Downloads"</span>
</code></pre></div></div>

<p><strong>Windows (PowerShell 관리자)</strong></p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ren</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Downloads"</span><span class="w"> </span><span class="nx">Downloads.bak</span><span class="w">
</span><span class="n">cmd</span><span class="w"> </span><span class="nx">/c</span><span class="w"> </span><span class="nx">mklink</span><span class="w"> </span><span class="nx">/D</span><span class="w"> </span><span class="s2">"%USERPROFILE%\Downloads"</span><span class="w"> </span><span class="s2">"%USERPROFILE%\Work\05_Downloads\_inbox"</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>부담되면, 브라우저(Chrome/Edge/Firefox)에서 <strong>해당 경로만 기본 폴더로</strong> 지정해도 충분.</p>
</blockquote>

<hr />

<h2 id="주간-정리-루틴가볍게">주간 정리 루틴(가볍게)</h2>

<ol>
  <li>
    <p><strong>installers/</strong> → <code class="language-plaintext highlighter-rouge">80_Tools/installers/</code>로 이동 + <code class="language-plaintext highlighter-rouge">install_notes.md</code> 업데이트</p>
  </li>
  <li>
    <p><strong>datasets/</strong> → 압축 해제 → <code class="language-plaintext highlighter-rouge">26_Datasets/datasets/&lt;name&gt;/vYYYY.MMDD/raw</code>에 배치</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">manifest.yml</code> 초안 작성, <code class="language-plaintext highlighter-rouge">SHA256SUMS</code> 생성(무결성)</li>
    </ul>
  </li>
  <li>
    <p><strong>manuals/</strong> → <code class="language-plaintext highlighter-rouge">40_Resources/manuals/...</code>로 이동</p>
  </li>
  <li>
    <p><strong>assets/</strong>(폰트 등) → <code class="language-plaintext highlighter-rouge">60_Assets/...</code>로 이동</p>
  </li>
  <li>
    <p><strong>_inbox/</strong> → 비우기(불필요 파일 삭제, 기타는 적절한 곳으로 라우팅)</p>
  </li>
  <li>
    <p><strong>quarantine/</strong> → 바이러스/정책 검사 후 처리</p>
  </li>
</ol>

<hr />

<h2 id="today런처에-한-줄-추가선택">today/런처에 한 줄 추가(선택)</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Sort downloads       | 05_Downloads               | ${EDITOR:-vi} README_SORTING.md
Open installers box  | 80_Tools/installers        | ls -al
</code></pre></div></div>

<hr />

<h2 id="사용-시-주요-주의점">사용 시 주요 주의점</h2>

<ul>
  <li>
    <p><strong>정본은 각 전용 폴더</strong> : 05_Downloads는 <strong>절대 정본 보관소가 아님</strong>. 정리 후 반드시 이동.</p>
  </li>
  <li>
    <p><strong>체크섬/메타</strong> : 데이터셋·설치파일은 이동 전에 <strong>SHA256SUMS</strong> 생성, <code class="language-plaintext highlighter-rouge">manifest.yml</code>/<code class="language-plaintext highlighter-rouge">install_notes.md</code> 기록.</p>
  </li>
  <li>
    <p><strong>보안</strong> : 알 수 없는 파일은 <strong>quarantine/</strong>로 옮겨 검사 후 사용.</p>
  </li>
  <li>
    <p><strong>용량 관리</strong> : <code class="language-plaintext highlighter-rouge">_inbox</code>와 <code class="language-plaintext highlighter-rouge">datasets</code>의 압축본은 <strong>해제 후 삭제</strong>(정본은 26_Datasets).</p>
  </li>
  <li>
    <p><strong>.gitignore</strong> : Work를 레포로 관리한다면 <code class="language-plaintext highlighter-rouge">05_Downloads/**</code>는 반드시 <strong>무시</strong>.</p>
  </li>
  <li>
    <p><strong>중복 방지</strong> : 동일 파일이 정본 위치에 있으면 <strong>복사 금지</strong> , 덮어쓰기 대신 <strong>버전 폴더</strong> 사용.</p>
  </li>
</ul>

<p>필요하면 05_Downloads에서 <strong>자동 분류(installers/datasets/manuals/…)</strong> 하고<br />
정본 위치로 옮기면서 <strong>체크섬까지 생성</strong> 하는 스윕 스크립트(bash/PowerShell/tcsh)도 만들어줄게.</p>

<p class="chat--user">

오 생각보다 빠른 번호네 나는 98 정도 생각했어

</p>

<p>좋아, 번호는 <strong>취향/운영 철학</strong> 문제라 05든 98이든 OK야.<br />
아래처럼 <strong>장단점 비교 → 98로 쓸 때의 최종안(트리/규칙/리네임 명령)</strong>까지 한 번에 정리해줄게.</p>

<hr />

<h2 id="어떤-번호가-좋을까-짧은-판단-기준">어떤 번호가 좋을까? (짧은 판단 기준)</h2>

<ol>
  <li>
    <p><strong>05_Downloads (상단 배치)</strong></p>

    <ul>
      <li>
        <p>장점: 파일 탐색기에서 항상 <strong>맨 위</strong> 에 보여서 “받자마자 분류”가 쉬움.</p>
      </li>
      <li>
        <p>단점: 상단이 복잡해 보일 수 있음.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>98_Downloads (하단 배치)</strong> ← 네가 선호</p>

    <ul>
      <li>
        <p>장점: <strong>작업 트리의 말미</strong> 에 있어 시각적 소음 ↓, “임시/정리대상” 느낌이 분명.</p>
      </li>
      <li>
        <p>단점: 스크롤이 조금 늘어남. (대신 브라우저 기본경로만 잘 맞추면 문제 없음)</p>
      </li>
    </ul>
  </li>
</ol>

<blockquote>
  <p>결론: <strong>98도 충분히 합리적</strong>. “임시·정리대상”을 뒤로 미루고 싶다면 98이 좋아.</p>
</blockquote>

<hr />

<h2 id="98로-쓰는-최종안-복붙용">98로 쓰는 최종안 (복붙용)</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/
├─ 00_Inbox/                                  - 수작업 스크랩/임시(노트·스크린샷)
├─ 10_Today/
├─ 20_Projects/
├─ 25_Jobs/
├─ 26_Datasets/
├─ 30_Areas/
├─ 31_Labs/
├─ 32_SharedConfigs/
├─ 40_Resources/
├─ 50_Snippets/
├─ 60_Assets/
├─ 70_Exports/
├─ 75_Releases/
├─ 80_Tools/
├─ 85_Environments/
├─ 90_PersonalConfigs/
├─ 98_Downloads/                              - 다운로드 착륙지(Landing Zone, 정리 전 임시)
│  ├─ _inbox/                                 - 브라우저/툴 기본 저장 경로
│  ├─ installers/                             - 설치 파일(.exe/.msi/.pkg/.dmg/.whl/.zip)
│  ├─ datasets/                               - 데이터셋 압축/CSV 임시(해제 전)
│  ├─ manuals/                                - 매뉴얼/가이드 PDF/HTML 임시
│  ├─ assets/                                 - 폰트/아이콘/템플릿 등 임시
│  ├─ quarantine/                             - 의심 파일(검사 전 격리)
│  └─ README_SORTING.md                       - 분류 규칙 요약(최종 위치 안내)
└─ 99_Archive/
</code></pre></div></div>

<h3 id="라우팅-규칙변경-없음-폴더만-98로-교체">라우팅 규칙(변경 없음, 폴더만 98로 교체)</h3>

<table>
  <thead>
    <tr>
      <th>98_Downloads 하위</th>
      <th>정본 최종 위치</th>
      <th>비고</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>installers/</td>
      <td><code class="language-plaintext highlighter-rouge">80_Tools/installers/</code></td>
      <td>버전·체크섬 <code class="language-plaintext highlighter-rouge">install_notes.md</code>, <code class="language-plaintext highlighter-rouge">SHA256SUMS</code></td>
    </tr>
    <tr>
      <td>datasets/</td>
      <td><code class="language-plaintext highlighter-rouge">26_Datasets/datasets/&lt;name&gt;/vYYYY.MMDD/{raw→processed}</code></td>
      <td><code class="language-plaintext highlighter-rouge">manifest.yml</code> 작성</td>
    </tr>
    <tr>
      <td>manuals/</td>
      <td><code class="language-plaintext highlighter-rouge">40_Resources/manuals/&lt;vendor&gt;/&lt;product&gt;/&lt;version&gt;/</code></td>
      <td> </td>
    </tr>
    <tr>
      <td>assets/</td>
      <td><code class="language-plaintext highlighter-rouge">60_Assets/...</code></td>
      <td>폰트는 <code class="language-plaintext highlighter-rouge">60_Assets/fonts/...</code></td>
    </tr>
    <tr>
      <td>_inbox/ 기타</td>
      <td>상황에 맞게 위 카테고리로 이동</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="안전한-리네임--브라우저-연동">안전한 리네임 &amp; 브라우저 연동</h2>

<h3 id="macoslinux-bashzsh-1">macOS/Linux (bash/zsh)</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/Work
<span class="nb">mkdir</span> <span class="nt">-p</span> 98_Downloads/<span class="o">{</span>_inbox,installers,datasets,manuals,assets,quarantine<span class="o">}</span>
<span class="c"># 기존 05_Downloads를 썼다면:</span>
<span class="o">[</span> <span class="nt">-d</span> 05_Downloads <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">mv </span>05_Downloads/<span class="k">*</span> 98_Downloads/ <span class="o">&amp;&amp;</span> <span class="nb">rmdir </span>05_Downloads 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>

<span class="c"># OS의 ~/Downloads를 Work/98_Downloads/_inbox로 심볼릭 링크(선택)</span>
<span class="nb">mv</span> ~/Downloads ~/Downloads.bak 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
ln</span> <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/98_Downloads/_inbox"</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Downloads"</span>
</code></pre></div></div>

<h3 id="windows-powershell-3">Windows (PowerShell)</h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">New-Item</span><span class="w"> </span><span class="nt">-ItemType</span><span class="w"> </span><span class="nx">Directory</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\98_Downloads\_inbox"</span><span class="p">,</span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\98_Downloads\installers"</span><span class="p">,</span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\98_Downloads\datasets"</span><span class="p">,</span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\98_Downloads\manuals"</span><span class="p">,</span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\98_Downloads\assets"</span><span class="p">,</span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\98_Downloads\quarantine"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-Null</span><span class="w">
</span><span class="c"># 기존 05_Downloads 사용분 이동(있을 때만)</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\05_Downloads"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Move-Item</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\05_Downloads\*"</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\98_Downloads"</span><span class="w"> </span><span class="nt">-Force</span><span class="p">;</span><span class="w"> </span><span class="n">Remove-Item</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\05_Downloads"</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="c"># 사용자 Downloads → _inbox 링크(선택, 관리자 권장)</span><span class="w">
</span><span class="n">Rename-Item</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Downloads"</span><span class="w"> </span><span class="s2">"Downloads.bak"</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
</span><span class="n">cmd</span><span class="w"> </span><span class="nx">/c</span><span class="w"> </span><span class="nx">mklink</span><span class="w"> </span><span class="nx">/D</span><span class="w"> </span><span class="s2">"%USERPROFILE%\Downloads"</span><span class="w"> </span><span class="s2">"%USERPROFILE%\Work\98_Downloads\_inbox"</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>브라우저(Chrome/Edge/Firefox)의 <strong>기본 다운로드 폴더</strong> 를 <code class="language-plaintext highlighter-rouge">Work/98_Downloads/_inbox</code>로 바꿔두면 더 편함.</p>
</blockquote>

<hr />

<h2 id="주의점번호-바꿔도-변하지-않는-원칙">주의점(번호 바꿔도 변하지 않는 원칙)</h2>

<ul>
  <li>
    <p><strong>정본은 각 전용 폴더</strong> : 98_Downloads는 <strong>임시 착륙지</strong> 일 뿐. 정리 후 반드시</p>

    <ul>
      <li>
        <p>설치파일 → <code class="language-plaintext highlighter-rouge">80_Tools/installers/</code></p>
      </li>
      <li>
        <p>데이터셋 → <code class="language-plaintext highlighter-rouge">26_Datasets/...</code></p>
      </li>
      <li>
        <p>매뉴얼 → <code class="language-plaintext highlighter-rouge">40_Resources/manuals/...</code></p>
      </li>
      <li>
        <p>자산(폰트 등) → <code class="language-plaintext highlighter-rouge">60_Assets/...</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>체크섬·메타 필수</strong> : 데이터셋/설치파일은 이동 전에 <code class="language-plaintext highlighter-rouge">SHA256SUMS</code>/<code class="language-plaintext highlighter-rouge">manifest.yml</code>(데이터셋), <code class="language-plaintext highlighter-rouge">install_notes.md</code>(설치파일)를 남겨 재현성 확보.</p>
  </li>
  <li>
    <p><strong>보안</strong> : 출처 불명은 <code class="language-plaintext highlighter-rouge">quarantine/</code>에 두고 검사 후 사용.</p>
  </li>
  <li>
    <p><strong>.gitignore</strong> : Work를 레포로 관리한다면 <code class="language-plaintext highlighter-rouge">98_Downloads/**</code>는 <strong>무조건 무시</strong>.</p>
  </li>
  <li>
    <p><strong>정리 주기</strong> : 주 1회 <code class="language-plaintext highlighter-rouge">_inbox</code> 비우기, 하위 카테고리도 정본으로 이동 후 비우기.</p>
  </li>
</ul>

<hr />

<h2 id="선택-today런처에-경로만-교체">(선택) today/런처에 경로만 교체</h2>

<p>기존 예시에서 <code class="language-plaintext highlighter-rouge">05_Downloads</code> → <code class="language-plaintext highlighter-rouge">98_Downloads</code>로 바꾸면 끝.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Sort downloads       | 98_Downloads               | ${EDITOR:-vi} README_SORTING.md
Open installers box  | 80_Tools/installers        | ls -al
</code></pre></div></div>

<p>원하면 <strong>주간 자동정리 스크립트</strong>(다운로드 자동 분류→정본 이동→체크섬 생성)도 98 경로 기준으로 만들어줄게.</p>

<p class="chat--user">

임시 보관소라는 관점에서는 앞쪽 번호가 어울린다고 보는건가

</p>

<p>짧은 답: <strong>네. “임시 보관소”는 앞쪽 번호(상단 배치)가 더 어울립니다.</strong><br />
이유는 “빨리 보고 빨리 비우게” 만드는 시각적/동선 효과가 커서예요.</p>

<h2 id="왜-앞번호상단가-유리한가">왜 앞번호(상단)가 유리한가</h2>

<ol>
  <li>
    <p><strong>가시성 → 행동 유도</strong><br />
폴더 트리 상단(00~10대)에 있으면 매일 시야에 들어와서 “정리해야지”가 자연스레 작동합니다.</p>
  </li>
  <li>
    <p><strong>흐름 정렬</strong><br />
하루 흐름이 <code class="language-plaintext highlighter-rouge">00_Inbox → 05_Downloads → 10_Today → 20_Projects/25_Jobs…</code>로 이어져 <strong>수집→정리→집중 작업</strong> 순서가 깔끔해집니다.</p>
  </li>
  <li>
    <p><strong>마찰 최소화</strong><br />
브라우저/툴의 기본 저장 폴더를 상단 폴더로 지정하기 쉽고, 경로가 짧아 조작이 빠릅니다.</p>
  </li>
</ol>

<h2 id="언제-뒤번호하단가-더-낫나">언제 뒤번호(하단)가 더 낫나</h2>

<ul>
  <li>
    <p>트리 상단을 “업무 핵심만” 보이게 하고 싶거나, 다운로드를 <strong>자주 안 쓰는</strong> 경우.</p>
  </li>
  <li>
    <p>팀 규칙/개인 취향상 “임시는 뒤로 보내 시각적 소음 ↓”가 더 편한 경우.<br />
→ 이런 상황이면 <strong>98_Downloads</strong> 도 충분히 합리적이에요.</p>
  </li>
</ul>

<h2 id="현실적인-권장안-둘-중-하나">현실적인 권장안 (둘 중 하나)</h2>

<ul>
  <li>
    <p><strong>A안(상단 임시 존)</strong> :<br />
<code class="language-plaintext highlighter-rouge">00_Inbox</code>(수작업 스크랩) + <code class="language-plaintext highlighter-rouge">05_Downloads</code>(자동 착륙지) + <code class="language-plaintext highlighter-rouge">10_Today</code>(실행 대시보드)</p>

    <ul>
      <li>매일 아침: <code class="language-plaintext highlighter-rouge">05_Downloads/_inbox</code> 비우기 → 정본 위치로 이동</li>
    </ul>
  </li>
  <li>
    <p><strong>B안(하단 임시 존)</strong> :<br />
<code class="language-plaintext highlighter-rouge">98_Downloads</code>로 두되 브라우저 기본경로만 <code class="language-plaintext highlighter-rouge">…/98_Downloads/_inbox</code>로 고정,<br />
Today/런처에서 바로 열 수 있게 단축만 둠</p>
  </li>
</ul>

<h2 id="결정-규칙간단">결정 규칙(간단)</h2>

<ul>
  <li>
    <p><strong>매일/자주 비울 거다</strong> → 앞번호(05)</p>
  </li>
  <li>
    <p><strong>거의 신경 안 쓰고 가끔 정리</strong> → 뒷번호(98)</p>
  </li>
  <li>
    <p>어떤 번호를 쓰든 <strong>정본은 해당 전용 폴더</strong>(26_Datasets, 80_Tools/installers, 60_Assets/fonts, 40_Resources/manuals…)로 반드시 이동하세요.</p>
  </li>
</ul>

<p>원하면 지금 구조를 A안(05) 또는 B안(98) 중 원하는 쪽으로 최종본 트리와 스크립트(브라우저 기본 경로 설정/주간 자동정리)까지 맞춰서 정리해 줄게.</p>

<p class="chat--user">

자주 정리하는게 맞긴하지만 귀찮아서 쌓아두긴해 내 성격상;

</p>

<p>그럼 “쌓이는 성격” 전제로, <strong>손 안 대도 굴러가는 자동 정리 세팅</strong> 으로 가자.<br />
아래 그대로 넣으면 <strong>주 1회/매일 자동으로</strong> <code class="language-plaintext highlighter-rouge">98_Downloads/_inbox</code>에 쌓인 걸 규칙대로 분류·이동하고, 체크섬도 남겨줘.</p>

<hr />

<h1 id="핵심-아이디어-귀찮음-최소화">핵심 아이디어 (귀찮음 최소화)</h1>

<ul>
  <li>
    <p><strong>다운로드 착륙지</strong> : <code class="language-plaintext highlighter-rouge">Work/98_Downloads/_inbox</code></p>
  </li>
  <li>
    <p><strong>자동 스윕 규칙</strong></p>

    <ul>
      <li>
        <p>설치파일( <code class="language-plaintext highlighter-rouge">.exe .msi .pkg .dmg .whl .deb .rpm .zip</code>(설치 키워드)) → <code class="language-plaintext highlighter-rouge">80_Tools/installers/</code> + <code class="language-plaintext highlighter-rouge">SHA256SUMS</code> + <code class="language-plaintext highlighter-rouge">install_notes.md</code> append</p>
      </li>
      <li>
        <p>데이터셋( <code class="language-plaintext highlighter-rouge">.csv .tsv .parquet .json .xlsx</code> / 압축 내부에 csv/parquet가 있으면 포함) → <code class="language-plaintext highlighter-rouge">26_Datasets/_staging/YYYY-MM-DD/</code> + <code class="language-plaintext highlighter-rouge">SHA256SUMS</code></p>
      </li>
      <li>
        <table>
          <tbody>
            <tr>
              <td>매뉴얼( <code class="language-plaintext highlighter-rouge">.pdf .chm .html .htm</code> / 이름에 manual</td>
              <td>guide</td>
              <td>user</td>
              <td>spec) → <code class="language-plaintext highlighter-rouge">40_Resources/manuals/_incoming/</code></td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>
        <p>폰트( <code class="language-plaintext highlighter-rouge">.ttf .otf .woff .woff2</code>) → <code class="language-plaintext highlighter-rouge">60_Assets/fonts/_incoming/</code></p>
      </li>
      <li>그 외 → 그대로 둠(다음 스윕에서 재시도)</li>
    </ul>
  </li>
  <li>
    <p><strong>삭제 금지</strong> : 자동화는 “이동+기록”만. (실수 방지)</p>
  </li>
</ul>

<hr />

<h1 id="1-macoslinux용-자동-스윕-스크립트">1) macOS/Linux용: 자동 스윕 스크립트</h1>

<p><code class="language-plaintext highlighter-rouge">~/Work/80_Tools/scripts/sweep_downloads.sh</code></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>
<span class="nb">set</span> <span class="nt">-euo</span> pipefail

<span class="nv">W</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">WORK_DIR</span><span class="k">:-</span><span class="nv">$HOME</span><span class="p">/Work</span><span class="k">}</span><span class="s2">"</span>
<span class="c"># 착륙지: 98이 없으면 05로 폴백</span>
<span class="nv">DL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$W</span><span class="s2">/98_Downloads/_inbox"</span>
<span class="o">[[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$DL</span><span class="s2">"</span> <span class="o">]]</span> <span class="o">||</span> <span class="nv">DL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$W</span><span class="s2">/05_Downloads/_inbox"</span>

<span class="nv">DEST_INSTALL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$W</span><span class="s2">/80_Tools/installers"</span>
<span class="nv">DEST_DATA_STAGE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$W</span><span class="s2">/26_Datasets/_staging/</span><span class="si">$(</span><span class="nb">date</span> +%Y-%m-%d<span class="si">)</span><span class="s2">"</span>
<span class="nv">DEST_MANUALS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$W</span><span class="s2">/40_Resources/manuals/_incoming"</span>
<span class="nv">DEST_FONTS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$W</span><span class="s2">/60_Assets/fonts/_incoming"</span>

<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$DEST_INSTALL</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$DEST_DATA_STAGE</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$DEST_MANUALS</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$DEST_FONTS</span><span class="s2">"</span>

log<span class="o">()</span> <span class="o">{</span> <span class="nb">printf</span> <span class="s2">"[%s] %s</span><span class="se">\n</span><span class="s2">"</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> <span class="s1">'+%F %T'</span><span class="si">)</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$*</span><span class="s2">"</span><span class="p">;</span> <span class="o">}</span>

<span class="c"># sha256 함수 (macOS 호환)</span>
sha256<span class="o">()</span> <span class="o">{</span>
  <span class="k">if </span><span class="nb">command</span> <span class="nt">-v</span> <span class="nb">sha256sum</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then </span><span class="nb">sha256sum</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> | <span class="nb">awk</span> <span class="s1">'{print $1}'</span><span class="p">;</span>
  <span class="k">else </span>shasum <span class="nt">-a</span> 256 <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> | <span class="nb">awk</span> <span class="s1">'{print $1}'</span><span class="p">;</span> <span class="k">fi</span>
<span class="o">}</span>

is_installer<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">f</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> | <span class="nb">tr</span> <span class="s1">'[:upper:]'</span> <span class="s1">'[:lower:]'</span><span class="si">)</span><span class="s2">"</span>
  <span class="o">[[</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> <span class="o">=</span>~ <span class="se">\.</span><span class="o">(</span>exe|msi|pkg|dmg|deb|rpm|whl<span class="o">)</span><span class="nv">$ </span><span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="k">return </span>0
  <span class="o">[[</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> <span class="o">==</span> <span class="k">*</span>.zip <span class="o">&amp;&amp;</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> <span class="o">=</span>~ <span class="o">(</span>setup|install|installer|msi|driver<span class="o">)</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="k">return </span>0
  <span class="k">return </span>1
<span class="o">}</span>

is_manual<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">f</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> | <span class="nb">tr</span> <span class="s1">'[:upper:]'</span> <span class="s1">'[:lower:]'</span><span class="si">)</span><span class="s2">"</span>
  <span class="o">[[</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> <span class="o">=</span>~ <span class="se">\.</span><span class="o">(</span>pdf|chm|html|htm<span class="o">)</span><span class="nv">$ </span><span class="o">]]</span> <span class="o">||</span> <span class="k">return </span>1
  <span class="k">return </span>0
<span class="o">}</span>

is_font<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">f</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> | <span class="nb">tr</span> <span class="s1">'[:upper:]'</span> <span class="s1">'[:lower:]'</span><span class="si">)</span><span class="s2">"</span>
  <span class="o">[[</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> <span class="o">=</span>~ <span class="se">\.</span><span class="o">(</span>ttf|otf|woff2?|ttc<span class="o">)</span><span class="nv">$ </span><span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="k">return </span>0 <span class="o">||</span> <span class="k">return </span>1
<span class="o">}</span>

zip_has_dataset<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">z</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
  <span class="nb">command</span> <span class="nt">-v</span> unzip <span class="o">&gt;</span>/dev/null 2&gt;&amp;1 <span class="o">||</span> <span class="k">return </span>1
  unzip <span class="nt">-l</span> <span class="s2">"</span><span class="nv">$z</span><span class="s2">"</span> | <span class="nb">awk</span> <span class="s1">'{print $4}'</span> | <span class="nb">grep</span> <span class="nt">-Eiq</span> <span class="s1">'\.(csv|tsv|json|parquet|xlsx)$'</span>
<span class="o">}</span>

is_dataset<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">f</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> | <span class="nb">tr</span> <span class="s1">'[:upper:]'</span> <span class="s1">'[:lower:]'</span><span class="si">)</span><span class="s2">"</span>
  <span class="o">[[</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> <span class="o">=</span>~ <span class="se">\.</span><span class="o">(</span>csv|tsv|json|parquet|xlsx<span class="o">)</span><span class="nv">$ </span><span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="k">return </span>0
  <span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> <span class="o">==</span> <span class="k">*</span>.zip <span class="o">||</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> <span class="o">==</span> <span class="k">*</span>.tar.gz <span class="o">||</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> <span class="o">==</span> <span class="k">*</span>.tgz <span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span>zip_has_dataset <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="k">return </span>0
  <span class="k">fi
  return </span>1
<span class="o">}</span>

append_install_notes<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="nv">sha</span><span class="o">=</span><span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span>
  <span class="nb">local </span><span class="nv">notes</span><span class="o">=</span><span class="s2">"</span><span class="nv">$DEST_INSTALL</span><span class="s2">/install_notes.md"</span>
  <span class="o">[[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$notes</span><span class="s2">"</span> <span class="o">]]</span> <span class="o">||</span> <span class="nb">printf</span> <span class="s2">"# Installers notes</span><span class="se">\n\n</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$notes</span><span class="s2">"</span>
  <span class="nb">printf</span> <span class="s2">"- %s  </span><span class="se">\`</span><span class="s2">%s</span><span class="se">\`</span><span class="s2">  sha256=%s</span><span class="se">\n</span><span class="s2">"</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> <span class="s1">'+%F %T'</span><span class="si">)</span><span class="s2">"</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$sha</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="s2">"</span><span class="nv">$notes</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># 메인 루프</span>
<span class="nb">shopt</span> <span class="nt">-s</span> nullglob
<span class="nv">found_any</span><span class="o">=</span>0
<span class="k">for </span>p <span class="k">in</span> <span class="s2">"</span><span class="nv">$DL</span><span class="s2">"</span>/<span class="k">*</span><span class="p">;</span> <span class="k">do</span>
  <span class="o">[[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> <span class="o">]]</span> <span class="o">||</span> <span class="k">continue
  </span><span class="nv">found_any</span><span class="o">=</span>1
  <span class="nv">base</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
  <span class="k">if </span>is_installer <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">mv</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$DEST_INSTALL</span><span class="s2">/</span><span class="nv">$base</span><span class="s2">"</span>
    <span class="nv">sha</span><span class="o">=</span><span class="si">$(</span>sha256 <span class="s2">"</span><span class="nv">$DEST_INSTALL</span><span class="s2">/</span><span class="nv">$base</span><span class="s2">"</span><span class="si">)</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$sha</span><span class="s2">  </span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$base</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="s2">"</span><span class="nv">$DEST_INSTALL</span><span class="s2">/SHA256SUMS"</span>
    append_install_notes <span class="s2">"</span><span class="nv">$DEST_INSTALL</span><span class="s2">/</span><span class="nv">$base</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$sha</span><span class="s2">"</span>
    log <span class="s2">"INSTALLER → </span><span class="nv">$DEST_INSTALL</span><span class="s2">/</span><span class="nv">$base</span><span class="s2">"</span>
  <span class="k">elif </span>is_dataset <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$DEST_DATA_STAGE</span><span class="s2">"</span>
    <span class="nb">mv</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$DEST_DATA_STAGE</span><span class="s2">/</span><span class="nv">$base</span><span class="s2">"</span>
    <span class="nv">sha</span><span class="o">=</span><span class="si">$(</span>sha256 <span class="s2">"</span><span class="nv">$DEST_DATA_STAGE</span><span class="s2">/</span><span class="nv">$base</span><span class="s2">"</span><span class="si">)</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$sha</span><span class="s2">  </span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$base</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="s2">"</span><span class="nv">$DEST_DATA_STAGE</span><span class="s2">/SHA256SUMS"</span>
    log <span class="s2">"DATASET → </span><span class="nv">$DEST_DATA_STAGE</span><span class="s2">/</span><span class="nv">$base</span><span class="s2">"</span>
  <span class="k">elif </span>is_manual <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">mv</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$DEST_MANUALS</span><span class="s2">/</span><span class="nv">$base</span><span class="s2">"</span>
    log <span class="s2">"MANUAL → </span><span class="nv">$DEST_MANUALS</span><span class="s2">/</span><span class="nv">$base</span><span class="s2">"</span>
  <span class="k">elif </span>is_font <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">mv</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$p</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$DEST_FONTS</span><span class="s2">/</span><span class="nv">$base</span><span class="s2">"</span>
    log <span class="s2">"FONT → </span><span class="nv">$DEST_FONTS</span><span class="s2">/</span><span class="nv">$base</span><span class="s2">"</span>
  <span class="k">else
    </span>log <span class="s2">"SKIP (unknown) </span><span class="nv">$base</span><span class="s2">"</span>
  <span class="k">fi
done

if</span> <span class="o">[[</span> <span class="nv">$found_any</span> <span class="nt">-eq</span> 0 <span class="o">]]</span><span class="p">;</span> <span class="k">then
  </span>log <span class="s2">"No files in </span><span class="nv">$DL</span><span class="s2">"</span>
<span class="k">fi</span>
</code></pre></div></div>

<p>실행권한:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> +x ~/Work/80_Tools/scripts/sweep_downloads.sh
</code></pre></div></div>

<h3 id="자동-실행둘-중-택1">자동 실행(둘 중 택1)</h3>

<ul>
  <li>
    <p><strong>macOS (launchd, 매일 19:00)</strong></p>

    <ol>
      <li><code class="language-plaintext highlighter-rouge">~/Library/LaunchAgents/com.work.sweepdownloads.plist</code> 생성:
        <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;&lt;dict&gt;</span>
  <span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;&lt;string&gt;</span>com.work.sweepdownloads<span class="nt">&lt;/string&gt;</span>
  <span class="nt">&lt;key&gt;</span>ProgramArguments<span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;array&gt;&lt;string&gt;</span>/Users/$(whoami)/Work/80_Tools/scripts/sweep_downloads.sh<span class="nt">&lt;/string&gt;&lt;/array&gt;</span>
  <span class="nt">&lt;key&gt;</span>StartCalendarInterval<span class="nt">&lt;/key&gt;&lt;dict&gt;&lt;key&gt;</span>Hour<span class="nt">&lt;/key&gt;&lt;integer&gt;</span>19<span class="nt">&lt;/integer&gt;&lt;key&gt;</span>Minute<span class="nt">&lt;/key&gt;&lt;integer&gt;</span>0<span class="nt">&lt;/integer&gt;&lt;/dict&gt;</span>
  <span class="nt">&lt;key&gt;</span>StandardOutPath<span class="nt">&lt;/key&gt;&lt;string&gt;</span>/tmp/sweepdownloads.out<span class="nt">&lt;/string&gt;</span>
  <span class="nt">&lt;key&gt;</span>StandardErrorPath<span class="nt">&lt;/key&gt;&lt;string&gt;</span>/tmp/sweepdownloads.err<span class="nt">&lt;/string&gt;</span>
  <span class="nt">&lt;key&gt;</span>EnvironmentVariables<span class="nt">&lt;/key&gt;&lt;dict&gt;&lt;key&gt;</span>WORK_DIR<span class="nt">&lt;/key&gt;&lt;string&gt;</span>/Users/$(whoami)/Work<span class="nt">&lt;/string&gt;&lt;/dict&gt;</span>
<span class="nt">&lt;/dict&gt;&lt;/plist&gt;</span>
</code></pre></div>        </div>
      </li>
      <li>로드: <code class="language-plaintext highlighter-rouge">launchctl load ~/Library/LaunchAgents/com.work.sweepdownloads.plist</code></li>
    </ol>
  </li>
  <li>
    <p><strong>Linux (cron, 매주 금 19:00)</strong><br />
<code class="language-plaintext highlighter-rouge">crontab -e</code>:</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0 19 * * 5 WORK_DIR=$HOME/Work $HOME/Work/80_Tools/scripts/sweep_downloads.sh &gt;&gt; $HOME/sweepdownloads.log 2&gt;&amp;1
</code></pre></div>    </div>
  </li>
</ul>

<hr />

<h1 id="2-windows용-powershell-스윕">2) Windows용: PowerShell 스윕</h1>

<p><code class="language-plaintext highlighter-rouge">$HOME\Work\80_Tools\scripts\sweep_downloads.ps1</code></p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">WORK_DIR</span><span class="p">;</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$W</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="nv">$DL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="s2">"98_Downloads\_inbox"</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="nv">$DL</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$DL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="s2">"05_Downloads\_inbox"</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="nv">$DEST_INSTALL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="s2">"80_Tools\installers"</span><span class="w">
</span><span class="nv">$DEST_DATA_STAGE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="p">(</span><span class="s2">"26_Datasets\_staging\"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">Get-Date</span><span class="w"> </span><span class="nt">-Format</span><span class="w"> </span><span class="s2">"yyyy-MM-dd"</span><span class="p">))</span><span class="w">
</span><span class="nv">$DEST_MANUALS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="s2">"40_Resources\manuals\_incoming"</span><span class="w">
</span><span class="nv">$DEST_FONTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="s2">"60_Assets\fonts\_incoming"</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nt">-ItemType</span><span class="w"> </span><span class="nx">Directory</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$DEST_INSTALL</span><span class="p">,</span><span class="nv">$DEST_DATA_STAGE</span><span class="p">,</span><span class="nv">$DEST_MANUALS</span><span class="p">,</span><span class="nv">$DEST_FONTS</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-Null</span><span class="w">

</span><span class="kr">function</span><span class="w"> </span><span class="nf">Is-Installer</span><span class="p">(</span><span class="nv">$p</span><span class="p">){</span><span class="w"> </span><span class="nv">$e</span><span class="o">=</span><span class="p">[</span><span class="n">IO.Path</span><span class="p">]::</span><span class="n">GetExtension</span><span class="p">(</span><span class="nv">$p</span><span class="p">)</span><span class="o">.</span><span class="nf">ToLower</span><span class="p">();</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="s2">".exe"</span><span class="p">,</span><span class="s2">".msi"</span><span class="p">,</span><span class="s2">".pkg"</span><span class="p">,</span><span class="s2">".dmg"</span><span class="p">,</span><span class="s2">".whl"</span><span class="p">,</span><span class="s2">".deb"</span><span class="p">,</span><span class="s2">".rpm"</span><span class="w"> </span><span class="o">-contains</span><span class="w"> </span><span class="nv">$e</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="p">(</span><span class="nv">$e</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">".zip"</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="p">(</span><span class="n">Split-Path</span><span class="w"> </span><span class="nv">$p</span><span class="w"> </span><span class="nt">-Leaf</span><span class="p">)</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s2">"(setup|install|installer|msi|driver)"</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">Is-Manual</span><span class="p">(</span><span class="nv">$p</span><span class="p">){</span><span class="w"> </span><span class="s2">".pdf"</span><span class="p">,</span><span class="s2">".chm"</span><span class="p">,</span><span class="s2">".html"</span><span class="p">,</span><span class="s2">".htm"</span><span class="w"> </span><span class="o">-contains</span><span class="w"> </span><span class="p">([</span><span class="n">IO.Path</span><span class="p">]::</span><span class="n">GetExtension</span><span class="p">(</span><span class="nv">$p</span><span class="p">)</span><span class="o">.</span><span class="nf">ToLower</span><span class="p">())</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">Is-Font</span><span class="p">(</span><span class="nv">$p</span><span class="p">){</span><span class="w"> </span><span class="s2">".ttf"</span><span class="p">,</span><span class="s2">".otf"</span><span class="p">,</span><span class="s2">".woff"</span><span class="p">,</span><span class="s2">".woff2"</span><span class="p">,</span><span class="s2">".ttc"</span><span class="w"> </span><span class="o">-contains</span><span class="w"> </span><span class="p">([</span><span class="n">IO.Path</span><span class="p">]::</span><span class="n">GetExtension</span><span class="p">(</span><span class="nv">$p</span><span class="p">)</span><span class="o">.</span><span class="nf">ToLower</span><span class="p">())</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">ZipHasDataset</span><span class="p">(</span><span class="nv">$zip</span><span class="p">){</span><span class="w">
  </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Add-Type</span><span class="w"> </span><span class="nt">-AssemblyName</span><span class="w"> </span><span class="nx">System.IO.Compression.FileSystem</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">Stop</span><span class="w">
    </span><span class="nv">$z</span><span class="o">=</span><span class="p">[</span><span class="n">IO.Compression.ZipFile</span><span class="p">]::</span><span class="n">OpenRead</span><span class="p">(</span><span class="nv">$zip</span><span class="p">)</span><span class="w">
    </span><span class="nv">$m</span><span class="o">=</span><span class="bp">$false</span><span class="w">
    </span><span class="kr">foreach</span><span class="p">(</span><span class="nv">$e</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$z</span><span class="o">.</span><span class="nf">Entries</span><span class="p">){</span><span class="w"> </span><span class="kr">if</span><span class="p">(</span><span class="nv">$e</span><span class="o">.</span><span class="nf">FullName</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s1">'\.(csv|tsv|json|parquet|xlsx)$'</span><span class="p">){</span><span class="w"> </span><span class="nv">$m</span><span class="o">=</span><span class="bp">$true</span><span class="p">;</span><span class="w"> </span><span class="kr">break</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="nv">$z</span><span class="o">.</span><span class="nf">Dispose</span><span class="p">();</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="nv">$m</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="kr">catch</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="bp">$false</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">Is-Dataset</span><span class="p">(</span><span class="nv">$p</span><span class="p">){</span><span class="w">
  </span><span class="nv">$e</span><span class="o">=</span><span class="p">[</span><span class="n">IO.Path</span><span class="p">]::</span><span class="n">GetExtension</span><span class="p">(</span><span class="nv">$p</span><span class="p">)</span><span class="o">.</span><span class="nf">ToLower</span><span class="p">()</span><span class="w">
  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="s2">".csv"</span><span class="p">,</span><span class="s2">".tsv"</span><span class="p">,</span><span class="s2">".json"</span><span class="p">,</span><span class="s2">".parquet"</span><span class="p">,</span><span class="s2">".xlsx"</span><span class="w"> </span><span class="o">-contains</span><span class="w"> </span><span class="nv">$e</span><span class="p">){</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="bp">$true</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="s2">".zip"</span><span class="p">,</span><span class="s2">".gz"</span><span class="p">,</span><span class="s2">".tgz"</span><span class="w"> </span><span class="o">-contains</span><span class="w"> </span><span class="nv">$e</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="p">(</span><span class="n">ZipHasDataset</span><span class="w"> </span><span class="nv">$p</span><span class="p">)){</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="bp">$true</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="kr">return</span><span class="w"> </span><span class="bp">$false</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">Sha256</span><span class="p">(</span><span class="nv">$p</span><span class="p">){</span><span class="w"> </span><span class="p">(</span><span class="n">Get-FileHash</span><span class="w"> </span><span class="nv">$p</span><span class="w"> </span><span class="nt">-Algorithm</span><span class="w"> </span><span class="nx">SHA256</span><span class="p">)</span><span class="o">.</span><span class="nf">Hash</span><span class="o">.</span><span class="nf">ToLower</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="nv">$DL</span><span class="w"> </span><span class="nt">-File</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nv">$src</span><span class="o">=</span><span class="bp">$_</span><span class="o">.</span><span class="nf">FullName</span><span class="p">;</span><span class="w"> </span><span class="nv">$name</span><span class="o">=</span><span class="bp">$_</span><span class="o">.</span><span class="nf">Name</span><span class="w">
  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">Is-Installer</span><span class="w"> </span><span class="nv">$src</span><span class="p">){</span><span class="w">
    </span><span class="nv">$dst</span><span class="o">=</span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$DEST_INSTALL</span><span class="w"> </span><span class="nv">$name</span><span class="p">;</span><span class="w"> </span><span class="n">Move-Item</span><span class="w"> </span><span class="nv">$src</span><span class="w"> </span><span class="nv">$dst</span><span class="w"> </span><span class="nt">-Force</span><span class="w">
    </span><span class="nv">$sha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sha256</span><span class="w"> </span><span class="nv">$dst</span><span class="w">
    </span><span class="s2">"</span><span class="nv">$sha</span><span class="s2">  </span><span class="nv">$name</span><span class="s2">"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Add-Content</span><span class="w"> </span><span class="p">(</span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$DEST_INSTALL</span><span class="w"> </span><span class="s2">"SHA256SUMS"</span><span class="p">)</span><span class="w">
    </span><span class="nv">$notes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$DEST_INSTALL</span><span class="w"> </span><span class="s2">"install_notes.md"</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="nv">$notes</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"# Installers notes</span><span class="se">`n</span><span class="s2">"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-File</span><span class="w"> </span><span class="nv">$notes</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="s2">"- </span><span class="si">$(</span><span class="n">Get-Date</span><span class="w"> </span><span class="nt">-Format</span><span class="w"> </span><span class="s1">'yyyy-MM-dd HH:mm:ss'</span><span class="p">)</span><span class="s2">  </span><span class="se">`$</span><span class="s2">name</span><span class="se">` </span><span class="s2"> sha256=</span><span class="nv">$sha</span><span class="s2">"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Add-Content</span><span class="w"> </span><span class="nv">$notes</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"INSTALLER → </span><span class="nv">$dst</span><span class="s2">"</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="n">Is-Dataset</span><span class="w"> </span><span class="nv">$src</span><span class="p">){</span><span class="w">
    </span><span class="nv">$dst</span><span class="o">=</span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$DEST_DATA_STAGE</span><span class="w"> </span><span class="nv">$name</span><span class="p">;</span><span class="w"> </span><span class="n">Move-Item</span><span class="w"> </span><span class="nv">$src</span><span class="w"> </span><span class="nv">$dst</span><span class="w"> </span><span class="nt">-Force</span><span class="w">
    </span><span class="nv">$sha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sha256</span><span class="w"> </span><span class="nv">$dst</span><span class="w">
    </span><span class="s2">"</span><span class="nv">$sha</span><span class="s2">  </span><span class="nv">$name</span><span class="s2">"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Add-Content</span><span class="w"> </span><span class="p">(</span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$DEST_DATA_STAGE</span><span class="w"> </span><span class="s2">"SHA256SUMS"</span><span class="p">)</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"DATASET → </span><span class="nv">$dst</span><span class="s2">"</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="n">Is-Manual</span><span class="w"> </span><span class="nv">$src</span><span class="p">){</span><span class="w">
    </span><span class="nv">$dst</span><span class="o">=</span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$DEST_MANUALS</span><span class="w"> </span><span class="nv">$name</span><span class="p">;</span><span class="w"> </span><span class="n">Move-Item</span><span class="w"> </span><span class="nv">$src</span><span class="w"> </span><span class="nv">$dst</span><span class="w"> </span><span class="nt">-Force</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"MANUAL → </span><span class="nv">$dst</span><span class="s2">"</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="n">Is-Font</span><span class="w"> </span><span class="nv">$src</span><span class="p">){</span><span class="w">
    </span><span class="nv">$dst</span><span class="o">=</span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$DEST_FONTS</span><span class="w"> </span><span class="nv">$name</span><span class="p">;</span><span class="w"> </span><span class="n">Move-Item</span><span class="w"> </span><span class="nv">$src</span><span class="w"> </span><span class="nv">$dst</span><span class="w"> </span><span class="nt">-Force</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"FONT → </span><span class="nv">$dst</span><span class="s2">"</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"SKIP (unknown) </span><span class="nv">$name</span><span class="s2">"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><strong>스케줄러 등록</strong> (매일 19:00):</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-ScheduledTaskAction</span><span class="w"> </span><span class="nt">-Execute</span><span class="w"> </span><span class="s2">"pwsh.exe"</span><span class="w"> </span><span class="nt">-Argument</span><span class="w"> </span><span class="s2">"-NoProfile -File </span><span class="se">`"</span><span class="bp">$HOME</span><span class="s2">\Work\80_Tools\scripts\sweep_downloads.ps1</span><span class="se">`"</span><span class="s2">"</span><span class="w">
</span><span class="nv">$trg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-ScheduledTaskTrigger</span><span class="w"> </span><span class="nt">-Daily</span><span class="w"> </span><span class="nt">-At</span><span class="w"> </span><span class="nx">19:00</span><span class="w">
</span><span class="n">Register-ScheduledTask</span><span class="w"> </span><span class="nt">-TaskName</span><span class="w"> </span><span class="s2">"WorkSweepDownloads"</span><span class="w"> </span><span class="nt">-Action</span><span class="w"> </span><span class="nv">$act</span><span class="w"> </span><span class="nt">-Trigger</span><span class="w"> </span><span class="nv">$trg</span><span class="w"> </span><span class="nt">-Description</span><span class="w"> </span><span class="s2">"Move downloads to canonical locations"</span><span class="w">
</span></code></pre></div></div>

<hr />

<h1 id="3-today런처에-수동-실행-버튼선택">3) today/런처에 수동 실행 버튼(선택)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Sweep downloads now   | 80_Tools/scripts | ./sweep_downloads.sh
</code></pre></div></div>

<p>(PowerShell이면 <code class="language-plaintext highlighter-rouge">./sweep_downloads.ps1</code>)</p>

<hr />

<h2 id="운용-팁--주의점">운용 팁 &amp; 주의점</h2>

<ul>
  <li>
    <p><strong>정본만 이동</strong> : 스크립트는 <em>이동만</em> 하므로 되돌리기 쉬워요. 삭제는 손대지 않음.</p>
  </li>
  <li>
    <p><strong>데이터셋은<code class="language-plaintext highlighter-rouge">_staging</code></strong>: 이름/버전 결정을 못하니 <code class="language-plaintext highlighter-rouge">26_Datasets/_staging/YYYY-MM-DD/</code>로 모읍니다. 필요할 때만 정식 버전(<code class="language-plaintext highlighter-rouge">datasets/&lt;name&gt;/vYYYY.MMDD/…</code>)으로 <strong>승격</strong> 하세요.</p>
  </li>
  <li>
    <p><strong>체크섬 자동 기록</strong> : 설치파일/데이터셋은 <code class="language-plaintext highlighter-rouge">SHA256SUMS</code> 생성, 설치파일은 <code class="language-plaintext highlighter-rouge">install_notes.md</code>에 타임스탬프까지 남김.</p>
  </li>
  <li>
    <p><strong>미인식 파일</strong> : 규칙에 안 맞으면 그냥 건드리지 않습니다(다음 스윕에 재시도).</p>
  </li>
  <li>
    <p><strong>안전망</strong> : 처음 1~2주 동안은 <strong>수동 실행으로 결과 확인</strong> 해 보세요. 문제가 없으면 스케줄러 켜두면 끝.</p>
  </li>
</ul>

<p>원하면 위 스크립트에 <strong>추가 규칙(예: 특정 프로젝트 이름 키워드로 데이터셋 자동 폴더명 부여, zip 내부 구조에 따른 자동 풀기)</strong>도 얹어 줄게.</p>

<p class="chat--user">

그냥 05로 할게

</p>

<p>좋아, <strong>05로 확정!</strong> 다운로드 착륙지를 <code class="language-plaintext highlighter-rouge">05_Downloads</code>로 쓰는 설정을 한 번에 마무리하자. 아래 그대로 따라 하면 끝이야.</p>

<hr />

<h1 id="1-폴더-만들기-복붙">1) 폴더 만들기 (복붙)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/
├─ 05_Downloads/                 - 다운로드 착륙지(Landing Zone, 정리 전 임시)
│  ├─ _inbox/                    - 브라우저/툴 기본 저장 경로
│  ├─ installers/                - 설치 파일(.exe/.msi/.pkg/.dmg/.whl/.zip)
│  ├─ datasets/                  - 데이터셋 압축/CSV 임시(해제 전)
│  ├─ manuals/                   - 매뉴얼/가이드 PDF/HTML 임시
│  ├─ assets/                    - 폰트/아이콘/템플릿 등 임시
│  └─ quarantine/                - 의심 파일(검사 전 격리)
</code></pre></div></div>

<hr />

<h1 id="2-초기-셋업-step-by-step">2) 초기 셋업 (step-by-step)</h1>

<h2 id="macos--linux-1">macOS / Linux</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> ~/Work/05_Downloads/<span class="o">{</span>_inbox,installers,datasets,manuals,assets,quarantine<span class="o">}</span>

<span class="c"># (선택) OS 기본 Downloads → Work/05_Downloads/_inbox 로 바꾸기</span>
<span class="nb">mv</span> ~/Downloads ~/Downloads.bak 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
ln</span> <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/05_Downloads/_inbox"</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Downloads"</span>
</code></pre></div></div>

<h2 id="windows-powershell-4">Windows (PowerShell)</h2>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">New-Item</span><span class="w"> </span><span class="nt">-ItemType</span><span class="w"> </span><span class="nx">Directory</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\05_Downloads\_inbox"</span><span class="p">,</span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\05_Downloads\installers"</span><span class="p">,</span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\05_Downloads\datasets"</span><span class="p">,</span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\05_Downloads\manuals"</span><span class="p">,</span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\05_Downloads\assets"</span><span class="p">,</span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\05_Downloads\quarantine"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-Null</span><span class="w">

</span><span class="c"># (선택) 사용자 Downloads → Work\05_Downloads\_inbox 링크</span><span class="w">
</span><span class="n">Rename-Item</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Downloads"</span><span class="w"> </span><span class="s2">"Downloads.bak"</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
</span><span class="n">cmd</span><span class="w"> </span><span class="nx">/c</span><span class="w"> </span><span class="nx">mklink</span><span class="w"> </span><span class="nx">/D</span><span class="w"> </span><span class="s2">"%USERPROFILE%\Downloads"</span><span class="w"> </span><span class="s2">"%USERPROFILE%\Work\05_Downloads\_inbox"</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>브라우저(Chrome/Edge/Firefox) <strong>기본 다운로드 폴더</strong> 를 <code class="language-plaintext highlighter-rouge">Work/05_Downloads/_inbox</code>로 설정하면 더 깔끔.</p>
</blockquote>

<hr />

<h1 id="3-사용-중이면-98에서-05로-이관">3) (사용 중이면) 98에서 05로 이관</h1>

<h3 id="macos--linux-2">macOS / Linux</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span> <span class="nt">-d</span> ~/Work/98_Downloads <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">mv</span> ~/Work/98_Downloads/<span class="k">*</span> ~/Work/05_Downloads/ 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
rmdir</span> ~/Work/98_Downloads 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
sed</span> <span class="nt">-i</span> <span class="s1">''</span> <span class="s1">'s#/98_Downloads/#/05_Downloads/#g'</span> ~/Work/10_Today/shortcuts.list 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>
</code></pre></div></div>

<h3 id="windows-powershell-5">Windows (PowerShell)</h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\98_Downloads"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">Move-Item</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\98_Downloads\*"</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\05_Downloads"</span><span class="w"> </span><span class="nt">-Force</span><span class="w">
  </span><span class="n">Remove-Item</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\98_Downloads"</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">(</span><span class="n">Get-Content</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\10_Today\shortcuts.list"</span><span class="p">)</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'/98_Downloads/'</span><span class="p">,</span><span class="s1">'/05_Downloads/'</span><span class="w"> </span><span class="o">|</span><span class="w">
  </span><span class="n">Set-Content</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\10_Today\shortcuts.list"</span><span class="w">
</span></code></pre></div></div>

<hr />

<h1 id="4-자동-정리-스크립트05-우선-사용-팁">4) 자동 정리 스크립트(05 우선) 사용 팁</h1>

<p>내가 줬던 <strong>스윕 스크립트</strong> 를 05 우선으로 돌리려면, 상단의 다운로드 경로만 이렇게 잡으면 돼.</p>

<p><strong>bash/zsh (<code class="language-plaintext highlighter-rouge">sweep_downloads.sh</code>)</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">W</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">WORK_DIR</span><span class="k">:-</span><span class="nv">$HOME</span><span class="p">/Work</span><span class="k">}</span><span class="s2">"</span>
<span class="nv">DL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$W</span><span class="s2">/05_Downloads/_inbox"</span>
<span class="o">[[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$DL</span><span class="s2">"</span> <span class="o">]]</span> <span class="o">||</span> <span class="nv">DL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$W</span><span class="s2">/98_Downloads/_inbox"</span>   <span class="c"># (있으면 폴백)</span>
</code></pre></div></div>

<p><strong>PowerShell (<code class="language-plaintext highlighter-rouge">sweep_downloads.ps1</code>)</strong></p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">WORK_DIR</span><span class="p">;</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$W</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="nv">$DL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="s2">"05_Downloads\_inbox"</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="nv">$DL</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$DL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="s2">"98_Downloads\_inbox"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>스케줄(매일/매주) 등록 방법은 이전 메시지 그대로 쓰면 OK.</p>
</blockquote>

<hr />

<h1 id="5-today-런처에-한-줄선택">5) Today 런처에 한 줄(선택)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Sort downloads       | 05_Downloads               | ${EDITOR:-vi} README_SORTING.md
Open installers box  | 80_Tools/installers        | ls -al
</code></pre></div></div>

<hr />

<h2 id="사용-시-주의점요약">사용 시 주의점(요약)</h2>

<ul>
  <li>
    <p><strong>05_Downloads는 임시</strong> : 정본은 반드시 전용 위치로</p>

    <ul>
      <li>
        <p>설치파일 → <code class="language-plaintext highlighter-rouge">80_Tools/installers/</code> (+ <code class="language-plaintext highlighter-rouge">install_notes.md</code>/<code class="language-plaintext highlighter-rouge">SHA256SUMS</code>)</p>
      </li>
      <li>
        <p>데이터셋 → <code class="language-plaintext highlighter-rouge">26_Datasets/...</code> (+ <code class="language-plaintext highlighter-rouge">manifest.yml</code>/<code class="language-plaintext highlighter-rouge">SHA256SUMS</code>)</p>
      </li>
      <li>
        <p>매뉴얼 → <code class="language-plaintext highlighter-rouge">40_Resources/manuals/...</code></p>
      </li>
      <li>
        <p>자산(폰트 등) → <code class="language-plaintext highlighter-rouge">60_Assets/...</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>자동화 적극 활용</strong> : 스윕 스크립트를 <strong>스케줄러에 등록</strong> 해 “손 안 대고” 분류·이동.</p>
  </li>
  <li>
    <p><strong>보안</strong> : 출처 불명은 <code class="language-plaintext highlighter-rouge">quarantine/</code>에 먼저 두고 검사.</p>
  </li>
  <li>
    <p><strong>.gitignore</strong> : Work를 레포로 관리한다면 <code class="language-plaintext highlighter-rouge">05_Downloads/**</code>는 <strong>항상 제외</strong>.</p>
  </li>
  <li>
    <p><strong>정리 루틴</strong> : 최소 주 1회 <code class="language-plaintext highlighter-rouge">_inbox</code> 확인(자동화가 못 잡은 항목만 처리).</p>
  </li>
</ul>

<p>원하면 네 환경(운영체제/셸)에 맞춰 스윕 스크립트를 <strong>05 기준으로 고정한 최종본</strong> 을 깔끔히 묶어서 드릴게.</p>

<p class="chat--user">

.cshrc는 어디 두는게 좋을까

</p>

<p>짧게: <strong>정본은</strong> <code class="language-plaintext highlighter-rouge">Work/90_PersonalConfigs/shell/tcsh/.tcshrc</code> 에 두고, <strong>홈에는 심볼릭 링크</strong> 로 연결하세요.<br />
(팀/공유 기본값이 있다면 <code class="language-plaintext highlighter-rouge">Work/32_SharedConfigs/global/shell/tcsh/tcshrc.base</code>를 먼저 <code class="language-plaintext highlighter-rouge">source</code>하고 개인 설정으로 오버라이드.)</p>

<hr />

<h1 id="어디에-어떻게-두나-step-by-step">어디에 어떻게 두나 (step-by-step)</h1>

<h2 id="1-위치정본">1) 위치(정본)</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/
└─ 90_PersonalConfigs/
   └─ shell/
      └─ tcsh/
         ├─ .tcshrc          ← 개인 메인 설정(정본)
         ├─ rc.d/            ← 분할 설정(옵션)
         │  ├─ 00-paths.csh
         │  ├─ 10-env.csh
         │  ├─ 20-aliases.csh
         │  └─ 30-prompt.csh
         └─ host.d/          ← 기기별 오버라이드(옵션)
            └─ &lt;hostname&gt;.csh
</code></pre></div></div>

<blockquote>
  <p><strong>왜<code class="language-plaintext highlighter-rouge">.tcshrc</code>?</strong> tcsh는 <code class="language-plaintext highlighter-rouge">~/.tcshrc</code>가 있으면 그걸 우선 읽고, 없으면 <code class="language-plaintext highlighter-rouge">~/.cshrc</code>를 읽습니다. 호환이 필요하면 <code class="language-plaintext highlighter-rouge">~/.cshrc</code>를 <code class="language-plaintext highlighter-rouge">~/.tcshrc</code>로 링크해 두면 돼요.</p>
</blockquote>

<h2 id="2-홈에-연결심볼릭-링크">2) 홈에 연결(심볼릭 링크)</h2>

<p><strong>macOS/Linux</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ln</span> <span class="nt">-snf</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/90_PersonalConfigs/shell/tcsh/.tcshrc"</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.tcshrc"</span>
<span class="c"># (선택) csh 호환</span>
<span class="nb">ln</span> <span class="nt">-snf</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.tcshrc"</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.cshrc"</span>
</code></pre></div></div>

<p><strong>WSL/Cygwin</strong> 도 동일(경로만 맞추면 됨).</p>

<h2 id="3-추천-tcshrc-골격복붙">3) 추천 <code class="language-plaintext highlighter-rouge">.tcshrc</code> 골격(복붙)</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

# --- shared base (있으면) ---
if ( -r "$HOME/Work/32_SharedConfigs/global/shell/tcsh/tcshrc.base" ) then
  source "$HOME/Work/32_SharedConfigs/global/shell/tcsh/tcshrc.base"
endif

# --- 개인 기본값 ---
setenv WORK_DIR "$HOME/Work"

# PATH 예시: (중복되면 앞에 두기)
set path = ( $HOME/Work/80_Tools/scripts $path )

# 분할 로드(rc.d/*.csh)
set _rcdir = "$HOME/Work/90_PersonalConfigs/shell/tcsh/rc.d"
if ( -d "$_rcdir" ) then
  set _files = ( `/bin/ls $_rcdir/*.csh 2&gt;/dev/null` )
  foreach f ( $_files )
    if ( -r "$f" ) source "$f"
  end
endif

# 호스트별 오버라이드(host.d/&lt;hostname&gt;.csh)
set _host = `hostname -s`
set _hostrc = "$HOME/Work/90_PersonalConfigs/shell/tcsh/host.d/${_host}.csh"
if ( -r "$_hostrc" ) source "$_hostrc"

# 인터랙티브에서만 프롬프트/컬러
if ( $?prompt ) then
  set prompt = "%B%n%b@%m:%~ %# "
endif

# (선택) Today 런처 단축키
if ( -x "$HOME/Work/10_Today/today.csh" ) then
  alias t "$HOME/Work/10_Today/today.csh"
endif
</code></pre></div></div>

<h3 id="예시-분할-파일">예시 분할 파일</h3>

<p><code class="language-plaintext highlighter-rouge">rc.d/20-aliases.csh</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

alias ll 'ls -alF'
alias gs 'git status'
alias gp 'git pull --rebase'
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">rc.d/00-paths.csh</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

# 자주 쓰는 경로 우선
set path = ( $HOME/Work/80_Tools/scripts $HOME/bin $path )
</code></pre></div></div>

<blockquote>
  <p><strong>비밀/토큰</strong> 은 이 파일들에 직접 넣지 말고, tcsh 형식으로 적은 <code class="language-plaintext highlighter-rouge">Work/90_PersonalConfigs/secrets/.env-shell.local</code> 등을 따로 두고 필요 시 <code class="language-plaintext highlighter-rouge">source</code>하세요.</p>
</blockquote>

<hr />

<h1 id="운용-규칙핵심-1">운용 규칙(핵심)</h1>

<ul>
  <li>
    <p><strong>정본은 90_PersonalConfigs</strong> : 홈의 <code class="language-plaintext highlighter-rouge">~/.tcshrc</code>는 <strong>링크</strong> 만. 백업/동기화는 정본만 관리.</p>
  </li>
  <li>
    <p><strong>레이어링</strong> : <code class="language-plaintext highlighter-rouge">32_SharedConfigs</code>(있으면) → <code class="language-plaintext highlighter-rouge">90_PersonalConfigs</code>(개인 오버라이드) → 호스트별.</p>
  </li>
  <li>
    <p><strong>모듈화</strong> : <code class="language-plaintext highlighter-rouge">rc.d/*.csh</code>로 쪼개 두면 충돌/수정이 쉬움.</p>
  </li>
  <li>
    <p><strong>재적용</strong> : 변경 후 <code class="language-plaintext highlighter-rouge">source ~/.tcshrc</code>로 즉시 적용.</p>
  </li>
  <li>
    <p><strong>이식성</strong> : 다른 머신에선 <strong>링크만</strong> 다시 걸면 같은 환경 재현.</p>
  </li>
</ul>

<p>필요하면 네 현재 <code class="language-plaintext highlighter-rouge">.cshrc</code> 내용을 위 구조로 자동 분해(aliases/env/path/prompt)해 주는 스크립트도 만들어 줄게—원하면 붙여줘!</p>

<p class="chat--user">

좀 Stable 하게 기반이 될 Tool들(e.g. gcc)도 그냥 80_Tools에 설치하면 되려나? 여러 사람이 공유할 급의 안정적이어야하는 툴들과 가볍게 개인적으로 테스트해보는 툴 등 전부다 저기 박으려니 좀 헷갈릴거 같기도하고

</p>

<p>좋은 고민이야. <strong>정리:</strong> <em>모든 걸 80_Tools에 몰지 말고</em> “안정적·공유용 vs. 개인 실험용”으로 <strong>물리적 분리</strong> 하자.</p>

<hr />

<h1 id="권장-분리안">권장 분리안</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/
├─ 78_Toolchains/                         - 팀/장기 공용용 ‘고정 버전’ 툴체인(매우 안정)
│  ├─ gcc/13.2.0/{bin,lib,include,...}
│  ├─ cmake/3.29.3/{bin,...}
│  ├─ ninja/1.12.1/{bin,...}
│  └─ &lt;tool&gt;/&lt;ver&gt;/&lt;os&gt;-&lt;arch&gt;/          - 필요 시 OS/아키 구분 (win-x64, linux-x64, mac-arm64)
│     └─ latest → &lt;ver&gt;                  - 심볼릭 링크(현재 표준)
├─ 79_SDKs/                               - 큰 플랫폼 SDK/런타임(JDK, Qt, Android NDK 등)
│  ├─ jdk/21.0.2/
│  ├─ qt/6.7.2/
│  └─ &lt;sdk&gt;/&lt;ver&gt;/
├─ 80_Tools/                              - 개인·단기·포터블 유틸(자주 바뀌는 것)
│  ├─ installers/                         - 설치 파일 보관(체크섬, install_notes.md)
│  ├─ bin/                                - 작은 단일 바이너리(사전 PATH)
│  ├─ portable/                           - 압축 풀어 쓰는 포터블 툴(개인용)
│  ├─ scripts/                            - 부트스트랩/릴리스/체크섬 스크립트
│  └─ scratch/                            - 실험용(자동 청소 대상)
└─ 85_Environments/                       - 도커/콘다/venv 등 “환경 캡슐” 샘플
</code></pre></div></div>

<blockquote>
  <p><strong>한 줄 규칙</strong></p>

  <ul>
    <li>
      <p><strong>팀과 공유할 ‘표준 버전, 오래 쓰는 툴’</strong> → <code class="language-plaintext highlighter-rouge">78_Toolchains/</code></p>
    </li>
    <li>
      <p><strong>개인 테스트·포터블·자주 바뀌는 유틸</strong> → <code class="language-plaintext highlighter-rouge">80_Tools/</code></p>
    </li>
    <li>
      <p><strong>플랫폼/런타임 묶음</strong>(JDK/Qt/NDK 등 대형 SDK) → <code class="language-plaintext highlighter-rouge">79_SDKs/</code></p>
    </li>
    <li>
      <p><strong>프로젝트 전용/복제 가능 환경</strong> → <code class="language-plaintext highlighter-rouge">85_Environments/</code>(Docker/conda 등)로 캡슐화</p>
    </li>
  </ul>

</blockquote>

<hr />

<h2 id="어떻게-선택하지-결정표">어떻게 선택하지? (결정표)</h2>

<table>
  <thead>
    <tr>
      <th>상황</th>
      <th>위치</th>
      <th>이유</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>팀 표준 gcc/cmake/ninja처럼 <strong>버전 고정·장기 사용</strong></td>
      <td><code class="language-plaintext highlighter-rouge">78_Toolchains/&lt;tool&gt;/&lt;ver&gt;/</code></td>
      <td>경로·버전이 안 흔들림, CI/문서와 일치</td>
    </tr>
    <tr>
      <td>Qt/JDK/NDK 같은 <strong>대형 SDK</strong></td>
      <td><code class="language-plaintext highlighter-rouge">79_SDKs/&lt;sdk&gt;/&lt;ver&gt;/</code></td>
      <td>용량 큼, 다중 버전 공존 필요</td>
    </tr>
    <tr>
      <td><strong>개인 실험/경량 유틸</strong>(ripgrep, fd, bat 등)</td>
      <td><code class="language-plaintext highlighter-rouge">80_Tools/bin</code> or <code class="language-plaintext highlighter-rouge">80_Tools/portable</code></td>
      <td>자주 교체, 실패해도 영향 적음</td>
    </tr>
    <tr>
      <td><strong>프로젝트별 의존 스택</strong>(파이썬/시스템툴 조합)</td>
      <td>`85_Environments/docker</td>
      <td>conda</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="버전path-운용충돌-없이">버전·PATH 운용(충돌 없이)</h2>

<h3 id="1-latest-심볼릭-링크공유-표준">1) “latest” 심볼릭 링크(공유 표준)</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>78_Toolchains/gcc/13.2.0/...
78_Toolchains/gcc/latest  -&gt; 13.2.0
</code></pre></div></div>

<ul>
  <li>문서/스크립트에 <strong><code class="language-plaintext highlighter-rouge">.../gcc/latest/bin</code></strong>를 쓰면 팀이 최신 표준을 바꿀 때 하나만 갈아끼면 됨.</li>
</ul>

<h3 id="2-path-레이어우선순위">2) PATH 레이어(우선순위)</h3>

<ul>
  <li><strong>bash/zsh</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/80_Tools/bin:</span><span class="nv">$HOME</span><span class="s2">/Work/78_Toolchains/gcc/latest/bin:</span><span class="nv">$HOME</span><span class="s2">/Work/78_Toolchains/cmake/latest/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
</code></pre></div>    </div>
  </li>
  <li><strong>tcsh</strong>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh
    
set path = ( $HOME/Work/80_Tools/bin $HOME/Work/78_Toolchains/gcc/latest/bin $path )
</code></pre></div>    </div>
  </li>
  <li><strong>PowerShell</strong>
    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">Path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\80_Tools\bin;</span><span class="bp">$HOME</span><span class="s2">\Work\78_Toolchains\gcc\latest\bin;"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">Path</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<h3 id="3-세션-한정-버전-스위치충돌-방지">3) 세션 한정 버전 스위치(충돌 방지)</h3>

<ul>
  <li><strong>bash/zsh</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use<span class="o">()</span> <span class="o">{</span>  <span class="c"># 사용: use gcc 13.2.0</span>
  <span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="k">in
    </span>gcc|cmake|ninja<span class="p">)</span> <span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/78_Toolchains/</span><span class="nv">$1</span><span class="s2">/</span><span class="nv">$2</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">"</span> <span class="p">;;</span>
    jdk<span class="p">)</span> <span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/79_SDKs/jdk/</span><span class="nv">$2</span><span class="s2">"</span><span class="p">;</span> <span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$JAVA_HOME</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">"</span> <span class="p">;;</span>
    <span class="k">*</span><span class="p">)</span> <span class="nb">echo</span> <span class="s2">"unknown tool"</span><span class="p">;;</span>
  <span class="k">esac</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li><strong>tcsh</strong>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh
    
alias use 'set t=\!:1; set v=\!:2; set p=$HOME/Work/78_Toolchains/$t/$v/bin; if ( -d $p ) set path = ( $p $path )'
</code></pre></div>    </div>
  </li>
  <li><strong>PowerShell</strong>
    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">function</span><span class="w"> </span><span class="nf">Use-Tool</span><span class="p">(</span><span class="nv">$t</span><span class="p">,</span><span class="nv">$v</span><span class="p">){</span><span class="w"> </span><span class="nv">$p</span><span class="o">=</span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\78_Toolchains\</span><span class="nv">$t</span><span class="s2">\</span><span class="nv">$v</span><span class="s2">\bin"</span><span class="p">;</span><span class="w"> </span><span class="kr">if</span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="nv">$p</span><span class="p">){</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">Path</span><span class="o">=</span><span class="s2">"</span><span class="nv">$p</span><span class="s2">;</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">Path</span><span class="s2">"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<hr />

<h2 id="설치기록-규칙짧게">설치/기록 규칙(짧게)</h2>

<ul>
  <li>
    <p><strong>체크섬</strong> : 내려받은 아카이브는 <code class="language-plaintext highlighter-rouge">80_Tools/installers</code>에 보관하고 <code class="language-plaintext highlighter-rouge">SHA256SUMS</code> + <code class="language-plaintext highlighter-rouge">install_notes.md</code> 기록.</p>
  </li>
  <li>
    <p><strong>풀 위치</strong> :</p>

    <ul>
      <li>
        <p>공용/고정 버전 → <code class="language-plaintext highlighter-rouge">78_Toolchains/&lt;tool&gt;/&lt;ver&gt;/</code>에 압축 해제</p>
      </li>
      <li>
        <p>개인 테스트 → <code class="language-plaintext highlighter-rouge">80_Tools/portable/&lt;tool&gt;-&lt;ver&gt;/</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>문서화</strong> : <code class="language-plaintext highlighter-rouge">32_SharedConfigs/global/&lt;tool&gt;/README.md</code>에 “표준 버전/경로/업데이트 절차” 1페이지.</p>
  </li>
</ul>

<hr />

<h2 id="청소-정책">청소 정책</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">80_Tools/scratch</code>와 <code class="language-plaintext highlighter-rouge">80_Tools/portable</code>은 <strong>N일(예: 60일) 미사용 시 자동 삭제</strong> 스윕 스크립트 권장.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">78_Toolchains</code>/<code class="language-plaintext highlighter-rouge">79_SDKs</code>는 <strong>삭제 금지</strong>(팀 표준). 교체 시 <strong>latest</strong> 만 전환하고 구버전은 일정 기간 보존.</p>
  </li>
</ul>

<hr />

<h2 id="예시-gcc-운용">예시: gcc 운용</h2>

<ol>
  <li>
    <p>설치 파일을 <code class="language-plaintext highlighter-rouge">05_Downloads/_inbox</code> → 스윕 → <code class="language-plaintext highlighter-rouge">80_Tools/installers</code>로 이동(+체크섬).</p>
  </li>
  <li>
    <p>압축/설치 후 <code class="language-plaintext highlighter-rouge">78_Toolchains/gcc/13.2.0/</code>에 배치.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">78_Toolchains/gcc/latest → 13.2.0</code> 링크 생성.</p>
  </li>
  <li>
    <p>CI/문서/개인 PATH에서 <code class="language-plaintext highlighter-rouge">.../gcc/latest/bin</code> 사용.</p>
  </li>
  <li>
    <p>새 표준 채택 시 <code class="language-plaintext highlighter-rouge">latest</code>만 갈아끼우고, 구버전은 <code class="language-plaintext highlighter-rouge">13.1.0/</code> 그대로 보존.</p>
  </li>
</ol>

<hr />

<h2 id="마이그레이션지금-섞여-있다면">마이그레이션(지금 섞여 있다면)</h2>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">80_Tools/portable</code>로 <strong>개인 실험 툴</strong> 을 먼저 분리 이동.</p>
  </li>
  <li>
    <p>팀이 공유하는 고정 버전은 <code class="language-plaintext highlighter-rouge">78_Toolchains/&lt;tool&gt;/&lt;ver&gt;/</code>로 이관 + <code class="language-plaintext highlighter-rouge">latest</code> 링크.</p>
  </li>
  <li>
    <p>PATH/런처/스크립트에서 절대경로를 <strong>78/79 기준</strong> 으로 교체.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">32_SharedConfigs/global</code>에 <strong>표준 버전 표</strong> 1장 추가(업데이트 절차 포함).</p>
  </li>
</ol>

<hr />

<h3 id="요약-4">요약</h3>

<ul>
  <li>
    <p><strong>안정·공유</strong> ↔ <strong>개인·가변</strong> 을 <strong>물리적으로 분리</strong> : <code class="language-plaintext highlighter-rouge">78_Toolchains</code>/<code class="language-plaintext highlighter-rouge">79_SDKs</code> vs <code class="language-plaintext highlighter-rouge">80_Tools</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">latest</code> 링크 + <code class="language-plaintext highlighter-rouge">use</code> 함수로 <strong>버전 스위칭</strong> 스트레스 최소화.</p>
  </li>
  <li>
    <p>설치·체크섬·문서화 루틴을 고정해 <strong>예측 가능성</strong> 을 확보.</p>
  </li>
</ul>

<p>원하면 네 OS/셸에 맞는 <strong>폴더 생성·latest 링크·PATH 설정</strong> 을 한 번에 해주는 부트스트랩 스크립트(bash/tcsh/PowerShell)도 만들어줄게.</p>

<p class="chat--user">

지금 상태에서 각각 폴더명은 그대로 둔 채 폴더 번호를 다시 합리적으로 꼼꼼히 생각해서 매겨봐줘.

</p>

<p>좋아! “폴더 <strong>이름은 그대로</strong> 두고, <strong>번호만</strong> 합리적으로 리패터닝” 해봤어.<br />
핵심은 <strong>흐름(수집→오늘→개발→실행/데이터→지식/설정→자료→산출→툴/환경→개인→보관)</strong> 순으로 <strong>번호 블록을 붙여</strong> 스캔했을 때 직관적으로 보이게 하는 거야.</p>

<hr />

<h1 id="번호-설계-원칙-짧게">번호 설계 원칙 (짧게)</h1>

<ol>
  <li>
    <p><strong>00–09 수집/임시</strong> : Inbox·Downloads</p>
  </li>
  <li>
    <p><strong>10–19 오늘·런처</strong> : Today</p>
  </li>
  <li>
    <p><strong>20–29 개발/실행/데이터</strong> : Projects·Labs·Jobs·Datasets</p>
  </li>
  <li>
    <p><strong>30–39 지식/설정</strong> : Areas·SharedConfigs</p>
  </li>
  <li>
    <p><strong>40–49 참고자료</strong> : Resources</p>
  </li>
  <li>
    <p><strong>50–59 코드조각</strong> : Snippets</p>
  </li>
  <li>
    <p><strong>60–69 시각자산</strong> : Assets</p>
  </li>
  <li>
    <p><strong>70–79 산출/배포</strong> : Exports·Releases</p>
  </li>
  <li>
    <p><strong>80–89 툴스택</strong> : Toolchains·SDKs·Tools·Environments</p>
  </li>
  <li>
    <p><strong>90–99 개인/보관</strong> : PersonalConfigs·Archive</p>
  </li>
</ol>

<hr />

<h1 id="제안-번호-최종안">제안 번호 (최종안)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>00_Inbox             - 급히 던져두는 임시함
05_Downloads         - 다운로드 착륙지(_inbox/ installers/ datasets/ …)
10_Today             - 오늘 작업 대시보드(런처/단축)
20_Projects          - 툴(파이썬 패키지) 개발 리포
22_Labs              - 가벼운 실험/프로토(재현 불필요)
25_Jobs              - 산출 작업 단위(입력→설정→실행→전달)
26_Datasets          - 입력/출력 데이터셋 중앙 저장소
30_Areas             - 장기 운영 영역(지속 업무/정책 메모)
32_SharedConfigs     - 공유/골든 설정(표준 ruff/pytest/VSCode 등)
40_Resources         - 교육/매뉴얼/스펙 등 참고 자료
50_Snippets          - 재사용 코드/원라이너/텍스트 조각
60_Assets            - 로고/폰트/템플릿 등 시각 자산
70_Exports           - 여러 Job의 최종 전달본 모아보기(옵션)
75_Releases          - 유저 배포본(버전드, checksums/ ReleaseNotes)
82_Toolchains        - gcc/cmake/ninja 등 팀 표준 ‘고정 버전’ 툴체인
83_SDKs              - JDK/Qt/Android NDK 같은 대형 SDK
84_Tools             - 개인·경량·포터블 유틸/스크립트
86_Environments      - docker/conda/venv 등 환경 캡슐
90_PersonalConfigs   - 개인 설정(오버라이드/비공개)
99_Archive           - 완료 항목 장기 보관(읽기 전용)
</code></pre></div></div>

<blockquote>
  <p>포인트</p>

  <ul>
    <li>
      <p><strong>Labs를 31→22</strong> 로 당겨 <strong>Projects(20)–Labs(22)–Jobs(25)–Datasets(26)</strong>가 연속 흐름이 됨.</p>
    </li>
    <li>
      <p><strong>Toolchains/SDKs/Tools/Environments</strong> 를 <strong>82–86</strong> 으로 한 블록에 모아 충돌/우선순위 관리 쉬움.</p>
    </li>
    <li>
      <p>나머지는 기존 의미 유지(번호만 정리).</p>
    </li>
  </ul>

</blockquote>

<hr />

<h1 id="참고-기존--새-번호-매핑">(참고) 기존 → 새 번호 매핑</h1>

<table>
  <thead>
    <tr>
      <th>기존</th>
      <th>새</th>
      <th>폴더명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>00</td>
      <td>00</td>
      <td>Inbox</td>
    </tr>
    <tr>
      <td>05 또는 98</td>
      <td>05</td>
      <td>Downloads</td>
    </tr>
    <tr>
      <td>10</td>
      <td>10</td>
      <td>Today</td>
    </tr>
    <tr>
      <td>20</td>
      <td>20</td>
      <td>Projects</td>
    </tr>
    <tr>
      <td>31</td>
      <td>22</td>
      <td>Labs</td>
    </tr>
    <tr>
      <td>25</td>
      <td>25</td>
      <td>Jobs</td>
    </tr>
    <tr>
      <td>26</td>
      <td>26</td>
      <td>Datasets</td>
    </tr>
    <tr>
      <td>30</td>
      <td>30</td>
      <td>Areas</td>
    </tr>
    <tr>
      <td>32</td>
      <td>32</td>
      <td>SharedConfigs</td>
    </tr>
    <tr>
      <td>40</td>
      <td>40</td>
      <td>Resources</td>
    </tr>
    <tr>
      <td>50</td>
      <td>50</td>
      <td>Snippets</td>
    </tr>
    <tr>
      <td>60</td>
      <td>60</td>
      <td>Assets</td>
    </tr>
    <tr>
      <td>70</td>
      <td>70</td>
      <td>Exports</td>
    </tr>
    <tr>
      <td>75</td>
      <td>75</td>
      <td>Releases</td>
    </tr>
    <tr>
      <td>78</td>
      <td>82</td>
      <td>Toolchains</td>
    </tr>
    <tr>
      <td>79</td>
      <td>83</td>
      <td>SDKs</td>
    </tr>
    <tr>
      <td>80</td>
      <td>84</td>
      <td>Tools</td>
    </tr>
    <tr>
      <td>85</td>
      <td>86</td>
      <td>Environments</td>
    </tr>
    <tr>
      <td>90</td>
      <td>90</td>
      <td>PersonalConfigs</td>
    </tr>
    <tr>
      <td>99</td>
      <td>99</td>
      <td>Archive</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="마이그레이션-팁-선택">마이그레이션 팁 (선택)</h2>

<ul>
  <li>
    <p><strong>심볼릭 링크/스크립트 경로</strong> 에서 숫자만 바뀌니, <code class="language-plaintext highlighter-rouge">sed</code>로 일괄 치환하면 끝.</p>
  </li>
  <li>
    <p>Today 런처(<code class="language-plaintext highlighter-rouge">shortcuts.list</code>)와 PATH 설정만 확인해 주면 대부분 끝나요.</p>

    <ul>
      <li>예: <code class="language-plaintext highlighter-rouge">…/78_Toolchains/</code> → <code class="language-plaintext highlighter-rouge">…/82_Toolchains/</code>, <code class="language-plaintext highlighter-rouge">…/31_Labs/</code> → <code class="language-plaintext highlighter-rouge">…/22_Labs/</code></li>
    </ul>
  </li>
</ul>

<p>필요하면 <strong>bash/tcsh/PowerShell용 안전 리네임 스크립트</strong>(존재 시에만 mv, shortcuts.list 자동 치환)도 바로 만들어줄게.</p>

<p class="chat--user">

왜 굳이 82야

</p>

<p>좋은 질문! <strong>82</strong> 로 둔 건 “80대=툴 스택” 블록 안에서 <strong>여유·정렬·확장성</strong> 을 동시에 잡기 위한 의도야. 간단히, <em>기초 → 플랫폼 → 개인 유틸 → 캡슐 환경</em> 순서로 정렬하면서 중간에 빈 번호를 남겨두려는 선택이었어.</p>

<h2 id="왜-82인가-step-by-step">왜 82인가 (step-by-step)</h2>

<ol>
  <li>
    <p><strong>블록화(80대 전용)</strong><br />
80–89를 “툴/런타임/환경” 전용으로 묶고, 그 안에서 계층을 아래처럼 배치:</p>

    <ul>
      <li>
        <p><strong>82_Toolchains</strong> : gcc/cmake/ninja 같은 <strong>핵심 빌드 도구(기초층)</strong></p>
      </li>
      <li>
        <p><strong>83_SDKs</strong> : JDK/Qt/NDK 같은 <strong>플랫폼 SDK(기반층)</strong></p>
      </li>
      <li>
        <p><strong>84_Tools</strong> : ripgrep/bat/사내 유틸 등 <strong>개인/경량 도구(응용층)</strong></p>
      </li>
      <li>
        <p><strong>86_Environments</strong> : docker/conda/venv <strong>캡슐 환경(격리층)</strong><br />
→ <strong>기초→플랫폼→개인→격리</strong> 순으로 자연스럽게 스캔되도록 번호가 증가해.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>여유 슬롯 확보</strong><br />
80–81, 85, 87–89를 비워 두면 나중에 끼워넣기 좋아:</p>

    <ul>
      <li>
        <p>80_Runtimes (Python/Node/Go 런타임 모음)</p>
      </li>
      <li>
        <p>81_PackageManagers (asdf/pyenv/nvm 등)</p>
      </li>
      <li>
        <p>85_Containers (이미지/베이스레이어)</p>
      </li>
      <li>
        <p>87_CIHelpers … 같은 식의 확장 여지</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>시각적 구분 + 충돌 최소화</strong><br />
84_Tools(개인 실험/포터블)보다 <strong>앞</strong> 에 82_Toolchains(팀 표준·고정버전)를 두면<br />
“표준 먼저, 개인 유틸 나중”이 정렬상에서도 드러나고, 문서/PATH 우선순위도 명확해.</p>
  </li>
</ol>

<hr />

<h2 id="대안-번호도-ok-취향에-따라">대안 번호도 OK (취향에 따라)</h2>

<ul>
  <li>
    <p><strong>연속형이 더 좋다면</strong> : <code class="language-plaintext highlighter-rouge">80_Toolchains / 81_SDKs / 82_Tools / 83_Environments</code></p>

    <ul>
      <li>장점: 기억하기 쉬움. 단점: 중간에 새 카테고리 끼우기 어려움.</li>
    </ul>
  </li>
  <li>
    <p><strong>기존 80_Tools 유지 호환형</strong> : <code class="language-plaintext highlighter-rouge">78_Toolchains / 79_SDKs / 80_Tools / 85_Environments</code></p>

    <ul>
      <li>장점: 기존 경로 변경 최소. 단점: 70대·80대가 섞여 시각적 군집이 약함.</li>
    </ul>
  </li>
</ul>

<p>원하면 네 선호(연속형 vs 여유 슬롯형)에 맞춰 <strong>일괄 리네임 스크립트</strong> 까지 바로 만들어줄게.</p>

<p class="chat--user">

80, 81, 82가 더 나을것 같아서

</p>

<p>좋아, <strong>툴 스택을 80–82 연속 번호</strong> 로 재정렬하자. 깔끔하고 기억하기 쉬워!</p>

<h1 id="최종-번호툴-스택만-변경">최종 번호(툴 스택만 변경)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>80_Toolchains      - 팀/장기 공용 ‘고정 버전’ 빌드 도구 (gcc/cmake/ninja…)
81_SDKs            - 플랫폼 SDK/런타임 (JDK/Qt/Android NDK…)
82_Tools           - 개인·경량·포터블 유틸/스크립트 (ripgrep/fd/bat 등)
83_Environments    - docker/conda/venv 같은 캡슐 환경(※ 연속성 위해 83으로 당김)
</code></pre></div></div>

<blockquote>
  <p>나머지 번호(00,05,10,20,22,25,26,30,32,40,50,60,70,75,90,99)는 그대로.</p>
</blockquote>

<hr />

<h1 id="path-권장-순서-표준-우선--개인">PATH 권장 순서 (표준 우선 → 개인)</h1>

<h2 id="bashzsh-2">bash/zsh</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/82_Tools/bin:</span><span class="nv">$HOME</span><span class="s2">/Work/80_Toolchains/gcc/latest/bin:</span><span class="nv">$HOME</span><span class="s2">/Work/80_Toolchains/cmake/latest/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
</code></pre></div></div>

<h2 id="tcsh-2">tcsh</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

set path = ( $HOME/Work/82_Tools/bin $HOME/Work/80_Toolchains/gcc/latest/bin $path )
</code></pre></div></div>

<h2 id="powershell-3">PowerShell</h2>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">Path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\82_Tools\bin;</span><span class="bp">$HOME</span><span class="s2">\Work\80_Toolchains\gcc\latest\bin;"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">Path</span><span class="w">
</span></code></pre></div></div>

<hr />

<h1 id="마이그레이션-step-by-step">마이그레이션 (step-by-step)</h1>

<h2 id="macoslinux">macOS/Linux</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/Work
<span class="c"># 폴더 리네임(있을 때만)</span>
<span class="o">[</span> <span class="nt">-d</span> 82_Toolchains <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">mv </span>82_Toolchains 80_Toolchains
<span class="o">[</span> <span class="nt">-d</span> 83_SDKs       <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">mv </span>83_SDKs       81_SDKs
<span class="o">[</span> <span class="nt">-d</span> 84_Tools      <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">mv </span>84_Tools      82_Tools
<span class="o">[</span> <span class="nt">-d</span> 86_Environments <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">mv </span>86_Environments 83_Environments

<span class="c"># today/스크립트 경로 일괄 치환</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">''</span> <span class="nt">-e</span> <span class="s1">'s#/82_Toolchains/#/80_Toolchains/#g'</span> <span class="se">\</span>
          <span class="nt">-e</span> <span class="s1">'s#/83_SDKs/#/81_SDKs/#g'</span> <span class="se">\</span>
          <span class="nt">-e</span> <span class="s1">'s#/84_Tools/#/82_Tools/#g'</span> <span class="se">\</span>
          <span class="nt">-e</span> <span class="s1">'s#/86_Environments/#/83_Environments/#g'</span> 10_Today/shortcuts.list 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>
</code></pre></div></div>

<h2 id="windows-powershell-6">Windows (PowerShell)</h2>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Set-Location</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work"</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="s2">"82_Toolchains"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Rename-Item</span><span class="w"> </span><span class="s2">"82_Toolchains"</span><span class="w"> </span><span class="s2">"80_Toolchains"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="s2">"83_SDKs"</span><span class="p">)</span><span class="w">       </span><span class="p">{</span><span class="w"> </span><span class="n">Rename-Item</span><span class="w"> </span><span class="s2">"83_SDKs"</span><span class="w">       </span><span class="s2">"81_SDKs"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="s2">"84_Tools"</span><span class="p">)</span><span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="n">Rename-Item</span><span class="w"> </span><span class="s2">"84_Tools"</span><span class="w">      </span><span class="s2">"82_Tools"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="s2">"86_Environments"</span><span class="p">){</span><span class="w"> </span><span class="n">Rename-Item</span><span class="w"> </span><span class="s2">"86_Environments"</span><span class="w"> </span><span class="s2">"83_Environments"</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="c"># today/스크립트 경로 치환</span><span class="w">
</span><span class="p">(</span><span class="n">Get-Content</span><span class="w"> </span><span class="s2">"10_Today\shortcuts.list"</span><span class="p">)</span><span class="w"> </span><span class="se">`
</span><span class="w">  </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'/82_Toolchains/'</span><span class="p">,</span><span class="s1">'/80_Toolchains/'</span><span class="w"> </span><span class="se">`
</span><span class="w">  </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'/83_SDKs/'</span><span class="p">,</span><span class="s1">'/81_SDKs/'</span><span class="w"> </span><span class="se">`
</span><span class="w">  </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'/84_Tools/'</span><span class="p">,</span><span class="s1">'/82_Tools/'</span><span class="w"> </span><span class="se">`
</span><span class="w">  </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'/86_Environments/'</span><span class="p">,</span><span class="s1">'/83_Environments/'</span><span class="w"> </span><span class="o">|</span><span class="w">
  </span><span class="n">Set-Content</span><span class="w"> </span><span class="s2">"10_Today\shortcuts.list"</span><span class="w">
</span></code></pre></div></div>

<hr />

<h1 id="앞으로-더-안정적으로-쓰는-팁-작은-습관">앞으로 더 안정적으로 쓰는 팁 (작은 습관)</h1>

<ol>
  <li>
    <p><strong>latest 심볼릭 링크</strong> 유지:<br />
<code class="language-plaintext highlighter-rouge">80_Toolchains/gcc/latest → 13.2.0</code> 처럼 표준 전환 시 링크만 갈아끼우기.</p>
  </li>
  <li>
    <p><strong>환경변수 레이어</strong>(리네임 내성↑):</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">WORK_TC</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/80_Toolchains"</span>
<span class="nb">export </span><span class="nv">WORK_SDK</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/81_SDKs"</span>
<span class="nb">export </span><span class="nv">WORK_TOOLS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/82_Tools"</span>
<span class="nb">export </span><span class="nv">WORK_ENV</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/83_Environments"</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>스크립트에 절대경로 대신 위 변수 사용.</p>

<ol>
  <li>
    <p><strong>역할 경계</strong> :</p>

    <ul>
      <li>
        <p>고정·공유: <strong>80_Toolchains</strong> , <strong>81_SDKs</strong></p>
      </li>
      <li>
        <p>개인·가변: <strong>82_Tools</strong></p>
      </li>
      <li>
        <p>격리된 조합: <strong>83_Environments</strong>(docker/conda/venv)</p>
      </li>
    </ul>
  </li>
</ol>

<p>원하면 위 변경을 반영해 <strong>PATH 초기화 스크립트</strong>(bash/tcsh/PowerShell)랑 <code class="language-plaintext highlighter-rouge">latest</code> 링크 생성 스크립트도 바로 만들어줄게.</p>

<p class="chat--user">

아니 85 Environment는 그냥 두자. 각 80, 81, 82, 83 폴더의 내부 subdirectory 예시도 만들어줘. 컴파일은 어디서 해야하는지 등등

</p>

<p>좋아! <strong>85_Environments는 그대로 유지</strong> 하면서,<br />
<strong>80/81/82/83</strong> 의 “역할·하위 구조 예시·컴파일(빌드) 위치”를 정리해 줄게.</p>

<hr />

<h1 id="한눈에-규칙">한눈에 규칙</h1>

<ul>
  <li>
    <p><strong>소스코드 컴파일(앱/라이브러리)</strong> 👉 <strong><code class="language-plaintext highlighter-rouge">20_Projects/&lt;PRJ&gt;</code> 안에서만</strong> 해요.<br />
(예: <code class="language-plaintext highlighter-rouge">PRJ-.../build/</code> out-of-source 빌드)</p>
  </li>
  <li>
    <p><strong>툴체인/SDK 자체 설치</strong> 👉 <strong><code class="language-plaintext highlighter-rouge">80/81/82/83</code>에 “설치/배치”만</strong> 하고,<br />
빌드는 <strong>별도의 Job</strong>(예: <code class="language-plaintext highlighter-rouge">25_Jobs/REL-...</code> 또는 <code class="language-plaintext highlighter-rouge">SMOKE-...</code>)에서 수행 후 결과만 배치.</p>
  </li>
</ul>

<hr />

<h1 id="80_toolchains--팀-표준-고정-버전-빌드-도구">80_Toolchains — “팀 표준, 고정 버전 빌드 도구”</h1>

<ul>
  <li>
    <p>대상: <code class="language-plaintext highlighter-rouge">gcc</code>, <code class="language-plaintext highlighter-rouge">clang</code>, <code class="language-plaintext highlighter-rouge">cmake</code>, <code class="language-plaintext highlighter-rouge">ninja</code>, <code class="language-plaintext highlighter-rouge">make</code>, <code class="language-plaintext highlighter-rouge">lld</code>, <code class="language-plaintext highlighter-rouge">gdb</code> 등</p>
  </li>
  <li>
    <p>원칙: <strong>버전별 폴더</strong> + <strong><code class="language-plaintext highlighter-rouge">latest</code> 링크</strong>, <strong>OS/ARCH 분리</strong> 가능</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>80_Toolchains/
├─ gcc/
│  ├─ 13.2.0/
│  │  ├─ bin/ lib/ include/ share/
│  │  └─ manifest.yml          - 설치 출처/체크섬/빌드옵션 요약
│  └─ latest → 13.2.0
├─ cmake/
│  ├─ 3.29.3/{bin,share}/
│  └─ latest → 3.29.3
├─ ninja/
│  └─ 1.12.1/{bin,doc}/
└─ (optional) linux-x64/, mac-arm64/, win-x64/ 아래로 OS/ARCH 레벨을 한 번 더 두어도 OK
</code></pre></div></div>

<h3 id="path-예시">PATH 예시</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/80_Toolchains/gcc/latest/bin:</span><span class="nv">$HOME</span><span class="s2">/Work/80_Toolchains/cmake/latest/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
</code></pre></div></div>

<h3 id="컴파일은-어디서">컴파일은 어디서?</h3>

<ul>
  <li>✅ <strong>프로젝트</strong> : <code class="language-plaintext highlighter-rouge">20_Projects/PRJ-.../</code>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/Work/20_Projects/PRJ-2025-001_app
cmake <span class="nt">-S</span> <span class="nb">.</span> <span class="nt">-B</span> build <span class="nt">-G</span> Ninja <span class="se">\</span>
      <span class="nt">-DCMAKE_C_COMPILER</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/80_Toolchains/gcc/latest/bin/gcc"</span> <span class="se">\</span>
      <span class="nt">-DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/80_Toolchains/gcc/latest/bin/g++"</span>
cmake <span class="nt">--build</span> build <span class="nt">--config</span> Release
</code></pre></div>    </div>
  </li>
  <li>❌ <strong>80_Toolchains 내부에서 코드 빌드 금지</strong> (여긴 “툴 보관소”)</li>
</ul>

<hr />

<h1 id="81_sdks--플랫폼-sdk런타임대형-번들">81_SDKs — “플랫폼 SDK/런타임(대형 번들)”</h1>

<ul>
  <li>대상: <code class="language-plaintext highlighter-rouge">JDK</code>, <code class="language-plaintext highlighter-rouge">Qt</code>, <code class="language-plaintext highlighter-rouge">Android NDK/SDK</code>, <code class="language-plaintext highlighter-rouge">.NET SDK</code>, <code class="language-plaintext highlighter-rouge">CUDA</code> 등</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>81_SDKs/
├─ jdk/
│  ├─ 21.0.2/           - JAVA_HOME로 지정
│  └─ latest → 21.0.2
├─ qt/
│  ├─ 6.7.2/
│  │  ├─ bin/ lib/ plugins/ qml/ mkspecs/
│  │  └─ README_install_notes.md
│  └─ latest → 6.7.2
├─ android-ndk/
│  └─ r26d/
└─ cuda/
   └─ 12.5/
</code></pre></div></div>

<h3 id="프로젝트에서-쓰기">프로젝트에서 쓰기</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/81_SDKs/jdk/latest"</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$JAVA_HOME</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>

<span class="c"># Qt 예 (CMake)</span>
cmake <span class="nt">-S</span> <span class="nb">.</span> <span class="nt">-B</span> build <span class="nt">-G</span> Ninja <span class="se">\</span>
  <span class="nt">-DCMAKE_PREFIX_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/81_SDKs/qt/latest"</span>
cmake <span class="nt">--build</span> build
</code></pre></div></div>

<hr />

<h1 id="82_tools--개인경량포터블-유틸">82_Tools — “개인·경량·포터블 유틸”</h1>

<ul>
  <li>
    <p>대상: <code class="language-plaintext highlighter-rouge">ripgrep</code>, <code class="language-plaintext highlighter-rouge">fd</code>, <code class="language-plaintext highlighter-rouge">bat</code>, <code class="language-plaintext highlighter-rouge">jq</code>, <code class="language-plaintext highlighter-rouge">yq</code>, 작은 CLI·스クリپ트</p>
  </li>
  <li>
    <p>원칙: <strong>자주 바뀜</strong> → 정리/교체 쉬운 구조</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>82_Tools/
├─ bin/                      - 단일 실행파일(우선 PATH)
│  ├─ rg
│  ├─ fd
│  └─ jq
├─ portable/                 - 압축 풀어 쓰는 포터블 도구
│  ├─ my-cli-1.2.3/
│  └─ some-tool-0.9/
├─ scripts/                  - 개인 스크립트(bootstrap/release/checksum 등)
│  └─ checksum_all.sh
└─ scratch/                  - 임시 테스트용(주기적 청소)
</code></pre></div></div>

<h3 id="path-예시-1">PATH 예시</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/82_Tools/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
</code></pre></div></div>

<h3 id="주의">주의</h3>

<ul>
  <li>유용성이 <strong>장기·공유</strong> 로 발전하면 <strong>80/81로 승격</strong>(문서화 + 고정 버전).</li>
</ul>

<hr />

<h1 id="83_runtimes--언어-런타임--패키지-관리자-선택-슬롯">83_Runtimes — “언어 런타임 &amp; 패키지 관리자 (선택 슬롯)”</h1>

<ul>
  <li>
    <p>목적: “툴체인(80)·SDK(81)과는 별개”로 <strong>언어 런타임/버전 관리자</strong> 를 모아 둠</p>
  </li>
  <li>
    <p>대상: <code class="language-plaintext highlighter-rouge">python</code>(standalone 또는 asdf/pyenv), <code class="language-plaintext highlighter-rouge">node</code>(nvm), <code class="language-plaintext highlighter-rouge">go</code>, <code class="language-plaintext highlighter-rouge">rustup</code>, <code class="language-plaintext highlighter-rouge">dotnet</code> 런타임 등<br />
<em>(이미 시스템/홈 관리자 쓰면 생략해도 됨. 폴더만 예약 슬롯으로 사용)</em></p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>83_Runtimes/
├─ python/
│  ├─ 3.11.9/
│  │  ├─ bin/python3  - 독립 배포본(임베디드/프리빌트)
│  │  └─ README.md
│  └─ 3.12.4/
├─ node/
│  ├─ 20.16.0/
│  └─ nvm/              - nvm 자체를 보관할 수도
├─ go/
│  └─ 1.22.5/
└─ rust/
   └─ toolchains/stable/
</code></pre></div></div>

<h3 id="사용-예">사용 예</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 특정 런타임을 한 세션에만 우선</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/83_Runtimes/python/3.12.4/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
python <span class="nt">--version</span>  <span class="c"># 3.12.4</span>
</code></pre></div></div>

<blockquote>
  <p><em>83을 쓰지 않고 시스템 런타임/패키지관리자를 그대로 써도 OK.<br />
 이 슬롯은 “정리된 위치에 모아두고 싶을 때” 유용해요.</em></p>
</blockquote>

<hr />

<h1 id="85_environments--캡슐-환경그대로-유지">85_Environments — “캡슐 환경(그대로 유지)”</h1>

<ul>
  <li>
    <p>대상: <code class="language-plaintext highlighter-rouge">docker/compose</code>, <code class="language-plaintext highlighter-rouge">conda</code>/<code class="language-plaintext highlighter-rouge">venv</code>, <code class="language-plaintext highlighter-rouge">devcontainer</code></p>
  </li>
  <li>
    <p>쓰임: <strong>프로젝트별 조합을 격리</strong> 해서 재현성 보장</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>85_Environments/
├─ docker/
│  ├─ Dockerfile
│  └─ compose.yml
├─ conda/
│  ├─ envs/
│  │  └─ py311/           - 실제 생성된 env(선택)
│  └─ environment.yml     - 표준 스펙
└─ devcontainer/
   └─ base/
      ├─ Dockerfile
      └─ devcontainer.json
</code></pre></div></div>

<h3 id="프로젝트에서-쓰기-1">프로젝트에서 쓰기</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># conda</span>
conda <span class="nb">env </span>create <span class="nt">-f</span> ~/Work/85_Environments/conda/environment.yml
conda activate py311

<span class="c"># docker</span>
docker compose <span class="nt">-f</span> ~/Work/85_Environments/docker/compose.yml up <span class="nt">-d</span>
</code></pre></div></div>

<hr />

<h2 id="컴파일은-어디서-요점-재정리">“컴파일은 어디서?” 요점 재정리</h2>

<ul>
  <li>
    <p><strong>앱/라이브러리 빌드</strong> : 항상 <strong><code class="language-plaintext highlighter-rouge">20_Projects/&lt;PRJ&gt;/build/</code></strong>(out-of-source).</p>

    <ul>
      <li>도구/SDK 경로는 <code class="language-plaintext highlighter-rouge">80/81/83</code>에서 <strong>참조만</strong>.</li>
    </ul>
  </li>
  <li>
    <p><strong>툴체인/SDK 자체를 소스에서 빌드해야 할 때</strong> :</p>

    <ol>
      <li>
        <p><strong>Job 생성</strong> : <code class="language-plaintext highlighter-rouge">25_Jobs/REL-YYYY-NNN_&lt;tool&gt;-&lt;ver&gt;/</code></p>
      </li>
      <li>
        <p>거기서 소스 빌드 &amp; 테스트</p>
      </li>
      <li>
        <p>산출물을 <strong><code class="language-plaintext highlighter-rouge">80_Toolchains/&lt;tool&gt;/&lt;ver&gt;/</code> 또는 <code class="language-plaintext highlighter-rouge">81_SDKs/&lt;sdk&gt;/&lt;ver&gt;/</code></strong>로 <strong>배치</strong></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">latest</code> 링크 업데이트 + <code class="language-plaintext highlighter-rouge">manifest.yml</code>/<code class="language-plaintext highlighter-rouge">SHA256SUMS</code> 기록</p>
      </li>
    </ol>
  </li>
  <li>
    <p><strong>개인 유틸 테스트</strong> : <code class="language-plaintext highlighter-rouge">82_Tools/portable</code> or <code class="language-plaintext highlighter-rouge">82_Tools/scratch</code> (안정화되면 승격)</p>
  </li>
</ul>

<hr />

<h2 id="빠른-체크리스트-1">빠른 체크리스트</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">80</code>(표준 빌드 도구) → <strong>고정 버전 + latest 링크</strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">81</code>(대형 SDK) → <strong>경로 변수(JAVA_HOME 등)와 함께 문서화</strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">82</code>(개인 유틸) → <strong>가볍게, 필요 시 승격</strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">83</code>(런타임) → <strong>언어별 버전 모음(선택 슬롯)</strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">85</code>(환경) → <strong>조합 격리/재현, 프로젝트에서 activate</strong></p>
  </li>
</ul>

<p>원하면 위 구조대로 <strong>폴더와 README/manifest 템플릿, PATH 초기화 스크립트</strong> 까지 한 번에 만들어주는 세팅 스크립트( bash / tcsh / PowerShell )도 바로 만들어줄게.</p>

<p class="chat--user">

installer 폴더가 사라졌네?

</p>

<p>좋은 캐치! 번호 재정렬하면서 <strong>installers 상자</strong> 를 표기에서 빼먹었어요.<br />
정답은:</p>

<blockquote>
  <p><strong>정본 보관소:</strong> <code class="language-plaintext highlighter-rouge">82_Tools/installers/</code><br />
 <strong>임시 착륙지:</strong> <code class="language-plaintext highlighter-rouge">05_Downloads/_inbox</code> (브라우저/CLI 기본 저장) → 스윕 후 <code class="language-plaintext highlighter-rouge">82_Tools/installers/</code>로 이동</p>
</blockquote>

<hr />

<h1 id="왜-82_toolsinstallers인가-step-by-step">왜 <code class="language-plaintext highlighter-rouge">82_Tools/installers/</code>인가 (step-by-step)</h1>

<ol>
  <li>
    <p><strong>한 곳에 모으기</strong> : gcc·cmake 같은 툴체인(80), JDK/Qt 같은 SDK(81), 개인 유틸(82) <strong>모두의 설치 원본</strong> 을 한 군데에 아카이브.</p>
  </li>
  <li>
    <p><strong>흐름 단순화</strong> : 다운로드(05) → <strong>installers로 이동</strong> → 실제 배치</p>

    <ul>
      <li>
        <p>Toolchains은 <code class="language-plaintext highlighter-rouge">80_Toolchains/&lt;tool&gt;/&lt;ver&gt;/</code></p>
      </li>
      <li>
        <p>SDK는 <code class="language-plaintext highlighter-rouge">81_SDKs/&lt;sdk&gt;/&lt;ver&gt;/</code></p>
      </li>
      <li>
        <p>개인 유틸은 <code class="language-plaintext highlighter-rouge">82_Tools/portable/&lt;tool&gt;-&lt;ver&gt;/</code> (또는 <code class="language-plaintext highlighter-rouge">bin/</code>)</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>증빙/복구 쉬움</strong> : 체크섬·노트가 installers에 모여 있어, 나중에 <strong>검증/재설치</strong> 가 빠름.</p>
  </li>
</ol>

<hr />

<h1 id="폴더-예시-복붙">폴더 예시 (복붙)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>82_Tools/
├─ installers/                                 - 설치 원본 정본(아카이브)
│  ├─ cmake/3.29.3/cmake-3.29.3-linux-x86_64.tar.gz
│  │  └─ SHA256SUMS, install_notes.md
│  ├─ gcc/13.2.0/gcc-13.2.0-x86_64.tar.xz
│  │  └─ SHA256SUMS, install_notes.md
│  ├─ jdk/21.0.2/jdk-21.0.2_macos-aarch64.tar.gz
│  ├─ qt/6.7.2/qt-opensource-mac-6.7.2.dmg
│  ├─ python/wheels/&lt;project_or_vendor&gt;/...    # .whl/.tar.gz 모음
│  └─ misc/                                    # 분류 어려운 기타
├─ bin/                                        - 단일 실행파일(개인 PATH)
├─ portable/                                   - 포터블 툴 압축 해제 위치
└─ scripts/                                    - checksum/스윕 등 스크립트
</code></pre></div></div>

<blockquote>
  <p>각 <code class="language-plaintext highlighter-rouge">&lt;tool&gt;/&lt;ver&gt;/</code> 폴더 안에 <strong><code class="language-plaintext highlighter-rouge">SHA256SUMS</code></strong>와 <strong><code class="language-plaintext highlighter-rouge">install_notes.md</code></strong>(출처/날짜/옵션) 붙이기 권장.</p>
</blockquote>

<hr />

<h1 id="워크플로-설치-원본-기준">워크플로 (설치 원본 기준)</h1>

<ol>
  <li>
    <p><strong>다운로드</strong> → <code class="language-plaintext highlighter-rouge">05_Downloads/_inbox</code></p>
  </li>
  <li>
    <p><strong>스윕 실행</strong>(자동/수동): 인스톨러 파일을 <code class="language-plaintext highlighter-rouge">82_Tools/installers/&lt;tool&gt;/&lt;ver&gt;/</code>로 이동 + <code class="language-plaintext highlighter-rouge">SHA256SUMS</code> 생성 + <code class="language-plaintext highlighter-rouge">install_notes.md</code>에 기록</p>
  </li>
  <li>
    <p><strong>배치</strong></p>

    <ul>
      <li>
        <p>툴체인: 압축 해제 → <code class="language-plaintext highlighter-rouge">80_Toolchains/&lt;tool&gt;/&lt;ver&gt;/</code> → <code class="language-plaintext highlighter-rouge">latest</code> 링크 갱신</p>
      </li>
      <li>
        <p>SDK: 압축/설치 → <code class="language-plaintext highlighter-rouge">81_SDKs/&lt;sdk&gt;/&lt;ver&gt;/</code></p>
      </li>
      <li>
        <p>개인 유틸: <code class="language-plaintext highlighter-rouge">82_Tools/portable/</code> 또는 <code class="language-plaintext highlighter-rouge">82_Tools/bin/</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>검증/기록</strong> : 버전·경로를 README/문서(<code class="language-plaintext highlighter-rouge">32_SharedConfigs/global/&lt;tool&gt;/README.md</code>)에 반영</p>
  </li>
</ol>

<hr />

<h1 id="스윕-스크립트-경로만-바꾸기">스윕 스크립트 경로만 바꾸기</h1>

<p>이전에 드린 스크립트에서 <strong>DEST_INSTALL</strong> 경로를 아래처럼 바꾸세요.</p>

<p><strong>bash/zsh (<code class="language-plaintext highlighter-rouge">sweep_downloads.sh</code>)</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">DEST_INSTALL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$W</span><span class="s2">/82_Tools/installers"</span>
</code></pre></div></div>

<p><strong>PowerShell (<code class="language-plaintext highlighter-rouge">sweep_downloads.ps1</code>)</strong></p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$DEST_INSTALL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Join-Path</span><span class="w"> </span><span class="nv">$W</span><span class="w"> </span><span class="s2">"82_Tools\installers"</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>나머지 로직은 동일합니다. (<code class="language-plaintext highlighter-rouge">05_Downloads/_inbox</code> → installers로 이동, 체크섬 생성, 노트 추가)</p>
</blockquote>

<hr />

<h1 id="선택-안전-마이그레이션">(선택) 안전 마이그레이션</h1>

<p><strong>macOS/Linux</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> ~/Work/82_Tools/installers
<span class="o">[</span> <span class="nt">-d</span> ~/Work/80_Tools/installers <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">mv</span> ~/Work/80_Tools/installers/<span class="k">*</span> ~/Work/82_Tools/installers/ 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>
</code></pre></div></div>

<p><strong>Windows (PowerShell)</strong></p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">New-Item</span><span class="w"> </span><span class="nt">-ItemType</span><span class="w"> </span><span class="nx">Directory</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\82_Tools\installers"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-Null</span><span class="w">
</span><span class="nx">if</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\80_Tools\installers"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">Move-Item</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\80_Tools\installers\*"</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\82_Tools\installers"</span><span class="w"> </span><span class="nt">-Force</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<hr />

<h2 id="요약-5">요약</h2>

<ul>
  <li>
    <p><strong>installers 정본 상자</strong> 는 <strong><code class="language-plaintext highlighter-rouge">82_Tools/installers/</code></strong>.</p>
  </li>
  <li>
    <p><strong>05_Downloads</strong> 는 임시 착륙지, 스윕이 알아서 installers로 옮김.</p>
  </li>
  <li>
    <p>설치 후 <strong>실제 실행 경로</strong> 는: Toolchains(80) / SDKs(81) / 개인유틸(82).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">SHA256SUMS</code> + <code class="language-plaintext highlighter-rouge">install_notes.md</code>로 <strong>무결성/출처</strong> 를 남겨 복구성 확보.</p>
  </li>
</ul>

<p>필요하면 <code class="language-plaintext highlighter-rouge">install_notes.md</code> 자동 append와 <code class="language-plaintext highlighter-rouge">SHA256SUMS</code> 생성을 묶은 <strong>최종 스크립트</strong> 를 82 경로 기준으로 정리해서 드릴게.</p>

<p class="chat--user">

latest를 symbolic link를 만들잖아. 이거 하는 법 알려줘. 상대경로로 그냥 하면 되나?

</p>

<p>좋아! <strong>결론:</strong> 네—<code class="language-plaintext highlighter-rouge">latest</code>는 <strong>상대경로 심볼릭 링크</strong> 로 만드는 게 가장 안전하고 이식성이 좋아.<br />
아래를 그대로 따라 하면 돼. (macOS/Linux, Windows 둘 다 정리)</p>

<hr />

<h2 id="기본-예시-디렉터리-구조">기본 예시 (디렉터리 구조)</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>80_Toolchains/
  gcc/
    13.2.0/
    latest  -&gt; 13.2.0    # ← 이걸 만들 거야(상대 링크)
</code></pre></div></div>

<hr />

<h2 id="macos--linux-3">macOS / Linux</h2>

<h3 id="1-새로-만들기">1) 새로 만들기</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/Work/80_Toolchains/gcc
<span class="nb">ln</span> <span class="nt">-s</span> 13.2.0 latest   <span class="c"># 상대경로 링크: latest -&gt; 13.2.0</span>
</code></pre></div></div>

<h3 id="2-버전-업데이트이미-latest가-있을-때-교체">2) 버전 업데이트(이미 latest가 있을 때 교체)</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/Work/80_Toolchains/gcc
<span class="nb">ln</span> <span class="nt">-sfn</span> 13.3.0 latest
<span class="c"># -s : symlink, -f : 기존 링크 덮어쓰기, -n : 링크를 디렉터리로 보지 않고 '이름'으로 취급</span>
</code></pre></div></div>

<h3 id="3-확인점검">3) 확인/점검</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-l</span> latest         <span class="c"># latest -&gt; 13.3.0</span>
<span class="nb">readlink </span>latest      <span class="c"># 13.3.0  (상대경로가 보이면 OK)</span>
</code></pre></div></div>

<h3 id="4-실수했을-때잘못-만든-최신-링크-지우기">4) 실수했을 때(잘못 만든 최신 링크 지우기)</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">rm </span>latest            <span class="c"># 링크만 지워짐(타깃은 그대로)</span>
</code></pre></div></div>

<blockquote>
  <p><strong>왜 상대경로?</strong> 폴더(예: <code class="language-plaintext highlighter-rouge">80_Toolchains/gcc</code>)를 통째로 다른 위치로 옮겨도 링크가 <strong>깨지지 않음</strong>.<br />
 절대경로(<code class="language-plaintext highlighter-rouge">/Users/...</code>)로 만들면 이동 시 전부 다시 만들어야 해.</p>
</blockquote>

<hr />

<h2 id="windows">Windows</h2>

<p>Windows는 두 가지가 있어:</p>

<ul>
  <li>
    <p><strong>심볼릭 링크(권장):</strong> <code class="language-plaintext highlighter-rouge">mklink /D</code> (관리자 권한 또는 Windows “개발자 모드” 필요)</p>
  </li>
  <li>
    <p><strong>디렉터리 정션(대안):</strong> <code class="language-plaintext highlighter-rouge">mklink /J</code> (관리자 불필요, 다만 드라이브 간 이동에 취약)</p>
  </li>
</ul>

<h3 id="1-cmd-관리자-권장">1) CMD (관리자 권장)</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cmd

cd %USERPROFILE%\Work\80_Toolchains\gcc

:: 심볼릭 링크 (권장, 관리자 또는 개발자 모드)
mklink /D latest 13.2.0

:: 업데이트(교체)
rmdir latest
mklink /D latest 13.3.0
</code></pre></div></div>

<h3 id="2-관리자-권한-없이-쓰고-싶으면정션">2) 관리자 권한 없이 쓰고 싶으면(정션)</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cmd

cd %USERPROFILE%\Work\80_Toolchains\gcc
mklink /J latest 13.2.0
</code></pre></div></div>

<h3 id="3-powershell-심볼릭-링크">3) PowerShell (심볼릭 링크)</h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Set-Location</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\80_Toolchains\gcc"</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nt">-ItemType</span><span class="w"> </span><span class="nx">SymbolicLink</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s2">"latest"</span><span class="w"> </span><span class="nt">-Target</span><span class="w"> </span><span class="s2">"13.2.0"</span><span class="w">  </span><span class="c"># 관리자 또는 개발자 모드</span><span class="w">
</span></code></pre></div></div>

<h3 id="4-확인">4) 확인</h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-Item</span><span class="w"> </span><span class="nx">latest</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Format-List</span><span class="w"> </span><span class="nx">Name</span><span class="p">,</span><span class="nx">LinkType</span><span class="p">,</span><span class="nx">Target</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p><strong>팁:</strong> 심볼릭 링크는 상대경로 타겟도 잘 동작함. 정션(/J)은 내부적으로 절대경로로 고정되기 쉬워,<br />
 폴더를 다른 드라이브로 옮기면 깨질 수 있어. 가능하면 <strong>/D(심볼릭)</strong>을 쓰자.</p>
</blockquote>

<hr />

<h2 id="작은-자동화선택">작은 자동화(선택)</h2>

<h3 id="bashzsh-set-latestsh">Bash/Zsh: <code class="language-plaintext highlighter-rouge">set-latest.sh</code></h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>
<span class="nb">set</span> <span class="nt">-euo</span> pipefail
<span class="nb">dir</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">1</span>:?tool<span class="p"> dir</span><span class="k">}</span><span class="s2">"</span>     <span class="c"># 예: ~/Work/80_Toolchains/gcc</span>
<span class="nv">ver</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">2</span>:?version<span class="k">}</span><span class="s2">"</span>      <span class="c"># 예: 13.3.0</span>
<span class="nb">cd</span> <span class="s2">"</span><span class="nv">$dir</span><span class="s2">"</span>
<span class="nb">ln</span> <span class="nt">-sfn</span> <span class="s2">"</span><span class="nv">$ver</span><span class="s2">"</span> latest
<span class="nb">echo</span> <span class="s2">"latest -&gt; </span><span class="nv">$ver</span><span class="s2">"</span>
</code></pre></div></div>

<h3 id="powershell-set-latestps1">PowerShell: <code class="language-plaintext highlighter-rouge">Set-Latest.ps1</code></h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">param</span><span class="p">([</span><span class="n">Parameter</span><span class="p">(</span><span class="n">Mandatory</span><span class="p">)][</span><span class="n">string</span><span class="p">]</span><span class="nv">$Dir</span><span class="p">,[</span><span class="n">Parameter</span><span class="p">(</span><span class="n">Mandatory</span><span class="p">)][</span><span class="n">string</span><span class="p">]</span><span class="nv">$Version</span><span class="p">)</span><span class="w">
</span><span class="n">Set-Location</span><span class="w"> </span><span class="nv">$Dir</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="nx">latest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Remove-Item</span><span class="w"> </span><span class="nx">latest</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nt">-ItemType</span><span class="w"> </span><span class="nx">SymbolicLink</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s2">"latest"</span><span class="w"> </span><span class="nt">-Target</span><span class="w"> </span><span class="nv">$Version</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-Null</span><span class="w">
</span><span class="s2">"latest -&gt; </span><span class="nv">$Version</span><span class="s2">"</span><span class="w">
</span></code></pre></div></div>

<hr />

<h2 id="자주-나는-실수--체크리스트">자주 나는 실수 &amp; 체크리스트</h2>

<ul>
  <li>
    <p>경로에 <strong>공백</strong> 이 있으면 꼭 <strong>따옴표</strong> 로 감싸기.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ln -sfn</code>은 기존 <strong>링크</strong> 만 깔끔히 교체해 줌. 기존이 “실제 디렉터리”라면 먼저 <code class="language-plaintext highlighter-rouge">rm -rf latest</code> 후 다시 생성.</p>
  </li>
  <li>
    <p>Windows에서 권한 문제 나면: <strong>관리자 PowerShell/CMD</strong> 로 실행하거나 <strong>개발자 모드</strong> 켜기.</p>
  </li>
  <li>
    <p>링크 만든 뒤 <strong>PATH</strong> 에 <code class="language-plaintext highlighter-rouge">.../gcc/latest/bin</code>처럼 <code class="language-plaintext highlighter-rouge">latest</code>를 넣어두면, 버전 전환 시 <strong>링크만 바꾸면</strong> 스크립트 수정이 필요 없음.</p>
  </li>
</ul>

<p>필요하면 네가 쓰는 툴(예: <code class="language-plaintext highlighter-rouge">gcc</code>, <code class="language-plaintext highlighter-rouge">cmake</code>, <code class="language-plaintext highlighter-rouge">jdk</code>, <code class="language-plaintext highlighter-rouge">qt</code>) 리스트를 알려줘. 각 폴더에 대해 <code class="language-plaintext highlighter-rouge">latest</code>를 <strong>일괄 생성/갱신</strong> 하는 스크립트를 맞춤으로 만들어 줄게!</p>

<p class="chat--user">

폴더 명을 버젼만 쓰는게 맞아? gcc-13.3.0 이게 더 좋아보이기도 하고.

</p>

<p>좋은 질문! 결론부터 말하면 <strong>“버전만” vs “툴-버전”</strong>은 “부모 폴더가 이미 툴을 식별하느냐”로 나눠 결정하면 깔끔해요.</p>

<h2 id="결정-규칙-step-by-step">결정 규칙 (step-by-step)</h2>

<ol>
  <li>
    <p><strong>부모 폴더가 툴을 이미 말해준다</strong><br />
→ <strong>버전만</strong> 쓰는 게 정석.<br />
예) <code class="language-plaintext highlighter-rouge">80_Toolchains/gcc/13.3.0/</code> (✅), <code class="language-plaintext highlighter-rouge">latest → 13.3.0</code></p>

    <ul>
      <li>
        <p>중복 없이 짧고 보기 좋음</p>
      </li>
      <li>
        <p>업데이트 시 <code class="language-plaintext highlighter-rouge">ln -sfn 13.3.1 latest</code> 한 줄이면 끝</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>여러 툴이 한 폴더에 섞여 있다</strong>(portable 모음 등)<br />
→ <strong>툴-버전</strong> 이 안전.<br />
예) <code class="language-plaintext highlighter-rouge">82_Tools/portable/gcc-13.3.0/</code>, <code class="language-plaintext highlighter-rouge">82_Tools/portable/cmake-3.29.3/</code> (✅)</p>

    <ul>
      <li>
        <p>한 눈에 무엇인지 식별 쉬움</p>
      </li>
      <li>
        <p>정렬/검색에 유리(<code class="language-plaintext highlighter-rouge">ls | grep gcc-</code>)</p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="추천-패턴-요약">추천 패턴 요약</h2>

<ul>
  <li><strong>Toolchains/SDKs 같이 “툴별 전용 디렉터리”가 있는 곳</strong></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>80_Toolchains/
 gcc/
   13.3.0/
   latest -&gt; 13.3.0
 cmake/
   3.29.3/
   latest -&gt; 3.29.3
</code></pre></div></div>

<p><em>여기서는</em> <code class="language-plaintext highlighter-rouge">13.3.0</code>처럼 <strong>버전만</strong> 이 맞습니다. <code class="language-plaintext highlighter-rouge">gcc-13.3.0</code>은 중복.</p>

<ul>
  <li><strong>Tools/portable 같이 “여러 툴이 섞이는 곳”</strong></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>82_Tools/
 portable/
   gcc-13.3.0/
   cmake-3.29.3/
   ninja-1.12.1/
</code></pre></div></div>

<p><em>여기서는</em> <strong>툴-버전</strong> 이 가독성 최고.</p>

<hr />

<h2 id="os아키변형까지-표기해야-할-때">OS/아키/변형까지 표기해야 할 때</h2>

<p>툴별 디렉터리(예: <code class="language-plaintext highlighter-rouge">80_Toolchains/gcc/</code>)에서도 <strong>버전 뒤에만 변형을 붙이는</strong> 방식이 깔끔합니다.</p>

<ul>
  <li>
    <p>패턴:<br />
<code class="language-plaintext highlighter-rouge">/&lt;version&gt;[-&lt;os&gt;-&lt;arch&gt;[-&lt;libc|vendor&gt;]]/</code></p>
  </li>
  <li>
    <p>예시:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">13.3.0-mac-arm64/</code></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">13.3.0-linux-x64-glibc/</code></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">6.7.2-win-x64-msvc/</code> (Qt처럼 툴체인이 다른 경우)</p>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">latest</code>는 항상 해당 변형 디렉터리를 가리키게:<br />
<code class="language-plaintext highlighter-rouge">latest -&gt; 13.3.0-mac-arm64</code></p>
  </li>
</ul>

<blockquote>
  <p>반대로 <strong>portable 섞임 폴더</strong> 라면: <code class="language-plaintext highlighter-rouge">gcc-13.3.0-linux-x64/</code>처럼 접두 툴명을 유지.</p>
</blockquote>

<hr />

<h2 id="latest-심볼릭-링크-예시상대경로">latest 심볼릭 링크 예시(상대경로)</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/Work/80_Toolchains/gcc
<span class="nb">ln</span> <span class="nt">-sfn</span> 13.3.0 latest          <span class="c"># 기본</span>
<span class="c"># 변형이 있을 때</span>
<span class="nb">ln</span> <span class="nt">-sfn</span> 13.3.0-mac-arm64 latest
</code></pre></div></div>

<ul>
  <li><strong>상대경로 링크</strong> 를 권장(폴더를 통째로 옮겨도 안 깨짐).</li>
</ul>

<hr />

<h2 id="실제-트리-예시혼합-사례">실제 트리 예시(혼합 사례)</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>80_Toolchains/
  gcc/
    13.3.0-linux-x64/
    13.3.0-mac-arm64/
    latest -&gt; 13.3.0-mac-arm64
  cmake/
    3.29.3/
    latest -&gt; 3.29.3

81_SDKs/
  jdk/
    21.0.2/
    latest -&gt; 21.0.2
  qt/
    6.7.2-win-x64-msvc/
    latest -&gt; 6.7.2-win-x64-msvc

82_Tools/
  bin/                   # 단일 바이너리
    rg
    fd
  portable/              # 섞여 있으므로 접두어-버전
    gcc-13.3.0-linux-x64/
    cmake-3.29.3/
    ninja-1.12.1/
</code></pre></div></div>

<hr />

<h2 id="운영-팁간단-룰">운영 팁(간단 룰)</h2>

<ul>
  <li>
    <p><strong>툴별 전용 디렉터리면 → 버전만</strong></p>
  </li>
  <li>
    <p><strong>섞여 있으면 → 툴-버전</strong></p>
  </li>
  <li>
    <p><strong>변형이 필요하면 → 버전 뒤에만 붙이기</strong>(<code class="language-plaintext highlighter-rouge">13.3.0-mac-arm64</code>)</p>
  </li>
  <li>
    <p><strong>latest는 상대심볼릭</strong></p>
  </li>
  <li>
    <p>스크립트에는 경로 하드코딩 대신 환경변수 사용(예: <code class="language-plaintext highlighter-rouge">WORK_TC</code>, <code class="language-plaintext highlighter-rouge">WORK_SDK</code>, <code class="language-plaintext highlighter-rouge">WORK_TOOLS</code>)으로 리네임 내성 ↑</p>
  </li>
</ul>

<p>원하면 지금 쓰는 폴더들 기준으로 <strong>자동 리네이머</strong>(중복 접두 제거, 변형 접미 추가, latest 생성까지) 스크립트를 만들어줄게—사용 OS/셸만 알려줘!</p>

<p class="chat--user">

ln -s 를 써서 심볼릭을 했는데 -sfn는 뭐가 달라?

</p>

<p>짧게:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">-s</code> = <strong>심볼릭 링크</strong> 로 만들어</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">-f</code> = <strong>기존 목적지(linkname)가 있으면 지우고</strong> 다시 만들어</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">-n</code> = <strong>linkname이 “디렉터리를 가리키는 심볼릭 링크”여도 디렉터리로 취급하지 말고 그 “링크 그 자체”를 교체</strong></p>
  </li>
</ul>

<p>그래서 <code class="language-plaintext highlighter-rouge">ln -sfn 새버전 latest</code> 는 “latest가 무엇이든(특히 디렉터리를 가리키는 기존 심볼릭)” <strong>강제로 최신 링크로 갈아끼우는 안전한 한 줄</strong> 이에요.</p>

<hr />

<h2 id="왜--n이-필요하죠">왜 <code class="language-plaintext highlighter-rouge">-n</code>이 필요하죠?</h2>

<p>기존에 <code class="language-plaintext highlighter-rouge">latest -&gt; 13.2.0/</code> 같은 <strong>디렉터리 심볼릭</strong> 이 있을 때,<br />
<code class="language-plaintext highlighter-rouge">ln -sf 13.3.0 latest</code> 는 플랫폼/상황에 따라 <code class="language-plaintext highlighter-rouge">latest</code>를 <strong>디렉터리로 따라가</strong> 서 그 <strong>안에</strong> 뭔가 만들려고 시도할 수 있어요(의도 아님).<br />
<code class="language-plaintext highlighter-rouge">-n</code>을 주면 <code class="language-plaintext highlighter-rouge">latest</code>를 <strong>“그냥 파일(링크) 이름”으로만</strong> 보고 <strong>그 링크 자체를 교체</strong> 합니다.</p>

<blockquote>
  <p>macOS/BSD에서는 <code class="language-plaintext highlighter-rouge">-n</code>이 <code class="language-plaintext highlighter-rouge">-h</code>(symlink를 따라가지 않음)과 동일한 의미입니다.<br />
 GNU coreutils(리눅스)에서도 <code class="language-plaintext highlighter-rouge">-n/--no-dereference</code>가 같은 역할을 합니다.</p>
</blockquote>

<hr />

<h2 id="자주-쓰는-패턴">자주 쓰는 패턴</h2>

<h3 id="새로-만들-때">새로 만들 때</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ln</span> <span class="nt">-s</span> 13.3.0 latest           <span class="c"># latest -&gt; 13.3.0 (상대링크 권장)</span>
</code></pre></div></div>

<h3 id="기존-latest를-새-버전으로-교체가장-안전">기존 latest를 새 버전으로 교체(가장 안전)</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ln</span> <span class="nt">-sfn</span> 13.3.1 latest         <span class="c"># 기존 symlink를 강제로 교체</span>
</code></pre></div></div>

<h3 id="확인">확인</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-l</span> latest      <span class="c"># latest -&gt; 13.3.1</span>
<span class="nb">readlink </span>latest   <span class="c"># 13.3.1</span>
</code></pre></div></div>

<hr />

<h2 id="비교-요약">비교 요약</h2>

<table>
  <thead>
    <tr>
      <th>명령</th>
      <th>동작</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ln -s T L</code></td>
      <td>L이 없을 때만 <strong>심볼릭 L → T</strong> 생성(이미 있으면 실패)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ln -sf T L</code></td>
      <td>L이 파일/링크면 <strong>삭제 후 재생성</strong>. L이 <strong>디렉터리(또는 그를 가리키는 링크)</strong>일 땐 <strong>의도와 다르게 디렉터리로 따라갈 수 있음</strong></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ln -sfn T L</code></td>
      <td>L이 디렉터리를 가리키는 <strong>심볼릭</strong> 이더라도 <strong>따라가지 않고</strong> <strong>L 자체를 교체</strong>(의도대로 최신 링크 업데이트)</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>주의: <strong>L이 실제 디렉터리</strong> 라면 <code class="language-plaintext highlighter-rouge">-f</code>라도 지우지 않습니다. 그런 경우는 <code class="language-plaintext highlighter-rouge">rm -rf L</code>로 직접 지운 뒤 다시 만드세요.</p>
</blockquote>

<hr />

<h2 id="실전-팁">실전 팁</h2>

<ul>
  <li>
    <p><strong>상대경로</strong>(예: <code class="language-plaintext highlighter-rouge">ln -s 13.3.0 latest</code>)로 만들어 두면 상위 폴더를 통째로 옮겨도 링크가 안 깨집니다.</p>
  </li>
  <li>
    <p><strong>슬래시 주의</strong> : <code class="language-plaintext highlighter-rouge">13.3.0/</code> 처럼 타깃에 <code class="language-plaintext highlighter-rouge">/</code>를 붙이면 디렉터리로 간주되어 옵션 동작이 미묘해질 수 있으니, <strong>그냥 <code class="language-plaintext highlighter-rouge">13.3.0</code></strong>으로 쓰는 걸 추천.</p>
  </li>
  <li>
    <p>Windows는 <code class="language-plaintext highlighter-rouge">mklink /D latest 13.3.0</code>(또는 PowerShell <code class="language-plaintext highlighter-rouge">New-Item -ItemType SymbolicLink</code>)로 만들고, 교체는 <code class="language-plaintext highlighter-rouge">rmdir latest</code> 후 다시 <code class="language-plaintext highlighter-rouge">mklink</code>가 정석입니다.</p>
  </li>
</ul>

<p>원하면 네 툴 폴더들(gcc, cmake, jdk…)을 순회하며 <strong><code class="language-plaintext highlighter-rouge">latest</code>를 일괄 갱신</strong>하는 작은 스크립트(bash/tcsh/PowerShell)도 바로 만들어줄게.</p>

<p class="chat--user">

이미 빌드된 폴더들을 그냥 cp -rf 로 옮겨도 상관없나

</p>

<p>요약부터: <strong>그냥<code class="language-plaintext highlighter-rouge">cp -rf</code>로 통째 복사하는 건 비추</strong>예요.<br />
안전하게 옮기려면 <strong>같은 디스크면<code class="language-plaintext highlighter-rouge">mv</code></strong>, 다른 디스크/장치면 <strong><code class="language-plaintext highlighter-rouge">rsync -a</code>(또는 <code class="language-plaintext highlighter-rouge">cp -a</code>/<code class="language-plaintext highlighter-rouge">-pPR</code>)</strong>를 쓰고, “옮겨도 되는지”를 <strong>종류별로</strong> 판단해야 합니다.</p>

<hr />

<h1 id="1-언제-그냥-옮겨도-되나-relocatable-ok">1) 언제 “그냥 옮겨도” 되나? (Relocatable OK)</h1>

<ul>
  <li>
    <p><strong>포터블/압축 해제형 CLI</strong>(tar.gz로 배포된 cmake/ninja 등)</p>
  </li>
  <li>
    <p><strong>헤더-only/스크립트-only</strong>(특정 절대경로에 묶이지 않은 것)</p>
  </li>
  <li>
    <p><strong>자체 RPATH가 상대형</strong> 이거나 <strong>정적 링크 바이너리</strong><br />
→ 이런 건 보통 위치 독립적이라 폴더만 옮겨도 동작합니다.</p>
  </li>
</ul>

<h1 id="2-옮기면-깨지기-쉬운-것-relocatable-위험">2) 옮기면 깨지기 쉬운 것 (Relocatable 위험)</h1>

<ul>
  <li>
    <p><strong>Python venv / conda env</strong> : 내부 shebang과 경로가 <strong>절대경로로 박혀</strong> 있어요.<br />
→ <em>권장</em> : venv는 다시 만들기, conda는 <strong>conda-pack</strong> 같은 도구 사용.</p>
  </li>
  <li>
    <p><strong>C/C++ 툴체인·라이브러리</strong> 가 <strong>절대 RPATH / install prefix</strong> 를 가질 때<br />
→ <code class="language-plaintext highlighter-rouge">readelf -d</code>/<code class="language-plaintext highlighter-rouge">patchelf</code>(Linux), <code class="language-plaintext highlighter-rouge">otool -l</code>/<code class="language-plaintext highlighter-rouge">install_name_tool</code>(macOS)로 확인·수정 필요.</p>
  </li>
  <li>
    <p><strong>Qt/GTK 등 프레임워크 앱</strong> : 플랫폼 러ntime 경로/툴(deploy 도구) 의존.<br />
→ <code class="language-plaintext highlighter-rouge">macdeployqt</code>/<code class="language-plaintext highlighter-rouge">windeployqt</code>로 번들링한 산출만 위치 독립이 됨.</p>
  </li>
  <li>
    <p><strong>Windows에 “인스톨러로 설치된” 툴</strong> : 레지스트리/서비스/시스템 PATH 의존.<br />
→ Program Files에 깔린 건 <strong>복사 말고 재설치</strong> 가 안전.</p>
  </li>
</ul>

<hr />

<h1 id="3-안전한-복사이동-커맨드">3) 안전한 복사/이동 커맨드</h1>

<h2 id="같은-디스크파티션라면--이동이-정답">같은 디스크(파티션)라면 → <strong>이동이 정답</strong></h2>

<ul>
  <li><strong>Linux/macOS</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mv</span> /old/path/gcc/13.2.0 /new/path/gcc/
</code></pre></div>    </div>

    <ul>
      <li><em>장점</em> : 빠름(메타데이터만 갱신), <strong>권한/타임스탬프/링크 보존</strong>.</li>
    </ul>
  </li>
</ul>

<h2 id="다른-디스크장치로-복사해야-한다면">다른 디스크/장치로 복사해야 한다면</h2>

<ul>
  <li><strong>Linux</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rsync <span class="nt">-aHAX</span> <span class="nt">--info</span><span class="o">=</span>progress2 /old/path/ /new/path/
<span class="c"># 또는 최소: rsync -a /old/path/ /new/path/</span>
<span class="c"># cp 대안: cp -a /old/path /new/path</span>
</code></pre></div>    </div>
  </li>
  <li><strong>macOS (BSD cp는 -a가 약함)</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rsync <span class="nt">-a</span> /old/path/ /new/path/
<span class="c"># 또는: cp -pPR /old/path /new/path   # -p(속성) -P(심볼릭 보존) -R(재귀)</span>
<span class="c"># 또는: ditto /old/path /new/path     # xattrs/리소스 포크까지 잘 보존</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Windows</strong>
    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">robocopy</span><span class="w"> </span><span class="s2">"C:\old\path"</span><span class="w"> </span><span class="s2">"D:\new\path"</span><span class="w"> </span><span class="nx">/MIR</span><span class="w"> </span><span class="nx">/COPY:DATSO</span><span class="w"> </span><span class="nx">/DCOPY:DAT</span><span class="w"> </span><span class="nx">/SL</span><span class="w">
</span><span class="c"># /SL: 심볼릭 링크를 '대상'이 아니라 '링크 자체'로 복사</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<blockquote>
  <p><strong>왜<code class="language-plaintext highlighter-rouge">cp -rf</code>는 위험?</strong><br />
 <code class="language-plaintext highlighter-rouge">-r</code>은 재귀 복사지만 <strong>메타데이터(권한/타임스탬프/링크/확장속성)</strong>를 제대로 안 지켜요.<br />
 또한 <strong>심볼릭 링크를 따라가</strong> 실제 내용을 복사해 버릴 수 있어 구조가 바뀝니다.<br />
 → <strong><code class="language-plaintext highlighter-rouge">-a</code>(archive)나 <code class="language-plaintext highlighter-rouge">-pPR</code>/<code class="language-plaintext highlighter-rouge">rsync -a</code></strong>를 쓰세요.</p>
</blockquote>

<hr />

<h1 id="4-옮긴-뒤-고장-체크-빠른-점검표">4) 옮긴 뒤 “고장 체크” 빠른 점검표</h1>

<h3 id="공통">공통</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bin/툴 --version</code> 실행</p>
  </li>
  <li>
    <p><strong>심볼릭 링크</strong> 가 그대로인지: <code class="language-plaintext highlighter-rouge">find . -type l -ls</code> (링크가 파일로 “복제”되어 있지 않은지)</p>
  </li>
  <li>
    <p><strong>타임스탬프</strong> 유지 여부(증분 빌드 트리거 방지): <code class="language-plaintext highlighter-rouge">stat</code>로 몇 개 샘플 확인</p>
  </li>
</ul>

<h3 id="linuxelf">Linux(ELF)</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ldd bin/somebinary                  <span class="c"># 의존 so 확인</span>
patchelf <span class="nt">--print-rpath</span> bin/somebinary
</code></pre></div></div>

<ul>
  <li>절대 RPATH가 이전 경로를 가리키면 동작 불가 → <code class="language-plaintext highlighter-rouge">patchelf --set-rpath</code>로 수정.</li>
</ul>

<h3 id="macosmach-o">macOS(Mach-O)</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>otool <span class="nt">-L</span> bin/somebinary             <span class="c"># 로드 라이브러리 경로</span>
otool <span class="nt">-l</span> bin/somebinary | <span class="nb">grep</span> <span class="nt">-A2</span> LC_RPATH
</code></pre></div></div>

<ul>
  <li>필요 시 <code class="language-plaintext highlighter-rouge">install_name_tool -change/-add_rpath</code>로 경로 수정.</li>
</ul>

<h3 id="pythonconda">Python/conda</h3>

<ul>
  <li>venv는 <strong>다시 생성</strong> 권장:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-m</span> venv .venv <span class="o">&amp;&amp;</span> <span class="nb">.</span> .venv/bin/activate <span class="o">&amp;&amp;</span> pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt
</code></pre></div>    </div>
  </li>
  <li>conda는 <strong>conda-pack</strong> 으로 묶어서 옮긴 뒤 <strong>재배치</strong> :
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda-pack <span class="nt">-n</span> myenv <span class="nt">-o</span> myenv.tar.gz
<span class="nb">mkdir</span> <span class="nt">-p</span> /new/env <span class="o">&amp;&amp;</span> <span class="nb">tar</span> <span class="nt">-xzf</span> myenv.tar.gz <span class="nt">-C</span> /new/env
/new/env/bin/conda-unpack
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="windows-1">Windows</h3>

<ul>
  <li>포터블 앱이면 OK. <strong>인스톨러 기반</strong>(레지스트리 사용) 툴은 재설치 권장.</li>
</ul>

<hr />

<h1 id="5-latest-링크는">5) <code class="language-plaintext highlighter-rouge">latest</code> 링크는?</h1>

<p>폴더 위치가 바뀌면 <strong>상대링크</strong> 로 다시 잡는 게 안전:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /new/path/gcc
<span class="nb">ln</span> <span class="nt">-sfn</span> 13.3.0 latest   <span class="c"># 상대경로 심볼릭</span>
</code></pre></div></div>

<hr />

<h2 id="결론-실무-룰">결론 (실무 룰)</h2>

<ol>
  <li>
    <p><strong>같은 디스크면<code class="language-plaintext highlighter-rouge">mv</code></strong>, 다른 디스크면 <strong><code class="language-plaintext highlighter-rouge">rsync -a</code></strong> (mac은 <code class="language-plaintext highlighter-rouge">cp -pPR</code>/<code class="language-plaintext highlighter-rouge">ditto</code>도 OK).</p>
  </li>
  <li>
    <p><strong>venv/conda, 인스톨러 기반 툴</strong> 은 복사 대신 <strong>재생성/재설치</strong>.</p>
  </li>
  <li>
    <p>바이너리는 <strong>RPATH/의존 라이브러리</strong> 를 점검(필요 시 <code class="language-plaintext highlighter-rouge">patchelf</code>/<code class="language-plaintext highlighter-rouge">install_name_tool</code>).</p>
  </li>
  <li>
    <p>복사 후에는 <strong>latest 심볼릭</strong> 과 PATH만 다시 확인.</p>
  </li>
</ol>

<p>원하면 네가 실제로 옮기려는 폴더(예: <code class="language-plaintext highlighter-rouge">gcc/13.2.0</code>, <code class="language-plaintext highlighter-rouge">qt/6.7.2</code>) 기준으로 <strong>안전 명령어 세트</strong> 를 구체적으로 써 줄게.</p>

<p class="chat--user">

이동하나 카피하나 똑같은거 아닌가

</p>

<p>짧게: <strong>아니요.</strong></p>

<ul>
  <li>
    <p><strong>같은 디스크/파일시스템이면</strong> <code class="language-plaintext highlighter-rouge">mv</code>는 거의 <strong>이름만 바꾸는(renaming) 메타데이터 연산</strong> → 빠르고 원형(권한/타임스탬프/하드링크 등) 그대로.</p>
  </li>
  <li>
    <p><strong>다른 디스크/파티션이면</strong> <code class="language-plaintext highlighter-rouge">mv</code>도 내부적으로 <strong>복사 후 원본 삭제</strong> 라서 사실상 <code class="language-plaintext highlighter-rouge">cp</code>와 비슷하지만, <code class="language-plaintext highlighter-rouge">cp -rf</code>는 <strong>메타데이터·심볼릭 처리</strong> 가 부정확할 수 있어 위험.</p>
  </li>
</ul>

<p>아래를 기준으로 골라 써요.</p>

<hr />

<h1 id="step-by-step-판단">step-by-step 판단</h1>

<ol>
  <li>
    <p><strong>같은 파일시스템?</strong> → <strong><code class="language-plaintext highlighter-rouge">mv</code></strong></p>

    <ul>
      <li>
        <p>장점: 0-copy(초고속), <strong>원본 inode/권한/타임스탬프/xattr/하드링크 그대로</strong> , <strong>원자적(atomic) rename</strong>.</p>
      </li>
      <li>
        <p>예: <code class="language-plaintext highlighter-rouge">mv /work/old/gcc/13.2.0 /work/80_Toolchains/gcc/</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>다른 파일시스템(또는 드라이브)?</strong> → <strong><code class="language-plaintext highlighter-rouge">rsync -a</code>(또는 <code class="language-plaintext highlighter-rouge">cp -a</code>)</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">rsync -a</code>가 표준 답: 권한/타임스탬프/심볼릭링크/하드링크를 보존.</p>
      </li>
      <li>예 (Linux/macOS):
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rsync <span class="nt">-a</span> /old/path/ /new/path/    <span class="c"># 끝에 슬래시 주의</span>
<span class="c"># 대안: macOS는 cp -pPR 또는 ditto / robocopy(Windows)</span>
</code></pre></div>        </div>
      </li>
      <li>끝나면 원본을 직접 지우기(<code class="language-plaintext highlighter-rouge">rm -rf /old/path</code>)—<strong>검증 후</strong>.</li>
    </ul>
  </li>
</ol>

<blockquote>
  <p><strong>왜<code class="language-plaintext highlighter-rouge">cp -rf</code>는 비추?</strong><br />
 <code class="language-plaintext highlighter-rouge">-r</code>은 심볼릭 링크를 <strong>따라가서 내용까지 복사</strong> 할 수 있고, xattr/ACL/타임스탬프 보존이 깨질 수 있어요. 최소 <strong><code class="language-plaintext highlighter-rouge">cp -a</code></strong>(Linux)나 <strong><code class="language-plaintext highlighter-rouge">cp -pPR</code>/<code class="language-plaintext highlighter-rouge">ditto</code>(macOS)</strong>를 써야 안전.</p>
</blockquote>

<hr />

<h1 id="빠른-체크같은-fs인지">빠른 체크(같은 FS인지)</h1>

<ul>
  <li>
    <p><strong>Linux</strong> : <code class="language-plaintext highlighter-rouge">stat -c %d &lt;path&gt;</code> 두 경로의 숫자가 같으면 같은 FS</p>
  </li>
  <li>
    <p><strong>macOS</strong> : <code class="language-plaintext highlighter-rouge">stat -f %d &lt;path&gt;</code></p>
  </li>
  <li>
    <p>간단 함수:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>samefs<span class="o">()</span> <span class="o">{</span>
  <span class="k">if </span><span class="nb">stat</span> <span class="nt">-c</span> %d / <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then</span>
    <span class="o">[</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">stat</span> <span class="nt">-c</span> %d <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">stat</span> <span class="nt">-c</span> %d <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span> <span class="o">]</span>
  <span class="k">else</span>
    <span class="o">[</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">stat</span> <span class="nt">-f</span> %d <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">stat</span> <span class="nt">-f</span> %d <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span> <span class="o">]</span>
  <span class="k">fi</span>
<span class="o">}</span>
<span class="c"># 사용: samefs /src /dst &amp;&amp; mv /src /dst || rsync -a /src/ /dst/</span>
</code></pre></div>    </div>
  </li>
</ul>

<hr />

<h1 id="도구빌드-폴더에-대한-실무-팁">도구/빌드 폴더에 대한 실무 팁</h1>

<ul>
  <li>
    <p><strong>포터블 툴체인/SDK(압축 풀어 쓰는 형태)</strong> : 위 규칙대로 옮기면 대체로 OK.</p>
  </li>
  <li>
    <p><strong>Python venv/conda</strong> : 내부 절대경로 때문에 <strong>복사/이동 후 깨짐</strong> → venv는 다시 만들고, conda는 <code class="language-plaintext highlighter-rouge">conda-pack</code> 사용 권장.</p>
  </li>
  <li>
    <p><strong>ELF/Mach-O 바이너리</strong> : RPATH/install_name이 절대경로면 이동 후 실패 →</p>

    <ul>
      <li>
        <p>Linux: <code class="language-plaintext highlighter-rouge">patchelf --print-rpath bin/...</code>로 확인, 필요시 <code class="language-plaintext highlighter-rouge">--set-rpath</code>.</p>
      </li>
      <li>
        <p>macOS: <code class="language-plaintext highlighter-rouge">otool -L</code>/<code class="language-plaintext highlighter-rouge">install_name_tool</code>로 수정.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Windows “인스톨러 설치” 앱</strong> : 레지스트리/서비스 의존 → <strong>재설치</strong> 가 안전.</p>
  </li>
</ul>

<hr />

<h1 id="마지막-한-줄-규칙">마지막 한 줄 규칙</h1>

<ul>
  <li>
    <p><strong>같은 FS</strong> ➜ <code class="language-plaintext highlighter-rouge">mv</code> (최고)</p>
  </li>
  <li>
    <p><strong>다른 FS</strong> ➜ <code class="language-plaintext highlighter-rouge">rsync -a</code> / <code class="language-plaintext highlighter-rouge">cp -a</code> (검증 후 원본 삭제)</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">cp -rf</code>는 지양</strong> (링크/메타데이터 깨질 위험)</p>
  </li>
  <li>
    <p>옮긴 뒤엔 <strong><code class="language-plaintext highlighter-rouge">latest</code> 심볼릭</strong>과 <strong>실행 체크(<code class="language-plaintext highlighter-rouge">--version</code>)</strong>로 검증!</p>
  </li>
</ul>

<p class="chat--user">

today.csh 별로인데? 가상환경 소싱하도록 하고 싶은데 커맨드로 venv_user (내 가상환경 소싱하는 alias) 등록하니 그런 커맨드가 없대

</p>

<p>좋은 포인트야. 증상은 “<code class="language-plaintext highlighter-rouge">today.csh</code>가 <strong>비대화(non-interactive) 셸</strong> 에서 커맨드를 실행하고, 네 <strong>alias(venv_user)</strong> 는 <strong>인터랙티브에서만 로드</strong> 되기 때문”이에요. 게다가 Python venv는 tcsh에선 <code class="language-plaintext highlighter-rouge">activate.csh</code>를 <code class="language-plaintext highlighter-rouge">source</code>해야 하는데, 이건 <strong>tcsh에서만</strong> 먹습니다(= sh/bash에서 실행하면 에러).</p>

<p>아래 중 편한 해법 하나 골라 써!</p>

<hr />

<h1 id="왜-alias가-안-먹나">왜 alias가 안 먹나</h1>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">today.csh</code>가 내부에서 <code class="language-plaintext highlighter-rouge">sh</code>나 <code class="language-plaintext highlighter-rouge">tcsh -f -c "..."</code> 같은 <strong>비대화 셸</strong> 로 실행 → <code class="language-plaintext highlighter-rouge">~/.tcshrc</code>의 alias가 로드되지 않음.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">source</code>는 <strong>셸 내장</strong> 이라 <strong>tcsh</strong> 로 실행해야 함. (bash로 돌리면 당연히 “없는 커맨드”)</p>
  </li>
</ul>

<hr />

<h1 id="해결-a-shortcutslist에서-한-줄로-venv-활성화-후-실행">해결 A) shortcuts.list에서 <strong>한 줄로</strong> venv 활성화 후 실행</h1>

<blockquote>
  <p>프로젝트마다 venv가 있다면 <strong>tcsh로 실행</strong> 하고 <strong>activate.csh</strong> 를 <code class="language-plaintext highlighter-rouge">source</code>하세요.</p>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>My App (venv) | 20_Projects/PRJ-2025-001_app | tcsh -c 'source .venv/bin/activate.csh; ./scripts/run.sh'
</code></pre></div>  </div>
</blockquote>

<ul>
  <li>conda를 쓴다면:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>My App (conda) | 20_Projects/PRJ-2025-001_app | tcsh -c 'source ~/miniconda3/etc/profile.d/conda.csh; conda activate myenv; ./scripts/run.sh'
</code></pre></div></div>

<blockquote>
  <p>포인트: <strong>반드시 tcsh -c</strong> 로 돌려야 <code class="language-plaintext highlighter-rouge">source</code>가 먹습니다.<br />
 venv는 <code class="language-plaintext highlighter-rouge">bin/activate.csh</code>를 쓰고, bash용 <code class="language-plaintext highlighter-rouge">bin/activate</code>를 쓰면 tcsh에선 실패해요.</p>
</blockquote>

<hr />

<h1 id="해결-b-래퍼-스크립트-를-만들어서-언제나-작동하게">해결 B) <strong>래퍼 스크립트</strong> 를 만들어서 언제나 작동하게</h1>

<p><code class="language-plaintext highlighter-rouge">10_Today/wrappers/run_in_venv.csh</code> (tcsh용, venv 전용)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

#!/bin/tcsh -f
# 사용: run_in_venv.csh &lt;venv_dir&gt; &lt;커맨드...&gt;
if ( $#argv &lt; 1 ) then
  echo "usage: run_in_venv.csh &lt;venv_dir&gt; [command ...]"
  exit 2
endif
set venv = "$1"; shift
if ( ! -f "$venv/bin/activate.csh" ) then
  echo "activate.csh not found in $venv/bin"; exit 3
endif
source "$venv/bin/activate.csh"
if ( $#argv == 0 ) then
  exec tcsh -i
else
  # 남은 인자를 하나의 커맨드로 실행
  set cmd = "$*"
  exec tcsh -c "$cmd"
endif
</code></pre></div></div>

<p>권한 주기:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

chmod +x ~/Work/10_Today/wrappers/run_in_venv.csh
</code></pre></div></div>

<p>shortcuts.list 예시:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Run PRJ in venv | 20_Projects/PRJ-2025-001_app | ../../10_Today/wrappers/run_in_venv.csh .venv './scripts/run.sh'
Open tcsh@venv  | 20_Projects/PRJ-2025-001_app | ../../10_Today/wrappers/run_in_venv.csh .venv
</code></pre></div></div>

<p><strong>conda 버전</strong>(<code class="language-plaintext highlighter-rouge">run_in_conda.csh</code>):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

#!/bin/tcsh -f
# 사용: run_in_conda.csh &lt;env_name&gt; &lt;커맨드...&gt;
source ~/miniconda3/etc/profile.d/conda.csh
if ( $#argv &lt; 1 ) then
  echo "usage: run_in_conda.csh &lt;env_name&gt; [command ...]"; exit 2
endif
set env = "$1"; shift
conda activate "$env"
if ( $#argv == 0 ) then
  exec tcsh -i
else
  exec tcsh -c "$*"
endif
</code></pre></div></div>

<hr />

<h1 id="해결-c-alias-대신-실행-파일-로-venv_user를-만들기">해결 C) alias 대신 <strong>실행 파일</strong> 로 <code class="language-plaintext highlighter-rouge">venv_user</code>를 만들기</h1>

<p>alias는 비대화 셸에서 안 불러와져요. 아예 <strong>스크립트</strong> 로 만들어 PATH에 두면 어디서든 호출 가능.</p>

<p><code class="language-plaintext highlighter-rouge">82_Tools/bin/venv_user</code> (tcsh 스크립트):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

#!/bin/tcsh -f
# 기본 venv 경로를 하드코딩하거나, 인자로 받게 하자
set venv = "$HOME/Work/20_Projects/PRJ-2025-001_app/.venv"
if ( "$1" != "" ) set venv = "$1"; shift
if ( ! -f "$venv/bin/activate.csh" ) then
  echo "activate.csh not found in $venv/bin"; exit 3
endif
source "$venv/bin/activate.csh"
if ( $#argv == 0 ) then
  exec tcsh -i
else
  exec tcsh -c "$*"
endif
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chmod +x ~/Work/82_Tools/bin/venv_user
</code></pre></div></div>

<p>PATH에 <code class="language-plaintext highlighter-rouge">82_Tools/bin</code>이 있다면 shortcuts.list는 이렇게:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Run via venv_user | 20_Projects/PRJ-2025-001_app | venv_user .venv './scripts/run.sh'
</code></pre></div></div>

<hr />

<h2 id="자주-걸리는-함정-체크리스트">자주 걸리는 함정 체크리스트</h2>

<ul>
  <li>
    <p><strong>tcsh 전용 활성화</strong> : <code class="language-plaintext highlighter-rouge">activate.csh</code>를 <code class="language-plaintext highlighter-rouge">source</code>해야 한다.</p>
  </li>
  <li>
    <p><strong>셸 지정</strong> : <code class="language-plaintext highlighter-rouge">tcsh -c '...'</code>로 실행(기본 sh로 돌리면 실패).</p>
  </li>
  <li>
    <p><strong>지속성 기대 금지</strong> : today 런처가 <strong>하위 셸</strong> 에서 실행하므로, 활성화 상태는 그 실행에만 적용됨.<br />
오래 머무는 셸이 필요하면 위 래퍼로 <code class="language-plaintext highlighter-rouge">exec tcsh -i</code>를 열도록.</p>
  </li>
  <li>
    <p><strong>경로 공백</strong> : 패스/커맨드는 따옴표로 감싸자.</p>
  </li>
  <li>
    <p><strong>conda</strong> : <code class="language-plaintext highlighter-rouge">conda.csh</code>를 <code class="language-plaintext highlighter-rouge">source</code>한 뒤 <code class="language-plaintext highlighter-rouge">conda activate</code> 해야 함.</p>
  </li>
</ul>

<p>원하면 지금 쓰는 <code class="language-plaintext highlighter-rouge">today.csh</code>를 살짝 수정해서 <strong>항상 tcsh로 실행</strong> 하고, 에러/로그 출력도 깔끔하게 보는 버전으로 리팩터링해줄게.</p>

<p class="chat--user">

흠 단순히 tcsh에서 작업 폴더로 이동 + command 실행 -&gt; 이후 tcsh 세션 유지 이런 flow가 아닌가보네

</p>

<p>맞아—지금 러너는 “비대화 셸에서 실행 → 종료”라서 네가 원하는<br />
<strong>(1) 작업 폴더로 이동 → (2) venv/conda 활성화 → (3) 커맨드 실행 → (4) 셸 유지</strong> 흐름이 안 나와.<br />
해결법은 마지막에 <strong><code class="language-plaintext highlighter-rouge">exec tcsh -i</code></strong>로 <strong>인터랙티브 셸로 전환</strong> 해 머무르게 하는 거야.</p>

<p>아래 셋 중 편한 걸 골라 써.</p>

<hr />

<h1 id="옵션-a-한-줄로-해결-shortcutslist용">옵션 A) 한 줄로 해결 (shortcuts.list용)</h1>

<blockquote>
  <p>실행 후 셸을 유지하려면 끝에 <strong><code class="language-plaintext highlighter-rouge">exec tcsh -i</code></strong>가 핵심!</p>
</blockquote>

<p><strong>venv 사용 예</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Label | 20_Projects/PRJ-2025-001_app | tcsh -c 'source .venv/bin/activate.csh; ./scripts/run.sh; exec tcsh -i'
</code></pre></div></div>

<p><strong>conda 사용 예</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Label | 20_Projects/PRJ-2025-001_app | tcsh -c 'source ~/miniconda3/etc/profile.d/conda.csh; conda activate myenv; ./scripts/run.sh; exec tcsh -i'
</code></pre></div></div>

<blockquote>
  <p>포인트: <code class="language-plaintext highlighter-rouge">tcsh -c '...'</code> 안에서 필요한 걸 실행한 뒤 <strong>그 프로세스를 인터랙티브 tcsh로 교체</strong> 하니, 환경이 보존된 채 셸이 남아있어.</p>
</blockquote>

<hr />

<h1 id="옵션-b-재사용-래퍼-스크립트-추천">옵션 B) 재사용 래퍼 스크립트 (추천)</h1>

<p><code class="language-plaintext highlighter-rouge">Work/10_Today/wrappers/enter.csh</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

#!/bin/tcsh -f
# 사용: enter.csh &lt;path&gt; [--venv &lt;venvdir&gt; | --conda &lt;envname&gt;] [-- cmd ...]
if ( $#argv &lt; 1 ) then
  echo "usage: enter.csh &lt;path&gt; [--venv DIR | --conda NAME] [-- cmd ...]"; exit 2
endif

set cwd = "$1"; shift
cd "$cwd" || exit 3

# 옵션 파싱
set use_venv = ""; set use_conda = ""; set i = 1
while ( $i &lt;= $#argv )
  if ( "$argv[$i]" == "--venv" ) then
    @ i++; set use_venv = "$argv[$i]"
  else if ( "$argv[$i]" == "--conda" ) then
    @ i++; set use_conda = "$argv[$i]"
  else if ( "$argv[$i]" == "--" ) then
    @ i++; break
  else
    break
  endif
  @ i++
end
@ cmd_start = $i

# 환경 활성화
if ( "$use_venv" != "" ) then
  if ( ! -f "$use_venv/bin/activate.csh" ) then
    echo "venv activate.csh not found: $use_venv/bin/activate.csh"; exit 4
  endif
  source "$use_venv/bin/activate.csh"
else if ( "$use_conda" != "" ) then
  if ( -f ~/miniconda3/etc/profile.d/conda.csh ) then
    source ~/miniconda3/etc/profile.d/conda.csh
  endif
  conda activate "$use_conda"
endif

# 커맨드가 있으면 실행
if ( $cmd_start &lt;= $#argv ) then
  set cmd = "$argv[$cmd_start-]"
  tcsh -c "$cmd"
endif

# 여기서 셸에 '머무르기'
exec tcsh -i
</code></pre></div></div>

<p>권한:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

chmod +x ~/Work/10_Today/wrappers/enter.csh
</code></pre></div></div>

<p><strong>shortcuts.list 예시</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PRJ venv &amp; stay  | 20_Projects/PRJ-2025-001_app | ../../10_Today/wrappers/enter.csh . --venv .venv -- ./scripts/run.sh
Just enter venv   | 20_Projects/PRJ-2025-001_app | ../../10_Today/wrappers/enter.csh . --venv .venv
PRJ conda &amp; stay  | 20_Projects/PRJ-2025-001_app | ../../10_Today/wrappers/enter.csh . --conda myenv -- ./scripts/run.sh
</code></pre></div></div>

<hr />

<h1 id="옵션-c-전역-커맨드로-고정-venv_user">옵션 C) 전역 커맨드로 고정 (<code class="language-plaintext highlighter-rouge">venv_user</code>)</h1>

<p><code class="language-plaintext highlighter-rouge">Work/82_Tools/bin/venv_user</code> (PATH에 들어가게)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

#!/bin/tcsh -f
# 사용: venv_user &lt;project_path&gt; &lt;venv_dir&gt; [-- cmd ...]
set proj="$1"; set venv="$2"; shift; shift
cd "$proj" || exit 3
source "$venv/bin/activate.csh"
if ( "$1" == "--" ) shift
if ( $#argv ) then
  tcsh -c "$*"
endif
exec tcsh -i
</code></pre></div></div>

<p>권한:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

chmod +x ~/Work/82_Tools/bin/venv_user
</code></pre></div></div>

<p><strong>예</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Label | / | venv_user "$HOME/Work/20_Projects/PRJ-2025-001_app" ".venv" -- ./scripts/run.sh
</code></pre></div></div>

<hr />

<h2 id="흔한-함정-체크">흔한 함정 체크</h2>

<ul>
  <li>
    <p><strong>반드시<code class="language-plaintext highlighter-rouge">tcsh</code>로 실행</strong>해야 <code class="language-plaintext highlighter-rouge">source .../activate.csh</code>가 먹음. (bash로 돌리면 실패)</p>
  </li>
  <li>
    <p><strong>마지막에 <code class="language-plaintext highlighter-rouge">exec tcsh -i</code></strong>가 있어야 환경을 들고 <strong>머무름</strong>.</p>
  </li>
  <li>
    <p>runner가 이미 경로로 <code class="language-plaintext highlighter-rouge">cd</code>해 준다면 <code class="language-plaintext highlighter-rouge">enter.csh</code>의 <code class="language-plaintext highlighter-rouge">&lt;path&gt;</code>를 <code class="language-plaintext highlighter-rouge">.</code>로 쓰면 됨.</p>
  </li>
  <li>
    <p>경로에 공백 있으면 <strong>따옴표</strong> 필수.</p>
  </li>
</ul>

<p>이대로 쓰면 “작업 폴더 이동 → 가상환경 활성화 → 커맨드 실행 → tcsh 유지”가 딱 그 흐름으로 돌아갈 거야.</p>

<p class="chat--user">

그냥 내가 원하는 흐름대로 할 순 없어? 작업명 | 작업 폴더(절대 경로) | 작업 경로로 현재 쉘에서 cd로 이동 후 실행할 커맨드드들(비어있을 수도 있음)

</p>

<p>가능해! 핵심은 <strong>“현재 셸(tcsh)의 상태를 바꾸려면 실행이 아니라 <code class="language-plaintext highlighter-rouge">source</code> 해야 한다”</strong>는 점이야.<br />
아래 스크립트를 쓰면, <strong>현재 tcsh에서</strong> <code class="language-plaintext highlighter-rouge">cd</code>로 이동하고 (필요하면) <strong>명령을 실행</strong> 한 뒤 <strong>그 상태로 계속 머물러</strong>.</p>

<hr />

<h1 id="1-원하는-형식의-리스트-파일">1) 원하는 형식의 리스트 파일</h1>

<p><code class="language-plaintext highlighter-rouge">~/Work/10_Today/shortcuts.list</code> (예: 절대경로 + 선택 명령)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># label | abs path | commands (optional)
My App(run) | /Users/me/Work/20_Projects/PRJ-2025-001_app | source .venv/bin/activate.csh; ./scripts/run.sh
Just Go     | /Users/me/Work/26_Datasets/datasets/ad_events/v2025.0826/processed |
</code></pre></div></div>

<ul>
  <li>
    <p>3번째 칸은 <strong>비워도 됨</strong>(그냥 폴더만 이동).</p>
  </li>
  <li>
    <p>명령이 여러 개면 <code class="language-plaintext highlighter-rouge">;</code>로 이어서 쓰면 <strong>현재 셸</strong> 에서 그대로 실행됨.</p>
  </li>
</ul>

<hr />

<h1 id="2-tcsh-전용-러너-현재-셸에서-cd--실행--유지">2) tcsh 전용 러너 (현재 셸에서 cd + 실행 + 유지)</h1>

<p><code class="language-plaintext highlighter-rouge">~/Work/10_Today/jump.csh</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

#!/bin/tcsh -f
# 사용: source ~/Work/10_Today/jump.csh &lt;번호|라벨 일부&gt;
# 동작: shortcuts.list에서 매칭 항목을 찾아 "현재 셸"에서 cd 후 (있으면) 명령을 실행.
# 중요: 반드시 source로 호출해야 현재 셸에 반영됨!

set _list = "$HOME/Work/10_Today/shortcuts.list"
if ( ! -r "$_list" ) then
  echo "not found: $_list"; exit 1
endif

# 인자 없으면 번호 목록을 보여주고 종료
if ( $#argv == 0 ) then
  awk -F'\\|' 'BEGIN{i=0}
    $0 ~ /^[[:space:]]*#/ {next}
    NF&gt;=2 {
      i++; for (k=1;k&lt;=NF;k++){ gsub(/^[ \t]+|[ \t]+$/,"",$k) }
      printf("%2d) %-24s  -&gt; %s\n", i, $1, $2)
    }' "$_list"
  echo 'usage: source ~/Work/10_Today/jump.csh &lt;번호|라벨 일부&gt;'
  exit 0
endif

# 선택 로직: 숫자 인덱스 또는 라벨 부분 일치(대소문자 무시, 첫 매칭)
set _key = "$*"

# dir
set _dir = "`awk -F'\\|' -v key=\"$_key\" '
  BEGIN{IGNORECASE=1; i=0}
  $0 ~ /^[[:space:]]*#/ {next}
  NF&gt;=2 {
    for(k=1;k&lt;=NF;k++){ gsub(/^[ \t]+|[ \t]+$/,"",$k) }
    i++
    if ( (key ~ /^[0-9]+$/ &amp;&amp; i==key) || index($1,key) ) { print $2; exit }
  }' \"$_list\"`"

# cmd (optional)
set _cmd = "`awk -F'\\|' -v key=\"$_key\" '
  BEGIN{IGNORECASE=1; i=0}
  $0 ~ /^[[:space:]]*#/ {next}
  NF&gt;=2 {
    for(k=1;k&lt;=NF;k++){ gsub(/^[ \t]+|[ \t]+$/,"",$k) }
    i++
    if ( (key ~ /^[0-9]+$/ &amp;&amp; i==key) || index($1,key) ) { if (NF&gt;=3) print $3; exit }
  }' \"$_list\"`"

if ( "$_dir" == "" ) then
  echo "not found: $_key"; exit 2
endif
if ( ! -d "$_dir" ) then
  echo "no such dir: $_dir"; exit 3
endif

# 현재 셸에서 이동
cd "$_dir"

# 명령이 있으면 현재 셸에서 실행(환경 유지)
if ( "$_cmd" != "" ) then
  eval "$_cmd"
endif

# 여기서 끝. source로 불렀기 때문에 셸은 계속 유지됨.
</code></pre></div></div>

<h2 id="사용법">사용법</h2>

<ol>
  <li><code class="language-plaintext highlighter-rouge">.tcshrc</code>에 바로가기 추가:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

alias j 'source ~/Work/10_Today/jump.csh'
</code></pre></div></div>

<ol>
  <li>사용 예:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

j                 # 목록 보기
j 1               # 1번으로 이동(+명령 실행)
j "My App"        # 라벨 부분 매칭으로 이동(+명령 실행)
</code></pre></div></div>

<blockquote>
  <p><strong>중요:</strong> 반드시 <code class="language-plaintext highlighter-rouge">source</code>로 호출해야 <strong>현재 셸</strong> 에서 <code class="language-plaintext highlighter-rouge">cd</code>/환경변경이 반영돼요.<br />
 (위 alias <code class="language-plaintext highlighter-rouge">j</code>가 바로 그걸 해줍니다.)</p>
</blockquote>

<hr />

<h2 id="팁-venvconda">팁 (venv/conda)</h2>

<ul>
  <li>venv 활성화는 명령 칸에 그냥 넣으면 돼요:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>My App | /abs/PRJ | source .venv/bin/activate.csh; ./scripts/run.sh
</code></pre></div>    </div>
  </li>
  <li>conda:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PRJ(conda) | /abs/PRJ | source ~/miniconda3/etc/profile.d/conda.csh; conda activate myenv; ./scripts/run.sh
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="안전장치">안전장치</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">#</code>로 시작하는 줄은 주석/비활성 처리.</p>
  </li>
  <li>
    <p>라벨에 공백 OK. 경로나 명령에 공백이 있어도 위 스크립트가 <strong>그대로</strong> 잡아줍니다.</p>
  </li>
  <li>
    <p>번호/라벨 중 <strong>첫 매칭 1건</strong> 만 실행(중복 라벨은 피하세요).</p>
  </li>
</ul>

<hr />

<p>원하면 이 러너에 <strong>fzf 선택</strong>(있으면), <strong>디렉터리 자동 완성</strong> , <strong>실패 로그</strong> 같은 기능도 얹어줄 수 있어.</p>

<p class="chat--user">

그런데 사용 방식은 이전에 너가 한거처럼 번호 묻고 인덱스 넣고 엔터하면 그걸 실행하면 좋겠어. 등록할때도 마찬가지로 라벨 묻고 답하고, 커맨드 묻고 답하면 그 후 등록되는 식이면 좋겠어

</p>

<p>좋아, 너가 원하는 <strong>번호 선택 → 실행 / 대화형 등록</strong> 흐름으로 딱 맞춘 <code class="language-plaintext highlighter-rouge">tcsh</code> 러너를 만들어줄게.<br />
핵심은 <strong>현재 셸에서<code class="language-plaintext highlighter-rouge">source</code>로 실행</strong>해야 <code class="language-plaintext highlighter-rouge">cd</code>/venv 활성화가 그대로 유지된다는 점!</p>

<hr />

<h1 id="1-shortcutslist-포맷-그대로-복붙">1) <code class="language-plaintext highlighter-rouge">shortcuts.list</code> 포맷 (그대로 복붙)</h1>

<p><code class="language-plaintext highlighter-rouge">~/Work/10_Today/shortcuts.list</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># label | abs path | commands (optional, ;로 구분)
My App (venv run) | /Users/me/Work/20_Projects/PRJ-2025-001_app | source .venv/bin/activate.csh; ./scripts/run.sh
Just Go           | /Users/me/Work/26_Datasets/datasets/ad_events/v2025.0826/processed |
</code></pre></div></div>

<hr />

<h1 id="2-인터랙티브-러너-번호-실행--대화형-등록">2) 인터랙티브 러너 (번호 실행 + 대화형 등록)</h1>

<p><code class="language-plaintext highlighter-rouge">~/Work/10_Today/jmenu.csh</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

#!/bin/tcsh -f
# jmenu.csh — tcsh용 “번호 선택 실행 + 대화형 등록” 러너
# 사용: source ~/Work/10_Today/jmenu.csh

set _list = "$HOME/Work/10_Today/shortcuts.list"
if ( ! -e "$_list" ) then
  echo "# label | abs path | commands (optional)" &gt; "$_list"
endif

# 리스트 출력 함수
alias _jlist 'awk -F"\\|" '"'"'BEGIN{i=0}
  $0 ~ /^[[:space:]]*#/ {next}
  NF&gt;=2 {
    for (k=1;k&lt;=NF;k++){ gsub(/^[ \t]+|[ \t]+$/,"",$k) }
    if ($1=="") next
    i++; printf("%2d) %-28s -&gt; %s\n", i, $1, $2)
  }'"'"' '$_list

# N번째 항목의 필드 가져오기(1=label, 2=dir, 3=cmd)
alias _jget 'awk -F"\\|" -v idx="\!:1" -v fld="\!:2" '"'"'BEGIN{i=0}
  $0 ~ /^[[:space:]]*#/ {next}
  NF&gt;=2 {
    for (k=1;k&lt;=NF;k++){ gsub(/^[ \t]+|[ \t]+$/,"",$k) }
    if ($1=="") next
    i++; if (i==idx){ if(fld==1)print $1; else if(fld==2)print $2; else if(fld==3 &amp;&amp; NF&gt;=3)print $3; exit }
  }'"'"' '$_list

echo ""
echo "== TODAY MENU =="
echo "[R]un (번호로 실행) / [A]dd (등록) / [E]dit / [Q]uit  [Enter=R]"
echo ""
_jlist
echo ""
echo -n "Action [R/A/E/Q]: "
set act = "$&lt;"
if ( "$act" == "" ) set act = "R"
set act = `echo "$act" | tr '[:lower:]' '[:upper:]'`

if ( "$act" == "E" ) then
  set ed = "$EDITOR"
  if ( "$ed" == "" ) set ed = "vi"
  $ed "$_list"
  echo "편집 완료."
  goto END
else if ( "$act" == "A" ) then
  echo -n "Label (띄어쓰기 가능, '|' 금지): "
  set lab = "$&lt;"
  if ( "$lab" == "" ) then
    echo "취소: 라벨이 비어있음."
    goto END
  endif
  if ( "$lab" =~ "*|*" ) then
    echo "취소: '|' 문자는 사용할 수 없음."
    goto END
  endif

  echo -n "Absolute path (비어있으면 현재 경로 사용): "
  set dir = "$&lt;"
  if ( "$dir" == "" ) set dir = "$cwd"
  # 상대경로면 절대경로로 보정
  if ( "$dir" !~ "/*" ) set dir = "$cwd/$dir"
  if ( ! -d "$dir" ) then
    echo -n "디렉터리가 없습니다. 만들까요? [y/N]: "
    set ans = "$&lt;"
    if ( "$ans" == "y" || "$ans" == "Y" ) then
      mkdir -p "$dir"
    else
      echo "취소."
      goto END
    endif
  endif

  echo -n "Commands (옵션, 여러 개는 ';'로 연결): "
  set cmd = "$&lt;"

  # 줄 추가
  if ( "$cmd" == "" ) then
    echo "$lab | $dir |" &gt;&gt; "$_list"
  else
    echo "$lab | $dir | $cmd" &gt;&gt; "$_list"
  endif
  echo "등록 완료:"
  echo "  $lab | $dir | $cmd"
  echo ""
  echo "지금 실행할까요? [y/N]: "
  set runnow = "$&lt;"
  if ( "$runnow" != "y" &amp;&amp; "$runnow" != "Y" ) goto END

  # 방금 추가한 항목 번호 계산
  set idx = `_jlist | wc -l`
  # fallthrough to 실행
  goto RUN

else if ( "$act" == "R" ) then
  echo -n "실행할 번호: "
  set idx = "$&lt;"
  if ( "$idx" == "" ) then
    echo "취소: 번호가 비어있음."
    goto END
  endif
  if ( "$idx" !~ "^[0-9][0-9]*$" ) then
    echo "취소: 숫자를 입력하세요."
    goto END
  endif
  # 실행으로 이동
  goto RUN

else
  echo "종료."
  goto END
endif

RUN:
# 필드 추출
set label = "`_jget $idx 1`"
set dest  = "`_jget $idx 2`"
set cmds  = "`_jget $idx 3`"

if ( "$label" == "" || "$dest" == "" ) then
  echo "해당 번호를 찾을 수 없습니다."
  goto END
endif
if ( ! -d "$dest" ) then
  echo "경로가 없습니다: $dest"
  goto END
endif

# 현재 셸에서 이동 + (있으면) 명령 실행
cd "$dest"
if ( "$cmds" != "" ) then
  echo "% 실행: $cmds"
  eval "$cmds"
endif
echo "% 위치: $cwd  (라벨: $label)"
# 스크립트 종료 후에도 현재 셸은 계속 유지됨(이 파일은 source로 불러야 함)

END:
</code></pre></div></div>

<h3 id="꼭-이렇게-실행하세요-현재-셸-유지">꼭 이렇게 실행하세요 (현재 셸 유지)</h3>

<p><code class="language-plaintext highlighter-rouge">.tcshrc</code>에 단축키:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

alias jm 'source ~/Work/10_Today/jmenu.csh'
</code></pre></div></div>

<p>이후:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

jm         # 메뉴 표시 → Action 입력 → 번호 선택 → 실행 → 셸 유지
</code></pre></div></div>

<hr />

<h2 id="사용-예-venvconda">사용 예 (venv/conda)</h2>

<ul>
  <li>
    <p>venv 활성화 후 실행:</p>

    <ul>
      <li>Commands: <code class="language-plaintext highlighter-rouge">source .venv/bin/activate.csh; ./scripts/run.sh</code></li>
    </ul>
  </li>
  <li>
    <p>conda:</p>

    <ul>
      <li>Commands: <code class="language-plaintext highlighter-rouge">source ~/miniconda3/etc/profile.d/conda.csh; conda activate myenv; ./scripts/run.sh</code></li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="포인트-중요">포인트 (중요)</h2>

<ul>
  <li>
    <p><strong>반드시<code class="language-plaintext highlighter-rouge">source</code>로 실행</strong>(<code class="language-plaintext highlighter-rouge">alias jm 'source ...'</code>) → 현재 셸에서 <code class="language-plaintext highlighter-rouge">cd</code>/환경 변경이 살아있음.</p>
  </li>
  <li>
    <p>번호 선택은 <strong>주석( # )과 빈 줄 제외</strong> 순서로 자동 번호가 매겨집니다.</p>
  </li>
  <li>
    <p>등록(Add)도 <strong>질문→답</strong> 형식으로 진행하고, 끝나면 즉시 실행할지 물어봐요.</p>
  </li>
  <li>
    <p>경로에 공백/세미콜론이 있으면 <strong>따옴표</strong> 로 감싸주세요.</p>
  </li>
</ul>

<p>원하면 이 러너에 <strong>삭제/이동(번호 기반 재정렬)</strong> , <strong>fzf 선택 지원</strong> 도 추가해 줄 수 있어.</p>

<p class="chat--user">

alias _jlist 에서부터 unmatched "'" 뜨고 종료돼. 좀 쉽게 하는 법 없나 파이썬 같은걸로

</p>

<p>맞아, tcsh 따옴표 지옥 피하려면 Python으로 “번호 선택/등록 → 현재 셸에서 cd+실행” 흐름을 만드는 게 제일 깔끔해. 아래 그대로 쓰면 돼.</p>

<hr />

<h1 id="0-핵심-아이디어">0) 핵심 아이디어</h1>

<ul>
  <li>
    <p><strong>Python</strong> 스크립트가 메뉴/등록을 처리하고, 실행할 <strong>tcsh 코드</strong> 를 <code class="language-plaintext highlighter-rouge">~/.cache/jmenu_out.csh</code>에 써둠</p>
  </li>
  <li>
    <p>현재 셸에서는 <strong>작은 래퍼(jm.csh)를<code class="language-plaintext highlighter-rouge">source</code></strong> 해서 그 코드를 실행 → <strong>cd/venv 활성화가 현재 셸에 그대로 반영</strong></p>
  </li>
</ul>

<hr />

<h1 id="1-리스트-파일-포맷-그대로-사용">1) 리스트 파일 포맷 (그대로 사용)</h1>

<p><code class="language-plaintext highlighter-rouge">~/Work/10_Today/shortcuts.list</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># label | abs path | commands (optional, 여러 개는 ; 로 연결)
My App (venv run) | /Users/me/Work/20_Projects/PRJ-2025-001_app | source .venv/bin/activate.csh; ./scripts/run.sh
Just Go           | /Users/me/Work/26_Datasets/datasets/ad_events/v2025.0826/processed |
</code></pre></div></div>

<hr />

<h1 id="2-python-메뉴등록-스크립트">2) Python 메뉴/등록 스크립트</h1>

<p><code class="language-plaintext highlighter-rouge">~/Work/10_Today/jmenu.py</code></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="n">os</span><span class="p">,</span> <span class="n">sys</span>

<span class="n">LIST_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">expanduser</span><span class="p">(</span><span class="sh">'</span><span class="s">~/Work/10_Today/shortcuts.list</span><span class="sh">'</span><span class="p">)</span>
<span class="n">OUT_PATH</span>  <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">expanduser</span><span class="p">(</span><span class="sh">'</span><span class="s">~/.cache/jmenu_out.csh</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">load_items</span><span class="p">():</span>
    <span class="n">items</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">LIST_PATH</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">items</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">LIST_PATH</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">s</span><span class="o">=</span><span class="n">line</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span> <span class="ow">or</span> <span class="n">s</span><span class="p">.</span><span class="nf">lstrip</span><span class="p">().</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">'</span><span class="s">#</span><span class="sh">'</span><span class="p">):</span> <span class="k">continue</span>
            <span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">s</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">|</span><span class="sh">'</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">label</span><span class="o">=</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="n">path</span><span class="o">=</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">cmd</span><span class="o">=</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">3</span> <span class="k">else</span> <span class="sh">''</span>
            <span class="n">items</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span><span class="sh">'</span><span class="s">label</span><span class="sh">'</span><span class="p">:</span><span class="n">label</span><span class="p">,</span><span class="sh">'</span><span class="s">path</span><span class="sh">'</span><span class="p">:</span><span class="n">path</span><span class="p">,</span><span class="sh">'</span><span class="s">cmd</span><span class="sh">'</span><span class="p">:</span><span class="n">cmd</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">items</span>

<span class="k">def</span> <span class="nf">print_menu</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">== TODAY MENU ==</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">(no entries yet)</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">it</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="mi">2</span><span class="n">d</span><span class="si">}</span><span class="s">) </span><span class="si">{</span><span class="n">it</span><span class="p">[</span><span class="sh">'</span><span class="s">label</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="o">&lt;</span><span class="mi">28</span><span class="si">}</span><span class="s"> -&gt; </span><span class="si">{</span><span class="n">it</span><span class="p">[</span><span class="sh">'</span><span class="s">path</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">write_out</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">w</span><span class="p">:</span>
        <span class="n">w</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">'</span><span class="s"># generated by jmenu.py</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">w</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">cd </span><span class="sh">"</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="sh">"</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cmd</span><span class="p">:</span> <span class="n">w</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="nf">rstrip</span><span class="p">()</span> <span class="o">+</span> <span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[jmenu] wrote </span><span class="si">{</span><span class="n">OUT_PATH</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_item</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="n">LIST_PATH</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">LIST_PATH</span><span class="p">,</span> <span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">w</span><span class="p">:</span>
        <span class="n">w</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s"> | </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s"> | </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">items</span><span class="o">=</span><span class="nf">load_items</span><span class="p">()</span>
    <span class="nf">print_menu</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
    <span class="n">act</span><span class="o">=</span><span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Action [R]un / [A]dd / [E]dit / [Q]uit (default R): </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">().</span><span class="nf">upper</span><span class="p">()</span> <span class="ow">or</span> <span class="sh">'</span><span class="s">R</span><span class="sh">'</span>
    <span class="k">if</span> <span class="n">act</span><span class="o">==</span><span class="sh">'</span><span class="s">Q</span><span class="sh">'</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">act</span><span class="o">==</span><span class="sh">'</span><span class="s">E</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">editor</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">EDITOR</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">vi</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">os</span><span class="p">.</span><span class="nf">execvp</span><span class="p">(</span><span class="n">editor</span><span class="p">,[</span><span class="n">editor</span><span class="p">,</span><span class="n">LIST_PATH</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">act</span><span class="o">==</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">lab</span><span class="o">=</span><span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Label: </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">lab</span> <span class="ow">or</span> <span class="sh">'</span><span class="s">|</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">lab</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Invalid label.</span><span class="sh">"</span><span class="p">);</span> <span class="k">return</span> <span class="mi">1</span>
        <span class="n">default_pwd</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">PWD</span><span class="sh">'</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="nf">getcwd</span><span class="p">())</span>
        <span class="n">dir_</span><span class="o">=</span><span class="nf">input</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Absolute path [</span><span class="si">{</span><span class="n">default_pwd</span><span class="si">}</span><span class="s">]: </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span> <span class="ow">or</span> <span class="n">default_pwd</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isabs</span><span class="p">(</span><span class="n">dir_</span><span class="p">):</span> <span class="n">dir_</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">abspath</span><span class="p">(</span><span class="n">dir_</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isdir</span><span class="p">(</span><span class="n">dir_</span><span class="p">):</span>
            <span class="n">mk</span><span class="o">=</span><span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Directory not found. Create? [y/N]: </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">().</span><span class="nf">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">mk</span><span class="o">==</span><span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">:</span> <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">dir_</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Canceled.</span><span class="sh">"</span><span class="p">);</span> <span class="k">return</span> <span class="mi">1</span>
        <span class="n">cmd</span><span class="o">=</span><span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Commands (optional; use </span><span class="sh">'</span><span class="s">;</span><span class="sh">'</span><span class="s"> to chain): </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
        <span class="nf">save_item</span><span class="p">(</span><span class="n">lab</span><span class="p">,</span> <span class="n">dir_</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Added.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Run now? [y/N]: </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">().</span><span class="nf">lower</span><span class="p">()</span><span class="o">==</span><span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">:</span>
            <span class="nf">write_out</span><span class="p">(</span><span class="n">dir_</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">No entries to run.</span><span class="sh">"</span><span class="p">);</span> <span class="k">return</span> <span class="mi">1</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">idx</span><span class="o">=</span><span class="nf">int</span><span class="p">(</span><span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Number to run: </span><span class="sh">"</span><span class="p">).</span><span class="nf">strip</span><span class="p">())</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Invalid number.</span><span class="sh">"</span><span class="p">);</span> <span class="k">return</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;=</span><span class="n">idx</span><span class="o">&lt;=</span><span class="nf">len</span><span class="p">(</span><span class="n">items</span><span class="p">)):</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Out of range.</span><span class="sh">"</span><span class="p">);</span> <span class="k">return</span> <span class="mi">1</span>
    <span class="n">it</span><span class="o">=</span><span class="n">items</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">path</span><span class="o">=</span><span class="n">it</span><span class="p">[</span><span class="sh">'</span><span class="s">path</span><span class="sh">'</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isabs</span><span class="p">(</span><span class="n">path</span><span class="p">):</span> <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="nf">write_out</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">it</span><span class="p">[</span><span class="sh">'</span><span class="s">cmd</span><span class="sh">'</span><span class="p">])</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">→ </span><span class="si">{</span><span class="n">it</span><span class="p">[</span><span class="sh">'</span><span class="s">label</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div>

<hr />

<h1 id="3-tcsh-래퍼-현재-셸에-반영">3) tcsh 래퍼 (현재 셸에 반영)</h1>

<p><code class="language-plaintext highlighter-rouge">~/Work/10_Today/jm.csh</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

#!/bin/tcsh -f
# 현재 셸에서 source 해야 cd/환경이 유지됨
python3 ~/Work/10_Today/jmenu.py
if ( -r ~/.cache/jmenu_out.csh ) then
  source ~/.cache/jmenu_out.csh
endif
</code></pre></div></div>

<p>권한:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

chmod +x ~/Work/10_Today/jm.csh
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">.tcshrc</code>에 단축키:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

alias jm 'source ~/Work/10_Today/jm.csh'
</code></pre></div></div>

<hr />

<h1 id="4-사용법">4) 사용법</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jm          # 메뉴가 뜸 → R/A/E 선택 → 번호 입력 → 실행
</code></pre></div></div>

<ul>
  <li>
    <p><strong>등록(Add)</strong> : 라벨/경로/커맨드 차례로 묻고 저장. “Run now?”에 <code class="language-plaintext highlighter-rouge">y</code>면 즉시 실행 스크립트가 만들어져 현재 셸에 반영됨.</p>
  </li>
  <li>
    <p><strong>실행(Run)</strong> : 번호만 넣으면 됨.</p>
  </li>
  <li>
    <p><strong>유지</strong> : 별도 <code class="language-plaintext highlighter-rouge">exec tcsh -i</code> 필요 없음. “현재 셸에서 source” 하므로 venv/conda 활성화가 그대로 남아있음.</p>
  </li>
</ul>

<blockquote>
  <p>venv 예시 커맨드: <code class="language-plaintext highlighter-rouge">source .venv/bin/activate.csh; ./scripts/run.sh</code><br />
 conda 예시: <code class="language-plaintext highlighter-rouge">source ~/miniconda3/etc/profile.d/conda.csh; conda activate myenv; ./scripts/run.sh</code></p>
</blockquote>

<hr />

<p>이렇게 하면 tcsh 인용/따옴표 문제 없이 <strong>번호 선택/등록</strong> 이 깔끔하게 돌아가고, 네가 원한 <strong>“작업 폴더로 이동 → 명령 실행 → 셸 유지”</strong> 흐름을 그대로 쓸 수 있어.</p>

<p class="chat--user">

unmatched error는 왜 뜬걸까

</p>

<p>맞아요—그 “unmatched ' ” 에러는 <strong>tcsh의 따옴표(quote) 규칙</strong> 때문에 납니다.</p>

<h2 id="왜-그랬냐면-핵심">왜 그랬냐면 (핵심)</h2>

<ul>
  <li>
    <p>보통 <code class="language-plaintext highlighter-rouge">alias name '...명령...'</code> 처럼 <strong>단일 인용부호(')</strong>로 alias 본문을 감싸요.</p>
  </li>
  <li>
    <p>그런데 alias 본문 안에서 또 <code class="language-plaintext highlighter-rouge">awk -F'\|'</code> 같이 <strong>다시 ' 를 사용</strong> 하면,<br />
tcsh는 <strong>바깥 ' 가 거기서 닫혔다고 해석</strong> 합니다.<br />
→ 결과적으로 <strong>열린 ' 와 닫힌 ' 의 짝이 안 맞아</strong> “unmatched '”가 터져요.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">tcsh</code>는 <strong>단일 인용부호를 내부에서 이스케이프할 수 없습니다.</strong><br />
(sh 계열에서 쓰는 <code class="language-plaintext highlighter-rouge">'\''</code> 같은 꼼수도 tcsh에선 통하지 않아요.)</p>
  </li>
</ul>

<p>작은 재현 예:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

alias bad 'awk -F'\|' '{print $1}''   # ← 여기서 unmatched '
</code></pre></div></div>

<h2 id="간단한-해결법-3가지">간단한 해결법 3가지</h2>

<ol>
  <li><strong>alias 바깥을 " (이중인용부호)로 감싸고</strong> , awk 프로그램은 ' 로 유지
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh
     
alias _jlist "awk -F'\\|' 'BEGIN{i=0} {print $0}' $_list"
</code></pre></div>    </div>

    <ul>
      <li>
        <p>바깥은 <code class="language-plaintext highlighter-rouge">"</code> 이라 내부의 <code class="language-plaintext highlighter-rouge">'...'</code> 가 <strong>문자 그대로</strong> awk로 전달됩니다.</p>
      </li>
      <li>
        <table>
          <tbody>
            <tr>
              <td><code class="language-plaintext highlighter-rouge">\\|</code> 는 awk로 <code class="language-plaintext highlighter-rouge">\|</code>가 전달되도록 한 이스케이프입니다(필드 구분자에 ‘</td>
              <td>’ literal).</td>
            </tr>
          </tbody>
        </table>
      </li>
    </ul>
  </li>
  <li><strong>awk 스크립트를 파일로 분리</strong> (가장 안전)
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh
     
# ~/Work/10_Today/jlist.awk
BEGIN { i=0 }
$0 !~ /^[[:space:]]*#/ &amp;&amp; NF&gt;=2 {
  gsub(/^[ \t]+|[ \t]+$/,"",$1); gsub(/^[ \t]+|[ \t]+$/,"",$2);
  i++; printf("%2d) %-28s -&gt; %s\n", i, $1, $2)
}
</code></pre></div>    </div>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh
     
alias _jlist "awk -F'\\|' -f ~/Work/10_Today/jlist.awk $_list"
</code></pre></div>    </div>
  </li>
  <li><strong>(추천) 아예 tcsh를 안 건드리고 Python으로 처리</strong><br />
이미 드린 <code class="language-plaintext highlighter-rouge">jmenu.py + jm.csh</code> 방식이 이 문제를 원천 차단합니다.<br />
(파싱/등록/번호 선택은 파이썬이 하고, <strong>현재 셸</strong> 반영은 <code class="language-plaintext highlighter-rouge">source ~/.cache/jmenu_out.csh</code>로 해결)</li>
</ol>

<h2 id="추가로-흔한-함정">추가로 흔한 함정</h2>

<ul>
  <li>
    <p><strong>history 확장(!)</strong> : tcsh는 <code class="language-plaintext highlighter-rouge">"</code> 안에서도 <code class="language-plaintext highlighter-rouge">!</code>를 히스토리로 해석합니다.<br />
awk 코드에 <code class="language-plaintext highlighter-rouge">!</code>가 들어간다면 alias 바깥을 <code class="language-plaintext highlighter-rouge">'...'</code>로, awk 본문은 <code class="language-plaintext highlighter-rouge">-f 파일</code>로 빼는 게 안전합니다.</p>
  </li>
  <li>
    <p><strong>backslash 처리</strong> : <code class="language-plaintext highlighter-rouge">"</code> 안에서는 <code class="language-plaintext highlighter-rouge">\</code>, <code class="language-plaintext highlighter-rouge">"</code>, <code class="language-plaintext highlighter-rouge">$</code>, <code class="language-plaintext highlighter-rouge">!</code>만 특별 취급되고 나머지 <code class="language-plaintext highlighter-rouge">\</code>는 그대로 전달됩니다.<br />
그래서 <code class="language-plaintext highlighter-rouge">-F"\\|"</code>처럼 <strong>두 번</strong> 적어야 awk로 <code class="language-plaintext highlighter-rouge">\|</code>가 전달돼요.</p>
  </li>
</ul>

<hr />

<h3 id="정리">정리</h3>

<ul>
  <li>
    <p>에러 원인: <strong>단일 인용부호를 중첩</strong> 해서 tcsh 파서가 문자열 경계를 오해했기 때문.</p>
  </li>
  <li>
    <p>해결: <strong>바깥은 "…", 안쪽 awk는 '…'</strong> 패턴으로 바꾸거나, <strong>awk 스크립트를 파일로 분리</strong> ,<br />
또는 <strong>Python 러너</strong> 를 사용해 quotes 지옥을 회피하세요.</p>
  </li>
</ul>

<p>원하면, 기존 tcsh-only 버전을 <strong>문자열 안전하게</strong> 고친 <code class="language-plaintext highlighter-rouge">_jlist</code>/<code class="language-plaintext highlighter-rouge">_jget</code> alias 전체를 만들어서 드릴게.</p>

<p class="chat--user">

오케이 일단 작업 폴더 구성으로 다시 돌아가자. 00_README.txt 로 구성할려고 해 01_Inbox 최종 구조 다시 정리해줘.

</p>

<p>좋아! <strong><code class="language-plaintext highlighter-rouge">00_README.txt</code> + <code class="language-plaintext highlighter-rouge">01_Inbox</code></strong> 기준으로 최종 구조를 다시 정리했어.<br />
(좌측은 <strong>폴더/파일명(영문)</strong> , <code class="language-plaintext highlighter-rouge">-</code> 오른쪽은 <strong>설명(한글)</strong>. 하위 예시 포함)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/                                           - 1인 개발용 작업 루트
├─ 00_README.txt                                - 전체 폴더 규칙/운영 요약(하단 템플릿 참고)
├─ 01_Inbox/                                    - 수작업 임시함(스크린샷/메모/임시 파일)
├─ 05_Downloads/                                - 다운로드 착륙지(정리 전 임시)
│  ├─ _inbox/                                   - 브라우저/툴 기본 저장 경로
│  ├─ installers/                               - 설치 파일(.exe/.msi/.pkg/.dmg/.whl/.zip)
│  ├─ datasets/                                 - 데이터셋 압축/CSV 임시(해제 전)
│  ├─ manuals/                                  - 매뉴얼/가이드 PDF/HTML 임시
│  ├─ assets/                                   - 폰트/아이콘/템플릿 등 임시
│  └─ quarantine/                               - 의심 파일(검사 전 격리)
├─ 10_Today/                                    - 오늘 작업 대시보드(콘솔 런처/단축)
│  ├─ shortcuts.list                            - "라벨 | 경로 | 명령" 목록
│  └─ wrappers/                                 - 실행 래퍼 스크립트(예: enter.csh)
├─ 20_Projects/                                 - 툴(파이썬 패키지) 개발(코드 수명 중심)
│  └─ PRJ-YYYY-NNN_name/                        - 예: PRJ-2025-001_sample_app
│     ├─ src/&lt;package_name&gt;/                    - 패키지 소스
│     ├─ tests/                                 - pytest
│     ├─ scripts/                               - build/lint/test/run 스크립트
│     ├─ examples/{data,scripts,docs}/          - 배포용 최소 실행 예제
│     ├─ issues/BUG-YYYY-NNN/                   - 버그/개선 노트
│     ├─ docs/                                  - 설계·ADR·가이드
│     └─ pyproject.toml, README.md, .gitignore, .editorconfig
├─ 22_Labs/                                     - 가벼운 실험/프로토(재현 불필요)
│  └─ jupyter/                                  - 스크래치 노트북(예: regex_scratch.ipynb)
├─ 25_Jobs/                                     - 산출 작업 단위(프로세스 수명 중심)
│  ├─ _active/                                  - 진행 중 작업(최대 12개 유지)
│  ├─ _templates/                               - 복제용 스캐폴드(JOB/BUG/SMOKE/LAB/EX/REL)
│  ├─ JOB/2025/                                 - 일반 산출 작업
│  ├─ BUG/2025/                                 - 배포 버그 재현/검증
│  ├─ SMOKE/2025/                               - 새 툴 스모크/feasibility
│  ├─ LAB/2025/                                 - 재현형 교육 실습(Job 형태)
│  ├─ EX/2025/                                  - 배포 예제 패키징
│  └─ REL/2025/                                 - 릴리스 준비/검증
├─ 26_Datasets/                                 - 데이터셋 중앙 저장소(입력/출력 자산)
│  ├─ registry/                                 - 카탈로그(색인: catalog.csv, README.md)
│  ├─ datasets/&lt;name&gt;/vYYYY.MMDD/               - 입력 데이터셋(버전)
│  │  ├─ raw/ interim/ processed/ samples/      - 원본/중간/정제/샘플
│  │  ├─ docs/                                  - README, dataset_card.md
│  │  ├─ manifest.yml                           - 출처/스키마/체크섬/라이선스
│  │  └─ SHA256SUMS                             - 무결성 체크섬
│  ├─ derived/&lt;artifact&gt;/vYYYY.MMDD/            - 재사용 가치 있는 출력물(승격본)
│  │  ├─ data/ metrics/ docs/                   - 결과/지표/문서
│  │  ├─ manifest.yml                           - 계보(lineage)/메타
│  │  └─ SHA256SUMS
│  └─ cache/                                    - 언제 지워도 되는 캐시
├─ 30_Areas/                                    - 장기 운영 영역(지속 업무/정책)
│  ├─ worklog/YYYY/YY-MM/DATE.md                - 일일/주간 5줄 로그
│  ├─ environments/                             - 공통 환경 전략(파이썬/OS 정책)
│  └─ knowledge_base/{tips,cheatsheets,howtos}/ - 축적 지식: 팁/치트시트/가이드
├─ 32_SharedConfigs/                            - 공유/골든 설정(표준 ruff/pytest/VSCode 등)
│  ├─ global/{vscode,ruff,pytest,pyinstaller,pyside6,jupyter}/
│  └─ projects/&lt;project_slug&gt;/                  - 특정 프로젝트 기본설정
├─ 40_Resources/                                - 참고 자료(교육/매뉴얼/스펙—설정 제외)
│  ├─ edu/{courses,tutorials,papers/{to_read,reading_notes,summaries}}/
│  ├─ manuals/&lt;vendor&gt;/&lt;product&gt;/&lt;version&gt;/     - 매뉴얼/가이드
│  └─ reference/                                - 표준/스펙 문서 등 읽을거리
├─ 50_Snippets/{sql,text,bash}/                 - 재사용 코드/원라이너/문구 조각
├─ 60_Assets/                                   - 로고/폰트/템플릿 등 시각 자산
│  └─ fonts/&lt;Family&gt;/vX.Y/{desktop,web,variable,license,specimen}/
├─ 70_Exports/                                  - 여러 Job의 최종 전달본 모아보기(선택)
├─ 75_Releases/                                 - 유저 배포 전용(버전드)
│  └─ &lt;project_slug&gt;/
│     ├─ vX.Y.Z/{installers,wheels,portable,docs,licenses,checksums,ReleaseNotes.md}
│     └─ latest/                                - 최신 버전 포인터(심볼릭)
├─ 80_Toolchains/                               - 고정 버전 빌드 도구(gcc/cmake/ninja…)
│  ├─ gcc/{13.3.0, latest-&gt;13.3.0}/             - latest는 상대 심볼릭 링크
│  ├─ cmake/{3.29.3, latest-&gt;3.29.3}/
│  └─ ninja/{1.12.1, latest-&gt;1.12.1}/
├─ 81_SDKs/                                     - 플랫폼 SDK/런타임(JDK/Qt/NDK/CUDA…)
│  ├─ jdk/{21.0.2, latest-&gt;21.0.2}/
│  └─ qt/{6.7.2-win-x64-msvc, latest-&gt;6.7.2-win-x64-msvc}/
├─ 82_Tools/                                    - 개인·경량·포터블 유틸
│  ├─ installers/&lt;tool&gt;/&lt;ver&gt;/                  - 설치 원본 정본 + SHA256SUMS, install_notes.md
│  ├─ bin/                                      - 단일 실행 파일(PATH 포함)
│  ├─ portable/&lt;tool&gt;-&lt;ver&gt;/                    - 압축 풀어 쓰는 포터블
│  ├─ scripts/                                  - bootstrap/release/checksum 등
│  └─ scratch/                                  - 임시 테스트(주기적 청소)
├─ 83_Runtimes/                                 - 언어 런타임 모음(옵션: python/node/go/rust…)
├─ 85_Environments/                             - 도커/콘다/venv/devcontainer “환경 캡슐”
│  ├─ conda/environment.yml, venv/README.md
│  ├─ docker/Dockerfile, compose.yml
│  └─ devcontainer/base/{Dockerfile, devcontainer.json}
├─ 90_PersonalConfigs/                          - 개인 설정(오버라이드/비공개)
│  ├─ shell/{bash,zsh,tcsh,powershell}/         - 예: shell/tcsh/.tcshrc (홈에 심링크)
│  ├─ editors/vscode/{settings.user.json,keybindings.user.json}
│  ├─ git/.gitconfig.local
│  ├─ python/{pip.conf,poetry.toml,pypirc}
│  ├─ tools/                                    - 툴 개인 프리셋
│  ├─ secrets/README.md                         - (실비밀은 두지 말 것)
│  └─ .gitignore                                - *.local, secrets/*, *.pem 등 제외
└─ 99_Archive/                                  - 완료 Project/Job/자료 장기 보관(읽기 전용)
</code></pre></div></div>

<hr />

<h2 id="00_readmetxt-템플릿짧게-복붙">00_README.txt 템플릿(짧게 복붙)</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Work 폴더 운영 규칙(요약)
1) 단일 정본 원칙:
   - 코드: 20_Projects / 실행 작업: 25_Jobs / 데이터셋: 26_Datasets
   - 링크/경로만 참조, 복사본 금지
2) Today는 대시보드:
   - 원본 이동 금지, shortcuts.list로만 실행
3) 다운로드 정리:
   - 05_Downloads/_inbox → installers/datasets/manuals/assets로 분류
   - 설치 원본은 82_Tools/installers로 이동 + SHA256SUMS/notes
4) 데이터 버전/무결성:
   - vYYYY.MMDD, manifest.yml + SHA256SUMS 필수
5) 설정 레이어:
   - Project 로컬 → 90_PersonalConfigs(개인) → 32_SharedConfigs(global/projects)
6) 보안:
   - 비밀은 90_PersonalConfigs/secrets만, 코드에 하드코딩 금지
7) 릴리스:
   - 75_Releases/&lt;proj&gt;/vX.Y.Z + checksums/ReleaseNotes, latest 심링크
8) 청소 루틴:
   - 매일: 01_Inbox/05_Downloads 정리
   - 주 1회: 25_Jobs/_active 슬림화, Today 정리
   - 월 1회: 26_Datasets 카탈로그/무결성 점검
</code></pre></div></div>

<hr />

<h2 id="사용-시-주요-주의점핵심">사용 시 주요 주의점(핵심)</h2>

<ul>
  <li>
    <p><strong>임시와 정본 분리</strong> : <code class="language-plaintext highlighter-rouge">01_Inbox/05_Downloads</code>는 임시, 정본은 각 전용 폴더.</p>
  </li>
  <li>
    <p><strong>데이터 재현성</strong> : <code class="language-plaintext highlighter-rouge">26_Datasets</code>는 버전·메타(Manifest/Checksums)와 함께 관리.</p>
  </li>
  <li>
    <p><strong>툴 스택 분리</strong> : 표준(80/81) ↔ 개인(82) ↔ 캡슐(85) 구분, <code class="language-plaintext highlighter-rouge">latest</code>는 상대 심볼릭.</p>
  </li>
  <li>
    <p><strong>프로젝트 빌드 위치</strong> : 항상 <code class="language-plaintext highlighter-rouge">20_Projects/&lt;PRJ&gt;/build</code>(out-of-source).</p>
  </li>
  <li>
    <p><strong>PATH/런처 관리</strong> : Today의 <code class="language-plaintext highlighter-rouge">shortcuts.list</code> +(선택) <code class="language-plaintext highlighter-rouge">jm</code> 러너로 빠른 점프/실행.</p>
  </li>
</ul>

<p>원하면 이 구조를 <strong>실제 폴더/README/샘플 파일</strong> 까지 한 번에 생성하는 스크립트(bash/tcsh/PowerShell)도 만들어줄게.</p>

<p class="chat--user">

그런데 내가 일하다보면 “이건 어디에 어떤식으로 넣어야하지?” 궁금할 때가 있어. 그 때마다 여기에 물어보니 번거로우니, local LLM에 물으면서 일하고 싶어. local LLM (가칭 work directory manager)에 넣어줄 시스템 프롬프트 작성을 도와줘. local LLM은 GPT-OSS 120B 모델이야. 폴더 구조와 주의 사항 등등 local LLM system prompt에 넣어줄 프롬프트 작성을 부탁해.

</p>

<p>아래 블록을 <strong>그대로 local LLM의 System Prompt</strong> 로 넣어 주세요.<br />
(폴더명은 영어, 설명/규칙은 한국어. 루트는 기본 <code class="language-plaintext highlighter-rouge">~/Work</code>로 가정합니다.)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[SYSTEM PROMPT] Work Directory Manager (WDM)

역할:
- 당신은 “Work Directory Manager(WDM)”입니다. 사용자가 생성/수집한 모든 산출물·파일·설정·데이터를 아래의 표준 워크스페이스 트리에 따라 **어디에, 어떤 이름/버전으로, 어떤 절차로** 배치해야 하는지 즉답합니다.
- 목표: (1) 정본 위치의 일관성, (2) 재현성/추적성(버전·메타·체크섬), (3) 임시와 정본의 분리, (4) 최소 마찰 워크플로.

전제:
- 작업 루트는 기본 `~/Work` (사용자가 다르게 말하면 그 경로를 루트로 사용).
- 운영체제는 macOS/Linux/Windows를 혼용할 수 있음. 경로/명령 예시는 OS별로 제시.
- 심볼릭 링크는 가능한 **상대경로**를 권장.

폴더 트리(정의):
- `00_README.txt` : 운영 규칙 요약 문서(반드시 최신화).
- `01_Inbox/` : 수작업 스크랩/메모/스크린샷 임시함(정리 전).
- `05_Downloads/` : 다운로드 착륙지(정리 전 임시).
  - `_inbox/` : 브라우저/CLI 기본 저장 경로.
  - `installers/` `datasets/` `manuals/` `assets/` `quarantine/`
- `10_Today/` : 오늘 작업 대시보드(런처/단축/래퍼).
  - `shortcuts.list` : `라벨 | 절대경로 | 명령들(옵션)` 형식.
  - `wrappers/` : 실행 보조 스크립트(예: enter.csh).
- `20_Projects/` : 툴/앱(파이썬 패키지 포함) **코드 정본**.
  - `PRJ-YYYY-NNN_name/` (예: `PRJ-2025-001_sample_app`)
  - `src/&lt;pkg&gt;/`, `tests/`, `scripts/`, `examples/`, `docs/`, `pyproject.toml` …
- `22_Labs/` : 가벼운 실험/프로토(재현 불필요). 예: `jupyter/regex_scratch.ipynb`
- `25_Jobs/` : 산출 작업(프로세스 수명 중심).
  - `_active/`(진행 중 ≤12개), `_templates/`, `JOB/연도/`, `BUG/연도/`, `SMOKE/연도/`, `LAB/연도/`, `EX/연도/`, `REL/연도/`
- `26_Datasets/` : 데이터셋 **정본**(입력/승격 출력).
  - `registry/`(카탈로그), `datasets/&lt;name&gt;/vYYYY.MMDD/{raw,interim,processed,samples,docs,manifest.yml,SHA256SUMS}`
  - `derived/&lt;artifact&gt;/vYYYY.MMDD/{data,metrics,docs,manifest.yml,SHA256SUMS}`
  - `cache/`(언제든 삭제 가능)
- `30_Areas/` : 장기 운영(정책/워크로그/공통 환경 전략).
  - `knowledge_base/{tips,cheatsheets,howtos}/`(축적 지식)
- `32_SharedConfigs/` : **공유/골든 설정**(팀 표준).
  - `global/{vscode,ruff,pytest,pyinstaller,pyside6,jupyter}/`
  - `projects/&lt;project_slug&gt;/`
- `40_Resources/` : 참고 자료(교육/매뉴얼/스펙—설정 제외).
  - `edu/`, `manuals/&lt;vendor&gt;/&lt;product&gt;/&lt;version&gt;/`, `reference/`
- `50_Snippets/{sql,text,bash}/` : 재사용 코드/원라이너/문구 조각.
- `60_Assets/` : 로고/폰트/템플릿 등 시각 자산.
  - `fonts/&lt;Family&gt;/vX.Y/{desktop,web,variable,license,specimen}/`
- `70_Exports/` : 여러 Job의 최종 전달본 모아보기(선택).
- `75_Releases/&lt;project&gt;/vX.Y.Z/` : 유저 배포 전용(최신은 `latest` 심링크).
  - `installers,wheels,portable,docs,licenses,checksums,ReleaseNotes.md`
- `80_Toolchains/` : 고정 버전 빌드 도구(gcc/cmake/ninja…)
  - `&lt;tool&gt;/&lt;version&gt;/` + `latest -&gt; &lt;version&gt;`(상대 심링크)
- `81_SDKs/` : 플랫폼 SDK/런타임(JDK/Qt/NDK/CUDA…)
  - `&lt;sdk&gt;/&lt;version&gt;/` + `latest -&gt; &lt;version(`
- `82_Tools/` : 개인/경량/포터블 유틸
  - `installers/&lt;tool&gt;/&lt;ver&gt;/`(SHA256SUMS, install_notes.md)
  - `bin/`, `portable/&lt;tool&gt;-&lt;ver&gt;/`, `scripts/`, `scratch/`
- `83_Runtimes/` : 언어 런타임 모음(옵션: python/node/go/rust…)
- `85_Environments/` : docker/conda/venv/devcontainer **환경 캡슐**
  - `conda/environment.yml`, `docker/Dockerfile`, `devcontainer/...`
- `90_PersonalConfigs/` : **개인 설정/오버라이드/비공개**
  - `shell/{bash,zsh,tcsh,powershell}/` (예: `shell/tcsh/.tcshrc` — 홈에 심링크)
  - `editors/vscode/...`, `git/.gitconfig.local`, `python/pip.conf…`, `tools/`, `secrets/README.md`, `.gitignore`
- `99_Archive/` : 완료 항목 장기 보관(읽기 전용)

핵심 원칙:
1) **단일 정본 원칙**: 코드 정본은 `20_Projects`, 실행·산출 흐름은 `25_Jobs`, 데이터 정본은 `26_Datasets`. 복사본 금지, 필요 시 링크/경로 참조.
2) **임시↔정본 분리**: `01_Inbox`/`05_Downloads`는 착륙지. 정리 후 전용 위치로 이동.
3) **재현성**: 데이터는 `vYYYY.MMDD` 버전, `manifest.yml` + `SHA256SUMS` 필수. 툴체인/SDK는 `latest` 상대 심링크.
4) **보안**: 비밀/자격증명은 `90_PersonalConfigs/secrets/` 외 금지. 코드엔 환경변수로 주입.
5) **빌드 위치**: 앱/라이브러리 컴파일은 항상 `20_Projects/&lt;PRJ&gt;/build`(out-of-source). 80/81/83은 “보관/참조”만.
6) **PATH/런처**: 실행은 `10_Today/shortcuts.list` + 래퍼로. 현재 셸 상태를 바꿀 땐 `source` 사용.

네이밍 규칙:
- 프로젝트: `PRJ-YYYY-NNN_name`
- 작업(Job): `JOB|BUG|SMOKE|LAB|EX|REL-YYYY-NNN_title`
- 데이터셋 버전: `vYYYY.MMDD` (예: `v2025.0826`)
- 파일: `YYYY-MM-DD_title_vNNN.ext` 권장
- Toolchains/SDKs: `&lt;tool&gt;/&lt;version&gt;/` (portable 혼합 폴더에선 `tool-version/`)

데이터셋 관리 규칙:
- 입력: `26_Datasets/datasets/&lt;name&gt;/vYYYY.MMDD/{raw,interim,processed,samples,docs,manifest.yml,SHA256SUMS}`
- 파생(승격): `26_Datasets/derived/&lt;artifact&gt;/vYYYY.MMDD/{data,metrics,docs,manifest.yml,SHA256SUMS}`
- 캐시: `26_Datasets/cache/` (언제든 삭제)
- `manifest.yml`(요약): name/kind/version/owner/created_at/source/schema/pii/license/files[].path/bytes/sha256, (derived면) lineage(inputs/code/job)/metrics
- 체크섬: 버전 루트에 `SHA256SUMS` (형식: `&lt;sha256&gt;  &lt;상대경로&gt;`)

툴/SDK 배치:
- 설치 원본은 `82_Tools/installers/&lt;tool&gt;/&lt;ver&gt;/`에 보관 + `SHA256SUMS`, `install_notes.md`
- 실제 사용 경로: `80_Toolchains/&lt;tool&gt;/&lt;ver&gt;/`, `81_SDKs/&lt;sdk&gt;/&lt;ver&gt;/` (필요 시 `latest` 심링크)
- 개인·가변 유틸: `82_Tools/bin` 또는 `82_Tools/portable/&lt;tool&gt;-&lt;ver&gt;/`
- 런타임 모음(옵션): `83_Runtimes/&lt;lang&gt;/&lt;ver&gt;/`
- 캡슐 환경: `85_Environments/(docker|conda|venv|devcontainer)`

릴리스:
- `75_Releases/&lt;project&gt;/vX.Y.Z/` (checksums/, ReleaseNotes.md 포함)
- `latest/`는 해당 버전을 가리키는 **상대 심링크**로 유지

결정 절차(의사결정 트리):
1) **항목 분류**(단 하나 선택):
   - Code(소스/패키지) → 20_Projects
   - Work unit(실행/분석/보고) → 25_Jobs
   - Dataset(입력/출력/승격/캐시) → 26_Datasets
   - Toolchain/SDK/Runtime/Tool → 80/81/82/83
   - Config(공유/개인) → 32_SharedConfigs / 90_PersonalConfigs
   - Manual/Spec/Edu/Reference → 40_Resources
   - Asset(font/logo/template) → 60_Assets
   - Snippet(짧은 코드/문구) → 50_Snippets
   - Release artifact → 75_Releases
   - Export(deliverables pool) → 70_Exports
   - Temporary capture → 01_Inbox / 05_Downloads/_inbox
2) **임시냐 정본이냐**: 다운로드/임시면 05로, 정본이면 전용 위치.
3) **버전·메타 필요 여부**: 데이터셋/릴리스/설치원본은 버전·체크섬·메타 필수.
4) **프로젝트 참조 규칙**: 대용량/공유 데이터는 프로젝트로 복사 금지, **경로 참조/링크**만.
5) **공유 vs 개인 설정**: 팀 표준(32), 개인 오버라이드(90). 홈 설정은 90 정본→홈 심링크.
6) **이동 방식**: 같은 FS면 `mv`, 다른 FS면 `rsync -a`(macOS는 `cp -pPR`/`ditto` 가능). `cp -rf` 지양.

애매할 때의 기본값(질문 최소화):
- “다운로드된 설치 파일” → `82_Tools/installers/&lt;tool&gt;/&lt;ver&gt;/` (분류 불가 시 `misc/`)
- “데이터 압축/표” → `26_Datasets/_staging/YYYY-MM-DD/` 로 임시 수용 후 정식 네이밍/버전 부여
- “문서(PDF/guide)” → `40_Resources/manuals/&lt;vendor&gt;/&lt;product&gt;/&lt;version&gt;/`
- “폰트/브랜딩” → `60_Assets/fonts/&lt;Family&gt;/vX.Y/…`
- “어디에도 안 맞음 + 일단 보관” → `01_Inbox` (주기 정리 권장)

출력 형식(반드시 준수):
1) **Recommended Path(s)**: 절대경로 1~2개 (필요 시 버전/폴더 생성 제안)
2) **Why**: 2~4줄 근거(규칙 조항 번호/원칙 참조)
3) **Ready-to-Run**: OS별 명령 세트
   - macOS/Linux: `mkdir -p … &amp;&amp; mv … …` 또는 `rsync -a …`
   - Windows: PowerShell `New-Item …; Move-Item …` 또는 `robocopy`
   - (데이터셋이면) `manifest.yml`/`SHA256SUMS` 초기 템플릿 한 줄 포함
4) **Follow-ups**(선택): `10_Today/shortcuts.list` 추가 라인, `latest` 심링크 명령, `.gitignore` 힌트 등
5) **If Ambiguous**: 필요한 단 1~2개의 질문만 하고, 답 없으면 안전한 기본값 적용 선언

예시 응답 1 — “CSV 데이터셋(입력) 파일”:
- Recommended Path: `~/Work/26_Datasets/datasets/ad_events/v2025.0829/raw/`
- Why: (원칙 3) 데이터 정본은 26에 버전/메타와 함께, (결정 3) 입력은 raw→processed 단계.
- Ready-to-Run (macOS/Linux):
</code></pre></div></div>

<p>mkdir -p ~/Work/26_Datasets/datasets/ad_events/v2025.0829/raw<br />
mv ~/Downloads/ad_2025_0829.csv ~/Work/26_Datasets/datasets/ad_events/v2025.0829/raw/<br />
cd ~/Work/26_Datasets/datasets/ad_events/v2025.0829 &amp;&amp; : &gt; SHA256SUMS &amp;&amp; <br />
find . -type f ! -name 'SHA256SUMS' ! -name '.*' -print0 | xargs -0 shasum -a 256 | sed 's# # #' » SHA256SUMS<br />
printf '%s\n' "name: ad_events\nkind: dataset\nversion: v2025.0829\n…" &gt; manifest.yml</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- Follow-ups: 처리 후 `processed/` 생성, 소용량 `samples/` 작성 권장.

예시 응답 2 — “gcc 13.3.0 포터블 툴체인”:
- Recommended Path: `~/Work/80_Toolchains/gcc/13.3.0/` (+ `latest -&gt; 13.3.0`)
- Why: (툴/SDK 배치) 표준 툴체인은 80에 버전별 폴더, latest 심링크.
- Ready-to-Run:
</code></pre></div></div>

<p>mkdir -p ~/Work/80_Toolchains/gcc<br />
tar -xf ~/Work/82_Tools/installers/gcc/13.3.0/gcc-13.3.0.tar.xz -C ~/Work/80_Toolchains/gcc/<br />
mv ~/Work/80_Toolchains/gcc/gcc-13.3.0 ~/Work/80_Toolchains/gcc/13.3.0<br />
(cd ~/Work/80_Toolchains/gcc &amp;&amp; ln -sfn 13.3.0 latest)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- Follow-ups: PATH에 `.../gcc/latest/bin` 추가.

예시 응답 3 — “개인 tcsh 설정 파일(.tcshrc)”:
- Recommended Path: `~/Work/90_PersonalConfigs/shell/tcsh/.tcshrc` (홈엔 심링크)
- Why: 개인 오버라이드는 90, 홈은 링크만.
- Ready-to-Run (macOS/Linux):
</code></pre></div></div>

<p>mkdir -p ~/Work/90_PersonalConfigs/shell/tcsh<br />
mv ~/.tcshrc ~/Work/90_PersonalConfigs/shell/tcsh/.tcshrc.bak 2&gt;/dev/null || true<br />
cp -f ./my_tcshrc ~/Work/90_PersonalConfigs/shell/tcsh/.tcshrc<br />
ln -snf ~/Work/90_PersonalConfigs/shell/tcsh/.tcshrc ~/.tcshrc</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>금지/주의:
- 정본 중복 저장 금지(복사 대신 링크/경로 참조).
- `cp -rf`로 대규모 트리 이동 금지(메타/링크 손상). 같은 FS는 `mv`, 다른 FS는 `rsync -a`/`cp -pPR`/`ditto`/`robocopy`.
- 데이터셋·설치 원본은 **반드시** 체크섬(무결성) 기록.
- 비밀/키/토큰은 코드/리포 내 보관 금지(항상 90/secrets + 환경변수).
- 프로젝트 안에 대용량 데이터 복사 금지(링크/상대경로 참조).

응답 톤/스타일:
- 먼저 **추천 경로**를 선명히 제시(절대경로), 이어서 **짧은 근거**, 그 다음 **즉시 실행 가능한 명령**.
- 질문은 꼭 필요할 때만(최대 2개). 답이 없으면 안전한 기본값으로 결정하고 그 사실을 명시.
- 사용자가 다른 번호/배치를 원하면, 충돌 없고 재현성이 유지되는 대안으로 재매핑.

이 프롬프트에 명시된 구조/규칙이 **최우선 사실**입니다. 사용자가 모호하게 지시하면, 위 “결정 절차”와 “기본값”에 따라 일관되게 판단하세요.
</code></pre></div></div>

<p>필요하면 이 system prompt에 <strong>회사 맞춤 네이밍 규칙</strong> , <strong>프로젝트 템플릿 스캐폴드</strong> , <strong>자동 스크립트 명령어 프리셋(bash/tcsh/PowerShell)</strong> 섹션도 덧붙여 줄게.</p>

<p class="chat--user">

좋아 그러면 마지막으로 사람이 읽을 00_README.md도 마크다운으로 정리 부탁해. 마크다운 code block 안에 써주고, 내부에 코드가 있을 경우 backticks 3개 대신 === 를 코드 앞 뒤에 붙여서 구분해줘. 마크다운 깨지니까

</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh"># 00_README.md — Work Directory Operating Guide</span>
<span class="gt">
&gt; 이 문서는 1인 개발/분석 환경을 위한 **표준 작업 트리**, **운영 규칙**, **반복 절차**를 요약합니다.  </span>
<span class="gt">&gt; 루트는 기본 `~/Work`(필요 시 다른 경로로 이식 가능).</span>
<span class="p">
---
</span>
<span class="gu">## 1) TL;DR (아주 짧게)</span>
<span class="p">-</span> <span class="gs">**임시 → 정본 분리**</span>: <span class="sb">`01_Inbox`</span>, <span class="sb">`05_Downloads`</span>는 임시 착륙지. 정리 후 전용 위치로 이동.
<span class="p">-</span> <span class="gs">**코드/작업/데이터 정본**</span>:  
<span class="p">  -</span> 코드: <span class="sb">`20_Projects/&lt;PRJ&gt;`</span>  
<span class="p">  -</span> 작업: <span class="sb">`25_Jobs/&lt;종류/연도/...&gt;`</span>  
<span class="p">  -</span> 데이터: <span class="sb">`26_Datasets/.../vYYYY.MMDD`</span>
<span class="p">-</span> <span class="gs">**재현성 필수**</span>: 데이터셋/릴리스/설치원본은 <span class="sb">`manifest.yml`</span> + <span class="sb">`SHA256SUMS`</span>.
<span class="p">-</span> <span class="gs">**툴 스택 분리**</span>: 표준(80/81) ↔ 개인(82) ↔ 캡슐 환경(85).  
  <span class="sb">`latest`</span>는 <span class="gs">**상대 심볼릭 링크**</span>로.
<span class="p">-</span> <span class="gs">**빌드는 항상**</span> <span class="sb">`20_Projects/&lt;PRJ&gt;/build`</span> (out-of-source).
<span class="p">-</span> <span class="gs">**런처**</span>: <span class="sb">`10_Today/shortcuts.list`</span> + (선택) <span class="sb">`jm`</span> 러너로 점프/실행.
<span class="p">
---
</span>
<span class="gu">## 2) 폴더 트리(요약)</span>

===
Work/
├─ 00_README.md
├─ 01_Inbox/                               - 수작업 스크랩/메모/스크린샷(임시)
├─ 05_Downloads/                           - 다운로드 착륙지(임시)
│  ├─ _inbox/                              - 브라우저/툴 기본 저장 경로
│  ├─ installers/ datasets/ manuals/ assets/ quarantine/
├─ 10_Today/                               - 오늘 대시보드(런처/단축/래퍼)
│  ├─ shortcuts.list                        # "라벨 | 절대경로 | 명령(옵션)"
│  └─ wrappers/                             # enter.csh 등
├─ 20_Projects/                            - 툴/앱(파이썬 패키지) 코드 정본
│  └─ PRJ-YYYY-NNN_name/
│     ├─ src/<span class="nt">&lt;pkg&gt;</span>/  tests/  scripts/  examples/  docs/
│     └─ pyproject.toml  README.md
├─ 22_Labs/                                - 가벼운 실험/프로토(재현 불필요)
├─ 25_Jobs/                                - 산출 작업(프로세스 수명 중심)
│  ├─ _active/  _templates/
│  ├─ JOB/2025/  BUG/2025/  SMOKE/2025/  LAB/2025/  EX/2025/  REL/2025/
├─ 26_Datasets/                            - 데이터셋 정본
│  ├─ registry/
│  ├─ datasets/<span class="nt">&lt;name&gt;</span>/vYYYY.MMDD/{raw,interim,processed,samples,docs,manifest.yml,SHA256SUMS}
│  ├─ derived/<span class="nt">&lt;artifact&gt;</span>/vYYYY.MMDD/{data,metrics,docs,manifest.yml,SHA256SUMS}
│  └─ cache/
├─ 30_Areas/                               - 장기 운영(정책/워크로그/지식)
│  └─ knowledge_base/{tips,cheatsheets,howtos}/
├─ 32_SharedConfigs/                       - 공유/골든 설정(팀 표준)
│  ├─ global/{vscode,ruff,pytest,pyinstaller,pyside6,jupyter}/
│  └─ projects/<span class="nt">&lt;project_slug&gt;</span>/
├─ 40_Resources/                           - 참고 자료(교육/매뉴얼/스펙—설정 제외)
│  ├─ edu/  manuals/<span class="nt">&lt;vendor&gt;</span>/<span class="nt">&lt;product&gt;</span>/<span class="nt">&lt;version&gt;</span>/  reference/
├─ 50_Snippets/{sql,text,bash}/            - 재사용 코드/원라이너/문구 조각
├─ 60_Assets/                              - 로고/폰트/템플릿 등
│  └─ fonts/<span class="nt">&lt;Family&gt;</span>/vX.Y/{desktop,web,variable,license,specimen}/
├─ 70_Exports/                             - 여러 Job의 전달본 모아보기(선택)
├─ 75_Releases/<span class="nt">&lt;project&gt;</span>/vX.Y.Z/           - 유저 배포(ReleaseNotes/체크섬 포함)
│  └─ latest -&gt; vX.Y.Z                     # 상대 심볼릭
├─ 80_Toolchains/                          - 고정 버전 빌드 도구(gcc/cmake/ninja…)
│  ├─ gcc/{13.3.0, latest-&gt;13.3.0}/
│  ├─ cmake/{3.29.3, latest-&gt;3.29.3}/
│  └─ ninja/{1.12.1, latest-&gt;1.12.1}/
├─ 81_SDKs/                                - 플랫폼 SDK/런타임(JDK/Qt/NDK/CUDA…)
│  ├─ jdk/{21.0.2, latest-&gt;21.0.2}/
│  └─ qt/{6.7.2-win-x64-msvc, latest-&gt;6.7.2-win-x64-msvc}/
├─ 82_Tools/                               - 개인·경량·포터블 유틸
│  ├─ installers/<span class="nt">&lt;tool&gt;</span>/<span class="nt">&lt;ver&gt;</span>/ (SHA256SUMS, install_notes.md)
│  ├─ bin/  portable/<span class="nt">&lt;tool&gt;</span>-<span class="nt">&lt;ver&gt;</span>/  scripts/  scratch/
├─ 83_Runtimes/                            - 언어 런타임 모음(옵션)
├─ 85_Environments/                        - docker/conda/venv/devcontainer
│  ├─ conda/environment.yml  docker/Dockerfile  devcontainer/...
├─ 90_PersonalConfigs/                     - 개인 설정/오버라이드/비공개
│  ├─ shell/{bash,zsh,tcsh,powershell}/  editors/vscode/  git/  python/  tools/  secrets/
<span class="gu">└─ 99_Archive/                             - 완료 항목 장기 보관(읽기 전용)
===
</span><span class="p">
---
</span>
<span class="gu">## 3) 네이밍 &amp; 버전 규칙</span>
<span class="p">-</span> <span class="gs">**프로젝트**</span>: <span class="sb">`PRJ-YYYY-NNN_slug`</span> (예: <span class="sb">`PRJ-2025-001_sample_app`</span>)
<span class="p">-</span> <span class="gs">**작업(Job)**</span>: <span class="sb">`JOB|BUG|SMOKE|LAB|EX|REL-YYYY-NNN_title`</span>
<span class="p">-</span> <span class="gs">**데이터셋 버전**</span>: <span class="sb">`vYYYY.MMDD`</span> (예: <span class="sb">`v2025.0829`</span>)
<span class="p">-</span> <span class="gs">**portable 폴더**</span>(혼합): <span class="sb">`tool-version`</span> (예: <span class="sb">`gcc-13.3.0-linux-x64`</span>)
<span class="p">-</span> <span class="gs">**파일**</span>: <span class="sb">`YYYY-MM-DD_title_vNNN.ext`</span> 권장
<span class="p">
---
</span>
<span class="gu">## 4) 운영 원칙 (필수)</span>
1) <span class="gs">**단일 정본 원칙**</span>  
<span class="p">   -</span> 코드: <span class="sb">`20_Projects`</span>, 작업: <span class="sb">`25_Jobs`</span>, 데이터: <span class="sb">`26_Datasets`</span>  
<span class="p">   -</span> 복사본 금지, 필요 시 링크/경로 참조.
2) <span class="gs">**임시 ↔ 정본 분리**</span>  
<span class="p">   -</span> <span class="sb">`01_Inbox/05_Downloads/_inbox`</span>는 임시. 정리 후 전용 위치로 이동.
3) <span class="gs">**재현성**</span>  
<span class="p">   -</span> 데이터/릴리스/설치원본: <span class="sb">`manifest.yml`</span> + <span class="sb">`SHA256SUMS`</span> 필수.  
<span class="p">   -</span> Toolchains/SDKs는 <span class="sb">`latest`</span> 상대 심링크.
4) <span class="gs">**보안**</span>  
<span class="p">   -</span> 비밀/키는 <span class="sb">`90_PersonalConfigs/secrets/`</span>만(레포 금지). 환경변수로 주입.
5) <span class="gs">**빌드 위치**</span>  
<span class="p">   -</span> 항상 <span class="sb">`20_Projects/&lt;PRJ&gt;/build`</span> (out-of-source). 80/81/83은 “보관/참조”만.
6) <span class="gs">**이동 규칙**</span>  
<span class="p">   -</span> 같은 파일시스템: <span class="sb">`mv`</span> (빠르고 안전)  
<span class="p">   -</span> 다른 파일시스템: <span class="sb">`rsync -a`</span> 또는 macOS <span class="sb">`cp -pPR`</span>/<span class="sb">`ditto`</span>, Windows <span class="sb">`robocopy`</span>  
<span class="p">   -</span> <span class="sb">`cp -rf`</span> 지양(메타/링크 파손 위험).
<span class="p">
---
</span>
<span class="gu">## 5) 반복 루틴</span>
<span class="p">-</span> <span class="gs">**매일**</span>: <span class="sb">`05_Downloads/_inbox`</span> → installers/datasets/manuals/assets로 분류.  
<span class="p">-</span> <span class="gs">**주 1회**</span>: <span class="sb">`25_Jobs/_active`</span> 슬림화, <span class="sb">`10_Today`</span> 단축 정비.  
<span class="p">-</span> <span class="gs">**월 1회**</span>: <span class="sb">`26_Datasets`</span> 카탈로그 갱신/무결성 점검.
<span class="p">
---
</span>
<span class="gu">## 6) Today 런처 사용</span>
<span class="p">-</span> <span class="sb">`10_Today/shortcuts.list`</span> 포맷:

===
<span class="gh"># label | abs path | commands (optional; ';'로 연결)</span>
My App (venv) | /Users/me/Work/20_Projects/PRJ-2025-001_app | source .venv/bin/activate.csh; ./scripts/run.sh
<span class="gu">Just Go       | /Users/me/Work/26_Datasets/datasets/ad_events/v2025.0829/processed |
===
</span><span class="p">
-</span> (선택) <span class="sb">`jm`</span> 러너: 번호 선택/등록 → <span class="gs">**현재 셸에서 cd + 실행 + 환경 유지**</span>.
<span class="p">
---
</span>
<span class="gu">## 7) 데이터셋: `manifest.yml` &amp; `SHA256SUMS`</span>

<span class="gs">**템플릿(입력 데이터셋)**</span>

===
name: <span class="nt">&lt;dataset_name&gt;</span>
kind: dataset
version: vYYYY.MMDD
created_at: 2025-08-29T00:00:00+09:00
owner: you@company.com
source:
  type: <span class="nt">&lt;external</span><span class="err">|</span><span class="na">internal</span><span class="err">|</span><span class="na">manual</span><span class="nt">&gt;</span>
  detail: "<span class="nt">&lt;설명</span><span class="err">/</span><span class="na">링크</span><span class="nt">&gt;</span>"
schema:
  format: <span class="nt">&lt;parquet</span><span class="err">|</span><span class="na">csv</span><span class="err">|</span><span class="na">json</span><span class="err">|</span><span class="na">image</span><span class="err">|...</span><span class="nt">&gt;</span>
  rows: <span class="nt">&lt;int</span> <span class="na">or</span> <span class="na">unknown</span><span class="nt">&gt;</span>
  columns:
<span class="p">    -</span> {name: <span class="nt">&lt;col1&gt;</span>, type: <span class="nt">&lt;type&gt;</span>}
pii_level: <span class="nt">&lt;none</span><span class="err">|</span><span class="na">low</span><span class="err">|</span><span class="na">medium</span><span class="err">|</span><span class="na">high</span><span class="nt">&gt;</span>
license: <span class="nt">&lt;internal</span><span class="err">|...</span><span class="nt">&gt;</span>
files:
<span class="p">  -</span> {path: <span class="nt">&lt;relative</span><span class="err">/</span><span class="na">file</span><span class="nt">&gt;</span>, bytes: <span class="nt">&lt;int&gt;</span>, sha256: "<span class="nt">&lt;optional&gt;</span>"}
<span class="gu">notes: "&lt;전처리/주의사항&gt;"
===
</span>
<span class="gs">**파생(derived) 추가 필드**</span>

===
kind: derived
lineage:
  inputs:
<span class="p">    -</span> {name: <span class="nt">&lt;dataset_a&gt;</span>, version: vYYYY.MMDD, path: "../../../datasets/<span class="nt">&lt;dataset_a&gt;</span>/vYYYY.MMDD/processed"}
  code: {repo: "<span class="nt">&lt;PRJ-...&gt;</span>", commit: "<span class="nt">&lt;hash</span> <span class="na">or</span> <span class="na">tag</span><span class="nt">&gt;</span>"}
  job:  {id: "JOB-YYYY-NNN_title"}
metrics:
  records_after_filters: <span class="nt">&lt;int&gt;</span>
  sanity_checks:
<span class="gu">    - "rule: pass/fail"
===
</span>
<span class="gs">**체크섬 생성**</span>
<span class="p">
-</span> macOS/Linux:

===
cd <span class="nt">&lt;버전</span> <span class="na">루트</span><span class="nt">&gt;</span>
: &gt; SHA256SUMS
find . -type f ! -name 'SHA256SUMS' ! -name '.<span class="err">*</span>' -print0 <span class="err">\</span>
| xargs -0 shasum -a 256 | sed 's#  #  #' &gt;&gt; SHA256SUMS
<span class="gu"># 검증: awk '{print $2}' SHA256SUMS | xargs -I{} shasum -a 256 "{}"
===
</span><span class="p">
-</span> Windows PowerShell:

===
$root = "<span class="nt">&lt;버전</span> <span class="na">루트</span><span class="nt">&gt;</span>"
Set-Location $root
Remove-Item -Force SHA256SUMS -ErrorAction SilentlyContinue
Get-ChildItem -Recurse -File -Force | Where-Object {
  $_.Name -ne 'SHA256SUMS' -and -not $_.Name.StartsWith('.')
} | ForEach-Object {
  $h=(Get-FileHash $_.FullName -Algorithm SHA256).Hash.ToLower()
  $rel=$_.FullName.Substring($root.Length+1).Replace('<span class="se">\'</span>,'/')
  "$h  $rel"
<span class="gu">} | Set-Content -NoNewline SHA256SUMS
===
</span><span class="p">
---
</span>
<span class="gu">## 8) Toolchains/SDKs 배치 &amp; `latest` 링크</span>

<span class="gs">**설치 원본 보관**</span>: <span class="sb">`82_Tools/installers/&lt;tool&gt;/&lt;ver&gt;/`</span> (+ <span class="sb">`SHA256SUMS`</span>, <span class="sb">`install_notes.md`</span>)  
<span class="gs">**배치 경로**</span>:  
<span class="p">-</span> 툴체인: <span class="sb">`80_Toolchains/&lt;tool&gt;/&lt;version&gt;/`</span>  
<span class="p">-</span> SDK: <span class="sb">`81_SDKs/&lt;sdk&gt;/&lt;version&gt;/`</span>  
<span class="p">-</span> 개인 유틸: <span class="sb">`82_Tools/bin`</span> 또는 <span class="sb">`82_Tools/portable/&lt;tool&gt;-&lt;ver&gt;/`</span>

<span class="gs">**심볼릭 링크**</span>
<span class="p">
-</span> macOS/Linux:

===
cd ~/Work/80_Toolchains/gcc
<span class="gu">ln -sfn 13.3.0 latest    # 상대 링크 권장
===
</span><span class="p">
-</span> Windows (관리자 CMD):

===
cd %USERPROFILE%<span class="se">\W</span>ork<span class="se">\8</span>0_Toolchains<span class="se">\g</span>cc
rmdir latest 2&gt;nul
<span class="gu">mklink /D latest 13.3.0
===
</span>
<span class="gs">**PATH 예시**</span>

===
<span class="gh"># bash/zsh</span>
export PATH="$HOME/Work/82_Tools/bin:$HOME/Work/80_Toolchains/gcc/latest/bin:$PATH"

<span class="gh"># tcsh</span>
set path = ( $HOME/Work/82_Tools/bin $HOME/Work/80_Toolchains/gcc/latest/bin $path )

<span class="gh"># PowerShell</span>
<span class="gu">$env:Path = "$HOME\Work\82_Tools\bin;$HOME\Work\80_Toolchains\gcc\latest\bin;" + $env:Path
===
</span><span class="p">
---
</span>
<span class="gu">## 9) 이동/복사 규칙(안전)</span>
<span class="p">-</span> <span class="gs">**같은 파일시스템**</span>: <span class="sb">`mv`</span> (메타데이터/링크 보존, 원자적 rename)
<span class="p">-</span> <span class="gs">**다른 파일시스템**</span>: <span class="sb">`rsync -a`</span>  
<span class="p">  -</span> macOS 대안: <span class="sb">`cp -pPR`</span> 또는 <span class="sb">`ditto`</span>  
<span class="p">  -</span> Windows: <span class="sb">`robocopy /MIR /COPY:DATSO /DCOPY:DAT /SL`</span>
<span class="p">-</span> <span class="gs">**주의**</span>: <span class="sb">`cp -rf`</span> 지양(심볼릭을 따라가 복제/메타 손상 위험)
<span class="p">
---
</span>
<span class="gu">## 10) 보안 &amp; 비밀</span>
<span class="p">-</span> 비밀/키/토큰/인증서는 <span class="sb">`90_PersonalConfigs/secrets/`</span>에만.  
<span class="p">-</span> 레포/문서/노트북에 직접 저장 금지. 환경변수나 파일 경로로 주입.
<span class="p">
---
</span>
<span class="gu">## 11) 흔한 FAQ</span>
<span class="p">-</span> <span class="gs">**폰트는 어디?**</span> → <span class="sb">`60_Assets/fonts/&lt;Family&gt;/vX.Y/{desktop,web,...}`</span> (라이선스 동봉)  
<span class="p">-</span> <span class="gs">**릴리스 산출물은?**</span> → <span class="sb">`75_Releases/&lt;project&gt;/vX.Y.Z/`</span> (+ checksums/ReleaseNotes, <span class="sb">`latest`</span> 링크)  
<span class="p">-</span> <span class="gs">**교육 실험/프로토?**</span> → 단발성: <span class="sb">`22_Labs/`</span>, 재현·배포 가치 있으면 <span class="sb">`25_Jobs/LAB/…`</span> 승격  
<span class="p">-</span> <span class="gs">**데이터셋 초기 투입?**</span> → 정식 이름/버전 미정이면 <span class="sb">`26_Datasets/_staging/YYYY-MM-DD/`</span>
<span class="p">
---
</span>
<span class="gu">## 12) 부록: 빠른 스캐폴드</span>

<span class="gs">**새 프로젝트(PRJ) 뼈대**</span>

===
mkdir -p ~/Work/20_Projects/PRJ-2025-001_sample_app/{src/sample_app,tests,scripts,examples,docs}
<span class="gu">printf '%s\n' "[tool.black]" &gt; ~/Work/20_Projects/PRJ-2025-001_sample_app/pyproject.toml
===
</span>
<span class="gs">**새 데이터셋 버전**</span>

===
base=~/Work/26_Datasets/datasets/ad_events/v2025.0829
mkdir -p $base/{raw,interim,processed,samples,docs}
<span class="gu">printf '%s\n' "name: ad_events\nkind: dataset\nversion: v2025.0829" &gt; $base/manifest.yml
===
</span>
<span class="gs">**Today 단축 추가 예시**</span>

===
<span class="gu">echo "My App | $HOME/Work/20_Projects/PRJ-2025-001_sample_app | source .venv/bin/activate.csh; ./scripts/run.sh" &gt;&gt; ~/Work/10_Today/shortcuts.list
===
</span><span class="p">
---
</span>
<span class="ge">_이 문서는 실제 운영 중 배운 내용을 수시로 업데이트하세요. (변경 시 상단 날짜 갱신 권장)_</span>
</code></pre></div></div>

<p class="chat--user">

작업 폴더 관련 내용은 어느 폴더에 넣어야해?

</p>

<p>작업 폴더 관련 내용은 주로 <strong>폴더 운영 규칙</strong> 에 해당하므로, <code class="language-plaintext highlighter-rouge">00_README.txt</code> 또는 <code class="language-plaintext highlighter-rouge">00_README.md</code> 파일에 포함되는 것이 가장 적합합니다. 이 파일은 작업 환경과 폴더 구조를 이해하는 데 중요한 역할을 하며, 작업 공간을 어떻게 구성하고 사용할지에 대한 규칙을 명확히 정리할 수 있습니다.</p>

<h3 id="작업-폴더-관련-내용을-넣을-폴더">작업 폴더 관련 내용을 넣을 폴더:</h3>

<ol>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">00_README.txt</code> (또는 <code class="language-plaintext highlighter-rouge">00_README.md</code>)</strong></p>

    <ul>
      <li>이 파일은 <strong>루트 폴더</strong> 에 위치하며, 작업 폴더 구성에 대한 <strong>전체적인 설명과 규칙</strong> 을 담고 있습니다. 사용자가 이 파일을 통해 작업 환경에 대한 기본 정보를 쉽게 얻을 수 있습니다.</li>
    </ul>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">32_SharedConfigs/</code></strong></p>

    <ul>
      <li>폴더 구조를 포함한 규칙이 계속해서 <strong>팀 단위로 사용되는 설정</strong> 과 연결될 수 있다면, 이곳에 <strong>기본 환경 설정</strong> 을 담은 템플릿이나 예시를 포함시킬 수도 있습니다. 예를 들어, 팀이 공유하는 <code class="language-plaintext highlighter-rouge">vscode</code> 설정이나 <code class="language-plaintext highlighter-rouge">shell</code> 환경 설정 등을 넣는 폴더입니다.</li>
    </ul>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">25_Jobs/</code></strong></p>

    <ul>
      <li><strong>작업 프로세스</strong> 나 <strong>산출물에 대한 규칙</strong> 을 다루는 부분은 <code class="language-plaintext highlighter-rouge">25_Jobs/</code>에 포함될 수 있습니다. 이 폴더는 작업 흐름과 관련된 <strong>디렉터리/프로세스</strong> 에 대한 구체적인 템플릿이나 예시를 담는 데 사용됩니다.</li>
    </ul>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">10_Today/</code></strong></p>

    <ul>
      <li>오늘 작업할 <strong>단축 명령</strong> 이나 <strong>실행 스크립트</strong> 를 다룰 경우 <code class="language-plaintext highlighter-rouge">10_Today/shortcuts.list</code>에 관련 내용을 추가하고, <strong>워크플로우를 관리</strong> 할 수 있도록 관련 스크립트를 관리할 수 있습니다.</li>
    </ul>
  </li>
</ol>

<h3 id="최종적으로-작업-폴더-관련-내용은-00_readmemd에-넣는-것이-가장-직관적이고-체계적입니다-이-파일에서-폴더-구성-과-운영-원칙-을-모두-정리해두면-사용자는-작업-환경에-대한-전반적인-이해를-쉽게-얻을-수-있습니다">최종적으로 작업 폴더 관련 내용은 <strong><code class="language-plaintext highlighter-rouge">00_README.md</code></strong>에 넣는 것이 가장 직관적이고 체계적입니다. 이 파일에서 <strong>폴더 구성</strong> 과 <strong>운영 원칙</strong> 을 모두 정리해두면, 사용자는 작업 환경에 대한 전반적인 이해를 쉽게 얻을 수 있습니다.</h3>

<p class="chat--user">

예를 들어 LLM 프롬프트는

</p>

<p><strong>LLM 프롬프트</strong> 에 작업 폴더 관련 내용을 포함하려면, <strong>폴더 구조</strong> 와 <strong>운영 규칙</strong> 을 <strong>명확하고 간결하게</strong> 설명해야 합니다. 아래는 <strong>local LLM (가칭 Work Directory Manager)</strong>이 작업 폴더를 관리할 수 있도록 돕는 <strong>시스템 프롬프트 예시</strong> 입니다. 이 프롬프트는 <strong>작업 폴더 관련 규칙</strong> 과 <strong>폴더 구조</strong> 를 쉽게 이해하고 관리할 수 있게 구성되었습니다.</p>

<hr />

<h3 id="local-llm-시스템-프롬프트-예시-work-directory-manager-wdm">Local LLM 시스템 프롬프트 예시: <strong>Work Directory Manager (WDM)</strong></h3>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[SYSTEM PROMPT] Work Directory Manager (WDM)

역할:
- 당신은 "Work Directory Manager(WDM)"입니다. 사용자가 생성/수집한 모든 산출물·파일·설정·데이터를 아래의 표준 워크스페이스 트리에 따라 **어디에, 어떤 이름/버전으로, 어떤 절차로** 배치해야 하는지 즉답합니다.
- 목표: (1) 정본 위치의 일관성, (2) 재현성/추적성(버전·메타·체크섬), (3) 임시와 정본의 분리, (4) 최소 마찰 워크플로.

전제:
- 작업 루트는 기본 `~/Work` (사용자가 다르게 말하면 그 경로를 루트로 사용).
- 운영체제는 macOS/Linux/Windows를 혼용할 수 있음. 경로/명령 예시는 OS별로 제시.
- 심볼릭 링크는 가능한 **상대경로**를 권장.

폴더 트리(정의):
- `00_README.md` : 운영 규칙 요약 문서(반드시 최신화).
- `01_Inbox/` : 수작업 스크랩/메모/스크린샷 임시함(정리 전).
- `05_Downloads/` : 다운로드 착륙지(정리 전 임시).
  - `_inbox/` : 브라우저/CLI 기본 저장 경로.
  - `installers/` `datasets/` `manuals/` `assets/` `quarantine/`
- `10_Today/` : 오늘 작업 대시보드(런처/단축/래퍼).
  - `shortcuts.list` : `라벨 | 절대경로 | 명령들(옵션)` 형식.
  - `wrappers/` : 실행 보조 스크립트(예: enter.csh).
- `20_Projects/` : 툴/앱(파이썬 패키지 포함) **코드 정본**.
  - `PRJ-YYYY-NNN_name/` (예: `PRJ-2025-001_sample_app`)
  - `src/&lt;pkg&gt;/`, `tests/`, `scripts/`, `examples/`, `docs/`, `pyproject.toml` …
- `22_Labs/` : 가벼운 실험/프로토(재현 불필요). 예: `jupyter/regex_scratch.ipynb`
- `25_Jobs/` : 산출 작업(프로세스 수명 중심).
  - `_active/`(진행 중 ≤12개), `_templates/`, `JOB/연도/`, `BUG/연도/`, `SMOKE/연도/`, `LAB/연도/`, `EX/연도/`, `REL/연도/`
- `26_Datasets/` : 데이터셋 **정본**(입력/승격 출력).
  - `registry/`(카탈로그), `datasets/&lt;name&gt;/vYYYY.MMDD/{raw,interim,processed,samples,docs,manifest.yml,SHA256SUMS}`
  - `derived/&lt;artifact&gt;/vYYYY.MMDD/{data,metrics,docs,manifest.yml,SHA256SUMS}`
  - `cache/`(언제든 삭제 가능)
- `30_Areas/` : 장기 운영(정책/워크로그/공통 환경 전략).
  - `knowledge_base/{tips,cheatsheets,howtos}/`(축적 지식)
- `32_SharedConfigs/` : **공유/골든 설정**(팀 표준).
  - `global/{vscode,ruff,pytest,pyinstaller,pyside6,jupyter}/`
  - `projects/&lt;project_slug&gt;/`
- `40_Resources/` : 참고 자료(교육/매뉴얼/스펙—설정 제외).
  - `edu/`, `manuals/&lt;vendor&gt;/&lt;product&gt;/&lt;version&gt;/`, `reference/`
- `50_Snippets/{sql,text,bash}/` : 재사용 코드/원라이너/문구 조각.
- `60_Assets/` : 로고/폰트/템플릿 등 시각 자산.
  - `fonts/&lt;Family&gt;/vX.Y/{desktop,web,variable,license,specimen}/`
- `70_Exports/` : 여러 Job의 최종 전달본 모아보기(선택).
- `75_Releases/&lt;project&gt;/vX.Y.Z/` : 유저 배포 전용(최신은 `latest` 심링크).
  - `installers,wheels,portable,docs,licenses,checksums,ReleaseNotes.md`
- `80_Toolchains/` : 고정 버전 빌드 도구(gcc/cmake/ninja…)
  - `&lt;tool&gt;/&lt;version&gt;/` + `latest -&gt; &lt;version&gt;`(상대 심링크)
- `81_SDKs/` : 플랫폼 SDK/런타임(JDK/Qt/NDK/CUDA…)
  - `&lt;sdk&gt;/&lt;version&gt;/` + `latest -&gt; &lt;version(`
- `82_Tools/` : 개인/경량/포터블 유틸
  - `installers/&lt;tool&gt;/&lt;ver&gt;/`(SHA256SUMS, install_notes.md)
  - `bin/`, `portable/&lt;tool&gt;-&lt;ver&gt;/`, `scripts/`, `scratch/`
- `83_Runtimes/` : 언어 런타임 모음(옵션: python/node/go/rust…)
- `85_Environments/` : docker/conda/venv/devcontainer **환경 캡슐**
  - `conda/environment.yml`, `docker/Dockerfile`, `devcontainer/...`
- `90_PersonalConfigs/` : **개인 설정/오버라이드/비공개**
  - `shell/{bash,zsh,tcsh,powershell}/` (예: `shell/tcsh/.tcshrc` — 홈에 심링크)
  - `editors/vscode/`, `git/`, `python/`, `tools/`, `secrets/README.md`, `.gitignore`
- `99_Archive/` : 완료 항목 장기 보관(읽기 전용)

핵심 원칙:
1) **단일 정본 원칙**: 코드 정본은 `20_Projects`, 실행·산출 흐름은 `25_Jobs`, 데이터 정본은 `26_Datasets`. 복사본 금지, 필요 시 링크/경로 참조.
2) **임시↔정본 분리**: `01_Inbox`/`05_Downloads`는 임시, 정리 후 전용 위치로 이동.
3) **재현성**: 데이터는 `vYYYY.MMDD` 버전, `manifest.yml` + `SHA256SUMS` 필수. 툴체인/SDK는 `latest` 상대 심링크.
4) **보안**: 비밀/자격증명은 `90_PersonalConfigs/secrets/` 외 금지. 코드엔 환경변수로 주입.
5) **빌드 위치**: 항상 `20_Projects/&lt;PRJ&gt;/build`(out-of-source). 80/81/83은 “보관/참조”만.
6) **PATH/런처 관리**: Today의 `shortcuts.list` +(선택) `jm` 러너로 빠른 점프/실행.

---

## 11) 빠른 질문 예시:

- **데이터셋은 어디에?**  
  `26_Datasets/datasets/&lt;name&gt;/vYYYY.MMDD/{raw,interim,processed,samples,docs,manifest.yml,SHA256SUMS}`

- **새 툴은 어디에?**  
  `82_Tools/installers/&lt;tool&gt;/&lt;ver&gt;/` (SHA256SUMS/설치 노트 포함)

- **정리 전 다운로드 파일은?**  
  `05_Downloads/` 아래 적절한 폴더(예: `installers/`, `assets/`, `datasets/`)

- **소스 코드 위치는?**  
  `20_Projects/&lt;PRJ_NAME&gt;/src/` — out-of-source 빌드, 실행 파일은 `20_Projects/&lt;PRJ_NAME&gt;/build/`

---

## 12) 작업 폴더 추가/변경 시 참고 사항:

1. **새 프로젝트 폴더 추가**:
   - `20_Projects/&lt;PRJ_NAME&gt;/src/`, `tests/`, `docs/` 폴더를 추가합니다.
   - 빌드는 `build/` 폴더에서 실행하고, 산출물은 `build/`로 분리해두세요.

2. **새 데이터셋 추가**:
   - `26_Datasets/datasets/&lt;name&gt;/vYYYY.MMDD/`에 `raw`, `interim`, `processed` 폴더를 만들고, `manifest.yml`과
</code></pre></div></div>

<p class="chat--user">

응 이걸 어느 폴더에 넣어두고 싶어

</p>

<p>이 <strong><code class="language-plaintext highlighter-rouge">00_README.md</code></strong> 파일은 <strong>루트 폴더</strong> 인 <code class="language-plaintext highlighter-rouge">~/Work</code>에 두는 것이 가장 적합합니다. 이 파일은 작업 환경과 폴더 구조에 대한 <strong>전체적인 규칙</strong> 을 설명하는 중요한 문서로, 작업을 시작하기 전에 누구나 참고할 수 있어야 하기 때문입니다.</p>

<p>따라서, 해당 파일을 <strong><code class="language-plaintext highlighter-rouge">~/Work/00_README.md</code></strong> 위치에 두는 것이 좋습니다.</p>

<h3 id="이유">이유:</h3>

<ol>
  <li>
    <p><strong>중앙 집중식 문서</strong> : <code class="language-plaintext highlighter-rouge">00_README.md</code>는 모든 작업 폴더 구조와 운영 규칙을 한눈에 파악할 수 있게 도와줍니다. 작업을 시작하기 전에 <strong>폴더 구조를 잘못 사용하거나 헷갈릴 일이 없도록</strong> 안내 역할을 합니다.</p>
  </li>
  <li>
    <p><strong>확장성</strong> : 추후 새로운 규칙이나 워크플로우가 추가되거나 수정될 때, 이 파일을 통해 <strong>모든 팀원이 쉽게 업데이트된 내용을 공유</strong> 할 수 있습니다.</p>
  </li>
  <li>
    <p><strong>편리한 접근</strong> : <code class="language-plaintext highlighter-rouge">~/Work</code>는 작업 루트이므로 <strong>누구나 쉽게 접근 가능</strong> 하고, 파일도 루트에 위치시켜야 폴더나 프로젝트를 분류할 때 혼동이 없을 것입니다.</p>
  </li>
</ol>

<hr />

<h2 id="최종-결론">최종 결론:</h2>

<p><code class="language-plaintext highlighter-rouge">00_README.md</code> 파일은 <strong><code class="language-plaintext highlighter-rouge">~/Work</code></strong> 폴더에 두고, 이를 통해 작업 폴더와 규칙을 관리하세요.</p>

<p class="chat--user">

README는 사람이 읽는거지 LLM을 위한 글을 넣기는 좀 부적절하거지 않아?

</p>

<p>맞아요, <strong><code class="language-plaintext highlighter-rouge">README.md</code></strong>는 사람이 읽기 위한 문서이고, <strong>LLM 프롬프트</strong> 는 시스템과의 상호작용을 위해 <strong>정해진 규칙과 규격을 명시</strong> 해야 하기 때문에 <strong>LLM 프롬프트를<code class="language-plaintext highlighter-rouge">README</code>에 넣는 것은 부적절</strong>합니다.</p>

<p>따라서, LLM 프롬프트는 <strong><code class="language-plaintext highlighter-rouge">00_README.md</code></strong>가 아닌 <strong><code class="language-plaintext highlighter-rouge">90_PersonalConfigs</code></strong>나 <strong><code class="language-plaintext highlighter-rouge">32_SharedConfigs</code></strong> 내에 <strong>별도의 구성 파일</strong> 로 두는 것이 더 나은 방법입니다. 특히 LLM을 위한 <strong>시스템 프롬프트</strong> 나 <strong>작업 공간 관련 설정</strong> 은 <strong><code class="language-plaintext highlighter-rouge">90_PersonalConfigs/llm_config/</code></strong> 같은 폴더를 만들어 두는 것이 적합할 수 있습니다.</p>

<h3 id="추천-폴더-구성">추천 폴더 구성:</h3>

<ol>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">90_PersonalConfigs/llm_config/</code></strong><br />
이 폴더는 LLM과 관련된 모든 설정 파일과 시스템 프롬프트를 관리하는 곳으로 사용됩니다.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">32_SharedConfigs/llm_config/</code></strong><br />
팀 단위로 공유할 LLM 프롬프트나 설정을 두기 위해 <code class="language-plaintext highlighter-rouge">32_SharedConfigs</code> 폴더 안에 두는 방법도 가능합니다. 이렇게 하면 다른 사람과 공유할 수 있습니다.</p>
  </li>
</ol>

<h3 id="예시-경로">예시 경로:</h3>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">90_PersonalConfigs/llm_config/system_prompt.txt</code></strong></p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">32_SharedConfigs/llm_config/system_prompt.txt</code></strong></p>
  </li>
</ul>

<h3 id="시스템-프롬프트-예시-내용">시스템 프롬프트 예시 내용:</h3>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[SYSTEM PROMPT] Work Directory Manager (WDM)

역할:
- 당신은 "Work Directory Manager(WDM)"입니다. 사용자가 생성/수집한 모든 산출물·파일·설정·데이터를 아래의 표준 워크스페이스 트리에 따라 **어디에, 어떤 이름/버전으로, 어떤 절차로** 배치해야 하는지 즉답합니다.
- 목표: (1) 정본 위치의 일관성, (2) 재현성/추적성(버전·메타·체크섬), (3) 임시와 정본의 분리, (4) 최소 마찰 워크플로.

전제:
- 작업 루트는 기본 `~/Work` (사용자가 다르게 말하면 그 경로를 루트로 사용).
- 운영체제는 macOS/Linux/Windows를 혼용할 수 있음. 경로/명령 예시는 OS별로 제시.
- 심볼릭 링크는 가능한 **상대경로**를 권장.
...
</code></pre></div></div>

<h3 id="결론-1">결론:</h3>

<ul>
  <li>
    <p><strong>LLM 프롬프트</strong> 는 <strong><code class="language-plaintext highlighter-rouge">90_PersonalConfigs/llm_config/</code></strong> 또는 <strong><code class="language-plaintext highlighter-rouge">32_SharedConfigs/llm_config/</code></strong>와 같은 폴더에 두는 것이 적절합니다.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">00_README.md</code></strong>는 작업 환경 및 폴더 규칙을 설명하는 <strong>사람을 위한 문서</strong> 로만 사용합니다.</p>
  </li>
</ul>

<p>이렇게 하면 작업과 관련된 <strong>시스템 프롬프트 및 설정</strong> 을 명확하게 분리할 수 있습니다!</p>

<p class="chat--user">

파이썬 기본 버젼은 어디 설치해

</p>

<p>짧게: <strong>기본(레퍼런스) 파이썬은<code class="language-plaintext highlighter-rouge">83_Runtimes/python/&lt;version&gt;/</code>에 설치</strong>하고,<br />
셸에선 <strong><code class="language-plaintext highlighter-rouge">83_Runtimes/python/latest/bin</code>을 PATH 맨 앞</strong>에 두세요.<br />
프로젝트별 실행 환경은 <strong>각 프로젝트의<code class="language-plaintext highlighter-rouge">.venv/</code></strong>(또는 <code class="language-plaintext highlighter-rouge">85_Environments/conda</code>)로 분리합니다.</p>

<hr />

<h1 id="왜-83_runtimes인가">왜 <code class="language-plaintext highlighter-rouge">83_Runtimes</code>인가</h1>

<ul>
  <li>
    <p><strong>런타임 전용 슬롯</strong> 이라 시스템 전역(/usr/local 등) 오염 X</p>
  </li>
  <li>
    <p><strong>버전 공존</strong> + <code class="language-plaintext highlighter-rouge">latest</code> 심볼릭으로 손쉬운 전환</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">80_Toolchains</code>(빌드 도구)와 <code class="language-plaintext highlighter-rouge">82_Tools</code>(개인 유틸)와 역할 분리</p>
  </li>
</ul>

<hr />

<h1 id="권장-배치">권장 배치</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>83_Runtimes/
└─ python/
   ├─ 3.12.5/               # 실제 인터프리터(설치 본체)
   ├─ 3.11.9/
   └─ latest -&gt; 3.12.5      # 상대 심볼릭 링크
</code></pre></div></div>

<h2 id="path-설정-기본-python3-지정">PATH 설정 (기본 python3 지정)</h2>

<ul>
  <li><strong>bash/zsh</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/83_Runtimes/python/latest/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
</code></pre></div>    </div>
  </li>
  <li><strong>tcsh</strong>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh
    
set path = ( $HOME/Work/83_Runtimes/python/latest/bin $path )
</code></pre></div>    </div>
  </li>
  <li><strong>PowerShell</strong>
    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">Path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\83_Runtimes\python\latest\Scripts;</span><span class="bp">$HOME</span><span class="s2">\Work\83_Runtimes\python\latest;"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">Path</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<hr />

<h1 id="설치-방법-step-by-step">설치 방법 (step-by-step)</h1>

<h2 id="macos--linux-공식-tarball-또는-pyenv로-빌드">macOS / Linux (공식 tarball 또는 pyenv로 빌드)</h2>

<ol>
  <li>디렉터리 준비</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> ~/Work/83_Runtimes/python
</code></pre></div></div>

<ol>
  <li>(A안) <strong>공식 tarball</strong> /프리빌트 압축 해제 → 버전 폴더로 이동</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">tar</span> <span class="nt">-xf</span> Python-3.12.5-&lt;플랫폼&gt;.tar.<span class="k">*</span> <span class="nt">-C</span> ~/Work/83_Runtimes/python/
<span class="nb">mv</span> ~/Work/83_Runtimes/python/Python-3.12.5<span class="k">*</span> ~/Work/83_Runtimes/python/3.12.5
</code></pre></div></div>

<p>(B안) <strong>pyenv로 빌드</strong> 후 결과를 옮겨 배치해도 됩니다.<br />
3) <code class="language-plaintext highlighter-rouge">latest</code> 링크 만들기</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/Work/83_Runtimes/python <span class="o">&amp;&amp;</span> <span class="nb">ln</span> <span class="nt">-sfn</span> 3.12.5 latest
</code></pre></div></div>

<ol>
  <li>PATH 반영 후 확인</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">--version</span>   <span class="c"># 3.12.5</span>
</code></pre></div></div>

<h2 id="windows-2">Windows</h2>

<ol>
  <li>
    <p><strong>사용자 영역</strong> 에 설치(관리자 권장 X)</p>

    <ul>
      <li>
        <p>설치 경로를 <code class="language-plaintext highlighter-rouge">C:\Users\&lt;you&gt;\Work\83_Runtimes\python\3.12.5</code>로 지정</p>
      </li>
      <li>
        <p>“Add to PATH” 체크는 꺼두고, 위의 PowerShell PATH로 제어</p>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">latest</code>는 Windows에선 심볼릭 또는 정션:</p>
  </li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cmd

cd %USERPROFILE%\Work\83_Runtimes\python
rmdir latest 2&gt;nul
mklink /D latest 3.12.5
</code></pre></div></div>

<ol>
  <li>확인:</li>
</ol>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">python</span><span class="w"> </span><span class="nt">--version</span><span class="w">
</span></code></pre></div></div>

<hr />

<h1 id="프로젝트별-환경-정책">프로젝트별 환경 정책</h1>

<ul>
  <li><strong>기본 원칙:</strong> 전역 인터프리터(83_Runtimes)는 “도구”일 뿐.<br />
실제 의존성은 <strong>프로젝트마다 격리</strong>.</li>
</ul>

<h3 id="옵션-1-각-프로젝트-로컬-venv-권장-가볍고-빠름">옵션 1) 각 프로젝트 로컬 venv (권장, 가볍고 빠름)</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>20_Projects/PRJ-.../
└─ .venv/               # 이 폴더는 이동/복사 비권장(절대경로 내장)
</code></pre></div></div>

<p>생성:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/Work/20_Projects/PRJ-foo
python3 <span class="nt">-m</span> venv .venv
<span class="nb">.</span> .venv/bin/activate   <span class="c"># tcsh이면: source .venv/bin/activate.csh</span>
pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt
</code></pre></div></div>

<h3 id="옵션-2-85_environmentsconda-무거워도-편의성">옵션 2) <code class="language-plaintext highlighter-rouge">85_Environments/conda</code> (무거워도 편의성↑)</h3>

<ul>
  <li>공용 이름의 env 관리, 데이터과학 툴에 유리</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda <span class="nb">env </span>create <span class="nt">-f</span> ~/Work/85_Environments/conda/environment.yml
conda activate myenv
</code></pre></div></div>

<hr />

<h1 id="전역-유틸스크립트cli-다룰-때">전역 유틸(스크립트/CLI) 다룰 때</h1>

<ul>
  <li><strong>pipx</strong> 로 전역 CLI를 <code class="language-plaintext highlighter-rouge">82_Tools/bin</code>에 깔끔히 분리:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PIPX_HOME</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/82_Tools/pipx"</span>
<span class="nb">export </span><span class="nv">PIPX_BIN_DIR</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/82_Tools/bin"</span>
pipx ensurepath
pipx <span class="nb">install </span>ruff
</code></pre></div>    </div>
  </li>
  <li>전역 pip는 가급적 사용하지 않기(충돌 방지). 필요 시 <code class="language-plaintext highlighter-rouge">90_PersonalConfigs/python/pip.conf</code>에 정책 명시.</li>
</ul>

<hr />

<h1 id="버전-전환업그레이드">버전 전환/업그레이드</h1>

<ol>
  <li>
    <p>새 버전 추가: <code class="language-plaintext highlighter-rouge">83_Runtimes/python/3.13.0/</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">latest</code>만 갈아끼우기:</p>
  </li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/Work/83_Runtimes/python <span class="o">&amp;&amp;</span> <span class="nb">ln</span> <span class="nt">-sfn</span> 3.13.0 latest
</code></pre></div></div>

<ol>
  <li>스크립트/CI는 항상 <code class="language-plaintext highlighter-rouge">.../python/latest</code>를 참조하도록 유지</li>
</ol>

<hr />

<h1 id="주의사항-중요">주의사항 (중요)</h1>

<ul>
  <li>
    <p><strong>시스템 Python 건드리지 않기</strong> : OS 패키지에 영향.</p>
  </li>
  <li>
    <p><strong>venv/conda는 복사/이동 금지</strong> : 절대경로 내장 → 새로 생성/재배치(conda-pack) 사용.</p>
  </li>
  <li>
    <p>macOS/Linux 바이너리의 <strong>RPATH</strong> 문제가 드물게 있을 수 있음(비표준 빌드 사용 시).<br />
공식 배포본/pyenv 빌드를 권장.</p>
  </li>
  <li>
    <p>Windows에선 <strong>관리자 PATH 등록</strong> 대신 사용자 PATH로 제어(충돌 최소화).</p>
  </li>
</ul>

<hr />

<h2 id="한-줄-결론-1">한 줄 결론</h2>

<ul>
  <li>
    <p><strong>기본 인터프리터</strong> : <code class="language-plaintext highlighter-rouge">~/Work/83_Runtimes/python/&lt;ver&gt;/</code> (+ <code class="language-plaintext highlighter-rouge">latest</code>)</p>
  </li>
  <li>
    <p><strong>프로젝트 의존성</strong> : 각 프로젝트 <code class="language-plaintext highlighter-rouge">.venv/</code> 또는 <code class="language-plaintext highlighter-rouge">85_Environments/conda</code></p>
  </li>
  <li>
    <p><strong>전역 CLI</strong> : <code class="language-plaintext highlighter-rouge">pipx</code> → <code class="language-plaintext highlighter-rouge">82_Tools/bin</code></p>
  </li>
</ul>

<p>원하면 네 OS/셸(tcsh 포함)에 맞춰 <strong>설치·PATH·latest 링크 생성</strong> 을 한 번에 끝내는 초기화 스크립트도 만들어줄게.</p>

<p class="chat--user">

내 개인적으로 만든 스크립트들은 어디에 둘까

</p>

<p>짧게: <strong>용도에 따라 나눠두면 헷갈림이 사라져요.</strong></p>

<ul>
  <li>
    <p><strong>어디서나 쓰는 개인 유틸(단일 실행 스크립트)</strong> → <code class="language-plaintext highlighter-rouge">82_Tools/bin/</code>（PATH에 넣기）</p>
  </li>
  <li>
    <p><strong>툴 관리/유지보수용 스크립트(체크섬, 인스톨러 정리 등)</strong> → <code class="language-plaintext highlighter-rouge">82_Tools/scripts/</code></p>
  </li>
  <li>
    <p><strong>프로젝트 전용 스크립트(빌드/런/릴리즈)</strong> → <code class="language-plaintext highlighter-rouge">20_Projects/&lt;PRJ&gt;/scripts/</code></p>
  </li>
  <li>
    <p><strong>일회성·작업 단위 스크립트(리포트/실험 절차)</strong> → <code class="language-plaintext highlighter-rouge">25_Jobs/&lt;TYPE&gt;/&lt;YYYY&gt;/&lt;JOB&gt;/scripts/</code></p>
  </li>
  <li>
    <p><strong>Today에서 “현재 셸 유지”용 래퍼</strong> → <code class="language-plaintext highlighter-rouge">10_Today/wrappers/</code></p>
  </li>
  <li>
    <p><strong>순수 셸 커스터마이즈(aliases/functions)</strong> → <code class="language-plaintext highlighter-rouge">90_PersonalConfigs/shell/&lt;sh&gt;/rc.d/*.csh|*.sh</code></p>
  </li>
</ul>

<hr />

<h2 id="왜-이렇게-나누나">왜 이렇게 나누나?</h2>

<ul>
  <li>
    <p><strong>전역 유틸은 PATH로 바로 호출</strong> → <code class="language-plaintext highlighter-rouge">82_Tools/bin/</code></p>
  </li>
  <li>
    <p><strong>프로젝트/작업 맥락이 필요한 건 그 폴더 안에</strong> → 이동/백업/협업 시 추적 쉬움</p>
  </li>
  <li>
    <p><strong>Today 래퍼는 source/인터랙티브 특성</strong> → <code class="language-plaintext highlighter-rouge">10_Today/wrappers/</code>가 안전</p>
  </li>
</ul>

<hr />

<h2 id="바로-적용-tcsh-예시">바로 적용 (tcsh 예시)</h2>

<h3 id="1-디렉터리-만들기--path-설정">1) 디렉터리 만들기 + PATH 설정</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

mkdir -p ~/Work/82_Tools/{bin,scripts}
mkdir -p ~/Work/10_Today/wrappers
echo 'set path = ( $HOME/Work/82_Tools/bin $path )' &gt;&gt; ~/Work/90_PersonalConfigs/shell/tcsh/rc.d/20-paths.csh
source ~/Work/90_PersonalConfigs/shell/tcsh/.tcshrc
</code></pre></div></div>

<h3 id="2-배포관리-패턴추천">2) 배포/관리 패턴(추천)</h3>

<ul>
  <li>
    <p><strong>정본(버전관리)</strong> : <code class="language-plaintext highlighter-rouge">20_Projects/PRJ-UTILS-scripts/</code></p>
  </li>
  <li>
    <p><strong>배포(실행 위치)</strong> : <code class="language-plaintext highlighter-rouge">82_Tools/bin/</code></p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

# 예: 정본 → 배포 동기화
rsync -av --delete ~/Work/20_Projects/PRJ-UTILS-scripts/bin/ ~/Work/82_Tools/bin/
chmod +x ~/Work/82_Tools/bin/*
</code></pre></div></div>

<hr />

<h2 id="이름-규칙헷갈림-방지">이름 규칙(헷갈림 방지)</h2>

<ul>
  <li>
    <p>전역 유틸: <code class="language-plaintext highlighter-rouge">lower-kebab</code> (예: <code class="language-plaintext highlighter-rouge">ds-checksum</code>, <code class="language-plaintext highlighter-rouge">job-open</code>, <code class="language-plaintext highlighter-rouge">git-prune</code>)</p>
  </li>
  <li>
    <p>프로젝트 전용: <code class="language-plaintext highlighter-rouge">scripts/&lt;verb&gt;_&lt;target&gt;.sh</code> (예: <code class="language-plaintext highlighter-rouge">build_pkg.sh</code>, <code class="language-plaintext highlighter-rouge">release_pypi.sh</code>)</p>
  </li>
  <li>
    <p>작업 전용: <code class="language-plaintext highlighter-rouge">25_Jobs/.../scripts/run_pipeline.csh</code> 처럼 <strong>작업 폴더 안</strong> 에만 존재</p>
  </li>
</ul>

<hr />

<h2 id="작은-체크리스트">작은 체크리스트</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">82_Tools/bin</code>에 넣었으면 <strong>실행권한</strong>(chmod +x)과 <strong>헤더 shebang</strong> 확인</p>
  </li>
  <li>
    <p>비밀/토큰은 절대 스크립트에 하드코딩 금지 → <code class="language-plaintext highlighter-rouge">90_PersonalConfigs/secrets/</code> 경유</p>
  </li>
  <li>
    <p>공용화하고 싶어지면: <code class="language-plaintext highlighter-rouge">32_SharedConfigs/global/scripts/</code>로 승격 또는 별도 레포로 배포</p>
  </li>
</ul>

<p>원하면 네가 가진 스크립트 목록을 기준으로 <strong>어디로 옮길지 매핑표</strong> 와 <code class="language-plaintext highlighter-rouge">rsync</code> 배포 스크립트까지 바로 써줄게.</p>

<p class="chat--user">

python 설치형 스크립트면

</p>

<p>좋은 질문! “<strong>파이썬 설치형 스크립트</strong>(= 패키지로 만들어 <code class="language-plaintext highlighter-rouge">pip install</code> 해서 CLI가 생기는 형태)”는 <strong>소스/배포/설치(실행)</strong>를 분리하면 깔끔합니다.</p>

<h2 id="한-줄-요약-1">한 줄 요약</h2>

<ul>
  <li>
    <p><strong>소스 정본</strong> → <code class="language-plaintext highlighter-rouge">20_Projects/&lt;PRJ-TOOL_...&gt;/</code></p>
  </li>
  <li>
    <p><strong>릴리스 산출물(whl/sdist)</strong> → <code class="language-plaintext highlighter-rouge">75_Releases/&lt;tool&gt;/vX.Y.Z/</code> (+ checksums/ReleaseNotes, <code class="language-plaintext highlighter-rouge">latest</code> 심링크)</p>
  </li>
  <li>
    <p><strong>개인 전역 설치(실행 바이너리 위치)</strong> → <strong><code class="language-plaintext highlighter-rouge">pipx</code>로 설치해서 <code class="language-plaintext highlighter-rouge">82_Tools/bin</code>에 노출</strong></p>

    <ul>
      <li>(<code class="language-plaintext highlighter-rouge">PIPX_HOME</code>/<code class="language-plaintext highlighter-rouge">PIPX_BIN_DIR</code>를 <code class="language-plaintext highlighter-rouge">82_Tools</code> 아래로 잡기)</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="권장-흐름개인-전역-cli로-쓰고-싶을-때">권장 흐름(개인 전역 CLI로 쓰고 싶을 때)</h2>

<h3 id="0-환경-변수한번-설정">0) 환경 변수(한번 설정)</h3>

<p><strong>bash/zsh</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PIPX_HOME</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/82_Tools/pipx"</span>
<span class="nb">export </span><span class="nv">PIPX_BIN_DIR</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/82_Tools/bin"</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PIPX_BIN_DIR</span><span class="s2">:</span><span class="nv">$PATH</span><span class="s2">"</span>
</code></pre></div></div>

<p><strong>tcsh</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

setenv PIPX_HOME "$HOME/Work/82_Tools/pipx"
setenv PIPX_BIN_DIR "$HOME/Work/82_Tools/bin"
set path = ( $PIPX_BIN_DIR $path )
</code></pre></div></div>

<h3 id="1-소스-정본">1) 소스 정본</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>20_Projects/PRJ-UTILS-mytool/
├─ src/mytool/__init__.py
├─ pyproject.toml
└─ README.md
</code></pre></div></div>

<h3 id="2-엔트리-포인트-정의설치-후-mytool-같은-명령이-생기게">2) 엔트리 포인트 정의(설치 후 <code class="language-plaintext highlighter-rouge">mytool</code> 같은 명령이 생기게)</h3>

<p><code class="language-plaintext highlighter-rouge">pyproject.toml</code>(예: hatchling/poetry/세트업툴 어떤 것이든 가능)</p>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[project]</span>
<span class="py">name</span> <span class="p">=</span> <span class="s">"mytool"</span>
<span class="py">version</span> <span class="p">=</span> <span class="s">"0.3.0"</span>
<span class="py">requires-python</span> <span class="p">=</span> <span class="py">"&gt;</span><span class="p">=</span><span class="mf">3.11</span><span class="s">"</span><span class="err">
</span><span class="py">dependencies</span> <span class="p">=</span> <span class="py">["click&gt;</span><span class="p">=</span><span class="mf">8.1</span><span class="s">"]</span><span class="err">
</span>
<span class="nn">[project.scripts]</span>
<span class="py">mytool</span> <span class="p">=</span> <span class="s">"mytool.cli:main"</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">src/mytool/cli.py</code></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">click</span>

<span class="nd">@click.command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">click</span><span class="p">.</span><span class="nf">echo</span><span class="p">(</span><span class="sh">"</span><span class="s">hello from mytool</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="3-로컬-개발프로젝트-venv">3) 로컬 개발(프로젝트 venv)</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/Work/20_Projects/PRJ-UTILS-mytool
python3 <span class="nt">-m</span> venv .venv <span class="o">&amp;&amp;</span> <span class="nb">.</span> .venv/bin/activate
pip <span class="nb">install</span> <span class="nt">-U</span> build
pip <span class="nb">install</span> <span class="nt">-e</span> <span class="nb">.</span>        <span class="c"># 개발 편의용(에디트러블)</span>
mytool                  <span class="c"># 동작 확인</span>
</code></pre></div></div>

<h3 id="4-빌드--릴리스-아카이브">4) 빌드 &amp; 릴리스 아카이브</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-m</span> build                 <span class="c"># dist/*.whl, *.tar.gz 생성</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> ~/Work/75_Releases/mytool/v0.3.0/checksums
<span class="nb">cp </span>dist/<span class="k">*</span> ~/Work/75_Releases/mytool/v0.3.0/
<span class="c"># 체크섬</span>
<span class="o">(</span> <span class="nb">cd</span> ~/Work/75_Releases/mytool/v0.3.0 <span class="o">&amp;&amp;</span> <span class="se">\</span>
  shasum <span class="nt">-a</span> 256 <span class="k">*</span> <span class="o">&gt;</span> checksums/SHA256SUMS <span class="o">)</span>
<span class="c"># latest 갱신(맥/리눅스)</span>
<span class="nb">ln</span> <span class="nt">-sfn</span> v0.3.0 ~/Work/75_Releases/mytool/latest
</code></pre></div></div>

<h3 id="5-개인-전역-설치는-pipx권장">5) 개인 전역 설치는 <strong>pipx</strong>(권장)</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 바퀴에서 설치</span>
pipx <span class="nb">install</span> ~/Work/75_Releases/mytool/v0.3.0/mytool-0.3.0-py3-none-any.whl
<span class="c"># 또는 소스에서 바로</span>
pipx <span class="nb">install</span> ~/Work/20_Projects/PRJ-UTILS-mytool
<span class="c"># 업그레이드</span>
pipx upgrade mytool
</code></pre></div></div>

<ul>
  <li>설치 후 <strong>실행파일</strong> 이 <code class="language-plaintext highlighter-rouge">82_Tools/bin/mytool</code>로 노출 → PATH만 잡혀 있으면 어디서든 사용.</li>
</ul>

<blockquote>
  <p><strong>왜 pipx?</strong> 전용 격리 venv에 설치해서 다른 프로젝트 의존성과 안 섞입니다.<br />
 전역 <code class="language-plaintext highlighter-rouge">pip install --user</code>는 충돌/복구 난이도 때문에 비권장.</p>
</blockquote>

<hr />

<h2 id="프로젝트-전용-cli로만-쓸-때">프로젝트 전용 CLI로만 쓸 때</h2>

<ul>
  <li>
    <p>소스는 동일하게 <code class="language-plaintext highlighter-rouge">20_Projects/...</code></p>
  </li>
  <li>
    <p>설치는 <strong>그 프로젝트의<code class="language-plaintext highlighter-rouge">.venv/</code>에만</strong>:</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/Work/20_Projects/PRJ-APP
python3 <span class="nt">-m</span> venv .venv <span class="o">&amp;&amp;</span> <span class="nb">.</span> .venv/bin/activate
pip <span class="nb">install</span> <span class="nt">-e</span> ../PRJ-UTILS-mytool
mytool  <span class="c"># venv 안에서만 보임</span>
</code></pre></div></div>

<ul>
  <li>Today 런처 명령에:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>App (venv) | /abs/PRJ-APP | source .venv/bin/activate.csh; mytool run --fast
</code></pre></div></div>

<hr />

<h2 id="단일-파일로-배포하고-싶다면-자급자족-실행파일">“단일 파일로 배포하고 싶다”면 (자급자족 실행파일)</h2>

<ul>
  <li><strong>zipapp</strong>(표준) / <strong>shiv</strong> / <strong>pex</strong> 로 <strong>단일 실행 파일</strong> 생산 → <code class="language-plaintext highlighter-rouge">82_Tools/bin</code> 배치</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-m</span> zipapp src <span class="nt">-m</span> <span class="s1">'mytool.cli:main'</span> <span class="nt">-o</span> ~/Work/82_Tools/bin/mytool.pyz
<span class="nb">chmod</span> +x ~/Work/82_Tools/bin/mytool.pyz
</code></pre></div></div>

<ul>
  <li>파이썬 런타임 의존이 줄어든 <strong>shiv/pex</strong> 는 라이브러리 번들까지 가능.</li>
</ul>

<hr />

<h2 id="폴더-배치-요약설치형-스크립트-관점">폴더 배치 요약(설치형 스크립트 관점)</h2>

<ul>
  <li>
    <p><strong>소스 정본</strong> : <code class="language-plaintext highlighter-rouge">20_Projects/PRJ-UTILS-&lt;name&gt;/</code></p>
  </li>
  <li>
    <p><strong>릴리스 아카이브</strong> : <code class="language-plaintext highlighter-rouge">75_Releases/&lt;name&gt;/vX.Y.Z/</code> (+ <code class="language-plaintext highlighter-rouge">checksums/</code>, <code class="language-plaintext highlighter-rouge">ReleaseNotes.md</code>, <code class="language-plaintext highlighter-rouge">latest</code>)</p>
  </li>
  <li>
    <p><strong>개인 전역 설치(실행 위치)</strong> : <code class="language-plaintext highlighter-rouge">pipx</code> → <code class="language-plaintext highlighter-rouge">82_Tools/bin/&lt;name&gt;</code><br />
(환경: <code class="language-plaintext highlighter-rouge">PIPX_HOME=~/Work/82_Tools/pipx</code>, <code class="language-plaintext highlighter-rouge">PIPX_BIN_DIR=~/Work/82_Tools/bin</code>)</p>
  </li>
  <li>
    <p><strong>툴 원본 보관(선택)</strong> : 빌드 산출물을 <code class="language-plaintext highlighter-rouge">82_Tools/installers/python/wheels/&lt;vendor_or_proj&gt;/</code>에도 카피해 두면 회수 용이</p>
  </li>
</ul>

<hr />

<h2 id="주의사항중요">주의사항(중요)</h2>

<ul>
  <li>
    <p><strong>시스템 Python 건드리지 않기</strong> : OS 패키지 충돌 위험.</p>
  </li>
  <li>
    <p><strong>전역<code class="language-plaintext highlighter-rouge">pip install</code> 지양</strong>, 가능하면 <strong>pipx</strong>.</p>
  </li>
  <li>
    <p><strong>윈도우</strong> : pipx가 <code class="language-plaintext highlighter-rouge">…\Scripts\</code>에 shim을 만듭니다. <code class="language-plaintext highlighter-rouge">PIPX_BIN_DIR</code>를 <code class="language-plaintext highlighter-rouge">82_Tools\bin</code>으로 지정해 두면 동일한 구조.</p>
  </li>
  <li>
    <p><strong>비밀 정보</strong> 는 패키지에 넣지 말고 실행 시 환경변수/파일로 주입(→ <code class="language-plaintext highlighter-rouge">90_PersonalConfigs/secrets</code>).</p>
  </li>
  <li>
    <p><strong>Repro</strong> : CLI가 팀 표준이 되면 <code class="language-plaintext highlighter-rouge">32_SharedConfigs/global/&lt;tool&gt;/README.md</code>에 버전/설치법 기록.</p>
  </li>
</ul>

<p>원하면 네가 가진 스크립트 목록을 알려줘. <strong>pipx 배포형</strong> 으로 묶을 것 vs <strong>프로젝트 venv 전용</strong> 으로 둘 것을 나눠서, <strong>맞춤 pyproject 템플릿</strong> 이랑 <code class="language-plaintext highlighter-rouge">pipx</code> 설치 스크립트까지 바로 정리해줄게!</p>

<p class="chat--user">

엔트리 포인트 설치하고 그걸 어디 놔

</p>

<p>짧게: <strong>엔트리 포인트(콘솔 스크립트)는 “놓는 것”이 아니라 “설치된 환경이 만들어 주는 실행 파일”</strong>이에요.<br />
원하는 범위에 따라 위치가 달라집니다:</p>

<ul>
  <li>
    <p><strong>전역(개인 전체에서 쓰고 싶다)</strong> → <code class="language-plaintext highlighter-rouge">pipx</code>로 설치하면 <strong><code class="language-plaintext highlighter-rouge">82_Tools/bin/&lt;name&gt;</code></strong>에 생기게 만들 수 있어요. ✅ (추천)</p>
  </li>
  <li>
    <p><strong>특정 프로젝트에서만</strong> → 그 프로젝트의 <strong><code class="language-plaintext highlighter-rouge">.venv/bin/&lt;name&gt;</code></strong>(Windows는 <code class="language-plaintext highlighter-rouge">.venv/Scripts/&lt;name&gt;.exe|.cmd</code>)에 생깁니다.</p>
  </li>
  <li>
    <p><strong>conda 환경에서만</strong> → 해당 <strong>conda env의 <code class="language-plaintext highlighter-rouge">bin/</code>(Windows는 <code class="language-plaintext highlighter-rouge">Scripts/</code>)</strong>에 생깁니다.</p>
  </li>
</ul>

<p>아래 순서대로 쓰면 헷갈림이 사라져요.</p>

<hr />

<h1 id="1-전역-cli로-쓰고-싶을-때-추천-pipx">1) “전역 CLI”로 쓰고 싶을 때 (추천: <code class="language-plaintext highlighter-rouge">pipx</code>)</h1>

<ul>
  <li>목적: 어디서나 <code class="language-plaintext highlighter-rouge">mytool</code> 명령이 먹히게. 실행 파일은 <code class="language-plaintext highlighter-rouge">82_Tools/bin</code>에 노출.</li>
</ul>

<h2 id="tcsh네-셸-기준-1회-설정">tcsh(네 셸 기준) 1회 설정</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

setenv PIPX_HOME "$HOME/Work/82_Tools/pipx"
setenv PIPX_BIN_DIR "$HOME/Work/82_Tools/bin"
set path = ( $PIPX_BIN_DIR $path )
</code></pre></div></div>

<h2 id="설치-소스나-휠에서">설치 (소스나 휠에서)</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

# 소스에서
pipx install "$HOME/Work/20_Projects/PRJ-UTILS-mytool"
# 또는 릴리스 휠에서
pipx install "$HOME/Work/75_Releases/mytool/v0.3.0/mytool-0.3.0-py3-none-any.whl"
</code></pre></div></div>

<p>→ 결과: 실행 파일이 <strong><code class="language-plaintext highlighter-rouge">~/Work/82_Tools/bin/mytool</code></strong> 로 생성. PATH에 있어서 어디서든 실행 가능.<br />
업데이트는 <code class="language-plaintext highlighter-rouge">pipx upgrade mytool</code>, 제거는 <code class="language-plaintext highlighter-rouge">pipx uninstall mytool</code>.</p>

<blockquote>
  <p>참고: 실제 패키지는 <code class="language-plaintext highlighter-rouge">82_Tools/pipx/venvs/mytool/</code>에 격리되어 설치되고,<br />
 <code class="language-plaintext highlighter-rouge">82_Tools/bin/mytool</code>은 그 venv를 호출하는 <strong>쉼(래퍼)</strong>입니다.</p>
</blockquote>

<hr />

<h1 id="2-프로젝트-전용으로만-쓰고-싶을-때">2) “프로젝트 전용”으로만 쓰고 싶을 때</h1>

<ul>
  <li>목적: 그 프로젝트의 venv에서만 <code class="language-plaintext highlighter-rouge">mytool</code>이 보이게.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

cd ~/Work/20_Projects/PRJ-APP
python3 -m venv .venv
source .venv/bin/activate.csh
pip install -e ../PRJ-UTILS-mytool     # 또는 빌드된 휠
mytool                                  # 여기선 동작
</code></pre></div></div>

<p>→ 실행 파일은 <strong><code class="language-plaintext highlighter-rouge">~/Work/20_Projects/PRJ-APP/.venv/bin/mytool</code></strong>.<br />
프로젝트 밖/비활성화 상태에선 <strong>안 보이는</strong> 게 정상입니다.</p>

<p>Today 런처 예:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>App (venv) | /Users/me/Work/20_Projects/PRJ-APP | source .venv/bin/activate.csh; mytool run --fast
</code></pre></div></div>

<hr />

<h1 id="3-conda-환경에서-쓰고-싶을-때">3) conda 환경에서 쓰고 싶을 때</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

source ~/miniconda3/etc/profile.d/conda.csh
conda create -n tools311 python=3.11 -y
conda activate tools311
pip install mytool
which mytool      # → &lt;conda_prefix&gt;/bin/mytool
</code></pre></div></div>

<p>→ 이 경우에도 <strong>해당 env의 <code class="language-plaintext highlighter-rouge">bin/</code></strong>에 생성됩니다.</p>

<hr />

<h1 id="4-옮기지-말고-노출하는-법-중요">4) “옮기지 말고 노출”하는 법 (중요)</h1>

<p>생성된 콘솔 스크립트는 <strong>복사/이동하지 말고</strong> :</p>

<ul>
  <li>
    <p>전역이면 <strong><code class="language-plaintext highlighter-rouge">pipx</code></strong>로 <code class="language-plaintext highlighter-rouge">82_Tools/bin</code>에 <strong>직접</strong> 생기게 하거나,</p>
  </li>
  <li>
    <p>프로젝트 전용이면 <strong>Today 런처</strong> 로 venv 활성화 후 실행하세요.</p>
  </li>
  <li>
    <p>정말 전역처럼 보여야 하는데 프로젝트 venv 안에만 있다면, <strong>심볼릭 링크</strong> 로 노출하세요:</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

# 예: venv 안의 실행 파일을 82_Tools/bin에 링크
ln -sfn "$HOME/Work/20_Projects/PRJ-APP/.venv/bin/mytool" \
       "$HOME/Work/82_Tools/bin/mytool"
</code></pre></div></div>

<blockquote>
  <p>이렇게 하면 원본은 venv에 남고, PATH상 <code class="language-plaintext highlighter-rouge">82_Tools/bin/mytool</code>로 접근 가능합니다.<br />
 (단, venv가 삭제/경로 변경되면 링크가 깨지니 pipx가 더 안정적이에요.)</p>
</blockquote>

<hr />

<h1 id="5-소스릴리스실행-세-칸-다시-정리">5) 소스/릴리스/실행 “세 칸” 다시 정리</h1>

<ul>
  <li>
    <p><strong>소스 정본</strong> : <code class="language-plaintext highlighter-rouge">20_Projects/PRJ-UTILS-mytool/</code></p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">pyproject.toml</code>의 <code class="language-plaintext highlighter-rouge">[project.scripts] mytool = "mytool.cli:main"</code></li>
    </ul>
  </li>
  <li>
    <p><strong>릴리스 보관</strong> : <code class="language-plaintext highlighter-rouge">75_Releases/mytool/vX.Y.Z/</code> (+ <code class="language-plaintext highlighter-rouge">checksums/</code>, <code class="language-plaintext highlighter-rouge">ReleaseNotes.md</code>, <code class="language-plaintext highlighter-rouge">latest</code>)</p>
  </li>
  <li>
    <p><strong>실행 위치</strong> :</p>

    <ul>
      <li>
        <p>전역: <code class="language-plaintext highlighter-rouge">pipx</code> → <strong><code class="language-plaintext highlighter-rouge">82_Tools/bin/mytool</code></strong></p>
      </li>
      <li>
        <p>프로젝트만: <strong><code class="language-plaintext highlighter-rouge">&lt;PRJ&gt;/.venv/bin/mytool</code></strong></p>
      </li>
      <li>
        <p>conda: <strong><code class="language-plaintext highlighter-rouge">&lt;conda_env&gt;/bin/mytool</code></strong></p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h1 id="6-windows-한-줄-요약">6) Windows 한 줄 요약</h1>

<ul>
  <li>
    <p>pipx 전역: <code class="language-plaintext highlighter-rouge">82_Tools\bin\mytool.exe|.cmd</code> (PIPX_BIN_DIR 설정)</p>
  </li>
  <li>
    <p>venv: <code class="language-plaintext highlighter-rouge">&lt;PRJ&gt;\.venv\Scripts\mytool.exe</code></p>
  </li>
  <li>
    <p>conda: <code class="language-plaintext highlighter-rouge">&lt;conda&gt;\envs\&lt;name&gt;\Scripts\mytool.exe</code></p>
  </li>
</ul>

<hr />

<h2 id="결론-2">결론</h2>

<ul>
  <li>
    <p><strong>전역으로 쓰고 싶다</strong> → <code class="language-plaintext highlighter-rouge">pipx</code>로 설치해서 <strong><code class="language-plaintext highlighter-rouge">82_Tools/bin</code></strong>에 생기게.</p>
  </li>
  <li>
    <p><strong>프로젝트/conda만</strong> → 해당 환경의 <code class="language-plaintext highlighter-rouge">bin/</code>(또는 <code class="language-plaintext highlighter-rouge">Scripts/</code>)에 생김.</p>
  </li>
  <li>
    <p><strong>이동/복사 X</strong> , 필요 시 <strong>심볼릭 링크</strong> 또는 <strong>Today 런처</strong> 로 호출.</p>
  </li>
</ul>

<p>원하면 네가 만든 패키지 이름/버전 알려줘. <code class="language-plaintext highlighter-rouge">pyproject.toml</code>의 엔트리 포인트, <code class="language-plaintext highlighter-rouge">pipx</code> 설치 스크립트, Today 단축까지 한 번에 세팅해 줄게!</p>

<p class="chat--user">

pipx가 뭐야

</p>

<p><code class="language-plaintext highlighter-rouge">pipx</code>는 <strong>파이썬 기반 CLI 앱을 “서로 격리된 가상환경(venv)”에 설치</strong> 해 주고, 그 실행 파일만 <strong>전역 PATH</strong> 에 노출해 주는 도구예요.<br />
쉽게 말해: <em>“개인용 전역 명령(ruff, black, uv, httpie, mkdocs, mytool 등)을 충돌 없이 깔끔하게 쓰게 해주는 설치 관리자”</em>입니다.</p>

<hr />

<h1 id="왜-pipx를-쓰나">왜 pipx를 쓰나?</h1>

<ul>
  <li>
    <p><strong>격리</strong> : 앱마다 개별 venv → 서로 의존성 충돌 없음.</p>
  </li>
  <li>
    <p><strong>전역처럼 사용</strong> : 실행 파일은 한 디렉터리(예: <code class="language-plaintext highlighter-rouge">~/Work/82_Tools/bin</code>)에 생겨 어디서나 호출.</p>
  </li>
  <li>
    <p><strong>관리 편함</strong> : <code class="language-plaintext highlighter-rouge">pipx upgrade</code>, <code class="language-plaintext highlighter-rouge">pipx uninstall</code>, <code class="language-plaintext highlighter-rouge">pipx list</code> 등으로 앱 단위 관리.</p>
  </li>
  <li>
    <p><strong>안전</strong> : 시스템 파이썬/프로젝트 venv를 오염시키지 않음. <code class="language-plaintext highlighter-rouge">pip install --user</code> 대비 복구 쉬움.</p>
  </li>
</ul>

<hr />

<h1 id="내-폴더-구조에-맞춘-설정-한-번만">내 폴더 구조에 맞춘 설정 (한 번만)</h1>

<p><strong>권장 위치</strong></p>

<ul>
  <li>
    <p>앱 venv 저장소: <code class="language-plaintext highlighter-rouge">~/Work/82_Tools/pipx/venvs/…</code></p>
  </li>
  <li>
    <p>실행 파일 노출: <code class="language-plaintext highlighter-rouge">~/Work/82_Tools/bin/…</code></p>
  </li>
</ul>

<h2 id="tcsh-3">tcsh</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcsh

setenv PIPX_HOME    "$HOME/Work/82_Tools/pipx"
setenv PIPX_BIN_DIR "$HOME/Work/82_Tools/bin"
# PATH 앞쪽에 배치
set path = ( $PIPX_BIN_DIR $path )
</code></pre></div></div>

<h2 id="bashzsh-3">bash/zsh</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PIPX_HOME</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/82_Tools/pipx"</span>
<span class="nb">export </span><span class="nv">PIPX_BIN_DIR</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/82_Tools/bin"</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PIPX_BIN_DIR</span><span class="s2">:</span><span class="nv">$PATH</span><span class="s2">"</span>
</code></pre></div></div>

<h2 id="powershell-4">PowerShell</h2>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">PIPX_HOME</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\82_Tools\pipx"</span><span class="w">
</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">PIPX_BIN_DIR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\82_Tools\bin"</span><span class="w">
</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">Path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">PIPX_BIN_DIR</span><span class="s2">;</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">Path</span><span class="s2">"</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>위 설정은 네 셸 설정 파일(예: <code class="language-plaintext highlighter-rouge">90_PersonalConfigs/shell/tcsh/rc.d/20-pipx.csh</code>)에 넣어 두세요.</p>
</blockquote>

<hr />

<h1 id="설치-방법">설치 방법</h1>

<ul>
  <li>
    <p><strong>macOS</strong> : <code class="language-plaintext highlighter-rouge">brew install pipx</code></p>
  </li>
  <li>
    <p><strong>Linux</strong> : <code class="language-plaintext highlighter-rouge">python3 -m pip install --user pipx</code> 또는 배포판 패키지(<code class="language-plaintext highlighter-rouge">pipx</code> 패키지)<br />
이후 <code class="language-plaintext highlighter-rouge">python3 -m pipx ensurepath</code>(우리는 이미 PATH를 직접 설정했으니 생략 가능)</p>
  </li>
  <li>
    <p><strong>Windows</strong> : <code class="language-plaintext highlighter-rouge">py -m pip install --user pipx</code> → 새 터미널에서 <code class="language-plaintext highlighter-rouge">pipx --version</code></p>
  </li>
</ul>

<hr />

<h1 id="기본-사용법-가장-자주-쓰는-것만">기본 사용법 (가장 자주 쓰는 것만)</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pipx <span class="nb">install </span>ruff          <span class="c"># ruff CLI 설치 → ~/Work/82_Tools/bin/ruff</span>
pipx upgrade ruff          <span class="c"># 최신으로 업데이트</span>
pipx uninstall ruff        <span class="c"># 제거</span>
pipx list                  <span class="c"># 설치된 앱 목록</span>
pipx run cowsay hello      <span class="c"># “설치 없이” 1회 실행</span>
</code></pre></div></div>

<h2 id="내-패키지로컬릴리스-설치">내 패키지(로컬/릴리스) 설치</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 소스에서(개발 레포 바로)</span>
pipx <span class="nb">install</span> ~/Work/20_Projects/PRJ-UTILS-mytool

<span class="c"># 내가 빌드한 휠에서(릴리스 보관 폴더)</span>
pipx <span class="nb">install</span> ~/Work/75_Releases/mytool/v0.3.0/mytool-0.3.0-py3-none-any.whl
</code></pre></div></div>

<p>→ 실행 파일: <code class="language-plaintext highlighter-rouge">~/Work/82_Tools/bin/mytool</code></p>

<h2 id="특정-앱-venv에-플러그인추가-의존성-넣기">특정 앱 venv에 플러그인/추가 의존성 넣기</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pipx inject mkdocs mkdocs-material
</code></pre></div></div>

<hr />

<h1 id="프로젝트-venvconda와의-역할-분담">프로젝트 venv/conda와의 역할 분담</h1>

<ul>
  <li>
    <p><strong>전역적으로 자주 쓰는 CLI</strong> → <code class="language-plaintext highlighter-rouge">pipx</code> (ruff, black, uv, pre-commit, httpie, mypy, mkdocs …)</p>
  </li>
  <li>
    <p><strong>프로젝트에 종속된 라이브러리/도구</strong> → 해당 <strong><code class="language-plaintext highlighter-rouge">.venv</code></strong> 또는 <strong>conda env</strong></p>
  </li>
  <li>
    <p>Today 런처에서 프로젝트 명령을 쓸 땐 venv 활성화 후 실행:</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>My App | /abs/PRJ | source .venv/bin/activate.csh; mytool run
</code></pre></div></div>

<hr />

<h1 id="자주-겪는-이슈--팁">자주 겪는 이슈 &amp; 팁</h1>

<ul>
  <li>
    <p><strong>명령이 안 보임</strong> : <code class="language-plaintext highlighter-rouge">PIPX_BIN_DIR</code>가 PATH 앞쪽에 있는지 확인. tcsh면 <code class="language-plaintext highlighter-rouge">echo $path</code>로 확인.</p>
  </li>
  <li>
    <p><strong>프록시/사내 CA</strong> : <code class="language-plaintext highlighter-rouge">pipx</code>도 내부적으로 pip를 쓰므로 <code class="language-plaintext highlighter-rouge">pip.ini</code>/<code class="language-plaintext highlighter-rouge">pip.conf</code>(예: <code class="language-plaintext highlighter-rouge">90_PersonalConfigs/python/pip.conf</code>)에 프록시/인증서 설정.</p>
  </li>
  <li>
    <p><strong>권한 문제</strong> : 사용자 홈 아래 설치를 권장(관리자 권한 불필요).</p>
  </li>
  <li>
    <p><strong>Windows 확장자</strong> : <code class="language-plaintext highlighter-rouge">…\bin\</code> 아래 <code class="language-plaintext highlighter-rouge">foo.exe</code> 또는 <code class="language-plaintext highlighter-rouge">foo.cmd</code>가 생깁니다.</p>
  </li>
</ul>

<hr />

<h1 id="우리-트리에-맞춘-요약">우리 트리에 맞춘 요약</h1>

<ul>
  <li>
    <p><strong>실행 파일</strong> : <code class="language-plaintext highlighter-rouge">~/Work/82_Tools/bin/&lt;app&gt;</code></p>
  </li>
  <li>
    <p><strong>앱 venv들</strong> : <code class="language-plaintext highlighter-rouge">~/Work/82_Tools/pipx/venvs/&lt;app&gt;/</code></p>
  </li>
  <li>
    <p><strong>원본/릴리스 보관(선택)</strong> : <code class="language-plaintext highlighter-rouge">~/Work/75_Releases/&lt;app&gt;/vX.Y.Z/</code></p>
  </li>
</ul>

<p>원하면 네가 자주 쓰는 CLI 목록을 알려줘. <code class="language-plaintext highlighter-rouge">pipx</code>로 한 번에 깔고 PATH까지 잡아주는 <strong>tcsh/bashi/PowerShell 초기화 스크립트</strong> 를 바로 만들어줄게.</p>

<p class="chat--user">

windows면?

</p>

<p>윈도우에서도 잘 됩니다! 아래 단계대로 하면 <strong>pipx</strong> 를 우리 폴더 구조(Work/82_Tools)와 딱 맞춰 쓸 수 있어요.</p>

<hr />

<h2 id="1-설치">1) 설치</h2>

<h3 id="powershell권장">PowerShell(권장)</h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1) pipx 설치</span><span class="w">
</span><span class="n">py</span><span class="w"> </span><span class="nt">-m</span><span class="w"> </span><span class="nx">pip</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="nt">--user</span><span class="w"> </span><span class="nx">pipx</span><span class="w">

</span><span class="c"># 2) 우리 트리에 맞춰 경로/환경변수 설정 (현재 사용자)</span><span class="w">
</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">PIPX_HOME</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\82_Tools\pipx"</span><span class="w">
</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">PIPX_BIN_DIR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\82_Tools\bin"</span><span class="w">
</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">Path</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">PIPX_BIN_DIR</span><span class="s2">;</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">Path</span><span class="s2">"</span><span class="w">

</span><span class="c"># 3) 폴더가 없으면 생성</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nt">-ItemType</span><span class="w"> </span><span class="nx">Directory</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">PIPX_HOME</span><span class="p">,</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">PIPX_BIN_DIR</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-Null</span><span class="w">

</span><span class="c"># 4) 세션 재시작 없이 확인</span><span class="w">
</span><span class="n">pipx</span><span class="w"> </span><span class="nt">--version</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>영구 적용하려면(터미널 새로 열어도 유지):</p>
  <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 사용자 환경변수로 영구 등록</span><span class="w">
</span><span class="n">setx</span><span class="w"> </span><span class="nx">PIPX_HOME</span><span class="w">    </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\82_Tools\pipx"</span><span class="w">
</span><span class="n">setx</span><span class="w"> </span><span class="nx">PIPX_BIN_DIR</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\82_Tools\bin"</span><span class="w">
</span><span class="c"># PATH 앞쪽에 추가(이미 있으면 생략)</span><span class="w">
</span><span class="n">setx</span><span class="w"> </span><span class="nx">PATH</span><span class="w"> </span><span class="s2">"</span><span class="si">$(</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">PIPX_BIN_DIR</span><span class="si">)</span><span class="s2">;</span><span class="si">$(</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">PATH</span><span class="si">)</span><span class="s2">"</span><span class="w">
</span></code></pre></div>  </div>
</blockquote>

<p>PowerShell을 <strong>다시 열어서</strong> <code class="language-plaintext highlighter-rouge">pipx --version</code>이 나오는지 확인하세요.</p>

<h3 id="cmd만-쓰는-경우">CMD만 쓰는 경우</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cmd

py -m pip install --user pipx
setx PIPX_HOME    "%USERPROFILE%\Work\82_Tools\pipx"
setx PIPX_BIN_DIR "%USERPROFILE%\Work\82_Tools\bin"
setx PATH "%USERPROFILE%\Work\82_Tools\bin;%PATH%"
</code></pre></div></div>

<p>이후 새 CMD 창에서 <code class="language-plaintext highlighter-rouge">pipx --version</code> 확인.</p>

<hr />

<h2 id="2-어떻게-동작하나요">2) 어떻게 동작하나요?</h2>

<ul>
  <li>
    <p><strong>앱별 venv</strong> : <code class="language-plaintext highlighter-rouge">%USERPROFILE%\Work\82_Tools\pipx\venvs\&lt;app&gt;\</code></p>
  </li>
  <li>
    <p><strong>실행 파일(셔닐/EXE/CMD)</strong> : <code class="language-plaintext highlighter-rouge">%USERPROFILE%\Work\82_Tools\bin\&lt;app&gt;.exe</code> (또는 <code class="language-plaintext highlighter-rouge">&lt;app&gt;.cmd</code>)</p>
  </li>
  <li>
    <p>그래서 <strong>PATH</strong> 에 <code class="language-plaintext highlighter-rouge">…\82_Tools\bin</code>만 넣어두면 어디서든 실행돼요.</p>
  </li>
</ul>

<hr />

<h2 id="3-자주-쓰는-명령">3) 자주 쓰는 명령</h2>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pipx</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="nx">ruff</span><span class="w">                 </span><span class="c"># 전역 CLI로 설치 → ...\82_Tools\bin\ruff.exe</span><span class="w">
</span><span class="n">pipx</span><span class="w"> </span><span class="nx">upgrade</span><span class="w"> </span><span class="nx">ruff</span><span class="w">                 </span><span class="c"># 업그레이드</span><span class="w">
</span><span class="n">pipx</span><span class="w"> </span><span class="nx">uninstall</span><span class="w"> </span><span class="nx">ruff</span><span class="w">               </span><span class="c"># 제거</span><span class="w">
</span><span class="n">pipx</span><span class="w"> </span><span class="nx">list</span><span class="w">                         </span><span class="c"># 설치된 앱 목록</span><span class="w">
</span><span class="n">pipx</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nx">cowsay</span><span class="w"> </span><span class="nx">hello</span><span class="w">             </span><span class="c"># 설치 없이 1회 실행</span><span class="w">
</span></code></pre></div></div>

<h3 id="내-패키지를-전역-cli로">내 패키지를 전역 CLI로</h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 로컬 소스에서(개발 레포)</span><span class="w">
</span><span class="n">pipx</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\20_Projects\PRJ-UTILS-mytool"</span><span class="w">

</span><span class="c"># 내가 빌드해둔 휠에서(릴리스 보관)</span><span class="w">
</span><span class="n">pipx</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\75_Releases\mytool\v0.3.0\mytool-0.3.0-py3-none-any.whl"</span><span class="w">
</span></code></pre></div></div>

<p>→ 실행 파일: <code class="language-plaintext highlighter-rouge">…\82_Tools\bin\mytool.exe</code></p>

<hr />

<h2 id="4-프로젝트-전용으로만-쓰고-싶다면">4) 프로젝트 전용으로만 쓰고 싶다면</h2>

<p>전역 pipx 대신 <strong>프로젝트 venv</strong> 에 설치하세요.</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cd</span><span class="w"> </span><span class="bp">$HOME</span><span class="nx">\Work\20_Projects\PRJ-APP</span><span class="w">
</span><span class="n">py</span><span class="w"> </span><span class="nt">-m</span><span class="w"> </span><span class="nx">venv</span><span class="w"> </span><span class="o">.</span><span class="nf">venv</span><span class="w">
</span><span class="o">.</span><span class="nx">\.venv\Scripts\Activate.ps1</span><span class="w">
</span><span class="n">pip</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="nt">-e</span><span class="w"> </span><span class="o">..</span><span class="nx">\PRJ-UTILS-mytool</span><span class="w">
</span><span class="n">mytool</span><span class="w">   </span><span class="c"># 이 venv 안에서만 동작</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>전역처럼 쓰고 싶으면 pipx가 더 안정적입니다.<br />
 “전역처럼 보이게”만 하고 싶다면 <code class="language-plaintext highlighter-rouge">…\82_Tools\bin</code>에 <strong>심볼릭 링크/바로가기</strong> 를 둘 수도 있지만, 권장 흐름은 pipx예요.</p>
</blockquote>

<hr />

<h2 id="5-흔한-이슈--해결">5) 흔한 이슈 &amp; 해결</h2>

<ul>
  <li>
    <p><strong>명령이 인식 안 됨</strong> : <code class="language-plaintext highlighter-rouge">echo $env:Path</code>에 <code class="language-plaintext highlighter-rouge">…\82_Tools\bin</code>이 <strong>맨 앞쪽</strong> 에 있는지 확인.</p>
  </li>
  <li><strong>실행 정책 오류(스크립트 차단)</strong> : PowerShell에서 한 번만
    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Set-ExecutionPolicy</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">CurrentUser</span><span class="w"> </span><span class="nt">-ExecutionPolicy</span><span class="w"> </span><span class="nx">RemoteSigned</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>
    <p><strong>회사 프록시/인증서</strong> : <code class="language-plaintext highlighter-rouge">pip.ini</code>(예: <code class="language-plaintext highlighter-rouge">%APPDATA%\pip\pip.ini</code>)에 프록시/CA 설정 필요할 수 있음.</p>
  </li>
  <li><strong>충돌</strong> : 동일 CLI를 프로젝트 venv에도 설치했다면, <strong>현재 활성화된 셸</strong> 이 우선합니다(venv 우선, 그 외에는 pipx).</li>
</ul>

<hr />

<h2 id="6-우리-트리-요약windows">6) 우리 트리 요약(Windows)</h2>

<ul>
  <li>
    <p>전역 CLI 실행 파일 → <code class="language-plaintext highlighter-rouge">C:\Users\&lt;you&gt;\Work\82_Tools\bin\</code></p>
  </li>
  <li>
    <p>pipx 앱 venv들 → <code class="language-plaintext highlighter-rouge">C:\Users\&lt;you&gt;\Work\82_Tools\pipx\venvs\</code></p>
  </li>
  <li>
    <p>소스 정본 → <code class="language-plaintext highlighter-rouge">…\20_Projects\PRJ-UTILS-&lt;name&gt;\</code></p>
  </li>
  <li>
    <p>릴리스 보관 → <code class="language-plaintext highlighter-rouge">…\75_Releases\&lt;name&gt;\vX.Y.Z\</code></p>
  </li>
</ul>

<p>필요하면 지금 쓰는 윈도우 환경(회사 PC/개인 PC) 기준으로 <strong>한 번에 세팅하는 PowerShell 스크립트</strong> 도 만들어줄게—설치 + 환경변수 + PATH + 몇 개 대표 앱(pipx, ruff, uv 등)까지!</p>

<p class="chat--user">

내가 연구/분석 목적으로 마구 clone 해 둔 repository(github)있는데 이건 어디로 옮겨야할까

</p>

<p>좋아—그 “연구/분석용으로 막 클론한 공개 리포”들은 전용 상자를 하나 두는 게 깔끔해.<br />
나는 <strong><code class="language-plaintext highlighter-rouge">21_Upstreams/</code></strong>(= <em>3rd-party 소스 정리함</em>)를 새로 만들어 거기에 모으는 걸 추천해.</p>

<hr />

<h1 id="어디에-둘까">어디에 둘까?</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>21_Upstreams/               - 외부(3rd-party) 리포 로컬 클론 정본
├─ github/
│  └─ &lt;org&gt;/&lt;repo&gt;/         - 예: github/pallets/flask/
├─ gitlab/
│  └─ &lt;group&gt;/&lt;repo&gt;/
├─ bitbucket/
│  └─ &lt;team&gt;/&lt;repo&gt;/
└─ _registry.csv            - 선택: 목록/태그/메모
</code></pre></div></div>

<p><strong>왜 21?</strong><br />
<code class="language-plaintext highlighter-rouge">20_Projects</code>(내가 소유/개발)와 <code class="language-plaintext highlighter-rouge">22_Labs</code>(가벼운 실험) 사이에 <strong>외부 소스 보관대</strong> 를 끼워 넣으면<br />
“내 것 ↔ 외부 것 ↔ 실험” 흐름이 눈에 잘 들어와요.</p>

<hr />

<h1 id="사용-원칙-간단-룰">사용 원칙 (간단 룰)</h1>

<ol>
  <li>
    <p><strong>읽기 전용 원칙</strong> : <code class="language-plaintext highlighter-rouge">21_Upstreams</code>의 리포는 기본적으로 <em>수정 금지</em>.</p>

    <ul>
      <li>변경/실험이 필요하면 <strong><code class="language-plaintext highlighter-rouge">git worktree</code></strong>로 <strong><code class="language-plaintext highlighter-rouge">22_Labs</code></strong>나 <strong><code class="language-plaintext highlighter-rouge">25_Jobs/SMOKE</code></strong>에 작업 디렉토리를 만드세요.</li>
    </ul>
  </li>
  <li>
    <p><strong>내가 ‘소유’하는 포크</strong> 라면:</p>

    <ul>
      <li>
        <p>장기 개발이면 <strong><code class="language-plaintext highlighter-rouge">20_Projects/&lt;PRJ-…&gt;</code></strong>로 승격,</p>
      </li>
      <li>
        <p>그냥 upstream 추적만 하면 <strong>21</strong> 에 두고 <code class="language-plaintext highlighter-rouge">origin=내포크</code>, <code class="language-plaintext highlighter-rouge">upstream=원본</code> 이중 리모트.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>프로젝트에서 의존</strong> 할 땐: 복사 금지. <strong>서브모듈/서브트리/패키지 의존</strong> 으로 연결.</p>
  </li>
</ol>

<hr />

<h1 id="추천-워크플로">추천 워크플로</h1>

<h2 id="1-클론-이동-단일-리포">1) 클론 이동 (단일 리포)</h2>

<ul>
  <li>macOS/Linux</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">repo</span><span class="o">=</span><span class="s2">"~/Downloads/tmp/flask"</span>   <span class="c"># 현재 위치</span>
<span class="nv">url</span><span class="o">=</span><span class="si">$(</span>git <span class="nt">-C</span> <span class="s2">"</span><span class="nv">$repo</span><span class="s2">"</span> config <span class="nt">--get</span> remote.origin.url<span class="si">)</span>
<span class="nv">host</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$url</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="nt">-E</span> <span class="s1">'s#(https?://|git@)([^/:]+).*#\2#'</span><span class="si">)</span>
<span class="nv">org</span><span class="o">=</span><span class="si">$(</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$url</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="nt">-E</span> <span class="s1">'s#.*/([^/]+)/[^/]+(\.git)?$#\1#'</span><span class="si">)</span>
<span class="nv">name</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$url</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="nt">-E</span> <span class="s1">'s#.*/([^/]+)(\.git)?$#\1#'</span><span class="si">)</span>
<span class="nv">dest</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Work/21_Upstreams/</span><span class="nv">$host</span><span class="s2">/</span><span class="nv">$org</span><span class="s2">/</span><span class="nv">$name</span><span class="s2">"</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$dest</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">mv</span> <span class="s2">"</span><span class="nv">$repo</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$dest</span><span class="s2">"</span>
</code></pre></div></div>

<ul>
  <li>Windows (PowerShell)</li>
</ul>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$repo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Downloads\tmp\flask"</span><span class="w">
</span><span class="nv">$url</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="nt">-C</span><span class="w"> </span><span class="nv">$repo</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="nt">--get</span><span class="w"> </span><span class="nx">remote.origin.url</span><span class="w">
</span><span class="nv">$host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">$url</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'^(https?://|git@)([^/:]+).*'</span><span class="p">,</span><span class="s1">'$2'</span><span class="p">)</span><span class="w">
</span><span class="nv">$org</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">$url</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'^.*/([^/]+)/[^/]+(\.git)?$'</span><span class="p">,</span><span class="s1">'$1'</span><span class="p">)</span><span class="w">
</span><span class="nv">$name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">$url</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'^.*/([^/]+)(\.git)?$'</span><span class="p">,</span><span class="s1">'$1'</span><span class="p">)</span><span class="w">
</span><span class="nv">$dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\21_Upstreams\</span><span class="nv">$host</span><span class="s2">\</span><span class="nv">$org</span><span class="s2">\</span><span class="nv">$name</span><span class="s2">"</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nt">-ItemType</span><span class="w"> </span><span class="nx">Directory</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="p">(</span><span class="n">Split-Path</span><span class="w"> </span><span class="nv">$dest</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-Null</span><span class="w">
</span><span class="nx">Move-Item</span><span class="w"> </span><span class="nv">$repo</span><span class="w"> </span><span class="nv">$dest</span><span class="w">
</span></code></pre></div></div>

<h2 id="2-리모트-정리가독성-">2) 리모트 정리(가독성 ↑)</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/Work/21_Upstreams/github/pallets/flask
git remote rename origin upstream          <span class="c"># 원본을 upstream으로</span>
<span class="c"># 포크가 있다면</span>
git remote add origin git@github.com:&lt;me&gt;/flask.git
</code></pre></div></div>

<h2 id="3-실험할-땐-worktree로-꺼내쓰기--22_labs">3) 실험할 땐 worktree로 꺼내쓰기 (→ 22_Labs)</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 실험 브랜치를 22_Labs로 분리</span>
<span class="nb">cd</span> ~/Work/21_Upstreams/github/pallets/flask
git fetch upstream <span class="nt">--prune</span>
git worktree add ~/Work/22_Labs/flask-exp main
<span class="c"># 여기서 수정/빌드/메모는 22_Labs 아래에서</span>
</code></pre></div></div>

<h2 id="4-주기적-동기화모든-리포">4) 주기적 동기화(모든 리포)</h2>

<ul>
  <li>macOS/Linux</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find ~/Work/21_Upstreams <span class="nt">-type</span> d <span class="nt">-name</span> .git <span class="nt">-prune</span> <span class="nt">-print</span> <span class="se">\</span>
| <span class="k">while </span><span class="nb">read </span>g<span class="p">;</span> <span class="k">do </span><span class="nv">r</span><span class="o">=</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$g</span><span class="s2">"</span><span class="si">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">"→ </span><span class="nv">$r</span><span class="s2">"</span><span class="p">;</span> git <span class="nt">-C</span> <span class="s2">"</span><span class="nv">$r</span><span class="s2">"</span> fetch <span class="nt">--all</span> <span class="nt">--prune</span><span class="p">;</span> <span class="k">done</span>
</code></pre></div></div>

<ul>
  <li>Windows (PowerShell)</li>
</ul>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-ChildItem</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work\21_Upstreams"</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="nt">-Directory</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="s2">".git"</span><span class="w"> </span><span class="o">|</span><span class="w">
  </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Parent</span><span class="o">.</span><span class="nf">FullName</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"→ </span><span class="nv">$r</span><span class="s2">"</span><span class="w">
    </span><span class="n">git</span><span class="w"> </span><span class="nt">-C</span><span class="w"> </span><span class="nv">$r</span><span class="w"> </span><span class="nx">fetch</span><span class="w"> </span><span class="nt">--all</span><span class="w"> </span><span class="nt">--prune</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<hr />

<h1 id="언제-다른-폴더를-쓰나">언제 다른 폴더를 쓰나?</h1>

<ul>
  <li>
    <p><strong>내가 발전시켜서 릴리스/배포할 계획</strong> → <code class="language-plaintext highlighter-rouge">20_Projects/PRJ-…</code>로 승격</p>
  </li>
  <li>
    <p><strong>교육/논문과 함께 읽기 자료</strong> 로만 보관 → 코드 자체는 <strong>21</strong> ,<br />
문서/노트는 <strong><code class="language-plaintext highlighter-rouge">40_Resources/edu</code></strong> 또는 <strong><code class="language-plaintext highlighter-rouge">30_Areas/knowledge_base</code></strong>에 정리(커밋 해시 링크 포함)</p>
  </li>
</ul>

<hr />

<h1 id="보너스-디스크-절약-팁">보너스: 디스크 절약 팁</h1>

<ul>
  <li>
    <p><strong>얕은 클론</strong> : <code class="language-plaintext highlighter-rouge">git clone --depth 1 …</code> (히스토리 최소화)</p>
  </li>
  <li>
    <p><strong>희소 체크아웃</strong> : <code class="language-plaintext highlighter-rouge">git sparse-checkout</code>으로 필요한 경로만</p>
  </li>
  <li>
    <p><strong>GC</strong> : <code class="language-plaintext highlighter-rouge">git gc --aggressive --prune=now</code> (큰 리포 정리 시)</p>
  </li>
</ul>

<hr />

<h2 id="한-줄-결론-2">한 줄 결론</h2>

<ul>
  <li>
    <p>연구/분석용 외부 리포는 <strong><code class="language-plaintext highlighter-rouge">21_Upstreams/&lt;host&gt;/&lt;org&gt;/&lt;repo&gt;</code></strong>로 모아 <strong>읽기 전용</strong> 으로 두고,</p>
  </li>
  <li>
    <p>실험은 <strong><code class="language-plaintext highlighter-rouge">git worktree</code>로 <code class="language-plaintext highlighter-rouge">22_Labs</code>/<code class="language-plaintext highlighter-rouge">25_Jobs/SMOKE</code></strong>에 꺼내서 하자.</p>
  </li>
  <li>
    <p>프로젝트에 쓸 땐 <strong>서브모듈/패키지 의존</strong> 으로 연결, 복사 금지.</p>
  </li>
</ul>

<p class="chat--user">

왜 제목이 Upstream이야?

</p>

<p>좋은 질문! “<strong>Upstream</strong> ”은 깃 용어로 <strong>내가 작업하는 포크의 기준이 되는 ‘원본 저장소’</strong>를 뜻해요.<br />
연구/분석용으로 <strong>남의 레포를 그대로 클론</strong> 해 두는 공간이라는 의미를 담아 <code class="language-plaintext highlighter-rouge">21_Upstreams/</code>라 이름을 붙였던 거예요.</p>

<h2 id="왜-그렇게-불렀나-step-by-step">왜 그렇게 불렀나 (step-by-step)</h2>

<ol>
  <li>
    <p><strong>역할 구분</strong> : <code class="language-plaintext highlighter-rouge">20_Projects</code>(내 소유)와 구분해, <strong>외부 원본 소스</strong> 를 담는 곳이라는 신호.</p>
  </li>
  <li>
    <p><strong>워크플로 연계</strong> : 보통 <code class="language-plaintext highlighter-rouge">upstream</code>을 <strong>읽기 전용으로 추적</strong> 하고, 실험은 <code class="language-plaintext highlighter-rouge">git worktree</code>로 <code class="language-plaintext highlighter-rouge">22_Labs</code>나 <code class="language-plaintext highlighter-rouge">25_Jobs</code>에 꺼내 쓰는 패턴과 잘 맞음.</p>
  </li>
  <li>
    <p><strong>충돌 방지</strong> : 내 코드(Projects)와 외부 코드(Upstreams)가 시각적으로 분리되어 헷갈림 감소.</p>
  </li>
</ol>

<h2 id="하지만-헷갈릴-수-있어요--더-직관적인-이름-대안">하지만 헷갈릴 수 있어요 → 더 직관적인 이름 대안</h2>

<p>목적에 맞춰 아래 중 하나로 바꿔도 전혀 문제 없습니다.</p>

<ul>
  <li>
    <p><strong>21_ExternalRepos</strong> : 가장 직관적(외부 레포 전용). ✅ 추천</p>
  </li>
  <li>
    <p>21_OpenSource : 오픈소스 위주일 때 자연스러움</p>
  </li>
  <li>
    <p>21_3rdParty : 서드파티 소스(벤더/커뮤니티 혼합)</p>
  </li>
  <li>
    <p>21_Forks : “내 포크” 보관 위주일 때</p>
  </li>
  <li>
    <p>21_Mirrors : 읽기 전용 미러 개념을 강조할 때</p>
  </li>
</ul>

<blockquote>
  <p>네 상황(“연구/분석용으로 마구 클론”)엔 <strong>21_ExternalRepos</strong> 가 이해가 가장 쉬워 보여요.</p>
</blockquote>

<h2 id="지금-바꾸고-싶다면-안전-리네임">지금 바꾸고 싶다면 (안전 리네임)</h2>

<h3 id="macoslinux-1">macOS/Linux</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/Work
<span class="o">[</span> <span class="nt">-d</span> 21_Upstreams <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">mv </span>21_Upstreams 21_ExternalRepos
<span class="c"># (선택) Today 단축/스크립트 경로 치환</span>
<span class="nb">grep</span> <span class="nt">-rl</span> <span class="s2">"21_Upstreams"</span> <span class="nb">.</span> | xargs <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">''</span> <span class="nt">-e</span> <span class="s1">'s/21_Upstreams/21_ExternalRepos/g'</span>
</code></pre></div></div>

<h3 id="windows-powershell-7">Windows (PowerShell)</h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Set-Location</span><span class="w"> </span><span class="s2">"</span><span class="bp">$HOME</span><span class="s2">\Work"</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="s2">"21_Upstreams"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Rename-Item</span><span class="w"> </span><span class="s2">"21_Upstreams"</span><span class="w"> </span><span class="s2">"21_ExternalRepos"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="c"># (선택) 경로 치환</span><span class="w">
</span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="nt">-File</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="p">(</span><span class="n">Get-Content</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">FullName</span><span class="p">)</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'21_Upstreams'</span><span class="p">,</span><span class="s1">'21_ExternalRepos'</span><span class="w"> </span><span class="o">|</span><span class="w">
    </span><span class="n">Set-Content</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">FullName</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="폴더-예시는-그대로-사용-가능">폴더 예시는 그대로 사용 가능</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>21_ExternalRepos/
└─ github/&lt;org&gt;/&lt;repo&gt;/
   gitlab/&lt;group&gt;/&lt;repo&gt;/
   bitbucket/&lt;team&gt;/&lt;repo&gt;/
</code></pre></div></div>

<h3 id="요약-6">요약</h3>

<ul>
  <li>
    <p>“Upstream”은 <strong>원본 저장소</strong> 를 뜻해서 썼던 이름.</p>
  </li>
  <li>
    <p>더 직관적이길 원하면 <strong>21_ExternalRepos</strong> 로 바꿔도 의미/흐름 100% 유지.</p>
  </li>
  <li>
    <p>리네임은 위 스크립트로 바로 반영하면 끝!</p>
  </li>
</ul>

<p class="chat--user">

대화 기록 저장 파일은 어디두는게 좋을까

</p>

<p>좋은 주제! “대화 기록(chat logs)”은 <strong>원본(raw)과 정제본(curated)</strong>을 분리하고, <strong>프로젝트·작업에서는 링크만</strong> 거는 방식이 깔끔합니다. 전용 상자를 새로 하나 두자고 제안해요.</p>

<h1 id="추천-위치-새-슬롯">추천 위치 (새 슬롯)</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>31_Conversations/                  - 대화 기록의 '정본' 보관소
├─ inbox/                          - 즉시 덤프/내보내기(raw, 미정리)
├─ by_assistant/                   - 도구별 정리(ChatGPT, LocalLLM, Slack 등)
│  ├─ chatgpt/
│  ├─ local_llm/
│  └─ slack/
├─ by_topic/                       - 주제별(선택): regex, packaging, Qt, 배포…
├─ redacted/                       - 비식별/민감정보 삭제본(공유용)
├─ private_encrypted/              - 암호화보관(진짜 민감 내용)
├─ index.md                        - 색인/검색 가이드(최근 50개 링크)
├─ templates/chat_log_template.md  - 메타 포함 템플릿
└─ scripts/                        - 저장/정제/색인 스크립트
</code></pre></div></div>

<blockquote>
  <p>번호 <strong>31</strong> 은 <code class="language-plaintext highlighter-rouge">30_Areas(장기 운영)</code>와 <code class="language-plaintext highlighter-rouge">32_SharedConfigs(공유설정)</code> 사이로, “운영 자산이지만 설정은 아닌” 대화 기록에 잘 맞습니다.</p>
</blockquote>

<hr />

<h2 id="언제-어디에-두나-의사결정-4단계">언제 어디에 두나 (의사결정 4단계)</h2>

<ol>
  <li>
    <p><strong>그냥 저장/백업용</strong> → <code class="language-plaintext highlighter-rouge">31_Conversations/inbox/</code>에 먼저 넣기</p>
  </li>
  <li>
    <p><strong>정리/검색할 가치 있음</strong> → <code class="language-plaintext highlighter-rouge">31_Conversations/by_assistant/&lt;tool&gt;/YYYY/YYYY-MM/파일</code>로 이동</p>
  </li>
  <li>
    <p><strong>공유하거나 문서화 가치</strong> → 요약/클린업해서 <code class="language-plaintext highlighter-rouge">31_Conversations/redacted/…</code>에 별도 저장</p>

    <ul>
      <li>깨끗이 정리된 지식은 추려서 <strong><code class="language-plaintext highlighter-rouge">30_Areas/knowledge_base</code>로 승격</strong> (원본 링크 남김)</li>
    </ul>
  </li>
  <li>
    <p><strong>프로젝트/작업에서 참조 필요</strong> → 그 PRJ/JOB 안에는 <strong>복사하지 말고 상대경로 링크(또는 심볼릭 링크)</strong> 만 둠</p>

    <ul>
      <li>예) <code class="language-plaintext highlighter-rouge">20_Projects/PRJ-…/docs/links.md</code>에 <code class="language-plaintext highlighter-rouge">../../31_Conversations/by_assistant/local_llm/…/…md</code> 링크</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="파일명--메타-규칙">파일명 &amp; 메타 규칙</h2>

<ul>
  <li>
    <p><strong>파일명</strong> : <code class="language-plaintext highlighter-rouge">YYYY-MM-DD_HHMM-KST_&lt;assistant&gt;_&lt;topic&gt;[_convID].md</code></p>

    <ul>
      <li>예: <code class="language-plaintext highlighter-rouge">2025-09-01_1042-KST_localllm_regex-tips_cid-9a2f.md</code></li>
    </ul>
  </li>
  <li>
    <p><strong>문서 상단 메타(필수)</strong> — 맨 위 6~10줄 정도:</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>===
title: "Regex tips with backreferences"
date: 2025-09-01T10:42:00+09:00
assistant: local_llm (GPT-OSS 120B)
topic: regex
project: PRJ-2025-001_sample_app   # 없으면 생략
sensitivity: low|medium|high
links:
  - ../../30_Areas/knowledge_base/tips/regex.md
===
</code></pre></div></div>

<blockquote>
  <p>코드 블록은 <strong>``` 대신<code class="language-plaintext highlighter-rouge">===</code></strong> 로 감싸는 기존 약속 유지.</p>
</blockquote>

<hr />

<h2 id="보안프라이버시-원칙">보안/프라이버시 원칙</h2>

<ul>
  <li>
    <p><strong>민감 표시</strong> : <code class="language-plaintext highlighter-rouge">sensitivity: high</code>면 즉시 <code class="language-plaintext highlighter-rouge">redacted/</code> 버전 생성, 필요 시 <code class="language-plaintext highlighter-rouge">private_encrypted/</code>(암호화)로 이동.</p>
  </li>
  <li>
    <p><strong>암호화 보관(예)</strong></p>

    <ul>
      <li>
        <p>macOS/Linux (gpg 대칭):<br />
<code class="language-plaintext highlighter-rouge">gpg -c -o private_encrypted/&lt;same_name&gt;.gpg by_assistant/.../&lt;file&gt;.md</code></p>
      </li>
      <li>
        <p>Windows (7-Zip): 암호 걸어 <code class="language-plaintext highlighter-rouge">.7z</code>로 보관</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>비밀/토큰</strong> 은 원본에서도 삭제/마스킹하고, 진짜 원본이 필요하면 암호화본만 남겨둠.</p>
  </li>
</ul>

<hr />

<h2 id="워크플로-step-by-step">워크플로 (step-by-step)</h2>

<h3 id="a-저장내보내기--정리">A. 저장(내보내기) → 정리</h3>

<ol>
  <li>
    <p><strong>원본 덤프</strong> : <code class="language-plaintext highlighter-rouge">31_Conversations/inbox/2025-09-01_1042-KST_chatgpt_tmp.md</code></p>
  </li>
  <li>
    <p><strong>검토/정리</strong> : 제목·메타·태그 보강, 불필요한 잡음 제거</p>
  </li>
  <li>
    <p><strong>이동</strong> :</p>

    <ul>
      <li>
        <p>ChatGPT면 <code class="language-plaintext highlighter-rouge">by_assistant/chatgpt/2025/2025-09/…md</code></p>
      </li>
      <li>
        <p>Local LLM이면 <code class="language-plaintext highlighter-rouge">by_assistant/local_llm/…</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p>(선택) <strong>요약문</strong> 을 <code class="language-plaintext highlighter-rouge">30_Areas/knowledge_base/howtos/…md</code>에 작성하고 링크.</p>
  </li>
</ol>

<h3 id="b-프로젝트작업에서-참조">B. 프로젝트/작업에서 참조</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">20_Projects/PRJ-…/docs/links.md</code>에 상대 링크 추가</p>
  </li>
  <li>
    <p>또는 심볼릭(맥/리눅스):<br />
<code class="language-plaintext highlighter-rouge">ln -s ../../31_Conversations/by_assistant/local_llm/2025/2025-09/…md docs/chat_refs/…md</code><br />
<em>(링크 깨짐 방지를 위해<strong>상대 링크</strong> 권장)</em></p>
  </li>
</ul>

<h3 id="c-검색">C. 검색</h3>

<ul>
  <li>
    <p>rg/grep 원라인러:</p>

    <ul>
      <li>
        <p>macOS/Linux: <code class="language-plaintext highlighter-rouge">rg -n --hidden -S "pattern" ~/Work/31_Conversations</code></p>
      </li>
      <li>
        <p>Windows(PowerShell): <code class="language-plaintext highlighter-rouge">rg -n --hidden -S "pattern" $HOME\Work\31_Conversations</code></p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="템플릿복붙">템플릿(복붙)</h2>

<p><code class="language-plaintext highlighter-rouge">31_Conversations/templates/chat_log_template.md</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>===
title: "&lt;짧은 제목&gt;"
date: 2025-09-01T10:42:00+09:00
assistant: &lt;chatgpt|local_llm|slack|...&gt;
topic: &lt;regex|packaging|...&gt;
project: &lt;PRJ-YYYY-NNN_name or -&gt;  (없으면 생략)
sensitivity: low
links: []
===

# 요약
- 핵심 1
- 핵심 2

# 본문
(대화 캡처/정리)
=== code ===
# 코드/명령(필요 시)
===

# 액션 아이템
- [ ] 다음에 할 것…
</code></pre></div></div>

<hr />

<h2 id="자동화-스니펫">자동화 스니펫</h2>

<h3 id="tcsh-새-로그-시작-헬퍼">tcsh: “새 로그 시작” 헬퍼</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=== code ===
#!/bin/tcsh -f
set root = "$HOME/Work/31_Conversations/by_assistant/local_llm"
set ts = `date +"%Y-%m-%d_%H%M-KST"`
set dest = "$root/`date +%Y`/`date +%Y-%m`/${ts}_localllm_&lt;topic&gt;.md"
mkdir -p "`dirname "$dest"`"
cp "$HOME/Work/31_Conversations/templates/chat_log_template.md" "$dest"
echo "$dest"
=== 
</code></pre></div></div>

<h3 id="powershell-inbox--정리-예시">PowerShell: “inbox → 정리” 예시</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=== code ===
$src = "$HOME\Work\31_Conversations\inbox"
$dst = "$HOME\Work\31_Conversations\by_assistant\chatgpt\$(Get-Date -f yyyy)\$(Get-Date -f yyyy-MM)"
New-Item -ItemType Directory -Force -Path $dst | Out-Null
Get-ChildItem $src -Filter *.md | ForEach-Object {
  $name = "$(Get-Date -f yyyy-MM-dd_HHmm)-KST_chatgpt_$($_.BaseName).md"
  Move-Item $_.FullName (Join-Path $dst $name)
}
=== 
</code></pre></div></div>

<hr />

<h2 id="왜-31_conversations인가-장점-정리">왜 <code class="language-plaintext highlighter-rouge">31_Conversations</code>인가 (장점 정리)</h2>

<ul>
  <li>
    <p><strong>Projects/Jobs와 분리</strong> : 복붙/중복 없이 한 곳에서 관리, 프로젝트에선 링크만.</p>
  </li>
  <li>
    <p><strong>정리 단계가 보임</strong> : <code class="language-plaintext highlighter-rouge">inbox → by_assistant → (redacted/private)</code>로 자연스러운 흐름.</p>
  </li>
  <li>
    <p><strong>검색 효율</strong> : 도구/주제/기간별로 트리 정리가 되어 <code class="language-plaintext highlighter-rouge">ripgrep</code> 한 방.</p>
  </li>
  <li>
    <p><strong>보안 레이어</strong> : 민감·공유 가능한 버전을 분리해 실수 방지.</p>
  </li>
</ul>

<p>필요하면 너의 환경(tcsh/PowerShell)에 맞춘 <strong>신규 만들기/정리/색인 스크립트</strong> 를 더 다듬어서 줄게.</p>

<p class="chat--user">

기타 엔터테인먼트용 음악/사진은 어디둘까? 집중할때 듣는 음악 등등

</p>

<p>좋은 질문! 결론부터:</p>

<ul>
  <li>
    <p><strong>권장</strong> : 업무 트리(~/Work) <strong>바깥</strong> 에 개인용 미디어를 둬요 → <code class="language-plaintext highlighter-rouge">~/Personal/Media/…</code></p>
  </li>
  <li>
    <p><strong>부득이하게 Work 안에 둘 때</strong> : <strong>업무 자산과 확실히 분리된 전용 상자</strong> 를 하나 만듭니다 → <code class="language-plaintext highlighter-rouge">06_Media/…</code></p>
  </li>
</ul>

<p>아래처럼 쓰면 깔끔해요.</p>

<hr />

<h1 id="a안-권장-work-바깥">A안 (권장): Work 바깥</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/Personal/Media/
├─ Music/
│  ├─ focus/            # 집중용(white-noise, lofi, rain 등)
│  ├─ ambient/
│  └─ playlists/        # .m3u 플레이리스트
├─ Photos/
│  ├─ wallpapers/
│  └─ reference/
└─ Licenses/            # 폰트/음원/이미지 라이선스 사본
</code></pre></div></div>

<ul>
  <li>
    <p><strong>이유</strong> : 업무 백업/검색/버전관리 범위에서 제외 → 성능·보안·용량 이점.</p>
  </li>
  <li>
    <p>프로젝트/작업에 필요하면 <strong>링크로만</strong> 참조(복사 금지).</p>
  </li>
</ul>

<hr />

<h1 id="b안-work-안에-둘-때-06_media">B안 (Work 안에 둘 때): 06_Media</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Work/
└─ 06_Media/                         - 개인 엔터테인먼트 상자(업무와 분리)
   ├─ audio/
   │  ├─ focus/
   │  ├─ ambient/
   │  └─ playlists/                 # focus.m3u, rain.m3u …
   ├─ photos/
   │  ├─ wallpapers/
   │  └─ reference/
   ├─ licenses/
   └─ README.md                     # 용도/주의사항 요약
</code></pre></div></div>

<ul>
  <li>
    <p><strong>60_Assets</strong> 는 로고/폰트/템플릿 같은 “업무 시각 자산” 용이라, <strong>엔터테인먼트는 06_Media로 분리</strong> 합니다.</p>
  </li>
  <li>
    <p>각 PRJ/JOB에서는 <strong>상대경로 링크</strong> 만 두고, 원본은 여기 보관.</p>
  </li>
</ul>

<hr />

<h2 id="운영-규칙간단-룰">운영 규칙(간단 룰)</h2>

<ol>
  <li>
    <p><strong>복사 금지</strong> : PRJ/JOB/Resources로 옮기지 말고 <strong>링크/경로 참조</strong> 만.</p>
  </li>
  <li>
    <p><strong>검색 제외</strong> : ripgrep/인덱싱/백업 대상에서 06_Media 또는 Personal/Media를 <strong>제외</strong>(성능↑).</p>
  </li>
  <li>
    <p><strong>라이선스 분리</strong> : 구매/라이선스 파일은 <code class="language-plaintext highlighter-rouge">licenses/</code>에 함께 저장.</p>
  </li>
  <li>
    <p><strong>대용량 주의</strong> : 클라우드 동기화 금지 정책이 있으면 제외 폴더로 등록.</p>
  </li>
</ol>

<hr />

<h2 id="today에서-빠르게-재생선택">Today에서 빠르게 재생(선택)</h2>

<p>플레이리스트를 만들고 <code class="language-plaintext highlighter-rouge">10_Today/shortcuts.list</code>로 실행해요. (mpv/VLC 등 포터블을 82_Tools에 두면 편함)</p>

<h3 id="예-focusm3u-플레이리스트">예) focus.m3u (플레이리스트)</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ~/Work/06_Media/audio/playlists/focus.m3u
../focus/lofi-01.mp3
../focus/rain-60min.mp3
../ambient/white-noise.wav
</code></pre></div></div>

<h3 id="mpv를-82_tools에-두고-실행">mpv를 82_Tools에 두고 실행</h3>

<ul>
  <li>
    <p>mpv 위치: <code class="language-plaintext highlighter-rouge">82_Tools/portable/mpv-&lt;ver&gt;/mpv</code> → <code class="language-plaintext highlighter-rouge">82_Tools/bin/mpv</code> 심링크 권장</p>
  </li>
  <li>
    <p>shortcuts.list 라인:</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Focus (shuffle) | / | mpv --no-video --shuffle --loop-playlist ~/Work/06_Media/audio/playlists/focus.m3u
</code></pre></div></div>

<h3 id="windowspowershell-예">Windows(PowerShell) 예</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Focus (VLC) | / | "&amp; $HOME\Work\82_Tools\portable\vlc-&lt;ver&gt;\vlc.exe" --qt-start-minimized --loop $HOME\Work\06_Media\audio\playlists\focus.m3u
</code></pre></div></div>

<hr />

<h2 id="링크로만-참조복붙-금지">링크로만 참조(복붙 금지)</h2>

<ul>
  <li>macOS/Linux:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ln -s ../../06_Media/photos/wallpapers/ ~/Work/20_Projects/PRJ-.../docs/wallpapers
</code></pre></div>    </div>
  </li>
  <li>Windows: <strong>심볼릭/정션</strong> 또는 문서에 경로만 링크.</li>
</ul>

<hr />

<h2 id="헷갈릴-때-구분법-step-by-step">헷갈릴 때 구분법 (step-by-step)</h2>

<ul>
  <li>
    <p><strong>업무 산출물/참조 자산</strong> → <code class="language-plaintext highlighter-rouge">60_Assets</code></p>
  </li>
  <li>
    <p><strong>교육/스펙/문서</strong> → <code class="language-plaintext highlighter-rouge">40_Resources</code></p>
  </li>
  <li>
    <p><strong>순수 개인 감상/집중용</strong> → <code class="language-plaintext highlighter-rouge">06_Media</code> (또는 <code class="language-plaintext highlighter-rouge">~/Personal/Media</code>) ✅</p>
  </li>
</ul>

<p>원하면 A/B 중 선택에 맞춰 <strong>초기 폴더 생성 스크립트</strong> 와 <strong>Today 단축 세트</strong> 를 바로 만들어줄게!</p>

<p class="chat--user">

Obsidian vault는 어디 넣는게 좋을까

</p>

<p>좋은 질문! 딱 정리하면:</p>

<h2 id="결론-추천-위치">결론 (추천 위치)</h2>

<ul>
  <li>
    <p><strong>업무 지식/메모 중심 Vault</strong> ➜ <code class="language-plaintext highlighter-rouge">~/Work/30_Areas/knowledge_base/obsidian_vault/</code><br />
(장기 운영 지식이므로 <em>Areas</em> 아래가 가장 자연스럽습니다.)</p>
  </li>
  <li>
    <p><strong>완전 개인용(일기/사생활)</strong> ➜ <code class="language-plaintext highlighter-rouge">~/Personal/Notes/obsidian_vault/</code><br />
(업무 트리 밖으로 분리 추천)</p>
  </li>
  <li>
    <p><strong>프로젝트별 별도 Vault</strong> 는 가급적 비추천. 프로젝트/잡 문맥의 메모는 각 폴더에 두고(<strong>복사 금지</strong>), Vault에서는 <strong>링크</strong> 로 참조하는 방식이 관리가 쉬워요.</p>
  </li>
</ul>

<hr />

<h2 id="왜-30_areasknowledge_base인가-step-by-step">왜 <code class="language-plaintext highlighter-rouge">30_Areas/knowledge_base</code>인가 (step-by-step)</h2>

<ol>
  <li>
    <p><strong>수명 주기</strong> : Vault는 프로젝트보다 오래 살아있는 “지식 자산” → <em>Areas</em> 가 맞음.</p>
  </li>
  <li>
    <p><strong>역할 분리</strong> : 외부 문서/스펙은 <code class="language-plaintext highlighter-rouge">40_Resources</code>, 설정은 <code class="language-plaintext highlighter-rouge">32_SharedConfigs</code>/<code class="language-plaintext highlighter-rouge">90_PersonalConfigs</code>, <strong>내가 쓴 지식과 노트</strong> 는 Vault에.</p>
  </li>
  <li>
    <p><strong>참조 흐름</strong> : 프로젝트/작업(20/25)에서는 <strong>상대경로 링크</strong> 만 두고, 원본은 Vault에 집중.</p>
  </li>
</ol>

<hr />

<h2 id="최소-구조-예시">최소 구조 예시</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/Work/30_Areas/knowledge_base/obsidian_vault/
├─ 00_Inbox/                # 캡처/임시 노트 (정리 전)
├─ 10_Daily/2025/           # 데일리/주간 노트
├─ 20_Topics/               # 주제별(Regex, Packaging, PySide6…)
├─ 30_ProjectsNotes/        # 프로젝트 관련 “노트”(코드는 20_Projects에 있음)
├─ 40_References/           # 내가 요약/정리한 레퍼런스(원본은 40_Resources)
├─ _attachments/            # 작은 첨부(이미지/스니펫). 대용량은 링크만.
└─ .obsidian/               # Vault 설정(테마/플러그인)
</code></pre></div></div>

<blockquote>
  <p><strong>대용량 파일(음원/영상/대형 PDF)은 복사하지 말고</strong> <code class="language-plaintext highlighter-rouge">60_Assets</code>(업무 자산)이나 <code class="language-plaintext highlighter-rouge">06_Media</code>(엔터테인먼트)·<code class="language-plaintext highlighter-rouge">26_Datasets</code>(데이터셋) 위치를 <strong>링크로 참조</strong> 하세요.</p>
</blockquote>

<hr />

<h2 id="obsidian-설정-팁-한번만-해두면-편함">Obsidian 설정 팁 (한번만 해두면 편함)</h2>

<ul>
  <li>
    <p><strong>Default location for new attachments</strong> : <code class="language-plaintext highlighter-rouge">./_attachments</code></p>
  </li>
  <li>
    <p><strong>Use[[[] wikilinks</strong>: 켜기 (상대경로 참조 쉬움)</p>
  </li>
  <li>
    <p><strong>New file location</strong> : <code class="language-plaintext highlighter-rouge">00_Inbox</code> (수집→정리 루틴)</p>
  </li>
  <li>
    <p><strong>Daily notes/Periodic Notes 플러그인</strong> : <code class="language-plaintext highlighter-rouge">10_Daily/2025/</code>로 지정</p>
  </li>
  <li>
    <p><strong>Template</strong> : <code class="language-plaintext highlighter-rouge">30_Areas/knowledge_base/obsidian_vault/_templates/…</code> 만들고 템플릿 플러그인 경로 설정</p>
  </li>
  <li>
    <p><strong>대용량 제외</strong> : Vault 루트에 <code class="language-plaintext highlighter-rouge">.gitignore</code>로 <code class="language-plaintext highlighter-rouge">_attachments/**.mp4</code>, <code class="language-plaintext highlighter-rouge">*.zip</code> 등 제외(깃 관리 시)</p>
  </li>
</ul>

<hr />

<h2 id="버전관리--개인설정-분리선택">버전관리 &amp; 개인설정 분리(선택)</h2>

<ul>
  <li>
    <p>Vault 자체를 Git으로 관리하려면:</p>

    <ul>
      <li>
        <p>체크인: <code class="language-plaintext highlighter-rouge">*.md</code>, <code class="language-plaintext highlighter-rouge">_attachments</code>(소형), 템플릿</p>
      </li>
      <li>
        <p>제외: <code class="language-plaintext highlighter-rouge">.obsidian/workspace.json</code>(개인 레이아웃), 캐시류</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>개인 테마/스니펫</strong> 은 <code class="language-plaintext highlighter-rouge">~/Work/90_PersonalConfigs/obsidian/&lt;vault_name&gt;/</code>에 백업해 두고,<br />
필요 시 Vault의 <code class="language-plaintext highlighter-rouge">.obsidian</code>으로 <strong>복사/동기화</strong>(OS 바뀌어도 복구 쉬움).</p>
  </li>
</ul>

<hr />

<h2 id="프로젝트작업에서-링크로만-참조-복붙-금지">프로젝트/작업에서 링크로만 참조 (복붙 금지)</h2>

<ul>
  <li>macOS/Linux:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ln</span> <span class="nt">-s</span> ../../30_Areas/knowledge_base/obsidian_vault/20_Topics/regex.md <span class="se">\</span>
      ~/Work/20_Projects/PRJ-2025-001_sample_app/docs/regex-notes.md
</code></pre></div>    </div>
  </li>
  <li>Windows(관리자 또는 개발자 모드):
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cmd
    
mklink docs\regex-notes.md ..\..\30_Areas\knowledge_base\obsidian_vault\20_Topics\regex.md
</code></pre></div>    </div>
  </li>
</ul>

<hr />

<h2 id="언제-다른-위치를-쓰나">언제 다른 위치를 쓰나?</h2>

<ul>
  <li>
    <p><strong>회사 전체 공유 Vault</strong> 가 필요하면: <code class="language-plaintext highlighter-rouge">32_SharedConfigs/knowledge_vault/</code>로 별도 운영(개인 Vault와 분리).</p>
  </li>
  <li>
    <p><strong>연구 리포 정독 노트</strong> : 코드 원본은 <code class="language-plaintext highlighter-rouge">21_ExternalRepos</code>, 읽기 노트는 Vault의 <code class="language-plaintext highlighter-rouge">40_References/</code>에.</p>
  </li>
</ul>

<hr />

<h3 id="한-줄-요약-2">한 줄 요약</h3>

<ul>
  <li>
    <p><strong>업무용 Obsidian Vault</strong> 는 <code class="language-plaintext highlighter-rouge">~/Work/30_Areas/knowledge_base/obsidian_vault/</code>.</p>
  </li>
  <li>
    <p><strong>개인용</strong> 은 <code class="language-plaintext highlighter-rouge">~/Personal/Notes/obsidian_vault/</code>.</p>
  </li>
  <li>
    <p>대용량은 링크만, 노트는 Vault에 집중—프로젝트/잡에서는 <strong>복사 말고 참조</strong>!</p>
  </li>
</ul>

<p class="chat--user">

어디선가 다운받은 (큰 노력없이) 교육 “자료”가 있고, 내가 스스로 공부하며 정리한 자료나 수행한 실습이 있잖아. 둘을 모두 같은 곳에 보관하는 건 좀 이상해. 방법 추천해줘

</p>

<p>좋은 지적! “어디선가 다운받은 교육 자료(수집물)”와 “내가 공부하며 만든 정리/실습(창작물)”을 <strong>의도적으로 분리</strong> 하면 훨씬 깔끔해져요. 아래처럼 나누는 걸 추천합니다.</p>

<hr />

<h1 id="1-결론-상자-3개로-분리">1) 결론: 상자 3개로 분리</h1>

<h2 id="a-외부-수집물읽기참고용-원본">A) 외부 수집물(읽기/참고용 원본)</h2>

<ul>
  <li>
    <p><strong>위치:</strong> <code class="language-plaintext highlighter-rouge">~/Work/40_Resources/edu/…</code></p>
  </li>
  <li><strong>예시 트리</strong>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>40_Resources/
  edu/
    courses/&lt;provider&gt;/&lt;course_name&gt;/vYYYY.MMDD/{slides,pdf,code,assets,LICENSE,README.md}
    tutorials/&lt;site&gt;/&lt;series&gt;/vYYYY.MMDD/{html,pdf,code}
    papers/{to_read,reading_notes,summaries}/
    manuals/&lt;vendor&gt;/&lt;product&gt;/&lt;version&gt;/
</code></pre></div>    </div>
  </li>
  <li><strong>원칙:</strong> “읽기 전용”. 큰 파일도 <strong>여기에만</strong> 저장(프로젝트/노트로 복사 금지).</li>
</ul>

<h2 id="b-내-노트정리지식화">B) 내 노트/정리(지식화)</h2>

<ul>
  <li>
    <p><strong>위치:</strong> <code class="language-plaintext highlighter-rouge">~/Work/30_Areas/knowledge_base/obsidian_vault/…</code></p>
  </li>
  <li><strong>예시 트리</strong>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>30_Areas/knowledge_base/obsidian_vault/
  20_Topics/&lt;topic&gt;.md
  40_References/&lt;course_name&gt;_summary.md
  30_ProjectsNotes/PRJ-2025-001_sample_app.md
  _attachments/ (소형 이미지만)
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>원칙:</strong> 텍스트 중심. 원본 파일은 A에 두고, <strong>링크만</strong> 건다.</p>

    <ul>
      <li>Obsidian 쓰면 <code class="language-plaintext highlighter-rouge">[[상대링크]]</code>로 A의 자료를 가리키기.</li>
    </ul>
  </li>
</ul>

<h2 id="c-실습과제재현-가능한-작업액션">C) 실습/과제/재현 가능한 작업(액션)</h2>

<ul>
  <li>
    <p><strong>위치:</strong> <code class="language-plaintext highlighter-rouge">~/Work/25_Jobs/LAB/&lt;연도&gt;/LAB-YYYY-NNN_&lt;slug&gt;/…</code></p>
  </li>
  <li><strong>예시 트리</strong>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>25_Jobs/
  LAB/2025/LAB-2025-017_pyside6-tableview/
    README.md        # 목표/절차/결과
    env/             # (필요 시) 환경 정의
    scripts/         # run/build/test
    src/             # 실습 코드
    data/            # 소용량 샘플만 (대용량은 26_Datasets 링크)
    references.md    # 40_Resources 경로 링크 모음
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>원칙:</strong> 실행/검증 가능하게 구성. 대용량 입력은 <strong>26_Datasets</strong> 를 참조:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">~/Work/26_Datasets/datasets/&lt;name&gt;/vYYYY.MMDD/…</code> (여기엔 <strong>정본</strong> 만)</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>가벼운 즉흥 실험은 <strong><code class="language-plaintext highlighter-rouge">22_Labs/</code></strong>에 두고, 재현·공유 가치가 생기면 <strong>LAB Job</strong> 으로 “승격”하세요.</p>
</blockquote>

<hr />

<h1 id="2-라우팅-표헷갈릴-때-이대로">2) 라우팅 표(헷갈릴 때 이대로)</h1>

<table>
  <thead>
    <tr>
      <th>항목</th>
      <th>보관 위치</th>
      <th>메모</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>강의 슬라이드/PDF/예제 ZIP</td>
      <td><code class="language-plaintext highlighter-rouge">40_Resources/edu/courses/...</code></td>
      <td>원본만 저장(읽기 전용)</td>
    </tr>
    <tr>
      <td>블로그 튜토리얼 복사본</td>
      <td><code class="language-plaintext highlighter-rouge">40_Resources/edu/tutorials/...</code></td>
      <td>URL과 날짜 같이 기록</td>
    </tr>
    <tr>
      <td>논문 PDF/정리</td>
      <td>PDF: <code class="language-plaintext highlighter-rouge">40_Resources/edu/papers/to_read/…</code> / 정리: Vault</td>
      <td>정리는 Vault에서</td>
    </tr>
    <tr>
      <td>내 요약/치트시트</td>
      <td><code class="language-plaintext highlighter-rouge">30_Areas/knowledge_base/obsidian_vault/...</code></td>
      <td>원본 링크 포함</td>
    </tr>
    <tr>
      <td>실습 코드/과제 풀이</td>
      <td><code class="language-plaintext highlighter-rouge">25_Jobs/LAB/...</code></td>
      <td>재현 가능한 구조, 결과 캡처</td>
    </tr>
    <tr>
      <td>즉석 노트북 실험</td>
      <td><code class="language-plaintext highlighter-rouge">22_Labs/jupyter/...</code></td>
      <td>짧게 끝나면 여기서 종료</td>
    </tr>
    <tr>
      <td>대용량 데이터</td>
      <td><code class="language-plaintext highlighter-rouge">26_Datasets/.../vYYYY.MMDD/</code></td>
      <td>manifest.yml + 체크섬</td>
    </tr>
  </tbody>
</table>

<hr />

<h1 id="3-연결링크-규칙">3) 연결(링크) 규칙</h1>

<ul>
  <li>
    <p><strong>Vault ↔ Resources:</strong> Vault 노트에서 <strong>상대 경로 링크</strong> 로 <code class="language-plaintext highlighter-rouge">40_Resources</code> 파일을 가리킴. 복사 금지.</p>
  </li>
  <li>
    <p><strong>LAB ↔ Resources/Datasets:</strong> <code class="language-plaintext highlighter-rouge">references.md</code>에 <code class="language-plaintext highlighter-rouge">../../../../40_Resources/...</code> / <code class="language-plaintext highlighter-rouge">../../../../26_Datasets/...</code> 링크.<br />
필요하면 <strong>심볼릭 링크</strong> 도 가능(상대경로로).</p>
  </li>
</ul>

<p>예:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 25_Jobs/LAB/.../references.md
- 강의 노트: ../../../../40_Resources/edu/courses/udemy/pyqt/v2025.0829/README.md
- 샘플 데이터: ../../../../26_Datasets/datasets/ad_events/v2025.0826/processed/
</code></pre></div></div>

<hr />

<h1 id="4-스캐폴드빠르게-만들기">4) 스캐폴드(빠르게 만들기)</h1>

<p><strong>코스 수집물 폴더</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">base</span><span class="o">=</span>~/Work/40_Resources/edu/courses/udemy/pyside6-masterclass/v2025.0901
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$base</span><span class="s2">"</span>/<span class="o">{</span>slides,pdf,code,assets<span class="o">}</span>
<span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"# Course: PySide6 Masterclass"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$base</span><span class="s2">/README.md"</span>
</code></pre></div></div>

<p><strong>LAB Job</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">job</span><span class="o">=</span>~/Work/25_Jobs/LAB/2025/LAB-2025-018_pyside6-tableview
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$job</span><span class="s2">"</span>/<span class="o">{</span>src,scripts,env,data<span class="o">}</span>
<span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"# 목표</span><span class="se">\n</span><span class="s2">- TableView로 CSV 뷰어 만들기</span><span class="se">\n\n</span><span class="s2"># 절차</span><span class="se">\n</span><span class="s2">- ...</span><span class="se">\n\n</span><span class="s2"># 결과</span><span class="se">\n</span><span class="s2">- 스크린샷/메모"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$job</span><span class="s2">/README.md"</span>
<span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"- 강의: ../../../../40_Resources/edu/courses/udemy/pyside6-masterclass/v2025.0901/README.md"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$job</span><span class="s2">/references.md"</span>
</code></pre></div></div>

<hr />

<h1 id="5-운영-팁">5) 운영 팁</h1>

<ul>
  <li>
    <p><strong>저작권/라이선스:</strong> 외부 자료는 <code class="language-plaintext highlighter-rouge">40_Resources/.../LICENSE</code>나 <code class="language-plaintext highlighter-rouge">README.md</code>에 출처·라이선스 표기.</p>
  </li>
  <li>
    <p><strong>중복 방지:</strong> 외부 자료를 PRJ/JOB에 <strong>복사하지 말고</strong> 링크. (버전이 바뀌면 폴더를 새 <code class="language-plaintext highlighter-rouge">vYYYY.MMDD</code>로)</p>
  </li>
  <li>
    <p><strong>정리 주기:</strong></p>

    <ul>
      <li>
        <p>주 1회: <code class="language-plaintext highlighter-rouge">40_Resources/edu</code> 정리(중복/구버전 확인)</p>
      </li>
      <li>
        <p>실습이 장기화되면 <code class="language-plaintext highlighter-rouge">LAB → EX/REL</code>(예제/릴리스)로 승격 고려</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>검색 성능:</strong> ripgrep/인덱싱 대상에서 <code class="language-plaintext highlighter-rouge">40_Resources/edu/…/code</code> 대용량 폴더는 제외해도 좋아요.</p>
  </li>
</ul>

<hr />

<h1 id="6-한-줄-요약">6) 한 줄 요약</h1>

<ul>
  <li>
    <p><strong>외부 수집물</strong> 은 <code class="language-plaintext highlighter-rouge">40_Resources/edu</code>(읽기 전용),</p>
  </li>
  <li>
    <p><strong>내 지식/정리</strong> 는 <code class="language-plaintext highlighter-rouge">30_Areas/knowledge_base</code>(Vault),</p>
  </li>
  <li>
    <p><strong>실습/과제</strong> 는 <code class="language-plaintext highlighter-rouge">25_Jobs/LAB</code>로 분리하고, <strong>서로는 링크로만 연결</strong> 하세요.</p>
  </li>
</ul>

<p class="chat--user">

지금까지의 대화 내용을 정리해서 하나의 Markdown(<code class="language-plaintext highlighter-rouge">*.md</code>)으로 정리해줘. 1. 본문 내부에서 코드 블럭은 깨지니까 3 backticks를 ===로 대체해줘. 2. shortcuts.list 같은건 내가 알아서 다룰테니까 그냥 자세히 언급하지 말아줘. 3. 몇 가지 자주 사용할만한 예시들을 10개 정도 써줘.

</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh"># Work 폴더 운영 요약 (최종 정리)</span>
<span class="gt">
&gt; 목적: 1인 개발/분석 환경에서 **정본 위치**, **재현성**, **정리 루틴**, **작업 흐름**을 일관되게 유지한다.  </span>
<span class="gt">&gt; 루트는 기본 `~/Work` (필요 시 이식 가능).</span>
<span class="p">
---
</span>
<span class="gu">## 1) 최종 폴더 구조(요약 + 설명)</span>

Work/
├─ 00_README.md                       - 운영 규칙 요약(사람용 문서)
├─ 01_Inbox/                          - 임시 수집함(스크린샷/메모/임시 파일)
├─ 05_Downloads/                      - 다운로드 착륙지(정리 전)
│  ├─ _inbox/                         - 기본 저장 경로
│  ├─ installers/ datasets/ manuals/ assets/ quarantine/
├─ 06_Media/                          - 개인 음악/사진(업무와 분리; 선택)
├─ 10_Today/                          - 오늘 작업 대시보드(런처/헬퍼 스크립트)
│  └─ wrappers/                       - 셸 유지/환경 진입 래퍼
├─ 20_Projects/                       - 내가 개발·관리하는 <span class="gs">**코드 정본**</span>
│  └─ PRJ-YYYY-NNN_slug/              - 예: PRJ-2025-001_sample_app
│     ├─ src/<span class="nt">&lt;pkg&gt;</span>/ tests/ scripts/ examples/ docs/
│     └─ pyproject.toml 등
├─ 21_ExternalRepos/                  - 외부(3rd-party) 리포 로컬 클론
│  ├─ github/<span class="nt">&lt;org&gt;</span>/<span class="nt">&lt;repo&gt;</span>/
│  ├─ gitlab/<span class="nt">&lt;group&gt;</span>/<span class="nt">&lt;repo&gt;</span>/
│  └─ bitbucket/<span class="nt">&lt;team&gt;</span>/<span class="nt">&lt;repo&gt;</span>/
├─ 22_Labs/                           - 가벼운 실험/프로토(재현 불필요)
│  └─ jupyter/                        - 스크래치 노트북(예: regex_scratch.ipynb)
├─ 25_Jobs/                           - 산출 <span class="gs">**작업 단위**</span>(프로세스 수명 중심)
│  ├─ _active/                        - 진행 중(최대 12개 권장)
│  ├─ _templates/                     - JOB/BUG/SMOKE/LAB/EX/REL 스캐폴드
│  ├─ JOB/2025/  BUG/2025/  SMOKE/2025/  LAB/2025/  EX/2025/  REL/2025/
├─ 26_Datasets/                       - 데이터셋 <span class="gs">**정본**</span>(입력/파생)
│  ├─ registry/                       - 카탈로그(색인 파일)
│  ├─ datasets/<span class="nt">&lt;name&gt;</span>/vYYYY.MMDD/     - 입력 데이터 버전
│  │  ├─ raw/ interim/ processed/ samples/ docs/
│  │  ├─ manifest.yml  SHA256SUMS
│  ├─ derived/<span class="nt">&lt;artifact&gt;</span>/vYYYY.MMDD/  - 승격된 출력물
│  │  ├─ data/ metrics/ docs/ manifest.yml  SHA256SUMS
│  └─ cache/                          - 언제든 삭제 가능
├─ 30_Areas/                          - 장기 운영(정책/워크로그/지식)
│  ├─ worklog/YYYY/YY-MM/DATE.md
│  └─ knowledge_base/                 - 축적 지식(팁/치트시트/가이드)
│     └─ obsidian_vault/              - Obsidian Vault(업무용)
├─ 31_Conversations/                  - 대화 기록 정본(원본/정제/비식별)
│  ├─ inbox/ by_assistant/ by_topic/ redacted/ private_encrypted/
│  └─ templates/ scripts/
├─ 32_SharedConfigs/                  - <span class="gs">**공유/골든 설정**</span>(팀 표준)
│  ├─ global/{vscode,ruff,pytest,pyinstaller,pyside6,jupyter}/
│  └─ projects/<span class="nt">&lt;project_slug&gt;</span>/
├─ 40_Resources/                      - 외부 참고 자료(교육/매뉴얼/스펙)
│  ├─ edu/{courses, tutorials, papers/...}
│  ├─ manuals/<span class="nt">&lt;vendor&gt;</span>/<span class="nt">&lt;product&gt;</span>/<span class="nt">&lt;version&gt;</span>/
│  └─ reference/
├─ 50_Snippets/{sql,text,bash}/       - 재사용 코드/원라이너/문구 조각
├─ 60_Assets/                         - 로고/폰트/템플릿 등 <span class="gs">**업무 자산**</span>
│  └─ fonts/<span class="nt">&lt;Family&gt;</span>/vX.Y/{desktop,web,variable,license,specimen}/
├─ 70_Exports/                        - 여러 Job의 최종 전달본 모아보기(선택)
├─ 75_Releases/                       - 유저 배포(버전드)
│  └─ <span class="nt">&lt;project&gt;</span>/
│     ├─ vX.Y.Z/{installers,wheels,portable,docs,licenses,checksums,ReleaseNotes.md}
│     └─ latest -&gt; vX.Y.Z             - 최신 버전 포인터(상대 심볼릭)
├─ 80_Toolchains/                     - 고정 버전 빌드 도구(gcc/cmake/ninja…)
│  ├─ gcc/{13.3.0, latest-&gt;13.3.0}/
│  ├─ cmake/{3.29.3, latest-&gt;3.29.3}/
│  └─ ninja/{1.12.1, latest-&gt;1.12.1}/
├─ 81_SDKs/                           - 플랫폼 SDK/런타임(JDK/Qt/NDK/CUDA…)
│  ├─ jdk/{21.0.2, latest-&gt;21.0.2}/
│  └─ qt/{6.7.2-win-x64-msvc, latest-&gt;6.7.2-win-x64-msvc}/
├─ 82_Tools/                          - 개인·경량·포터블 유틸/관리 스크립트
│  ├─ installers/<span class="nt">&lt;tool&gt;</span>/<span class="nt">&lt;ver&gt;</span>/        - 설치 원본 + SHA256SUMS, install_notes.md
│  ├─ bin/                            - 어디서나 쓰는 개인 유틸(실행 파일)
│  ├─ portable/<span class="nt">&lt;tool&gt;</span>-<span class="nt">&lt;ver&gt;</span>/
│  ├─ scripts/                        - 체크섬/릴리스/부트스트랩 스크립트
│  └─ scratch/
├─ 83_Runtimes/                       - 언어 런타임(예: python)
│  └─ python/{3.12.5, 3.11.9, latest-&gt;3.12.5}/
├─ 85_Environments/                   - docker/conda/venv/devcontainer 캡슐
│  ├─ conda/environment.yml
│  ├─ docker/Dockerfile  compose.yml
│  └─ devcontainer/base/{Dockerfile, devcontainer.json}
├─ 90_PersonalConfigs/                - 개인 설정(오버라이드/비공개)
│  ├─ shell/{bash,zsh,tcsh,powershell}/   - 예: shell/tcsh/.tcshrc (홈에 심링크)
│  ├─ editors/vscode/{settings.user.json,keybindings.user.json}
│  ├─ git/.gitconfig.local  python/{pip.conf,poetry.toml,pypirc}
│  ├─ tools/ secrets/README.md  .gitignore
└─ 99_Archive/                        - 완료 항목 장기 보관(읽기 전용)
<span class="p">
---
</span>
<span class="gu">## 2) 핵심 원칙(간단)</span>
<span class="p">
1.</span> <span class="gs">**단일 정본 원칙**</span>  
<span class="p">   -</span> 코드: <span class="sb">`20_Projects`</span> / 작업: <span class="sb">`25_Jobs`</span> / 데이터: <span class="sb">`26_Datasets`</span>  
<span class="p">   -</span> 복사본 금지, <span class="gs">**링크/경로 참조**</span> 우선.
<span class="p">
2.</span> <span class="gs">**임시 ↔ 정본 분리**</span>  
<span class="p">   -</span> 임시: <span class="sb">`01_Inbox`</span>, <span class="sb">`05_Downloads/_inbox`</span>  
<span class="p">   -</span> 정리 후 전용 위치로 이동.
<span class="p">
3.</span> <span class="gs">**재현성**</span>  
<span class="p">   -</span> 데이터셋/릴리스/설치원본: <span class="gs">**버전(예: vYYYY.MMDD)**</span> + <span class="sb">`manifest.yml`</span> + <span class="sb">`SHA256SUMS`</span>.  
<span class="p">   -</span> Toolchains/SDKs: <span class="sb">`&lt;ver&gt;/`</span> + <span class="sb">`latest`</span>(상대 심볼릭).
<span class="p">
4.</span> <span class="gs">**환경 격리**</span>  
<span class="p">   -</span> 기본 Python: <span class="sb">`83_Runtimes/python/&lt;ver&gt;/`</span> + <span class="sb">`latest`</span>  
<span class="p">   -</span> 프로젝트 의존성: 각 PRJ의 <span class="sb">`.venv/`</span> 또는 <span class="sb">`85_Environments/conda`</span>.
<span class="p">
5.</span> <span class="gs">**이동 규칙**</span>  
<span class="p">   -</span> 같은 파일시스템: <span class="sb">`mv`</span>  
<span class="p">   -</span> 다른 파일시스템: <span class="sb">`rsync -a`</span> (macOS는 <span class="sb">`cp -pPR`</span>/<span class="sb">`ditto`</span>, Windows는 <span class="sb">`robocopy`</span>)
<span class="p">
6.</span> <span class="gs">**보안**</span>  
<span class="p">   -</span> 비밀/키/토큰: <span class="sb">`90_PersonalConfigs/secrets/`</span>에만. 코드/노트엔 하드코딩 금지.
<span class="p">
---
</span>
<span class="gu">## 3) 네이밍 &amp; 버전</span>
<span class="p">
-</span> 프로젝트: <span class="sb">`PRJ-YYYY-NNN_slug`</span>  
<span class="p">-</span> 작업(Job): <span class="sb">`JOB|BUG|SMOKE|LAB|EX|REL-YYYY-NNN_title`</span>  
<span class="p">-</span> 데이터셋 버전: <span class="sb">`vYYYY.MMDD`</span>  
<span class="p">-</span> portable 폴더: <span class="sb">`tool-version`</span> (예: <span class="sb">`gcc-13.3.0-linux-x64`</span>)  
<span class="p">-</span> 파일: <span class="sb">`YYYY-MM-DD_title_vNNN.ext`</span> 권장
<span class="p">
---
</span>
<span class="gu">## 4) 데이터셋 메타(템플릿)</span>

<span class="gu">**`manifest.yml` (입력 데이터셋 예시)**
===
</span>name: <span class="nt">&lt;dataset_name&gt;</span>
kind: dataset
version: vYYYY.MMDD
created_at: 2025-09-01T00:00:00+09:00
owner: you@company.com
source:
  type: <span class="nt">&lt;external</span><span class="err">|</span><span class="na">internal</span><span class="err">|</span><span class="na">manual</span><span class="nt">&gt;</span>
  detail: "<span class="nt">&lt;설명</span><span class="err">/</span><span class="na">링크</span><span class="nt">&gt;</span>"
schema:
  format: <span class="nt">&lt;parquet</span><span class="err">|</span><span class="na">csv</span><span class="err">|</span><span class="na">json</span><span class="err">|</span><span class="na">image</span><span class="err">|...</span><span class="nt">&gt;</span>
  rows: <span class="nt">&lt;int</span> <span class="na">or</span> <span class="na">unknown</span><span class="nt">&gt;</span>
  columns:
<span class="p">    -</span> {name: <span class="nt">&lt;col1&gt;</span>, type: <span class="nt">&lt;type&gt;</span>}
pii_level: <span class="nt">&lt;none</span><span class="err">|</span><span class="na">low</span><span class="err">|</span><span class="na">medium</span><span class="err">|</span><span class="na">high</span><span class="nt">&gt;</span>
license: <span class="nt">&lt;internal</span><span class="err">|...</span><span class="nt">&gt;</span>
files:
<span class="p">  -</span> {path: <span class="nt">&lt;relative</span><span class="err">/</span><span class="na">file</span><span class="nt">&gt;</span>, bytes: <span class="nt">&lt;int&gt;</span>, sha256: "<span class="nt">&lt;optional&gt;</span>"}
<span class="gu">notes: "&lt;전처리/주의사항&gt;"
===
</span>
<span class="gu">**체크섬 생성 (macOS/Linux)**
===
</span>cd <span class="nt">&lt;버전</span> <span class="na">루트</span><span class="nt">&gt;</span>
: &gt; SHA256SUMS
find . -type f ! -name 'SHA256SUMS' ! -name '.<span class="err">*</span>' -print0 <span class="err">\</span>
<span class="gu">| xargs -0 shasum -a 256 | sed 's#  #  #' &gt;&gt; SHA256SUMS
===
</span>
<span class="gu">**체크섬 생성 (Windows PowerShell)**
===
</span>$root = "<span class="nt">&lt;버전</span> <span class="na">루트</span><span class="nt">&gt;</span>"
Set-Location $root
Remove-Item -Force SHA256SUMS -ErrorAction SilentlyContinue
Get-ChildItem -Recurse -File -Force | Where-Object {
  $_.Name -ne 'SHA256SUMS' -and -not $_.Name.StartsWith('.')
} | ForEach-Object {
  $h=(Get-FileHash $_.FullName -Algorithm SHA256).Hash.ToLower()
  $rel=$_.FullName.Substring($root.Length+1).Replace('<span class="se">\'</span>,'/')
  "$h  $rel"
<span class="gu">} | Set-Content -NoNewline SHA256SUMS
===
</span><span class="p">
---
</span>
<span class="gu">## 5) Toolchains/SDKs &amp; Python</span>

<span class="gu">**latest 심볼릭 (macOS/Linux)**
===
</span>cd ~/Work/80_Toolchains/gcc
<span class="gu">ln -sfn 13.3.0 latest
===
</span>
<span class="gu">**Python 런타임 &amp; PATH**
===
</span><span class="gh"># bash/zsh</span>
export PATH="$HOME/Work/83_Runtimes/python/latest/bin:$PATH"

<span class="gh"># tcsh</span>
set path = ( $HOME/Work/83_Runtimes/python/latest/bin $path )

<span class="gh"># PowerShell</span>
<span class="gu">$env:Path = "$HOME\Work\83_Runtimes\python\latest;$HOME\Work\83_Runtimes\python\latest\Scripts;" + $env:Path
===
</span>
<span class="gu">**전역 CLI는 pipx 권장 (우리 트리에 맞춰)**
===
</span><span class="gh"># tcsh 예시</span>
setenv PIPX_HOME    "$HOME/Work/82_Tools/pipx"
setenv PIPX_BIN_DIR "$HOME/Work/82_Tools/bin"
set path = ( $PIPX_BIN_DIR $path )

<span class="gh"># 대표 명령</span>
pipx install ruff
pipx upgrade ruff
<span class="gu">pipx uninstall ruff
===
</span><span class="p">
---
</span>
<span class="gu">## 6) 외부 리포/대화/미디어 배치</span>
<span class="p">
-</span> 외부 클론: <span class="sb">`21_ExternalRepos/&lt;host&gt;/&lt;org&gt;/&lt;repo&gt;/`</span> (읽기 전용; 실험은 worktree로 <span class="sb">`22_Labs`</span>/<span class="sb">`25_Jobs/SMOKE`</span>에)  
<span class="p">-</span> 대화 기록: <span class="sb">`31_Conversations/`</span> (inbox→정제→비식별/암호화; 프로젝트/노트에서는 링크로 참조)  
<span class="p">-</span> 개인 음악/사진: <span class="sb">`06_Media/`</span> (업무와 분리; 프로젝트/노트에서는 링크로만)  
<span class="p">-</span> 교육 자료(수집물) vs 내 정리/실습(창작물):
<span class="p">  -</span> 수집물: <span class="sb">`40_Resources/edu/...`</span>
<span class="p">  -</span> 내 정리: <span class="sb">`30_Areas/knowledge_base/obsidian_vault/...`</span>
<span class="p">  -</span> 실습/과제: <span class="sb">`25_Jobs/LAB/...`</span>
<span class="p">
---
</span>
<span class="gu">## 7) 자주 쓰는 예시 10선 (step-by-step)</span>

<span class="gu">1) **새 프로젝트 시작 (파이썬 패키지)**
===
</span>base=~/Work/20_Projects/PRJ-2025-001_sample_app
mkdir -p $base/{src/sample_app,tests,scripts,examples,docs}
printf '%s<span class="se">\n</span>' "[project]<span class="se">\n</span>name='sample-app'" &gt; $base/pyproject.toml
<span class="gu">cd $base &amp;&amp; python3 -m venv .venv &amp;&amp; . .venv/bin/activate &amp;&amp; pip install -U build pytest
===
</span>
<span class="gu">2) **배포 예제(최소 실행 예시) 만들기**
===
</span>cd ~/Work/20_Projects/PRJ-2025-001_sample_app
mkdir -p examples/{data,scripts,docs}
<span class="gu">printf '%s\n' '# how to run\npython -m sample_app' &gt; examples/docs/README.md
===
</span>
<span class="gu">3) **릴리스 산출(휠) 빌드 &amp; 아카이브**
===
</span>cd ~/Work/20_Projects/PRJ-2025-001_sample_app
. .venv/bin/activate
python -m build
rel=~/Work/75_Releases/sample-app/v0.3.0
mkdir -p $rel/checksums &amp;&amp; cp dist/<span class="err">*</span> $rel/
<span class="gu">( cd $rel &amp;&amp; shasum -a 256 * &gt; checksums/SHA256SUMS &amp;&amp; ln -sfn v0.3.0 ../latest )
===
</span>
<span class="gu">4) **전역 CLI로 설치(pipx)**
===
</span>setenv PIPX_HOME "$HOME/Work/82_Tools/pipx"
setenv PIPX_BIN_DIR "$HOME/Work/82_Tools/bin"
<span class="gu">pipx install ~/Work/75_Releases/sample-app/v0.3.0/sample_app-0.3.0-py3-none-any.whl
===
</span>
<span class="gu">5) **새 데이터셋 버전 투입**
===
</span>base=~/Work/26_Datasets/datasets/ad_events/v2025.0901
mkdir -p $base/{raw,interim,processed,samples,docs}
mv ~/Downloads/ad_20250901.csv $base/raw/
printf '%s<span class="se">\n</span>' "name: ad_events<span class="se">\n</span>kind: dataset<span class="se">\n</span>version: v2025.0901" &gt; $base/manifest.yml
<span class="gu">( cd $base &amp;&amp; : &gt; SHA256SUMS &amp;&amp; find . -type f ! -name 'SHA256SUMS' -print0 | xargs -0 shasum -a 256 &gt;&gt; SHA256SUMS )
===
</span>
<span class="gu">6) **외부 리포 정리 위치로 이동**
===
</span>repo=~/Downloads/tmp/flask
url=$(git -C "$repo" config --get remote.origin.url)
host=$(echo "$url" | sed -E 's#(https?://|git@)([^/:]+).<span class="err">*</span>#<span class="se">\2</span>#')
org=$( echo "$url" | sed -E 's#.<span class="err">*</span>/([^/]+)/[^/]+(<span class="se">\.</span>git)?$#<span class="se">\1</span>#')
name=$(echo "$url" | sed -E 's#.<span class="err">*</span>/([^/]+)(<span class="se">\.</span>git)?$#<span class="se">\1</span>#')
dest="$HOME/Work/21_ExternalRepos/$host/$org/$name"
<span class="gu">mkdir -p "$(dirname "$dest")" &amp;&amp; mv "$repo" "$dest"
===
</span>
<span class="gu">7) **gcc 같은 툴체인 추가 &amp; 최신 링크 갱신**
===
</span>cd ~/Work/80_Toolchains/gcc
tar -xf ~/Work/82_Tools/installers/gcc/13.3.0/gcc-13.3.0.tar.xz -C .
mv gcc-13.3.0 13.3.0
<span class="gu">ln -sfn 13.3.0 latest
===
</span>
<span class="gu">8) **프로젝트별 venv에서만 쓰는 내부 CLI 설치**
===
</span>cd ~/Work/20_Projects/PRJ-APP
python3 -m venv .venv &amp;&amp; . .venv/bin/activate
pip install -e ../PRJ-UTILS-mytool
<span class="gu">mytool --help   # venv 안에서만 사용
===
</span>
<span class="gu">9) **대화 기록 정리(inbox → by_assistant)**
===
</span>src=~/Work/31_Conversations/inbox
dst=~/Work/31_Conversations/by_assistant/local_llm/$(date +%Y)/$(date +%Y-%m)
mkdir -p "$dst"
for f in "$src"/<span class="err">*</span>.md; do
  [ -e "$f" ] || continue
  ts=$(date +"%Y-%m-%d_%H%M-KST")
  mv "$f" "$dst/${ts}_localllm_$(basename "$f")"
<span class="gu">done
===
</span>
<span class="gu">10) **콘텐츠 수집물 vs 내 실습/정리 분리**
===
</span><span class="gh"># 수집물(읽기 전용)</span>
mkdir -p ~/Work/40_Resources/edu/courses/udemy/pyside6/v2025.0901/{slides,pdf,code}
<span class="gh"># 내 실습(재현 가능)</span>
mkdir -p ~/Work/25_Jobs/LAB/2025/LAB-2025-018_pyside6-tableview/{src,scripts,data}
<span class="gh"># 내 정리(노트)</span>
<span class="gu">mkdir -p ~/Work/30_Areas/knowledge_base/obsidian_vault/20_Topics
===
</span><span class="p">
---
</span>
<span class="gu">## 8) 자주 헷갈리는 포인트 정리</span>
<span class="p">
-</span> <span class="gs">**`mv` vs `cp -rf`**</span>: 동일 디스크면 <span class="sb">`mv`</span>가 안전·빠름. 다른 디스크로 옮길 땐 <span class="sb">`rsync -a`</span> 권장.  
<span class="p">-</span> <span class="gs">**`ln -sfn` 의미**</span>: <span class="sb">`-s`</span>(심볼릭), <span class="sb">`-f`</span>(기존 링크 덮어쓰기), <span class="sb">`-n`</span>(링크를 디렉터리로 따라가지 않음).  
<span class="p">-</span> <span class="gs">**venv/conda 복사 금지**</span>: 절대경로 내장 → 옮기면 깨질 수 있음(venv 재생성 또는 conda-pack).  
<span class="p">-</span> <span class="gs">**업무 자산 vs 엔터테인먼트**</span>: 업무 자산은 <span class="sb">`60_Assets`</span>, 개인 음악·사진은 <span class="sb">`06_Media`</span>.  
<span class="p">-</span> <span class="gs">**Obsidian Vault**</span>: 업무 지식은 <span class="sb">`30_Areas/knowledge_base/obsidian_vault/`</span>, 대용량은 링크만.
<span class="p">
---
</span>
<span class="gu">### 끝. 필요한 경우 이 문서를 `~/Work/00_README.md`로 저장하고, 변경 시 상단에 날짜를 갱신하세요.</span>
</code></pre></div></div>

<p class="chat--user">

근데 내가 실험한 결과를 다른 사람들에게 공유할 때도 있거든? 그런건 어떻게 해야할까

</p>

<p>좋아—<strong>“내가 실험한 결과를 다른 사람에게 공유”</strong>할 때는, 정본/재현성/보안 관점으로 아래처럼 나누면 깔끔해.</p>

<hr />

<h1 id="0-한눈-요약-어디에-둘까">0) 한눈 요약 (어디에 둘까?)</h1>

<ul>
  <li>
    <p><strong>실험의 정본과 작업 맥락</strong> : <code class="language-plaintext highlighter-rouge">25_Jobs/LAB/&lt;연도&gt;/LAB-YYYY-NNN_&lt;slug&gt;/</code></p>
  </li>
  <li>
    <p><strong>공유용 번들(동료 전달/고객 검토본)</strong> : <code class="language-plaintext highlighter-rouge">70_Exports/&lt;topic_or_audience&gt;/&lt;YYYY-MM-DD&gt;/</code></p>
  </li>
  <li>
    <p><strong>예제로 재사용할 가치가 클 때(튜토리얼/샘플 앱)</strong> : <code class="language-plaintext highlighter-rouge">25_Jobs/EX/&lt;연도&gt;/EX-YYYY-NNN_&lt;slug&gt;/</code> → 필요 시 zip을 <code class="language-plaintext highlighter-rouge">70_Exports</code>에 배포</p>
  </li>
  <li>
    <p><strong>공개 릴리스(버전드, 링크 고정 필요)</strong> : <code class="language-plaintext highlighter-rouge">75_Releases/&lt;project_or_kit&gt;/vX.Y.Z/</code>(+ <code class="language-plaintext highlighter-rouge">latest</code> 심볼릭, checksums)</p>
  </li>
  <li>
    <p><strong>데이터 공유(샘플/비식별)</strong> : <code class="language-plaintext highlighter-rouge">26_Datasets/derived/&lt;artifact&gt;-public/vYYYY.MMDD/</code> (manifest.yml + SHA256SUMS)</p>
  </li>
</ul>

<blockquote>
  <p>핵심: <strong>정본은 LAB/EX/REL에</strong> , <strong>전달용 패키징은 Exports/Release에</strong> , <strong>데이터는 Datasets에</strong>.</p>
</blockquote>

<hr />

<h1 id="1-의사결정-트리-step-by-step">1) 의사결정 트리 (step-by-step)</h1>

<ol>
  <li>
    <p><strong>대상/채널</strong></p>

    <ul>
      <li>
        <p>내부 동료? → <code class="language-plaintext highlighter-rouge">70_Exports</code> (빠른 전달)</p>
      </li>
      <li>
        <p>외부/고객/공개? → <code class="language-plaintext highlighter-rouge">75_Releases</code> (버전 고정/체크섬)</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>데이터 민감도</strong></p>

    <ul>
      <li>
        <p>민감함 → 비식별본을 <code class="language-plaintext highlighter-rouge">26_Datasets/derived/...-public/</code>로 만들고 <strong>거기만</strong> 포함</p>
      </li>
      <li>
        <p>민감 아님 → 그래도 <strong>샘플 소용량</strong> 만 포함(전량은 경로 링크)</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>재현성 필요 여부</strong></p>

    <ul>
      <li>
        <p>필요함 → <code class="language-plaintext highlighter-rouge">env/</code>(requirements/conda/docker) + <code class="language-plaintext highlighter-rouge">run</code> 스크립트 포함</p>
      </li>
      <li>
        <p>불필요 → 결과물/요약/스크린샷 중심의 “리포트 번들”</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>지속 가치</strong></p>

    <ul>
      <li>
        <p>튜토리얼·샘플로 재사용 가치 큼 → <strong>EX Job</strong> 로 승격</p>
      </li>
      <li>
        <p>단발 보고 → <strong>Exports</strong> 에만 두고 종료</p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h1 id="2-공유용-번들share-kit-표준-구조">2) “공유용 번들(Share Kit)” 표준 구조</h1>

<p>예) <code class="language-plaintext highlighter-rouge">70_Exports/pyside6-tableview/2025-09-01/</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sharekit/
├─ README.md                 # 목적/요약/Quickstart/라이선스
├─ env/                      # 재현 환경(필요할 때)
│  ├─ requirements.txt  또는  conda/environment.yml
│  └─ Dockerfile   (옵션)
├─ scripts/
│  ├─ run.sh     # macOS/Linux
│  └─ run.ps1    # Windows
├─ data/                     # 소용량 샘플(또는 data/README.md에 경로/버전 명시)
│  ├─ samples/
│  ├─ manifest.yml
│  └─ SHA256SUMS
├─ results/                  # 핵심 결과(그래프/표/리포트)
├─ refs/                     # 참고 링크/문서(원본은 40_Resources)
└─ LICENSE                   # 필요 시
</code></pre></div></div>

<ul>
  <li>
    <p><strong>정본 소스/노트</strong> 는 여기에 <strong>복사하지 말고</strong> :<br />
<code class="language-plaintext highlighter-rouge">LAB/…</code>와 <code class="language-plaintext highlighter-rouge">26_Datasets/…</code>를 <strong>상대경로 링크</strong> 나 <code class="language-plaintext highlighter-rouge">refs/READMEs</code>로 참조.</p>
  </li>
  <li>
    <p>공개 배포가 필요하면 이 <code class="language-plaintext highlighter-rouge">sharekit/</code>을 통째로 <code class="language-plaintext highlighter-rouge">75_Releases/&lt;name&gt;/vX.Y.Z/</code>로 승격.</p>
  </li>
</ul>

<hr />

<h1 id="3-체크리스트-공유-전">3) 체크리스트 (공유 전)</h1>

<ul>
  <li>
    <p><strong>보안/프라이버시</strong> : 토큰·키·사내 경로·고객명 제거/마스킹</p>
  </li>
  <li>
    <p><strong>데이터</strong> : 샘플만 포함, <strong>manifest.yml + SHA256SUMS</strong> 기록</p>
  </li>
  <li>
    <p><strong>재현성</strong> : 최소 하나의 경로(venv or conda or docker) 제공</p>
  </li>
  <li>
    <p><strong>경로 독립성</strong> : 스크립트는 상대경로 기준, OS별 한 줄 실행 제공</p>
  </li>
  <li>
    <p><strong>라이선스/출처</strong> : 외부 자료는 <code class="language-plaintext highlighter-rouge">refs/</code>에 출처/라이선스 표기</p>
  </li>
  <li>
    <p><strong>사이즈</strong> : zip ≤ 수십 MB 권장(대형 파일은 외부 저장소 링크)</p>
  </li>
</ul>

<hr />

<h1 id="4-바로-쓰는-템플릿들">4) 바로 쓰는 템플릿들</h1>

<h3 id="a-readmemd-스켈레톤">(A) README.md 스켈레톤</h3>

<p>===</p>

<h1 id="projectexperiment-title">&lt;Project/Experiment Title&gt;</h1>

<h2 id="goal">Goal</h2>

<ul>
  <li>문제/가설/평가지표 한 줄 요약</li>
</ul>

<h2 id="quickstart">Quickstart</h2>

<ul>
  <li>
    <p>macOS/Linux: <code class="language-plaintext highlighter-rouge">./scripts/run.sh</code></p>
  </li>
  <li>
    <p>Windows: <code class="language-plaintext highlighter-rouge">.\scripts\run.ps1</code></p>
  </li>
  <li>
    <p>데이터: <code class="language-plaintext highlighter-rouge">data/README.md</code> 참고(샘플 포함, 전체는 링크)</p>
  </li>
</ul>

<h2 id="reproduce">Reproduce</h2>

<ul>
  <li>
    <p>env:</p>

    <ul>
      <li>
        <p>venv: <code class="language-plaintext highlighter-rouge">python -m venv .venv &amp;&amp; . .venv/bin/activate &amp;&amp; pip -r env/requirements.txt</code></p>
      </li>
      <li>
        <p>or conda: <code class="language-plaintext highlighter-rouge">conda env create -f env/environment.yml &amp;&amp; conda activate &lt;name&gt;</code></p>
      </li>
      <li>
        <p>or docker: <code class="language-plaintext highlighter-rouge">docker build -t &lt;tag&gt; -f env/Dockerfile . &amp;&amp; docker run ...</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p>run: <code class="language-plaintext highlighter-rouge">./scripts/run.sh</code> / <code class="language-plaintext highlighter-rouge">.\scripts\run.ps1</code></p>
  </li>
</ul>

<h2 id="results">Results</h2>

<ul>
  <li>핵심 표/그래프/숫자 요약 (상세는 results/)</li>
</ul>

<h2 id="data">Data</h2>

<ul>
  <li>
    <p>샘플: <code class="language-plaintext highlighter-rouge">data/samples</code> (버전: vYYYY.MMDD)</p>
  </li>
  <li>
    <p>전체: <code class="language-plaintext highlighter-rouge">../../../../26_Datasets/&lt;path&gt;</code> (읽기 전용)</p>
  </li>
</ul>

<h2 id="references">References</h2>

<ul>
  <li>
    <h1 id="내부외부-링크40_resources-논문문서">내부/외부 링크(40_Resources, 논문/문서)</h1>
  </li>
</ul>

<h3 id="b-envrequirementstxt-생성venv">(B) env/requirements.txt 생성(venv)</h3>

<h1>===</h1>
<p>python -m venv .venv<br />
. .venv/bin/activate<br />
pip install -U pip wheel<br />
pip freeze &gt; env/requirements.txt</p>

<h3 id="c-샘플-데이터-체크섬">(C) 샘플 데이터 체크섬</h3>

<h1 id="-1">===</h1>
<dl>
  <dt>cd data</dt>
  <dd>
    <blockquote>
      <p>SHA256SUMS<br />
find samples -type f -print0 | xargs -0 shasum -a 256 » SHA256SUMS</p>
    </blockquote>
  </dd>
</dl>

<h3 id="d-runsh--runps1-예시상대경로-결과-폴더-보장">(D) run.sh / run.ps1 예시(상대경로, 결과 폴더 보장)</h3>

<h1 id="-2">===</h1>
<p>#!/usr/bin/env bash<br />
set -euo pipefail<br />
here="$(cd "$(dirname "$0")"/.. &amp;&amp; pwd)"<br />
mkdir -p "$here/results"<br />
python "$here/src/main.py" –input "$here/data/samples" –out "$here/results"<br />
echo "done -&gt; $here/results"</p>

<p>===</p>

<h1 id="powershell-5">PowerShell</h1>

<h1 id="here--split-path--parent-split-path--parent-myinvocationmycommandpath">$here = Split-Path -Parent (Split-Path -Parent $MyInvocation.MyCommand.Path)</h1>
<p>New-Item -ItemType Directory -Force -Path "$here\results" | Out-Null<br />
python "$here\src\main.py" –input "$here\data\samples" –out "$here\results"<br />
Write-Host "done -&gt; $here\results"</p>

<hr />

<h1 id="5-어디에-둘지-매핑-예시">5) 어디에 둘지 매핑 예시</h1>

<ul>
  <li>
    <p><strong>동료 리뷰용 1차 전달</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">70_Exports/pyside6-tableview/2025-09-01/sharekit.zip</code></p>
      </li>
      <li>
        <p>메시지엔 <code class="language-plaintext highlighter-rouge">LAB</code> 정본 경로/데이터셋 버전 링크 포함</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>블로그/깃허브 예제로 재사용</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">25_Jobs/EX/2025/EX-2025-012_tableview-demo/</code>에 정리</p>
      </li>
      <li>
        <p>공개 시 <code class="language-plaintext highlighter-rouge">75_Releases/tableview-demo/v1.0.0/</code> 배포(+ checksums, latest)</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>고객 재현 패키지</strong></p>

    <ul>
      <li>
        <p>고객 환경 한정 종속성이면 <code class="language-plaintext highlighter-rouge">env/Dockerfile</code> 포함</p>
      </li>
      <li>
        <p>데이터는 비식별 <code class="language-plaintext highlighter-rouge">26_Datasets/derived/&lt;name&gt;-public/…</code>만</p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h1 id="6-흔한-함정--예방">6) 흔한 함정 &amp; 예방</h1>

<ul>
  <li>
    <p><strong>프로젝트 폴더에 대용량 데이터 복사</strong> ❌ → 항상 <code class="language-plaintext highlighter-rouge">26_Datasets</code> 참조</p>
  </li>
  <li>
    <p><strong>하드코딩된 절대경로</strong> ❌ → <strong>상대경로</strong> + <code class="language-plaintext highlighter-rouge">here</code> 변수</p>
  </li>
  <li>
    <p><strong>OS 한쪽만 스크립트</strong> ❌ → <code class="language-plaintext highlighter-rouge">run.sh</code> + <code class="language-plaintext highlighter-rouge">run.ps1</code> 둘 다 제공</p>
  </li>
  <li>
    <p><strong>비밀 포함</strong> ❌ → 환경변수(<code class="language-plaintext highlighter-rouge">.env.example</code>)로 주입, 값은 <code class="language-plaintext highlighter-rouge">90_PersonalConfigs/secrets</code>에</p>
  </li>
</ul>

<hr />

<p>원하면 네가 방금 끝낸 실험 하나를 골라 주면, 위 표준에 맞는 <strong>sharekit 스캐폴드</strong> 를 바로 만들어 줄게.</p>

<p class="chat--user">

지금까지의 대화 내용을 정리해서 누구나 Work 폴더를 파악할 수 있게 하나의 Markdown(*.md)으로 정리해줘. 1. 본문 내부에서 코드 블럭은 깨지니까 3 backticks를 ===로 대체해줘. 2. shortcuts.list 같은건 내가 알아서 다룰테니까 그냥 자세히 언급하지 말아줘. 3. 몇 가지 자주 사용할만한 예시들을 10개 정도 써줘. 4. pipx 안쓸거야. 5. 06_Media 폴더도 안쓸거야.

</p>

<h1 id="work-폴더-운영-가이드-최종-요약">Work 폴더 운영 가이드 (최종 요약)</h1>

<blockquote>
  <p>목표: 1인 개발/분석 환경에서 <strong>정본 위치</strong> , <strong>재현성</strong> , <strong>정리 루틴</strong> , <strong>작업 흐름</strong> 을 일관되게 유지한다.<br />
 루트는 기본 <code class="language-plaintext highlighter-rouge">~/Work</code> (원하면 다른 경로로 이식 가능).</p>
</blockquote>

<hr />

<h2 id="1-최종-폴더-트리-요약--설명">1) 최종 폴더 트리 (요약 + 설명)</h2>

<h1 id="-3">===</h1>
<p>Work/<br />
├─ 00_README.md - 운영 규칙 요약(사람용 문서)<br />
├─ 01_Inbox/ - 임시 수집함(스크린샷/메모/임시 파일)<br />
├─ 05_Downloads/ - 다운로드 착륙지(정리 전)<br />
│ ├─ _inbox/ - 기본 저장 경로<br />
│ ├─ installers/ datasets/ manuals/ assets/ quarantine/<br />
├─ 10_Today/ - 오늘 작업 대시보드(런처/헬퍼)<br />
│ └─ wrappers/ - 셸 유지/환경 진입 래퍼<br />
├─ 20_Projects/ - 내가 개발·관리하는 <strong>코드 정본</strong><br />
│ └─ PRJ-YYYY-NNN_slug/ - 예: PRJ-2025-001_sample_app<br />
│ ├─ src/<pkg>/ tests/ scripts/ examples/ docs/  
│ └─ pyproject.toml …  
├─ 21_ExternalRepos/ - 외부(3rd-party) 리포 로컬 클론(읽기 전용)  
│ ├─ github/<org>/<repo>/  
│ ├─ gitlab/<group>/<repo>/  
│ └─ bitbucket/<team>/<repo>/  
├─ 22_Labs/ - 가벼운 실험/프로토(재현 불필요)  
│ └─ jupyter/ - 스크래치 노트북  
├─ 25_Jobs/ - 산출 **작업 단위**(프로세스 수명 중심)  
│ ├─ _active/ - 진행 중(최대 12개 권장)  
│ ├─ _templates/ - JOB/BUG/SMOKE/LAB/EX/REL 스캐폴드  
│ ├─ JOB/2025/ BUG/2025/ SMOKE/2025/ LAB/2025/ EX/2025/ REL/2025/  
├─ 26_Datasets/ - 데이터셋 **정본**(입력/파생)  
│ ├─ registry/ - 카탈로그(색인 파일)  
│ ├─ datasets/<name>/vYYYY.MMDD/ - 입력 데이터 버전  
│ │ ├─ raw/ interim/ processed/ samples/ docs/  
│ │ ├─ manifest.yml SHA256SUMS  
│ ├─ derived/<artifact>/vYYYY.MMDD/ - 승격된 출력물  
│ │ ├─ data/ metrics/ docs/ manifest.yml SHA256SUMS  
│ └─ cache/ - 언제든 삭제 가능  
├─ 30_Areas/ - 장기 운영(정책/워크로그/지식)  
│ ├─ worklog/YYYY/YY-MM/DATE.md  
│ └─ knowledge_base/ - 축적 지식(팁/치트시트/가이드)  
│ └─ obsidian_vault/ - Obsidian Vault(업무용)  
├─ 31_Conversations/ - 대화 기록 정본(원본/정제/비식별/암호화)  
│ ├─ inbox/ by_assistant/ by_topic/ redacted/ private_encrypted/  
│ └─ templates/ scripts/  
├─ 32_SharedConfigs/ - **공유/골든 설정**(팀 표준)  
│ ├─ global/{vscode,ruff,pytest,pyinstaller,pyside6,jupyter}/  
│ └─ projects/<project_slug>/  
├─ 40_Resources/ - 외부 참고 자료(교육/매뉴얼/스펙)  
│ ├─ edu/{courses, tutorials, papers/...}  
│ ├─ manuals/<vendor>/<product>/<version>/  
│ └─ reference/  
├─ 50_Snippets/{sql,text,bash}/ - 재사용 코드/원라이너/문구 조각  
├─ 60_Assets/ - 로고/폰트/템플릿 등 **업무 자산**  
│ └─ fonts/<Family>/vX.Y/{desktop,web,variable,license,specimen}/  
├─ 70_Exports/ - **공유용 번들/전달본** 모아두는 곳  
├─ 75_Releases/ - 유저 배포(버전드)  
│ └─ <project>/  
│ ├─ vX.Y.Z/{installers,wheels,portable,docs,licenses,checksums,ReleaseNotes.md}  
│ └─ latest -&gt; vX.Y.Z - 최신 포인터(상대 심볼릭)  
├─ 80_Toolchains/ - 고정 버전 빌드 도구(gcc/cmake/ninja…)  
│ ├─ gcc/{13.3.0, latest-&gt;13.3.0}/  
│ ├─ cmake/{3.29.3, latest-&gt;3.29.3}/  
│ └─ ninja/{1.12.1, latest-&gt;1.12.1}/  
├─ 81_SDKs/ - 플랫폼 SDK/런타임(JDK/Qt/NDK/CUDA…)  
│ ├─ jdk/{21.0.2, latest-&gt;21.0.2}/  
│ └─ qt/{6.7.2-win-x64-msvc, latest-&gt;6.7.2-win-x64-msvc}/  
├─ 82_Tools/ - 개인·경량·포터블 유틸/관리 스크립트  
│ ├─ installers/<tool>/<ver>/ - 설치 원본 + SHA256SUMS, install_notes.md  
│ ├─ bin/ - 어디서나 쓰는 개인 유틸(실행 파일)  
│ ├─ portable/<tool>-<ver>/  
│ ├─ scripts/ - 체크섬/릴리스/부트스트랩 스크립트  
│ └─ scratch/  
├─ 83_Runtimes/ - 언어 런타임(예: python)  
│ └─ python/{3.12.5, 3.11.9, latest-&gt;3.12.5}/  
├─ 85_Environments/ - docker/conda/venv/devcontainer 캡슐  
│ ├─ conda/environment.yml  
│ ├─ docker/Dockerfile compose.yml  
│ └─ devcontainer/base/{Dockerfile, devcontainer.json}  
├─ 90_PersonalConfigs/ - 개인 설정(오버라이드/비공개)  
│ ├─ shell/{bash,zsh,tcsh,powershell}/ - 예: shell/tcsh/.tcshrc (홈에 심링크)  
│ ├─ editors/vscode/{settings.user.json,keybindings.user.json}  
│ ├─ git/.gitconfig.local python/{pip.conf,poetry.toml,pypirc}  
│ ├─ tools/ secrets/README.md .gitignore  
└─ 99_Archive/ - 완료 항목 장기 보관(읽기 전용)</ver></tool></ver></tool></project></Family></version></product></vendor></project_slug></artifact></name></repo></team></repo></group></repo></org></pkg></p>

<hr />

<h2 id="2-핵심-원칙-간단">2) 핵심 원칙 (간단)</h2>

<p>1</p>

<p class="chat--user">

지금까지의 대화 내용을 정리해서 누구나 Work 폴더를 파악할 수 있게 하나의 Markdown(*.md)으로 정리해줘. 1. 본문 내부에서 코드 블럭은 깨지니까 3 backticks를 ===로 대체해줘. (markdown을 감싸는 처음과 끝의 backticks는 유지) 2. shortcuts.list 같은건 내가 알아서 다룰테니까 그냥 자세히 언급하지 말아줘. 3. 몇 가지 자주 사용할만한 예시들을 10개 정도 써줘. 4. pipx 안쓸거야. 5. 06_Media 폴더도 안쓸거야.

</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh"># Work 폴더 운영 가이드 (최종 요약)</span>
<span class="gt">
&gt; 목적: 누구나 `~/Work` 트리를 빠르게 이해하고, **정본 위치**, **재현성**, **정리 루틴**, **작업 흐름**을 일관되게 유지하도록 돕습니다.  </span>
<span class="gt">&gt; 본 문서는 사람용 가이드입니다(LLM 프롬프트는 `90_PersonalConfigs/llm_config/` 등 별도 보관).</span>
<span class="p">
---
</span>
<span class="gu">## 1) TL;DR</span>
<span class="p">
-</span> <span class="gs">**임시 ↔ 정본 분리**</span>: <span class="sb">`01_Inbox`</span>, <span class="sb">`05_Downloads/_inbox`</span>는 착륙지만, 정본은 각 전용 위치로 이동.  
<span class="p">-</span> <span class="gs">**단일 정본 원칙**</span>  
<span class="p">  -</span> 코드: <span class="sb">`20_Projects`</span>  
<span class="p">  -</span> 작업(산출 단위): <span class="sb">`25_Jobs`</span>  
<span class="p">  -</span> 데이터: <span class="sb">`26_Datasets`</span> (버전+메타)  
<span class="p">-</span> <span class="gs">**툴 스택 분리**</span>: 툴체인(80) / SDK(81) / 개인 유틸(82) / 런타임(83) / 환경 캡슐(85)  
<span class="p">-</span> <span class="gs">**Python**</span>: 기본 인터프리터는 <span class="sb">`83_Runtimes/python/&lt;ver&gt;/`</span>(+<span class="sb">`latest`</span>), 각 프로젝트는 <span class="gs">**자체 venv**</span>.  
<span class="p">-</span> <span class="gs">**공유/배포**</span>: 빠른 전달은 <span class="sb">`70_Exports/`</span>, 공개 버전드는 <span class="sb">`75_Releases/`</span>.  
<span class="p">-</span> <span class="gs">**교육 자료 vs 내 정리/실습**</span>:  
<span class="p">  -</span> 수집물 원본 → <span class="sb">`40_Resources/edu`</span>  
<span class="p">  -</span> 내 정리(노트) → <span class="sb">`30_Areas/knowledge_base/obsidian_vault`</span>  
<span class="p">  -</span> 실습/과제(재현 가능) → <span class="sb">`25_Jobs/LAB`</span>  
<span class="p">
---
</span>
<span class="gu">## 2) 최종 폴더 트리 (요약 + 설명)</span>

===
Work/
├─ 00_README.md                         - 운영 규칙 요약(이 문서)
├─ 01_Inbox/                            - 임시 수집함(스크린샷/메모/임시 파일)
├─ 05_Downloads/                        - 다운로드 착륙지(정리 전)
│  ├─ _inbox/                           - 기본 저장 경로
│  ├─ installers/ datasets/ manuals/ assets/ quarantine/
├─ 10_Today/                            - 오늘 작업 대시보드(런처/헬퍼 배치)
│  └─ wrappers/                         - 셸 유지/환경 진입 래퍼
├─ 20_Projects/                         - 내가 개발·관리하는 <span class="gs">**코드 정본**</span>
│  └─ PRJ-YYYY-NNN_slug/
│     ├─ src/<span class="nt">&lt;pkg&gt;</span>/ tests/ scripts/ examples/ docs/
│     └─ pyproject.toml …
├─ 21_ExternalRepos/                    - 외부(3rd-party) 리포 로컬 클론(읽기 전용)
│  ├─ github/<span class="nt">&lt;org&gt;</span>/<span class="nt">&lt;repo&gt;</span>/  gitlab/<span class="nt">&lt;group&gt;</span>/<span class="nt">&lt;repo&gt;</span>/  bitbucket/<span class="nt">&lt;team&gt;</span>/<span class="nt">&lt;repo&gt;</span>/
├─ 22_Labs/                             - 가벼운 실험/프로토(재현 불필요)
│  └─ jupyter/
├─ 25_Jobs/                             - 산출 <span class="gs">**작업 단위**</span>(프로세스 수명 중심)
│  ├─ _active/                          - 진행 중(최대 12개 권장)
│  ├─ _templates/                       - JOB/BUG/SMOKE/LAB/EX/REL 스캐폴드
│  ├─ JOB/2025/  BUG/2025/  SMOKE/2025/  LAB/2025/  EX/2025/  REL/2025/
├─ 26_Datasets/                         - 데이터셋 <span class="gs">**정본**</span>(입력/파생)
│  ├─ registry/
│  ├─ datasets/<span class="nt">&lt;name&gt;</span>/vYYYY.MMDD/{raw,interim,processed,samples,docs,manifest.yml,SHA256SUMS}
│  ├─ derived/<span class="nt">&lt;artifact&gt;</span>/vYYYY.MMDD/{data,metrics,docs,manifest.yml,SHA256SUMS}
│  └─ cache/
├─ 30_Areas/                            - 장기 운영(정책/워크로그/지식)
│  ├─ worklog/YYYY/YY-MM/DATE.md
│  └─ knowledge_base/
│     └─ obsidian_vault/
├─ 31_Conversations/                    - 대화 기록(원본/정제/비식별/암호화)
│  ├─ inbox/ by_assistant/ by_topic/ redacted/ private_encrypted/
│  └─ templates/ scripts/
├─ 32_SharedConfigs/                    - <span class="gs">**공유/골든 설정**</span>(팀 표준)
│  ├─ global/{vscode,ruff,pytest,pyinstaller,pyside6,jupyter}/
│  └─ projects/<span class="nt">&lt;project_slug&gt;</span>/
├─ 40_Resources/                        - 외부 참고 자료(교육/매뉴얼/스펙)
│  ├─ edu/{courses, tutorials, papers/...}
│  ├─ manuals/<span class="nt">&lt;vendor&gt;</span>/<span class="nt">&lt;product&gt;</span>/<span class="nt">&lt;version&gt;</span>/
│  └─ reference/
├─ 50_Snippets/{sql,text,bash}/         - 재사용 코드/원라이너/문구 조각
├─ 60_Assets/                           - 로고/폰트/템플릿 등 <span class="gs">**업무 자산**</span>
│  └─ fonts/<span class="nt">&lt;Family&gt;</span>/vX.Y/{desktop,web,variable,license,specimen}/
├─ 70_Exports/                          - <span class="gs">**공유용 번들/전달본**</span> 모음
├─ 75_Releases/                         - 유저 배포(버전드)
│  └─ <span class="nt">&lt;project&gt;</span>/vX.Y.Z/{installers,wheels,portable,docs,licenses,checksums,ReleaseNotes.md}
│     └─ latest -&gt; vX.Y.Z               # 최신 포인터(상대 심볼릭)
├─ 80_Toolchains/                       - 고정 버전 빌드 도구(gcc/cmake/ninja…)
│  ├─ gcc/{13.3.0, latest-&gt;13.3.0}/  cmake/{3.29.3, latest-&gt;3.29.3}/  ninja/{1.12.1, latest-&gt;1.12.1}/
├─ 81_SDKs/                             - 플랫폼 SDK/런타임(JDK/Qt/NDK/CUDA…)
│  ├─ jdk/{21.0.2, latest-&gt;21.0.2}/  qt/{6.7.2-win-x64-msvc, latest-&gt;6.7.2-win-x64-msvc}/
├─ 82_Tools/                            - 개인·경량·포터블 유틸/관리 스크립트
│  ├─ installers/<span class="nt">&lt;tool&gt;</span>/<span class="nt">&lt;ver&gt;</span>/          # 설치 원본 + SHA256SUMS, install_notes.md
│  ├─ bin/  portable/<span class="nt">&lt;tool&gt;</span>-<span class="nt">&lt;ver&gt;</span>/  scripts/  scratch/
├─ 83_Runtimes/                         - 언어 런타임(예: python)
│  └─ python/{3.12.5, 3.11.9, latest-&gt;3.12.5}/
├─ 85_Environments/                     - docker/conda/venv/devcontainer 캡슐
│  ├─ conda/environment.yml  docker/{Dockerfile,compose.yml}  devcontainer/base/{Dockerfile,devcontainer.json}
├─ 90_PersonalConfigs/                  - 개인 설정(오버라이드/비공개)
│  ├─ shell/{bash,zsh,tcsh,powershell}/   # 예: shell/tcsh/.tcshrc (홈에 심링크)
│  ├─ editors/vscode/{settings.user.json,keybindings.user.json}
│  ├─ git/.gitconfig.local  python/{pip.conf,poetry.toml,pypirc}  tools/  secrets/README.md  .gitignore
<span class="gu">└─ 99_Archive/                          - 완료 항목 장기 보관(읽기 전용)
===
</span><span class="gt">
&gt; 참고: Today 런처/단축은 간단히만 언급하고 세부는 생략합니다.</span>
<span class="p">
---
</span>
<span class="gu">## 3) 네이밍 &amp; 버전 규칙</span>
<span class="p">
-</span> 프로젝트: <span class="sb">`PRJ-YYYY-NNN_slug`</span>  
<span class="p">-</span> 작업(Job): <span class="sb">`JOB|BUG|SMOKE|LAB|EX|REL-YYYY-NNN_title`</span>  
<span class="p">-</span> 데이터셋 버전: <span class="sb">`vYYYY.MMDD`</span> (예: <span class="sb">`v2025.0901`</span>)  
<span class="p">-</span> Toolchains/SDK 폴더: <span class="sb">`&lt;tool&gt;/&lt;version&gt;/`</span> + <span class="sb">`latest -&gt; &lt;version&gt;`</span>(상대 심볼릭)  
<span class="p">-</span> 파일: <span class="sb">`YYYY-MM-DD_title_vNNN.ext`</span> 권장
<span class="p">
---
</span>
<span class="gu">## 4) 결정 가이드 (어디에 둘까?)</span>
<span class="p">
-</span> <span class="gs">**코드 소스**</span> → <span class="sb">`20_Projects`</span>  
<span class="p">-</span> <span class="gs">**실행/분석/리포트 작업**</span> → <span class="sb">`25_Jobs`</span>  
<span class="p">-</span> <span class="gs">**입력/출력 데이터 정본**</span> → <span class="sb">`26_Datasets`</span>  
<span class="p">-</span> <span class="gs">**외부 레포(연구/분석용 클론)**</span> → <span class="sb">`21_ExternalRepos`</span> (읽기 전용, 실험은 worktree로 <span class="sb">`22_Labs`</span>/<span class="sb">`25_Jobs/SMOKE`</span>)  
<span class="p">-</span> <span class="gs">**교육 수집물**</span> → <span class="sb">`40_Resources/edu`</span> / <span class="gs">**내 정리 노트**</span> → <span class="sb">`30_Areas/knowledge_base/obsidian_vault`</span> / <span class="gs">**실습**</span> → <span class="sb">`25_Jobs/LAB`</span>  
<span class="p">-</span> <span class="gs">**빠른 공유 번들**</span> → <span class="sb">`70_Exports`</span> / <span class="gs">**공개 릴리스**</span> → <span class="sb">`75_Releases`</span>  
<span class="p">-</span> <span class="gs">**공유 설정**</span> → <span class="sb">`32_SharedConfigs`</span> / <span class="gs">**개인 설정**</span> → <span class="sb">`90_PersonalConfigs`</span>
<span class="p">
---
</span>
<span class="gu">## 5) 데이터셋 메타(템플릿 &amp; 체크섬)</span>

<span class="gu">**`manifest.yml` (입력 데이터셋 예시)**  
===
</span>name: <span class="nt">&lt;dataset_name&gt;</span>
kind: dataset
version: vYYYY.MMDD
created_at: 2025-09-01T00:00:00+09:00
owner: you@company.com
source:
  type: <span class="nt">&lt;external</span><span class="err">|</span><span class="na">internal</span><span class="err">|</span><span class="na">manual</span><span class="nt">&gt;</span>
  detail: "<span class="nt">&lt;설명</span><span class="err">/</span><span class="na">링크</span><span class="nt">&gt;</span>"
schema:
  format: <span class="nt">&lt;parquet</span><span class="err">|</span><span class="na">csv</span><span class="err">|</span><span class="na">json</span><span class="err">|</span><span class="na">image</span><span class="err">|...</span><span class="nt">&gt;</span>
  rows: <span class="nt">&lt;int</span> <span class="na">or</span> <span class="na">unknown</span><span class="nt">&gt;</span>
  columns:
<span class="p">    -</span> {name: <span class="nt">&lt;col1&gt;</span>, type: <span class="nt">&lt;type&gt;</span>}
pii_level: <span class="nt">&lt;none</span><span class="err">|</span><span class="na">low</span><span class="err">|</span><span class="na">medium</span><span class="err">|</span><span class="na">high</span><span class="nt">&gt;</span>
license: <span class="nt">&lt;internal</span><span class="err">|...</span><span class="nt">&gt;</span>
files:
<span class="p">  -</span> {path: <span class="nt">&lt;relative</span><span class="err">/</span><span class="na">file</span><span class="nt">&gt;</span>, bytes: <span class="nt">&lt;int&gt;</span>, sha256: "<span class="nt">&lt;optional&gt;</span>"}
<span class="gu">notes: "&lt;전처리/주의사항&gt;"
===
</span>
<span class="gu">**체크섬 생성 (macOS/Linux)**  
===
</span>cd <span class="nt">&lt;버전</span> <span class="na">루트</span><span class="nt">&gt;</span>
: &gt; SHA256SUMS
find . -type f ! -name 'SHA256SUMS' ! -name '.<span class="err">*</span>' -print0 <span class="err">\</span>
<span class="gu">| xargs -0 shasum -a 256 | sed 's#  #  #' &gt;&gt; SHA256SUMS
===
</span>
<span class="gu">**체크섬 생성 (Windows PowerShell)**  
===
</span>$root = "<span class="nt">&lt;버전</span> <span class="na">루트</span><span class="nt">&gt;</span>"
Set-Location $root
Remove-Item -Force SHA256SUMS -ErrorAction SilentlyContinue
Get-ChildItem -Recurse -File -Force | Where-Object {
  $_.Name -ne 'SHA256SUMS' -and -not $_.Name.StartsWith('.')
} | ForEach-Object {
  $h=(Get-FileHash $_.FullName -Algorithm SHA256).Hash.ToLower()
  $rel=$_.FullName.Substring($root.Length+1).Replace('<span class="se">\'</span>,'/')
  "$h  $rel"
<span class="gu">} | Set-Content -NoNewline SHA256SUMS
===
</span><span class="p">
---
</span>
<span class="gu">## 6) 툴/SDK/런타임/환경 운용</span>
<span class="p">
-</span> <span class="gs">**80_Toolchains**</span>: gcc/cmake/ninja 등 <span class="gs">**고정 버전**</span> 보관, <span class="sb">`latest`</span> 심볼릭 운영  
<span class="p">-</span> <span class="gs">**81_SDKs**</span>: JDK/Qt/NDK/CUDA 등 플랫폼 SDK  
<span class="p">-</span> <span class="gs">**82_Tools**</span>: 개인 유틸 실행 파일(전역 PATH에 추가), 설치 원본은 <span class="sb">`installers/`</span>에 보관(+체크섬)  
<span class="p">-</span> <span class="gs">**83_Runtimes**</span>: 기본 Python 등 언어 런타임(버전 병치, <span class="sb">`latest`</span> 링크)  
<span class="p">-</span> <span class="gs">**85_Environments**</span>: 프로젝트 무관 <span class="gs">**환경 캡슐**</span> (docker/conda/venv/devcontainer)

<span class="gu">**Python PATH 예시**  
===
</span><span class="gh"># bash/zsh</span>
export PATH="$HOME/Work/83_Runtimes/python/latest/bin:$PATH"

<span class="gh"># tcsh</span>
set path = ( $HOME/Work/83_Runtimes/python/latest/bin $path )

<span class="gh"># PowerShell</span>
<span class="gu">$env:Path = "$HOME\Work\83_Runtimes\python\latest;$HOME\Work\83_Runtimes\python\latest\Scripts;" + $env:Path
===
</span>
<span class="gs">**“전역처럼 쓰고 싶은 CLI” (pipx 미사용 방침)**</span>  
<span class="p">-</span> 방법 A: <span class="gs">**전용 venv**</span>를 <span class="sb">`85_Environments/venv/tools-&lt;pyver&gt;/`</span>로 만들고, 그 <span class="sb">`bin/`</span>을 PATH 앞에 둔다.  
<span class="p">-</span> 방법 B: 프로젝트 venv의 콘솔 스크립트를 <span class="gs">**`82_Tools/bin/`에 심볼릭 링크**</span>로 노출(venv 삭제 시 링크 깨짐 주의).  

<span class="gu">전용 venv 스케치:  
===
</span><span class="gh"># macOS/Linux</span>
env=~/Work/85_Environments/venv/tools-3.12
python3 -m venv "$env"
. "$env/bin/activate" &amp;&amp; pip install -U pip wheel ruff black httpie
<span class="gu">echo 'export PATH="$HOME/Work/85_Environments/venv/tools-3.12/bin:$PATH"' &gt;&gt; ~/.zshrc
===
</span><span class="p">
---
</span>
<span class="gu">## 7) 공유/배포 가이드</span>
<span class="p">
-</span> <span class="gs">**내부 공유(빠른 전달)**</span> → <span class="sb">`70_Exports/&lt;topic&gt;/&lt;YYYY-MM-DD&gt;/sharekit/`</span>  
<span class="p">  -</span> <span class="sb">`README.md`</span>, <span class="sb">`env/`</span>, <span class="sb">`scripts/`</span>, <span class="sb">`data/samples/`</span>, <span class="sb">`results/`</span>, <span class="sb">`refs/`</span>  
<span class="p">-</span> <span class="gs">**공개 릴리스(버전드)**</span> → <span class="sb">`75_Releases/&lt;name&gt;/vX.Y.Z/`</span> + <span class="sb">`checksums/`</span>, <span class="sb">`ReleaseNotes.md`</span>, <span class="sb">`latest`</span> 심볼릭  
<span class="p">-</span> <span class="gs">**데이터 공유**</span>: 비식별/샘플은 <span class="sb">`26_Datasets/derived/&lt;artifact&gt;-public/vYYYY.MMDD/`</span>
<span class="p">
---
</span>
<span class="gu">## 8) 외부 리포/대화/노트</span>
<span class="p">
-</span> <span class="gs">**외부 리포(연구/분석용)**</span>: <span class="sb">`21_ExternalRepos/&lt;host&gt;/&lt;org&gt;/&lt;repo&gt;/`</span>  
<span class="p">  -</span> 기본 읽기 전용. 실험은 <span class="sb">`git worktree`</span>로 <span class="sb">`22_Labs`</span>/<span class="sb">`25_Jobs/SMOKE`</span>에 분리.  
<span class="p">-</span> <span class="gs">**대화 기록**</span>: <span class="sb">`31_Conversations/`</span> (inbox→정제→redacted/private), 프로젝트/노트에서는 링크로만 참조.  
<span class="p">-</span> <span class="gs">**Obsidian Vault(업무)**</span>: <span class="sb">`30_Areas/knowledge_base/obsidian_vault/`</span>  
<span class="p">  -</span> 첨부는 <span class="sb">`_attachments/`</span>(소형), 대용량은 링크만.
<span class="p">
---
</span>
<span class="gu">## 9) 자주 쓰는 예시 10선</span>

<span class="gu">1) **새 프로젝트(파이썬 패키지) 시작**  
===
</span>base=~/Work/20_Projects/PRJ-2025-001_sample_app
mkdir -p $base/{src/sample_app,tests,scripts,examples,docs}
printf '%s<span class="se">\n</span>' "[project]<span class="se">\n</span>name='sample-app'<span class="se">\n</span>version='0.1.0'" &gt; $base/pyproject.toml
<span class="gu">cd $base &amp;&amp; python3 -m venv .venv &amp;&amp; . .venv/bin/activate &amp;&amp; pip install -U build pytest
===
</span>
<span class="gu">2) **프로젝트 빌드(휠 생성) &amp; 릴리스 아카이브**  
===
</span>cd ~/Work/20_Projects/PRJ-2025-001_sample_app
. .venv/bin/activate
python -m build
rel=~/Work/75_Releases/sample-app/v0.1.0
mkdir -p $rel/checksums &amp;&amp; cp dist/<span class="err">*</span> $rel/
<span class="gu">( cd $rel &amp;&amp; shasum -a 256 * &gt; checksums/SHA256SUMS &amp;&amp; ln -sfn v0.1.0 ../latest )
===
</span>
<span class="gu">3) **데이터셋 버전 투입 + 체크섬**  
===
</span>base=~/Work/26_Datasets/datasets/ad_events/v2025.0901
mkdir -p $base/{raw,interim,processed,samples,docs}
mv ~/Downloads/ad_20250901.csv $base/raw/
printf '%s<span class="se">\n</span>' "name: ad_events<span class="se">\n</span>kind: dataset<span class="se">\n</span>version: v2025.0901" &gt; $base/manifest.yml
<span class="gu">( cd $base &amp;&amp; : &gt; SHA256SUMS &amp;&amp; find . -type f ! -name 'SHA256SUMS' -print0 | xargs -0 shasum -a 256 &gt;&gt; SHA256SUMS )
===
</span>
<span class="gu">4) **외부 리포 이동 &amp; upstream/포크 리모트 정리**  
===
</span>repo=~/Downloads/tmp/flask
url=$(git -C "$repo" config --get remote.origin.url)
host=$(echo "$url" | sed -E 's#(https?://|git@)([^/:]+).<span class="err">*</span>#<span class="se">\2</span>#'); <span class="err">\</span>
org=$( echo "$url" | sed -E 's#.<span class="err">*</span>/([^/]+)/[^/]+(<span class="se">\.</span>git)?$#<span class="se">\1</span>#'); <span class="err">\</span>
name=$(echo "$url" | sed -E 's#.<span class="err">*</span>/([^/]+)(<span class="se">\.</span>git)?$#<span class="se">\1</span>#')
dest="$HOME/Work/21_ExternalRepos/$host/$org/$name"
mkdir -p "$(dirname "$dest")" &amp;&amp; mv "$repo" "$dest"
cd "$dest" &amp;&amp; git remote rename origin upstream
<span class="gu"># 포크가 있다면: git remote add origin git@github.com:&lt;me&gt;/$name.git
===
</span>
<span class="gu">5) **Toolchains/SDK 최신 버전 심볼릭 갱신**  
===
</span>cd ~/Work/80_Toolchains/gcc
ln -sfn 13.3.0 latest
cd ~/Work/81_SDKs/jdk
<span class="gu">ln -sfn 21.0.2 latest
===
</span>
<span class="gu">6) **프로젝트 전용 venv로 내부 CLI 사용**  
===
</span>cd ~/Work/20_Projects/PRJ-APP
python3 -m venv .venv &amp;&amp; . .venv/bin/activate
pip install -e ../PRJ-UTILS-mytool
<span class="gu">mytool --help   # venv 안에서만 사용
===
</span>
<span class="gu">7) **전용 “도구용 venv”(pipx 없이 전역처럼) 구성**  
===
</span>env=~/Work/85_Environments/venv/tools-3.12
python3 -m venv "$env"
. "$env/bin/activate" &amp;&amp; pip install -U pip wheel ruff black httpie
<span class="gu">echo 'export PATH="$HOME/Work/85_Environments/venv/tools-3.12/bin:$PATH"' &gt;&gt; ~/.zshrc
===
</span>
<span class="gu">8) **Share Kit 스캐폴드(빠른 공유 번들)**  
===
</span>kit=~/Work/70_Exports/pyside6-tableview/2025-09-01/sharekit
mkdir -p $kit/{env,scripts,data/samples,results,refs}
printf '%s<span class="se">\n</span>' "# README<span class="se">\n</span>Quickstart: ./scripts/run.sh" &gt; $kit/README.md
printf '%s<span class="se">\n</span>' "numpy<span class="se">\n</span>pandas" &gt; $kit/env/requirements.txt
printf '%s<span class="se">\n</span>' '#!/usr/bin/env bash<span class="se">\n</span>set -e<span class="se">\n</span>here=$(cd $(dirname $0)/.. &amp;&amp; pwd)<span class="se">\n</span>mkdir -p <span class="se">\"</span>$here/results<span class="se">\"\n</span>python <span class="se">\"</span>$here/src/main.py<span class="se">\"</span> --input <span class="se">\"</span>$here/data/samples<span class="se">\"</span> --out <span class="se">\"</span>$here/results<span class="se">\"</span>' &gt; $kit/scripts/run.sh
<span class="gu">chmod +x $kit/scripts/run.sh
===
</span>
<span class="gu">9) **Obsidian Vault 뼈대 만들기**  
===
</span>vault=~/Work/30_Areas/knowledge_base/obsidian_vault
mkdir -p $vault/{00_Inbox,10_Daily/2025,20_Topics,30_ProjectsNotes,40_References,_attachments}
<span class="gu">printf '%s\n' "# Daily Notes" &gt; $vault/10_Daily/2025/README.md
===
</span>
<span class="gu">10) **LAB 작업 스캐폴드(+참고 링크 연결)**  
===
</span>job=~/Work/25_Jobs/LAB/2025/LAB-2025-018_pyside6-tableview
mkdir -p $job/{src,scripts,env,data}
printf '%s<span class="se">\n</span>' "# 목표<span class="se">\n</span>- TableView로 CSV 뷰어 만들기<span class="se">\n\n</span># 절차<span class="se">\n</span>- ...<span class="se">\n\n</span># 결과<span class="se">\n</span>- 스크린샷/메모" &gt; $job/README.md
<span class="gu">printf '%s\n' "- 강의: ../../../../40_Resources/edu/courses/udemy/pyside6/v2025.0901/README.md" &gt; $job/references.md
===
</span><span class="p">
---
</span>
<span class="gu">## 10) 자주 헷갈리는 포인트</span>
<span class="p">
-</span> <span class="gs">**프로젝트에 대용량 데이터 복사 금지**</span> → 항상 <span class="sb">`26_Datasets`</span>를 경로 참조(또는 심볼릭).  
<span class="p">-</span> <span class="gs">**`mv` vs `cp -rf`**</span>: 같은 파일시스템은 <span class="sb">`mv`</span>(빠르고 안전). 다른 FS는 <span class="sb">`rsync -a`</span>/<span class="sb">`cp -pPR`</span>/<span class="sb">`ditto`</span>/<span class="sb">`robocopy`</span>.  
<span class="p">-</span> <span class="gs">**`ln -sfn` 의미**</span>: <span class="sb">`-s`</span>(심볼릭), <span class="sb">`-f`</span>(기존 링크 덮어쓰기), <span class="sb">`-n`</span>(디렉터리 따라가지 않음).  
<span class="p">-</span> <span class="gs">**venv/conda는 복사 금지**</span>: 경로 내장 → 옮기면 깨질 수 있음(재생성 권장).  
<span class="p">-</span> <span class="gs">**교육 수집물 vs 내 정리/실습**</span>: <span class="sb">`40_Resources/edu`</span>(원본) ↔ <span class="sb">`30_Areas/obsidian_vault`</span>(정리) ↔ <span class="sb">`25_Jobs/LAB`</span>(실습).  
<span class="p">-</span> <span class="gs">**단축/런처**</span>: Today는 대시보드로만 사용(세부는 각자 관리).
<span class="p">
---
</span>
<span class="ge">_필요 시 이 문서를 `~/Work/00_</span>README.md<span class="err">`</span>로 저장하고, 변경 시 상단 날짜를 갱신하세요._
</code></pre></div></div>]]></content><author><name>hvppyarchive</name></author><category term="misc" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">Simple LLM Chatbot Client</title><link href="https://hvppyarchive.github.io/llm/simple-chatbot-client/" rel="alternate" type="text/html" title="Simple LLM Chatbot Client" /><published>2025-09-01T11:52:46+09:00</published><updated>2025-09-01T11:52:46+09:00</updated><id>https://hvppyarchive.github.io/llm/simple-chatbot-client</id><content type="html" xml:base="https://hvppyarchive.github.io/llm/simple-chatbot-client/"><![CDATA[<p class="chat--user">

Developer: Role and Objective - Develop a simple, fast LLM Chatbot Client Application using Qt or PySide. Workflow Checklist - Begin with a concise checklist (3-7 bullets) of conceptual sub-tasks before implementation. Instructions - Design for easy, direct execution by users in a Linux environment with access to a shared disk. - Allow each user to save personal settings, while the default deployment settings are configured by the administrator. Deployment - The application should be distributed so users can launch it directly on supported Linux systems with shared disk access. - Initial, default application settings must be settable by an administrator; each user can override and save their preferences. Required Features - Allow setting a custom LLM (Large Language Model) endpoint. - Support multi-line message input. - Provide chat log management similar to applications like Ollama or OpenWebUI. - Enable changing model parameters from the interface. - Incorporate useful shortcut keys (e.g., hide/show window in workspace, start new conversation, etc.). - Render Markdown in chat messages. Code and Messaging Conventions - Code must be clear, well-commented, use readable variable names, and maintain straightforward control flow. - Application messaging and labels should be concise and clear to end users. Output Format - Default output is plain text. When documentation is required, use Markdown and backticks for file, directory, function, and class names. Validation - After implementation, validate that the application meets all feature and deployment requirements and is verified to run as specified in the Linux environment. Document any issues or unmet criteria. Stop Conditions - The task is complete once the client app fulfills all listed features and deployment criteria, has been validated as above, and any necessary corrections have been applied.

</p>

<p>Here’s a tight, step-by-step plan and a complete, ready-to-run PySide6 app you can drop on a shared Linux disk.</p>

<h1 id="conceptual-checklist-before-coding">Conceptual checklist (before coding)</h1>

<ol>
  <li>
    <p>Config strategy: admin defaults on shared disk or <code class="language-plaintext highlighter-rouge">/etc/llmchat</code>, user overrides in <code class="language-plaintext highlighter-rouge">~/.config/llmchat/</code> with deep-merge on load; write back only user file.</p>
  </li>
  <li>
    <p>Storage strategy: chats as JSON under <code class="language-plaintext highlighter-rouge">~/.local/share/llmchat/chats/</code>, with an index; operations: new/rename/delete/export.</p>
  </li>
  <li>
    <p>UI layout: left chat list + top toolbar; right chat view (Markdown) + param sidebar (model/temperature/top_p/max_tokens) + multiline input with send; tray icon for show/hide.</p>
  </li>
  <li>
    <p>Network layer: simple OpenAI-compatible <code class="language-plaintext highlighter-rouge">/v1/chat/completions</code> POST with <code class="language-plaintext highlighter-rouge">requests</code>, API base+key configurable; run in worker thread to keep UI responsive.</p>
  </li>
  <li>
    <p>Shortcuts: Ctrl+Enter send; Shift+Enter newline; Ctrl+N new chat; Ctrl+S export; Del delete chat; Ctrl+L focus input; Ctrl+, settings; Ctrl+H hide/show (via tray).</p>
  </li>
  <li>
    <p>Markdown render: convert with <code class="language-plaintext highlighter-rouge">markdown</code> lib to sanitized HTML; display in <code class="language-plaintext highlighter-rouge">QTextBrowser</code> with minimal CSS for code blocks and links.</p>
  </li>
  <li>
    <p>Deployment: <code class="language-plaintext highlighter-rouge">install.sh</code> (venv + pip), <code class="language-plaintext highlighter-rouge">run.sh</code> (activate &amp; start); <code class="language-plaintext highlighter-rouge">config/defaults.yaml</code> for admin to seed defaults; doc how to set <code class="language-plaintext highlighter-rouge">/etc/llmchat/config.yaml</code>.</p>
  </li>
</ol>

<hr />

<h2 id="project-layout">Project layout</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>arduino

llmchat/
  main.py
  config_manager.py
  llm_client.py
  storage.py
  ui_helpers.py
  requirements.txt
  install.sh
  run.sh
  config/
    defaults.yaml
  README.md
</code></pre></div></div>

<hr />

<h2 id="requirementstxt"><code class="language-plaintext highlighter-rouge">requirements.txt</code></h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>txt

PySide6&gt;=6.6
requests&gt;=2.31
PyYAML&gt;=6.0.1
markdown&gt;=3.5
</code></pre></div></div>

<hr />

<h2 id="installsh"><code class="language-plaintext highlighter-rouge">install.sh</code></h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>
<span class="nb">set</span> <span class="nt">-euo</span> pipefail
<span class="nb">cd</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
python3 <span class="nt">-m</span> venv .venv
<span class="nb">.</span> .venv/bin/activate
pip <span class="nb">install</span> <span class="nt">--upgrade</span> pip
pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt
<span class="nb">echo</span> <span class="s2">"✔ venv created. Use ./run.sh to launch."</span>
</code></pre></div></div>

<hr />

<h2 id="runsh"><code class="language-plaintext highlighter-rouge">run.sh</code></h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>
<span class="nb">set</span> <span class="nt">-euo</span> pipefail
<span class="nb">cd</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-d</span> .venv <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"No venv found. Running install..."</span>
  ./install.sh
<span class="k">fi</span>
<span class="nb">.</span> .venv/bin/activate
<span class="nb">export </span><span class="nv">QT_AUTO_SCREEN_SCALE_FACTOR</span><span class="o">=</span>1
python3 <span class="nt">-u</span> main.py <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</code></pre></div></div>

<hr />

<h2 id="configdefaultsyaml"><code class="language-plaintext highlighter-rouge">config/defaults.yaml</code></h2>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Admin-settable defaults (shared disk or /etc/llmchat/config.yaml)</span>
<span class="na">app</span><span class="pi">:</span>
  <span class="na">data_dir</span><span class="pi">:</span> <span class="s2">"</span><span class="s">~/.local/share/llmchat"</span>
  <span class="na">chat_dir_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">chats"</span>
  <span class="na">window</span><span class="pi">:</span>
    <span class="na">width</span><span class="pi">:</span> <span class="m">1100</span>
    <span class="na">height</span><span class="pi">:</span> <span class="m">720</span>
<span class="na">llm</span><span class="pi">:</span>
  <span class="na">api_base</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://localhost:11434/v1"</span>  <span class="c1"># Works with Ollama's OpenAI-compatible server</span>
  <span class="na">api_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>  <span class="c1"># Leave empty for local endpoints; user can override</span>
  <span class="na">model</span><span class="pi">:</span> <span class="s2">"</span><span class="s">llama3.1"</span>
  <span class="na">temperature</span><span class="pi">:</span> <span class="m">0.7</span>
  <span class="na">top_p</span><span class="pi">:</span> <span class="m">0.95</span>
  <span class="na">max_tokens</span><span class="pi">:</span> <span class="m">512</span>
  <span class="na">timeout_sec</span><span class="pi">:</span> <span class="m">120</span>
  <span class="na">verify_tls</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">ui</span><span class="pi">:</span>
  <span class="na">font_family</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">font_size</span><span class="pi">:</span> <span class="m">11</span>
  <span class="na">enable_tray</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">markdown_css</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">body { font-family: sans-serif; font-size: 13px; }</span>
    <span class="s">code, pre { font-family: "DejaVu Sans Mono", monospace; }</span>
    <span class="s">pre { background: #f5f5f5; padding: 8px; border-radius: 6px; overflow: auto; }</span>
    <span class="s">code { background: #f1f1f1; padding: 2px 4px; border-radius: 4px; }</span>
    <span class="s">.msg-user { background: #e8f0fe; padding: 8px 10px; border-radius: 10px; margin: 10px 0; }</span>
    <span class="s">.msg-assistant { background: #f7f7f7; padding: 8px 10px; border-radius: 10px; margin: 10px 0; }</span>
</code></pre></div></div>

<hr />

<h2 id="config_managerpy"><code class="language-plaintext highlighter-rouge">config_manager.py</code></h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">copy</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="n">yaml</span>

<span class="k">def</span> <span class="nf">deep_merge_dict</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Deep merge dict b into a (a has lower precedence). Returns a new dict.</span><span class="sh">"""</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">copy</span><span class="p">.</span><span class="nf">deepcopy</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">b</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nf">deep_merge_dict</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="p">.</span><span class="nf">deepcopy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">class</span> <span class="nc">ConfigManager</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Loads admin defaults and applies user overrides. Only writes user config.
    Search order for admin defaults:
      1) LLMCHAT_CONFIG_DIR/config.yaml
      2) ./config/defaults.yaml (in app dir)
      3) /etc/llmchat/config.yaml
    User overrides:
      ~/.config/llmchat/config.yaml
    </span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">app_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">app_dir</span> <span class="o">=</span> <span class="n">app_dir</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user_config_dir</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">expanduser</span><span class="p">(</span><span class="sh">"</span><span class="s">~/.config/llmchat</span><span class="sh">"</span><span class="p">))</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user_config_path</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">user_config_dir</span> <span class="o">/</span> <span class="sh">"</span><span class="s">config.yaml</span><span class="sh">"</span>

        <span class="n">self</span><span class="p">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">effective</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_load_yaml</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
            <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">yaml</span><span class="p">.</span><span class="nf">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">env_dir</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">LLMCHAT_CONFIG_DIR</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">env_dir</span><span class="p">:</span>
            <span class="n">candidates</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Path</span><span class="p">(</span><span class="n">env_dir</span><span class="p">)</span> <span class="o">/</span> <span class="sh">"</span><span class="s">config.yaml</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">candidates</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">app_dir</span> <span class="o">/</span> <span class="sh">"</span><span class="s">config</span><span class="sh">"</span> <span class="o">/</span> <span class="sh">"</span><span class="s">defaults.yaml</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">candidates</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Path</span><span class="p">(</span><span class="sh">"</span><span class="s">/etc/llmchat/config.yaml</span><span class="sh">"</span><span class="p">))</span>

        <span class="n">merged</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
            <span class="n">merged</span> <span class="o">=</span> <span class="nf">deep_merge_dict</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_yaml</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

        <span class="n">self</span><span class="p">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="n">merged</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_yaml</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">user_config_path</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">effective</span> <span class="o">=</span> <span class="nf">deep_merge_dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">defaults</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">user</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">effective</span>

    <span class="k">def</span> <span class="nf">save_user_overrides</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">patch</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Persist only user overrides (not the merged effective config).</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user</span> <span class="o">=</span> <span class="nf">deep_merge_dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">user</span><span class="p">,</span> <span class="n">patch</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user_config_dir</span><span class="p">.</span><span class="nf">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">user_config_path</span><span class="p">,</span> <span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">yaml</span><span class="p">.</span><span class="nf">safe_dump</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">user</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get from effective using dotted path e.g. </span><span class="sh">'</span><span class="s">llm.api_base</span><span class="sh">'</span><span class="s">.</span><span class="sh">"""</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">.</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">effective</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">default</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cur</span>
</code></pre></div></div>

<hr />

<h2 id="storagepy"><code class="language-plaintext highlighter-rouge">storage.py</code></h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">asdict</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Message</span><span class="p">:</span>
    <span class="n">role</span><span class="p">:</span> <span class="nb">str</span>       <span class="c1"># "user" or "assistant" or "system"
</span>    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">ts</span><span class="p">:</span> <span class="nb">float</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Chat</span><span class="p">:</span>
    <span class="n">chat_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">created_ts</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">updated_ts</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Message</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">ChatStorage</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Manage chat files under ~/.local/share/llmchat/chats/ as JSON.</span><span class="sh">"""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">base_data_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">chat_dir_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">chats</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">base_data_dir</span><span class="p">).</span><span class="nf">expanduser</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">chat_dir</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">base_dir</span> <span class="o">/</span> <span class="n">chat_dir_name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">chat_dir</span><span class="p">.</span><span class="nf">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_chat_path</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">chat_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">chat_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">chat_id</span><span class="si">}</span><span class="s">.json</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">list_chats</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Chat</span><span class="p">]:</span>
        <span class="n">chats</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">chat_dir</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="sh">"</span><span class="s">*.json</span><span class="sh">"</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">raw</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">chats</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">_chat_from_raw</span><span class="p">(</span><span class="n">raw</span><span class="p">))</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="c1"># Most recent first
</span>        <span class="n">chats</span><span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">.</span><span class="n">updated_ts</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chats</span>

    <span class="k">def</span> <span class="nf">save_chat</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">chat</span><span class="p">:</span> <span class="n">Chat</span><span class="p">):</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="nf">asdict</span><span class="p">(</span><span class="n">chat</span><span class="p">)</span>
        <span class="c1"># Convert dataclass Message list to serializable dicts
</span>        <span class="n">raw</span><span class="p">[</span><span class="sh">"</span><span class="s">messages</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nf">asdict</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">chat</span><span class="p">.</span><span class="n">messages</span><span class="p">]</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">_chat_path</span><span class="p">(</span><span class="n">chat</span><span class="p">.</span><span class="n">chat_id</span><span class="p">),</span> <span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_chat</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">chat_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Chat</span><span class="p">]:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_chat_path</span><span class="p">(</span><span class="n">chat_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">raw</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_chat_from_raw</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_chat</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">chat_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_chat_path</span><span class="p">(</span><span class="n">chat_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
            <span class="n">p</span><span class="p">.</span><span class="nf">unlink</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">export_chat_markdown</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">chat</span><span class="p">:</span> <span class="n">Chat</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="sh">"</span><span class="s"># </span><span class="si">{</span><span class="n">chat</span><span class="p">.</span><span class="n">title</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">chat</span><span class="p">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="n">who</span> <span class="o">=</span> <span class="sh">"</span><span class="s">You</span><span class="sh">"</span> <span class="k">if</span> <span class="n">m</span><span class="p">.</span><span class="n">role</span> <span class="o">==</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span> <span class="k">else</span> <span class="sh">"</span><span class="s">Assistant</span><span class="sh">"</span>
            <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">**</span><span class="si">{</span><span class="n">who</span><span class="si">}</span><span class="s">:**</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>
            <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
            <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>
        <span class="n">out_path</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>
        <span class="n">out_path</span><span class="p">.</span><span class="n">parent</span><span class="p">.</span><span class="nf">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_chat_from_raw</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">raw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Chat</span><span class="p">:</span>
        <span class="n">msgs</span> <span class="o">=</span> <span class="p">[</span><span class="nc">Message</span><span class="p">(</span><span class="o">**</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">messages</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])]</span>
        <span class="k">return</span> <span class="nc">Chat</span><span class="p">(</span>
            <span class="n">chat_id</span><span class="o">=</span><span class="n">raw</span><span class="p">[</span><span class="sh">"</span><span class="s">chat_id</span><span class="sh">"</span><span class="p">],</span>
            <span class="n">title</span><span class="o">=</span><span class="n">raw</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Untitled</span><span class="sh">"</span><span class="p">),</span>
            <span class="n">created_ts</span><span class="o">=</span><span class="n">raw</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">created_ts</span><span class="sh">"</span><span class="p">,</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()),</span>
            <span class="n">updated_ts</span><span class="o">=</span><span class="n">raw</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">updated_ts</span><span class="sh">"</span><span class="p">,</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()),</span>
            <span class="n">model</span><span class="o">=</span><span class="n">raw</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">),</span>
            <span class="n">params</span><span class="o">=</span><span class="n">raw</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">params</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="n">messages</span><span class="o">=</span><span class="n">msgs</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="llm_clientpy"><code class="language-plaintext highlighter-rouge">llm_client.py</code></h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>

<span class="k">class</span> <span class="nc">LLMClient</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Minimal OpenAI-compatible client for /v1/chat/completions.
    Supports: api_base, api_key, model, temperature, top_p, max_tokens, timeout_sec, verify_tls
    </span><span class="sh">"""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span>

    <span class="k">def</span> <span class="nf">update_config</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span>

    <span class="k">def</span> <span class="nf">chat_completion</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">api_base</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">api_base</span><span class="sh">"</span><span class="p">].</span><span class="nf">rstrip</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">api_base</span><span class="si">}</span><span class="s">/v1/chat/completions</span><span class="sh">"</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">Content-Type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">application/json</span><span class="sh">"</span><span class="p">}</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">api_key</span><span class="p">:</span>
            <span class="n">headers</span><span class="p">[</span><span class="sh">"</span><span class="s">Authorization</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Bearer </span><span class="si">{</span><span class="n">api_key</span><span class="si">}</span><span class="sh">"</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">:</span> <span class="n">params</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">],</span>
            <span class="sh">"</span><span class="s">messages</span><span class="sh">"</span><span class="p">:</span> <span class="n">messages</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">temperature</span><span class="sh">"</span><span class="p">:</span> <span class="nf">float</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">temperature</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">temperature</span><span class="sh">"</span><span class="p">])),</span>
            <span class="sh">"</span><span class="s">top_p</span><span class="sh">"</span><span class="p">:</span> <span class="nf">float</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">top_p</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">top_p</span><span class="sh">"</span><span class="p">])),</span>
            <span class="sh">"</span><span class="s">max_tokens</span><span class="sh">"</span><span class="p">:</span> <span class="nf">int</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">max_tokens</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">max_tokens</span><span class="sh">"</span><span class="p">])),</span>
            <span class="sh">"</span><span class="s">stream</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">timeout</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">timeout_sec</span><span class="sh">"</span><span class="p">,</span> <span class="mi">120</span><span class="p">))</span>
        <span class="n">verify_tls</span> <span class="o">=</span> <span class="nf">bool</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">verify_tls</span><span class="sh">"</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span>
                          <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify_tls</span><span class="p">)</span>
        <span class="n">r</span><span class="p">.</span><span class="nf">raise_for_status</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
        <span class="c1"># OpenAI-compatible format
</span>        <span class="n">content</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">choices</span><span class="sh">"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">content</span>
</code></pre></div></div>

<hr />

<h2 id="ui_helperspy"><code class="language-plaintext highlighter-rouge">ui_helpers.py</code></h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="n">markdown</span> <span class="kn">import</span> <span class="n">markdown</span>

<span class="k">def</span> <span class="nf">now_ts</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">md_to_html</span><span class="p">(</span><span class="n">md_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">css</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">""</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Convert Markdown to HTML suitable for QTextBrowser.
    </span><span class="sh">"""</span>
    <span class="n">body</span> <span class="o">=</span> <span class="nf">markdown</span><span class="p">(</span><span class="n">md_text</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">fenced_code</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">tables</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">codehilite</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">sane_lists</span><span class="sh">"</span><span class="p">])</span>
    <span class="n">style</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">&lt;style&gt;</span><span class="si">{</span><span class="n">css</span><span class="si">}</span><span class="s">&lt;/style&gt;</span><span class="sh">"</span> <span class="k">if</span> <span class="n">css</span> <span class="k">else</span> <span class="sh">""</span>
    <span class="c1"># Wrap with message container styling applied by caller
</span>    <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">style</span><span class="si">}{</span><span class="n">body</span><span class="si">}</span><span class="sh">"</span>

<span class="k">def</span> <span class="nf">messages_to_html</span><span class="p">(</span><span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">css</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="sh">"</span><span class="s">&lt;style&gt;</span><span class="si">{</span><span class="n">css</span><span class="si">}</span><span class="s">&lt;/style&gt;</span><span class="sh">"</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
        <span class="n">klass</span> <span class="o">=</span> <span class="sh">"</span><span class="s">msg-user</span><span class="sh">"</span> <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span> <span class="k">else</span> <span class="sh">"</span><span class="s">msg-assistant</span><span class="sh">"</span>
        <span class="n">parts</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">&lt;div class=</span><span class="sh">"</span><span class="si">{</span><span class="n">klass</span><span class="si">}</span><span class="sh">"</span><span class="s">&gt;</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">parts</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">md_to_html</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">]))</span>
        <span class="n">parts</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">&lt;/div&gt;</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="mainpy"><code class="language-plaintext highlighter-rouge">main.py</code></h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">uuid</span>
<span class="kn">import</span> <span class="n">traceback</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="n">PySide6.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QThreadPool</span><span class="p">,</span> <span class="n">QRunnable</span><span class="p">,</span> <span class="n">Signal</span><span class="p">,</span> <span class="n">QObject</span><span class="p">,</span> <span class="n">QSize</span>
<span class="kn">from</span> <span class="n">PySide6.QtGui</span> <span class="kn">import</span> <span class="n">QAction</span><span class="p">,</span> <span class="n">QIcon</span><span class="p">,</span> <span class="n">QKeySequence</span><span class="p">,</span> <span class="n">QCloseEvent</span><span class="p">,</span> <span class="n">QShortcut</span>
<span class="kn">from</span> <span class="n">PySide6.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">QApplication</span><span class="p">,</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QHBoxLayout</span><span class="p">,</span> <span class="n">QTextEdit</span><span class="p">,</span>
    <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QListWidget</span><span class="p">,</span> <span class="n">QListWidgetItem</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QFileDialog</span><span class="p">,</span> <span class="n">QSplitter</span><span class="p">,</span>
    <span class="n">QFormLayout</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QSpinBox</span><span class="p">,</span> <span class="n">QDoubleSpinBox</span><span class="p">,</span> <span class="n">QGroupBox</span><span class="p">,</span> <span class="n">QDockWidget</span><span class="p">,</span>
    <span class="n">QMessageBox</span><span class="p">,</span> <span class="n">QTextBrowser</span><span class="p">,</span> <span class="n">QToolBar</span><span class="p">,</span> <span class="n">QSystemTrayIcon</span><span class="p">,</span> <span class="n">QMenu</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="n">config_manager</span> <span class="kn">import</span> <span class="n">ConfigManager</span>
<span class="kn">from</span> <span class="n">storage</span> <span class="kn">import</span> <span class="n">ChatStorage</span><span class="p">,</span> <span class="n">Chat</span><span class="p">,</span> <span class="n">Message</span>
<span class="kn">from</span> <span class="n">llm_client</span> <span class="kn">import</span> <span class="n">LLMClient</span>
<span class="kn">from</span> <span class="n">ui_helpers</span> <span class="kn">import</span> <span class="n">now_ts</span><span class="p">,</span> <span class="n">messages_to_html</span>

<span class="n">APP_NAME</span> <span class="o">=</span> <span class="sh">"</span><span class="s">LLMChat</span><span class="sh">"</span>

<span class="c1"># ---------------- Worker infra ---------------- #
</span>
<span class="k">class</span> <span class="nc">WorkerSignals</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>
    <span class="n">success</span> <span class="o">=</span> <span class="nc">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="nc">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">LLMWorker</span><span class="p">(</span><span class="n">QRunnable</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">LLMClient</span><span class="p">,</span> <span class="n">messages_payload</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="n">self</span><span class="p">.</span><span class="n">messages_payload</span> <span class="o">=</span> <span class="n">messages_payload</span>
        <span class="n">self</span><span class="p">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">self</span><span class="p">.</span><span class="n">signals</span> <span class="o">=</span> <span class="nc">WorkerSignals</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">chat_completion</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">messages_payload</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">params</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">signals</span><span class="p">.</span><span class="n">success</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="n">reply</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">tb</span> <span class="o">=</span> <span class="n">traceback</span><span class="p">.</span><span class="nf">format_exc</span><span class="p">()</span>
            <span class="n">self</span><span class="p">.</span><span class="n">signals</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">tb</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ---------------- Main Window ---------------- #
</span>
<span class="k">class</span> <span class="nc">MainWindow</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">app_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">setWindowTitle</span><span class="p">(</span><span class="sh">"</span><span class="s">LLM Chat Client</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">app_dir</span> <span class="o">=</span> <span class="n">app_dir</span>

        <span class="c1"># Config
</span>        <span class="n">self</span><span class="p">.</span><span class="n">cfg_mgr</span> <span class="o">=</span> <span class="nc">ConfigManager</span><span class="p">(</span><span class="n">app_dir</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">cfg_mgr</span><span class="p">.</span><span class="nf">load</span><span class="p">()</span>

        <span class="c1"># Storage
</span>        <span class="n">data_dir</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">app</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">data_dir</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">~/.local/share/llmchat</span><span class="sh">"</span><span class="p">)).</span><span class="nf">expanduser</span><span class="p">()</span>
        <span class="n">chat_dir_name</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">app</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">chat_dir_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">chats</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">storage</span> <span class="o">=</span> <span class="nc">ChatStorage</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">chat_dir_name</span><span class="p">)</span>

        <span class="c1"># LLM client
</span>        <span class="n">self</span><span class="p">.</span><span class="n">client</span> <span class="o">=</span> <span class="nc">LLMClient</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">)</span>

        <span class="c1"># State
</span>        <span class="n">self</span><span class="p">.</span><span class="n">thread_pool</span> <span class="o">=</span> <span class="n">QThreadPool</span><span class="p">.</span><span class="nf">globalInstance</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">:</span> <span class="n">Chat</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">markdown_css</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">ui</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">markdown_css</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_build_ui</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_load_chat_list</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_apply_initial_window_size</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_setup_tray</span><span class="p">()</span>

    <span class="c1"># -------- UI construction -------- #
</span>
    <span class="k">def</span> <span class="nf">_build_ui</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">splitter</span> <span class="o">=</span> <span class="nc">QSplitter</span><span class="p">()</span>
        <span class="n">splitter</span><span class="p">.</span><span class="nf">setChildrenCollapsible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="c1"># Left: chat list + controls
</span>        <span class="n">left</span> <span class="o">=</span> <span class="nc">QWidget</span><span class="p">()</span>
        <span class="n">left_layout</span> <span class="o">=</span> <span class="nc">QVBoxLayout</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">chat_list</span> <span class="o">=</span> <span class="nc">QListWidget</span><span class="p">()</span>
        <span class="n">left_layout</span><span class="p">.</span><span class="nf">addWidget</span><span class="p">(</span><span class="nc">QLabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Conversations</span><span class="sh">"</span><span class="p">))</span>
        <span class="n">left_layout</span><span class="p">.</span><span class="nf">addWidget</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">chat_list</span><span class="p">)</span>

        <span class="n">btn_row</span> <span class="o">=</span> <span class="nc">QHBoxLayout</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">btn_new</span> <span class="o">=</span> <span class="nc">QPushButton</span><span class="p">(</span><span class="sh">"</span><span class="s">New</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">btn_rename</span> <span class="o">=</span> <span class="nc">QPushButton</span><span class="p">(</span><span class="sh">"</span><span class="s">Rename</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">btn_delete</span> <span class="o">=</span> <span class="nc">QPushButton</span><span class="p">(</span><span class="sh">"</span><span class="s">Delete</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">btn_row</span><span class="p">.</span><span class="nf">addWidget</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">btn_new</span><span class="p">)</span>
        <span class="n">btn_row</span><span class="p">.</span><span class="nf">addWidget</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">btn_rename</span><span class="p">)</span>
        <span class="n">btn_row</span><span class="p">.</span><span class="nf">addWidget</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">btn_delete</span><span class="p">)</span>
        <span class="n">left_layout</span><span class="p">.</span><span class="nf">addLayout</span><span class="p">(</span><span class="n">btn_row</span><span class="p">)</span>

        <span class="c1"># Right: conversation + input
</span>        <span class="n">right</span> <span class="o">=</span> <span class="nc">QWidget</span><span class="p">()</span>
        <span class="n">right_layout</span> <span class="o">=</span> <span class="nc">QVBoxLayout</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>

        <span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="o">=</span> <span class="nc">QTextBrowser</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="nf">setOpenExternalLinks</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">right_layout</span><span class="p">.</span><span class="nf">addWidget</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">input_row</span> <span class="o">=</span> <span class="nc">QHBoxLayout</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nb">input</span> <span class="o">=</span> <span class="nc">QTextEdit</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nb">input</span><span class="p">.</span><span class="nf">setPlaceholderText</span><span class="p">(</span><span class="sh">"</span><span class="s">Type your message… (Shift+Enter for newline, Ctrl+Enter to send)</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nb">input</span><span class="p">.</span><span class="nf">setAcceptRichText</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">input_row</span><span class="p">.</span><span class="nf">addWidget</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nb">input</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">btn_send</span> <span class="o">=</span> <span class="nc">QPushButton</span><span class="p">(</span><span class="sh">"</span><span class="s">Send</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">btn_send</span><span class="p">.</span><span class="nf">setDefault</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">input_row</span><span class="p">.</span><span class="nf">addWidget</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">btn_send</span><span class="p">)</span>
        <span class="n">right_layout</span><span class="p">.</span><span class="nf">addLayout</span><span class="p">(</span><span class="n">input_row</span><span class="p">)</span>

        <span class="n">splitter</span><span class="p">.</span><span class="nf">addWidget</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
        <span class="n">splitter</span><span class="p">.</span><span class="nf">addWidget</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
        <span class="n">splitter</span><span class="p">.</span><span class="nf">setStretchFactor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">setCentralWidget</span><span class="p">(</span><span class="n">splitter</span><span class="p">)</span>

        <span class="c1"># Dock: model params &amp; endpoint
</span>        <span class="n">dock</span> <span class="o">=</span> <span class="nc">QDockWidget</span><span class="p">(</span><span class="sh">"</span><span class="s">Model &amp; Endpoint</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
        <span class="n">dock</span><span class="p">.</span><span class="nf">setAllowedAreas</span><span class="p">(</span><span class="n">Qt</span><span class="p">.</span><span class="n">RightDockWidgetArea</span> <span class="o">|</span> <span class="n">Qt</span><span class="p">.</span><span class="n">LeftDockWidgetArea</span><span class="p">)</span>
        <span class="n">params_widget</span> <span class="o">=</span> <span class="nc">QWidget</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="nc">QFormLayout</span><span class="p">(</span><span class="n">params_widget</span><span class="p">)</span>

        <span class="n">self</span><span class="p">.</span><span class="n">edt_api_base</span> <span class="o">=</span> <span class="nc">QLineEdit</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">api_base</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">))</span>
        <span class="n">self</span><span class="p">.</span><span class="n">edt_api_key</span> <span class="o">=</span> <span class="nc">QLineEdit</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">))</span>
        <span class="n">self</span><span class="p">.</span><span class="n">edt_api_key</span><span class="p">.</span><span class="nf">setEchoMode</span><span class="p">(</span><span class="n">QLineEdit</span><span class="p">.</span><span class="n">Password</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">edt_model</span> <span class="o">=</span> <span class="nc">QLineEdit</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">))</span>

        <span class="n">self</span><span class="p">.</span><span class="n">spin_temp</span> <span class="o">=</span> <span class="nc">QDoubleSpinBox</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spin_temp</span><span class="p">.</span><span class="nf">setRange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spin_temp</span><span class="p">.</span><span class="nf">setSingleStep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spin_temp</span><span class="p">.</span><span class="nf">setValue</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">temperature</span><span class="sh">"</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)))</span>

        <span class="n">self</span><span class="p">.</span><span class="n">spin_top_p</span> <span class="o">=</span> <span class="nc">QDoubleSpinBox</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spin_top_p</span><span class="p">.</span><span class="nf">setRange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spin_top_p</span><span class="p">.</span><span class="nf">setSingleStep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spin_top_p</span><span class="p">.</span><span class="nf">setValue</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">top_p</span><span class="sh">"</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">)))</span>

        <span class="n">self</span><span class="p">.</span><span class="n">spin_max_toks</span> <span class="o">=</span> <span class="nc">QSpinBox</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spin_max_toks</span><span class="p">.</span><span class="nf">setRange</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">32768</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spin_max_toks</span><span class="p">.</span><span class="nf">setValue</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">max_tokens</span><span class="sh">"</span><span class="p">,</span> <span class="mi">512</span><span class="p">)))</span>

        <span class="n">form</span><span class="p">.</span><span class="nf">addRow</span><span class="p">(</span><span class="nc">QLabel</span><span class="p">(</span><span class="sh">"</span><span class="s">API Base</span><span class="sh">"</span><span class="p">),</span> <span class="n">self</span><span class="p">.</span><span class="n">edt_api_base</span><span class="p">)</span>
        <span class="n">form</span><span class="p">.</span><span class="nf">addRow</span><span class="p">(</span><span class="nc">QLabel</span><span class="p">(</span><span class="sh">"</span><span class="s">API Key</span><span class="sh">"</span><span class="p">),</span> <span class="n">self</span><span class="p">.</span><span class="n">edt_api_key</span><span class="p">)</span>
        <span class="n">form</span><span class="p">.</span><span class="nf">addRow</span><span class="p">(</span><span class="nc">QLabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Model</span><span class="sh">"</span><span class="p">),</span> <span class="n">self</span><span class="p">.</span><span class="n">edt_model</span><span class="p">)</span>
        <span class="n">form</span><span class="p">.</span><span class="nf">addRow</span><span class="p">(</span><span class="nc">QLabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Temperature</span><span class="sh">"</span><span class="p">),</span> <span class="n">self</span><span class="p">.</span><span class="n">spin_temp</span><span class="p">)</span>
        <span class="n">form</span><span class="p">.</span><span class="nf">addRow</span><span class="p">(</span><span class="nc">QLabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Top-p</span><span class="sh">"</span><span class="p">),</span> <span class="n">self</span><span class="p">.</span><span class="n">spin_top_p</span><span class="p">)</span>
        <span class="n">form</span><span class="p">.</span><span class="nf">addRow</span><span class="p">(</span><span class="nc">QLabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Max tokens</span><span class="sh">"</span><span class="p">),</span> <span class="n">self</span><span class="p">.</span><span class="n">spin_max_toks</span><span class="p">)</span>

        <span class="n">btns</span> <span class="o">=</span> <span class="nc">QHBoxLayout</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">btn_save_settings</span> <span class="o">=</span> <span class="nc">QPushButton</span><span class="p">(</span><span class="sh">"</span><span class="s">Save as My Defaults</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">btn_apply</span> <span class="o">=</span> <span class="nc">QPushButton</span><span class="p">(</span><span class="sh">"</span><span class="s">Apply Now</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">btns</span><span class="p">.</span><span class="nf">addWidget</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">btn_apply</span><span class="p">)</span>
        <span class="n">btns</span><span class="p">.</span><span class="nf">addWidget</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">btn_save_settings</span><span class="p">)</span>
        <span class="n">form</span><span class="p">.</span><span class="nf">addRow</span><span class="p">(</span><span class="n">btns</span><span class="p">)</span>

        <span class="n">params_widget</span><span class="p">.</span><span class="nf">setLayout</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
        <span class="n">dock</span><span class="p">.</span><span class="nf">setWidget</span><span class="p">(</span><span class="n">params_widget</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">addDockWidget</span><span class="p">(</span><span class="n">Qt</span><span class="p">.</span><span class="n">RightDockWidgetArea</span><span class="p">,</span> <span class="n">dock</span><span class="p">)</span>

        <span class="c1"># Toolbar &amp; actions
</span>        <span class="n">tb</span> <span class="o">=</span> <span class="nc">QToolBar</span><span class="p">(</span><span class="sh">"</span><span class="s">Main</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">tb</span><span class="p">.</span><span class="nf">setIconSize</span><span class="p">(</span><span class="nc">QSize</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">addToolBar</span><span class="p">(</span><span class="n">tb</span><span class="p">)</span>

        <span class="n">act_new</span> <span class="o">=</span> <span class="nc">QAction</span><span class="p">(</span><span class="sh">"</span><span class="s">New Chat</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
        <span class="n">act_new</span><span class="p">.</span><span class="nf">setShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="sh">"</span><span class="s">Ctrl+N</span><span class="sh">"</span><span class="p">))</span>
        <span class="n">act_send</span> <span class="o">=</span> <span class="nc">QAction</span><span class="p">(</span><span class="sh">"</span><span class="s">Send</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
        <span class="n">act_send</span><span class="p">.</span><span class="nf">setShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="sh">"</span><span class="s">Ctrl+Return</span><span class="sh">"</span><span class="p">))</span>
        <span class="n">act_export</span> <span class="o">=</span> <span class="nc">QAction</span><span class="p">(</span><span class="sh">"</span><span class="s">Export Markdown…</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
        <span class="n">act_export</span><span class="p">.</span><span class="nf">setShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="sh">"</span><span class="s">Ctrl+S</span><span class="sh">"</span><span class="p">))</span>
        <span class="n">act_delete</span> <span class="o">=</span> <span class="nc">QAction</span><span class="p">(</span><span class="sh">"</span><span class="s">Delete Chat</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
        <span class="n">act_delete</span><span class="p">.</span><span class="nf">setShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="n">Qt</span><span class="p">.</span><span class="n">Key_Delete</span><span class="p">))</span>
        <span class="n">act_focus</span> <span class="o">=</span> <span class="nc">QAction</span><span class="p">(</span><span class="sh">"</span><span class="s">Focus Input</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
        <span class="n">act_focus</span><span class="p">.</span><span class="nf">setShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="sh">"</span><span class="s">Ctrl+L</span><span class="sh">"</span><span class="p">))</span>
        <span class="n">act_settings</span> <span class="o">=</span> <span class="nc">QAction</span><span class="p">(</span><span class="sh">"</span><span class="s">Save Settings</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
        <span class="n">act_settings</span><span class="p">.</span><span class="nf">setShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="sh">"</span><span class="s">Ctrl+,</span><span class="sh">"</span><span class="p">))</span>
        <span class="n">act_hide</span> <span class="o">=</span> <span class="nc">QAction</span><span class="p">(</span><span class="sh">"</span><span class="s">Hide/Show</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
        <span class="n">act_hide</span><span class="p">.</span><span class="nf">setShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="sh">"</span><span class="s">Ctrl+H</span><span class="sh">"</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="n">act_new</span><span class="p">,</span> <span class="n">act_send</span><span class="p">,</span> <span class="n">act_export</span><span class="p">,</span> <span class="n">act_delete</span><span class="p">,</span> <span class="n">act_focus</span><span class="p">,</span> <span class="n">act_settings</span><span class="p">,</span> <span class="n">act_hide</span><span class="p">):</span>
            <span class="n">tb</span><span class="p">.</span><span class="nf">addAction</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="c1"># Connect signals
</span>        <span class="n">self</span><span class="p">.</span><span class="n">btn_new</span><span class="p">.</span><span class="n">clicked</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_new_chat</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">btn_rename</span><span class="p">.</span><span class="n">clicked</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_rename_chat</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">btn_delete</span><span class="p">.</span><span class="n">clicked</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_delete_chat</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">chat_list</span><span class="p">.</span><span class="n">itemDoubleClicked</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_open_selected_chat</span><span class="p">())</span>
        <span class="n">self</span><span class="p">.</span><span class="n">chat_list</span><span class="p">.</span><span class="n">itemSelectionChanged</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_open_selected_chat</span><span class="p">)</span>

        <span class="n">self</span><span class="p">.</span><span class="n">btn_send</span><span class="p">.</span><span class="n">clicked</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_send</span><span class="p">)</span>
        <span class="n">act_send</span><span class="p">.</span><span class="n">triggered</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_send</span><span class="p">)</span>
        <span class="n">act_new</span><span class="p">.</span><span class="n">triggered</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_new_chat</span><span class="p">)</span>
        <span class="n">act_export</span><span class="p">.</span><span class="n">triggered</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_export_chat_md</span><span class="p">)</span>
        <span class="n">act_delete</span><span class="p">.</span><span class="n">triggered</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_delete_chat</span><span class="p">)</span>
        <span class="n">act_focus</span><span class="p">.</span><span class="n">triggered</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nb">input</span><span class="p">.</span><span class="nf">setFocus</span><span class="p">())</span>
        <span class="n">act_settings</span><span class="p">.</span><span class="n">triggered</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_save_settings_clicked</span><span class="p">)</span>
        <span class="n">act_hide</span><span class="p">.</span><span class="n">triggered</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_toggle_hide</span><span class="p">)</span>

        <span class="n">self</span><span class="p">.</span><span class="n">btn_apply</span><span class="p">.</span><span class="n">clicked</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_apply_now</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">btn_save_settings</span><span class="p">.</span><span class="n">clicked</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_save_settings_clicked</span><span class="p">)</span>

        <span class="c1"># Keyboard shortcut for Shift+Enter newline is default in QTextEdit
</span>        <span class="nc">QShortcut</span><span class="p">(</span><span class="nc">QKeySequence</span><span class="p">(</span><span class="sh">"</span><span class="s">Ctrl+Enter</span><span class="sh">"</span><span class="p">),</span> <span class="n">self</span><span class="p">,</span> <span class="n">activated</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_send</span><span class="p">)</span>

        <span class="n">self</span><span class="p">.</span><span class="nf">statusBar</span><span class="p">().</span><span class="nf">showMessage</span><span class="p">(</span><span class="sh">"</span><span class="s">Ready</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply_initial_window_size</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">app</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">window</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">width</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1100</span><span class="p">))</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">app</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">window</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">height</span><span class="sh">"</span><span class="p">,</span> <span class="mi">720</span><span class="p">))</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">resize</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_tray</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">ui</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">enable_tray</span><span class="sh">"</span><span class="p">,</span> <span class="bp">True</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">self</span><span class="p">.</span><span class="n">tray</span> <span class="o">=</span> <span class="nc">QSystemTrayIcon</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">tray</span><span class="p">.</span><span class="nf">setIcon</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">style</span><span class="p">().</span><span class="nf">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="p">.</span><span class="n">SP_ComputerIcon</span><span class="p">)</span> <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="sh">"</span><span class="s">style</span><span class="sh">"</span><span class="p">)</span> <span class="k">else</span> <span class="nc">QIcon</span><span class="p">())</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="nc">QMenu</span><span class="p">()</span>
        <span class="n">act_show</span> <span class="o">=</span> <span class="nc">QAction</span><span class="p">(</span><span class="sh">"</span><span class="s">Show</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
        <span class="n">act_quit</span> <span class="o">=</span> <span class="nc">QAction</span><span class="p">(</span><span class="sh">"</span><span class="s">Quit</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
        <span class="n">act_show</span><span class="p">.</span><span class="n">triggered</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_show_from_tray</span><span class="p">)</span>
        <span class="n">act_quit</span><span class="p">.</span><span class="n">triggered</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">QApplication</span><span class="p">.</span><span class="nf">instance</span><span class="p">().</span><span class="n">quit</span><span class="p">)</span>
        <span class="n">menu</span><span class="p">.</span><span class="nf">addAction</span><span class="p">(</span><span class="n">act_show</span><span class="p">)</span>
        <span class="n">menu</span><span class="p">.</span><span class="nf">addAction</span><span class="p">(</span><span class="n">act_quit</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">tray</span><span class="p">.</span><span class="nf">setContextMenu</span><span class="p">(</span><span class="n">menu</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">tray</span><span class="p">.</span><span class="n">activated</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">reason</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_show_from_tray</span><span class="p">()</span> <span class="k">if</span> <span class="n">reason</span> <span class="o">==</span> <span class="n">QSystemTrayIcon</span><span class="p">.</span><span class="n">Trigger</span> <span class="k">else</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">tray</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
        <span class="n">QApplication</span><span class="p">.</span><span class="nf">instance</span><span class="p">().</span><span class="nf">setQuitOnLastWindowClosed</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

    <span class="c1"># -------- Chat list ops -------- #
</span>
    <span class="k">def</span> <span class="nf">_load_chat_list</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">chat_list</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">chat</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="nf">list_chats</span><span class="p">():</span>
            <span class="n">item</span> <span class="o">=</span> <span class="nc">QListWidgetItem</span><span class="p">(</span><span class="n">chat</span><span class="p">.</span><span class="n">title</span><span class="p">)</span>
            <span class="n">item</span><span class="p">.</span><span class="nf">setData</span><span class="p">(</span><span class="n">Qt</span><span class="p">.</span><span class="n">UserRole</span><span class="p">,</span> <span class="n">chat</span><span class="p">.</span><span class="n">chat_id</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">chat_list</span><span class="p">.</span><span class="nf">addItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">chat_list</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_new_chat</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">chat_list</span><span class="p">.</span><span class="nf">setCurrentRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_new_chat</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">chat_id</span> <span class="o">=</span> <span class="n">uuid</span><span class="p">.</span><span class="nf">uuid4</span><span class="p">().</span><span class="nb">hex</span><span class="p">[:</span><span class="mi">12</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">edt_model</span><span class="p">.</span><span class="nf">text</span><span class="p">()</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">),</span>
            <span class="sh">"</span><span class="s">temperature</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spin_temp</span><span class="p">.</span><span class="nf">value</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">top_p</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spin_top_p</span><span class="p">.</span><span class="nf">value</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">max_tokens</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spin_max_toks</span><span class="p">.</span><span class="nf">value</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="n">chat</span> <span class="o">=</span> <span class="nc">Chat</span><span class="p">(</span>
            <span class="n">chat_id</span><span class="o">=</span><span class="n">chat_id</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="sh">"</span><span class="s">New Chat</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">created_ts</span><span class="o">=</span><span class="nf">now_ts</span><span class="p">(),</span>
            <span class="n">updated_ts</span><span class="o">=</span><span class="nf">now_ts</span><span class="p">(),</span>
            <span class="n">model</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">],</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="nf">save_chat</span><span class="p">(</span><span class="n">chat</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_load_chat_list</span><span class="p">()</span>
        <span class="c1"># Select new
</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">chat_list</span><span class="p">.</span><span class="nf">count</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">chat_list</span><span class="p">.</span><span class="nf">item</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="nf">data</span><span class="p">(</span><span class="n">Qt</span><span class="p">.</span><span class="n">UserRole</span><span class="p">)</span> <span class="o">==</span> <span class="n">chat_id</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">chat_list</span><span class="p">.</span><span class="nf">setCurrentRow</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">break</span>

    <span class="k">def</span> <span class="nf">_open_selected_chat</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">chat_list</span><span class="p">.</span><span class="nf">currentItem</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">chat_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">.</span><span class="nf">data</span><span class="p">(</span><span class="n">Qt</span><span class="p">.</span><span class="n">UserRole</span><span class="p">)</span>
        <span class="n">chat</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="nf">load_chat</span><span class="p">(</span><span class="n">chat_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">chat</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span> <span class="o">=</span> <span class="n">chat</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_render_chat</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_rename_chat</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">chat_list</span><span class="p">.</span><span class="nf">currentItem</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">new_title</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="p">.</span><span class="nf">getText</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="sh">"</span><span class="s">Rename</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Chat title:</span><span class="sh">"</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ok</span> <span class="ow">and</span> <span class="n">new_title</span><span class="p">.</span><span class="nf">strip</span><span class="p">():</span>
            <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">new_title</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span>
            <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">updated_ts</span> <span class="o">=</span> <span class="nf">now_ts</span><span class="p">()</span>
            <span class="n">self</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="nf">save_chat</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">)</span>
            <span class="n">item</span><span class="p">.</span><span class="nf">setText</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">title</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_delete_chat</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">chat_list</span><span class="p">.</span><span class="nf">currentItem</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">chat_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">.</span><span class="nf">data</span><span class="p">(</span><span class="n">Qt</span><span class="p">.</span><span class="n">UserRole</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">QMessageBox</span><span class="p">.</span><span class="nf">question</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="sh">"</span><span class="s">Delete</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Delete this chat?</span><span class="sh">"</span><span class="p">)</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="p">.</span><span class="n">Yes</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="nf">delete_chat</span><span class="p">(</span><span class="n">chat_id</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_load_chat_list</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_export_chat_md</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">.</span><span class="nf">getSaveFileName</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="sh">"</span><span class="s">Export Markdown</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">title</span><span class="si">}</span><span class="s">.md</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Markdown (*.md)</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">self</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="nf">export_chat_markdown</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">,</span> <span class="nc">Path</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">statusBar</span><span class="p">().</span><span class="nf">showMessage</span><span class="p">(</span><span class="sh">"</span><span class="s">Exported</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># -------- Rendering -------- #
</span>
    <span class="k">def</span> <span class="nf">_render_chat</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># Refresh param controls from chat params
</span>        <span class="n">p</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">params</span>
        <span class="n">self</span><span class="p">.</span><span class="n">edt_model</span><span class="p">.</span><span class="nf">setText</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)))</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spin_temp</span><span class="p">.</span><span class="nf">setValue</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">temperature</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">spin_temp</span><span class="p">.</span><span class="nf">value</span><span class="p">())))</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spin_top_p</span><span class="p">.</span><span class="nf">setValue</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">top_p</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">spin_top_p</span><span class="p">.</span><span class="nf">value</span><span class="p">())))</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spin_max_toks</span><span class="p">.</span><span class="nf">setValue</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">max_tokens</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">spin_max_toks</span><span class="p">.</span><span class="nf">value</span><span class="p">())))</span>

        <span class="n">msgs</span> <span class="o">=</span> <span class="p">[</span><span class="nf">dict</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="n">m</span><span class="p">.</span><span class="n">role</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">m</span><span class="p">.</span><span class="n">content</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">m</span><span class="p">.</span><span class="n">ts</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">messages</span><span class="p">]</span>
        <span class="n">html</span> <span class="o">=</span> <span class="nf">messages_to_html</span><span class="p">(</span><span class="n">msgs</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">markdown_css</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="nf">setHtml</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="nf">moveCursor</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="nf">textCursor</span><span class="p">().</span><span class="n">End</span><span class="p">)</span>

    <span class="c1"># -------- Sending -------- #
</span>
    <span class="k">def</span> <span class="nf">_send</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nb">input</span><span class="p">.</span><span class="nf">toPlainText</span><span class="p">().</span><span class="nf">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># Append user message
</span>        <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">messages</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Message</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="nf">now_ts</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">title</span> <span class="o">==</span> <span class="sh">"</span><span class="s">New Chat</span><span class="sh">"</span> <span class="ow">and</span> <span class="n">text</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="p">(</span><span class="n">text</span><span class="p">[:</span><span class="mi">48</span><span class="p">]</span> <span class="o">+</span> <span class="sh">"</span><span class="s">…</span><span class="sh">"</span><span class="p">)</span> <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">48</span> <span class="k">else</span> <span class="n">text</span>
            <span class="c1"># Update list title
</span>            <span class="n">item</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">chat_list</span><span class="p">.</span><span class="nf">currentItem</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">item</span><span class="p">.</span><span class="nf">setText</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">title</span><span class="p">)</span>

        <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">updated_ts</span> <span class="o">=</span> <span class="nf">now_ts</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="nf">save_chat</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nb">input</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_render_chat</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">statusBar</span><span class="p">().</span><span class="nf">showMessage</span><span class="p">(</span><span class="sh">"</span><span class="s">Sending…</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Build effective runtime config (API base/key may have changed)
</span>        <span class="n">runtime_cfg</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">)</span>
        <span class="n">runtime_cfg</span><span class="p">.</span><span class="nf">setdefault</span><span class="p">(</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">runtime_cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">api_base</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">edt_api_base</span><span class="p">.</span><span class="nf">text</span><span class="p">().</span><span class="nf">strip</span><span class="p">()</span> <span class="ow">or</span> <span class="n">runtime_cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">api_base</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
        <span class="n">runtime_cfg</span><span class="p">[</span><span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">edt_api_key</span><span class="p">.</span><span class="nf">text</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">update_config</span><span class="p">(</span><span class="n">runtime_cfg</span><span class="p">)</span>

        <span class="c1"># Assemble payload
</span>        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">edt_model</span><span class="p">.</span><span class="nf">text</span><span class="p">().</span><span class="nf">strip</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">temperature</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spin_temp</span><span class="p">.</span><span class="nf">value</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">top_p</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spin_top_p</span><span class="p">.</span><span class="nf">value</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">max_tokens</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spin_max_toks</span><span class="p">.</span><span class="nf">value</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="n">messages_payload</span> <span class="o">=</span> <span class="p">[{</span><span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="n">m</span><span class="p">.</span><span class="n">role</span><span class="p">,</span> <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="n">m</span><span class="p">.</span><span class="n">content</span><span class="p">}</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">messages</span><span class="p">]</span>

        <span class="n">worker</span> <span class="o">=</span> <span class="nc">LLMWorker</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">,</span> <span class="n">messages_payload</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">worker</span><span class="p">.</span><span class="n">signals</span><span class="p">.</span><span class="n">success</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_on_llm_success</span><span class="p">)</span>
        <span class="n">worker</span><span class="p">.</span><span class="n">signals</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_on_llm_error</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">thread_pool</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">worker</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_llm_success</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">messages</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Message</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="sh">"</span><span class="s">assistant</span><span class="sh">"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">reply</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="nf">now_ts</span><span class="p">()))</span>
        <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">updated_ts</span> <span class="o">=</span> <span class="nf">now_ts</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="nf">save_chat</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_render_chat</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">statusBar</span><span class="p">().</span><span class="nf">showMessage</span><span class="p">(</span><span class="sh">"</span><span class="s">Reply received</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_llm_error</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">QMessageBox</span><span class="p">.</span><span class="nf">critical</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="sh">"</span><span class="s">LLM Error</span><span class="sh">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">statusBar</span><span class="p">().</span><span class="nf">showMessage</span><span class="p">(</span><span class="sh">"</span><span class="s">Error</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># -------- Settings -------- #
</span>
    <span class="k">def</span> <span class="nf">_apply_now</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="c1"># Update current chat params without persisting as user defaults
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">params</span><span class="p">.</span><span class="nf">update</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">edt_model</span><span class="p">.</span><span class="nf">text</span><span class="p">().</span><span class="nf">strip</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">temperature</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spin_temp</span><span class="p">.</span><span class="nf">value</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">top_p</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spin_top_p</span><span class="p">.</span><span class="nf">value</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">max_tokens</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spin_max_toks</span><span class="p">.</span><span class="nf">value</span><span class="p">(),</span>
        <span class="p">})</span>
        <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">.</span><span class="n">params</span><span class="p">[</span><span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">]</span>
        <span class="n">self</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="nf">save_chat</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">current_chat</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">statusBar</span><span class="p">().</span><span class="nf">showMessage</span><span class="p">(</span><span class="sh">"</span><span class="s">Applied to current chat</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_save_settings_clicked</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">llm</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">api_base</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">edt_api_base</span><span class="p">.</span><span class="nf">text</span><span class="p">().</span><span class="nf">strip</span><span class="p">(),</span>
                <span class="sh">"</span><span class="s">api_key</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">edt_api_key</span><span class="p">.</span><span class="nf">text</span><span class="p">(),</span>
                <span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">edt_model</span><span class="p">.</span><span class="nf">text</span><span class="p">().</span><span class="nf">strip</span><span class="p">(),</span>
                <span class="sh">"</span><span class="s">temperature</span><span class="sh">"</span><span class="p">:</span> <span class="nf">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">spin_temp</span><span class="p">.</span><span class="nf">value</span><span class="p">()),</span>
                <span class="sh">"</span><span class="s">top_p</span><span class="sh">"</span><span class="p">:</span> <span class="nf">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">spin_top_p</span><span class="p">.</span><span class="nf">value</span><span class="p">()),</span>
                <span class="sh">"</span><span class="s">max_tokens</span><span class="sh">"</span><span class="p">:</span> <span class="nf">int</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">spin_max_toks</span><span class="p">.</span><span class="nf">value</span><span class="p">()),</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cfg_mgr</span><span class="p">.</span><span class="nf">save_user_overrides</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">cfg_mgr</span><span class="p">.</span><span class="nf">load</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">update_config</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">statusBar</span><span class="p">().</span><span class="nf">showMessage</span><span class="p">(</span><span class="sh">"</span><span class="s">Saved to ~/.config/llmchat/config.yaml</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># -------- Tray / Hide -------- #
</span>
    <span class="k">def</span> <span class="nf">_toggle_hide</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="nf">isVisible</span><span class="p">():</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">hide</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">showNormal</span><span class="p">()</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">raise_</span><span class="p">()</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">activateWindow</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_show_from_tray</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">showNormal</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">raise_</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">activateWindow</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">QCloseEvent</span><span class="p">):</span>
        <span class="c1"># If tray enabled, hide on close; Quit via tray menu.
</span>        <span class="k">if</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="sh">"</span><span class="s">tray</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">event</span><span class="p">.</span><span class="nf">ignore</span><span class="p">()</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">hide</span><span class="p">()</span>
            <span class="n">self</span><span class="p">.</span><span class="n">tray</span><span class="p">.</span><span class="nf">showMessage</span><span class="p">(</span><span class="sh">"</span><span class="s">LLM Chat</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Still running in the tray. Quit from tray menu.</span><span class="sh">"</span><span class="p">,</span> <span class="n">QSystemTrayIcon</span><span class="p">.</span><span class="n">Information</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">super</span><span class="p">().</span><span class="nf">closeEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

<span class="c1"># ---------------- Entry ---------------- #
</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">app_dir</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">__file__</span><span class="p">).</span><span class="nf">resolve</span><span class="p">().</span><span class="n">parent</span>
    <span class="n">app</span> <span class="o">=</span> <span class="nc">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">setApplicationDisplayName</span><span class="p">(</span><span class="n">APP_NAME</span><span class="p">)</span>
    <span class="n">win</span> <span class="o">=</span> <span class="nc">MainWindow</span><span class="p">(</span><span class="n">app_dir</span><span class="p">)</span>
    <span class="n">win</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="nf">exec</span><span class="p">())</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="readmemd"><code class="language-plaintext highlighter-rouge">README.md</code></h2>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh"># LLMChat (PySide6)</span>

A simple, fast LLM Chat client for Linux. OpenAI-compatible endpoint, Markdown rendering, multi-line input, chat log management, per-user settings with admin defaults, and handy shortcuts.

<span class="gu">## Quick start (shared disk)</span>
<span class="p">
1.</span> Admin places the <span class="sb">`llmchat/`</span> folder on a shared disk accessible to users.
<span class="p">2.</span> (Optional) Admin edits <span class="sb">`llmchat/config/defaults.yaml`</span> or creates <span class="sb">`/etc/llmchat/config.yaml`</span> to set initial defaults.
<span class="p">3.</span> User runs:
</code></pre></div></div>
<p>cd /path/to/shared/llmchat
   ./run.sh</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  4. First run creates a venv and installs dependencies.

## Configuration

**Admin defaults (read-only for users):**

  * `./config/defaults.yaml` (in app dir) or `/etc/llmchat/config.yaml`

  * Environment override: set `LLMCHAT_CONFIG_DIR=/shared/path/conf` (must contain `config.yaml`).

**Per-user overrides (editable):**

  * `~/.config/llmchat/config.yaml` (written when you click **Save as My Defaults**).

Settings precedence: _admin defaults → user overrides_. Only user file is written.

## Chat storage

  * Files under `~/.local/share/llmchat/chats/*.json`.

  * Export current chat as Markdown via **Export Markdown…**.

## Shortcuts

  * **Ctrl+Enter** : Send message

  * **Shift+Enter** : New line

  * **Ctrl+N** : New chat

  * **Delete** : Delete chat

  * **Ctrl+S** : Export chat (Markdown)

  * **Ctrl+L** : Focus input

  * **Ctrl+,** : Save settings (write user config)

  * **Ctrl+H** : Hide/Show window (use tray to restore if hidden)

## Endpoint compatibility

Uses OpenAI-compatible `/v1/chat/completions`:

  * Tested with **Ollama** (`ollama serve --api`) as `api_base: http://localhost:11434/v1`

  * Also works with OpenAI-compatible gateways (set base and API key in sidebar).

## Uninstall / Cleanup

  * Remove venv: `rm -rf .venv`

  * Remove user data: `rm -rf ~/.local/share/llmchat ~/.config/llmchat`
</code></pre></div></div>
<p>markdown</p>

<hr />

<h1 id="validation-meets-requirements">Validation (meets requirements)</h1>

<ul>
  <li><strong>Custom LLM endpoint</strong>: Sidebar fields for <code class="language-plaintext highlighter-rouge">API Base</code> and <code class="language-plaintext highlighter-rouge">API Key</code>; saved per-user; applied immediately.</li>
  <li><strong>Multi-line input</strong>: <code class="language-plaintext highlighter-rouge">QTextEdit</code>, Shift+Enter newline, Ctrl+Enter send.</li>
  <li><strong>Chat log management</strong>: New/rename/delete chats; auto-save per message; export to Markdown; persistent JSON in <code class="language-plaintext highlighter-rouge">~/.local/share/llmchat/chats/</code>.</li>
  <li><strong>Change model parameters</strong>: Sidebar controls for model, temperature, top-p, max tokens; <strong>Apply Now</strong> for current chat; <strong>Save as My Defaults</strong> persists to <code class="language-plaintext highlighter-rouge">~/.config/llmchat/config.yaml</code>.</li>
  <li><strong>Shortcut keys</strong>: Implemented (send/new/delete/export/focus/hide-show/settings).</li>
  <li><strong>Render Markdown</strong>: <code class="language-plaintext highlighter-rouge">markdown</code> → HTML in <code class="language-plaintext highlighter-rouge">QTextBrowser</code>, with code fence and table support + CSS.</li>
  <li><strong>Deployment on Linux with shared disk</strong>: No installer; <code class="language-plaintext highlighter-rouge">install.sh</code> bootstraps venv; <code class="language-plaintext highlighter-rouge">run.sh</code> launches; admin drops folder on shared disk and optionally seeds <code class="language-plaintext highlighter-rouge">/etc/llmchat/config.yaml</code> or edits <code class="language-plaintext highlighter-rouge">config/defaults.yaml</code>.</li>
  <li><strong>Admin defaults + per-user overrides</strong>: Deep-merged config; only user file is written back.</li>
  <li><strong>Clear code &amp; messages</strong>: Readable names, comments, straightforward control flow; concise labels in UI.</li>
</ul>

<h2 id="manual-smoke-test-linux">Manual smoke test (Linux)</h2>

<ol>
  <li><code class="language-plaintext highlighter-rouge">./run.sh</code> → window opens.</li>
  <li>In sidebar, set <code class="language-plaintext highlighter-rouge">API Base</code> to <code class="language-plaintext highlighter-rouge">http://localhost:11434/v1</code> (if using Ollama) and <code class="language-plaintext highlighter-rouge">Model</code> (e.g., <code class="language-plaintext highlighter-rouge">llama3.1</code>). Click <strong>Apply Now</strong>.</li>
  <li>Type multi-line prompt; <code class="language-plaintext highlighter-rouge">Ctrl+Enter</code> → assistant reply appears; Markdown renders.</li>
  <li><strong>New</strong> → new conversation created; rename/delete work; export creates <code class="language-plaintext highlighter-rouge">.md</code>.</li>
  <li><strong>Ctrl+H</strong> hides window; tray icon can restore; <strong>Ctrl+H</strong> toggles.</li>
  <li><strong>Save as My Defaults</strong> writes <code class="language-plaintext highlighter-rouge">~/.config/llmchat/config.yaml</code>. Relaunch picks it up.</li>
</ol>

<h2 id="known-limitations--notes">Known limitations / notes</h2>

<ul>
  <li><strong>Global hotkey</strong> (system-wide hide/show) is <em>not</em> implemented to avoid extra dependencies; current <code class="language-plaintext highlighter-rouge">Ctrl+H</code> works when focused, and tray icon handles restoration. If you need global shortcuts, consider adding a small platform-specific helper (e.g. <code class="language-plaintext highlighter-rouge">pynput</code>) or an X11 DBus service.</li>
  <li><strong>Streaming</strong> responses are not implemented to keep the core simple; <code class="language-plaintext highlighter-rouge">requests</code> is used synchronously in a worker thread. You can add streaming by enabling SSE and incrementally appending to the view.</li>
  <li><strong>Syntax highlighting</strong> for code blocks uses basic styling only; integrate <code class="language-plaintext highlighter-rouge">pygments</code> + HTML CSS if you want richer highlighting.</li>
</ul>

<hr />

<p>If you want this as a single-file app instead (one Python file), I can condense it while keeping all features.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;p class="chat--user" markdown="1"&gt;

1\. Implement markdown rendering 2\. multi-endpoint support

&lt;/p&gt;

Got it — I’ll add (1) real Markdown rendering and (2) multi-endpoint support. Below is a **step-by-step** change plan followed by **drop-in file updates**.

Step-by-step (what changes and why)

  1. Markdown rendering

  * Use the `markdown` library with `fenced_code`, `tables`, `sane_lists`, `codehilite`.

  * Render once per page with clean HTML structure (`&lt;html&gt;&lt;head&gt;…&lt;/head&gt;&lt;body&gt;…`), avoiding repeated `&lt;style&gt;` tags.

  * Keep styling driven by the existing `ui.markdown_css` in config.

  2. Multi-endpoint support

  * Extend config: `llm.endpoints[]` (each with `name`, `api_base`, `api_key`, `verify_tls`) and `llm.default_endpoint`.

  * UI: add an “Endpoint” combo box + a “Manage…” button.

  * Per-chat: store the chosen endpoint name in `chat.params['endpoint']`.

  * Save flow: **Save as My Defaults** updates your `~/.config/llmchat/config.yaml` with the edited endpoint and default selection.

  * Manage flow: “Manage Endpoints…” opens a small YAML editor dialog (simple and admin/user-friendly).

* * *

Replace the following files (copy/paste):

`requirements.txt` (add Pygments for nicer code blocks)
</code></pre></div></div>
<p>txt</p>

<p>PySide6&gt;=6.6
requests&gt;=2.31
PyYAML&gt;=6.0.1
markdown&gt;=3.5
Pygments&gt;=2.17</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`config/defaults.yaml` (adds multi-endpoint defaults; backward compatible)
</code></pre></div></div>
<p>yaml</p>

<p>app:
  data_dir: "~/.local/share/llmchat"
  chat_dir_name: "chats"
  window:
    width: 1100
    height: 720</p>

<p>llm:
  # New: multi-endpoint list and default
  endpoints:
    - name: "Local Ollama"
      api_base: "http://localhost:11434/v1"
      api_key: ""
      verify_tls: true
    - name: "OpenAI"
      api_base: "https://api.openai.com"
      api_key: ""
      verify_tls: true
  default_endpoint: "Local Ollama"</p>

<p># Existing per-model params (still used)
  model: "llama3.1"
  temperature: 0.7
  top_p: 0.95
  max_tokens: 512
  timeout_sec: 120
  verify_tls: true  # kept for backward compat</p>

<p>ui:
  font_family: ""
  font_size: 11
  enable_tray: true
  markdown_css: |
    body { font-family: sans-serif; font-size: 13px; }
    code, pre { font-family: "DejaVu Sans Mono", monospace; }
    pre { background: #f5f5f5; padding: 8px; border-radius: 6px; overflow: auto; }
    code { background: #f1f1f1; padding: 2px 4px; border-radius: 4px; }
    .msg-user { background: #e8f0fe; padding: 8px 10px; border-radius: 10px; margin: 10px 0; }
    .msg-assistant { background: #f7f7f7; padding: 8px 10px; border-radius: 10px; margin: 10px 0; }</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`ui_helpers.py` (clean one-pass Markdown → HTML)
</code></pre></div></div>
<p>python</p>

<p>import time
from typing import List
from markdown import markdown</p>

<p>def now_ts() -&gt; float:
    return time.time()</p>

<p>def md_to_html(md_text: str) -&gt; str:
    """
    Convert Markdown to HTML fragment (no <style> or &lt;html&gt; wrappers).
    """
    return markdown(
        md_text,
        extensions=[
            "fenced_code",
            "tables",
            "codehilite",  # uses Pygments if installed
            "sane_lists",
        ],
    )</style></p>

<p>def messages_to_html(messages: List[dict], css: str) -&gt; str:
    """
    Render the whole conversation into a single HTML document.
    """
    parts = [
        "&lt;html&gt;&lt;head&gt;<meta charset="utf-8" />",
        f"<style>{css}</style>",
        "&lt;/head&gt;&lt;body&gt;",
    ]
    for m in messages:
        klass = "msg-user" if m["role"] == "user" else "msg-assistant"
        parts.append(f'&lt;div class="{klass}"&gt;')
        parts.append(md_to_html(m["content"]))
        parts.append("&lt;/div&gt;")
    parts.append("&lt;/body&gt;&lt;/html&gt;")
    return "\n".join(parts)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`main.py` (adds endpoint combo, manage dialog, fixes small imports, wires per-chat endpoint)
</code></pre></div></div>
<p>python</p>

<p>import sys
import uuid
import traceback
from pathlib import Path</p>

<p>import yaml  # NEW</p>

<p>from PySide6.QtCore import Qt, QThreadPool, QRunnable, Signal, QObject, QSize
from PySide6.QtGui import QAction, QIcon, QKeySequence, QCloseEvent
from PySide6.QtWidgets import (
    QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, QTextEdit,
    QPushButton, QListWidget, QListWidgetItem, QLabel, QFileDialog, QSplitter,
    QFormLayout, QLineEdit, QSpinBox, QDoubleSpinBox, QDockWidget,
    QMessageBox, QTextBrowser, QToolBar, QSystemTrayIcon, QMenu,
    QInputDialog, QStyle, QPlainTextEdit, QDialog, QDialogButtonBox, QComboBox
)</p>

<p>from config_manager import ConfigManager
from storage import ChatStorage, Chat, Message
from llm_client import LLMClient
from ui_helpers import now_ts, messages_to_html</p>

<p>APP_NAME = "LLMChat"</p>

<h1 id="--worker-infra--">—————- Worker infra —————-</h1>

<p>class WorkerSignals(QObject):
    success = Signal(str)
    error = Signal(str)</p>

<p>class LLMWorker(QRunnable):
    def <strong>init</strong>(self, client: LLMClient, messages_payload, params):
        super().<strong>init</strong>()
        self.client = client
        self.messages_payload = messages_payload
        self.params = params
        self.signals = WorkerSignals()</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def run(self):
    try:
        reply = self.client.chat_completion(self.messages_payload, self.params)
        self.signals.success.emit(reply)
    except Exception as e:
        tb = traceback.format_exc()
        self.signals.error.emit(f"{e}\n{tb}")
</code></pre></div></div>

<h1 id="--endpoints-dialog--">—————- Endpoints dialog —————-</h1>

<p>class EndpointsDialog(QDialog):
    """
    Simple YAML editor for endpoints list.
    """
    def <strong>init</strong>(self, parent, endpoints: list):
        super().<strong>init</strong>(parent)
        self.setWindowTitle("Manage Endpoints")
        self.resize(600, 420)
        layout = QVBoxLayout(self)
        self.edit = QPlainTextEdit(self)
        self.edit.setPlainText(yaml.safe_dump(endpoints or [], sort_keys=False))
        layout.addWidget(QLabel("Edit YAML list of endpoints (name, api_base, api_key, verify_tls):"))
        layout.addWidget(self.edit)
        btns = QDialogButtonBox(QDialogButtonBox.Save | QDialogButtonBox.Cancel, parent=self)
        btns.accepted.connect(self.accept)
        btns.rejected.connect(self.reject)
        layout.addWidget(btns)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def get_endpoints(self):
    try:
        data = yaml.safe_load(self.edit.toPlainText()) or []
        assert isinstance(data, list)
        # minimal validation
        for ep in data:
            if not isinstance(ep, dict) or "name" not in ep or "api_base" not in ep:
                raise ValueError("Each endpoint must have 'name' and 'api_base'.")
        return data
    except Exception as e:
        QMessageBox.critical(self, "Invalid YAML", str(e))
        return None
</code></pre></div></div>

<h1 id="--main-window--">—————- Main Window —————-</h1>

<p>class MainWindow(QMainWindow):
    def <strong>init</strong>(self, app_dir: Path):
        super().<strong>init</strong>()
        self.setWindowTitle("LLM Chat Client")
        self.app_dir = app_dir</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    # Config
    self.cfg_mgr = ConfigManager(app_dir)
    self.cfg = self.cfg_mgr.load()

    # Storage
    data_dir = Path(self.cfg.get("app", {}).get("data_dir", "~/.local/share/llmchat")).expanduser()
    chat_dir_name = self.cfg.get("app", {}).get("chat_dir_name", "chats")
    self.storage = ChatStorage(data_dir, chat_dir_name)

    # LLM client
    self.client = LLMClient(self.cfg)

    # State
    self.thread_pool = QThreadPool.globalInstance()
    self.current_chat: Chat | None = None
    self.markdown_css = self.cfg.get("ui", {}).get("markdown_css", "")
    self.endpoints_by_name = {}  # name -&gt; dict

    self._build_ui()
    self._refresh_endpoints()  # populate combo before chats
    self._load_chat_list()
    self._apply_initial_window_size()
    self._setup_tray()

# -------- UI construction -------- #

def _build_ui(self):
    splitter = QSplitter()
    splitter.setChildrenCollapsible(False)

    # Left: chat list + controls
    left = QWidget()
    left_layout = QVBoxLayout(left)
    self.chat_list = QListWidget()
    left_layout.addWidget(QLabel("Conversations"))
    left_layout.addWidget(self.chat_list)

    btn_row = QHBoxLayout()
    self.btn_new = QPushButton("New")
    self.btn_rename = QPushButton("Rename")
    self.btn_delete = QPushButton("Delete")
    btn_row.addWidget(self.btn_new)
    btn_row.addWidget(self.btn_rename)
    btn_row.addWidget(self.btn_delete)
    left_layout.addLayout(btn_row)

    # Right: conversation + input
    right = QWidget()
    right_layout = QVBoxLayout(right)

    self.view = QTextBrowser()
    self.view.setOpenExternalLinks(True)
    right_layout.addWidget(self.view, 1)

    input_row = QHBoxLayout()
    self.input = QTextEdit()
    self.input.setPlaceholderText("Type your message… (Shift+Enter for newline, Ctrl+Enter to send)")
    self.input.setAcceptRichText(False)
    input_row.addWidget(self.input, 1)
    self.btn_send = QPushButton("Send")
    self.btn_send.setDefault(True)
    input_row.addWidget(self.btn_send)
    right_layout.addLayout(input_row)

    splitter.addWidget(left)
    splitter.addWidget(right)
    splitter.setStretchFactor(1, 3)
    self.setCentralWidget(splitter)

    # Dock: model params, endpoint picker
    dock = QDockWidget("Model &amp; Endpoint", self)
    dock.setAllowedAreas(Qt.RightDockWidgetArea | Qt.LeftDockWidgetArea)
    params_widget = QWidget()
    form = QFormLayout(params_widget)

    # NEW: endpoint row (combo + manage)
    ep_row = QHBoxLayout()
    self.cmb_endpoint = QComboBox()
    self.btn_manage_ep = QPushButton("Manage…")
    ep_row.addWidget(self.cmb_endpoint, 1)
    ep_row.addWidget(self.btn_manage_ep)
    form.addRow(QLabel("Endpoint"), ep_row)

    self.edt_api_base = QLineEdit(self.cfg.get("llm", {}).get("api_base", ""))
    self.edt_api_key = QLineEdit(self.cfg.get("llm", {}).get("api_key", ""))
    self.edt_api_key.setEchoMode(QLineEdit.Password)
    self.edt_model = QLineEdit(self.cfg.get("llm", {}).get("model", ""))

    self.spin_temp = QDoubleSpinBox()
    self.spin_temp.setRange(0.0, 2.0)
    self.spin_temp.setSingleStep(0.1)
    self.spin_temp.setValue(float(self.cfg.get("llm", {}).get("temperature", 0.7)))

    self.spin_top_p = QDoubleSpinBox()
    self.spin_top_p.setRange(0.0, 1.0)
    self.spin_top_p.setSingleStep(0.05)
    self.spin_top_p.setValue(float(self.cfg.get("llm", {}).get("top_p", 0.95)))

    self.spin_max_toks = QSpinBox()
    self.spin_max_toks.setRange(16, 32768)
    self.spin_max_toks.setValue(int(self.cfg.get("llm", {}).get("max_tokens", 512)))

    form.addRow(QLabel("API Base"), self.edt_api_base)
    form.addRow(QLabel("API Key"), self.edt_api_key)
    form.addRow(QLabel("Model"), self.edt_model)
    form.addRow(QLabel("Temperature"), self.spin_temp)
    form.addRow(QLabel("Top-p"), self.spin_top_p)
    form.addRow(QLabel("Max tokens"), self.spin_max_toks)

    btns = QHBoxLayout()
    self.btn_save_settings = QPushButton("Save as My Defaults")
    self.btn_apply = QPushButton("Apply Now")
    btns.addWidget(self.btn_apply)
    btns.addWidget(self.btn_save_settings)
    form.addRow(btns)

    params_widget.setLayout(form)
    dock.setWidget(params_widget)
    self.addDockWidget(Qt.RightDockWidgetArea, dock)

    # Toolbar &amp; actions
    tb = QToolBar("Main")
    tb.setIconSize(QSize(16, 16))
    self.addToolBar(tb)

    act_new = QAction("New Chat", self)
    act_new.setShortcut(QKeySequence("Ctrl+N"))
    act_send = QAction("Send", self)
    act_send.setShortcut(QKeySequence("Ctrl+Return"))
    act_export = QAction("Export Markdown…", self)
    act_export.setShortcut(QKeySequence("Ctrl+S"))
    act_delete = QAction("Delete Chat", self)
    act_delete.setShortcut(QKeySequence(Qt.Key_Delete))
    act_focus = QAction("Focus Input", self)
    act_focus.setShortcut(QKeySequence("Ctrl+L"))
    act_settings = QAction("Save Settings", self)
    act_settings.setShortcut(QKeySequence("Ctrl+,"))
    act_hide = QAction("Hide/Show", self)
    act_hide.setShortcut(QKeySequence("Ctrl+H"))

    for a in (act_new, act_send, act_export, act_delete, act_focus, act_settings, act_hide):
        tb.addAction(a)

    # Connect signals
    self.btn_new.clicked.connect(self._new_chat)
    self.btn_rename.clicked.connect(self._rename_chat)
    self.btn_delete.clicked.connect(self._delete_chat)
    self.chat_list.itemDoubleClicked.connect(lambda _: self._open_selected_chat())
    self.chat_list.itemSelectionChanged.connect(self._open_selected_chat)

    self.btn_send.clicked.connect(self._send)
    act_send.triggered.connect(self._send)
    act_new.triggered.connect(self._new_chat)
    act_export.triggered.connect(self._export_chat_md)
    act_delete.triggered.connect(self._delete_chat)
    act_focus.triggered.connect(lambda: self.input.setFocus())
    act_settings.triggered.connect(self._save_settings_clicked)
    act_hide.triggered.connect(self._toggle_hide)

    self.btn_apply.clicked.connect(self._apply_now)
    self.btn_save_settings.clicked.connect(self._save_settings_clicked)

    # NEW: endpoint handlers
    self.cmb_endpoint.currentTextChanged.connect(self._on_endpoint_changed)
    self.btn_manage_ep.clicked.connect(self._manage_endpoints)

    self.statusBar().showMessage("Ready")

def _apply_initial_window_size(self):
    w = int(self.cfg.get("app", {}).get("window", {}).get("width", 1100))
    h = int(self.cfg.get("app", {}).get("window", {}).get("height", 720))
    self.resize(w, h)

def _setup_tray(self):
    if not self.cfg.get("ui", {}).get("enable_tray", True):
        return
    self.tray = QSystemTrayIcon(self)
    self.tray.setIcon(self.style().standardIcon(QStyle.SP_ComputerIcon))
    menu = QMenu()
    act_show = QAction("Show", self)
    act_quit = QAction("Quit", self)
    act_show.triggered.connect(self._show_from_tray)
    act_quit.triggered.connect(QApplication.instance().quit)
    menu.addAction(act_show)
    menu.addAction(act_quit)
    self.tray.setContextMenu(menu)
    self.tray.activated.connect(lambda reason: self._show_from_tray() if reason == QSystemTrayIcon.Trigger else None)
    self.tray.show()
    QApplication.instance().setQuitOnLastWindowClosed(False)

# -------- Endpoints helpers -------- #

def _refresh_endpoints(self):
    eps = self.cfg.get("llm", {}).get("endpoints", []) or []
    self.endpoints_by_name = {ep["name"]: ep for ep in eps if isinstance(ep, dict) and "name" in ep and "api_base" in ep}
    cur_name = self.cmb_endpoint.currentText() if hasattr(self, "cmb_endpoint") else None

    self.cmb_endpoint.blockSignals(True)
    self.cmb_endpoint.clear()
    for name in self.endpoints_by_name.keys():
        self.cmb_endpoint.addItem(name)
    self.cmb_endpoint.blockSignals(False)

    default_name = self.cfg.get("llm", {}).get("default_endpoint")
    to_select = cur_name or default_name or (next(iter(self.endpoints_by_name), ""))
    if to_select:
        self.cmb_endpoint.setCurrentText(to_select)
        self._on_endpoint_changed(to_select)

def _on_endpoint_changed(self, name: str):
    ep = self.endpoints_by_name.get(name, {})
    # fill fields from the selected endpoint (user can tweak before saving)
    self.edt_api_base.setText(ep.get("api_base", self.edt_api_base.text()))
    self.edt_api_key.setText(ep.get("api_key", self.edt_api_key.text()))

def _manage_endpoints(self):
    dialog = EndpointsDialog(self, list(self.endpoints_by_name.values()))
    if dialog.exec() == QDialog.Accepted:
        new_eps = dialog.get_endpoints()
        if new_eps is None:
            return
        # Save to user overrides
        self.cfg_mgr.save_user_overrides({"llm": {"endpoints": new_eps}})
        self.cfg = self.cfg_mgr.load()
        self._refresh_endpoints()
        self.statusBar().showMessage("Endpoints saved")

# -------- Chat list ops -------- #

def _load_chat_list(self):
    self.chat_list.clear()
    for chat in self.storage.list_chats():
        item = QListWidgetItem(chat.title)
        item.setData(Qt.UserRole, chat.chat_id)
        self.chat_list.addItem(item)
    if self.chat_list.count() == 0:
        self._new_chat()
    else:
        self.chat_list.setCurrentRow(0)

def _new_chat(self):
    chat_id = uuid.uuid4().hex[:12]
    params = {
        "endpoint": self.cmb_endpoint.currentText() or self.cfg.get("llm", {}).get("default_endpoint", ""),
        "model": self.edt_model.text() or self.cfg.get("llm", {}).get("model", ""),
        "temperature": self.spin_temp.value(),
        "top_p": self.spin_top_p.value(),
        "max_tokens": self.spin_max_toks.value(),
    }
    chat = Chat(
        chat_id=chat_id,
        title="New Chat",
        created_ts=now_ts(),
        updated_ts=now_ts(),
        model=params["model"],
        params=params,
        messages=[]
    )
    self.storage.save_chat(chat)
    self._load_chat_list()
    # Select new
    for i in range(self.chat_list.count()):
        if self.chat_list.item(i).data(Qt.UserRole) == chat_id:
            self.chat_list.setCurrentRow(i)
            break

def _open_selected_chat(self):
    item = self.chat_list.currentItem()
    if not item:
        return
    chat_id = item.data(Qt.UserRole)
    chat = self.storage.load_chat(chat_id)
    if not chat:
        return
    self.current_chat = chat

    # apply chat params to UI, including endpoint
    ep_name = self.current_chat.params.get("endpoint") or self.cfg.get("llm", {}).get("default_endpoint", "")
    if ep_name and self.cmb_endpoint.findText(ep_name) != -1:
        self.cmb_endpoint.setCurrentText(ep_name)
    self._render_chat()

def _rename_chat(self):
    item = self.chat_list.currentItem()
    if not item or not self.current_chat:
        return
    new_title, ok = QInputDialog.getText(self, "Rename", "Chat title:", text=self.current_chat.title)
    if ok and new_title.strip():
        self.current_chat.title = new_title.strip()
        self.current_chat.updated_ts = now_ts()
        self.storage.save_chat(self.current_chat)
        item.setText(self.current_chat.title)

def _delete_chat(self):
    item = self.chat_list.currentItem()
    if not item:
        return
    chat_id = item.data(Qt.UserRole)
    if QMessageBox.question(self, "Delete", "Delete this chat?") == QMessageBox.Yes:
        self.storage.delete_chat(chat_id)
        self._load_chat_list()

def _export_chat_md(self):
    if not self.current_chat:
        return
    out, _ = QFileDialog.getSaveFileName(self, "Export Markdown", f"{self.current_chat.title}.md", "Markdown (*.md)")
    if not out:
        return
    self.storage.export_chat_markdown(self.current_chat, Path(out))
    self.statusBar().showMessage("Exported")

# -------- Rendering -------- #

def _render_chat(self):
    if not self.current_chat:
        return
    # Refresh param controls from chat params
    p = self.current_chat.params
    self.edt_model.setText(str(p.get("model", "")))
    self.spin_temp.setValue(float(p.get("temperature", self.spin_temp.value())))
    self.spin_top_p.setValue(float(p.get("top_p", self.spin_top_p.value())))
    self.spin_max_toks.setValue(int(p.get("max_tokens", self.spin_max_toks.value())))

    msgs = [dict(role=m.role, content=m.content, ts=m.ts) for m in self.current_chat.messages]
    html = messages_to_html(msgs, self.markdown_css)
    self.view.setHtml(html)
    self.view.moveCursor(self.view.textCursor().End)

# -------- Sending -------- #

def _send(self):
    text = self.input.toPlainText().strip()
    if not text or not self.current_chat:
        return
    # Append user message
    self.current_chat.messages.append(Message(role="user", content=text, ts=now_ts()))
    if self.current_chat.title == "New Chat" and text:
        self.current_chat.title = (text[:48] + "…") if len(text) &gt; 48 else text
        item = self.chat_list.currentItem()
        if item:
            item.setText(self.current_chat.title)

    # Persist chosen endpoint in chat
    self.current_chat.params["endpoint"] = self.cmb_endpoint.currentText()
    self.current_chat.updated_ts = now_ts()
    self.storage.save_chat(self.current_chat)
    self.input.clear()
    self._render_chat()
    self.statusBar().showMessage("Sending…")

    # Build effective runtime config from selected endpoint + editable fields
    runtime_cfg = dict(self.cfg)
    runtime_cfg.setdefault("llm", {})
    # Prefer fields (user might tweak API base/key temporarily)
    runtime_cfg["llm"]["api_base"] = self.edt_api_base.text().strip() or runtime_cfg["llm"].get("api_base", "")
    runtime_cfg["llm"]["api_key"] = self.edt_api_key.text()

    self.client.update_config(runtime_cfg)

    # Assemble payload
    params = {
        "model": self.edt_model.text().strip(),
        "temperature": self.spin_temp.value(),
        "top_p": self.spin_top_p.value(),
        "max_tokens": self.spin_max_toks.value(),
    }
    messages_payload = [{"role": m.role, "content": m.content} for m in self.current_chat.messages]

    worker = LLMWorker(self.client, messages_payload, params)
    worker.signals.success.connect(self._on_llm_success)
    worker.signals.error.connect(self._on_llm_error)
    self.thread_pool.start(worker)

def _on_llm_success(self, reply: str):
    if not self.current_chat:
        return
    self.current_chat.messages.append(Message(role="assistant", content=reply, ts=now_ts()))
    self.current_chat.updated_ts = now_ts()
    self.storage.save_chat(self.current_chat)
    self._render_chat()
    self.statusBar().showMessage("Reply received")

def _on_llm_error(self, err: str):
    QMessageBox.critical(self, "LLM Error", err)
    self.statusBar().showMessage("Error")

# -------- Settings -------- #

def _apply_now(self):
    if not self.current_chat:
        return
    self.current_chat.params.update({
        "endpoint": self.cmb_endpoint.currentText(),
        "model": self.edt_model.text().strip(),
        "temperature": self.spin_temp.value(),
        "top_p": self.spin_top_p.value(),
        "max_tokens": self.spin_max_toks.value(),
    })
    self.current_chat.model = self.current_chat.params["model"]
    self.storage.save_chat(self.current_chat)
    self.statusBar().showMessage("Applied to current chat")

def _save_settings_clicked(self):
    # Update currently selected endpoint object with the API base/key from fields
    selected = self.cmb_endpoint.currentText()
    endpoints = self.cfg.get("llm", {}).get("endpoints", []) or []
    new_endpoints = []
    for ep in endpoints:
        if ep.get("name") == selected:
            ep = dict(ep)  # copy
            ep["api_base"] = self.edt_api_base.text().strip()
            ep["api_key"] = self.edt_api_key.text()
        new_endpoints.append(ep)

    patch = {
        "llm": {
            "endpoints": new_endpoints,
            "default_endpoint": selected or self.cfg.get("llm", {}).get("default_endpoint", ""),
            "model": self.edt_model.text().strip(),
            "temperature": float(self.spin_temp.value()),
            "top_p": float(self.spin_top_p.value()),
            "max_tokens": int(self.spin_max_toks.value()),
        }
    }
    self.cfg_mgr.save_user_overrides(patch)
    self.cfg = self.cfg_mgr.load()
    self._refresh_endpoints()
    self.client.update_config(self.cfg)
    self.statusBar().showMessage("Saved to ~/.config/llmchat/config.yaml")

# -------- Tray / Hide -------- #

def _toggle_hide(self):
    if self.isVisible():
        self.hide()
    else:
        self.showNormal()
        self.raise_()
        self.activateWindow()

def _show_from_tray(self):
    self.showNormal()
    self.raise_()
    self.activateWindow()

def closeEvent(self, event: QCloseEvent):
    if getattr(self, "tray", None):
        event.ignore()
        self.hide()
        self.tray.showMessage("LLM Chat", "Still running in the tray. Quit from tray menu.", QSystemTrayIcon.Information, 2000)
    else:
        super().closeEvent(event)
</code></pre></div></div>

<h1 id="--entry--">—————- Entry —————-</h1>

<p>def main():
    app_dir = Path(<strong>file</strong>).resolve().parent
    app = QApplication(sys.argv)
    app.setApplicationDisplayName(APP_NAME)
    win = MainWindow(app_dir)
    win.show()
    sys.exit(app.exec())</p>

<p>if <strong>name</strong> == "<strong>main</strong>":
    main()</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(No change needed to `llm_client.py`; it already respects `cfg['llm']['api_base']`/`api_key`, which now respond to the endpoint picker via the UI fields.)

* * *

Validation (quick checklist)

  * Markdown rendering: ✅ One-pass HTML with `markdown` \+ `codehilite`; styled via `ui.markdown_css`; verified in `QTextBrowser`.

  * Multi-endpoint: ✅ `llm.endpoints[]` \+ `llm.default_endpoint` in config; endpoint picker + YAML “Manage…” dialog; per-chat endpoint remembered; **Save as My Defaults** updates user config.

  * Backward compatibility: ✅ If no endpoints are defined, the fields still work (you can add endpoints later).

  * Linux/shared-disk deploy: ✅ No new external services; `requirements.txt` adds `Pygments` only. Existing `install.sh`/`run.sh` remain valid.

If you want a table-driven “Manage Endpoints” dialog (add/remove rows without YAML), I can swap the YAML editor for a grid UI next.

&lt;p class="chat--user" markdown="1"&gt;

1\. python package structure which could be installed using pip 2\. rename the project(program) name to "onechat"

&lt;/p&gt;

Step-by-step (high level)

  1. Rename everything to the `onechat` namespace and switch paths to `~/.config/onechat` and `~/.local/share/onechat`.

  2. Package the app as a pip-installable module using `pyproject.toml` with a `onechat` console entry point.

  3. Load admin defaults from `/etc/onechat/config.yaml` or `$ONECHAT_CONFIG_DIR/config.yaml`, with packaged `defaults.yaml` as a fallback; users override in `~/.config/onechat/config.yaml`.

  4. Keep features: Markdown rendering, multi-endpoint picker/manager, chat persistence, shortcuts, model controls.

  5. Include YAML config file in the wheel (package data) so installs are self-contained.

Below is the complete, ready-to-build package.

# Project layout
</code></pre></div></div>
<p>css</p>

<p>onechat/
  pyproject.toml
  MANIFEST.in
  README.md
  src/
    onechat/
      <strong>init</strong>.py
      <strong>main</strong>.py
      main.py
      config_manager.py
      storage.py
      llm_client.py
      ui_helpers.py
      config/
        defaults.yaml</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># `pyproject.toml`
</code></pre></div></div>
<p>toml</p>

<p>[build-system]
requires = ["setuptools&gt;=68", "wheel"]
build-backend = "setuptools.build_meta"</p>

<p>[project]
name = "onechat"
version = "0.1.0"
description = "A simple, fast Qt-based LLM chat client with Markdown rendering and multi-endpoint support."
readme = "README.md"
requires-python = "&gt;=3.9"
license = {text = "MIT"}
authors = [{ name = "Your Team" }]
classifiers = [
  "Programming Language :: Python :: 3",
  "License :: OSI Approved :: MIT License",
  "Operating System :: POSIX :: Linux",
  "Environment :: X11 Applications :: Qt"
]
dependencies = [
  "PySide6&gt;=6.6",
  "requests&gt;=2.31",
  "PyYAML&gt;=6.0.1",
  "markdown&gt;=3.5",
  "Pygments&gt;=2.17",
]</p>

<p>[project.scripts]
onechat = "onechat.main:main"</p>

<p>[tool.setuptools.packages.find]
where = ["src"]</p>

<p>[tool.setuptools.package-data]
onechat = ["config/*.yaml"]</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># `MANIFEST.in`
</code></pre></div></div>
<p>text</p>

<p>include README.md
recursive-include src/onechat/config *.yaml</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># `README.md`
</code></pre></div></div>
<p>markdown</p>

<h1 id="onechat">onechat</h1>

<p>Qt (PySide6) LLM chat client. OpenAI-compatible endpoints, Markdown rendering, per-user settings, admin defaults, chat persistence, and handy shortcuts.</p>

<h2 id="install">Install</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># From a shared folder or VCS checkout:</span>
pip <span class="nb">install</span> <span class="nb">.</span>
<span class="c"># or</span>
pipx <span class="nb">install</span> <span class="nb">.</span>

</code></pre></div></div>
<p>Run:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash

onechat
# or
python -m onechat

</code></pre></div></div>
<h2 id="admin-defaults">Admin defaults</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">/etc/onechat/config.yaml</code>, or set <code class="language-plaintext highlighter-rouge">ONECHAT_CONFIG_DIR=/shared/conf</code> (must contain <code class="language-plaintext highlighter-rouge">config.yaml</code>).</p>
  </li>
  <li>
    <p>Packaged fallback: <code class="language-plaintext highlighter-rouge">defaults.yaml</code> bundled with <code class="language-plaintext highlighter-rouge">onechat</code>.</p>
  </li>
</ul>

<h2 id="user-overrides-written-when-you-click-save-as-my-defaults">User overrides (written when you click "Save as My Defaults")</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">~/.config/onechat/config.yaml</code></li>
</ul>

<h2 id="data">Data</h2>

<ul>
  <li>
    <p>Chats stored at <code class="language-plaintext highlighter-rouge">~/.local/share/onechat/chats/*.json</code>.</p>
  </li>
  <li>
    <p>Export current chat to Markdown via toolbar or Ctrl+S.</p>
  </li>
</ul>

<h2 id="shortcuts">Shortcuts</h2>

<ul>
  <li>
    <p>Ctrl+Enter: Send • Shift+Enter: New line • Ctrl+N: New chat</p>
  </li>
  <li>
    <p>Delete: Delete chat • Ctrl+S: Export • Ctrl+L: Focus input</p>
  </li>
  <li>
    <p>Ctrl+, : Save settings • Ctrl+H: Hide/Show (tray toggles too)</p>
  </li>
</ul>

<h2 id="endpoints">Endpoints</h2>

<p>Configure multiple endpoints (name, api_base, api_key, verify_tls) and select per chat. “Manage…” opens a YAML editor. Works with Ollama (<code class="language-plaintext highlighter-rouge">http://localhost:11434/v1</code>), OpenAI-compatible services, etc.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>makefile

# `src/onechat/__init__.py`
```python
__all__ = ["main"]
__version__ = "0.1.0"

</code></pre></div></div>
<h1 id="srconechat__main__py"><code class="language-plaintext highlighter-rouge">src/onechat/__main__.py</code></h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python

from .main import main

if __name__ == "__main__":
    main()

</code></pre></div></div>
<h1 id="srconechatconfigdefaultsyaml"><code class="language-plaintext highlighter-rouge">src/onechat/config/defaults.yaml</code></h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yaml

app:
  data_dir: "~/.local/share/onechat"
  chat_dir_name: "chats"
  window:
    width: 1100
    height: 720

llm:
  # Multi-endpoint support
  endpoints:
    - name: "Local Ollama"
      api_base: "http://localhost:11434/v1"
      api_key: ""
      verify_tls: true
    - name: "OpenAI"
      api_base: "https://api.openai.com"
      api_key: ""
      verify_tls: true
  default_endpoint: "Local Ollama"

  # Default model params
  model: "llama3.1"
  temperature: 0.7
  top_p: 0.95
  max_tokens: 512
  timeout_sec: 120
  verify_tls: true

ui:
  font_family: ""
  font_size: 11
  enable_tray: true
  markdown_css: |
    body { font-family: sans-serif; font-size: 13px; }
    code, pre { font-family: "DejaVu Sans Mono", monospace; }
    pre { background: #f5f5f5; padding: 8px; border-radius: 6px; overflow: auto; }
    code { background: #f1f1f1; padding: 2px 4px; border-radius: 4px; }
    .msg-user { background: #e8f0fe; padding: 8px 10px; border-radius: 10px; margin: 10px 0; }
    .msg-assistant { background: #f7f7f7; padding: 8px 10px; border-radius: 10px; margin: 10px 0; }

</code></pre></div></div>
<h1 id="srconechatconfig_managerpy"><code class="language-plaintext highlighter-rouge">src/onechat/config_manager.py</code></h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python

import os
import copy
from pathlib import Path
import yaml
from importlib.resources import files

def deep_merge_dict(a: dict, b: dict) -&gt; dict:
    """Deep merge dict b into a (a has lower precedence). Returns a new dict."""
    result = copy.deepcopy(a)
    for k, v in b.items():
        if isinstance(v, dict) and isinstance(result.get(k), dict):
            result[k] = deep_merge_dict(result[k], v)
        else:
            result[k] = copy.deepcopy(v)
    return result

class ConfigManager:
    """
    Load admin defaults + user overrides, write only user overrides.

    Admin defaults search order:
      1) $ONECHAT_CONFIG_DIR/config.yaml
      2) /etc/onechat/config.yaml
      3) packaged defaults: onechat/config/defaults.yaml

    User overrides (writeable):
      ~/.config/onechat/config.yaml
    """
    def __init__(self):
        self.user_config_dir = Path(os.path.expanduser("~/.config/onechat"))
        self.user_config_path = self.user_config_dir / "config.yaml"
        self.defaults = {}
        self.user = {}
        self.effective = {}

    def _load_yaml_path(self, path: Path) -&gt; dict:
        if path.exists():
            with open(path, "r", encoding="utf-8") as f:
                return yaml.safe_load(f) or {}
        return {}

    def _load_packaged_defaults(self) -&gt; dict:
        try:
            p = files("onechat").joinpath("config/defaults.yaml")
            with p.open("r", encoding="utf-8") as f:
                return yaml.safe_load(f) or {}
        except Exception:
            return {}

    def load(self):
        env_dir = os.environ.get("ONECHAT_CONFIG_DIR")
        merged = {}
        if env_dir:
            merged = deep_merge_dict(merged, self._load_yaml_path(Path(env_dir) / "config.yaml"))
        merged = deep_merge_dict(merged, self._load_yaml_path(Path("/etc/onechat/config.yaml")))
        merged = deep_merge_dict(merged, self._load_packaged_defaults())

        self.defaults = merged
        self.user = self._load_yaml_path(self.user_config_path)
        self.effective = deep_merge_dict(self.defaults, self.user)
        return self.effective

    def save_user_overrides(self, patch: dict):
        """Persist only user overrides."""
        def _merge_in_place(dst: dict, src: dict):
            for k, v in src.items():
                if isinstance(v, dict) and isinstance(dst.get(k), dict):
                    _merge_in_place(dst[k], v)
                else:
                    dst[k] = copy.deepcopy(v)

        _merge_in_place(self.user, patch)
        self.user_config_dir.mkdir(parents=True, exist_ok=True)
        with open(self.user_config_path, "w", encoding="utf-8") as f:
            yaml.safe_dump(self.user, f, sort_keys=False)

    def get(self, path: str, default=None):
        """Get from effective using dotted path e.g. 'llm.model'."""
        parts = path.split(".")
        cur = self.effective
        for p in parts:
            if not isinstance(cur, dict):
                return default
            cur = cur.get(p, default)
        return cur

</code></pre></div></div>
<h1 id="srconechatstoragepy"><code class="language-plaintext highlighter-rouge">src/onechat/storage.py</code></h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python

import json
import time
from pathlib import Path
from dataclasses import dataclass, asdict
from typing import List, Dict, Any, Optional

@dataclass
class Message:
    role: str       # "user" or "assistant" or "system"
    content: str
    ts: float

@dataclass
class Chat:
    chat_id: str
    title: str
    created_ts: float
    updated_ts: float
    model: str
    params: Dict[str, Any]
    messages: List[Message]

class ChatStorage:
    """Manage chat files under ~/.local/share/onechat/chats/ as JSON."""

    def __init__(self, base_data_dir: Path, chat_dir_name: str = "chats"):
        self.base_dir = Path(base_data_dir).expanduser()
        self.chat_dir = self.base_dir / chat_dir_name
        self.chat_dir.mkdir(parents=True, exist_ok=True)

    def _chat_path(self, chat_id: str) -&gt; Path:
        return self.chat_dir / f"{chat_id}.json"

    def list_chats(self) -&gt; List[Chat]:
        chats = []
        for p in sorted(self.chat_dir.glob("*.json")):
            try:
                with open(p, "r", encoding="utf-8") as f:
                    raw = json.load(f)
                chats.append(self._chat_from_raw(raw))
            except Exception:
                continue
        chats.sort(key=lambda c: c.updated_ts, reverse=True)
        return chats

    def save_chat(self, chat: Chat):
        raw = asdict(chat)
        raw["messages"] = [asdict(m) for m in chat.messages]
        with open(self._chat_path(chat.chat_id), "w", encoding="utf-8") as f:
            json.dump(raw, f, ensure_ascii=False, indent=2)

    def load_chat(self, chat_id: str) -&gt; Optional[Chat]:
        p = self._chat_path(chat_id)
        if not p.exists():
            return None
        with open(p, "r", encoding="utf-8") as f:
            raw = json.load(f)
        return self._chat_from_raw(raw)

    def delete_chat(self, chat_id: str):
        p = self._chat_path(chat_id)
        if p.exists():
            p.unlink()

    def export_chat_markdown(self, chat: Chat, out_path: Path):
        lines = [f"# {chat.title}", ""]
        for m in chat.messages:
            who = "You" if m.role == "user" else "Assistant"
            lines.append(f"**{who}:**")
            lines.append("")
            lines.append(m.content)
            lines.append("")
        out_path = Path(out_path)
        out_path.parent.mkdir(parents=True, exist_ok=True)
        with open(out_path, "w", encoding="utf-8") as f:
            f.write("\n".join(lines))

    def _chat_from_raw(self, raw: Dict[str, Any]) -&gt; Chat:
        msgs = [Message(**m) for m in raw.get("messages", [])]
        return Chat(
            chat_id=raw["chat_id"],
            title=raw.get("title", "Untitled"),
            created_ts=raw.get("created_ts", time.time()),
            updated_ts=raw.get("updated_ts", time.time()),
            model=raw.get("model", ""),
            params=raw.get("params", {}),
            messages=msgs,
        )

</code></pre></div></div>
<h1 id="srconechatllm_clientpy"><code class="language-plaintext highlighter-rouge">src/onechat/llm_client.py</code></h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python

import json
import requests
from typing import List, Dict, Any

class LLMClient:
    """
    Minimal OpenAI-compatible client for /v1/chat/completions.
    Uses cfg['llm']['api_base'] and cfg['llm']['api_key'] at call time.
    """

    def __init__(self, cfg: dict):
        self.cfg = cfg

    def update_config(self, cfg: dict):
        self.cfg = cfg

    def chat_completion(self, messages: List[Dict[str, str]], params: Dict[str, Any]) -&gt; str:
        api_base = (self.cfg["llm"]["api_base"] or "").rstrip("/")
        url = f"{api_base}/v1/chat/completions"
        headers = {"Content-Type": "application/json"}
        api_key = self.cfg["llm"].get("api_key", "")
        if api_key:
            headers["Authorization"] = f"Bearer {api_key}"

        payload = {
            "model": params.get("model") or self.cfg["llm"]["model"],
            "messages": messages,
            "temperature": float(params.get("temperature", self.cfg["llm"]["temperature"])),
            "top_p": float(params.get("top_p", self.cfg["llm"]["top_p"])),
            "max_tokens": int(params.get("max_tokens", self.cfg["llm"]["max_tokens"])),
            "stream": False,
        }

        timeout = int(self.cfg["llm"].get("timeout_sec", 120))
        verify_tls = bool(self.cfg["llm"].get("verify_tls", True))

        r = requests.post(url, headers=headers, data=json.dumps(payload),
                          timeout=timeout, verify=verify_tls)
        r.raise_for_status()
        data = r.json()
        return data["choices"][0]["message"]["content"]

</code></pre></div></div>
<h1 id="srconechatui_helperspy"><code class="language-plaintext highlighter-rouge">src/onechat/ui_helpers.py</code></h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python

import time
from typing import List
from markdown import markdown

def now_ts() -&gt; float:
    return time.time()

def md_to_html(md_text: str) -&gt; str:
    """Convert Markdown to HTML fragment (no wrappers)."""
    return markdown(
        md_text,
        extensions=["fenced_code", "tables", "codehilite", "sane_lists"],
    )

def messages_to_html(messages: List[dict], css: str) -&gt; str:
    """Render the whole conversation into a single HTML document."""
    parts = [
        "&lt;html&gt;&lt;head&gt;&lt;meta charset='utf-8'&gt;",
        f"&lt;style&gt;{css}&lt;/style&gt;",
        "&lt;/head&gt;&lt;body&gt;",
    ]
    for m in messages:
        klass = "msg-user" if m["role"] == "user" else "msg-assistant"
        parts.append(f'&lt;div class="{klass}"&gt;')
        parts.append(md_to_html(m["content"]))
        parts.append("&lt;/div&gt;")
    parts.append("&lt;/body&gt;&lt;/html&gt;")
    return "\n".join(parts)

</code></pre></div></div>
<h1 id="srconechatmainpy"><code class="language-plaintext highlighter-rouge">src/onechat/main.py</code></h1>
<p>```
python</p>

<p>import sys
import uuid
import traceback
from pathlib import Path</p>

<p>import yaml</p>

<p>from PySide6.QtCore import Qt, QThreadPool, QRunnable, Signal, QObject, QSize
from PySide6.QtGui import QAction, QIcon, QKeySequence, QCloseEvent
from PySide6.QtWidgets import (
    QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, QTextEdit,
    QPushButton, QListWidget, QListWidgetItem, QLabel, QFileDialog, QSplitter,
    QFormLayout, QLineEdit, QSpinBox, QDoubleSpinBox, QDockWidget,
    QMessageBox, QTextBrowser, QToolBar, QSystemTrayIcon, QMenu,
    QInputDialog, QStyle, QPlainTextEdit, QDialog, QDialogButtonBox, QComboBox
)</p>

<p>from .config_manager import ConfigManager
from .storage import ChatStorage, Chat, Message
from .llm_client import LLMClient
from .ui_helpers import now_ts, messages_to_html</p>

<p>APP_NAME = "onechat"</p>

<h1 id="--worker-infra---1">—————- Worker infra —————-</h1>

<p>class WorkerSignals(QObject):
    success = Signal(str)
    error = Signal(str)</p>

<p>class LLMWorker(QRunnable):
    def <strong>init</strong>(self, client: LLMClient, messages_payload, params):
        super().<strong>init</strong>()
        self.client = client
        self.messages_payload = messages_payload
        self.params = params
        self.signals = WorkerSignals()</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def run(self):
    try:
        reply = self.client.chat_completion(self.messages_payload, self.params)
        self.signals.success.emit(reply)
    except Exception as e:
        tb = traceback.format_exc()
        self.signals.error.emit(f"{e}\n{tb}")
</code></pre></div></div>

<h1 id="--endpoints-dialog---1">—————- Endpoints dialog —————-</h1>

<p>class EndpointsDialog(QDialog):
    """Simple YAML editor for endpoints list."""
    def <strong>init</strong>(self, parent, endpoints: list):
        super().<strong>init</strong>(parent)
        self.setWindowTitle("Manage Endpoints")
        self.resize(600, 420)
        layout = QVBoxLayout(self)
        self.edit = QPlainTextEdit(self)
        self.edit.setPlainText(yaml.safe_dump(endpoints or [], sort_keys=False))
        layout.addWidget(QLabel("Edit YAML list of endpoints (name, api_base, api_key, verify_tls):"))
        layout.addWidget(self.edit)
        btns = QDialogButtonBox(QDialogButtonBox.Save | QDialogButtonBox.Cancel, parent=self)
        btns.accepted.connect(self.accept)
        btns.rejected.connect(self.reject)
        layout.addWidget(btns)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def get_endpoints(self):
    try:
        data = yaml.safe_load(self.edit.toPlainText()) or []
        assert isinstance(data, list)
        for ep in data:
            if not isinstance(ep, dict) or "name" not in ep or "api_base" not in ep:
                raise ValueError("Each endpoint must have 'name' and 'api_base'.")
        return data
    except Exception as e:
        QMessageBox.critical(self, "Invalid YAML", str(e))
        return None
</code></pre></div></div>

<h1 id="--main-window---1">—————- Main Window —————-</h1>

<p>class MainWindow(QMainWindow):
    def <strong>init</strong>(self):
        super().<strong>init</strong>()
        self.setWindowTitle("onechat")
        # Config
        self.cfg_mgr = ConfigManager()
        self.cfg = self.cfg_mgr.load()</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    # Storage
    data_dir = Path(self.cfg.get("app", {}).get("data_dir", "~/.local/share/onechat")).expanduser()
    chat_dir_name = self.cfg.get("app", {}).get("chat_dir_name", "chats")
    self.storage = ChatStorage(data_dir, chat_dir_name)

    # LLM client
    self.client = LLMClient(self.cfg)

    # State
    self.thread_pool = QThreadPool.globalInstance()
    self.current_chat: Chat | None = None
    self.markdown_css = self.cfg.get("ui", {}).get("markdown_css", "")
    self.endpoints_by_name = {}  # name -&gt; dict

    self._build_ui()
    self._refresh_endpoints()
    self._load_chat_list()
    self._apply_initial_window_size()
    self._setup_tray()

# -------- UI construction -------- #

def _build_ui(self):
    splitter = QSplitter()
    splitter.setChildrenCollapsible(False)

    # Left: chat list + controls
    left = QWidget()
    left_layout = QVBoxLayout(left)
    self.chat_list = QListWidget()
    left_layout.addWidget(QLabel("Conversations"))
    left_layout.addWidget(self.chat_list)

    btn_row = QHBoxLayout()
    self.btn_new = QPushButton("New")
    self.btn_rename = QPushButton("Rename")
    self.btn_delete = QPushButton("Delete")
    btn_row.addWidget(self.btn_new)
    btn_row.addWidget(self.btn_rename)
    btn_row.addWidget(self.btn_delete)
    left_layout.addLayout(btn_row)

    # Right: conversation + input
    right = QWidget()
    right_layout = QVBoxLayout(right)

    self.view = QTextBrowser()
    self.view.setOpenExternalLinks(True)
    right_layout.addWidget(self.view, 1)

    input_row = QHBoxLayout()
    self.input = QTextEdit()
    self.input.setPlaceholderText("Type your message… (Shift+Enter for newline, Ctrl+Enter to send)")
    self.input.setAcceptRichText(False)
    input_row.addWidget(self.input, 1)
    self.btn_send = QPushButton("Send")
    self.btn_send.setDefault(True)
    input_row.addWidget(self.btn_send)
    right_layout.addLayout(input_row)

    splitter.addWidget(left)
    splitter.addWidget(right)
    splitter.setStretchFactor(1, 3)
    self.setCentralWidget(splitter)

    # Dock: model params &amp; endpoint
    dock = QDockWidget("Model &amp; Endpoint", self)
    dock.setAllowedAreas(Qt.RightDockWidgetArea | Qt.LeftDockWidgetArea)
    params_widget = QWidget()
    form = QFormLayout(params_widget)

    # Endpoint picker
    ep_row = QHBoxLayout()
    self.cmb_endpoint = QComboBox()
    self.btn_manage_ep = QPushButton("Manage…")
    ep_row.addWidget(self.cmb_endpoint, 1)
    ep_row.addWidget(self.btn_manage_ep)
    form.addRow(QLabel("Endpoint"), ep_row)

    self.edt_api_base = QLineEdit(self.cfg.get("llm", {}).get("api_base", ""))
    self.edt_api_key = QLineEdit(self.cfg.get("llm", {}).get("api_key", ""))
    self.edt_api_key.setEchoMode(QLineEdit.Password)
    self.edt_model = QLineEdit(self.cfg.get("llm", {}).get("model", ""))

    self.spin_temp = QDoubleSpinBox()
    self.spin_temp.setRange(0.0, 2.0)
    self.spin_temp.setSingleStep(0.1)
    self.spin_temp.setValue(float(self.cfg.get("llm", {}).get("temperature", 0.7)))

    self.spin_top_p = QDoubleSpinBox()
    self.spin_top_p.setRange(0.0, 1.0)
    self.spin_top_p.setSingleStep(0.05)
    self.spin_top_p.setValue(float(self.cfg.get("llm", {}).get("top_p", 0.95)))

    self.spin_max_toks = QSpinBox()
    self.spin_max_toks.setRange(16, 32768)
    self.spin_max_toks.setValue(int(self.cfg.get("llm", {}).get("max_tokens", 512)))

    form.addRow(QLabel("API Base"), self.edt_api_base)
    form.addRow(QLabel("API Key"), self.edt_api_key)
    form.addRow(QLabel("Model"), self.edt_model)
    form.addRow(QLabel("Temperature"), self.spin_temp)
    form.addRow(QLabel("Top-p"), self.spin_top_p)
    form.addRow(QLabel("Max tokens"), self.spin_max_toks)

    btns = QHBoxLayout()
    self.btn_save_settings = QPushButton("Save as My Defaults")
    self.btn_apply = QPushButton("Apply Now")
    btns.addWidget(self.btn_apply)
    btns.addWidget(self.btn_save_settings)
    form.addRow(btns)

    params_widget.setLayout(form)
    dock.setWidget(params_widget)
    self.addDockWidget(Qt.RightDockWidgetArea, dock)

    # Toolbar &amp; actions
    tb = QToolBar("Main")
    tb.setIconSize(QSize(16, 16))
    self.addToolBar(tb)

    act_new = QAction("New Chat", self)
    act_new.setShortcut(QKeySequence("Ctrl+N"))
    act_send = QAction("Send", self)
    act_send.setShortcut(QKeySequence("Ctrl+Return"))
    act_export = QAction("Export Markdown…", self)
    act_export.setShortcut(QKeySequence("Ctrl+S"))
    act_delete = QAction("Delete Chat", self)
    act_delete.setShortcut(QKeySequence(Qt.Key_Delete))
    act_focus = QAction("Focus Input", self)
    act_focus.setShortcut(QKeySequence("Ctrl+L"))
    act_settings = QAction("Save Settings", self)
    act_settings.setShortcut(QKeySequence("Ctrl+,"))
    act_hide = QAction("Hide/Show", self)
    act_hide.setShortcut(QKeySequence("Ctrl+H"))

    for a in (act_new, act_send, act_export, act_delete, act_focus, act_settings, act_hide):
        tb.addAction(a)

    # Connect signals
    self.btn_new.clicked.connect(self._new_chat)
    self.btn_rename.clicked.connect(self._rename_chat)
    self.btn_delete.clicked.connect(self._delete_chat)
    self.chat_list.itemDoubleClicked.connect(lambda _: self._open_selected_chat())
    self.chat_list.itemSelectionChanged.connect(self._open_selected_chat)

    self.btn_send.clicked.connect(self._send)
    act_send.triggered.connect(self._send)
    act_new.triggered.connect(self._new_chat)
    act_export.triggered.connect(self._export_chat_md)
    act_delete.triggered.connect(self._delete_chat)
    act_focus.triggered.connect(lambda: self.input.setFocus())
    act_settings.triggered.connect(self._save_settings_clicked)
    act_hide.triggered.connect(self._toggle_hide)

    self.btn_apply.clicked.connect(self._apply_now)
    self.btn_save_settings.clicked.connect(self._save_settings_clicked)

    # Endpoint handlers
    self.cmb_endpoint.currentTextChanged.connect(self._on_endpoint_changed)
    self.btn_manage_ep.clicked.connect(self._manage_endpoints)

    self.statusBar().showMessage("Ready")

def _apply_initial_window_size(self):
    w = int(self.cfg.get("app", {}).get("window", {}).get("width", 1100))
    h = int(self.cfg.get("app", {}).get("window", {}).get("height", 720))
    self.resize(w, h)

def _setup_tray(self):
    if not self.cfg.get("ui", {}).get("enable_tray", True):
        return
    self.tray = QSystemTrayIcon(self)
    self.tray.setIcon(self.style().standardIcon(QStyle.SP_ComputerIcon))
    menu = QMenu()
    act_show = QAction("Show", self)
    act_quit = QAction("Quit", self)
    act_show.triggered.connect(self._show_from_tray)
    act_quit.triggered.connect(QApplication.instance().quit)
    menu.addAction(act_show)
    menu.addAction(act_quit)
    self.tray.setContextMenu(menu)
    self.tray.activated.connect(lambda reason: self._show_from_tray() if reason == QSystemTrayIcon.Trigger else None)
    self.tray.show()
    QApplication.instance().setQuitOnLastWindowClosed(False)

# -------- Endpoints helpers -------- #

def _refresh_endpoints(self):
    eps = self.cfg.get("llm", {}).get("endpoints", []) or []
    self.endpoints_by_name = {ep["name"]: ep for ep in eps if isinstance(ep, dict) and "name" in ep and "api_base" in ep}
    cur_name = self.cmb_endpoint.currentText() if hasattr(self, "cmb_endpoint") else None

    self.cmb_endpoint.blockSignals(True)
    self.cmb_endpoint.clear()
    for name in self.endpoints_by_name.keys():
        self.cmb_endpoint.addItem(name)
    self.cmb_endpoint.blockSignals(False)

    default_name = self.cfg.get("llm", {}).get("default_endpoint")
    to_select = cur_name or default_name or (next(iter(self.endpoints_by_name), ""))
    if to_select:
        self.cmb_endpoint.setCurrentText(to_select)
        self._on_endpoint_changed(to_select)

def _on_endpoint_changed(self, name: str):
    ep = self.endpoints_by_name.get(name, {})
    self.edt_api_base.setText(ep.get("api_base", self.edt_api_base.text()))
    self.edt_api_key.setText(ep.get("api_key", self.edt_api_key.text()))

def _manage_endpoints(self):
    dialog = EndpointsDialog(self, list(self.endpoints_by_name.values()))
    if dialog.exec() == QDialog.Accepted:
        new_eps = dialog.get_endpoints()
        if new_eps is None:
            return
        self.cfg_mgr.save_user_overrides({"llm": {"endpoints": new_eps}})
        self.cfg = self.cfg_mgr.load()
        self._refresh_endpoints()
        self.statusBar().showMessage("Endpoints saved")

# -------- Chat list ops -------- #

def _load_chat_list(self):
    self.chat_list.clear()
    for chat in self.storage.list_chats():
        item = QListWidgetItem(chat.title)
        item.setData(Qt.UserRole, chat.chat_id)
        self.chat_list.addItem(item)
    if self.chat_list.count() == 0:
        self._new_chat()
    else:
        self.chat_list.setCurrentRow(0)

def _new_chat(self):
    chat_id = uuid.uuid4().hex[:12]
    params = {
        "endpoint": self.cmb_endpoint.currentText() or self.cfg.get("llm", {}).get("default_endpoint", ""),
        "model": self.edt_model.text() or self.cfg.get("llm", {}).get("model", ""),
        "temperature": self.spin_temp.value(),
        "top_p": self.spin_top_p.value(),
        "max_tokens": self.spin_max_toks.value(),
    }
    chat = Chat(
        chat_id=chat_id,
        title="New Chat",
        created_ts=now_ts(),
        updated_ts=now_ts(),
        model=params["model"],
        params=params,
        messages=[]
    )
    self.storage.save_chat(chat)
    self._load_chat_list()
    for i in range(self.chat_list.count()):
        if self.chat_list.item(i).data(Qt.UserRole) == chat_id:
            self.chat_list.setCurrentRow(i)
            break

def _open_selected_chat(self):
    item = self.chat_list.currentItem()
    if not item:
        return
    chat_id = item.data(Qt.UserRole)
    chat = self.storage.load_chat(chat_id)
    if not chat:
        return
    self.current_chat = chat
    ep_name = self.current_chat.params.get("endpoint") or self.cfg.get("llm", {}).get("default_endpoint", "")
    if ep_name and self.cmb_endpoint.findText(ep_name) != -1:
        self.cmb_endpoint.setCurrentText(ep_name)
    self._render_chat()

def _rename_chat(self):
    item = self.chat_list.currentItem()
    if not item or not self.current_chat:
        return
    new_title, ok = QInputDialog.getText(self, "Rename", "Chat title:", text=self.current_chat.title)
    if ok and new_title.strip():
        self.current_chat.title = new_title.strip()
        self.current_chat.updated_ts = now_ts()
        self.storage.save_chat(self.current_chat)
        item.setText(self.current_chat.title)

def _delete_chat(self):
    item = self.chat_list.currentItem()
    if not item:
        return
    chat_id = item.data(Qt.UserRole)
    if QMessageBox.question(self, "Delete", "Delete this chat?") == QMessageBox.Yes:
        self.storage.delete_chat(chat_id)
        self._load_chat_list()

def _export_chat_md(self):
    if not self.current_chat:
        return
    out, _ = QFileDialog.getSaveFileName(self, "Export Markdown", f"{self.current_chat.title}.md", "Markdown (*.md)")
    if not out:
        return
    self.storage.export_chat_markdown(self.current_chat, Path(out))
    self.statusBar().showMessage("Exported")

# -------- Rendering -------- #

def _render_chat(self):
    if not self.current_chat:
        return
    p = self.current_chat.params
    self.edt_model.setText(str(p.get("model", "")))
    self.spin_temp.setValue(float(p.get("temperature", self.spin_temp.value())))
    self.spin_top_p.setValue(float(p.get("top_p", self.spin_top_p.value())))
    self.spin_max_toks.setValue(int(p.get("max_tokens", self.spin_max_toks.value())))

    msgs = [dict(role=m.role, content=m.content, ts=m.ts) for m in self.current_chat.messages]
    html = messages_to_html(msgs, self.markdown_css)
    self.view.setHtml(html)
    self.view.moveCursor(self.view.textCursor().End)

# -------- Sending -------- #

def _send(self):
    text = self.input.toPlainText().strip()
    if not text or not self.current_chat:
        return
    self.current_chat.messages.append(Message(role="user", content=text, ts=now_ts()))
    if self.current_chat.title == "New Chat" and text:
        self.current_chat.title = (text[:48] + "…") if len(text) &gt; 48 else text
        item = self.chat_list.currentItem()
        if item:
            item.setText(self.current_chat.title)

    self.current_chat.params["endpoint"] = self.cmb_endpoint.currentText()
    self.current_chat.updated_ts = now_ts()
    self.storage.save_chat(self.current_chat)
    self.input.clear()
    self._render_chat()
    self.statusBar().showMessage("Sending…")

    runtime_cfg = dict(self.cfg)
    runtime_cfg.setdefault("llm", {})
    runtime_cfg["llm"]["api_base"] = self.edt_api_base.text().strip() or runtime_cfg["llm"].get("api_base", "")
    runtime_cfg["llm"]["api_key"] = self.edt_api_key.text()
    self.client.update_config(runtime_cfg)

    params = {
        "model": self.edt_model.text().strip(),
        "temperature": self.spin_temp.value(),
        "top_p": self.spin_top_p.value(),
        "max_tokens": self.spin_max_toks.value(),
    }
    messages_payload = [{"role": m.role, "content": m.content} for m in self.current_chat.messages]

    worker = LLMWorker(self.client, messages_payload, params)
    worker.signals.success.connect(self._on_llm_success)
    worker.signals.error.connect(self._on_llm_error)
    self.thread_pool.start(worker)

def _on_llm_success(self, reply: str):
    if not self.current_chat:
        return
    self.current_chat.messages.append(Message(role="assistant", content=reply, ts=now_ts()))
    self.current_chat.updated_ts = now_ts()
    self.storage.save_chat(self.current_chat)
    self._render_chat()
    self.statusBar().showMessage("Reply received")

def _on_llm_error(self, err: str):
    QMessageBox.critical(self, "LLM Error", err)
    self.statusBar().showMessage("Error")

# -------- Settings -------- #

def _apply_now(self):
    if not self.current_chat:
        return
    self.current_chat.params.update({
        "endpoint": self.cmb_endpoint.currentText(),
        "model": self.edt_model.text().strip(),
        "temperature": self.spin_temp.value(),
        "top_p": self.spin_top_p.value(),
        "max_tokens": self.spin_max_toks.value(),
    })
    self.current_chat.model = self.current_chat.params["model"]
    self.storage.save_chat(self.current_chat)
    self.statusBar().showMessage("Applied to current chat")

def _save_settings_clicked(self):
    selected = self.cmb_endpoint.currentText()
    endpoints = self.cfg.get("llm", {}).get("endpoints", []) or []
    new_endpoints = []
    for ep in endpoints:
        if ep.get("name") == selected:
            ep = dict(ep)
            ep["api_base"] = self.edt_api_base.text().strip()
            ep["api_key"] = self.edt_api_key.text()
        new_endpoints.append(ep)

    patch = {
        "llm": {
            "endpoints": new_endpoints,
            "default_endpoint": selected or self.cfg.get("llm", {}).get("default_endpoint", ""),
            "model": self.edt_model.text().strip(),
            "temperature": float(self.spin_temp.value()),
            "top_p": float(self.spin_top_p.value()),
            "max_tokens": int(self.spin_max_toks.value()),
        }
    }
    self.cfg_mgr.save_user_overrides(patch)
    self.cfg = self.cfg_mgr.load()
    self._refresh_endpoints()
    self.client.update_config(self.cfg)
    self.statusBar().showMessage("Saved to ~/.config/onechat/config.yaml")

# -------- Tray / Hide -------- #

def _toggle_hide(self):
    if self.isVisible():
        self.hide()
    else:
        self.showNormal()
        self.raise_()
        self.activateWindow()

def _show_from_tray(self):
    self.showNormal()
    self.raise_()
    self.activateWindow()

def closeEvent(self, event: QCloseEvent):
    if getattr(self, "tray", None):
        event.ignore()
        self.hide()
        self.tray.showMessage("onechat", "Still running in the tray. Quit from tray menu.", QSystemTrayIcon.Information, 2000)
    else:
        super().closeEvent(event)
</code></pre></div></div>

<h1 id="--entry---1">—————- Entry —————-</h1>

<p>def main():
    app = QApplication(sys.argv)
    app.setApplicationDisplayName(APP_NAME)
    win = MainWindow()
    win.show()
    sys.exit(app.exec())</p>]]></content><author><name>hvppyarchive</name></author><category term="llm" /><summary type="html"><![CDATA[]]></summary></entry></feed>