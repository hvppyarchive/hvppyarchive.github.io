<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="https://hvppyarchive.github.io/feed.xml" rel="self" type="application/atom+xml" /><link href="https://hvppyarchive.github.io/" rel="alternate" type="text/html" /><updated>2025-08-21T19:10:49+09:00</updated><id>https://hvppyarchive.github.io/feed.xml</id><title type="html">ARCHIVE</title><subtitle>An amazing archive.</subtitle><author><name>hvppyarchive</name></author><entry><title type="html"></title><link href="https://hvppyarchive.github.io/2025-08-19-python-repr-vs-str/" rel="alternate" type="text/html" title="" /><published>2025-08-21T19:10:49+09:00</published><updated>2025-08-21T19:10:49+09:00</updated><id>https://hvppyarchive.github.io/2025-08-19-python-repr-vs-str</id><content type="html" xml:base="https://hvppyarchive.github.io/2025-08-19-python-repr-vs-str/"><![CDATA[<p class="chat--user">

Pythonì—ì„œ <code class="language-plaintext highlighter-rouge">__repr__</code> í•¨ìˆ˜ì™€ <code class="language-plaintext highlighter-rouge">__str__</code> í•¨ìˆ˜ì˜ ì°¨ì´ì 

</p>

<p>Pythonì—ì„œ <code class="language-plaintext highlighter-rouge">__repr__</code> ê³¼ <code class="language-plaintext highlighter-rouge">__str__</code> ì˜ ì°¨ì´ì ì€ <strong>ê°ì²´ë¥¼ ë¬¸ìì—´ë¡œ í‘œí˜„í•˜ëŠ” ëª©ì </strong> ì—ì„œ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ì°¨ì´ë¥¼ ë‹¨ê³„ì ìœ¼ë¡œ ì •ë¦¬í•´ë“œë¦´ê²Œìš”.</p>

<hr />

<h2 id="1-__repr__-ì˜-ëª©ì ">1. <code class="language-plaintext highlighter-rouge">__repr__</code> ì˜ ëª©ì </h2>

<ul>
  <li>
    <p><strong>ê°œë°œì ì¤‘ì‹¬</strong> : ê°ì²´ë¥¼ "ê°œë°œì"ê°€ ë³´ê³  ì´í•´í•  ìˆ˜ ìˆë„ë¡ í‘œí˜„í•©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p><strong>ì¬í˜„ ê°€ëŠ¥(reproducible)</strong> : ê°€ëŠ¥í•œ í•œ ê°ì²´ë¥¼ ë‹¤ì‹œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ì½”ë“œ í˜•íƒœë¡œ ë³´ì—¬ì£¼ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ë³´í†µ <code class="language-plaintext highlighter-rouge">eval(repr(obj)) == obj</code> ê°€ ì„±ë¦½í•˜ëŠ” í˜•íƒœë¥¼ ì§€í–¥í•©ë‹ˆë‹¤ (ê¼­ í•­ìƒ ê·¸ëŸ° ê±´ ì•„ë‹ˆì§€ë§Œ ê¶Œì¥).</p>
  </li>
  <li>
    <p>ë””ë²„ê¹…í•  ë•Œ ì£¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>
  </li>
</ul>

<p>ì˜ˆì‹œ:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Person(name=</span><span class="sh">'</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="sh">'</span><span class="s">, age=</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">age</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span>

<span class="n">p</span> <span class="o">=</span> <span class="nc">Person</span><span class="p">(</span><span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">repr</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>  <span class="c1"># Person(name='Alice', age=30)
</span></code></pre></div></div>

<hr />

<h2 id="2-__str__-ì˜-ëª©ì ">2. <code class="language-plaintext highlighter-rouge">__str__</code> ì˜ ëª©ì </h2>

<ul>
  <li>
    <p><strong>ì‚¬ìš©ì ì¤‘ì‹¬</strong> : ê°ì²´ë¥¼ "ì‚¬ìš©ì"ê°€ ë³´ê¸° ì¢‹ì€ ë¬¸ìì—´ë¡œ í‘œí˜„í•©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ì½ê¸° ì‰½ê³  ê¹”ë”í•˜ê²Œ ì¶œë ¥í•˜ëŠ” ë° ì´ˆì ì„ ë‘¡ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">print(obj)</code> ë¥¼ í˜¸ì¶œí–ˆì„ ë•Œ ë³´ì—¬ì§€ëŠ” ê°’ì´ <code class="language-plaintext highlighter-rouge">__str__</code> ì…ë‹ˆë‹¤.</p>
  </li>
</ul>

<p>ì˜ˆì‹œ:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">age</span><span class="si">}</span><span class="s"> years old)</span><span class="sh">"</span>

<span class="n">p</span> <span class="o">=</span> <span class="nc">Person</span><span class="p">(</span><span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>  <span class="c1"># Alice (30 years old)
</span></code></pre></div></div>

<hr />

<h2 id="3-__repr__-vs-__str__-ë¹„êµ">3. <code class="language-plaintext highlighter-rouge">__repr__</code> vs <code class="language-plaintext highlighter-rouge">__str__</code> ë¹„êµ</h2>

<table>
  <thead>
    <tr>
      <th>íŠ¹ì§•</th>
      <th><code class="language-plaintext highlighter-rouge">__repr__</code></th>
      <th><code class="language-plaintext highlighter-rouge">__str__</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ëª©ì </td>
      <td>ê°œë°œììš©, ë””ë²„ê¹…</td>
      <td>ì‚¬ìš©ììš©, ê°€ë…ì„±</td>
    </tr>
    <tr>
      <td>ì¶œë ¥ ëŒ€ìƒ</td>
      <td><code class="language-plaintext highlighter-rouge">repr(obj)</code>, ëŒ€í™”í˜• ì‰˜ì—ì„œ ê¸°ë³¸</td>
      <td><code class="language-plaintext highlighter-rouge">str(obj)</code>, <code class="language-plaintext highlighter-rouge">print(obj)</code></td>
    </tr>
    <tr>
      <td>í˜•ì‹</td>
      <td>ê°ì²´ ì¬í˜„ ê°€ëŠ¥í•˜ê±°ë‚˜ ìƒì„¸</td>
      <td>ì½ê¸° ì‰¬ìš´ ì„¤ëª… ìœ„ì£¼</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="4-êµ¬í˜„-ì‹œ-ì£¼ì˜ì‚¬í•­">4. êµ¬í˜„ ì‹œ ì£¼ì˜ì‚¬í•­</h2>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">__str__</code> ê°€ ì—†ìœ¼ë©´ <code class="language-plaintext highlighter-rouge">__repr__</code> ê°€ ëŒ€ì‹  ì‚¬ìš©</strong>ë©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ë”°ë¼ì„œ ìµœì†Œí•œ <code class="language-plaintext highlighter-rouge">__repr__</code> ì€ ì •ì˜í•´ ë‘ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</p>
  </li>
</ul>

<hr />

<p>ğŸ‘‰ ì •ë¦¬í•˜ë©´,</p>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">__repr__</code></strong> : â€œê°œë°œìê°€ ë””ë²„ê¹…í•  ë•Œâ€ ê°ì²´ì˜ ì •í™•í•œ í‘œí˜„.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">__str__</code></strong> : â€œì‚¬ìš©ìê°€ ì¶œë ¥ë¬¼ì„ ë³¼ ë•Œâ€ ë³´ê¸° ì¢‹ê²Œ í‘œí˜„.</p>
  </li>
</ul>

<hr />

<p>ì›í•˜ì‹œë©´ <code class="language-plaintext highlighter-rouge">__repr__</code> ì™€ <code class="language-plaintext highlighter-rouge">__str__</code> ë¥¼ ë™ì‹œì— êµ¬í˜„í–ˆì„ ë•Œ <code class="language-plaintext highlighter-rouge">print(obj)</code> ì™€ <code class="language-plaintext highlighter-rouge">obj</code> (ì‰˜ ì¶œë ¥) ì˜ ì°¨ì´ë¥¼ ì§ì ‘ ì‹¤í–‰í•´ ë³´ì—¬ë“œë¦´ ìˆ˜ë„ ìˆëŠ”ë°, ì˜ˆì œ ì½”ë“œ ì‹œì—°ì„ ì›í•˜ì‹œë‚˜ìš”?</p>]]></content><author><name>hvppyarchive</name></author></entry><entry><title type="html">Python TextBuffer êµ¬í˜„</title><link href="https://hvppyarchive.github.io/python/python-textbuffer/" rel="alternate" type="text/html" title="Python TextBuffer êµ¬í˜„" /><published>2025-08-21T19:10:46+09:00</published><updated>2025-08-21T19:10:46+09:00</updated><id>https://hvppyarchive.github.io/python/python-textbuffer</id><content type="html" xml:base="https://hvppyarchive.github.io/python/python-textbuffer/"><![CDATA[<p class="chat--user">

Developer: í˜„ì¬ Verilog íŒŒì¼ ì²˜ë¦¬ì™€ ê´€ë ¨ëœ ì—¬ëŸ¬ ì‘ì—…(ì˜ˆ: ê°„ë‹¨í•œ ì „ì²˜ë¦¬/í›„ì²˜ë¦¬ ë“±)ì„ ìˆ˜í–‰ ì¤‘ì…ë‹ˆë‹¤. Raw Verilog ì†ŒìŠ¤ ì½”ë“œë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ” íŒŒì´ì¬ í´ë˜ìŠ¤ ê°œë°œì„ ê²€í† í•˜ê³  ìˆìŠµë‹ˆë‹¤. Verilog ì†ŒìŠ¤ ì½”ë“œëŠ” ë¬¸ìì—´ í˜•íƒœë¡œ ë³´ê´€í•˜ê±°ë‚˜, ì¤„ ë‹¨ìœ„ë¡œ splití•˜ì—¬ List[str] íƒ€ì…(ì¤„ë°”ê¿ˆ ì—†ì´)ìœ¼ë¡œ ì €ì¥í•˜ê±°ë‚˜, splitlines(keepends=True)ë¥¼ ì‚¬ìš©í•´ ì¤„ë°”ê¿ˆì´ í¬í•¨ëœ ë¦¬ìŠ¤íŠ¸ë¡œ ë³´ê´€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ëŸ¬ ë°©ì‹ì´ í”„ë¡œì íŠ¸ ë‚´ì—ì„œ í˜¼ìš©ë˜ë©´ í˜¼ë€ì„ ì´ˆë˜í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë²”ìš©ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì¼ê´€ëœ êµ¬ì¡°ë¥¼ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ì— í†µì¼í•  ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤. Begin with a concise checklist (3-7 bullets) of what you will do; keep items conceptual, not implementation-level. After each significant code or class design decision, briefly validate if the chosen approach aligns with the project's consistency and extensibility goals, and self-correct if needed.

</p>

<p>hereâ€™s the game plan:</p>

<ul>
  <li>
    <p>Define one <strong>canonical, internal representation</strong> for Verilog source and convert to/from other views.</p>
  </li>
  <li>
    <p>Normalize and <strong>track newline style</strong> for faithful round-trips (LF/CRLF/mixed).</p>
  </li>
  <li>
    <p>Expose <strong>consistent views</strong> (<code class="language-plaintext highlighter-rouge">as_string()</code>, <code class="language-plaintext highlighter-rouge">as_lines(keepends=...)</code>) instead of multiple storage forms.</p>
  </li>
  <li>
    <p>Provide a small, <strong>extensible transform pipeline</strong> for pre/post-processing (with history).</p>
  </li>
  <li>
    <p>Make edits <strong>immutable by default</strong> (return a new instance) with an opt-in <code class="language-plaintext highlighter-rouge">in_place=True</code>.</p>
  </li>
  <li>
    <p>Add <strong>I/O helpers</strong> (<code class="language-plaintext highlighter-rouge">from_*</code>, <code class="language-plaintext highlighter-rouge">to_file</code>) with explicit encoding and deterministic newline policy.</p>
  </li>
</ul>

<hr />

<h2 id="key-design-decisions-with-quick-self-checks">Key design decisions (with quick self-checks)</h2>

<ol>
  <li>
    <p><strong>Canonical storage = one normalized<code class="language-plaintext highlighter-rouge">str</code> (<code class="language-plaintext highlighter-rouge">\n</code> line endings).</strong></p>

    <ul>
      <li>
        <p><em>Why:</em> single source of truth avoids drift between parallel representations; Python string ops are fast and familiar.</p>
      </li>
      <li>
        <p><em>Consistency/Extensibility check:</em> callers always interact with one invariant; adding new views later wonâ€™t change storage. âœ…</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Preserve original newline style as metadata (<code class="language-plaintext highlighter-rouge">'lf'|'crlf'|'mixed'</code>).</strong></p>

    <ul>
      <li>
        <p><em>Why:</em> we normalize internally but can emit exactly what the file used before, unless caller overrides.</p>
      </li>
      <li>
        <p><em>Check:</em> round-tripping is predictable across the project; future formatters can opt into a uniform style. âœ…</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Views, not storage:</strong> <code class="language-plaintext highlighter-rouge">as_string(newline=...)</code> and <code class="language-plaintext highlighter-rouge">as_lines(keepends=False|True, newline=...)</code>.</p>

    <ul>
      <li>
        <p><em>Why:</em> banishes ad-hoc lists/strings in the codebase; one class hands out consistent views.</p>
      </li>
      <li>
        <p><em>Check:</em> API encourages a single pattern everywhere; avoids mixing representations in state. âœ…</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Edits are immutable by default, with<code class="language-plaintext highlighter-rouge">in_place=True</code> for performance-critical paths.</strong></p>

    <ul>
      <li>
        <p><em>Why:</em> functional style reduces surprise; explicit mutability keeps hot paths fast.</p>
      </li>
      <li>
        <p><em>Check:</em> consistent with safety + speed; cache invalidation is centralized. âœ…</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Lazy, cached line splits (both with and without<code class="language-plaintext highlighter-rouge">keepends</code>).</strong></p>

    <ul>
      <li>
        <p><em>Why:</em> many tools need line access; caching avoids repeated <code class="language-plaintext highlighter-rouge">splitlines</code>.</p>
      </li>
      <li>
        <p><em>Check:</em> cache invalidated on any text change; future features (e.g., line index) can reuse it. âœ…</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Transform pipeline:<code class="language-plaintext highlighter-rouge">apply(transformer)</code> where a transformer is a callable <code class="language-plaintext highlighter-rouge">text -&gt; text</code>, plus history.</strong></p>

    <ul>
      <li>
        <p><em>Why:</em> flexible slot for â€œpre/post-processingâ€ like trimming, EOL fixing, simple macro munging, etc.</p>
      </li>
      <li>
        <p><em>Check:</em> keeps responsibilities modular; easy to add/remove steps; provenance is recorded. âœ…</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>I/O boundaries explicit:</strong> constructors for string/lines/file; <code class="language-plaintext highlighter-rouge">to_file(encoding, newline)</code>; no auto-detection magic.</p>

    <ul>
      <li>
        <p><em>Why:</em> explicit beats implicit; fewer surprises across platforms and CI.</p>
      </li>
      <li>
        <p><em>Check:</em> project-wide consistency; easy to thread encoding/newline policy from config. âœ…</p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="the-class">The class</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span> <span class="n">hashlib</span>
<span class="kn">import</span> <span class="n">time</span>

<span class="n">NewlineStyle</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">mixed</span><span class="sh">"</span><span class="p">]</span>
<span class="n">EmitNewline</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">TextTransformer</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">A simple, composable transformer: text -&gt; text.</span><span class="sh">"""</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="bp">...</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TransformRecord</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">before_sha1</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">after_sha1</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">VerilogSource</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Canonical container for Verilog source.

    Invariants:
      - Internal storage `_text` always uses LF (</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="s">) line endings.
      - `_newline_style` records the original newline style encountered on load.
      - All edit methods are immutable by default; pass in_place=True to mutate.
    </span><span class="sh">"""</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sh">"</span><span class="s">_text</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">_newline_style</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">_encoding</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">_source_path</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">_version</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">_cached_lines</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">_cached_lines_keepends</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">_history</span><span class="sh">"</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">newline_style</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NewlineStyle</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">source_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">_assume_normalized</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_assume_normalized</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">text</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">newline_style</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">norm</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_normalize_newlines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">prefer</span><span class="o">=</span><span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># internal LF
</span>            <span class="k">if</span> <span class="n">newline_style</span> <span class="ow">and</span> <span class="n">newline_style</span> <span class="o">!=</span> <span class="n">style</span><span class="p">:</span>
                <span class="c1"># honor explicit override only for "mixed" -&gt; "lf/crlf" upgrade
</span>                <span class="n">style</span> <span class="o">=</span> <span class="n">newline_style</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">norm</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span><span class="p">:</span> <span class="n">NewlineStyle</span> <span class="o">=</span> <span class="n">style</span>  <span class="c1"># how it *came in* (for round-trip)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">_encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_source_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">source_path</span> <span class="k">else</span> <span class="bp">None</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span>              <span class="c1"># keepends=False
</span>        <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span>     <span class="c1"># keepends=True
</span>        <span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TransformRecord</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># ---------- creation / I/O ----------
</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span>
        <span class="n">cls</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">source_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">cls</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">source_path</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_lines</span><span class="p">(</span>
        <span class="n">cls</span><span class="p">,</span>
        <span class="n">lines</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">source_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">keepends</span><span class="p">:</span>
            <span class="n">joined</span> <span class="o">=</span> <span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">joined</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">cls</span><span class="p">(</span><span class="n">joined</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">source_path</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span>
        <span class="n">cls</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="nf">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">cls</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_file</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">newline</span><span class="p">:</span> <span class="n">EmitNewline</span> <span class="o">=</span> <span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">ensure_trailing_newline</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_string</span><span class="p">(</span><span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">,</span> <span class="n">ensure_trailing_newline</span><span class="o">=</span><span class="n">ensure_trailing_newline</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="nf">write_text</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="n">_encoding</span><span class="p">)</span>

    <span class="c1"># ---------- core views ----------
</span>
    <span class="k">def</span> <span class="nf">as_string</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">newline</span><span class="p">:</span> <span class="n">EmitNewline</span> <span class="o">=</span> <span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">ensure_trailing_newline</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span>
        <span class="k">if</span> <span class="n">ensure_trailing_newline</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">s</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span>
        <span class="k">if</span> <span class="n">ensure_trailing_newline</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">s</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">newline</span> <span class="o">==</span> <span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">}[</span><span class="n">newline</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># "mixed" -&gt; default to CRLF for lines that originally were CRLF? We can't reconstruct mixed reliably.
</span>            <span class="c1"># project policy: emit LF for mixed unless caller overrides
</span>            <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">as_lines</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">keepends</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">list</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">list</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span><span class="p">)</span>

    <span class="c1"># ---------- inspection ----------
</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_path</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_source_path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">newline_style</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NewlineStyle</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">encoding</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_encoding</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_version</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">history</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TransformRecord</span><span class="p">,</span> <span class="p">...]:</span>
        <span class="k">return</span> <span class="nf">tuple</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">line_count</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_line</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">keepend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="n">keepend</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="c1"># ---------- transforms / edits ----------
</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">transformer</span><span class="p">:</span> <span class="n">TextTransformer</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
        <span class="n">record</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">before</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span>
        <span class="n">after</span> <span class="o">=</span> <span class="nf">transformer</span><span class="p">(</span><span class="n">before</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">after</span> <span class="ow">is</span> <span class="n">before</span><span class="p">:</span>
            <span class="c1"># even if identity, return self or bump version in-place
</span>            <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_bump_version</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">self</span>

        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_set_text</span><span class="p">(</span><span class="n">after</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_record</span><span class="p">(</span><span class="n">transformer</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="nc">VerilogSource</span><span class="p">(</span>
                <span class="n">after</span><span class="p">,</span>
                <span class="n">newline_style</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span><span class="p">,</span>
                <span class="n">encoding</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_encoding</span><span class="p">,</span>
                <span class="n">source_path</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_source_path</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
                <span class="n">inst</span><span class="p">.</span><span class="n">_history</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="nf">_mk_record</span><span class="p">(</span><span class="n">transformer</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">inst</span>

    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">old</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">new</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">class</span> <span class="nc">_Repl</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">replace</span><span class="sh">"</span>
            <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="nf">_Repl</span><span class="p">(),</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_line</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">keepend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
        <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># edit with keepends to keep layout
</span>        <span class="k">if</span> <span class="n">keepend</span><span class="p">:</span>
            <span class="c1"># caller provided EOL
</span>            <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># normalize to internal LF
</span>            <span class="n">eol</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span> <span class="k">else</span> <span class="sh">""</span>
            <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span> <span class="o">+</span> <span class="n">eol</span>
        <span class="n">new_text</span> <span class="o">=</span> <span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_with_text</span><span class="p">(</span><span class="n">new_text</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert_lines</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">new_lines</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
        <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">nl</span> <span class="o">=</span> <span class="p">[</span><span class="n">ln</span> <span class="k">if</span> <span class="n">keepends</span> <span class="nf">else </span><span class="p">(</span><span class="n">ln</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span> <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">new_lines</span><span class="p">]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_text</span> <span class="o">=</span> <span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">nl</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">:])</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_with_text</span><span class="p">(</span><span class="n">new_text</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_lines</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_text</span> <span class="o">=</span> <span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">end</span><span class="p">:])</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_with_text</span><span class="p">(</span><span class="n">new_text</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ensure_trailing_newline</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">self</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_with_text</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_text</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="c1"># ---------- internals ----------
</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_normalize_newlines</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">prefer</span><span class="p">:</span> <span class="n">NewlineStyle</span> <span class="o">=</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NewlineStyle</span><span class="p">]:</span>
        <span class="n">has_crlf</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">text</span>
        <span class="n">has_lf</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">text</span>
        <span class="k">if</span> <span class="n">has_crlf</span> <span class="ow">and</span> <span class="n">has_lf</span> <span class="ow">and</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span> <span class="o">!=</span> <span class="n">text</span><span class="p">:</span>
            <span class="n">style</span><span class="p">:</span> <span class="n">NewlineStyle</span> <span class="o">=</span> <span class="sh">"</span><span class="s">mixed</span><span class="sh">"</span>
        <span class="k">elif</span> <span class="n">has_crlf</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\r</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># coerce to LF
</span>        <span class="k">return</span> <span class="n">norm</span><span class="p">,</span> <span class="n">style</span>

    <span class="k">def</span> <span class="nf">_with_text</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_set_text</span><span class="p">(</span><span class="n">new_text</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">self</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="nc">VerilogSource</span><span class="p">(</span>
            <span class="n">new_text</span><span class="p">,</span>
            <span class="n">newline_style</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_encoding</span><span class="p">,</span>
            <span class="n">source_path</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_source_path</span><span class="p">,</span>
            <span class="n">_assume_normalized</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">inst</span><span class="p">.</span><span class="n">_history</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inst</span>

    <span class="k">def</span> <span class="nf">_set_text</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_text</span> <span class="o">=</span> <span class="n">new_text</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_invalidate_cache</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_bump_version</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_invalidate_cache</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_bump_version</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_version</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_mk_record</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">before</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">after</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransformRecord</span><span class="p">:</span>
        <span class="k">return</span> <span class="nc">TransformRecord</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">before_sha1</span><span class="o">=</span><span class="n">hashlib</span><span class="p">.</span><span class="nf">sha1</span><span class="p">(</span><span class="n">before</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)).</span><span class="nf">hexdigest</span><span class="p">(),</span>
            <span class="n">after_sha1</span><span class="o">=</span><span class="n">hashlib</span><span class="p">.</span><span class="nf">sha1</span><span class="p">(</span><span class="n">after</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)).</span><span class="nf">hexdigest</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_record</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">before</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">after</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">_mk_record</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">))</span>
</code></pre></div></div>

<p><strong>Validation:</strong> The class enforces one storage invariant (LF string), exposes consistent views, and gives predictable I/O. Itâ€™s easy to extend with more transforms or richer metadata later. This aligns with our consistency goal and makes future preprocessors trivial to add. âœ…</p>

<hr />

<h2 id="example-transformers-plug-and-play">Example transformers (plug-and-play)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TrimTrailingWhitespace</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">trim_trailing_ws</span><span class="sh">"</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># safe for Verilog; does not alter semantics
</span>        <span class="k">return</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="nf">rstrip</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="se">\t</span><span class="sh">"</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">EnsureFinalNewline</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">ensure_final_newline</span><span class="sh">"</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span> <span class="k">if</span> <span class="n">text</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span> <span class="nf">else </span><span class="p">(</span><span class="n">text</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Validation:</strong> Transformers are plain callables; team members can add steps without touching the core class. History records provenance. âœ…</p>

<hr />

<h2 id="typical-usage-uniform-across-the-project">Typical usage (uniform across the project)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load
</span><span class="n">src</span> <span class="o">=</span> <span class="n">VerilogSource</span><span class="p">.</span><span class="nf">from_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Get views (without changing internal storage form)
</span><span class="n">text</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="nf">as_string</span><span class="p">()</span>                            <span class="c1"># normalized LF by default (round-tripped on write)
</span><span class="n">lines</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">()</span>                            <span class="c1"># ['module top(', ...]
</span><span class="n">lines_ke</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>            <span class="c1"># ['module top(\n', ...]
</span>
<span class="c1"># Edits (immutable by default)
</span><span class="n">src2</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="nf">set_line</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sh">"</span><span class="s">// AUTOGEN: do not edit</span><span class="sh">"</span><span class="p">)</span>
<span class="n">src3</span> <span class="o">=</span> <span class="n">src2</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="nc">TrimTrailingWhitespace</span><span class="p">())</span>

<span class="c1"># Save with original newline style, enforcing final newline
</span><span class="n">src3</span><span class="p">.</span><span class="nf">to_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">,</span> <span class="n">ensure_trailing_newline</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Validation:</strong> This usage pattern prevents any accidental mixing of storage forms. Every operation goes through one API, keeping the project consistent. âœ…</p>

<hr />

<h2 id="why-this-will-hold-up-on-bigger-needs">Why this will hold up on bigger needs</h2>

<ul>
  <li>
    <p><strong>Round-trip safety:</strong> We track original newline style and encoding; callers can enforce a project-wide style by always passing <code class="language-plaintext highlighter-rouge">newline="lf"</code> if desired.</p>
  </li>
  <li>
    <p><strong>Performance:</strong> Internal <code class="language-plaintext highlighter-rouge">str</code>, lazy line cache, optional in-place edits.</p>
  </li>
  <li>
    <p><strong>Extensibility:</strong> Add richer transforms (comment stripping, lightweight <code class="language-plaintext highlighter-rouge">\</code>line continuation` merges, macro stubs) without changing the core.</p>
  </li>
  <li>
    <p><strong>Determinism:</strong> No auto encoding detection; configs drive output style.</p>
  </li>
</ul>

<hr />

<h3 id="optional-next-steps-if-you-want-them">Optional next steps (if you want them)</h3>

<ul>
  <li>
    <p>Add a <code class="language-plaintext highlighter-rouge">LineIndex</code> helper for O(1) char-offset â†” line/col mapping.</p>
  </li>
  <li>
    <p>Provide <code class="language-plaintext highlighter-rouge">diff(other)</code> to aid review bots.</p>
  </li>
  <li>
    <p>Introduce a config object (encoding/newline policy) to thread through I/O.</p>
  </li>
</ul>

<p>If you share any project constraints (e.g., must always emit LF, or enforce final newline), I can wire them into defaults so every team member gets the same behavior automatically.</p>

<p class="chat--user">

ë³´ë‹¤ë³´ë‹ˆ êµ³ì´ VerilogSourceì— í•œì •ë  í•„ìš”ëŠ” ì—†ëŠ”ê±° ê°™ì€ë° ë²”ìš©ì ì¸ ë°©ë²• ì¶”ì²œìˆì–´?

</p>

<p>ì•„ì£¼ ì¢‹ì•„ìš”â€”Verilog ì „ìš©ì´ ì•„ë‹ˆë¼ <strong>ì–¸ì–´ ë¬´ê´€(Text-agnostic)</strong> í•˜ê²Œ ì“°ë©´ íŒ€ ì „ì²´ì— ë” ê¹”ë”í•©ë‹ˆë‹¤. ì•„ë˜ì²˜ëŸ¼ ì¼ë°˜í™”í•˜ì£ .</p>

<h3 id="ì²´í¬ë¦¬ìŠ¤íŠ¸-ê°œë…-ìœ„ì£¼">ì²´í¬ë¦¬ìŠ¤íŠ¸ (ê°œë… ìœ„ì£¼)</h3>

<ul>
  <li>
    <p>í•˜ë‚˜ì˜ <strong>ë²”ìš© í…ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ</strong> ë¡œ í‘œì¤€í™”í•˜ê³ , ë‚´ë¶€ í‘œí˜„ì€ ë‹¨ì¼ ê·œì¹™(LF)ë¡œ ê³ ì •</p>
  </li>
  <li>
    <p><strong>í”„ë¡œí•„(ì–¸ì–´/í¬ë§· ë©”íƒ€ë°ì´í„°)</strong> ë ˆì´ì–´ë¡œ ì£¼ì„/í™•ì¥ì ë“±ë§Œ ë°”ê¿” ë¼ìš°ê¸°</p>
  </li>
  <li>
    <p><strong>ì¼ê´€ëœ ë·° API</strong>(ë¬¸ìì—´/ì¤„ ë¦¬ìŠ¤íŠ¸)ë§Œ ë…¸ì¶œ, ì €ì¥ í˜•ì‹ì€ 1ê°œ</p>
  </li>
  <li>
    <p><strong>ë³€í™˜ íŒŒì´í”„ë¼ì¸</strong>(transformer: <code class="language-plaintext highlighter-rouge">text -&gt; text</code>)ê³¼ ê¸°ë¡(íˆìŠ¤í† ë¦¬) ì œê³µ</p>
  </li>
  <li>
    <p><strong>ë¶ˆë³€ í¸ì§‘ ê¸°ë³¸ + ì„ íƒì  in-place</strong> , ìºì‹œ/ë²„ì „ ê´€ë¦¬</p>
  </li>
  <li>
    <p>ëª…ì‹œì  <strong>I/O ì •ì±…</strong>(ì¸ì½”ë”©/ê°œí–‰ ë°©ì¹¨)ê³¼ ë¼ìš´ë“œíŠ¸ë¦½ ë³´ì¥</p>
  </li>
</ul>

<hr />

<h2 id="ì„¤ê³„-ìŠ¤í…ê°-ìŠ¤í…ë§ˆë‹¤-ë¹ ë¥¸-ê²€ì¦-í¬í•¨">ì„¤ê³„ ìŠ¤í…(ê° ìŠ¤í…ë§ˆë‹¤ ë¹ ë¥¸ ê²€ì¦ í¬í•¨)</h2>

<ol>
  <li>
    <p><strong>ë²”ìš© ì»¨í…Œì´ë„ˆ =<code class="language-plaintext highlighter-rouge">TextBuffer</code> (ë‚´ë¶€ LF ë¬¸ìì—´ 1ê°œë§Œ ì €ì¥)</strong></p>

    <ul>
      <li>
        <p><em>ì´ìœ :</em> ìƒíƒœê°€ í•˜ë‚˜ë©´ í‘œí˜„ ë¶ˆì¼ì¹˜ê°€ ì‚¬ë¼ì§.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> í”„ë¡œì íŠ¸ ì¼ê´€ì„±(âœ…) / ë‹¤ë¥¸ ì–¸ì–´ë¡œ í™•ì¥ ì‰¬ì›€(âœ…).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ë©”íƒ€ë°ì´í„°/í”„ë¡œí•„(<code class="language-plaintext highlighter-rouge">TextProfile</code>) ë¶„ë¦¬</strong></p>

    <ul>
      <li>
        <p>ì´ë¦„, ëŒ€í‘œ í™•ì¥ì, ì£¼ì„ ë§ˆì»¤ ë“±ì€ â€œì„¤ëª…â€ì¼ ë¿, ë™ì‘ì€ ë™ì¼.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> í…ìŠ¤íŠ¸ ì½”ì–´ëŠ” ê°™ê³ , ì–¸ì–´ë³„ ê·œì¹™ì€ ì–¹ê¸°ë§Œ í•¨ â†’ í™•ì¥ì„±(âœ…).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ë·° API =<code class="language-plaintext highlighter-rouge">as_string(newline=...)</code>, <code class="language-plaintext highlighter-rouge">as_lines(keepends=...)</code></strong></p>

    <ul>
      <li>
        <p>ì €ì¥ì€ 1ì¢…, ë·°ë§Œ ì—¬ëŸ¬ í˜•íƒœë¡œ â€œë³´ì—¬ì£¼ê¸°â€.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> ì½”ë“œë² ì´ìŠ¤ì—ì„œ í˜¼ìš© ë°©ì§€(âœ…). ìƒˆ ë·° ì¶”ê°€ ì‹œ ë‚´ë¶€ëŠ” ê·¸ëŒ€ë¡œ(âœ…).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ê°œí–‰ ì •ì±…ê³¼ ë¼ìš´ë“œíŠ¸ë¦½</strong></p>

    <ul>
      <li>
        <p>ë¡œë“œ ì‹œ CRLF/í˜¼í•© ê°ì§€ â†’ ë‚´ë¶€ LFë¡œ ì •ê·œí™” + â€œì›ë˜ ìŠ¤íƒ€ì¼â€ ë©”íƒ€ ë³´ì¡´.</p>
      </li>
      <li>
        <p>ì €ì¥ ì‹œ <code class="language-plaintext highlighter-rouge">original|lf|crlf</code> ì„ íƒ, <code class="language-plaintext highlighter-rouge">ensure_trailing_newline</code> ì˜µì…˜ ì œê³µ.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> ì¬í˜„ì„±/ì˜ˆì¸¡ê°€ëŠ¥ì„±(âœ…). <em>í˜¼í•©</em> ì€ ì™„ì „ ë³µì› ë¶ˆê°€ â†’ ì •ì±…ìƒ LFë¡œ ë‚´ë³´ë‚´ê¸°(í•©ë¦¬ì  ì…€í”„ì½”ë ‰íŠ¸).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ë³€í™˜ íŒŒì´í”„ë¼ì¸ + ì—­ì‚¬(sha1)</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">apply(transformer)</code>ë¡œ ì¡°í•© ê°€ëŠ¥; ì´ë¦„/í•´ì‹œ ê¸°ë¡.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> ë‹¨ê³„ì  ì „/í›„ì²˜ë¦¬ì˜ í‘œì¤€ í†µë¡œ(âœ…). ì›ì¸ ì¶”ì  ìš©ì´(âœ…).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>í¸ì§‘ ëª¨ë¸: ë¶ˆë³€ ê¸°ë³¸ +<code class="language-plaintext highlighter-rouge">in_place=True</code></strong></p>

    <ul>
      <li>
        <p>ì•ˆì „í•œ ê¸°ë³¸ê°’, ê³ ì„±ëŠ¥ ê²½ë¡œ í•„ìš” ì‹œ ëª…ì‹œì  ì‚¬ìš©.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> ì•ˆì „/ì„±ëŠ¥ ê· í˜•(âœ…). ìºì‹œ ë¬´íš¨í™” í•œ ê³³ì—ì„œ ê´€ë¦¬(âœ…).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>I/O ê²½ê³„ëŠ” ëª…ì‹œì </strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">from_*</code>/<code class="language-plaintext highlighter-rouge">to_file(encoding,newline)</code>ì—ì„œë§Œ í™˜ê²½ ì˜í–¥ì„ ë°›ë„ë¡.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> CI/OS ì°¨ì´ ìµœì†Œí™”(âœ…).</p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="ë²”ìš©-êµ¬í˜„-ìŠ¤ì¼ˆë ˆí†¤-python">ë²”ìš© êµ¬í˜„ ìŠ¤ì¼ˆë ˆí†¤ (Python)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span> <span class="n">hashlib</span><span class="p">,</span> <span class="n">time</span>

<span class="c1"># ---- Profiles (ì–¸ì–´/í¬ë§· ì„¤ëª…ìš© ë©”íƒ€) ----
</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TextProfile</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">plain</span><span class="sh">"</span>
    <span class="n">file_exts</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="p">...]</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">line_comment_markers</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="p">...]</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">block_comment_markers</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="p">...]</span> <span class="o">=</span> <span class="p">()</span>

<span class="c1"># ì˜ˆì‹œ í”„ë¡œí•„
</span><span class="n">VERILOG</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">verilog</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">file_exts</span><span class="o">=</span><span class="p">(</span><span class="sh">"</span><span class="s">.v</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.sv</span><span class="sh">"</span><span class="p">),</span>
    <span class="n">line_comment_markers</span><span class="o">=</span><span class="p">(</span><span class="sh">"</span><span class="s">//</span><span class="sh">"</span><span class="p">,),</span>
    <span class="n">block_comment_markers</span><span class="o">=</span><span class="p">((</span><span class="sh">"</span><span class="s">/*</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">*/</span><span class="sh">"</span><span class="p">),),</span>
<span class="p">)</span>
<span class="n">PYTHON</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">python</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">file_exts</span><span class="o">=</span><span class="p">(</span><span class="sh">"</span><span class="s">.py</span><span class="sh">"</span><span class="p">,),</span>
    <span class="n">line_comment_markers</span><span class="o">=</span><span class="p">(</span><span class="sh">"</span><span class="s">#</span><span class="sh">"</span><span class="p">,),</span>
<span class="p">)</span>

<span class="n">NewlineStyle</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">mixed</span><span class="sh">"</span><span class="p">]</span>
<span class="n">EmitNewline</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">TextTransformer</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="bp">...</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TransformRecord</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">before_sha1</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">after_sha1</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TextBuffer</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    ë²”ìš© í…ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ(ì–¸ì–´-ë¬´ê´€).
    ë‚´ë¶€ ê·œì¹™:
      - _text ëŠ” í•­ìƒ LF(</span><span class="sh">'</span><span class="se">\\</span><span class="s">n</span><span class="sh">'</span><span class="s">)ë¡œ ì •ê·œí™”ëœ ë‹¨ì¼ ë¬¸ìì—´
      - ì›ë³¸ ê°œí–‰ ìŠ¤íƒ€ì¼/ì¸ì½”ë”©/ê²½ë¡œ/í”„ë¡œí•„ì„ ë©”íƒ€ë¡œ ë³´ê´€
      - ë¶ˆë³€ í¸ì§‘ ê¸°ë³¸, in_place=Trueë¡œ ëª…ì‹œì  ë³€ê²½ ê°€ëŠ¥
    </span><span class="sh">"""</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">_text</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">_newline_style</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">_encoding</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">_source_path</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">_profile</span><span class="sh">"</span><span class="p">,</span>
                 <span class="sh">"</span><span class="s">_version</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">_cached_lines</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">_cached_lines_keepends</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">_history</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(),</span>
        <span class="n">newline_style</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NewlineStyle</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">source_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">_assume_normalized</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_assume_normalized</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">text</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">newline_style</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">norm</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_normalize_newlines</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">norm</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span><span class="p">:</span> <span class="n">NewlineStyle</span> <span class="o">=</span> <span class="n">style</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_source_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">source_path</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="n">profile</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TransformRecord</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># ---------- constructors / I-O ----------
</span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(),</span>
                    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">cls</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">source_path</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_lines</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">lines</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                   <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(),</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
                   <span class="n">source_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">joined</span> <span class="o">=</span> <span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="k">if</span> <span class="n">keepends</span> <span class="k">else</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">cls</span><span class="p">(</span><span class="n">joined</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">source_path</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(),</span>
                  <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="nf">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">cls</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_file</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                <span class="n">newline</span><span class="p">:</span> <span class="n">EmitNewline</span> <span class="o">=</span> <span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">ensure_trailing_newline</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_string</span><span class="p">(</span><span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">,</span> <span class="n">ensure_trailing_newline</span><span class="o">=</span><span class="n">ensure_trailing_newline</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="nf">write_text</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="n">_encoding</span><span class="p">)</span>

    <span class="c1"># ---------- views ----------
</span>    <span class="k">def</span> <span class="nf">as_string</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">newline</span><span class="p">:</span> <span class="n">EmitNewline</span> <span class="o">=</span> <span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">,</span>
                  <span class="n">ensure_trailing_newline</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span>
        <span class="k">if</span> <span class="n">ensure_trailing_newline</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">s</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span>
        <span class="k">if</span> <span class="n">ensure_trailing_newline</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">s</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">style</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span> <span class="k">if</span> <span class="n">newline</span> <span class="o">==</span> <span class="sh">"</span><span class="s">original</span><span class="sh">"</span> <span class="k">else</span> <span class="p">{</span><span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">}[</span><span class="n">newline</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># mixedëŠ” ì •í™• ë³µì›ì´ ë¶ˆê°€ â†’ ì •ì±…ìƒ LFë¡œ ë‚´ë³´ëƒ„
</span>            <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">as_lines</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">keepends</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">list</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">list</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span><span class="p">)</span>

    <span class="c1"># ---------- inspection ----------
</span>    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TextProfile</span><span class="p">:</span> <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_profile</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_path</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span> <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_source_path</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">newline_style</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NewlineStyle</span><span class="p">:</span> <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">encoding</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_encoding</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_version</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">history</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TransformRecord</span><span class="p">,</span> <span class="p">...]:</span> <span class="k">return</span> <span class="nf">tuple</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">line_count</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="k">return</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_line</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">keepend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="n">keepend</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span>

    <span class="c1"># ---------- edits / transforms ----------
</span>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">transformer</span><span class="p">:</span> <span class="n">TextTransformer</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
              <span class="n">record</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">before</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span>
        <span class="n">after</span> <span class="o">=</span> <span class="nf">transformer</span><span class="p">(</span><span class="n">before</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">after</span> <span class="ow">is</span> <span class="n">before</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_bump_version</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">self</span>
        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_set_text</span><span class="p">(</span><span class="n">after</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">record</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_record</span><span class="p">(</span><span class="n">transformer</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="nc">TextBuffer</span><span class="p">(</span><span class="n">after</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_profile</span><span class="p">,</span> <span class="n">newline_style</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span><span class="p">,</span>
                              <span class="n">encoding</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_encoding</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_source_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">record</span><span class="p">:</span> <span class="n">inst</span><span class="p">.</span><span class="n">_history</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="nf">_mk_record</span><span class="p">(</span><span class="n">transformer</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">inst</span>

    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">old</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">class</span> <span class="nc">_Repl</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">replace</span><span class="sh">"</span>
            <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="k">return</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="nf">_Repl</span><span class="p">(),</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_line</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">keepend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                 <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">keepend</span><span class="p">:</span>
            <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">eol</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span> <span class="k">else</span> <span class="sh">""</span>
            <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span> <span class="o">+</span> <span class="n">eol</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_with_text</span><span class="p">(</span><span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert_lines</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">new_lines</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                     <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">nl</span> <span class="o">=</span> <span class="p">[</span><span class="n">ln</span> <span class="k">if</span> <span class="n">keepends</span> <span class="nf">else </span><span class="p">(</span><span class="n">ln</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span> <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">new_lines</span><span class="p">]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_with_text</span><span class="p">(</span><span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">nl</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">:]),</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_lines</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_with_text</span><span class="p">(</span><span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">end</span><span class="p">:]),</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ensure_trailing_newline</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">self</span> <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span> <span class="k">else</span> <span class="n">self</span><span class="p">.</span><span class="nf">_with_text</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_text</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="c1"># ---------- internals ----------
</span>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_normalize_newlines</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NewlineStyle</span><span class="p">]:</span>
        <span class="n">has_crlf</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">text</span>
        <span class="n">has_lf</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">text</span>
        <span class="k">if</span> <span class="n">has_crlf</span> <span class="ow">and</span> <span class="n">has_lf</span> <span class="ow">and</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span> <span class="o">!=</span> <span class="n">text</span><span class="p">:</span> <span class="n">style</span><span class="p">:</span> <span class="n">NewlineStyle</span> <span class="o">=</span> <span class="sh">"</span><span class="s">mixed</span><span class="sh">"</span>
        <span class="k">elif</span> <span class="n">has_crlf</span><span class="p">:</span> <span class="n">style</span> <span class="o">=</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">style</span> <span class="o">=</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span>
        <span class="k">return</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\r</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">),</span> <span class="n">style</span>

    <span class="k">def</span> <span class="nf">_with_text</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_set_text</span><span class="p">(</span><span class="n">new_text</span><span class="p">);</span> <span class="k">return</span> <span class="n">self</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="nc">TextBuffer</span><span class="p">(</span><span class="n">new_text</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_profile</span><span class="p">,</span> <span class="n">newline_style</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span><span class="p">,</span>
                          <span class="n">encoding</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_encoding</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_source_path</span><span class="p">,</span> <span class="n">_assume_normalized</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">inst</span><span class="p">.</span><span class="n">_history</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inst</span>

    <span class="k">def</span> <span class="nf">_set_text</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_text</span> <span class="o">=</span> <span class="n">new_text</span><span class="p">;</span> <span class="n">self</span><span class="p">.</span><span class="nf">_invalidate_cache</span><span class="p">();</span> <span class="n">self</span><span class="p">.</span><span class="nf">_bump_version</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_invalidate_cache</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span> <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_bump_version</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">_version</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_mk_record</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">before</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">after</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransformRecord</span><span class="p">:</span>
        <span class="k">return</span> <span class="nc">TransformRecord</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">before_sha1</span><span class="o">=</span><span class="n">hashlib</span><span class="p">.</span><span class="nf">sha1</span><span class="p">(</span><span class="n">before</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)).</span><span class="nf">hexdigest</span><span class="p">(),</span>
            <span class="n">after_sha1</span><span class="o">=</span><span class="n">hashlib</span><span class="p">.</span><span class="nf">sha1</span><span class="p">(</span><span class="n">after</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)).</span><span class="nf">hexdigest</span><span class="p">(),</span>
        <span class="p">)</span>
    <span class="k">def</span> <span class="nf">_record</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">before</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">after</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">_mk_record</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">))</span>
</code></pre></div></div>

<p><strong>ê²€ì¦ ìš”ì•½:</strong> ë‚´ë¶€ ì €ì¥ 1ì¢…(LF), ë·° API ê³ ì •, ë³€í™˜/í¸ì§‘/íˆìŠ¤í† ë¦¬ í‘œì¤€í™” â†’ <strong>ì¼ê´€ì„±</strong> ê³¼ <strong>í™•ì¥ì„±</strong> ëª©í‘œì— ë¶€í•©(âœ…). <em>í˜¼í•© ê°œí–‰ ë³µì› í•œê³„</em> ëŠ” ì •ì±…ìœ¼ë¡œ ëª…ì‹œí•˜ì—¬ íŒ€ í˜¼ì„ ì„ ì°¨ë‹¨(ì…€í”„ì½”ë ‰íŠ¸ ì™„ë£Œ).</p>

<hr />

<h2 id="ì‚¬ìš©-ì˜ˆ-ì–¸ì–´-ë¶ˆë¬¸">ì‚¬ìš© ì˜ˆ (ì–¸ì–´ ë¶ˆë¬¸)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Verilogë„ Pythonë„ ë™ì¼í•œ API
</span><span class="n">buf</span> <span class="o">=</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">from_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>

<span class="c1"># ì¼ê´€ëœ ë·°
</span><span class="n">text</span> <span class="o">=</span> <span class="n">buf</span><span class="p">.</span><span class="nf">as_string</span><span class="p">()</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">buf</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">()</span>
<span class="n">lines_ke</span> <span class="o">=</span> <span class="n">buf</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># ë¶ˆë³€ í¸ì§‘ + íŒŒì´í”„ë¼ì¸
</span><span class="k">class</span> <span class="nc">TrimTrailingWS</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">trim_trailing_ws</span><span class="sh">"</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="nf">rstrip</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="se">\t</span><span class="sh">"</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">())</span>

<span class="n">buf2</span> <span class="o">=</span> <span class="n">buf</span><span class="p">.</span><span class="nf">set_line</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sh">"</span><span class="s">// AUTOGEN: do not edit</span><span class="sh">"</span><span class="p">)</span>
<span class="n">buf3</span> <span class="o">=</span> <span class="n">buf2</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="nc">TrimTrailingWS</span><span class="p">())</span>
<span class="n">buf3</span><span class="p">.</span><span class="nf">to_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">,</span> <span class="n">ensure_trailing_newline</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="verilog-ì „ìš©-apiê°€-í•„ìš”í•˜ë©´">Verilog ì „ìš© APIê°€ í•„ìš”í•˜ë©´?</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">VerilogSource = TextBuffer</code>ì— <code class="language-plaintext highlighter-rouge">profile=VERILOG</code>ë§Œ ê¸°ë³¸ê°’ìœ¼ë¡œ ë˜í•‘(ë˜ëŠ” ì„œë¸Œí´ë˜ì‹±)í•˜ë©´ ë©ë‹ˆë‹¤. ì½”ë“œë² ì´ìŠ¤ëŠ” <strong>í•­ìƒ<code class="language-plaintext highlighter-rouge">TextBuffer</code> API</strong>ë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ í˜¼ìš©ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.</li>
</ul>

<hr />

<h2 id="ê¶Œì¥-ì •ì±…íŒ€-ê·œì¹™ìœ¼ë¡œ-ê³ ì •-ì¶”ì²œ">ê¶Œì¥ ì •ì±…(íŒ€ ê·œì¹™ìœ¼ë¡œ ê³ ì • ì¶”ì²œ)</h2>

<ul>
  <li>
    <p>ì €ì¥ ì‹œ ê¸°ë³¸ <code class="language-plaintext highlighter-rouge">newline="original"</code>(ë ˆê±°ì‹œ ìœ ì§€) â†’ ë¦¬í¬ë§· ë‹¨ê³„ì—ì„œ ì¼ê´„ <code class="language-plaintext highlighter-rouge">lf</code> ì „í™˜ ì„ íƒ ê°€ëŠ¥.</p>
  </li>
  <li>
    <p>ëª¨ë“  ë³€í™˜ì€ <strong>Transformer</strong> ë¡œë§Œ ìˆ˜í–‰(ì§ì ‘ ë¬¸ìì—´ ì¡°ì‘ ê¸ˆì§€).</p>
  </li>
  <li>
    <p>CIì— <code class="language-plaintext highlighter-rouge">ensure_trailing_newline=True</code> + <code class="language-plaintext highlighter-rouge">TrimTrailingWS</code> ì ìš©.</p>
  </li>
</ul>

<p>í•„ìš”í•˜ë©´ í† í°í™”ë‚˜ ë¼ì¸-ì˜¤í”„ì…‹ ë§¤í•‘, <code class="language-plaintext highlighter-rouge">diff(other)</code> ê°™ì€ ìœ í‹¸ì„ ì–¹ì„ ìˆ˜ ìˆê²Œ ì„¤ê³„í•´ ë‘ì—ˆìŠµë‹ˆë‹¤. ì›í•˜ëŠ” ê¸°ë³¸ í”„ë¡œí•„(Verilog/Lex/YAML ë“±) ëª©ë¡ì„ ì•Œë ¤ì£¼ì‹œë©´ í…œí”Œë¦¿ìœ¼ë¡œ í•¨ê»˜ ì¶”ê°€í•´ ë“œë¦´ê²Œìš”.</p>

<p class="chat--user">

ì´ëŸ° ì¼ì„ í•˜ëŠ” ìœ ëª…í•œ í´ë˜ìŠ¤ë‚˜ íŒŒì´ì¬ ë‚´ì¥ì€ ì—†ì–´?

</p>

<p>ë‹¤ìŒ ìˆœì„œë¡œ ìƒê°í•´ë³¼ê²Œìš” (ê°œë… ì²´í¬ë¦¬ìŠ¤íŠ¸):</p>

<ul>
  <li>
    <p>í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— â€œê·¸ ì¼ì„ ì „ë¶€â€ í•˜ëŠ” <strong>ë‹¨ì¼ í´ë˜ìŠ¤ëŠ” ì—†ë‹¤</strong> â†’ ì¡°í•©í•´ì„œ ì¨ì•¼ í•¨.</p>
  </li>
  <li>
    <p>ê°€ì¥ ê°€ê¹Œìš´ <strong>í‘œì¤€ ë„êµ¬ë“¤</strong> ì´ ë¬´ì—‡ì¸ì§€ íŒŒì•…í•˜ê³ , ë¬´ì—‡ì´ <strong>ë¶€ì¡±</strong> í•œì§€ ëª…í™•íˆ í•˜ê¸°.</p>
  </li>
  <li>
    <p>ë¶€ì¡±í•œ ë¶€ë¶„(ê°œí–‰ ì¶”ì Â·ì¼ê´€ëœ ë·°Â·ë³€í™˜ íŒŒì´í”„ë¼ì¸)ì€ <strong>ì–‡ì€ ë˜í¼</strong> ë¡œ ë³´ì™„.</p>
  </li>
  <li>
    <p>ìµœì†Œì£¼ì˜ ë²„ì „(í•¨ìˆ˜ 2â€“3ê°œ)ê³¼ í™•ì¥í˜•(í´ë˜ìŠ¤) ì¤‘ íŒ€ ì •ì±…ì— ë§ê²Œ ì„ íƒ.</p>
  </li>
</ul>

<hr />

<h2 id="ì§§ì€-ê²°ë¡ ">ì§§ì€ ê²°ë¡ </h2>

<ul>
  <li><strong>í‘œì¤€/ìœ ëª… ë‚´ì¥ì— â€œí…ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ + ê°œí–‰ ì •ì±… + ë³€í™˜/íˆìŠ¤í† ë¦¬â€ë¥¼ í•œ ë²ˆì— ì œê³µí•˜ëŠ” ê±´ ì—†ìŠµë‹ˆë‹¤.</strong><br />
ë”°ë¼ì„œ ì§€ê¸ˆê¹Œì§€ ì œì•ˆí•œ <code class="language-plaintext highlighter-rouge">TextBuffer</code> ê°™ì€ ì–‡ì€ ë˜í¼ê°€ <strong>ì¼ê´€ì„±</strong> ê³¼ <strong>ë¼ìš´ë“œíŠ¸ë¦½ ë³´ì¥</strong> ë©´ì—ì„œ ê°€ì¥ í˜„ì‹¤ì ì…ë‹ˆë‹¤.<br />
<em>ê²€ì¦:</em> íŒ€ ì „ì—­ ì¼ê´€ì„±ê³¼ í™•ì¥ì„± ëª©í‘œì— ë¶€í•©. âœ…</li>
</ul>

<hr />

<h2 id="ê°€ì¥-ê°€ê¹Œìš´-í‘œì¤€-ë„êµ¬ë“¤ë¬´ì—‡ì„-í•´ì£¼ê³ ëª»-í•´ì£¼ëŠ”ê°€">ê°€ì¥ ê°€ê¹Œìš´ í‘œì¤€ ë„êµ¬ë“¤(ë¬´ì—‡ì„ í•´ì£¼ê³ /ëª» í•´ì£¼ëŠ”ê°€)</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">io.StringIO</code><br />
ë©”ëª¨ë¦¬ íŒŒì¼ ê°ì²´. ì¤„ ë‹¨ìœ„ ì½ê¸°/ì“°ê¸° ì‰½ì§€ë§Œ <strong>ì›ë³¸ ê°œí–‰ ìŠ¤íƒ€ì¼ ì¶”ì  X</strong> , ë³€í™˜/íˆìŠ¤í† ë¦¬ X.<br />
<em>ê²€ì¦:</em> â€œì¼ê´€ëœ ë‚´ë¶€ í‘œí˜„â€ ìš”êµ¬ì— ë¯¸ë‹¬ â†’ ë˜í¼ í•„ìš”. âŒ</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">open(..., newline=...)</code> / <code class="language-plaintext highlighter-rouge">pathlib.Path.read_text()/write_text()</code><br />
í…ìŠ¤íŠ¸ ëª¨ë“œì—ì„œ <strong>ê°œí–‰ ë³€í™˜ì„ ì œì–´</strong>(ì“°ê¸° ì‹œ <code class="language-plaintext highlighter-rouge">newline='\n'</code> ê°•ì œ ë“±) ê°€ëŠ¥. í•˜ì§€ë§Œ <strong>ì½ì„ ë•Œ ì›ë³¸ì´ CRLF/í˜¼í•©ì´ì—ˆëŠ”ì§€</strong> ë¥¼ ë³´ì¡´í•˜ì§„ ì•ŠìŒ(ë³´í†µ <code class="language-plaintext highlighter-rouge">\n</code>ìœ¼ë¡œ í¡ìˆ˜).<br />
<em>ê²€ì¦:</em> ë¼ìš´ë“œíŠ¸ë¦½ìš© â€œì›ë˜ ê°œí–‰ ìŠ¤íƒ€ì¼â€ ë©”íƒ€ ë³´ì¡´ì´ ì—†ë‹¤ â†’ ë˜í¼ í•„ìš”. âŒ</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">fileinput</code><br />
ì—¬ëŸ¬ íŒŒì¼ì„ í•œ ì¤„ ìŠ¤íŠ¸ë¦¼ì²˜ëŸ¼ ìˆœíšŒ. <strong>ì»¨í…Œì´ë„ˆ ì•„ë‹˜</strong> , ìƒíƒœ/ë·°/íˆìŠ¤í† ë¦¬ X. âŒ</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">difflib</code><br />
ì°¨ì´ ê³„ì‚°Â·íŒ¨ì¹˜ ì¶œë ¥ì„ ë„ì™€ì¤Œ. <strong>ë³€í™˜ íŒŒì´í”„ë¼ì¸/ì €ì¥ì†Œ</strong> ëŠ” ì•„ë‹˜. ë³´ì¡° ë„êµ¬ë¡œëŠ” ìœ ìš©. ğŸ†—</p>
  </li>
  <li>
    <p>(<code class="language-plaintext highlighter-rouge">tokenize</code>, <code class="language-plaintext highlighter-rouge">ast</code>, <code class="language-plaintext highlighter-rouge">parso</code> ë“±)<br />
ì–¸ì–´ë³„ íŒŒì„œ/í† í¬ë‚˜ì´ì €. â€œêµ¬ë¬¸ ì¸ì§€ ë³€í™˜â€ì—ëŠ” ì¢‹ì§€ë§Œ <strong>ë²”ìš© í…ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ ì—­í• </strong> ì€ ì•„ë‹˜. ë³´ì¡°. ğŸ†—</p>
  </li>
</ul>

<blockquote>
  <p>ìš”ì•½: <strong>ì¡°ê°ë“¤ì€ ìˆì§€ë§Œ, â€œì¼ê´€ ì»¨í…Œì´ë„ˆ + ê°œí–‰ ì •ì±… + ë³€í™˜/íˆìŠ¤í† ë¦¬â€ ì¡°í•©ì€ ì§ì ‘ ì–‡ê²Œ ê°ì‹¸ì•¼</strong> í•©ë‹ˆë‹¤.</p>
</blockquote>

<hr />

<h2 id="ìµœì†Œì£¼ì˜-ëŒ€ì•ˆí´ë˜ìŠ¤-ì—†ì´-í•¨ìˆ˜-3ê°œë¡œ">ìµœì†Œì£¼ì˜ ëŒ€ì•ˆ(í´ë˜ìŠ¤ ì—†ì´ í•¨ìˆ˜ 3ê°œë¡œ)</h2>

<p>í´ë˜ìŠ¤ê°€ ë¶€ë‹´ì´ë©´, íŒ€ ê·œì¹™ì„ í•¨ìˆ˜ë¡œ ê³ ì •í•˜ì„¸ìš”.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="k">def</span> <span class="nf">detect_newline_style</span><span class="p">(</span><span class="n">raw</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>  <span class="c1"># "lf" | "crlf" | "mixed"
</span>    <span class="n">crlf</span> <span class="o">=</span> <span class="n">raw</span><span class="p">.</span><span class="nf">count</span><span class="p">(</span><span class="sa">b</span><span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">lf</span> <span class="o">=</span> <span class="n">raw</span><span class="p">.</span><span class="nf">count</span><span class="p">(</span><span class="sa">b</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">cr</span> <span class="o">=</span> <span class="n">raw</span><span class="p">.</span><span class="nf">count</span><span class="p">(</span><span class="sa">b</span><span class="sh">"</span><span class="se">\r</span><span class="sh">"</span><span class="p">)</span> <span class="o">-</span> <span class="n">crlf</span>
    <span class="nf">if </span><span class="p">(</span><span class="n">crlf</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lf</span> <span class="o">-</span> <span class="n">crlf</span><span class="p">))</span> <span class="ow">or</span> <span class="n">cr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># ì„œë¡œ ì„ì—¬ ìˆìœ¼ë©´ mixed
</span>        <span class="k">return</span> <span class="sh">"</span><span class="s">mixed</span><span class="sh">"</span>
    <span class="k">return</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span> <span class="k">if</span> <span class="n">crlf</span> <span class="k">else</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span>

<span class="k">def</span> <span class="nf">normalize_to_lf</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\r</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">emit_with_newline</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">s</span> <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span> <span class="k">else</span> <span class="n">s</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># mixedëŠ” ì •ì±…ìƒ lf ì·¨ê¸‰ ê¶Œì¥
</span></code></pre></div></div>

<p>ì‚¬ìš© íŒ¨í„´:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">raw</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">p</span><span class="p">).</span><span class="nf">read_bytes</span><span class="p">()</span>
<span class="n">style</span> <span class="o">=</span> <span class="nf">detect_newline_style</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>          <span class="c1"># ì›ë³¸ ìŠ¤íƒ€ì¼ ë©”íƒ€
</span><span class="n">text</span> <span class="o">=</span> <span class="nf">normalize_to_lf</span><span class="p">(</span><span class="n">raw</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">))</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">()</span>                  <span class="c1"># í•„ìš”í•œ ë·°
</span><span class="n">out</span> <span class="o">=</span> <span class="nf">emit_with_newline</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>       <span class="c1"># ì €ì¥ ì‹œ ë¼ìš´ë“œíŠ¸ë¦½
</span></code></pre></div></div>

<ul>
  <li><em>ê²€ì¦:</em> â€œë‹¨ì¼ ë‚´ë¶€ í‘œí˜„(LF ë¬¸ìì—´) + ì›ë³¸ ê°œí–‰ ë©”íƒ€ ë³´ì¡´â€ì„ ë§Œì¡±. ë³€í™˜ íŒŒì´í”„ë¼ì¸/íˆìŠ¤í† ë¦¬ëŠ” ì—¬ì „íˆ ì—†ìœ¼ë¯€ë¡œ, í•„ìš” ì‹œ í´ë˜ìŠ¤ë¡œ ìŠ¹ê²©. âœ…</li>
</ul>

<hr />

<h2 id="ì–¸ì œ-í‘œì¤€ë§Œìœ¼ë¡œ-ì¶©ë¶„í•˜ê³ -ì–¸ì œ-ë˜í¼ê°€-í•„ìš”í•œê°€">ì–¸ì œ í‘œì¤€ë§Œìœ¼ë¡œ ì¶©ë¶„í•˜ê³ , ì–¸ì œ ë˜í¼ê°€ í•„ìš”í•œê°€</h2>

<ul>
  <li>
    <p><strong>ì¶©ë¶„í•œ ê²½ìš°:</strong> ë‹¨ìˆœ ì½ê¸°/ì“°ê¸° + í¬ë§·í„°(ì˜ˆ: pre-commit í›…ìœ¼ë¡œ trailing space ì œê±°, EOF newline ê°•ì œ). ë³€í™˜ ê¸°ë¡/ë·° ì¼ê´€ì„±ì´ í¬ê²Œ ì¤‘ìš”ì¹˜ ì•Šì„ ë•Œ.</p>
  </li>
  <li>
    <p><strong>ë˜í¼ í•„ìš”:</strong></p>

    <ul>
      <li>
        <p>ë¼ìš´ë“œíŠ¸ë¦½ ì •í™•ë„(ì›ë³¸ ê°œí–‰ ì •ì±… ìœ ì§€)ê°€ ì¤‘ìš”</p>
      </li>
      <li>
        <p>ì½”ë“œë² ì´ìŠ¤ì—ì„œ â€œë¬¸ìì—´/lines í˜¼ìš©â€ì„ ê¸ˆì§€í•˜ê³  <strong>í•œ APIë¡œ í†µì¼</strong> í•˜ê³  ì‹¶ì„ ë•Œ</p>
      </li>
      <li>
        <p>ì „/í›„ì²˜ë¦¬ë¥¼ <strong>íŒŒì´í”„ë¼ì¸ + íˆìŠ¤í† ë¦¬</strong> ë¡œ ê´€ë¦¬í•˜ê³  ì‹¶ì„ ë•Œ</p>
      </li>
    </ul>
  </li>
</ul>

<p><em>ê²€ì¦:</em> ìš°ë¦¬ ìš”êµ¬ì‚¬í•­(ì¼ê´€ì„±Â·í™•ì¥ì„±Â·ë¼ìš´ë“œíŠ¸ë¦½) ê¸°ì¤€ìœ¼ë¡œëŠ” ë˜í¼ê°€ ë§ìŒ. âœ…</p>

<hr />

<h2 id="ì°¸ê³ ì„œë“œíŒŒí‹°-ì¡°í•©-ì•„ì´ë””ì–´">ì°¸ê³ (ì„œë“œíŒŒí‹° ì¡°í•© ì•„ì´ë””ì–´)</h2>

<ul>
  <li>
    <p><strong>pre-commit / pre-commit-hooks</strong> : <code class="language-plaintext highlighter-rouge">end-of-file-fixer</code>, <code class="language-plaintext highlighter-rouge">trailing-whitespace</code>, <code class="language-plaintext highlighter-rouge">mixed-line-ending</code> ë“±ìœ¼ë¡œ ì €ì¥ì†Œ ìˆ˜ì¤€ ìœ„ìƒ ê´€ë¦¬.<br />
<em>ì—­í•  ë³´ì™„:</em> íŒŒì´í”„ë¼ì¸ ì¼ë¶€ë¥¼ CIë¡œ ë°€ì–´ë‚´ ì¼ê´€ì„± ê°•í™”. âœ…</p>
  </li>
  <li>
    <p><strong>difflib / unidiff</strong> : ë³€í™˜ ê²°ê³¼ë¥¼ ë¦¬ë·°í•˜ê¸° ì‰¬ìš´ íŒ¨ì¹˜ë¡œ ì œì‹œ.<br />
<em>ì—­í•  ë³´ì™„:</em> íŒ€ ë¦¬ë·° ê²½í—˜ ê°œì„ . âœ…</p>
  </li>
</ul>

<hr />

<h3 id="ì •ë¦¬">ì •ë¦¬</h3>

<ul>
  <li>
    <p>â€œê·¸ ì¼ì„ ì „ë¶€ í•˜ëŠ”â€ ìœ ëª… ë‚´ì¥/í´ë˜ìŠ¤ëŠ” ì—†ìŒ.</p>
  </li>
  <li>
    <p>í‘œì¤€ ë„êµ¬(íŠ¹íˆ <code class="language-plaintext highlighter-rouge">open/newline</code>, <code class="language-plaintext highlighter-rouge">Path.write_text(newline=...)</code>)ëŠ” <strong>ì¶œë ¥ ì •ì±… ê°•ì œ</strong> ì—ëŠ” ì¶©ë¶„í•˜ë‚˜, <strong>ì›ë³¸ ê°œí–‰ ì¶”ì /ì¼ê´€ ë·°/íˆìŠ¤í† ë¦¬</strong> ëŠ” ì»¤ë²„í•˜ì§€ ëª»í•¨.</p>
  </li>
  <li>
    <p>íŒ€ ì°¨ì›ì˜ ì¼ê´€ì„±ê³¼ í™•ì¥ì„±ì„ ì›í•˜ë©´, ì§€ê¸ˆ ì„¤ê³„í•œ <strong>ì–‡ì€ ë²”ìš© ë˜í¼</strong>(ë˜ëŠ” ìœ„ì˜ <strong>í•¨ìˆ˜ 3ê°œ + ê·œì¹™</strong>)ê°€ ê°€ì¥ ì•ˆì „í•©ë‹ˆë‹¤.</p>
  </li>
</ul>

<p class="chat--user">

@classmethod def from_file(cls, path: Path | str, *, profile: TextProfile = TextProfile(), encoding: str = "utf-8") -&gt; "TextBuffer": p = Path(path) text = p.read_text(encoding=encoding) return cls(text, profile=profile, encoding=encoding, source_path=p) ì—¬ê¸° ì¤‘ê°„ì— ìˆëŠ” * ì€ ë­ì•¼? ì´ëŸ° ë¬¸ë²• ì²˜ìŒë´

</p>

<p>ì§§ê²Œ ì²´í¬ë¦¬ìŠ¤íŠ¸:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">*</code> ëŠ” <strong>í‚¤ì›Œë“œ ì „ìš©(Keyword-only) ì¸ì êµ¬ë¶„ì</strong> ì˜ˆìš”.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">*</code> ë’¤ì— ë‚˜ì˜¤ëŠ” íŒŒë¼ë¯¸í„°ëŠ” <strong>ë°˜ë“œì‹œ<code class="language-plaintext highlighter-rouge">name=value</code> í˜•íƒœë¡œ</strong> í˜¸ì¶œí•´ì•¼ í•´ìš”.</p>
  </li>
  <li>
    <p>ëª©ì : <strong>ê°€ë…ì„±â†‘</strong> , <strong>ì‹¤ìˆ˜ ë°©ì§€</strong>(ìˆœì„œ ì°©ê°), <strong>API í™•ì¥ì„±</strong>(ìƒˆ ì˜µì…˜ ì¶”ê°€í•´ë„ ì•ˆì „).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">*</code> ìì²´ëŠ” <code class="language-plaintext highlighter-rouge">*args</code>ì™€ ë‹¤ë¦…ë‹ˆë‹¤(ìˆ˜ì§‘ ì•„ë‹˜, <strong>êµ¬ë¶„ì</strong> ì¼ ë¿).</p>
  </li>
</ul>

<hr />

<h3 id="í•œ-ì¤„-ìš”ì•½">í•œ ì¤„ ìš”ì•½</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(),</span>
              <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
</code></pre></div></div>

<p>ì—¬ê¸° ê°€ìš´ë° <code class="language-plaintext highlighter-rouge">*</code> ë•Œë¬¸ì— <code class="language-plaintext highlighter-rouge">profile</code>ê³¼ <code class="language-plaintext highlighter-rouge">encoding</code>ì€ <strong>í‚¤ì›Œë“œë¡œë§Œ</strong> ë„˜ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>âœ… ì˜¬ë°”ë¥¸ í˜¸ì¶œ:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TextBuffer</span><span class="p">.</span><span class="nf">from_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># ê¸°ë³¸ê°’ ì‚¬ìš©
</span><span class="n">TextBuffer</span><span class="p">.</span><span class="nf">from_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>
<span class="n">TextBuffer</span><span class="p">.</span><span class="nf">from_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-16</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>âŒ ì˜ëª»ëœ í˜¸ì¶œ(ìˆœì„œë¡œ ë„˜ê¹€):
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TextBuffer</span><span class="p">.</span><span class="nf">from_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">,</span> <span class="n">VERILOG</span><span class="p">)</span>
<span class="c1"># TypeError: ... takes 2 positional arguments but 3 were given
</span></code></pre></div>    </div>
  </li>
</ul>

<hr />

<h3 id="ì™œ-ì“°ë‚˜ìš”-step-by-step-ì‚¬ê³ ">ì™œ ì“°ë‚˜ìš”? (step-by-step ì‚¬ê³ )</h3>

<ol>
  <li>
    <p><strong>ì˜ë¯¸ê°€ ë¶„ëª…í•´ì§‘ë‹ˆë‹¤.</strong><br />
<code class="language-plaintext highlighter-rouge">profile=VERILOG</code> ì²˜ëŸ¼ ì´ë¦„ì´ ë³´ì´ë‹ˆ, ì¸ì ì˜ë¯¸ë¥¼ í—·ê°ˆë¦´ ì¼ì´ ì¤„ì–´ìš”.<br />
â†’ í”„ë¡œì íŠ¸ <strong>ì¼ê´€ì„±</strong> ëª©í‘œì— ë¶€í•©. âœ…</p>
  </li>
  <li>
    <p><strong>íŒŒë¼ë¯¸í„° ìˆœì„œ ë³€ê²½ì— ê°•í•©ë‹ˆë‹¤.</strong><br />
ë‚˜ì¤‘ì— ì˜µì…˜ì„ ë” ì¶”ê°€í•´ë„ ê¸°ì¡´ í˜¸ì¶œë¶€ëŠ” <code class="language-plaintext highlighter-rouge">name=value</code>ë¼ <strong>ê¹¨ì§€ì§€ ì•ŠìŒ</strong>.<br />
â†’ API <strong>í™•ì¥ì„±</strong> ëª©í‘œì— ë¶€í•©. âœ…</p>
  </li>
  <li>
    <p><strong>ì‹¤ìˆ˜ ë°©ì§€.</strong><br />
<code class="language-plaintext highlighter-rouge">profile</code>ê³¼ <code class="language-plaintext highlighter-rouge">encoding</code>ì„ ìˆœì„œë¡œ ë°”ê¿” ë„£ëŠ” ì‹¤ìˆ˜ë¥¼ ì°¨ë‹¨. âœ…</p>
  </li>
</ol>

<hr />

<h3 id="-ì™€-args-ì˜-ì°¨ì´"><code class="language-plaintext highlighter-rouge">*</code> ì™€ <code class="language-plaintext highlighter-rouge">*args</code> ì˜ ì°¨ì´</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">*</code> (ë‹¨ë…): <strong>êµ¬ë¶„ì</strong>. ë’¤ì˜ ì¸ìë“¤ì„ <strong>í‚¤ì›Œë“œ ì „ìš©</strong> ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">*args</code>: ë‚¨ëŠ” ìœ„ì¹˜ ì¸ìë“¤ì„ <strong>íŠœí”Œë¡œ ìˆ˜ì§‘</strong> í•©ë‹ˆë‹¤. (ìˆ˜ì§‘ + êµ¬ë¶„ì ì—­í•  ëª¨ë‘)</p>
  </li>
</ul>

<p>ì˜ˆ:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>         <span class="c1"># b, cëŠ” í‚¤ì›Œë“œ-only
</span>    <span class="bp">...</span>

<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="c1"># aëŠ” ìœ„ì¹˜, argsëŠ” ì¶”ê°€ ìœ„ì¹˜ë“¤ ìˆ˜ì§‘, bëŠ” í‚¤ì›Œë“œ-only
</span>    <span class="bp">...</span>
</code></pre></div></div>

<hr />

<h3 id="ë³´ë„ˆìŠ¤--positional-only-ë„-ìˆì–´ìš”">ë³´ë„ˆìŠ¤: <code class="language-plaintext highlighter-rouge">/</code> (positional-only) ë„ ìˆì–´ìš”</h3>

<p>Python 3.8+ ë¶€í„°ëŠ” <code class="language-plaintext highlighter-rouge">/</code> ë¡œ <strong>ìœ„ì¹˜ ì „ìš©</strong> ì¸ìë¥¼ ê°•ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>  <span class="c1"># a: ìœ„ì¹˜-only, b: ë‘˜ ë‹¤ ê°€ëŠ¥, c: í‚¤ì›Œë“œ-only
</span>    <span class="bp">...</span>
</code></pre></div></div>

<hr />

<h3 id="íƒ€ì…-íŒíŠ¸-ê´€ë ¨">íƒ€ì… íŒíŠ¸ ê´€ë ¨</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Path | str</code> ëŠ” <strong>Python 3.10+</strong> ì˜ Union ì•½ì‹ ë¬¸ë²•ì…ë‹ˆë‹¤(ì´ì „ ë²„ì „ì€ <code class="language-plaintext highlighter-rouge">Union[Path, str]</code>).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">TextProfile()</code> ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë‘ë©´ <strong>ì •ì˜ ì‹œì ì—</strong> í•œ ë²ˆ ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.<br />
ì—¬ê¸°ì„œëŠ” <code class="language-plaintext highlighter-rouge">@dataclass(frozen=True)</code>ë¼ <strong>ë¶ˆë³€</strong> ì´ë¯€ë¡œ ì•ˆì „í•˜ì§€ë§Œ,<br />
ì¼ë°˜ì ìœ¼ë¡œëŠ” <code class="language-plaintext highlighter-rouge">None</code> ê¸°ë³¸ê°’ + í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ìƒì„±í•˜ëŠ” íŒ¨í„´ë„ ê³ ë ¤í•˜ì„¸ìš”.</p>
  </li>
</ul>

<hr />

<p>í•„ìš”í•˜ë©´, íŒ€ ê·œì¹™ìœ¼ë¡œ â€œì˜µì…˜ ì¸ìëŠ” ëª¨ë‘ <code class="language-plaintext highlighter-rouge">*</code> ë’¤ì— ë°°ì¹˜â€ë¥¼ ì •í•´ë‘ë©´ í˜¸ì¶œë¶€ê°€ í•­ìƒ <code class="language-plaintext highlighter-rouge">name=value</code>ë¼ ê¹”ë”í•˜ê³ , ì¥ê¸° ìœ ì§€ë³´ìˆ˜ì— ìœ ë¦¬í•©ë‹ˆë‹¤.</p>

<p class="chat--user">

__slots__ëŠ” ë­ì•¼?

</p>

<p>ì§§ì€ ì²´í¬ë¦¬ìŠ¤íŠ¸(ê°œë…):</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">__slots__</code>ëŠ” <strong>ì¸ìŠ¤í„´ìŠ¤ê°€ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ì†ì„± ì´ë¦„ë“¤ì„ ê³ ì •</strong> í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ë‹¤.</p>
  </li>
  <li>
    <p>íš¨ê³¼: <strong>ë©”ëª¨ë¦¬ ì ˆê°</strong> , <strong>ì†ì„± ì ‘ê·¼ ì†Œí­ ë¹ ë¦„</strong> , <strong>ì˜¤íƒ€/ì„ì˜ ì†ì„± ì¶”ê°€ ë°©ì§€</strong>.</p>
  </li>
  <li>
    <p>ì„ ì–¸: <code class="language-plaintext highlighter-rouge">class C: __slots__ = ('a', 'b')</code> ì²˜ëŸ¼ <strong>íŠœí”Œ/ë¦¬ìŠ¤íŠ¸/ì´í„°ëŸ¬ë¸”</strong> ì— ì´ë¦„ì„ ë‚˜ì—´.</p>
  </li>
  <li>
    <p>ì£¼ì˜: <strong>ë™ì  ì†ì„± ì¶”ê°€ ë¶ˆê°€</strong> , ìƒì†/ë””í´íŠ¸/<code class="language-plaintext highlighter-rouge">__dict__</code>/<code class="language-plaintext highlighter-rouge">__weakref__</code> ì²˜ë¦¬ì— ì‹ ê²½.</p>
  </li>
  <li>
    <p>ê¶Œì¥ ì‚¬ìš©: <strong>ì¸ìŠ¤í„´ìŠ¤ê°€ ì•„ì£¼ ë§ê³  í•„ë“œ ìŠ¤í‚¤ë§ˆê°€ ê³ ì •</strong> ëœ í´ë˜ìŠ¤.</p>
  </li>
</ul>

<hr />

<h1 id="í•œ-ì¤„-ì •ì˜">í•œ ì¤„ ì •ì˜</h1>

<p><code class="language-plaintext highlighter-rouge">__slots__</code>ë¥¼ ì •ì˜í•˜ë©´ í•´ë‹¹ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ëŠ” <strong>per-instance<code class="language-plaintext highlighter-rouge">__dict__</code>ë¥¼ ë§Œë“¤ì§€ ì•Šê³ </strong>, ë¯¸ë¦¬ ì •í•´ë‘” ìŠ¬ë¡¯(ê³ ì • í•„ë“œ)ë§Œ ë©”ëª¨ë¦¬ì— <strong>compact</strong> í•˜ê²Œ ì €ì¥í•œë‹¤.</p>

<hr />

<h2 id="ì™œ-ì“°ë‚˜-step-by-step">ì™œ ì“°ë‚˜ (step-by-step)</h2>

<ol>
  <li>
    <p><strong>ë©”ëª¨ë¦¬ ì ˆê°</strong> : <code class="language-plaintext highlighter-rouge">__dict__</code>(í•´ì‹œë§µ) ëŒ€ì‹  <strong>ìŠ¬ë¡¯ ë°°ì—´</strong> ì„ ì¨ì„œ ì¸ìŠ¤í„´ìŠ¤ë‹¹ ìˆ˜ì‹­ ë°”ì´íŠ¸~ìˆ˜ë°± ë°”ì´íŠ¸ë¥¼ ì•„ë‚€ë‹¤(í•„ë“œ ìˆ˜/íŒŒì´ì¬ êµ¬í˜„ì— ë”°ë¼ ìƒì´). ëŒ€ëŸ‰ ê°ì²´(ì˜ˆ: ìˆ˜ì‹­ë§Œ ê°œ)ì—ì„œ í° ì°¨ì´.</p>
  </li>
  <li>
    <p><strong>ì†ì„± ì ‘ê·¼ ë¹„ìš© ê°ì†Œ</strong> : í•´ì‹œ ì¡°íšŒê°€ ì•„ë‹Œ <strong>ì˜¤í”„ì…‹ ì ‘ê·¼</strong> ì´ë¼ ì•½ê°„ ë¹ ë¥´ë‹¤(ë¯¸ì„¸í•˜ì§€ë§Œ ëˆ„ì ë˜ë©´ ì˜ë¯¸).</p>
  </li>
  <li>
    <p><strong>API ì•ˆì „ì„±</strong> : ì„ ì–¸ë˜ì§€ ì•Šì€ ì†ì„±ì€ ì„¤ì • ìì²´ê°€ ì—ëŸ¬ â†’ <strong>ì˜¤íƒ€/ì„ì˜ í•„ë“œ</strong> ë°©ì§€.</p>
  </li>
</ol>

<hr />

<h2 id="ì–´ë–»ê²Œ-ì“°ë‚˜">ì–´ë–»ê²Œ ì“°ë‚˜</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">next</span><span class="sh">'</span><span class="p">)</span>  <span class="c1"># ì¸ìŠ¤í„´ìŠ¤ í•„ë“œ ìŠ¤í‚¤ë§ˆ ê³ ì •
</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">next</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>   <span class="c1"># OK
</span>        <span class="n">self</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="nb">next</span>     <span class="c1"># OK
</span>
<span class="n">n</span> <span class="o">=</span> <span class="nc">Node</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">n</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span>      <span class="c1"># OK
</span><span class="n">n</span><span class="p">.</span><span class="n">other</span> <span class="o">=</span> <span class="mi">3</span>      <span class="c1"># AttributeError: 'Node' object has no attribute 'other'
</span></code></pre></div></div>

<ul>
  <li>
    <p><strong>ë””í´íŠ¸ê°’</strong> ì€ ë³´í†µ <code class="language-plaintext highlighter-rouge">__init__</code>ì—ì„œ ì±„ìš´ë‹¤.</p>
  </li>
  <li>
    <p>í´ë˜ìŠ¤ ì†ì„±ìœ¼ë¡œ ê¸°ë³¸ê°’ì„ ì£¼ê³  ì‹¶ë‹¤ë©´:</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ì˜ ì´ˆê¸° ì½ê¸°ëŠ” 10ìœ¼ë¡œ ë³´ì´ì§€ë§Œ,
</span>            <span class="c1"># ì¸ìŠ¤í„´ìŠ¤ì— aë¥¼ ì„¤ì •í•˜ë©´ ì¸ìŠ¤í„´ìŠ¤ ìŠ¬ë¡¯ ê°’ì´ ìš°ì„ í•œë‹¤.
</span></code></pre></div>    </div>
  </li>
</ul>

<hr />

<h2 id="ìì£¼-ë¶€ë”ªíˆëŠ”-í¬ì¸íŠ¸-ê¼­-ì•Œì•„ë‘˜-ê²ƒ">ìì£¼ ë¶€ë”ªíˆëŠ” í¬ì¸íŠ¸ (ê¼­ ì•Œì•„ë‘˜ ê²ƒ)</h2>

<h3 id="1-__dict__--__weakref__ê°€-í•„ìš”í•˜ë©´">1) <code class="language-plaintext highlighter-rouge">__dict__</code> / <code class="language-plaintext highlighter-rouge">__weakref__</code>ê°€ í•„ìš”í•˜ë©´?</h3>

<ul>
  <li>
    <p>ê¸°ë³¸ì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">__slots__</code> í´ë˜ìŠ¤ì—ëŠ” <strong>ì¸ìŠ¤í„´ìŠ¤<code class="language-plaintext highlighter-rouge">__dict__</code>ê°€ ì—†ë‹¤</strong>.</p>
  </li>
  <li><strong>ì˜ˆì™¸ì ìœ¼ë¡œ</strong> ë™ì  ì†ì„±ì„ í—ˆìš©í•˜ê³  ì‹¶ë‹¤ë©´ ìŠ¬ë¡¯ì— <code class="language-plaintext highlighter-rouge">"__dict__"</code>ë¥¼ ëª…ì‹œ:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">__dict__</span><span class="sh">'</span><span class="p">)</span>  <span class="c1"># ìŠ¬ë¡¯ + ë™ì  ì†ì„± í—ˆìš©
</span></code></pre></div>    </div>
  </li>
  <li><code class="language-plaintext highlighter-rouge">weakref</code>ë¥¼ ì“°ë ¤ë©´ <code class="language-plaintext highlighter-rouge">"__weakref__"</code>ë„ í¬í•¨:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">__weakref__</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="2-ìƒì†">2) ìƒì†</h3>

<ul>
  <li>
    <p><strong>ìŠ¬ë¡¯ í´ë˜ìŠ¤ì˜ ì„œë¸Œí´ë˜ìŠ¤</strong> ê°€ <code class="language-plaintext highlighter-rouge">__slots__</code>ë¥¼ ì •ì˜í•˜ì§€ ì•Šìœ¼ë©´, ì„œë¸Œí´ë˜ìŠ¤ëŠ” <strong>ë‹¤ì‹œ<code class="language-plaintext highlighter-rouge">__dict__</code>ê°€ ìƒê¸´ë‹¤</strong>(ë™ì  ì†ì„± ê°€ëŠ¥).<br />
â†’ ê³„ì† ì œí•œí•˜ê³  ì‹¶ë‹¤ë©´ <strong>ì„œë¸Œí´ë˜ìŠ¤ì—ì„œë„<code class="language-plaintext highlighter-rouge">__slots__</code>ë¥¼ ì •ì˜</strong>í•´ì•¼ í•œë‹¤.</p>
  </li>
  <li>
    <p>ì„œë¸Œí´ë˜ìŠ¤ì—ì„œ <strong>ë¶€ëª¨ ìŠ¬ë¡¯ ì´ë¦„ì„ ë‹¤ì‹œ ì ì§€ ì•ŠëŠ”ë‹¤</strong>. ìƒˆë¡œ ì¶”ê°€í•˜ëŠ” ìŠ¬ë¡¯ë§Œ ë‚˜ì—´:</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,)</span>
    
<span class="k">class</span> <span class="nc">Child</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">,)</span>  <span class="c1"># 'a'ëŠ” ì´ë¯¸ Baseì— ìˆìœ¼ë¯€ë¡œ ì¤‘ë³µ ê¸°ì¬ X
</span></code></pre></div>    </div>
  </li>
</ul>

<h3 id="3-ë‹¤ì¤‘-ìƒì†">3) ë‹¤ì¤‘ ìƒì†</h3>

<ul>
  <li>
    <p>ë‹¤ì¤‘ ìƒì†ì—ì„œ <strong>ìŠ¬ë¡¯ì´ ì„œë¡œ ì¶©ëŒ</strong> í•˜ë©´ ì—ëŸ¬ê°€ ë‚  ìˆ˜ ìˆë‹¤.</p>
  </li>
  <li>
    <p>ì‹¤ë¬´ íŒ: ë‹¤ì¤‘ ìƒì†ì„ ìµœì†Œí™”í•˜ê±°ë‚˜, <strong>í•œìª½ë§Œ ìŠ¬ë¡¯</strong> ì„ ì“°ê³  ë‹¤ë¥¸ ìª½ì€ ë°ì´í„° ì—†ëŠ” ë¯¹ìŠ¤ì¸ìœ¼ë¡œ ì„¤ê³„.</p>
  </li>
</ul>

<h3 id="4-dataclassì™€ì˜-ê²°í•©">4) dataclassì™€ì˜ ê²°í•©</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">@dataclass(slots=True)</code>(Py3.10+)ë¥¼ ì“°ë©´ <strong>ìë™ìœ¼ë¡œ<code class="language-plaintext highlighter-rouge">__slots__</code>ê°€ ìƒì„±</strong>ëœë‹¤.</p>
  </li>
  <li>
    <p>ì´ë¯¸ ìˆ˜ë™ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">__slots__</code>ë¥¼ ì •ì˜í–ˆë‹¤ë©´, <code class="language-plaintext highlighter-rouge">slots=True</code>ë¥¼ <strong>ì¤‘ë³µìœ¼ë¡œ ì“°ì§€ ì•ŠëŠ”ë‹¤</strong>(ì¶©ëŒ/ì¤‘ë³µ ì •ì˜ ì£¼ì˜).</p>
  </li>
</ul>

<h3 id="5-pickle--ì§ë ¬í™”">5) pickle / ì§ë ¬í™”</h3>

<ul>
  <li>
    <p>ë§ì€ ê²½ìš° <strong>ì˜ ì‘ë™</strong> í•˜ì§€ë§Œ, ì–´ë–¤ í”„ë ˆì„ì›Œí¬ëŠ” <code class="language-plaintext highlighter-rouge">__dict__</code>ë¥¼ ê¸°ëŒ€í•œë‹¤.</p>
  </li>
  <li>
    <p>ì»¤ìŠ¤í…€ ì§ë ¬í™” í•„ìš”í•˜ë©´ <code class="language-plaintext highlighter-rouge">__getstate__/__setstate__</code>ë¥¼ êµ¬í˜„í•´ <strong>ìŠ¬ë¡¯ ê°’ë“¤ì„ ë”•íŠ¸ë¡œ ë³€í™˜</strong> í•˜ëŠ” ë°©ì‹ ì‚¬ìš©.</p>
  </li>
</ul>

<h3 id="6-í”„ë¡œíŒŒì¼ë§ë””ë²„ê¹…-ë„êµ¬">6) í”„ë¡œíŒŒì¼ë§/ë””ë²„ê¹… ë„êµ¬</h3>

<ul>
  <li>
    <p>ì¼ë¶€ ë„êµ¬ê°€ <code class="language-plaintext highlighter-rouge">obj.__dict__</code>ë¥¼ ë°”ë¡œ í¼ì¹˜ë ¤ë‹¤ ë‹¹í™©í•  ìˆ˜ ìˆë‹¤.</p>
  </li>
  <li>
    <p>ì´ëŸ° ë„êµ¬ë¥¼ ì“°ë©´ <code class="language-plaintext highlighter-rouge">"__dict__"</code> ìŠ¬ë¡¯ì„ ì¶”ê°€í•˜ê±°ë‚˜, ë³´ì¡° ë©”ì„œë“œ(ì˜ˆ: <code class="language-plaintext highlighter-rouge">to_dict()</code>) ì œê³µ.</p>
  </li>
</ul>

<hr />

<h2 id="ì–¸ì œ-ì“°ë©´-ì¢‹ì€ê°€--í”¼í•´ì•¼-í•˜ëŠ”ê°€">ì–¸ì œ ì“°ë©´ ì¢‹ì€ê°€ / í”¼í•´ì•¼ í•˜ëŠ”ê°€</h2>

<p><strong>ì í•©</strong></p>

<ul>
  <li>
    <p>ì¸ìŠ¤í„´ìŠ¤ê°€ <strong>ì—„ì²­ ë§ë‹¤</strong> (e.g., íŒŒì„œ í† í°, AST ë…¸ë“œ, ë¡œê·¸ ë ˆì½”ë“œ ë“±).</p>
  </li>
  <li>
    <p>ì†ì„± ìŠ¤í‚¤ë§ˆê°€ <strong>ë³€í•˜ì§€ ì•ŠëŠ”ë‹¤</strong>.</p>
  </li>
  <li>
    <p>ë¼ì´ë¸ŒëŸ¬ë¦¬/ì½”ì–´ ë ˆì´ì–´ì—ì„œ <strong>API ì•ˆì •ì„±</strong> ê³¼ <strong>ë©”ëª¨ë¦¬ íš¨ìœ¨</strong> ì´ ì¤‘ìš”í•˜ë‹¤.</p>
  </li>
</ul>

<p><strong>ë¶€ì í•©</strong></p>

<ul>
  <li>
    <p>ë™ì ìœ¼ë¡œ ì†ì„±ì„ ë¶™ì˜€ë‹¤ ë—ë‹¤ í•´ì•¼ í•œë‹¤.</p>
  </li>
  <li>
    <p>ë””ë²„ê¹…/ê´€ì°° ë„êµ¬ê°€ <code class="language-plaintext highlighter-rouge">__dict__</code>ì— ê°•í•˜ê²Œ ì˜ì¡´í•œë‹¤.</p>
  </li>
  <li>
    <p>ë‹¤ì¤‘ ìƒì† êµ¬ì¡°ê°€ ë³µì¡í•˜ë‹¤(ì¶©ëŒ ìœ„í—˜).</p>
  </li>
</ul>

<hr />

<h2 id="ì—¬ëŸ¬ë¶„-ì½”ë“œë² ì´ìŠ¤-ê´€ì ë¹ ë¥¸-ì…€í”„-ì²´í¬">ì—¬ëŸ¬ë¶„ ì½”ë“œë² ì´ìŠ¤ ê´€ì (ë¹ ë¥¸ ì…€í”„ ì²´í¬)</h2>

<ul>
  <li>
    <p>í…ìŠ¤íŠ¸ ë²„í¼/ì†ŒìŠ¤ ì»¨í…Œì´ë„ˆì²˜ëŸ¼ <strong>í•„ë“œê°€ ê³ ì •</strong> ë˜ê³ , <strong>ë§ì€ ì¸ìŠ¤í„´ìŠ¤</strong> ë¥¼ ë§Œë“¤ ê°€ëŠ¥ì„±ì´ ìˆë‹¤ë©´ <code class="language-plaintext highlighter-rouge">__slots__</code>ëŠ” <strong>ì¼ê´€ì„±/ì„±ëŠ¥</strong> ëª©í‘œì— ë¶€í•©í•©ë‹ˆë‹¤. âœ…</p>
  </li>
  <li>
    <p>ë‹¨, ë³€í™˜ íŒŒì´í”„ë¼ì¸/ë©”íƒ€ í™•ì¥ì´ ì¦ê³  <strong>ë™ì  í•„ë“œ ì¶”ê°€ ê°€ëŠ¥ì„±</strong> ì´ ìˆë‹¤ë©´, <code class="language-plaintext highlighter-rouge">__slots__</code> ëŒ€ì‹  ì¼ë°˜ í´ë˜ìŠ¤(ë˜ëŠ” <code class="language-plaintext highlighter-rouge">__slots__</code>ì— <code class="language-plaintext highlighter-rouge">"__dict__"</code> í¬í•¨)ë¡œ <strong>ìœ ì—°ì„±</strong> ì„ ë‚¨ê¸°ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤. âœ…</p>
  </li>
</ul>

<hr />

<h2 id="ë¯¸ë‹ˆ-ì˜ˆì‹œ-dataclass--slots">ë¯¸ë‹ˆ ì˜ˆì‹œ: dataclass + slots</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">slots</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># Py3.10+
</span><span class="k">class</span> <span class="nc">Token</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">col</span><span class="p">:</span> <span class="nb">int</span>
</code></pre></div></div>

<ul>
  <li>ë©”ëª¨ë¦¬ ì ˆê° + ì˜¤íƒ€ ë°©ì§€ + ëª…í™•í•œ ìŠ¤í‚¤ë§ˆë¥¼ í•œ ë²ˆì— í™•ë³´.</li>
</ul>

<p>í•„ìš”í•˜ë©´, í˜„ì¬ ì„¤ê³„í•œ <code class="language-plaintext highlighter-rouge">TextBuffer</code>/<code class="language-plaintext highlighter-rouge">VerilogSource</code>ì— <code class="language-plaintext highlighter-rouge">__slots__</code>ë¥¼ ì ìš©í•  ë•Œì˜ <strong>í•„ë“œ ëª©ë¡/ìƒì† ì „ëµ</strong> ì„ ë°”ë¡œ ì œì•ˆí•´ ë“œë¦´ê²Œìš”.</p>

<p class="chat--user">

ê·¸ëƒ¥ íƒ€ì… íŒë³„í•´ì„œ ìë™ìœ¼ë¡œ ë§Œë“¤ê²Œ í•˜ëŠ” ë°©ì‹ ì–´ë•Œ from_lines, from_string, from_textbuffer êµ¬ë³„í•˜ê¸°ê°€ ì¢€ ê·€ì°®ì€ë°, isinstance ê°™ì€ê±¸ë¡œ ë¹„êµí•´ì„œ ìë™ìœ¼ë¡œ ë§Œë“¤ê²Œ í•˜ëŠ”ê±°ì§€(from_fileì€ ë³„ê°œë¡œ), ê¸°ì¡´ í•¨ìˆ˜ë„ ë‘ê³  

</p>

<p>ì¢‹ì•„ìš”â€”â€œíƒ€ì…ì— ë”°ë¼ ìë™ ìƒì„±â€ì„ ë„£ëŠ” ê±´ í¸ì˜ì„±ì— ê½¤ ìœ ìš©í•©ë‹ˆë‹¤. ë‹¤ë§Œ <strong>ì˜ˆì¸¡ ê°€ëŠ¥ì„±</strong> ì„ í•´ì¹˜ì§€ ì•Šë„ë¡ ê·œì¹™ì„ ëª…í™•íˆ ë‘ë©´ ì¢‹ì•„ìš”.</p>

<h3 id="ì²´í¬ë¦¬ìŠ¤íŠ¸ê°œë…">ì²´í¬ë¦¬ìŠ¤íŠ¸(ê°œë…)</h3>

<ul>
  <li>
    <p>ë‹¨ì¼ ì§„ì…ì  <code class="language-plaintext highlighter-rouge">coerce(...)</code>ë¡œ <strong>ë¬¸ìì—´/ì¤„ ë¦¬ìŠ¤íŠ¸/TextBuffer</strong> ë¥¼ ì•Œì•„ì„œ ìˆ˜ìš©</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">from_*</code>ë“¤ì€ <strong>ê·¸ëŒ€ë¡œ ìœ ì§€</strong>(ëª…ì‹œì  ê²½ë¡œê°€ í•„ìš”í•œ ê³³ì—ì„œ ì‚¬ìš©)</p>
  </li>
  <li>
    <p><strong>ëª¨í˜¸ì„± ê·œì¹™</strong> ê³ ì •: <code class="language-plaintext highlighter-rouge">keepends</code> ê¸°ë³¸ ë™ì‘ê³¼ íŒë³„ ê¸°ì¤€ì„ ë¬¸ì„œí™”</p>
  </li>
  <li>
    <p>ì œ3ì íƒ€ì…ì€ <strong>í”„ë¡œí† ì½œ/ì–´ëŒ‘í„°</strong> ë¡œ í™•ì¥ ê°€ëŠ¥í•˜ê²Œ ì„¤ê³„</p>
  </li>
  <li>
    <p>ì˜ëª»ëœ íƒ€ì…ì€ <strong>ëª…í™•í•œ ì˜¤ë¥˜</strong> ë¡œ ê±°ì ˆ</p>
  </li>
</ul>

<hr />

<h2 id="ì„¤ê³„-ê²°ë¡ --ë¹ ë¥¸-ê²€ì¦">ì„¤ê³„ ê²°ë¡  &amp; ë¹ ë¥¸ ê²€ì¦</h2>

<ol>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">TextBuffer.coerce(obj, ...)</code> ì¶”ê°€</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">TextBuffer</code> â†’ ê·¸ëŒ€ë¡œ ë°˜í™˜</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">str</code> â†’ <code class="language-plaintext highlighter-rouge">from_string</code></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">list/tuple/Iterable[str]</code> â†’ <code class="language-plaintext highlighter-rouge">from_lines</code> (í•„ìš” ì‹œ materialize)</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> í˜¸ì¶œë¶€ ë‹¨ìˆœí™”(âœ…), ê¸°ì¡´ ëª…ì‹œ APIì™€ ê³µì¡´(âœ…).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">keepends</code> ê¸°ë³¸ ì •ì±…</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">keepends=None</code>(ê¸°ë³¸): <strong>í•œ ì¤„ì´ë¼ë„<code class="language-plaintext highlighter-rouge">\n</code>/<code class="language-plaintext highlighter-rouge">\r</code>ê°€ í¬í•¨ë˜ë©´</strong> <code class="language-plaintext highlighter-rouge">keepends=True</code>ë¡œ ê°„ì£¼, ì•„ë‹ˆë©´ <code class="language-plaintext highlighter-rouge">False</code>.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">keepends</code>ë¥¼ ëª…ì‹œí•˜ë©´ ê·¸ ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> íœ´ë¦¬ìŠ¤í‹± ìµœì†Œí™” + ê²°ì •ì (âœ…). ê³¼ë„í•œ â€œì¶”ì¸¡â€ì€ í”¼í•¨(ì…€í”„ ì½”ë ‰íŠ¸).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ê²½ê³„ ëª…í™•í™”</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">Path/bytes</code>ëŠ” <strong>ì—¬ê¸°ì„œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ</strong>. íŒŒì¼ I/OëŠ” <code class="language-plaintext highlighter-rouge">from_file</code>ë¡œë§Œ.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> I/O ì‚¬ì´ë“œì´í™íŠ¸ ê¸ˆì§€ë¡œ ì¼ê´€ì„± ìœ ì§€(âœ…).</p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="ì½”ë“œ-ì¶”ê°€-ê¸°ì¡´-textbufferì—-ë¶™ì¼-ë©”ì„œë“œ">ì½”ë“œ ì¶”ê°€ (ê¸°ì¡´ <code class="language-plaintext highlighter-rouge">TextBuffer</code>ì— ë¶™ì¼ ë©”ì„œë“œ)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Sequence</span>

<span class="k">class</span> <span class="nc">TextBuffer</span><span class="p">:</span>
    <span class="c1"># ... ê¸°ì¡´ ì½”ë“œ ...
</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">coerce</span><span class="p">(</span>
        <span class="n">cls</span><span class="p">,</span>
        <span class="n">obj</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(),</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        ë‹¤ì–‘í•œ ì…ë ¥(obj)ì„ TextBufferë¡œ í‘œì¤€í™”.
        - TextBuffer: ê·¸ëŒ€ë¡œ ë°˜í™˜
        - str: from_string
        - Iterable[str]: from_lines (í•„ìš” ì‹œ keepends ì¶”ì •)
        - (ì£¼ì˜) Path/bytesëŠ” ì—¬ê¸°ì„œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ â†’ from_file / decode ê²½ë¡œ ì‚¬ìš©
        </span><span class="sh">"""</span>
        <span class="c1"># 1) ì´ë¯¸ TextBufferì¸ ê²½ìš°
</span>        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">TextBuffer</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span>

        <span class="c1"># 2) ë¬¸ìì—´
</span>        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="nf">from_string</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

        <span class="c1"># 3) ë¬¸ìì—´ ì´í„°ëŸ¬ë¸”(ë¦¬ìŠ¤íŠ¸/íŠœí”Œ/ì œë„ˆë ˆì´í„° ë“±)
</span>        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="c1"># materialize (ì œë„ˆë ˆì´í„° ë³´í˜¸ ë° íƒ€ì… ê²€ì‚¬)
</span>            <span class="n">lines</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nf">all</span><span class="p">(</span><span class="nf">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">):</span>
                <span class="k">raise</span> <span class="nc">TypeError</span><span class="p">(</span><span class="sh">"</span><span class="s">Iterable must yield str values</span><span class="sh">"</span><span class="p">)</span>

            <span class="c1"># keepends ê·œì¹™: ëª…ì‹œê°’ ìš°ì„ , ì—†ìœ¼ë©´ ìë™ íŒë³„
</span>            <span class="n">ke</span> <span class="o">=</span> <span class="n">keepends</span> <span class="k">if</span> <span class="n">keepends</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">cls</span><span class="p">.</span><span class="nf">_guess_keepends</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="nf">from_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">keepends</span><span class="o">=</span><span class="n">ke</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

        <span class="c1"># 4) ê·¸ ì™¸ íƒ€ì…ì€ ëª…í™•íˆ ê±°ì ˆ
</span>        <span class="k">raise</span> <span class="nc">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="sh">"</span><span class="s">Cannot coerce type </span><span class="si">{</span><span class="nf">type</span><span class="p">(</span><span class="n">obj</span><span class="p">).</span><span class="n">__name__</span><span class="si">}</span><span class="s"> to TextBuffer. </span><span class="sh">"</span>
            <span class="sh">"</span><span class="s">Use from_file() for paths/files, or pass str/Iterable[str]/TextBuffer.</span><span class="sh">"</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_guess_keepends</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">í•œ ì¤„ì´ë¼ë„ ê°œí–‰ ë¬¸ìë¥¼ í¬í•¨í•˜ë©´ keepends=Trueë¡œ ê°„ì£¼.</span><span class="sh">"""</span>
        <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="nf">if </span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">ln</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="sh">"</span><span class="se">\r</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">ln</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>
</code></pre></div></div>

<p><strong>ê²€ì¦:</strong> ë‹¨ì¼ ì§„ì…ì ìœ¼ë¡œ í¸ì˜ì„±ì„ ì œê³µí•˜ë©´ì„œ, íŒŒì¼ I/OÂ·ë°”ì´íŠ¸ ì²˜ë¦¬ ë“± ì‚¬ì´ë“œì´í™íŠ¸ëŠ” ëª…ì‹œ APIë¡œ ë¶„ë¦¬ â†’ <strong>ì¼ê´€ì„±/í™•ì¥ì„±</strong> ëª©í‘œì— ë¶€í•©. âœ…</p>

<hr />

<h2 id="ì‚¬ìš©-ì˜ˆ">ì‚¬ìš© ì˜ˆ</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">buf1</span> <span class="o">=</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">coerce</span><span class="p">(</span><span class="sh">"</span><span class="s">module top;</span><span class="se">\n</span><span class="s">endmodule</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>
<span class="n">buf2</span> <span class="o">=</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">coerce</span><span class="p">([</span><span class="sh">"</span><span class="s">module top;</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">endmodule</span><span class="sh">"</span><span class="p">],</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>              <span class="c1"># keepends=False
</span><span class="n">buf3</span> <span class="o">=</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">coerce</span><span class="p">([</span><span class="sh">"</span><span class="s">module top;</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">endmodule</span><span class="se">\n</span><span class="sh">"</span><span class="p">],</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>          <span class="c1"># keepends=True (ìë™ íŒë³„)
</span><span class="n">buf4</span> <span class="o">=</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">coerce</span><span class="p">(</span><span class="n">existing_textbuffer</span><span class="p">)</span>                                        <span class="c1"># ê·¸ëŒ€ë¡œ
# íŒŒì¼ì€ ëª…ì‹œ API ì‚¬ìš©
</span><span class="n">buf5</span> <span class="o">=</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">from_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="í™•ì¥-ì•„ì´ë””ì–´í•„ìš”-ì‹œ">í™•ì¥ ì•„ì´ë””ì–´(í•„ìš” ì‹œ)</h2>

<ul>
  <li>
    <p><strong>ëª¨ë“ˆ ì „ì—­<code class="language-plaintext highlighter-rouge">ensure_textbuffer(obj, **opts)</code></strong> í•¨ìˆ˜ë¥¼ <code class="language-plaintext highlighter-rouge">functools.singledispatch</code>ë¡œ ì œê³µ(ë‚´ë¶€ì—ì„œ ìœ„ <code class="language-plaintext highlighter-rouge">coerce</code> í˜¸ì¶œ).</p>
  </li>
  <li>
    <p>ì™¸ë¶€ íƒ€ì… ì§€ì›: ê°ì²´ê°€ <code class="language-plaintext highlighter-rouge">to_textbuffer()</code>(ë˜ëŠ” <code class="language-plaintext highlighter-rouge">__textbuffer__()</code>)ë¥¼ êµ¬í˜„í–ˆë‹¤ë©´ ê·¸ê±¸ ìš°ì„  í˜¸ì¶œí•˜ëŠ” <strong>ì–´ëŒ‘í„° íŒ¨í„´</strong> í—ˆìš©.</p>
  </li>
</ul>

<hr />

<h3 id="ìµœì¢…-íŒë‹¨">ìµœì¢… íŒë‹¨</h3>

<ul>
  <li>
    <p>â€œìë™ ìƒì„±â€ì€ ìƒì‚°ì„±ì„ ì˜¬ë¦¬ë˜, <strong>ëª…ì‹œ APIë¥¼ ë‚¨ê²¨</strong> ê²½ê³„ë¥¼ ë¶„ëª…íˆ í•˜ëŠ” ì§€ê¸ˆ ë°©ì‹ì´ ê°€ì¥ ì•ˆì „í•©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>íœ´ë¦¬ìŠ¤í‹±ì€ ìµœì†Œí™”í–ˆê³ , í•„ìš” ì‹œ <code class="language-plaintext highlighter-rouge">keepends</code>ë¥¼ ëª…ì‹œí•˜ë©´ <strong>í•­ìƒ ìš°ì„ </strong> í•©ë‹ˆë‹¤.<br />
â†’ í”„ë¡œì íŠ¸ì˜ <strong>ì¼ê´€ì„±</strong>(ë†€ë¼ì›€ ìµœì†Œí™”)ê³¼ <strong>í™•ì¥ì„±</strong>(íƒ€ì… ì¶”ê°€ ì—¬ì§€) ëª©í‘œì— ì í•©í•©ë‹ˆë‹¤. âœ…</p>
  </li>
</ul>

<p class="chat--user">

coerce ë‹¨ì–´ê°€ ì¢€ ì–´ë ¤ìš´ë°

</p>

<p>ì¢‹ì€ í¬ì¸íŠ¸! ì´ë¦„ì´ ì–´ë µê²Œ ëŠê»´ì§€ë©´ ì“°ëŠ” ì‚¬ëŒì´ ì•ˆ ì“°ê²Œ ë©ë‹ˆë‹¤ ğŸ˜…<br />
ì•„ë˜ì²˜ëŸ¼ ë°”ê¾¸ë©´ ì–´ë•Œìš”?</p>

<h3 id="ì²´í¬ë¦¬ìŠ¤íŠ¸">ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>

<ul>
  <li>
    <p>í›„ë³´ ì´ë¦„ ëª‡ ê°œ ì œì•ˆí•˜ê³  ì˜ë¯¸Â·ê´€ìš©ì„± ë¹„êµ</p>
  </li>
  <li>
    <p>í•˜ë‚˜ë¥¼ <strong>ê¸°ë³¸ ì¶”ì²œ</strong> ìœ¼ë¡œ ì„ íƒ</p>
  </li>
  <li>
    <p>ê¸°ì¡´ <code class="language-plaintext highlighter-rouge">coerce</code>ëŠ” <strong>í˜¸í™˜ìš© ë³„ì¹­</strong> ìœ¼ë¡œ ë‚¨ê¹€</p>
  </li>
  <li>
    <p>ì˜ˆì‹œ ì½”ë“œ/ì‚¬ìš©ë²• ì œì‹œ</p>
  </li>
  <li>
    <p>ì„ íƒì´ <strong>ì¼ê´€ì„±/í™•ì¥ì„±</strong> ëª©í‘œì— ë§ëŠ”ì§€ ë¹ ë¥¸ ê²€ì¦</p>
  </li>
</ul>

<hr />

<h2 id="ì´ë¦„-í›„ë³´-ì§§ì€-ì½”ë©˜íŠ¸">ì´ë¦„ í›„ë³´ (ì§§ì€ ì½”ë©˜íŠ¸)</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">as_textbuffer(obj, ...)</code> â€” <strong>ê°€ì¥ ì¶”ì²œ</strong>. NumPyì˜ <code class="language-plaintext highlighter-rouge">asarray</code> íŒ¨í„´ì²˜ëŸ¼ â€œì´ê±¸ TextBufferë¡œ â€˜ë°”ê¿”ì„œâ€™ ì£¼ì„¸ìš”(ì´ë¯¸ë©´ ê·¸ëŒ€ë¡œ)â€ë¼ëŠ” ì˜ë¯¸ê°€ <strong>ì§ê´€ì </strong>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ensure_textbuffer(obj, ...)</code> â€” â€œTextBuffer ë˜ê²Œ ë³´ì¥í•´ì¤˜â€ë¼ëŠ” ë‰˜ì•™ìŠ¤. ëª…í™•í•˜ì§€ë§Œ ì•½ê°„ ê¸¸ì–´ìš”.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">from_any(obj, ...)</code> â€” â€œì•„ë¬´ íƒ€ì…ì´ë‚˜ ë°›ì•„ë“¤ì—¬ ìƒì„±â€. ê¸°ëŠ¥ì€ ë§ì§€ë§Œ ì˜ë¯¸ê°€ ì•½ê°„ í¬ê´„ì .</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">wrap(obj, ...)</code> / <code class="language-plaintext highlighter-rouge">adapt(obj, ...)</code> â€” í¬ì¥/ì–´ëŒ‘íŠ¸ ëŠë‚Œ. ë‹¤ë§Œ êµ¬ì²´ì„±ì´ ë–¨ì–´ì§.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">cast(...)</code> â€” íƒ€ì… ìºìŠ¤íŠ¸ ë‰˜ì•™ìŠ¤ë¡œ í˜¼ë™ ìš°ë ¤ â†’ ë¹„ì¶”ì²œ.</p>
  </li>
</ul>

<p><strong>ê²°ë¡ :</strong> <code class="language-plaintext highlighter-rouge">as_textbuffer</code>ë¥¼ ê¸°ë³¸ìœ¼ë¡œ, í´ë˜ìŠ¤ ë©”ì„œë“œë¡œëŠ” <code class="language-plaintext highlighter-rouge">from_any</code>ë¥¼ ì–¹ê³ , ê¸°ì¡´ <code class="language-plaintext highlighter-rouge">coerce</code>ëŠ” aliasë¡œ ë‘ëŠ” êµ¬ì„±ì´ ê°€ì¥ ì½ê¸° ì‰½ê³  ì ì§„ì ì…ë‹ˆë‹¤.</p>

<ul>
  <li><em>ê²€ì¦:</em> ì´ë¦„ë§Œ ë°”ê¿”ë„ í˜¸ì¶œë¶€ ê°€ë…ì„±â†‘(ì¼ê´€ì„± ëª©í‘œ ë¶€í•©) / API í™•ì¥ ì‹œì—ë„ ì˜ë¯¸ ìœ ì§€(í™•ì¥ì„± ëª©í‘œ ë¶€í•©). âœ…</li>
</ul>

<hr />

<h2 id="ì½”ë“œ-ìŠ¤ë‹ˆí«-ê¸°ì¡´-coerce-ë‚´ìš©ì„-ë‚´ë¶€-êµ¬í˜„ìœ¼ë¡œ-ì¬ì‚¬ìš©">ì½”ë“œ ìŠ¤ë‹ˆí« (ê¸°ì¡´ <code class="language-plaintext highlighter-rouge">coerce</code> ë‚´ìš©ì„ ë‚´ë¶€ êµ¬í˜„ìœ¼ë¡œ ì¬ì‚¬ìš©)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># module-level í•¨ìˆ˜: ê°€ì¥ ëˆˆì— ì˜ ë„ëŠ” ì§„ì…ì 
</span><span class="k">def</span> <span class="nf">as_textbuffer</span><span class="p">(</span>
    <span class="n">obj</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(),</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">from_any</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">keepends</span><span class="o">=</span><span class="n">keepends</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TextBuffer</span><span class="p">:</span>
    <span class="c1"># ... ê¸°ì¡´ ì½”ë“œ ...
</span>
    <span class="c1"># ìƒˆ ì´ë¦„: ì˜ë¯¸ê°€ ë¶„ëª…í•œ í´ë˜ìŠ¤ ë©”ì„œë“œ
</span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_any</span><span class="p">(</span>
        <span class="n">cls</span><span class="p">,</span>
        <span class="n">obj</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(),</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="nf">_from_any_impl</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">keepends</span><span class="o">=</span><span class="n">keepends</span><span class="p">)</span>

    <span class="c1"># ê³¼ê±° ì´ë¦„ì€ í˜¸í™˜ìš© ë³„ì¹­ìœ¼ë¡œ ìœ ì§€ (ì›í•˜ë©´ í–¥í›„ deprecate)
</span>    <span class="nb">coerce</span> <span class="o">=</span> <span class="n">from_any</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_any_impl</span><span class="p">(</span>
        <span class="n">cls</span><span class="p">,</span>
        <span class="n">obj</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="bp">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="kn">from</span> <span class="n">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Sequence</span>

        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">TextBuffer</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span>

        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="nf">from_string</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nf">all</span><span class="p">(</span><span class="nf">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">):</span>
                <span class="k">raise</span> <span class="nc">TypeError</span><span class="p">(</span><span class="sh">"</span><span class="s">Iterable must yield str values</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">ke</span> <span class="o">=</span> <span class="n">keepends</span> <span class="k">if</span> <span class="n">keepends</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">cls</span><span class="p">.</span><span class="nf">_guess_keepends</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="nf">from_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">keepends</span><span class="o">=</span><span class="n">ke</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

        <span class="k">raise</span> <span class="nc">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="sh">"</span><span class="s">Cannot convert </span><span class="si">{</span><span class="nf">type</span><span class="p">(</span><span class="n">obj</span><span class="p">).</span><span class="n">__name__</span><span class="si">}</span><span class="s"> to TextBuffer. </span><span class="sh">"</span>
            <span class="sh">"</span><span class="s">Use from_file() for paths/files, or pass str/Iterable[str]/TextBuffer.</span><span class="sh">"</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_guess_keepends</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="sh">"</span><span class="s">Sequence[str]</span><span class="sh">"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">any</span><span class="p">((</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">ln</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="sh">"</span><span class="se">\r</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">ln</span><span class="p">)</span> <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ì‚¬ìš©-ì˜ˆ-1">ì‚¬ìš© ì˜ˆ</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">buf1</span> <span class="o">=</span> <span class="nf">as_textbuffer</span><span class="p">(</span><span class="sh">"</span><span class="s">module top;</span><span class="se">\n</span><span class="s">endmodule</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>
<span class="n">buf2</span> <span class="o">=</span> <span class="nf">as_textbuffer</span><span class="p">([</span><span class="sh">"</span><span class="s">module top;</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">endmodule</span><span class="sh">"</span><span class="p">],</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>
<span class="n">buf3</span> <span class="o">=</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">from_any</span><span class="p">([</span><span class="sh">"</span><span class="s">a</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="se">\n</span><span class="sh">"</span><span class="p">],</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>  <span class="c1"># í´ë˜ìŠ¤ ë©”ì„œë“œ ê²½ë¡œ
</span><span class="n">buf4</span> <span class="o">=</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">coerce</span><span class="p">(</span><span class="sh">"</span><span class="s">...</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># ê¸°ì¡´ ì½”ë“œë„ ê·¸ëŒ€ë¡œ ë™ì‘(í˜¸í™˜ alias)
</span></code></pre></div></div>

<hr />

<h2 id="ë¹ ë¥¸-ê²€ì¦--ì…€í”„ì½”ë ‰íŠ¸">ë¹ ë¥¸ ê²€ì¦ &amp; ì…€í”„ì½”ë ‰íŠ¸</h2>

<ul>
  <li>
    <p><strong>ê°€ë…ì„±/ì˜ˆì¸¡ ê°€ëŠ¥ì„±:</strong> <code class="language-plaintext highlighter-rouge">as_textbuffer</code> ì´ë¦„ë§Œ ë³´ê³ ë„ ì—­í• ì´ ë³´ì…ë‹ˆë‹¤. í˜¼ë™ ì—¬ì§€ ë‚®ìŒ. âœ…</p>
  </li>
  <li>
    <p><strong>ì¼ê´€ì„±:</strong> <code class="language-plaintext highlighter-rouge">from_string/from_lines/from_file</code> ê°™ì€ ëª…ì‹œ ê²½ë¡œë¥¼ ìœ ì§€í•˜ë©´ì„œ, â€œí¸ì˜ ê²½ë¡œâ€ëŠ” <code class="language-plaintext highlighter-rouge">as_textbuffer</code>ë¡œ í†µì¼. âœ…</p>
  </li>
  <li>
    <p><strong>í™•ì¥ì„±:</strong> ì œ3ì íƒ€ì…ì´ ëŠ˜ì–´ë‚˜ë©´ <code class="language-plaintext highlighter-rouge">_from_any_impl</code>ì— ì–´ëŒ‘í„° í›…ì„ ì¶”ê°€í•˜ë©´ ë¨(ì˜ˆ: <code class="language-plaintext highlighter-rouge">obj.__textbuffer__()</code> ì§€ì› ë“±). âœ…</p>
  </li>
  <li>
    <p><strong>ëª¨í˜¸ì„± ê´€ë¦¬:</strong> íŒŒì¼/ë°”ì´íŠ¸ëŠ” ì—¬ì „íˆ <code class="language-plaintext highlighter-rouge">from_file</code>/decode ê²½ë¡œë¡œë§Œ ì²˜ë¦¬ â†’ ì‚¬ì´ë“œì´í™íŠ¸Â·ì¶”ì¸¡ ë¡œì§ ìµœì†Œí™”. âœ…</p>
  </li>
</ul>

<p>ì›í•˜ì‹œë©´ í”„ë¡œì íŠ¸ ì „ì—­ ë„¤ì´ë° ë£°(ì˜ˆ: â€œí¸ì˜ ë³€í™˜ ì—”íŠ¸ë¦¬ëŠ” í•­ìƒ <code class="language-plaintext highlighter-rouge">as_*</code>ë¡œ ì‹œì‘â€)ë„ ê°™ì´ ì •ë¦¬í•´ ë“œë¦´ê²Œìš”.</p>]]></content><author><name>hvppyarchive</name></author><category term="python" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">Python TextBuffer êµ¬í˜„</title><link href="https://hvppyarchive.github.io/llm/simple-chatbot-client/" rel="alternate" type="text/html" title="Python TextBuffer êµ¬í˜„" /><published>2025-08-21T19:09:31+09:00</published><updated>2025-08-21T19:09:31+09:00</updated><id>https://hvppyarchive.github.io/llm/simple-chatbot-client</id><content type="html" xml:base="https://hvppyarchive.github.io/llm/simple-chatbot-client/"><![CDATA[<p class="chat--user">

Developer: í˜„ì¬ Verilog íŒŒì¼ ì²˜ë¦¬ì™€ ê´€ë ¨ëœ ì—¬ëŸ¬ ì‘ì—…(ì˜ˆ: ê°„ë‹¨í•œ ì „ì²˜ë¦¬/í›„ì²˜ë¦¬ ë“±)ì„ ìˆ˜í–‰ ì¤‘ì…ë‹ˆë‹¤. Raw Verilog ì†ŒìŠ¤ ì½”ë“œë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ” íŒŒì´ì¬ í´ë˜ìŠ¤ ê°œë°œì„ ê²€í† í•˜ê³  ìˆìŠµë‹ˆë‹¤. Verilog ì†ŒìŠ¤ ì½”ë“œëŠ” ë¬¸ìì—´ í˜•íƒœë¡œ ë³´ê´€í•˜ê±°ë‚˜, ì¤„ ë‹¨ìœ„ë¡œ splití•˜ì—¬ List[str] íƒ€ì…(ì¤„ë°”ê¿ˆ ì—†ì´)ìœ¼ë¡œ ì €ì¥í•˜ê±°ë‚˜, splitlines(keepends=True)ë¥¼ ì‚¬ìš©í•´ ì¤„ë°”ê¿ˆì´ í¬í•¨ëœ ë¦¬ìŠ¤íŠ¸ë¡œ ë³´ê´€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ëŸ¬ ë°©ì‹ì´ í”„ë¡œì íŠ¸ ë‚´ì—ì„œ í˜¼ìš©ë˜ë©´ í˜¼ë€ì„ ì´ˆë˜í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë²”ìš©ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì¼ê´€ëœ êµ¬ì¡°ë¥¼ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ì— í†µì¼í•  ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤. Begin with a concise checklist (3-7 bullets) of what you will do; keep items conceptual, not implementation-level. After each significant code or class design decision, briefly validate if the chosen approach aligns with the project's consistency and extensibility goals, and self-correct if needed.

</p>

<p>hereâ€™s the game plan:</p>

<ul>
  <li>
    <p>Define one <strong>canonical, internal representation</strong> for Verilog source and convert to/from other views.</p>
  </li>
  <li>
    <p>Normalize and <strong>track newline style</strong> for faithful round-trips (LF/CRLF/mixed).</p>
  </li>
  <li>
    <p>Expose <strong>consistent views</strong> (<code class="language-plaintext highlighter-rouge">as_string()</code>, <code class="language-plaintext highlighter-rouge">as_lines(keepends=...)</code>) instead of multiple storage forms.</p>
  </li>
  <li>
    <p>Provide a small, <strong>extensible transform pipeline</strong> for pre/post-processing (with history).</p>
  </li>
  <li>
    <p>Make edits <strong>immutable by default</strong> (return a new instance) with an opt-in <code class="language-plaintext highlighter-rouge">in_place=True</code>.</p>
  </li>
  <li>
    <p>Add <strong>I/O helpers</strong> (<code class="language-plaintext highlighter-rouge">from_*</code>, <code class="language-plaintext highlighter-rouge">to_file</code>) with explicit encoding and deterministic newline policy.</p>
  </li>
</ul>

<hr />

<h2 id="key-design-decisions-with-quick-self-checks">Key design decisions (with quick self-checks)</h2>

<ol>
  <li>
    <p><strong>Canonical storage = one normalized<code class="language-plaintext highlighter-rouge">str</code> (<code class="language-plaintext highlighter-rouge">\n</code> line endings).</strong></p>

    <ul>
      <li>
        <p><em>Why:</em> single source of truth avoids drift between parallel representations; Python string ops are fast and familiar.</p>
      </li>
      <li>
        <p><em>Consistency/Extensibility check:</em> callers always interact with one invariant; adding new views later wonâ€™t change storage. âœ…</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Preserve original newline style as metadata (<code class="language-plaintext highlighter-rouge">'lf'|'crlf'|'mixed'</code>).</strong></p>

    <ul>
      <li>
        <p><em>Why:</em> we normalize internally but can emit exactly what the file used before, unless caller overrides.</p>
      </li>
      <li>
        <p><em>Check:</em> round-tripping is predictable across the project; future formatters can opt into a uniform style. âœ…</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Views, not storage:</strong> <code class="language-plaintext highlighter-rouge">as_string(newline=...)</code> and <code class="language-plaintext highlighter-rouge">as_lines(keepends=False|True, newline=...)</code>.</p>

    <ul>
      <li>
        <p><em>Why:</em> banishes ad-hoc lists/strings in the codebase; one class hands out consistent views.</p>
      </li>
      <li>
        <p><em>Check:</em> API encourages a single pattern everywhere; avoids mixing representations in state. âœ…</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Edits are immutable by default, with<code class="language-plaintext highlighter-rouge">in_place=True</code> for performance-critical paths.</strong></p>

    <ul>
      <li>
        <p><em>Why:</em> functional style reduces surprise; explicit mutability keeps hot paths fast.</p>
      </li>
      <li>
        <p><em>Check:</em> consistent with safety + speed; cache invalidation is centralized. âœ…</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Lazy, cached line splits (both with and without<code class="language-plaintext highlighter-rouge">keepends</code>).</strong></p>

    <ul>
      <li>
        <p><em>Why:</em> many tools need line access; caching avoids repeated <code class="language-plaintext highlighter-rouge">splitlines</code>.</p>
      </li>
      <li>
        <p><em>Check:</em> cache invalidated on any text change; future features (e.g., line index) can reuse it. âœ…</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Transform pipeline:<code class="language-plaintext highlighter-rouge">apply(transformer)</code> where a transformer is a callable <code class="language-plaintext highlighter-rouge">text -&gt; text</code>, plus history.</strong></p>

    <ul>
      <li>
        <p><em>Why:</em> flexible slot for â€œpre/post-processingâ€ like trimming, EOL fixing, simple macro munging, etc.</p>
      </li>
      <li>
        <p><em>Check:</em> keeps responsibilities modular; easy to add/remove steps; provenance is recorded. âœ…</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>I/O boundaries explicit:</strong> constructors for string/lines/file; <code class="language-plaintext highlighter-rouge">to_file(encoding, newline)</code>; no auto-detection magic.</p>

    <ul>
      <li>
        <p><em>Why:</em> explicit beats implicit; fewer surprises across platforms and CI.</p>
      </li>
      <li>
        <p><em>Check:</em> project-wide consistency; easy to thread encoding/newline policy from config. âœ…</p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="the-class">The class</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span> <span class="n">hashlib</span>
<span class="kn">import</span> <span class="n">time</span>

<span class="n">NewlineStyle</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">mixed</span><span class="sh">"</span><span class="p">]</span>
<span class="n">EmitNewline</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">TextTransformer</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">A simple, composable transformer: text -&gt; text.</span><span class="sh">"""</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="bp">...</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TransformRecord</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">before_sha1</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">after_sha1</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">VerilogSource</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Canonical container for Verilog source.

    Invariants:
      - Internal storage `_text` always uses LF (</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="s">) line endings.
      - `_newline_style` records the original newline style encountered on load.
      - All edit methods are immutable by default; pass in_place=True to mutate.
    </span><span class="sh">"""</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sh">"</span><span class="s">_text</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">_newline_style</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">_encoding</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">_source_path</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">_version</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">_cached_lines</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">_cached_lines_keepends</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">_history</span><span class="sh">"</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">newline_style</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NewlineStyle</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">source_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">_assume_normalized</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_assume_normalized</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">text</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">newline_style</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">norm</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_normalize_newlines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">prefer</span><span class="o">=</span><span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># internal LF
</span>            <span class="k">if</span> <span class="n">newline_style</span> <span class="ow">and</span> <span class="n">newline_style</span> <span class="o">!=</span> <span class="n">style</span><span class="p">:</span>
                <span class="c1"># honor explicit override only for "mixed" -&gt; "lf/crlf" upgrade
</span>                <span class="n">style</span> <span class="o">=</span> <span class="n">newline_style</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">norm</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span><span class="p">:</span> <span class="n">NewlineStyle</span> <span class="o">=</span> <span class="n">style</span>  <span class="c1"># how it *came in* (for round-trip)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">_encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_source_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">source_path</span> <span class="k">else</span> <span class="bp">None</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span>              <span class="c1"># keepends=False
</span>        <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span>     <span class="c1"># keepends=True
</span>        <span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TransformRecord</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># ---------- creation / I/O ----------
</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span>
        <span class="n">cls</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">source_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">cls</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">source_path</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_lines</span><span class="p">(</span>
        <span class="n">cls</span><span class="p">,</span>
        <span class="n">lines</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">source_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">keepends</span><span class="p">:</span>
            <span class="n">joined</span> <span class="o">=</span> <span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">joined</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">cls</span><span class="p">(</span><span class="n">joined</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">source_path</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span>
        <span class="n">cls</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="nf">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">cls</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_file</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">newline</span><span class="p">:</span> <span class="n">EmitNewline</span> <span class="o">=</span> <span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">ensure_trailing_newline</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_string</span><span class="p">(</span><span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">,</span> <span class="n">ensure_trailing_newline</span><span class="o">=</span><span class="n">ensure_trailing_newline</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="nf">write_text</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="n">_encoding</span><span class="p">)</span>

    <span class="c1"># ---------- core views ----------
</span>
    <span class="k">def</span> <span class="nf">as_string</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">newline</span><span class="p">:</span> <span class="n">EmitNewline</span> <span class="o">=</span> <span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">ensure_trailing_newline</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span>
        <span class="k">if</span> <span class="n">ensure_trailing_newline</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">s</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span>
        <span class="k">if</span> <span class="n">ensure_trailing_newline</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">s</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">newline</span> <span class="o">==</span> <span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">}[</span><span class="n">newline</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># "mixed" -&gt; default to CRLF for lines that originally were CRLF? We can't reconstruct mixed reliably.
</span>            <span class="c1"># project policy: emit LF for mixed unless caller overrides
</span>            <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">as_lines</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">keepends</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">list</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">list</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span><span class="p">)</span>

    <span class="c1"># ---------- inspection ----------
</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_path</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_source_path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">newline_style</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NewlineStyle</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">encoding</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_encoding</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_version</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">history</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TransformRecord</span><span class="p">,</span> <span class="p">...]:</span>
        <span class="k">return</span> <span class="nf">tuple</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">line_count</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_line</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">keepend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="n">keepend</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="c1"># ---------- transforms / edits ----------
</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">transformer</span><span class="p">:</span> <span class="n">TextTransformer</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
        <span class="n">record</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">before</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span>
        <span class="n">after</span> <span class="o">=</span> <span class="nf">transformer</span><span class="p">(</span><span class="n">before</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">after</span> <span class="ow">is</span> <span class="n">before</span><span class="p">:</span>
            <span class="c1"># even if identity, return self or bump version in-place
</span>            <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_bump_version</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">self</span>

        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_set_text</span><span class="p">(</span><span class="n">after</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_record</span><span class="p">(</span><span class="n">transformer</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="nc">VerilogSource</span><span class="p">(</span>
                <span class="n">after</span><span class="p">,</span>
                <span class="n">newline_style</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span><span class="p">,</span>
                <span class="n">encoding</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_encoding</span><span class="p">,</span>
                <span class="n">source_path</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_source_path</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
                <span class="n">inst</span><span class="p">.</span><span class="n">_history</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="nf">_mk_record</span><span class="p">(</span><span class="n">transformer</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">inst</span>

    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">old</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">new</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">class</span> <span class="nc">_Repl</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">replace</span><span class="sh">"</span>
            <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="nf">_Repl</span><span class="p">(),</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_line</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">keepend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
        <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># edit with keepends to keep layout
</span>        <span class="k">if</span> <span class="n">keepend</span><span class="p">:</span>
            <span class="c1"># caller provided EOL
</span>            <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># normalize to internal LF
</span>            <span class="n">eol</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span> <span class="k">else</span> <span class="sh">""</span>
            <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span> <span class="o">+</span> <span class="n">eol</span>
        <span class="n">new_text</span> <span class="o">=</span> <span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_with_text</span><span class="p">(</span><span class="n">new_text</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert_lines</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">new_lines</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
        <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">nl</span> <span class="o">=</span> <span class="p">[</span><span class="n">ln</span> <span class="k">if</span> <span class="n">keepends</span> <span class="nf">else </span><span class="p">(</span><span class="n">ln</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span> <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">new_lines</span><span class="p">]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_text</span> <span class="o">=</span> <span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">nl</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">:])</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_with_text</span><span class="p">(</span><span class="n">new_text</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_lines</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_text</span> <span class="o">=</span> <span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">end</span><span class="p">:])</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_with_text</span><span class="p">(</span><span class="n">new_text</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ensure_trailing_newline</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">self</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_with_text</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_text</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="c1"># ---------- internals ----------
</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_normalize_newlines</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">prefer</span><span class="p">:</span> <span class="n">NewlineStyle</span> <span class="o">=</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NewlineStyle</span><span class="p">]:</span>
        <span class="n">has_crlf</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">text</span>
        <span class="n">has_lf</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">text</span>
        <span class="k">if</span> <span class="n">has_crlf</span> <span class="ow">and</span> <span class="n">has_lf</span> <span class="ow">and</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span> <span class="o">!=</span> <span class="n">text</span><span class="p">:</span>
            <span class="n">style</span><span class="p">:</span> <span class="n">NewlineStyle</span> <span class="o">=</span> <span class="sh">"</span><span class="s">mixed</span><span class="sh">"</span>
        <span class="k">elif</span> <span class="n">has_crlf</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\r</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># coerce to LF
</span>        <span class="k">return</span> <span class="n">norm</span><span class="p">,</span> <span class="n">style</span>

    <span class="k">def</span> <span class="nf">_with_text</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">VerilogSource</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_set_text</span><span class="p">(</span><span class="n">new_text</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">self</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="nc">VerilogSource</span><span class="p">(</span>
            <span class="n">new_text</span><span class="p">,</span>
            <span class="n">newline_style</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_encoding</span><span class="p">,</span>
            <span class="n">source_path</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_source_path</span><span class="p">,</span>
            <span class="n">_assume_normalized</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">inst</span><span class="p">.</span><span class="n">_history</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inst</span>

    <span class="k">def</span> <span class="nf">_set_text</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_text</span> <span class="o">=</span> <span class="n">new_text</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_invalidate_cache</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_bump_version</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_invalidate_cache</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_bump_version</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_version</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_mk_record</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">before</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">after</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransformRecord</span><span class="p">:</span>
        <span class="k">return</span> <span class="nc">TransformRecord</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">before_sha1</span><span class="o">=</span><span class="n">hashlib</span><span class="p">.</span><span class="nf">sha1</span><span class="p">(</span><span class="n">before</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)).</span><span class="nf">hexdigest</span><span class="p">(),</span>
            <span class="n">after_sha1</span><span class="o">=</span><span class="n">hashlib</span><span class="p">.</span><span class="nf">sha1</span><span class="p">(</span><span class="n">after</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)).</span><span class="nf">hexdigest</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_record</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">before</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">after</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">_mk_record</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">))</span>
</code></pre></div></div>

<p><strong>Validation:</strong> The class enforces one storage invariant (LF string), exposes consistent views, and gives predictable I/O. Itâ€™s easy to extend with more transforms or richer metadata later. This aligns with our consistency goal and makes future preprocessors trivial to add. âœ…</p>

<hr />

<h2 id="example-transformers-plug-and-play">Example transformers (plug-and-play)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TrimTrailingWhitespace</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">trim_trailing_ws</span><span class="sh">"</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># safe for Verilog; does not alter semantics
</span>        <span class="k">return</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="nf">rstrip</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="se">\t</span><span class="sh">"</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">EnsureFinalNewline</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">ensure_final_newline</span><span class="sh">"</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span> <span class="k">if</span> <span class="n">text</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span> <span class="nf">else </span><span class="p">(</span><span class="n">text</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Validation:</strong> Transformers are plain callables; team members can add steps without touching the core class. History records provenance. âœ…</p>

<hr />

<h2 id="typical-usage-uniform-across-the-project">Typical usage (uniform across the project)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load
</span><span class="n">src</span> <span class="o">=</span> <span class="n">VerilogSource</span><span class="p">.</span><span class="nf">from_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Get views (without changing internal storage form)
</span><span class="n">text</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="nf">as_string</span><span class="p">()</span>                            <span class="c1"># normalized LF by default (round-tripped on write)
</span><span class="n">lines</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">()</span>                            <span class="c1"># ['module top(', ...]
</span><span class="n">lines_ke</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>            <span class="c1"># ['module top(\n', ...]
</span>
<span class="c1"># Edits (immutable by default)
</span><span class="n">src2</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="nf">set_line</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sh">"</span><span class="s">// AUTOGEN: do not edit</span><span class="sh">"</span><span class="p">)</span>
<span class="n">src3</span> <span class="o">=</span> <span class="n">src2</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="nc">TrimTrailingWhitespace</span><span class="p">())</span>

<span class="c1"># Save with original newline style, enforcing final newline
</span><span class="n">src3</span><span class="p">.</span><span class="nf">to_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">,</span> <span class="n">ensure_trailing_newline</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Validation:</strong> This usage pattern prevents any accidental mixing of storage forms. Every operation goes through one API, keeping the project consistent. âœ…</p>

<hr />

<h2 id="why-this-will-hold-up-on-bigger-needs">Why this will hold up on bigger needs</h2>

<ul>
  <li>
    <p><strong>Round-trip safety:</strong> We track original newline style and encoding; callers can enforce a project-wide style by always passing <code class="language-plaintext highlighter-rouge">newline="lf"</code> if desired.</p>
  </li>
  <li>
    <p><strong>Performance:</strong> Internal <code class="language-plaintext highlighter-rouge">str</code>, lazy line cache, optional in-place edits.</p>
  </li>
  <li>
    <p><strong>Extensibility:</strong> Add richer transforms (comment stripping, lightweight <code class="language-plaintext highlighter-rouge">\</code>line continuation` merges, macro stubs) without changing the core.</p>
  </li>
  <li>
    <p><strong>Determinism:</strong> No auto encoding detection; configs drive output style.</p>
  </li>
</ul>

<hr />

<h3 id="optional-next-steps-if-you-want-them">Optional next steps (if you want them)</h3>

<ul>
  <li>
    <p>Add a <code class="language-plaintext highlighter-rouge">LineIndex</code> helper for O(1) char-offset â†” line/col mapping.</p>
  </li>
  <li>
    <p>Provide <code class="language-plaintext highlighter-rouge">diff(other)</code> to aid review bots.</p>
  </li>
  <li>
    <p>Introduce a config object (encoding/newline policy) to thread through I/O.</p>
  </li>
</ul>

<p>If you share any project constraints (e.g., must always emit LF, or enforce final newline), I can wire them into defaults so every team member gets the same behavior automatically.</p>

<p class="chat--user">

ë³´ë‹¤ë³´ë‹ˆ êµ³ì´ VerilogSourceì— í•œì •ë  í•„ìš”ëŠ” ì—†ëŠ”ê±° ê°™ì€ë° ë²”ìš©ì ì¸ ë°©ë²• ì¶”ì²œìˆì–´?

</p>

<p>ì•„ì£¼ ì¢‹ì•„ìš”â€”Verilog ì „ìš©ì´ ì•„ë‹ˆë¼ <strong>ì–¸ì–´ ë¬´ê´€(Text-agnostic)</strong> í•˜ê²Œ ì“°ë©´ íŒ€ ì „ì²´ì— ë” ê¹”ë”í•©ë‹ˆë‹¤. ì•„ë˜ì²˜ëŸ¼ ì¼ë°˜í™”í•˜ì£ .</p>

<h3 id="ì²´í¬ë¦¬ìŠ¤íŠ¸-ê°œë…-ìœ„ì£¼">ì²´í¬ë¦¬ìŠ¤íŠ¸ (ê°œë… ìœ„ì£¼)</h3>

<ul>
  <li>
    <p>í•˜ë‚˜ì˜ <strong>ë²”ìš© í…ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ</strong> ë¡œ í‘œì¤€í™”í•˜ê³ , ë‚´ë¶€ í‘œí˜„ì€ ë‹¨ì¼ ê·œì¹™(LF)ë¡œ ê³ ì •</p>
  </li>
  <li>
    <p><strong>í”„ë¡œí•„(ì–¸ì–´/í¬ë§· ë©”íƒ€ë°ì´í„°)</strong> ë ˆì´ì–´ë¡œ ì£¼ì„/í™•ì¥ì ë“±ë§Œ ë°”ê¿” ë¼ìš°ê¸°</p>
  </li>
  <li>
    <p><strong>ì¼ê´€ëœ ë·° API</strong>(ë¬¸ìì—´/ì¤„ ë¦¬ìŠ¤íŠ¸)ë§Œ ë…¸ì¶œ, ì €ì¥ í˜•ì‹ì€ 1ê°œ</p>
  </li>
  <li>
    <p><strong>ë³€í™˜ íŒŒì´í”„ë¼ì¸</strong>(transformer: <code class="language-plaintext highlighter-rouge">text -&gt; text</code>)ê³¼ ê¸°ë¡(íˆìŠ¤í† ë¦¬) ì œê³µ</p>
  </li>
  <li>
    <p><strong>ë¶ˆë³€ í¸ì§‘ ê¸°ë³¸ + ì„ íƒì  in-place</strong> , ìºì‹œ/ë²„ì „ ê´€ë¦¬</p>
  </li>
  <li>
    <p>ëª…ì‹œì  <strong>I/O ì •ì±…</strong>(ì¸ì½”ë”©/ê°œí–‰ ë°©ì¹¨)ê³¼ ë¼ìš´ë“œíŠ¸ë¦½ ë³´ì¥</p>
  </li>
</ul>

<hr />

<h2 id="ì„¤ê³„-ìŠ¤í…ê°-ìŠ¤í…ë§ˆë‹¤-ë¹ ë¥¸-ê²€ì¦-í¬í•¨">ì„¤ê³„ ìŠ¤í…(ê° ìŠ¤í…ë§ˆë‹¤ ë¹ ë¥¸ ê²€ì¦ í¬í•¨)</h2>

<ol>
  <li>
    <p><strong>ë²”ìš© ì»¨í…Œì´ë„ˆ =<code class="language-plaintext highlighter-rouge">TextBuffer</code> (ë‚´ë¶€ LF ë¬¸ìì—´ 1ê°œë§Œ ì €ì¥)</strong></p>

    <ul>
      <li>
        <p><em>ì´ìœ :</em> ìƒíƒœê°€ í•˜ë‚˜ë©´ í‘œí˜„ ë¶ˆì¼ì¹˜ê°€ ì‚¬ë¼ì§.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> í”„ë¡œì íŠ¸ ì¼ê´€ì„±(âœ…) / ë‹¤ë¥¸ ì–¸ì–´ë¡œ í™•ì¥ ì‰¬ì›€(âœ…).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ë©”íƒ€ë°ì´í„°/í”„ë¡œí•„(<code class="language-plaintext highlighter-rouge">TextProfile</code>) ë¶„ë¦¬</strong></p>

    <ul>
      <li>
        <p>ì´ë¦„, ëŒ€í‘œ í™•ì¥ì, ì£¼ì„ ë§ˆì»¤ ë“±ì€ â€œì„¤ëª…â€ì¼ ë¿, ë™ì‘ì€ ë™ì¼.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> í…ìŠ¤íŠ¸ ì½”ì–´ëŠ” ê°™ê³ , ì–¸ì–´ë³„ ê·œì¹™ì€ ì–¹ê¸°ë§Œ í•¨ â†’ í™•ì¥ì„±(âœ…).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ë·° API =<code class="language-plaintext highlighter-rouge">as_string(newline=...)</code>, <code class="language-plaintext highlighter-rouge">as_lines(keepends=...)</code></strong></p>

    <ul>
      <li>
        <p>ì €ì¥ì€ 1ì¢…, ë·°ë§Œ ì—¬ëŸ¬ í˜•íƒœë¡œ â€œë³´ì—¬ì£¼ê¸°â€.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> ì½”ë“œë² ì´ìŠ¤ì—ì„œ í˜¼ìš© ë°©ì§€(âœ…). ìƒˆ ë·° ì¶”ê°€ ì‹œ ë‚´ë¶€ëŠ” ê·¸ëŒ€ë¡œ(âœ…).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ê°œí–‰ ì •ì±…ê³¼ ë¼ìš´ë“œíŠ¸ë¦½</strong></p>

    <ul>
      <li>
        <p>ë¡œë“œ ì‹œ CRLF/í˜¼í•© ê°ì§€ â†’ ë‚´ë¶€ LFë¡œ ì •ê·œí™” + â€œì›ë˜ ìŠ¤íƒ€ì¼â€ ë©”íƒ€ ë³´ì¡´.</p>
      </li>
      <li>
        <p>ì €ì¥ ì‹œ <code class="language-plaintext highlighter-rouge">original|lf|crlf</code> ì„ íƒ, <code class="language-plaintext highlighter-rouge">ensure_trailing_newline</code> ì˜µì…˜ ì œê³µ.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> ì¬í˜„ì„±/ì˜ˆì¸¡ê°€ëŠ¥ì„±(âœ…). <em>í˜¼í•©</em> ì€ ì™„ì „ ë³µì› ë¶ˆê°€ â†’ ì •ì±…ìƒ LFë¡œ ë‚´ë³´ë‚´ê¸°(í•©ë¦¬ì  ì…€í”„ì½”ë ‰íŠ¸).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ë³€í™˜ íŒŒì´í”„ë¼ì¸ + ì—­ì‚¬(sha1)</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">apply(transformer)</code>ë¡œ ì¡°í•© ê°€ëŠ¥; ì´ë¦„/í•´ì‹œ ê¸°ë¡.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> ë‹¨ê³„ì  ì „/í›„ì²˜ë¦¬ì˜ í‘œì¤€ í†µë¡œ(âœ…). ì›ì¸ ì¶”ì  ìš©ì´(âœ…).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>í¸ì§‘ ëª¨ë¸: ë¶ˆë³€ ê¸°ë³¸ +<code class="language-plaintext highlighter-rouge">in_place=True</code></strong></p>

    <ul>
      <li>
        <p>ì•ˆì „í•œ ê¸°ë³¸ê°’, ê³ ì„±ëŠ¥ ê²½ë¡œ í•„ìš” ì‹œ ëª…ì‹œì  ì‚¬ìš©.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> ì•ˆì „/ì„±ëŠ¥ ê· í˜•(âœ…). ìºì‹œ ë¬´íš¨í™” í•œ ê³³ì—ì„œ ê´€ë¦¬(âœ…).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>I/O ê²½ê³„ëŠ” ëª…ì‹œì </strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">from_*</code>/<code class="language-plaintext highlighter-rouge">to_file(encoding,newline)</code>ì—ì„œë§Œ í™˜ê²½ ì˜í–¥ì„ ë°›ë„ë¡.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> CI/OS ì°¨ì´ ìµœì†Œí™”(âœ…).</p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="ë²”ìš©-êµ¬í˜„-ìŠ¤ì¼ˆë ˆí†¤-python">ë²”ìš© êµ¬í˜„ ìŠ¤ì¼ˆë ˆí†¤ (Python)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span> <span class="n">hashlib</span><span class="p">,</span> <span class="n">time</span>

<span class="c1"># ---- Profiles (ì–¸ì–´/í¬ë§· ì„¤ëª…ìš© ë©”íƒ€) ----
</span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TextProfile</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">plain</span><span class="sh">"</span>
    <span class="n">file_exts</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="p">...]</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">line_comment_markers</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="p">...]</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">block_comment_markers</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="p">...]</span> <span class="o">=</span> <span class="p">()</span>

<span class="c1"># ì˜ˆì‹œ í”„ë¡œí•„
</span><span class="n">VERILOG</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">verilog</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">file_exts</span><span class="o">=</span><span class="p">(</span><span class="sh">"</span><span class="s">.v</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">.sv</span><span class="sh">"</span><span class="p">),</span>
    <span class="n">line_comment_markers</span><span class="o">=</span><span class="p">(</span><span class="sh">"</span><span class="s">//</span><span class="sh">"</span><span class="p">,),</span>
    <span class="n">block_comment_markers</span><span class="o">=</span><span class="p">((</span><span class="sh">"</span><span class="s">/*</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">*/</span><span class="sh">"</span><span class="p">),),</span>
<span class="p">)</span>
<span class="n">PYTHON</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">python</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">file_exts</span><span class="o">=</span><span class="p">(</span><span class="sh">"</span><span class="s">.py</span><span class="sh">"</span><span class="p">,),</span>
    <span class="n">line_comment_markers</span><span class="o">=</span><span class="p">(</span><span class="sh">"</span><span class="s">#</span><span class="sh">"</span><span class="p">,),</span>
<span class="p">)</span>

<span class="n">NewlineStyle</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">mixed</span><span class="sh">"</span><span class="p">]</span>
<span class="n">EmitNewline</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">TextTransformer</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="bp">...</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TransformRecord</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">before_sha1</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">after_sha1</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TextBuffer</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    ë²”ìš© í…ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ(ì–¸ì–´-ë¬´ê´€).
    ë‚´ë¶€ ê·œì¹™:
      - _text ëŠ” í•­ìƒ LF(</span><span class="sh">'</span><span class="se">\\</span><span class="s">n</span><span class="sh">'</span><span class="s">)ë¡œ ì •ê·œí™”ëœ ë‹¨ì¼ ë¬¸ìì—´
      - ì›ë³¸ ê°œí–‰ ìŠ¤íƒ€ì¼/ì¸ì½”ë”©/ê²½ë¡œ/í”„ë¡œí•„ì„ ë©”íƒ€ë¡œ ë³´ê´€
      - ë¶ˆë³€ í¸ì§‘ ê¸°ë³¸, in_place=Trueë¡œ ëª…ì‹œì  ë³€ê²½ ê°€ëŠ¥
    </span><span class="sh">"""</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">_text</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">_newline_style</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">_encoding</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">_source_path</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">_profile</span><span class="sh">"</span><span class="p">,</span>
                 <span class="sh">"</span><span class="s">_version</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">_cached_lines</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">_cached_lines_keepends</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">_history</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(),</span>
        <span class="n">newline_style</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NewlineStyle</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">source_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">_assume_normalized</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_assume_normalized</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">text</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">newline_style</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">norm</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_normalize_newlines</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">norm</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span><span class="p">:</span> <span class="n">NewlineStyle</span> <span class="o">=</span> <span class="n">style</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_source_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">source_path</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="n">profile</span>

        <span class="n">self</span><span class="p">.</span><span class="n">_version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TransformRecord</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># ---------- constructors / I-O ----------
</span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(),</span>
                    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">cls</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">source_path</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_lines</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">lines</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                   <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(),</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
                   <span class="n">source_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">joined</span> <span class="o">=</span> <span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="k">if</span> <span class="n">keepends</span> <span class="k">else</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">cls</span><span class="p">(</span><span class="n">joined</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">source_path</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(),</span>
                  <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="nf">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">cls</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_file</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                <span class="n">newline</span><span class="p">:</span> <span class="n">EmitNewline</span> <span class="o">=</span> <span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">ensure_trailing_newline</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_string</span><span class="p">(</span><span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">,</span> <span class="n">ensure_trailing_newline</span><span class="o">=</span><span class="n">ensure_trailing_newline</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="nf">write_text</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="n">_encoding</span><span class="p">)</span>

    <span class="c1"># ---------- views ----------
</span>    <span class="k">def</span> <span class="nf">as_string</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">newline</span><span class="p">:</span> <span class="n">EmitNewline</span> <span class="o">=</span> <span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">,</span>
                  <span class="n">ensure_trailing_newline</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span>
        <span class="k">if</span> <span class="n">ensure_trailing_newline</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">s</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span>
        <span class="k">if</span> <span class="n">ensure_trailing_newline</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">s</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">style</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span> <span class="k">if</span> <span class="n">newline</span> <span class="o">==</span> <span class="sh">"</span><span class="s">original</span><span class="sh">"</span> <span class="k">else</span> <span class="p">{</span><span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">}[</span><span class="n">newline</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># mixedëŠ” ì •í™• ë³µì›ì´ ë¶ˆê°€ â†’ ì •ì±…ìƒ LFë¡œ ë‚´ë³´ëƒ„
</span>            <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">as_lines</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">keepends</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">list</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">list</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span><span class="p">)</span>

    <span class="c1"># ---------- inspection ----------
</span>    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TextProfile</span><span class="p">:</span> <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_profile</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_path</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span> <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_source_path</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">newline_style</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NewlineStyle</span><span class="p">:</span> <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">encoding</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_encoding</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">_version</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">history</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TransformRecord</span><span class="p">,</span> <span class="p">...]:</span> <span class="k">return</span> <span class="nf">tuple</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">line_count</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="k">return</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_line</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">keepend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="n">keepend</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span>

    <span class="c1"># ---------- edits / transforms ----------
</span>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">transformer</span><span class="p">:</span> <span class="n">TextTransformer</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
              <span class="n">record</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">before</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span>
        <span class="n">after</span> <span class="o">=</span> <span class="nf">transformer</span><span class="p">(</span><span class="n">before</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">after</span> <span class="ow">is</span> <span class="n">before</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_bump_version</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">self</span>
        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_set_text</span><span class="p">(</span><span class="n">after</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">record</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_record</span><span class="p">(</span><span class="n">transformer</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="nc">TextBuffer</span><span class="p">(</span><span class="n">after</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_profile</span><span class="p">,</span> <span class="n">newline_style</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span><span class="p">,</span>
                              <span class="n">encoding</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_encoding</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_source_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">record</span><span class="p">:</span> <span class="n">inst</span><span class="p">.</span><span class="n">_history</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="nf">_mk_record</span><span class="p">(</span><span class="n">transformer</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">inst</span>

    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">old</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">class</span> <span class="nc">_Repl</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">replace</span><span class="sh">"</span>
            <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="k">return</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="nf">_Repl</span><span class="p">(),</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_line</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">keepend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                 <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">keepend</span><span class="p">:</span>
            <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">eol</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span> <span class="k">else</span> <span class="sh">""</span>
            <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span> <span class="o">+</span> <span class="n">eol</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_with_text</span><span class="p">(</span><span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert_lines</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">new_lines</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                     <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">nl</span> <span class="o">=</span> <span class="p">[</span><span class="n">ln</span> <span class="k">if</span> <span class="n">keepends</span> <span class="nf">else </span><span class="p">(</span><span class="n">ln</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span> <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">new_lines</span><span class="p">]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_with_text</span><span class="p">(</span><span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">nl</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">:]),</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_lines</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_with_text</span><span class="p">(</span><span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">end</span><span class="p">:]),</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ensure_trailing_newline</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">self</span> <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_text</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span> <span class="k">else</span> <span class="n">self</span><span class="p">.</span><span class="nf">_with_text</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_text</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>

    <span class="c1"># ---------- internals ----------
</span>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_normalize_newlines</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NewlineStyle</span><span class="p">]:</span>
        <span class="n">has_crlf</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">text</span>
        <span class="n">has_lf</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">text</span>
        <span class="k">if</span> <span class="n">has_crlf</span> <span class="ow">and</span> <span class="n">has_lf</span> <span class="ow">and</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span> <span class="o">!=</span> <span class="n">text</span><span class="p">:</span> <span class="n">style</span><span class="p">:</span> <span class="n">NewlineStyle</span> <span class="o">=</span> <span class="sh">"</span><span class="s">mixed</span><span class="sh">"</span>
        <span class="k">elif</span> <span class="n">has_crlf</span><span class="p">:</span> <span class="n">style</span> <span class="o">=</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">style</span> <span class="o">=</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span>
        <span class="k">return</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\r</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">),</span> <span class="n">style</span>

    <span class="k">def</span> <span class="nf">_with_text</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_set_text</span><span class="p">(</span><span class="n">new_text</span><span class="p">);</span> <span class="k">return</span> <span class="n">self</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="nc">TextBuffer</span><span class="p">(</span><span class="n">new_text</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_profile</span><span class="p">,</span> <span class="n">newline_style</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_newline_style</span><span class="p">,</span>
                          <span class="n">encoding</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_encoding</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_source_path</span><span class="p">,</span> <span class="n">_assume_normalized</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">inst</span><span class="p">.</span><span class="n">_history</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inst</span>

    <span class="k">def</span> <span class="nf">_set_text</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_text</span> <span class="o">=</span> <span class="n">new_text</span><span class="p">;</span> <span class="n">self</span><span class="p">.</span><span class="nf">_invalidate_cache</span><span class="p">();</span> <span class="n">self</span><span class="p">.</span><span class="nf">_bump_version</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_invalidate_cache</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span> <span class="n">self</span><span class="p">.</span><span class="n">_cached_lines_keepends</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_bump_version</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">_version</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_mk_record</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">before</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">after</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransformRecord</span><span class="p">:</span>
        <span class="k">return</span> <span class="nc">TransformRecord</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">before_sha1</span><span class="o">=</span><span class="n">hashlib</span><span class="p">.</span><span class="nf">sha1</span><span class="p">(</span><span class="n">before</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)).</span><span class="nf">hexdigest</span><span class="p">(),</span>
            <span class="n">after_sha1</span><span class="o">=</span><span class="n">hashlib</span><span class="p">.</span><span class="nf">sha1</span><span class="p">(</span><span class="n">after</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)).</span><span class="nf">hexdigest</span><span class="p">(),</span>
        <span class="p">)</span>
    <span class="k">def</span> <span class="nf">_record</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">before</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">after</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_history</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">_mk_record</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">))</span>
</code></pre></div></div>

<p><strong>ê²€ì¦ ìš”ì•½:</strong> ë‚´ë¶€ ì €ì¥ 1ì¢…(LF), ë·° API ê³ ì •, ë³€í™˜/í¸ì§‘/íˆìŠ¤í† ë¦¬ í‘œì¤€í™” â†’ <strong>ì¼ê´€ì„±</strong> ê³¼ <strong>í™•ì¥ì„±</strong> ëª©í‘œì— ë¶€í•©(âœ…). <em>í˜¼í•© ê°œí–‰ ë³µì› í•œê³„</em> ëŠ” ì •ì±…ìœ¼ë¡œ ëª…ì‹œí•˜ì—¬ íŒ€ í˜¼ì„ ì„ ì°¨ë‹¨(ì…€í”„ì½”ë ‰íŠ¸ ì™„ë£Œ).</p>

<hr />

<h2 id="ì‚¬ìš©-ì˜ˆ-ì–¸ì–´-ë¶ˆë¬¸">ì‚¬ìš© ì˜ˆ (ì–¸ì–´ ë¶ˆë¬¸)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Verilogë„ Pythonë„ ë™ì¼í•œ API
</span><span class="n">buf</span> <span class="o">=</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">from_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>

<span class="c1"># ì¼ê´€ëœ ë·°
</span><span class="n">text</span> <span class="o">=</span> <span class="n">buf</span><span class="p">.</span><span class="nf">as_string</span><span class="p">()</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">buf</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">()</span>
<span class="n">lines_ke</span> <span class="o">=</span> <span class="n">buf</span><span class="p">.</span><span class="nf">as_lines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># ë¶ˆë³€ í¸ì§‘ + íŒŒì´í”„ë¼ì¸
</span><span class="k">class</span> <span class="nc">TrimTrailingWS</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">trim_trailing_ws</span><span class="sh">"</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="nf">rstrip</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="se">\t</span><span class="sh">"</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">())</span>

<span class="n">buf2</span> <span class="o">=</span> <span class="n">buf</span><span class="p">.</span><span class="nf">set_line</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sh">"</span><span class="s">// AUTOGEN: do not edit</span><span class="sh">"</span><span class="p">)</span>
<span class="n">buf3</span> <span class="o">=</span> <span class="n">buf2</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="nc">TrimTrailingWS</span><span class="p">())</span>
<span class="n">buf3</span><span class="p">.</span><span class="nf">to_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="sh">"</span><span class="s">original</span><span class="sh">"</span><span class="p">,</span> <span class="n">ensure_trailing_newline</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="verilog-ì „ìš©-apiê°€-í•„ìš”í•˜ë©´">Verilog ì „ìš© APIê°€ í•„ìš”í•˜ë©´?</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">VerilogSource = TextBuffer</code>ì— <code class="language-plaintext highlighter-rouge">profile=VERILOG</code>ë§Œ ê¸°ë³¸ê°’ìœ¼ë¡œ ë˜í•‘(ë˜ëŠ” ì„œë¸Œí´ë˜ì‹±)í•˜ë©´ ë©ë‹ˆë‹¤. ì½”ë“œë² ì´ìŠ¤ëŠ” <strong>í•­ìƒ<code class="language-plaintext highlighter-rouge">TextBuffer</code> API</strong>ë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ í˜¼ìš©ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.</li>
</ul>

<hr />

<h2 id="ê¶Œì¥-ì •ì±…íŒ€-ê·œì¹™ìœ¼ë¡œ-ê³ ì •-ì¶”ì²œ">ê¶Œì¥ ì •ì±…(íŒ€ ê·œì¹™ìœ¼ë¡œ ê³ ì • ì¶”ì²œ)</h2>

<ul>
  <li>
    <p>ì €ì¥ ì‹œ ê¸°ë³¸ <code class="language-plaintext highlighter-rouge">newline="original"</code>(ë ˆê±°ì‹œ ìœ ì§€) â†’ ë¦¬í¬ë§· ë‹¨ê³„ì—ì„œ ì¼ê´„ <code class="language-plaintext highlighter-rouge">lf</code> ì „í™˜ ì„ íƒ ê°€ëŠ¥.</p>
  </li>
  <li>
    <p>ëª¨ë“  ë³€í™˜ì€ <strong>Transformer</strong> ë¡œë§Œ ìˆ˜í–‰(ì§ì ‘ ë¬¸ìì—´ ì¡°ì‘ ê¸ˆì§€).</p>
  </li>
  <li>
    <p>CIì— <code class="language-plaintext highlighter-rouge">ensure_trailing_newline=True</code> + <code class="language-plaintext highlighter-rouge">TrimTrailingWS</code> ì ìš©.</p>
  </li>
</ul>

<p>í•„ìš”í•˜ë©´ í† í°í™”ë‚˜ ë¼ì¸-ì˜¤í”„ì…‹ ë§¤í•‘, <code class="language-plaintext highlighter-rouge">diff(other)</code> ê°™ì€ ìœ í‹¸ì„ ì–¹ì„ ìˆ˜ ìˆê²Œ ì„¤ê³„í•´ ë‘ì—ˆìŠµë‹ˆë‹¤. ì›í•˜ëŠ” ê¸°ë³¸ í”„ë¡œí•„(Verilog/Lex/YAML ë“±) ëª©ë¡ì„ ì•Œë ¤ì£¼ì‹œë©´ í…œí”Œë¦¿ìœ¼ë¡œ í•¨ê»˜ ì¶”ê°€í•´ ë“œë¦´ê²Œìš”.</p>

<p class="chat--user">

ì´ëŸ° ì¼ì„ í•˜ëŠ” ìœ ëª…í•œ í´ë˜ìŠ¤ë‚˜ íŒŒì´ì¬ ë‚´ì¥ì€ ì—†ì–´?

</p>

<p>ë‹¤ìŒ ìˆœì„œë¡œ ìƒê°í•´ë³¼ê²Œìš” (ê°œë… ì²´í¬ë¦¬ìŠ¤íŠ¸):</p>

<ul>
  <li>
    <p>í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— â€œê·¸ ì¼ì„ ì „ë¶€â€ í•˜ëŠ” <strong>ë‹¨ì¼ í´ë˜ìŠ¤ëŠ” ì—†ë‹¤</strong> â†’ ì¡°í•©í•´ì„œ ì¨ì•¼ í•¨.</p>
  </li>
  <li>
    <p>ê°€ì¥ ê°€ê¹Œìš´ <strong>í‘œì¤€ ë„êµ¬ë“¤</strong> ì´ ë¬´ì—‡ì¸ì§€ íŒŒì•…í•˜ê³ , ë¬´ì—‡ì´ <strong>ë¶€ì¡±</strong> í•œì§€ ëª…í™•íˆ í•˜ê¸°.</p>
  </li>
  <li>
    <p>ë¶€ì¡±í•œ ë¶€ë¶„(ê°œí–‰ ì¶”ì Â·ì¼ê´€ëœ ë·°Â·ë³€í™˜ íŒŒì´í”„ë¼ì¸)ì€ <strong>ì–‡ì€ ë˜í¼</strong> ë¡œ ë³´ì™„.</p>
  </li>
  <li>
    <p>ìµœì†Œì£¼ì˜ ë²„ì „(í•¨ìˆ˜ 2â€“3ê°œ)ê³¼ í™•ì¥í˜•(í´ë˜ìŠ¤) ì¤‘ íŒ€ ì •ì±…ì— ë§ê²Œ ì„ íƒ.</p>
  </li>
</ul>

<hr />

<h2 id="ì§§ì€-ê²°ë¡ ">ì§§ì€ ê²°ë¡ </h2>

<ul>
  <li><strong>í‘œì¤€/ìœ ëª… ë‚´ì¥ì— â€œí…ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ + ê°œí–‰ ì •ì±… + ë³€í™˜/íˆìŠ¤í† ë¦¬â€ë¥¼ í•œ ë²ˆì— ì œê³µí•˜ëŠ” ê±´ ì—†ìŠµë‹ˆë‹¤.</strong><br />
ë”°ë¼ì„œ ì§€ê¸ˆê¹Œì§€ ì œì•ˆí•œ <code class="language-plaintext highlighter-rouge">TextBuffer</code> ê°™ì€ ì–‡ì€ ë˜í¼ê°€ <strong>ì¼ê´€ì„±</strong> ê³¼ <strong>ë¼ìš´ë“œíŠ¸ë¦½ ë³´ì¥</strong> ë©´ì—ì„œ ê°€ì¥ í˜„ì‹¤ì ì…ë‹ˆë‹¤.<br />
<em>ê²€ì¦:</em> íŒ€ ì „ì—­ ì¼ê´€ì„±ê³¼ í™•ì¥ì„± ëª©í‘œì— ë¶€í•©. âœ…</li>
</ul>

<hr />

<h2 id="ê°€ì¥-ê°€ê¹Œìš´-í‘œì¤€-ë„êµ¬ë“¤ë¬´ì—‡ì„-í•´ì£¼ê³ ëª»-í•´ì£¼ëŠ”ê°€">ê°€ì¥ ê°€ê¹Œìš´ í‘œì¤€ ë„êµ¬ë“¤(ë¬´ì—‡ì„ í•´ì£¼ê³ /ëª» í•´ì£¼ëŠ”ê°€)</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">io.StringIO</code><br />
ë©”ëª¨ë¦¬ íŒŒì¼ ê°ì²´. ì¤„ ë‹¨ìœ„ ì½ê¸°/ì“°ê¸° ì‰½ì§€ë§Œ <strong>ì›ë³¸ ê°œí–‰ ìŠ¤íƒ€ì¼ ì¶”ì  X</strong> , ë³€í™˜/íˆìŠ¤í† ë¦¬ X.<br />
<em>ê²€ì¦:</em> â€œì¼ê´€ëœ ë‚´ë¶€ í‘œí˜„â€ ìš”êµ¬ì— ë¯¸ë‹¬ â†’ ë˜í¼ í•„ìš”. âŒ</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">open(..., newline=...)</code> / <code class="language-plaintext highlighter-rouge">pathlib.Path.read_text()/write_text()</code><br />
í…ìŠ¤íŠ¸ ëª¨ë“œì—ì„œ <strong>ê°œí–‰ ë³€í™˜ì„ ì œì–´</strong>(ì“°ê¸° ì‹œ <code class="language-plaintext highlighter-rouge">newline='\n'</code> ê°•ì œ ë“±) ê°€ëŠ¥. í•˜ì§€ë§Œ <strong>ì½ì„ ë•Œ ì›ë³¸ì´ CRLF/í˜¼í•©ì´ì—ˆëŠ”ì§€</strong> ë¥¼ ë³´ì¡´í•˜ì§„ ì•ŠìŒ(ë³´í†µ <code class="language-plaintext highlighter-rouge">\n</code>ìœ¼ë¡œ í¡ìˆ˜).<br />
<em>ê²€ì¦:</em> ë¼ìš´ë“œíŠ¸ë¦½ìš© â€œì›ë˜ ê°œí–‰ ìŠ¤íƒ€ì¼â€ ë©”íƒ€ ë³´ì¡´ì´ ì—†ë‹¤ â†’ ë˜í¼ í•„ìš”. âŒ</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">fileinput</code><br />
ì—¬ëŸ¬ íŒŒì¼ì„ í•œ ì¤„ ìŠ¤íŠ¸ë¦¼ì²˜ëŸ¼ ìˆœíšŒ. <strong>ì»¨í…Œì´ë„ˆ ì•„ë‹˜</strong> , ìƒíƒœ/ë·°/íˆìŠ¤í† ë¦¬ X. âŒ</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">difflib</code><br />
ì°¨ì´ ê³„ì‚°Â·íŒ¨ì¹˜ ì¶œë ¥ì„ ë„ì™€ì¤Œ. <strong>ë³€í™˜ íŒŒì´í”„ë¼ì¸/ì €ì¥ì†Œ</strong> ëŠ” ì•„ë‹˜. ë³´ì¡° ë„êµ¬ë¡œëŠ” ìœ ìš©. ğŸ†—</p>
  </li>
  <li>
    <p>(<code class="language-plaintext highlighter-rouge">tokenize</code>, <code class="language-plaintext highlighter-rouge">ast</code>, <code class="language-plaintext highlighter-rouge">parso</code> ë“±)<br />
ì–¸ì–´ë³„ íŒŒì„œ/í† í¬ë‚˜ì´ì €. â€œêµ¬ë¬¸ ì¸ì§€ ë³€í™˜â€ì—ëŠ” ì¢‹ì§€ë§Œ <strong>ë²”ìš© í…ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ ì—­í• </strong> ì€ ì•„ë‹˜. ë³´ì¡°. ğŸ†—</p>
  </li>
</ul>

<blockquote>
  <p>ìš”ì•½: <strong>ì¡°ê°ë“¤ì€ ìˆì§€ë§Œ, â€œì¼ê´€ ì»¨í…Œì´ë„ˆ + ê°œí–‰ ì •ì±… + ë³€í™˜/íˆìŠ¤í† ë¦¬â€ ì¡°í•©ì€ ì§ì ‘ ì–‡ê²Œ ê°ì‹¸ì•¼</strong> í•©ë‹ˆë‹¤.</p>
</blockquote>

<hr />

<h2 id="ìµœì†Œì£¼ì˜-ëŒ€ì•ˆí´ë˜ìŠ¤-ì—†ì´-í•¨ìˆ˜-3ê°œë¡œ">ìµœì†Œì£¼ì˜ ëŒ€ì•ˆ(í´ë˜ìŠ¤ ì—†ì´ í•¨ìˆ˜ 3ê°œë¡œ)</h2>

<p>í´ë˜ìŠ¤ê°€ ë¶€ë‹´ì´ë©´, íŒ€ ê·œì¹™ì„ í•¨ìˆ˜ë¡œ ê³ ì •í•˜ì„¸ìš”.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="k">def</span> <span class="nf">detect_newline_style</span><span class="p">(</span><span class="n">raw</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>  <span class="c1"># "lf" | "crlf" | "mixed"
</span>    <span class="n">crlf</span> <span class="o">=</span> <span class="n">raw</span><span class="p">.</span><span class="nf">count</span><span class="p">(</span><span class="sa">b</span><span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">lf</span> <span class="o">=</span> <span class="n">raw</span><span class="p">.</span><span class="nf">count</span><span class="p">(</span><span class="sa">b</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">cr</span> <span class="o">=</span> <span class="n">raw</span><span class="p">.</span><span class="nf">count</span><span class="p">(</span><span class="sa">b</span><span class="sh">"</span><span class="se">\r</span><span class="sh">"</span><span class="p">)</span> <span class="o">-</span> <span class="n">crlf</span>
    <span class="nf">if </span><span class="p">(</span><span class="n">crlf</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lf</span> <span class="o">-</span> <span class="n">crlf</span><span class="p">))</span> <span class="ow">or</span> <span class="n">cr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># ì„œë¡œ ì„ì—¬ ìˆìœ¼ë©´ mixed
</span>        <span class="k">return</span> <span class="sh">"</span><span class="s">mixed</span><span class="sh">"</span>
    <span class="k">return</span> <span class="sh">"</span><span class="s">crlf</span><span class="sh">"</span> <span class="k">if</span> <span class="n">crlf</span> <span class="k">else</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span>

<span class="k">def</span> <span class="nf">normalize_to_lf</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\r</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">emit_with_newline</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">s</span> <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="sh">"</span><span class="s">lf</span><span class="sh">"</span> <span class="k">else</span> <span class="n">s</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># mixedëŠ” ì •ì±…ìƒ lf ì·¨ê¸‰ ê¶Œì¥
</span></code></pre></div></div>

<p>ì‚¬ìš© íŒ¨í„´:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">raw</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">p</span><span class="p">).</span><span class="nf">read_bytes</span><span class="p">()</span>
<span class="n">style</span> <span class="o">=</span> <span class="nf">detect_newline_style</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>          <span class="c1"># ì›ë³¸ ìŠ¤íƒ€ì¼ ë©”íƒ€
</span><span class="n">text</span> <span class="o">=</span> <span class="nf">normalize_to_lf</span><span class="p">(</span><span class="n">raw</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">))</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">()</span>                  <span class="c1"># í•„ìš”í•œ ë·°
</span><span class="n">out</span> <span class="o">=</span> <span class="nf">emit_with_newline</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>       <span class="c1"># ì €ì¥ ì‹œ ë¼ìš´ë“œíŠ¸ë¦½
</span></code></pre></div></div>

<ul>
  <li><em>ê²€ì¦:</em> â€œë‹¨ì¼ ë‚´ë¶€ í‘œí˜„(LF ë¬¸ìì—´) + ì›ë³¸ ê°œí–‰ ë©”íƒ€ ë³´ì¡´â€ì„ ë§Œì¡±. ë³€í™˜ íŒŒì´í”„ë¼ì¸/íˆìŠ¤í† ë¦¬ëŠ” ì—¬ì „íˆ ì—†ìœ¼ë¯€ë¡œ, í•„ìš” ì‹œ í´ë˜ìŠ¤ë¡œ ìŠ¹ê²©. âœ…</li>
</ul>

<hr />

<h2 id="ì–¸ì œ-í‘œì¤€ë§Œìœ¼ë¡œ-ì¶©ë¶„í•˜ê³ -ì–¸ì œ-ë˜í¼ê°€-í•„ìš”í•œê°€">ì–¸ì œ í‘œì¤€ë§Œìœ¼ë¡œ ì¶©ë¶„í•˜ê³ , ì–¸ì œ ë˜í¼ê°€ í•„ìš”í•œê°€</h2>

<ul>
  <li>
    <p><strong>ì¶©ë¶„í•œ ê²½ìš°:</strong> ë‹¨ìˆœ ì½ê¸°/ì“°ê¸° + í¬ë§·í„°(ì˜ˆ: pre-commit í›…ìœ¼ë¡œ trailing space ì œê±°, EOF newline ê°•ì œ). ë³€í™˜ ê¸°ë¡/ë·° ì¼ê´€ì„±ì´ í¬ê²Œ ì¤‘ìš”ì¹˜ ì•Šì„ ë•Œ.</p>
  </li>
  <li>
    <p><strong>ë˜í¼ í•„ìš”:</strong></p>

    <ul>
      <li>
        <p>ë¼ìš´ë“œíŠ¸ë¦½ ì •í™•ë„(ì›ë³¸ ê°œí–‰ ì •ì±… ìœ ì§€)ê°€ ì¤‘ìš”</p>
      </li>
      <li>
        <p>ì½”ë“œë² ì´ìŠ¤ì—ì„œ â€œë¬¸ìì—´/lines í˜¼ìš©â€ì„ ê¸ˆì§€í•˜ê³  <strong>í•œ APIë¡œ í†µì¼</strong> í•˜ê³  ì‹¶ì„ ë•Œ</p>
      </li>
      <li>
        <p>ì „/í›„ì²˜ë¦¬ë¥¼ <strong>íŒŒì´í”„ë¼ì¸ + íˆìŠ¤í† ë¦¬</strong> ë¡œ ê´€ë¦¬í•˜ê³  ì‹¶ì„ ë•Œ</p>
      </li>
    </ul>
  </li>
</ul>

<p><em>ê²€ì¦:</em> ìš°ë¦¬ ìš”êµ¬ì‚¬í•­(ì¼ê´€ì„±Â·í™•ì¥ì„±Â·ë¼ìš´ë“œíŠ¸ë¦½) ê¸°ì¤€ìœ¼ë¡œëŠ” ë˜í¼ê°€ ë§ìŒ. âœ…</p>

<hr />

<h2 id="ì°¸ê³ ì„œë“œíŒŒí‹°-ì¡°í•©-ì•„ì´ë””ì–´">ì°¸ê³ (ì„œë“œíŒŒí‹° ì¡°í•© ì•„ì´ë””ì–´)</h2>

<ul>
  <li>
    <p><strong>pre-commit / pre-commit-hooks</strong> : <code class="language-plaintext highlighter-rouge">end-of-file-fixer</code>, <code class="language-plaintext highlighter-rouge">trailing-whitespace</code>, <code class="language-plaintext highlighter-rouge">mixed-line-ending</code> ë“±ìœ¼ë¡œ ì €ì¥ì†Œ ìˆ˜ì¤€ ìœ„ìƒ ê´€ë¦¬.<br />
<em>ì—­í•  ë³´ì™„:</em> íŒŒì´í”„ë¼ì¸ ì¼ë¶€ë¥¼ CIë¡œ ë°€ì–´ë‚´ ì¼ê´€ì„± ê°•í™”. âœ…</p>
  </li>
  <li>
    <p><strong>difflib / unidiff</strong> : ë³€í™˜ ê²°ê³¼ë¥¼ ë¦¬ë·°í•˜ê¸° ì‰¬ìš´ íŒ¨ì¹˜ë¡œ ì œì‹œ.<br />
<em>ì—­í•  ë³´ì™„:</em> íŒ€ ë¦¬ë·° ê²½í—˜ ê°œì„ . âœ…</p>
  </li>
</ul>

<hr />

<h3 id="ì •ë¦¬">ì •ë¦¬</h3>

<ul>
  <li>
    <p>â€œê·¸ ì¼ì„ ì „ë¶€ í•˜ëŠ”â€ ìœ ëª… ë‚´ì¥/í´ë˜ìŠ¤ëŠ” ì—†ìŒ.</p>
  </li>
  <li>
    <p>í‘œì¤€ ë„êµ¬(íŠ¹íˆ <code class="language-plaintext highlighter-rouge">open/newline</code>, <code class="language-plaintext highlighter-rouge">Path.write_text(newline=...)</code>)ëŠ” <strong>ì¶œë ¥ ì •ì±… ê°•ì œ</strong> ì—ëŠ” ì¶©ë¶„í•˜ë‚˜, <strong>ì›ë³¸ ê°œí–‰ ì¶”ì /ì¼ê´€ ë·°/íˆìŠ¤í† ë¦¬</strong> ëŠ” ì»¤ë²„í•˜ì§€ ëª»í•¨.</p>
  </li>
  <li>
    <p>íŒ€ ì°¨ì›ì˜ ì¼ê´€ì„±ê³¼ í™•ì¥ì„±ì„ ì›í•˜ë©´, ì§€ê¸ˆ ì„¤ê³„í•œ <strong>ì–‡ì€ ë²”ìš© ë˜í¼</strong>(ë˜ëŠ” ìœ„ì˜ <strong>í•¨ìˆ˜ 3ê°œ + ê·œì¹™</strong>)ê°€ ê°€ì¥ ì•ˆì „í•©ë‹ˆë‹¤.</p>
  </li>
</ul>

<p class="chat--user">

@classmethod def from_file(cls, path: Path | str, *, profile: TextProfile = TextProfile(), encoding: str = "utf-8") -&gt; "TextBuffer": p = Path(path) text = p.read_text(encoding=encoding) return cls(text, profile=profile, encoding=encoding, source_path=p) ì—¬ê¸° ì¤‘ê°„ì— ìˆëŠ” * ì€ ë­ì•¼? ì´ëŸ° ë¬¸ë²• ì²˜ìŒë´

</p>

<p>ì§§ê²Œ ì²´í¬ë¦¬ìŠ¤íŠ¸:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">*</code> ëŠ” <strong>í‚¤ì›Œë“œ ì „ìš©(Keyword-only) ì¸ì êµ¬ë¶„ì</strong> ì˜ˆìš”.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">*</code> ë’¤ì— ë‚˜ì˜¤ëŠ” íŒŒë¼ë¯¸í„°ëŠ” <strong>ë°˜ë“œì‹œ<code class="language-plaintext highlighter-rouge">name=value</code> í˜•íƒœë¡œ</strong> í˜¸ì¶œí•´ì•¼ í•´ìš”.</p>
  </li>
  <li>
    <p>ëª©ì : <strong>ê°€ë…ì„±â†‘</strong> , <strong>ì‹¤ìˆ˜ ë°©ì§€</strong>(ìˆœì„œ ì°©ê°), <strong>API í™•ì¥ì„±</strong>(ìƒˆ ì˜µì…˜ ì¶”ê°€í•´ë„ ì•ˆì „).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">*</code> ìì²´ëŠ” <code class="language-plaintext highlighter-rouge">*args</code>ì™€ ë‹¤ë¦…ë‹ˆë‹¤(ìˆ˜ì§‘ ì•„ë‹˜, <strong>êµ¬ë¶„ì</strong> ì¼ ë¿).</p>
  </li>
</ul>

<hr />

<h3 id="í•œ-ì¤„-ìš”ì•½">í•œ ì¤„ ìš”ì•½</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(),</span>
              <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
</code></pre></div></div>

<p>ì—¬ê¸° ê°€ìš´ë° <code class="language-plaintext highlighter-rouge">*</code> ë•Œë¬¸ì— <code class="language-plaintext highlighter-rouge">profile</code>ê³¼ <code class="language-plaintext highlighter-rouge">encoding</code>ì€ <strong>í‚¤ì›Œë“œë¡œë§Œ</strong> ë„˜ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>âœ… ì˜¬ë°”ë¥¸ í˜¸ì¶œ:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TextBuffer</span><span class="p">.</span><span class="nf">from_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># ê¸°ë³¸ê°’ ì‚¬ìš©
</span><span class="n">TextBuffer</span><span class="p">.</span><span class="nf">from_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>
<span class="n">TextBuffer</span><span class="p">.</span><span class="nf">from_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-16</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>âŒ ì˜ëª»ëœ í˜¸ì¶œ(ìˆœì„œë¡œ ë„˜ê¹€):
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TextBuffer</span><span class="p">.</span><span class="nf">from_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">,</span> <span class="n">VERILOG</span><span class="p">)</span>
<span class="c1"># TypeError: ... takes 2 positional arguments but 3 were given
</span></code></pre></div>    </div>
  </li>
</ul>

<hr />

<h3 id="ì™œ-ì“°ë‚˜ìš”-step-by-step-ì‚¬ê³ ">ì™œ ì“°ë‚˜ìš”? (step-by-step ì‚¬ê³ )</h3>

<ol>
  <li>
    <p><strong>ì˜ë¯¸ê°€ ë¶„ëª…í•´ì§‘ë‹ˆë‹¤.</strong><br />
<code class="language-plaintext highlighter-rouge">profile=VERILOG</code> ì²˜ëŸ¼ ì´ë¦„ì´ ë³´ì´ë‹ˆ, ì¸ì ì˜ë¯¸ë¥¼ í—·ê°ˆë¦´ ì¼ì´ ì¤„ì–´ìš”.<br />
â†’ í”„ë¡œì íŠ¸ <strong>ì¼ê´€ì„±</strong> ëª©í‘œì— ë¶€í•©. âœ…</p>
  </li>
  <li>
    <p><strong>íŒŒë¼ë¯¸í„° ìˆœì„œ ë³€ê²½ì— ê°•í•©ë‹ˆë‹¤.</strong><br />
ë‚˜ì¤‘ì— ì˜µì…˜ì„ ë” ì¶”ê°€í•´ë„ ê¸°ì¡´ í˜¸ì¶œë¶€ëŠ” <code class="language-plaintext highlighter-rouge">name=value</code>ë¼ <strong>ê¹¨ì§€ì§€ ì•ŠìŒ</strong>.<br />
â†’ API <strong>í™•ì¥ì„±</strong> ëª©í‘œì— ë¶€í•©. âœ…</p>
  </li>
  <li>
    <p><strong>ì‹¤ìˆ˜ ë°©ì§€.</strong><br />
<code class="language-plaintext highlighter-rouge">profile</code>ê³¼ <code class="language-plaintext highlighter-rouge">encoding</code>ì„ ìˆœì„œë¡œ ë°”ê¿” ë„£ëŠ” ì‹¤ìˆ˜ë¥¼ ì°¨ë‹¨. âœ…</p>
  </li>
</ol>

<hr />

<h3 id="-ì™€-args-ì˜-ì°¨ì´"><code class="language-plaintext highlighter-rouge">*</code> ì™€ <code class="language-plaintext highlighter-rouge">*args</code> ì˜ ì°¨ì´</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">*</code> (ë‹¨ë…): <strong>êµ¬ë¶„ì</strong>. ë’¤ì˜ ì¸ìë“¤ì„ <strong>í‚¤ì›Œë“œ ì „ìš©</strong> ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">*args</code>: ë‚¨ëŠ” ìœ„ì¹˜ ì¸ìë“¤ì„ <strong>íŠœí”Œë¡œ ìˆ˜ì§‘</strong> í•©ë‹ˆë‹¤. (ìˆ˜ì§‘ + êµ¬ë¶„ì ì—­í•  ëª¨ë‘)</p>
  </li>
</ul>

<p>ì˜ˆ:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>         <span class="c1"># b, cëŠ” í‚¤ì›Œë“œ-only
</span>    <span class="bp">...</span>

<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="c1"># aëŠ” ìœ„ì¹˜, argsëŠ” ì¶”ê°€ ìœ„ì¹˜ë“¤ ìˆ˜ì§‘, bëŠ” í‚¤ì›Œë“œ-only
</span>    <span class="bp">...</span>
</code></pre></div></div>

<hr />

<h3 id="ë³´ë„ˆìŠ¤--positional-only-ë„-ìˆì–´ìš”">ë³´ë„ˆìŠ¤: <code class="language-plaintext highlighter-rouge">/</code> (positional-only) ë„ ìˆì–´ìš”</h3>

<p>Python 3.8+ ë¶€í„°ëŠ” <code class="language-plaintext highlighter-rouge">/</code> ë¡œ <strong>ìœ„ì¹˜ ì „ìš©</strong> ì¸ìë¥¼ ê°•ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>  <span class="c1"># a: ìœ„ì¹˜-only, b: ë‘˜ ë‹¤ ê°€ëŠ¥, c: í‚¤ì›Œë“œ-only
</span>    <span class="bp">...</span>
</code></pre></div></div>

<hr />

<h3 id="íƒ€ì…-íŒíŠ¸-ê´€ë ¨">íƒ€ì… íŒíŠ¸ ê´€ë ¨</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Path | str</code> ëŠ” <strong>Python 3.10+</strong> ì˜ Union ì•½ì‹ ë¬¸ë²•ì…ë‹ˆë‹¤(ì´ì „ ë²„ì „ì€ <code class="language-plaintext highlighter-rouge">Union[Path, str]</code>).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">TextProfile()</code> ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë‘ë©´ <strong>ì •ì˜ ì‹œì ì—</strong> í•œ ë²ˆ ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.<br />
ì—¬ê¸°ì„œëŠ” <code class="language-plaintext highlighter-rouge">@dataclass(frozen=True)</code>ë¼ <strong>ë¶ˆë³€</strong> ì´ë¯€ë¡œ ì•ˆì „í•˜ì§€ë§Œ,<br />
ì¼ë°˜ì ìœ¼ë¡œëŠ” <code class="language-plaintext highlighter-rouge">None</code> ê¸°ë³¸ê°’ + í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ìƒì„±í•˜ëŠ” íŒ¨í„´ë„ ê³ ë ¤í•˜ì„¸ìš”.</p>
  </li>
</ul>

<hr />

<p>í•„ìš”í•˜ë©´, íŒ€ ê·œì¹™ìœ¼ë¡œ â€œì˜µì…˜ ì¸ìëŠ” ëª¨ë‘ <code class="language-plaintext highlighter-rouge">*</code> ë’¤ì— ë°°ì¹˜â€ë¥¼ ì •í•´ë‘ë©´ í˜¸ì¶œë¶€ê°€ í•­ìƒ <code class="language-plaintext highlighter-rouge">name=value</code>ë¼ ê¹”ë”í•˜ê³ , ì¥ê¸° ìœ ì§€ë³´ìˆ˜ì— ìœ ë¦¬í•©ë‹ˆë‹¤.</p>

<p class="chat--user">

__slots__ëŠ” ë­ì•¼?

</p>

<p>ì§§ì€ ì²´í¬ë¦¬ìŠ¤íŠ¸(ê°œë…):</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">__slots__</code>ëŠ” <strong>ì¸ìŠ¤í„´ìŠ¤ê°€ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ì†ì„± ì´ë¦„ë“¤ì„ ê³ ì •</strong> í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ë‹¤.</p>
  </li>
  <li>
    <p>íš¨ê³¼: <strong>ë©”ëª¨ë¦¬ ì ˆê°</strong> , <strong>ì†ì„± ì ‘ê·¼ ì†Œí­ ë¹ ë¦„</strong> , <strong>ì˜¤íƒ€/ì„ì˜ ì†ì„± ì¶”ê°€ ë°©ì§€</strong>.</p>
  </li>
  <li>
    <p>ì„ ì–¸: <code class="language-plaintext highlighter-rouge">class C: __slots__ = ('a', 'b')</code> ì²˜ëŸ¼ <strong>íŠœí”Œ/ë¦¬ìŠ¤íŠ¸/ì´í„°ëŸ¬ë¸”</strong> ì— ì´ë¦„ì„ ë‚˜ì—´.</p>
  </li>
  <li>
    <p>ì£¼ì˜: <strong>ë™ì  ì†ì„± ì¶”ê°€ ë¶ˆê°€</strong> , ìƒì†/ë””í´íŠ¸/<code class="language-plaintext highlighter-rouge">__dict__</code>/<code class="language-plaintext highlighter-rouge">__weakref__</code> ì²˜ë¦¬ì— ì‹ ê²½.</p>
  </li>
  <li>
    <p>ê¶Œì¥ ì‚¬ìš©: <strong>ì¸ìŠ¤í„´ìŠ¤ê°€ ì•„ì£¼ ë§ê³  í•„ë“œ ìŠ¤í‚¤ë§ˆê°€ ê³ ì •</strong> ëœ í´ë˜ìŠ¤.</p>
  </li>
</ul>

<hr />

<h1 id="í•œ-ì¤„-ì •ì˜">í•œ ì¤„ ì •ì˜</h1>

<p><code class="language-plaintext highlighter-rouge">__slots__</code>ë¥¼ ì •ì˜í•˜ë©´ í•´ë‹¹ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ëŠ” <strong>per-instance<code class="language-plaintext highlighter-rouge">__dict__</code>ë¥¼ ë§Œë“¤ì§€ ì•Šê³ </strong>, ë¯¸ë¦¬ ì •í•´ë‘” ìŠ¬ë¡¯(ê³ ì • í•„ë“œ)ë§Œ ë©”ëª¨ë¦¬ì— <strong>compact</strong> í•˜ê²Œ ì €ì¥í•œë‹¤.</p>

<hr />

<h2 id="ì™œ-ì“°ë‚˜-step-by-step">ì™œ ì“°ë‚˜ (step-by-step)</h2>

<ol>
  <li>
    <p><strong>ë©”ëª¨ë¦¬ ì ˆê°</strong> : <code class="language-plaintext highlighter-rouge">__dict__</code>(í•´ì‹œë§µ) ëŒ€ì‹  <strong>ìŠ¬ë¡¯ ë°°ì—´</strong> ì„ ì¨ì„œ ì¸ìŠ¤í„´ìŠ¤ë‹¹ ìˆ˜ì‹­ ë°”ì´íŠ¸~ìˆ˜ë°± ë°”ì´íŠ¸ë¥¼ ì•„ë‚€ë‹¤(í•„ë“œ ìˆ˜/íŒŒì´ì¬ êµ¬í˜„ì— ë”°ë¼ ìƒì´). ëŒ€ëŸ‰ ê°ì²´(ì˜ˆ: ìˆ˜ì‹­ë§Œ ê°œ)ì—ì„œ í° ì°¨ì´.</p>
  </li>
  <li>
    <p><strong>ì†ì„± ì ‘ê·¼ ë¹„ìš© ê°ì†Œ</strong> : í•´ì‹œ ì¡°íšŒê°€ ì•„ë‹Œ <strong>ì˜¤í”„ì…‹ ì ‘ê·¼</strong> ì´ë¼ ì•½ê°„ ë¹ ë¥´ë‹¤(ë¯¸ì„¸í•˜ì§€ë§Œ ëˆ„ì ë˜ë©´ ì˜ë¯¸).</p>
  </li>
  <li>
    <p><strong>API ì•ˆì „ì„±</strong> : ì„ ì–¸ë˜ì§€ ì•Šì€ ì†ì„±ì€ ì„¤ì • ìì²´ê°€ ì—ëŸ¬ â†’ <strong>ì˜¤íƒ€/ì„ì˜ í•„ë“œ</strong> ë°©ì§€.</p>
  </li>
</ol>

<hr />

<h2 id="ì–´ë–»ê²Œ-ì“°ë‚˜">ì–´ë–»ê²Œ ì“°ë‚˜</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">next</span><span class="sh">'</span><span class="p">)</span>  <span class="c1"># ì¸ìŠ¤í„´ìŠ¤ í•„ë“œ ìŠ¤í‚¤ë§ˆ ê³ ì •
</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">next</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>   <span class="c1"># OK
</span>        <span class="n">self</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="nb">next</span>     <span class="c1"># OK
</span>
<span class="n">n</span> <span class="o">=</span> <span class="nc">Node</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">n</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span>      <span class="c1"># OK
</span><span class="n">n</span><span class="p">.</span><span class="n">other</span> <span class="o">=</span> <span class="mi">3</span>      <span class="c1"># AttributeError: 'Node' object has no attribute 'other'
</span></code></pre></div></div>

<ul>
  <li>
    <p><strong>ë””í´íŠ¸ê°’</strong> ì€ ë³´í†µ <code class="language-plaintext highlighter-rouge">__init__</code>ì—ì„œ ì±„ìš´ë‹¤.</p>
  </li>
  <li>
    <p>í´ë˜ìŠ¤ ì†ì„±ìœ¼ë¡œ ê¸°ë³¸ê°’ì„ ì£¼ê³  ì‹¶ë‹¤ë©´:</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ì˜ ì´ˆê¸° ì½ê¸°ëŠ” 10ìœ¼ë¡œ ë³´ì´ì§€ë§Œ,
</span>            <span class="c1"># ì¸ìŠ¤í„´ìŠ¤ì— aë¥¼ ì„¤ì •í•˜ë©´ ì¸ìŠ¤í„´ìŠ¤ ìŠ¬ë¡¯ ê°’ì´ ìš°ì„ í•œë‹¤.
</span></code></pre></div>    </div>
  </li>
</ul>

<hr />

<h2 id="ìì£¼-ë¶€ë”ªíˆëŠ”-í¬ì¸íŠ¸-ê¼­-ì•Œì•„ë‘˜-ê²ƒ">ìì£¼ ë¶€ë”ªíˆëŠ” í¬ì¸íŠ¸ (ê¼­ ì•Œì•„ë‘˜ ê²ƒ)</h2>

<h3 id="1-__dict__--__weakref__ê°€-í•„ìš”í•˜ë©´">1) <code class="language-plaintext highlighter-rouge">__dict__</code> / <code class="language-plaintext highlighter-rouge">__weakref__</code>ê°€ í•„ìš”í•˜ë©´?</h3>

<ul>
  <li>
    <p>ê¸°ë³¸ì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">__slots__</code> í´ë˜ìŠ¤ì—ëŠ” <strong>ì¸ìŠ¤í„´ìŠ¤<code class="language-plaintext highlighter-rouge">__dict__</code>ê°€ ì—†ë‹¤</strong>.</p>
  </li>
  <li><strong>ì˜ˆì™¸ì ìœ¼ë¡œ</strong> ë™ì  ì†ì„±ì„ í—ˆìš©í•˜ê³  ì‹¶ë‹¤ë©´ ìŠ¬ë¡¯ì— <code class="language-plaintext highlighter-rouge">"__dict__"</code>ë¥¼ ëª…ì‹œ:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">__dict__</span><span class="sh">'</span><span class="p">)</span>  <span class="c1"># ìŠ¬ë¡¯ + ë™ì  ì†ì„± í—ˆìš©
</span></code></pre></div>    </div>
  </li>
  <li><code class="language-plaintext highlighter-rouge">weakref</code>ë¥¼ ì“°ë ¤ë©´ <code class="language-plaintext highlighter-rouge">"__weakref__"</code>ë„ í¬í•¨:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">__weakref__</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="2-ìƒì†">2) ìƒì†</h3>

<ul>
  <li>
    <p><strong>ìŠ¬ë¡¯ í´ë˜ìŠ¤ì˜ ì„œë¸Œí´ë˜ìŠ¤</strong> ê°€ <code class="language-plaintext highlighter-rouge">__slots__</code>ë¥¼ ì •ì˜í•˜ì§€ ì•Šìœ¼ë©´, ì„œë¸Œí´ë˜ìŠ¤ëŠ” <strong>ë‹¤ì‹œ<code class="language-plaintext highlighter-rouge">__dict__</code>ê°€ ìƒê¸´ë‹¤</strong>(ë™ì  ì†ì„± ê°€ëŠ¥).<br />
â†’ ê³„ì† ì œí•œí•˜ê³  ì‹¶ë‹¤ë©´ <strong>ì„œë¸Œí´ë˜ìŠ¤ì—ì„œë„<code class="language-plaintext highlighter-rouge">__slots__</code>ë¥¼ ì •ì˜</strong>í•´ì•¼ í•œë‹¤.</p>
  </li>
  <li>
    <p>ì„œë¸Œí´ë˜ìŠ¤ì—ì„œ <strong>ë¶€ëª¨ ìŠ¬ë¡¯ ì´ë¦„ì„ ë‹¤ì‹œ ì ì§€ ì•ŠëŠ”ë‹¤</strong>. ìƒˆë¡œ ì¶”ê°€í•˜ëŠ” ìŠ¬ë¡¯ë§Œ ë‚˜ì—´:</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,)</span>
    
<span class="k">class</span> <span class="nc">Child</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">,)</span>  <span class="c1"># 'a'ëŠ” ì´ë¯¸ Baseì— ìˆìœ¼ë¯€ë¡œ ì¤‘ë³µ ê¸°ì¬ X
</span></code></pre></div>    </div>
  </li>
</ul>

<h3 id="3-ë‹¤ì¤‘-ìƒì†">3) ë‹¤ì¤‘ ìƒì†</h3>

<ul>
  <li>
    <p>ë‹¤ì¤‘ ìƒì†ì—ì„œ <strong>ìŠ¬ë¡¯ì´ ì„œë¡œ ì¶©ëŒ</strong> í•˜ë©´ ì—ëŸ¬ê°€ ë‚  ìˆ˜ ìˆë‹¤.</p>
  </li>
  <li>
    <p>ì‹¤ë¬´ íŒ: ë‹¤ì¤‘ ìƒì†ì„ ìµœì†Œí™”í•˜ê±°ë‚˜, <strong>í•œìª½ë§Œ ìŠ¬ë¡¯</strong> ì„ ì“°ê³  ë‹¤ë¥¸ ìª½ì€ ë°ì´í„° ì—†ëŠ” ë¯¹ìŠ¤ì¸ìœ¼ë¡œ ì„¤ê³„.</p>
  </li>
</ul>

<h3 id="4-dataclassì™€ì˜-ê²°í•©">4) dataclassì™€ì˜ ê²°í•©</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">@dataclass(slots=True)</code>(Py3.10+)ë¥¼ ì“°ë©´ <strong>ìë™ìœ¼ë¡œ<code class="language-plaintext highlighter-rouge">__slots__</code>ê°€ ìƒì„±</strong>ëœë‹¤.</p>
  </li>
  <li>
    <p>ì´ë¯¸ ìˆ˜ë™ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">__slots__</code>ë¥¼ ì •ì˜í–ˆë‹¤ë©´, <code class="language-plaintext highlighter-rouge">slots=True</code>ë¥¼ <strong>ì¤‘ë³µìœ¼ë¡œ ì“°ì§€ ì•ŠëŠ”ë‹¤</strong>(ì¶©ëŒ/ì¤‘ë³µ ì •ì˜ ì£¼ì˜).</p>
  </li>
</ul>

<h3 id="5-pickle--ì§ë ¬í™”">5) pickle / ì§ë ¬í™”</h3>

<ul>
  <li>
    <p>ë§ì€ ê²½ìš° <strong>ì˜ ì‘ë™</strong> í•˜ì§€ë§Œ, ì–´ë–¤ í”„ë ˆì„ì›Œí¬ëŠ” <code class="language-plaintext highlighter-rouge">__dict__</code>ë¥¼ ê¸°ëŒ€í•œë‹¤.</p>
  </li>
  <li>
    <p>ì»¤ìŠ¤í…€ ì§ë ¬í™” í•„ìš”í•˜ë©´ <code class="language-plaintext highlighter-rouge">__getstate__/__setstate__</code>ë¥¼ êµ¬í˜„í•´ <strong>ìŠ¬ë¡¯ ê°’ë“¤ì„ ë”•íŠ¸ë¡œ ë³€í™˜</strong> í•˜ëŠ” ë°©ì‹ ì‚¬ìš©.</p>
  </li>
</ul>

<h3 id="6-í”„ë¡œíŒŒì¼ë§ë””ë²„ê¹…-ë„êµ¬">6) í”„ë¡œíŒŒì¼ë§/ë””ë²„ê¹… ë„êµ¬</h3>

<ul>
  <li>
    <p>ì¼ë¶€ ë„êµ¬ê°€ <code class="language-plaintext highlighter-rouge">obj.__dict__</code>ë¥¼ ë°”ë¡œ í¼ì¹˜ë ¤ë‹¤ ë‹¹í™©í•  ìˆ˜ ìˆë‹¤.</p>
  </li>
  <li>
    <p>ì´ëŸ° ë„êµ¬ë¥¼ ì“°ë©´ <code class="language-plaintext highlighter-rouge">"__dict__"</code> ìŠ¬ë¡¯ì„ ì¶”ê°€í•˜ê±°ë‚˜, ë³´ì¡° ë©”ì„œë“œ(ì˜ˆ: <code class="language-plaintext highlighter-rouge">to_dict()</code>) ì œê³µ.</p>
  </li>
</ul>

<hr />

<h2 id="ì–¸ì œ-ì“°ë©´-ì¢‹ì€ê°€--í”¼í•´ì•¼-í•˜ëŠ”ê°€">ì–¸ì œ ì“°ë©´ ì¢‹ì€ê°€ / í”¼í•´ì•¼ í•˜ëŠ”ê°€</h2>

<p><strong>ì í•©</strong></p>

<ul>
  <li>
    <p>ì¸ìŠ¤í„´ìŠ¤ê°€ <strong>ì—„ì²­ ë§ë‹¤</strong> (e.g., íŒŒì„œ í† í°, AST ë…¸ë“œ, ë¡œê·¸ ë ˆì½”ë“œ ë“±).</p>
  </li>
  <li>
    <p>ì†ì„± ìŠ¤í‚¤ë§ˆê°€ <strong>ë³€í•˜ì§€ ì•ŠëŠ”ë‹¤</strong>.</p>
  </li>
  <li>
    <p>ë¼ì´ë¸ŒëŸ¬ë¦¬/ì½”ì–´ ë ˆì´ì–´ì—ì„œ <strong>API ì•ˆì •ì„±</strong> ê³¼ <strong>ë©”ëª¨ë¦¬ íš¨ìœ¨</strong> ì´ ì¤‘ìš”í•˜ë‹¤.</p>
  </li>
</ul>

<p><strong>ë¶€ì í•©</strong></p>

<ul>
  <li>
    <p>ë™ì ìœ¼ë¡œ ì†ì„±ì„ ë¶™ì˜€ë‹¤ ë—ë‹¤ í•´ì•¼ í•œë‹¤.</p>
  </li>
  <li>
    <p>ë””ë²„ê¹…/ê´€ì°° ë„êµ¬ê°€ <code class="language-plaintext highlighter-rouge">__dict__</code>ì— ê°•í•˜ê²Œ ì˜ì¡´í•œë‹¤.</p>
  </li>
  <li>
    <p>ë‹¤ì¤‘ ìƒì† êµ¬ì¡°ê°€ ë³µì¡í•˜ë‹¤(ì¶©ëŒ ìœ„í—˜).</p>
  </li>
</ul>

<hr />

<h2 id="ì—¬ëŸ¬ë¶„-ì½”ë“œë² ì´ìŠ¤-ê´€ì ë¹ ë¥¸-ì…€í”„-ì²´í¬">ì—¬ëŸ¬ë¶„ ì½”ë“œë² ì´ìŠ¤ ê´€ì (ë¹ ë¥¸ ì…€í”„ ì²´í¬)</h2>

<ul>
  <li>
    <p>í…ìŠ¤íŠ¸ ë²„í¼/ì†ŒìŠ¤ ì»¨í…Œì´ë„ˆì²˜ëŸ¼ <strong>í•„ë“œê°€ ê³ ì •</strong> ë˜ê³ , <strong>ë§ì€ ì¸ìŠ¤í„´ìŠ¤</strong> ë¥¼ ë§Œë“¤ ê°€ëŠ¥ì„±ì´ ìˆë‹¤ë©´ <code class="language-plaintext highlighter-rouge">__slots__</code>ëŠ” <strong>ì¼ê´€ì„±/ì„±ëŠ¥</strong> ëª©í‘œì— ë¶€í•©í•©ë‹ˆë‹¤. âœ…</p>
  </li>
  <li>
    <p>ë‹¨, ë³€í™˜ íŒŒì´í”„ë¼ì¸/ë©”íƒ€ í™•ì¥ì´ ì¦ê³  <strong>ë™ì  í•„ë“œ ì¶”ê°€ ê°€ëŠ¥ì„±</strong> ì´ ìˆë‹¤ë©´, <code class="language-plaintext highlighter-rouge">__slots__</code> ëŒ€ì‹  ì¼ë°˜ í´ë˜ìŠ¤(ë˜ëŠ” <code class="language-plaintext highlighter-rouge">__slots__</code>ì— <code class="language-plaintext highlighter-rouge">"__dict__"</code> í¬í•¨)ë¡œ <strong>ìœ ì—°ì„±</strong> ì„ ë‚¨ê¸°ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤. âœ…</p>
  </li>
</ul>

<hr />

<h2 id="ë¯¸ë‹ˆ-ì˜ˆì‹œ-dataclass--slots">ë¯¸ë‹ˆ ì˜ˆì‹œ: dataclass + slots</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">slots</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># Py3.10+
</span><span class="k">class</span> <span class="nc">Token</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">col</span><span class="p">:</span> <span class="nb">int</span>
</code></pre></div></div>

<ul>
  <li>ë©”ëª¨ë¦¬ ì ˆê° + ì˜¤íƒ€ ë°©ì§€ + ëª…í™•í•œ ìŠ¤í‚¤ë§ˆë¥¼ í•œ ë²ˆì— í™•ë³´.</li>
</ul>

<p>í•„ìš”í•˜ë©´, í˜„ì¬ ì„¤ê³„í•œ <code class="language-plaintext highlighter-rouge">TextBuffer</code>/<code class="language-plaintext highlighter-rouge">VerilogSource</code>ì— <code class="language-plaintext highlighter-rouge">__slots__</code>ë¥¼ ì ìš©í•  ë•Œì˜ <strong>í•„ë“œ ëª©ë¡/ìƒì† ì „ëµ</strong> ì„ ë°”ë¡œ ì œì•ˆí•´ ë“œë¦´ê²Œìš”.</p>

<p class="chat--user">

ê·¸ëƒ¥ íƒ€ì… íŒë³„í•´ì„œ ìë™ìœ¼ë¡œ ë§Œë“¤ê²Œ í•˜ëŠ” ë°©ì‹ ì–´ë•Œ from_lines, from_string, from_textbuffer êµ¬ë³„í•˜ê¸°ê°€ ì¢€ ê·€ì°®ì€ë°, isinstance ê°™ì€ê±¸ë¡œ ë¹„êµí•´ì„œ ìë™ìœ¼ë¡œ ë§Œë“¤ê²Œ í•˜ëŠ”ê±°ì§€(from_fileì€ ë³„ê°œë¡œ), ê¸°ì¡´ í•¨ìˆ˜ë„ ë‘ê³  

</p>

<p>ì¢‹ì•„ìš”â€”â€œíƒ€ì…ì— ë”°ë¼ ìë™ ìƒì„±â€ì„ ë„£ëŠ” ê±´ í¸ì˜ì„±ì— ê½¤ ìœ ìš©í•©ë‹ˆë‹¤. ë‹¤ë§Œ <strong>ì˜ˆì¸¡ ê°€ëŠ¥ì„±</strong> ì„ í•´ì¹˜ì§€ ì•Šë„ë¡ ê·œì¹™ì„ ëª…í™•íˆ ë‘ë©´ ì¢‹ì•„ìš”.</p>

<h3 id="ì²´í¬ë¦¬ìŠ¤íŠ¸ê°œë…">ì²´í¬ë¦¬ìŠ¤íŠ¸(ê°œë…)</h3>

<ul>
  <li>
    <p>ë‹¨ì¼ ì§„ì…ì  <code class="language-plaintext highlighter-rouge">coerce(...)</code>ë¡œ <strong>ë¬¸ìì—´/ì¤„ ë¦¬ìŠ¤íŠ¸/TextBuffer</strong> ë¥¼ ì•Œì•„ì„œ ìˆ˜ìš©</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">from_*</code>ë“¤ì€ <strong>ê·¸ëŒ€ë¡œ ìœ ì§€</strong>(ëª…ì‹œì  ê²½ë¡œê°€ í•„ìš”í•œ ê³³ì—ì„œ ì‚¬ìš©)</p>
  </li>
  <li>
    <p><strong>ëª¨í˜¸ì„± ê·œì¹™</strong> ê³ ì •: <code class="language-plaintext highlighter-rouge">keepends</code> ê¸°ë³¸ ë™ì‘ê³¼ íŒë³„ ê¸°ì¤€ì„ ë¬¸ì„œí™”</p>
  </li>
  <li>
    <p>ì œ3ì íƒ€ì…ì€ <strong>í”„ë¡œí† ì½œ/ì–´ëŒ‘í„°</strong> ë¡œ í™•ì¥ ê°€ëŠ¥í•˜ê²Œ ì„¤ê³„</p>
  </li>
  <li>
    <p>ì˜ëª»ëœ íƒ€ì…ì€ <strong>ëª…í™•í•œ ì˜¤ë¥˜</strong> ë¡œ ê±°ì ˆ</p>
  </li>
</ul>

<hr />

<h2 id="ì„¤ê³„-ê²°ë¡ --ë¹ ë¥¸-ê²€ì¦">ì„¤ê³„ ê²°ë¡  &amp; ë¹ ë¥¸ ê²€ì¦</h2>

<ol>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">TextBuffer.coerce(obj, ...)</code> ì¶”ê°€</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">TextBuffer</code> â†’ ê·¸ëŒ€ë¡œ ë°˜í™˜</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">str</code> â†’ <code class="language-plaintext highlighter-rouge">from_string</code></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">list/tuple/Iterable[str]</code> â†’ <code class="language-plaintext highlighter-rouge">from_lines</code> (í•„ìš” ì‹œ materialize)</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> í˜¸ì¶œë¶€ ë‹¨ìˆœí™”(âœ…), ê¸°ì¡´ ëª…ì‹œ APIì™€ ê³µì¡´(âœ…).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">keepends</code> ê¸°ë³¸ ì •ì±…</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">keepends=None</code>(ê¸°ë³¸): <strong>í•œ ì¤„ì´ë¼ë„<code class="language-plaintext highlighter-rouge">\n</code>/<code class="language-plaintext highlighter-rouge">\r</code>ê°€ í¬í•¨ë˜ë©´</strong> <code class="language-plaintext highlighter-rouge">keepends=True</code>ë¡œ ê°„ì£¼, ì•„ë‹ˆë©´ <code class="language-plaintext highlighter-rouge">False</code>.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">keepends</code>ë¥¼ ëª…ì‹œí•˜ë©´ ê·¸ ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> íœ´ë¦¬ìŠ¤í‹± ìµœì†Œí™” + ê²°ì •ì (âœ…). ê³¼ë„í•œ â€œì¶”ì¸¡â€ì€ í”¼í•¨(ì…€í”„ ì½”ë ‰íŠ¸).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ê²½ê³„ ëª…í™•í™”</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">Path/bytes</code>ëŠ” <strong>ì—¬ê¸°ì„œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ</strong>. íŒŒì¼ I/OëŠ” <code class="language-plaintext highlighter-rouge">from_file</code>ë¡œë§Œ.</p>
      </li>
      <li>
        <p><em>ê²€ì¦:</em> I/O ì‚¬ì´ë“œì´í™íŠ¸ ê¸ˆì§€ë¡œ ì¼ê´€ì„± ìœ ì§€(âœ…).</p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="ì½”ë“œ-ì¶”ê°€-ê¸°ì¡´-textbufferì—-ë¶™ì¼-ë©”ì„œë“œ">ì½”ë“œ ì¶”ê°€ (ê¸°ì¡´ <code class="language-plaintext highlighter-rouge">TextBuffer</code>ì— ë¶™ì¼ ë©”ì„œë“œ)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Sequence</span>

<span class="k">class</span> <span class="nc">TextBuffer</span><span class="p">:</span>
    <span class="c1"># ... ê¸°ì¡´ ì½”ë“œ ...
</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">coerce</span><span class="p">(</span>
        <span class="n">cls</span><span class="p">,</span>
        <span class="n">obj</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(),</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        ë‹¤ì–‘í•œ ì…ë ¥(obj)ì„ TextBufferë¡œ í‘œì¤€í™”.
        - TextBuffer: ê·¸ëŒ€ë¡œ ë°˜í™˜
        - str: from_string
        - Iterable[str]: from_lines (í•„ìš” ì‹œ keepends ì¶”ì •)
        - (ì£¼ì˜) Path/bytesëŠ” ì—¬ê¸°ì„œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ â†’ from_file / decode ê²½ë¡œ ì‚¬ìš©
        </span><span class="sh">"""</span>
        <span class="c1"># 1) ì´ë¯¸ TextBufferì¸ ê²½ìš°
</span>        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">TextBuffer</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span>

        <span class="c1"># 2) ë¬¸ìì—´
</span>        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="nf">from_string</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

        <span class="c1"># 3) ë¬¸ìì—´ ì´í„°ëŸ¬ë¸”(ë¦¬ìŠ¤íŠ¸/íŠœí”Œ/ì œë„ˆë ˆì´í„° ë“±)
</span>        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="c1"># materialize (ì œë„ˆë ˆì´í„° ë³´í˜¸ ë° íƒ€ì… ê²€ì‚¬)
</span>            <span class="n">lines</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nf">all</span><span class="p">(</span><span class="nf">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">):</span>
                <span class="k">raise</span> <span class="nc">TypeError</span><span class="p">(</span><span class="sh">"</span><span class="s">Iterable must yield str values</span><span class="sh">"</span><span class="p">)</span>

            <span class="c1"># keepends ê·œì¹™: ëª…ì‹œê°’ ìš°ì„ , ì—†ìœ¼ë©´ ìë™ íŒë³„
</span>            <span class="n">ke</span> <span class="o">=</span> <span class="n">keepends</span> <span class="k">if</span> <span class="n">keepends</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">cls</span><span class="p">.</span><span class="nf">_guess_keepends</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="nf">from_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">keepends</span><span class="o">=</span><span class="n">ke</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

        <span class="c1"># 4) ê·¸ ì™¸ íƒ€ì…ì€ ëª…í™•íˆ ê±°ì ˆ
</span>        <span class="k">raise</span> <span class="nc">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="sh">"</span><span class="s">Cannot coerce type </span><span class="si">{</span><span class="nf">type</span><span class="p">(</span><span class="n">obj</span><span class="p">).</span><span class="n">__name__</span><span class="si">}</span><span class="s"> to TextBuffer. </span><span class="sh">"</span>
            <span class="sh">"</span><span class="s">Use from_file() for paths/files, or pass str/Iterable[str]/TextBuffer.</span><span class="sh">"</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_guess_keepends</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">í•œ ì¤„ì´ë¼ë„ ê°œí–‰ ë¬¸ìë¥¼ í¬í•¨í•˜ë©´ keepends=Trueë¡œ ê°„ì£¼.</span><span class="sh">"""</span>
        <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="nf">if </span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">ln</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="sh">"</span><span class="se">\r</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">ln</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>
</code></pre></div></div>

<p><strong>ê²€ì¦:</strong> ë‹¨ì¼ ì§„ì…ì ìœ¼ë¡œ í¸ì˜ì„±ì„ ì œê³µí•˜ë©´ì„œ, íŒŒì¼ I/OÂ·ë°”ì´íŠ¸ ì²˜ë¦¬ ë“± ì‚¬ì´ë“œì´í™íŠ¸ëŠ” ëª…ì‹œ APIë¡œ ë¶„ë¦¬ â†’ <strong>ì¼ê´€ì„±/í™•ì¥ì„±</strong> ëª©í‘œì— ë¶€í•©. âœ…</p>

<hr />

<h2 id="ì‚¬ìš©-ì˜ˆ">ì‚¬ìš© ì˜ˆ</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">buf1</span> <span class="o">=</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">coerce</span><span class="p">(</span><span class="sh">"</span><span class="s">module top;</span><span class="se">\n</span><span class="s">endmodule</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>
<span class="n">buf2</span> <span class="o">=</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">coerce</span><span class="p">([</span><span class="sh">"</span><span class="s">module top;</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">endmodule</span><span class="sh">"</span><span class="p">],</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>              <span class="c1"># keepends=False
</span><span class="n">buf3</span> <span class="o">=</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">coerce</span><span class="p">([</span><span class="sh">"</span><span class="s">module top;</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">endmodule</span><span class="se">\n</span><span class="sh">"</span><span class="p">],</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>          <span class="c1"># keepends=True (ìë™ íŒë³„)
</span><span class="n">buf4</span> <span class="o">=</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">coerce</span><span class="p">(</span><span class="n">existing_textbuffer</span><span class="p">)</span>                                        <span class="c1"># ê·¸ëŒ€ë¡œ
# íŒŒì¼ì€ ëª…ì‹œ API ì‚¬ìš©
</span><span class="n">buf5</span> <span class="o">=</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">from_file</span><span class="p">(</span><span class="sh">"</span><span class="s">rtl/top.v</span><span class="sh">"</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="í™•ì¥-ì•„ì´ë””ì–´í•„ìš”-ì‹œ">í™•ì¥ ì•„ì´ë””ì–´(í•„ìš” ì‹œ)</h2>

<ul>
  <li>
    <p><strong>ëª¨ë“ˆ ì „ì—­<code class="language-plaintext highlighter-rouge">ensure_textbuffer(obj, **opts)</code></strong> í•¨ìˆ˜ë¥¼ <code class="language-plaintext highlighter-rouge">functools.singledispatch</code>ë¡œ ì œê³µ(ë‚´ë¶€ì—ì„œ ìœ„ <code class="language-plaintext highlighter-rouge">coerce</code> í˜¸ì¶œ).</p>
  </li>
  <li>
    <p>ì™¸ë¶€ íƒ€ì… ì§€ì›: ê°ì²´ê°€ <code class="language-plaintext highlighter-rouge">to_textbuffer()</code>(ë˜ëŠ” <code class="language-plaintext highlighter-rouge">__textbuffer__()</code>)ë¥¼ êµ¬í˜„í–ˆë‹¤ë©´ ê·¸ê±¸ ìš°ì„  í˜¸ì¶œí•˜ëŠ” <strong>ì–´ëŒ‘í„° íŒ¨í„´</strong> í—ˆìš©.</p>
  </li>
</ul>

<hr />

<h3 id="ìµœì¢…-íŒë‹¨">ìµœì¢… íŒë‹¨</h3>

<ul>
  <li>
    <p>â€œìë™ ìƒì„±â€ì€ ìƒì‚°ì„±ì„ ì˜¬ë¦¬ë˜, <strong>ëª…ì‹œ APIë¥¼ ë‚¨ê²¨</strong> ê²½ê³„ë¥¼ ë¶„ëª…íˆ í•˜ëŠ” ì§€ê¸ˆ ë°©ì‹ì´ ê°€ì¥ ì•ˆì „í•©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>íœ´ë¦¬ìŠ¤í‹±ì€ ìµœì†Œí™”í–ˆê³ , í•„ìš” ì‹œ <code class="language-plaintext highlighter-rouge">keepends</code>ë¥¼ ëª…ì‹œí•˜ë©´ <strong>í•­ìƒ ìš°ì„ </strong> í•©ë‹ˆë‹¤.<br />
â†’ í”„ë¡œì íŠ¸ì˜ <strong>ì¼ê´€ì„±</strong>(ë†€ë¼ì›€ ìµœì†Œí™”)ê³¼ <strong>í™•ì¥ì„±</strong>(íƒ€ì… ì¶”ê°€ ì—¬ì§€) ëª©í‘œì— ì í•©í•©ë‹ˆë‹¤. âœ…</p>
  </li>
</ul>

<p class="chat--user">

coerce ë‹¨ì–´ê°€ ì¢€ ì–´ë ¤ìš´ë°

</p>

<p>ì¢‹ì€ í¬ì¸íŠ¸! ì´ë¦„ì´ ì–´ë µê²Œ ëŠê»´ì§€ë©´ ì“°ëŠ” ì‚¬ëŒì´ ì•ˆ ì“°ê²Œ ë©ë‹ˆë‹¤ ğŸ˜…<br />
ì•„ë˜ì²˜ëŸ¼ ë°”ê¾¸ë©´ ì–´ë•Œìš”?</p>

<h3 id="ì²´í¬ë¦¬ìŠ¤íŠ¸">ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>

<ul>
  <li>
    <p>í›„ë³´ ì´ë¦„ ëª‡ ê°œ ì œì•ˆí•˜ê³  ì˜ë¯¸Â·ê´€ìš©ì„± ë¹„êµ</p>
  </li>
  <li>
    <p>í•˜ë‚˜ë¥¼ <strong>ê¸°ë³¸ ì¶”ì²œ</strong> ìœ¼ë¡œ ì„ íƒ</p>
  </li>
  <li>
    <p>ê¸°ì¡´ <code class="language-plaintext highlighter-rouge">coerce</code>ëŠ” <strong>í˜¸í™˜ìš© ë³„ì¹­</strong> ìœ¼ë¡œ ë‚¨ê¹€</p>
  </li>
  <li>
    <p>ì˜ˆì‹œ ì½”ë“œ/ì‚¬ìš©ë²• ì œì‹œ</p>
  </li>
  <li>
    <p>ì„ íƒì´ <strong>ì¼ê´€ì„±/í™•ì¥ì„±</strong> ëª©í‘œì— ë§ëŠ”ì§€ ë¹ ë¥¸ ê²€ì¦</p>
  </li>
</ul>

<hr />

<h2 id="ì´ë¦„-í›„ë³´-ì§§ì€-ì½”ë©˜íŠ¸">ì´ë¦„ í›„ë³´ (ì§§ì€ ì½”ë©˜íŠ¸)</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">as_textbuffer(obj, ...)</code> â€” <strong>ê°€ì¥ ì¶”ì²œ</strong>. NumPyì˜ <code class="language-plaintext highlighter-rouge">asarray</code> íŒ¨í„´ì²˜ëŸ¼ â€œì´ê±¸ TextBufferë¡œ â€˜ë°”ê¿”ì„œâ€™ ì£¼ì„¸ìš”(ì´ë¯¸ë©´ ê·¸ëŒ€ë¡œ)â€ë¼ëŠ” ì˜ë¯¸ê°€ <strong>ì§ê´€ì </strong>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ensure_textbuffer(obj, ...)</code> â€” â€œTextBuffer ë˜ê²Œ ë³´ì¥í•´ì¤˜â€ë¼ëŠ” ë‰˜ì•™ìŠ¤. ëª…í™•í•˜ì§€ë§Œ ì•½ê°„ ê¸¸ì–´ìš”.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">from_any(obj, ...)</code> â€” â€œì•„ë¬´ íƒ€ì…ì´ë‚˜ ë°›ì•„ë“¤ì—¬ ìƒì„±â€. ê¸°ëŠ¥ì€ ë§ì§€ë§Œ ì˜ë¯¸ê°€ ì•½ê°„ í¬ê´„ì .</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">wrap(obj, ...)</code> / <code class="language-plaintext highlighter-rouge">adapt(obj, ...)</code> â€” í¬ì¥/ì–´ëŒ‘íŠ¸ ëŠë‚Œ. ë‹¤ë§Œ êµ¬ì²´ì„±ì´ ë–¨ì–´ì§.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">cast(...)</code> â€” íƒ€ì… ìºìŠ¤íŠ¸ ë‰˜ì•™ìŠ¤ë¡œ í˜¼ë™ ìš°ë ¤ â†’ ë¹„ì¶”ì²œ.</p>
  </li>
</ul>

<p><strong>ê²°ë¡ :</strong> <code class="language-plaintext highlighter-rouge">as_textbuffer</code>ë¥¼ ê¸°ë³¸ìœ¼ë¡œ, í´ë˜ìŠ¤ ë©”ì„œë“œë¡œëŠ” <code class="language-plaintext highlighter-rouge">from_any</code>ë¥¼ ì–¹ê³ , ê¸°ì¡´ <code class="language-plaintext highlighter-rouge">coerce</code>ëŠ” aliasë¡œ ë‘ëŠ” êµ¬ì„±ì´ ê°€ì¥ ì½ê¸° ì‰½ê³  ì ì§„ì ì…ë‹ˆë‹¤.</p>

<ul>
  <li><em>ê²€ì¦:</em> ì´ë¦„ë§Œ ë°”ê¿”ë„ í˜¸ì¶œë¶€ ê°€ë…ì„±â†‘(ì¼ê´€ì„± ëª©í‘œ ë¶€í•©) / API í™•ì¥ ì‹œì—ë„ ì˜ë¯¸ ìœ ì§€(í™•ì¥ì„± ëª©í‘œ ë¶€í•©). âœ…</li>
</ul>

<hr />

<h2 id="ì½”ë“œ-ìŠ¤ë‹ˆí«-ê¸°ì¡´-coerce-ë‚´ìš©ì„-ë‚´ë¶€-êµ¬í˜„ìœ¼ë¡œ-ì¬ì‚¬ìš©">ì½”ë“œ ìŠ¤ë‹ˆí« (ê¸°ì¡´ <code class="language-plaintext highlighter-rouge">coerce</code> ë‚´ìš©ì„ ë‚´ë¶€ êµ¬í˜„ìœ¼ë¡œ ì¬ì‚¬ìš©)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># module-level í•¨ìˆ˜: ê°€ì¥ ëˆˆì— ì˜ ë„ëŠ” ì§„ì…ì 
</span><span class="k">def</span> <span class="nf">as_textbuffer</span><span class="p">(</span>
    <span class="n">obj</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(),</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">from_any</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">keepends</span><span class="o">=</span><span class="n">keepends</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TextBuffer</span><span class="p">:</span>
    <span class="c1"># ... ê¸°ì¡´ ì½”ë“œ ...
</span>
    <span class="c1"># ìƒˆ ì´ë¦„: ì˜ë¯¸ê°€ ë¶„ëª…í•œ í´ë˜ìŠ¤ ë©”ì„œë“œ
</span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_any</span><span class="p">(</span>
        <span class="n">cls</span><span class="p">,</span>
        <span class="n">obj</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span> <span class="o">=</span> <span class="nc">TextProfile</span><span class="p">(),</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="nf">_from_any_impl</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">keepends</span><span class="o">=</span><span class="n">keepends</span><span class="p">)</span>

    <span class="c1"># ê³¼ê±° ì´ë¦„ì€ í˜¸í™˜ìš© ë³„ì¹­ìœ¼ë¡œ ìœ ì§€ (ì›í•˜ë©´ í–¥í›„ deprecate)
</span>    <span class="nb">coerce</span> <span class="o">=</span> <span class="n">from_any</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_any_impl</span><span class="p">(</span>
        <span class="n">cls</span><span class="p">,</span>
        <span class="n">obj</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">profile</span><span class="p">:</span> <span class="n">TextProfile</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">keepends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="bp">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="sh">"</span><span class="s">TextBuffer</span><span class="sh">"</span><span class="p">:</span>
        <span class="kn">from</span> <span class="n">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Sequence</span>

        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">TextBuffer</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span>

        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="nf">from_string</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nf">all</span><span class="p">(</span><span class="nf">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">):</span>
                <span class="k">raise</span> <span class="nc">TypeError</span><span class="p">(</span><span class="sh">"</span><span class="s">Iterable must yield str values</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">ke</span> <span class="o">=</span> <span class="n">keepends</span> <span class="k">if</span> <span class="n">keepends</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">cls</span><span class="p">.</span><span class="nf">_guess_keepends</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="nf">from_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">keepends</span><span class="o">=</span><span class="n">ke</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

        <span class="k">raise</span> <span class="nc">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="sh">"</span><span class="s">Cannot convert </span><span class="si">{</span><span class="nf">type</span><span class="p">(</span><span class="n">obj</span><span class="p">).</span><span class="n">__name__</span><span class="si">}</span><span class="s"> to TextBuffer. </span><span class="sh">"</span>
            <span class="sh">"</span><span class="s">Use from_file() for paths/files, or pass str/Iterable[str]/TextBuffer.</span><span class="sh">"</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_guess_keepends</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="sh">"</span><span class="s">Sequence[str]</span><span class="sh">"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">any</span><span class="p">((</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">ln</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="sh">"</span><span class="se">\r</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">ln</span><span class="p">)</span> <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ì‚¬ìš©-ì˜ˆ-1">ì‚¬ìš© ì˜ˆ</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">buf1</span> <span class="o">=</span> <span class="nf">as_textbuffer</span><span class="p">(</span><span class="sh">"</span><span class="s">module top;</span><span class="se">\n</span><span class="s">endmodule</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>
<span class="n">buf2</span> <span class="o">=</span> <span class="nf">as_textbuffer</span><span class="p">([</span><span class="sh">"</span><span class="s">module top;</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">endmodule</span><span class="sh">"</span><span class="p">],</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>
<span class="n">buf3</span> <span class="o">=</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">from_any</span><span class="p">([</span><span class="sh">"</span><span class="s">a</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="se">\n</span><span class="sh">"</span><span class="p">],</span> <span class="n">profile</span><span class="o">=</span><span class="n">VERILOG</span><span class="p">)</span>  <span class="c1"># í´ë˜ìŠ¤ ë©”ì„œë“œ ê²½ë¡œ
</span><span class="n">buf4</span> <span class="o">=</span> <span class="n">TextBuffer</span><span class="p">.</span><span class="nf">coerce</span><span class="p">(</span><span class="sh">"</span><span class="s">...</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># ê¸°ì¡´ ì½”ë“œë„ ê·¸ëŒ€ë¡œ ë™ì‘(í˜¸í™˜ alias)
</span></code></pre></div></div>

<hr />

<h2 id="ë¹ ë¥¸-ê²€ì¦--ì…€í”„ì½”ë ‰íŠ¸">ë¹ ë¥¸ ê²€ì¦ &amp; ì…€í”„ì½”ë ‰íŠ¸</h2>

<ul>
  <li>
    <p><strong>ê°€ë…ì„±/ì˜ˆì¸¡ ê°€ëŠ¥ì„±:</strong> <code class="language-plaintext highlighter-rouge">as_textbuffer</code> ì´ë¦„ë§Œ ë³´ê³ ë„ ì—­í• ì´ ë³´ì…ë‹ˆë‹¤. í˜¼ë™ ì—¬ì§€ ë‚®ìŒ. âœ…</p>
  </li>
  <li>
    <p><strong>ì¼ê´€ì„±:</strong> <code class="language-plaintext highlighter-rouge">from_string/from_lines/from_file</code> ê°™ì€ ëª…ì‹œ ê²½ë¡œë¥¼ ìœ ì§€í•˜ë©´ì„œ, â€œí¸ì˜ ê²½ë¡œâ€ëŠ” <code class="language-plaintext highlighter-rouge">as_textbuffer</code>ë¡œ í†µì¼. âœ…</p>
  </li>
  <li>
    <p><strong>í™•ì¥ì„±:</strong> ì œ3ì íƒ€ì…ì´ ëŠ˜ì–´ë‚˜ë©´ <code class="language-plaintext highlighter-rouge">_from_any_impl</code>ì— ì–´ëŒ‘í„° í›…ì„ ì¶”ê°€í•˜ë©´ ë¨(ì˜ˆ: <code class="language-plaintext highlighter-rouge">obj.__textbuffer__()</code> ì§€ì› ë“±). âœ…</p>
  </li>
  <li>
    <p><strong>ëª¨í˜¸ì„± ê´€ë¦¬:</strong> íŒŒì¼/ë°”ì´íŠ¸ëŠ” ì—¬ì „íˆ <code class="language-plaintext highlighter-rouge">from_file</code>/decode ê²½ë¡œë¡œë§Œ ì²˜ë¦¬ â†’ ì‚¬ì´ë“œì´í™íŠ¸Â·ì¶”ì¸¡ ë¡œì§ ìµœì†Œí™”. âœ…</p>
  </li>
</ul>

<p>ì›í•˜ì‹œë©´ í”„ë¡œì íŠ¸ ì „ì—­ ë„¤ì´ë° ë£°(ì˜ˆ: â€œí¸ì˜ ë³€í™˜ ì—”íŠ¸ë¦¬ëŠ” í•­ìƒ <code class="language-plaintext highlighter-rouge">as_*</code>ë¡œ ì‹œì‘â€)ë„ ê°™ì´ ì •ë¦¬í•´ ë“œë¦´ê²Œìš”.</p>]]></content><author><name>hvppyarchive</name></author><category term="llm" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">untitled</title><link href="https://hvppyarchive.github.io/python/python-dataclass-method/" rel="alternate" type="text/html" title="untitled" /><published>2025-08-20T17:53:48+09:00</published><updated>2025-08-20T17:53:48+09:00</updated><id>https://hvppyarchive.github.io/python/python-dataclass-method</id><content type="html" xml:base="https://hvppyarchive.github.io/python/python-dataclass-method/"><![CDATA[]]></content><author><name>hvppyarchive</name></author><category term="python" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">Python í´ë˜ìŠ¤ íŠ¸ë¦¬ ì¶œë ¥</title><link href="https://hvppyarchive.github.io/python/python-class-tree/" rel="alternate" type="text/html" title="Python í´ë˜ìŠ¤ íŠ¸ë¦¬ ì¶œë ¥" /><published>2025-08-20T15:45:34+09:00</published><updated>2025-08-20T15:45:34+09:00</updated><id>https://hvppyarchive.github.io/python/python-class-tree</id><content type="html" xml:base="https://hvppyarchive.github.io/python/python-class-tree/"><![CDATA[<p class="chat--user">

ë„Œ Python ì „ë¬¸ê°€ì•¼. Pythonì—ì„œ ê³„ì¸µì  êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆëŠ” ì»¤ìŠ¤í…€ í´ë˜ìŠ¤ì— ëŒ€í•´ ë³´ê¸° ì¢‹ê²Œ ëª¨ë“  ì†ì„± Treeë¥¼ ì¶œë ¥í•˜ê²Œ í•˜ê³  ì‹¶ì–´. ì˜ˆë¥¼ ë“¤ì–´ PyVerilogì˜ ASTì˜ ì „ì²´ êµ¬ì¡°ë¥¼ ì•Œê³  ì‹¶ì–´.

</p>

<p>ì¢‹ì•„! â€œê³„ì¸µì  êµ¬ì¡°ë¥¼ ê°€ì§„ ì»¤ìŠ¤í…€ í´ë˜ìŠ¤(ì˜ˆ: PyVerilog AST)â€ë¥¼ ë³´ê¸° ì¢‹ê²Œ íŠ¸ë¦¬ë¡œ ì¶œë ¥í•˜ëŠ” ë²”ìš© ìœ í‹¸ì„ ë§Œë“¤ì–´ë³¼ê²Œ.<br />
ì•„ë˜ ì½”ë“œëŠ” ë‹¤ìŒ ì•„ì´ë””ì–´ë¥¼ ë”°ë¦…ë‹ˆë‹¤:</p>

<ol>
  <li>
    <p>ë…¸ë“œê°€ ë¬´ì—‡ì´ë“  ì²˜ë¦¬: <code class="language-plaintext highlighter-rouge">dict/list/tuple/set</code>, ì¼ë°˜ ê°ì²´(<code class="language-plaintext highlighter-rouge">__dict__</code>/<code class="language-plaintext highlighter-rouge">__slots__</code>), dataclass, Python <code class="language-plaintext highlighter-rouge">ast.AST</code>, ê·¸ë¦¬ê³  PyVerilogì²˜ëŸ¼ <code class="language-plaintext highlighter-rouge">children()</code>/<code class="language-plaintext highlighter-rouge">attr_names</code> í”„ë¡œí† ì½œì„ ê°€ì§„ ê°ì²´.</p>
  </li>
  <li>
    <p>ë£¨í”„/ì‚¬ì´í´ ì•ˆì „: ì´ë¯¸ ì¶œë ¥í•œ ê°ì²´ëŠ” ë‹¤ì‹œ ë“¤ì–´ê°€ì§€ ì•ŠìŒ.</p>
  </li>
  <li>
    <p>ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ: <code class="language-plaintext highlighter-rouge">max_depth</code>, <code class="language-plaintext highlighter-rouge">max_items</code>, ë¹„ê³µê°œ ì†ì„± í¬í•¨ ì—¬ë¶€ ë“±.</p>
  </li>
  <li>
    <p>ê°€ë…ì„±: <code class="language-plaintext highlighter-rouge">â”œâ”€/â””â”€/â”‚</code> ASCII ë¸Œëœì¹˜ë¡œ ì˜ˆì˜ê²Œ ë Œë”ë§.</p>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">is_dataclass</span><span class="p">,</span> <span class="n">fields</span> <span class="k">as</span> <span class="n">dc_fields</span>
<span class="kn">import</span> <span class="n">ast</span>
<span class="kn">from</span> <span class="n">collections.abc</span> <span class="kn">import</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Iterable</span>

<span class="k">def</span> <span class="nf">is_primitive</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nf">type</span><span class="p">(</span><span class="bp">None</span><span class="p">),</span> <span class="nb">bytes</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">safe_len</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">safe_repr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">80</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nf">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">&lt;</span><span class="si">{</span><span class="nf">type</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">__name__</span><span class="si">}</span><span class="s"> ...&gt;</span><span class="sh">"</span>
    <span class="k">if</span> <span class="n">maxlen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nf">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxlen</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">r</span><span class="p">[:</span><span class="n">maxlen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="sh">"</span><span class="s">â€¦</span><span class="sh">"</span>
    <span class="k">return</span> <span class="n">r</span>

<span class="k">def</span> <span class="nf">iter_children</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">include_private</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include_dunder</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">max_items</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="c1"># 1) ë§¤í•‘í˜•(dict ë“±)
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="nf">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">max_items</span><span class="p">:</span>
                <span class="nf">yield </span><span class="p">(</span><span class="sh">"</span><span class="s">â€¦(truncated)</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">+ items</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="nf">yield </span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="nf">safe_repr</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># 2) ì‹œí€€ìŠ¤/ì´í„°ëŸ¬ë¸”(ë¬¸ìì—´ë¥˜ ì œì™¸)
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">,</span> <span class="nb">memoryview</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">)):</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">seq</span><span class="p">[:</span><span class="n">max_items</span><span class="p">]):</span>
                <span class="nf">yield </span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">]</span><span class="sh">"</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_items</span><span class="p">:</span>
                <span class="nf">yield </span><span class="p">(</span><span class="sh">"</span><span class="s">â€¦(truncated)</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span><span class="o">-</span><span class="n">max_items</span><span class="si">}</span><span class="s"> more</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="c1"># 3) Python ë‚´ì¥ AST
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">ast</span><span class="p">.</span><span class="n">AST</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ast</span><span class="p">.</span><span class="nf">iter_fields</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
            <span class="nf">yield </span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># 4) PyVerilog ìŠ¤íƒ€ì¼: children() + attr_names
</span>    <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">children</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="nf">callable</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">children</span><span class="sh">"</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ch</span> <span class="o">=</span> <span class="n">o</span><span class="p">.</span><span class="nf">children</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="n">ch</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># children()ì´ [(name, child), ...] í˜•íƒœë©´ ê·¸ëŒ€ë¡œ, ì•„ë‹ˆë©´ ì¸ë±ìŠ¤ ë¶€ì—¬
</span>        <span class="nf">if </span><span class="p">(</span><span class="nf">isinstance</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="n">ch</span> <span class="ow">and</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> 
            <span class="ow">and</span> <span class="nf">len</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">:</span>
                <span class="nf">yield </span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">seq</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="n">seq</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">seq</span><span class="p">[:</span><span class="n">max_items</span><span class="p">]):</span>
                <span class="nf">yield </span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">]</span><span class="sh">"</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_items</span><span class="p">:</span>
                <span class="nf">yield </span><span class="p">(</span><span class="sh">"</span><span class="s">â€¦(truncated)</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span><span class="o">-</span><span class="n">max_items</span><span class="si">}</span><span class="s"> more</span><span class="sh">"</span><span class="p">)</span>

        <span class="n">attr_names</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">attr_names</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attr_names</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">attr_names</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="nf">yield </span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># 5) dataclass
</span>    <span class="k">if</span> <span class="nf">is_dataclass</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nf">dc_fields</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nf">yield </span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">f</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">return</span>

    <span class="c1"># 6) ì¼ë°˜ ê°ì²´: __dict__/__slots__
</span>    <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">__dict__</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">o</span><span class="p">).</span><span class="nf">items</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">items</span><span class="p">[:</span><span class="n">max_items</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_dunder</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_private</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="nf">yield </span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_items</span><span class="p">:</span>
            <span class="nf">yield </span><span class="p">(</span><span class="sh">"</span><span class="s">â€¦(truncated)</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="o">-</span><span class="n">max_items</span><span class="si">}</span><span class="s"> more</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">__slots__</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">__slots__</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">slots</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">slots</span> <span class="o">=</span> <span class="p">[</span><span class="n">slots</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">[:</span><span class="n">max_items</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_dunder</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_private</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nf">yield </span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_items</span><span class="p">:</span>
            <span class="nf">yield </span><span class="p">(</span><span class="sh">"</span><span class="s">â€¦(truncated)</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span><span class="o">-</span><span class="n">max_items</span><span class="si">}</span><span class="s"> more</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="c1"># ê·¸ ë°–ì—” ìì‹ ì—†ìŒ
</span>
<span class="k">def</span> <span class="nf">node_label</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">show_types</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">show_values</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nf">type</span><span class="p">(</span><span class="n">value</span><span class="p">).</span><span class="n">__name__</span>
    <span class="k">if</span> <span class="nf">is_primitive</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nf">safe_repr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span> <span class="k">if</span> <span class="n">show_values</span> <span class="k">else</span> <span class="sh">""</span>
        <span class="k">if</span> <span class="n">show_types</span> <span class="ow">and</span> <span class="n">show_values</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span>
        <span class="k">elif</span> <span class="n">show_values</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="sh">"</span>
        <span class="k">elif</span> <span class="n">show_types</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="sh">"</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nf">safe_len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s"> len=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="sh">"</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="sh">""</span>
    <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: &lt;</span><span class="si">{</span><span class="n">t</span><span class="si">}{</span><span class="n">extra</span><span class="si">}</span><span class="s">&gt;</span><span class="sh">"</span>

<span class="k">def</span> <span class="nf">pretty_tree</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">root_name</span><span class="o">=</span><span class="sh">"</span><span class="s">root</span><span class="sh">"</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_items</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                <span class="n">include_private</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include_dunder</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">show_types</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">show_values</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ê°ì²´ ì „ì²´ ì†ì„±/ìì‹ êµ¬ì¡°ë¥¼ íŠ¸ë¦¬ë¡œ ë¬¸ìì—´ ë Œë”ë§.</span><span class="sh">"""</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="sh">""</span><span class="p">,</span> <span class="n">is_last</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="p">(</span><span class="sh">"</span><span class="s">â””â”€â”€ </span><span class="sh">"</span> <span class="k">if</span> <span class="n">is_last</span> <span class="k">else</span> <span class="sh">"</span><span class="s">â”œâ”€â”€ </span><span class="sh">"</span><span class="p">)</span> <span class="o">+</span> 
                    <span class="nf">node_label</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">show_types</span><span class="p">,</span> <span class="n">show_values</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">max_depth</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">is_primitive</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">oid</span> <span class="o">=</span> <span class="nf">id</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="p">(</span><span class="sh">"</span><span class="s">    </span><span class="sh">"</span> <span class="k">if</span> <span class="n">is_last</span> <span class="k">else</span> <span class="sh">"</span><span class="s">â”‚   </span><span class="sh">"</span><span class="p">)</span> <span class="o">+</span> <span class="sh">"</span><span class="s">â†ª (cycle)</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">seen</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>

        <span class="n">children</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">iter_children</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">include_private</span><span class="p">,</span> <span class="n">include_dunder</span><span class="p">,</span> <span class="n">max_items</span><span class="p">))</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">L</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">child_name</span><span class="p">,</span> <span class="n">child_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">children</span><span class="p">):</span>
            <span class="n">child_prefix</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="p">(</span><span class="sh">"</span><span class="s">    </span><span class="sh">"</span> <span class="k">if</span> <span class="n">is_last</span> <span class="k">else</span> <span class="sh">"</span><span class="s">â”‚   </span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">walk</span><span class="p">(</span><span class="n">child_name</span><span class="p">,</span> <span class="n">child_val</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">child_prefix</span><span class="p">,</span> <span class="n">is_last</span><span class="o">=</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="nf">walk</span><span class="p">(</span><span class="n">root_name</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="sh">""</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

<span class="c1"># í¸ì˜: ë°”ë¡œ ì¶œë ¥
</span><span class="k">def</span> <span class="nf">print_tree</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">pretty_tree</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="ì‚¬ìš©-ì˜ˆì‹œ-1-python-í‘œì¤€-ast">ì‚¬ìš© ì˜ˆì‹œ 1) Python í‘œì¤€ AST</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">ast</span>
<span class="n">code</span> <span class="o">=</span> <span class="sh">"</span><span class="s">a = 1 + 2</span><span class="se">\n</span><span class="s">b = a * 3</span><span class="sh">"</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="nf">print_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">root_name</span><span class="o">=</span><span class="sh">"</span><span class="s">Module</span><span class="sh">"</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_items</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ì‚¬ìš©-ì˜ˆì‹œ-2-pyverilog-ast-ì „ì²´-êµ¬ì¡°">ì‚¬ìš© ì˜ˆì‹œ 2) PyVerilog AST ì „ì²´ êµ¬ì¡°</h3>

<blockquote>
  <p>PyVerilogì—ì„œëŠ” ë³´í†µ ë…¸ë“œê°€ <code class="language-plaintext highlighter-rouge">children()</code> ë©”ì„œë“œ(ìì‹ ë…¸ë“œ ë‚˜ì—´)ì™€ <code class="language-plaintext highlighter-rouge">attr_names</code>(ìŠ¤ì¹¼ë¼ ì†ì„± ì´ë¦„ë“¤)ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ìœ„ ìœ í‹¸ì€ ì´ í”„ë¡œí† ì½œì„ ìë™ ì¸ì‹í•©ë‹ˆë‹¤.
```python
from pyverilog.vparser.parser import parse</p>
</blockquote>

<p>ast_root, _ = parse(["top.v"])   # ë¶„ì„í•  Verilog íŒŒì¼ë“¤</p>
<h1 id="íŠ¸ë¦¬-ì „ì²´ì£¼ì˜-í¬ë©´-ë°©ëŒ€í•©ë‹ˆë‹¤">íŠ¸ë¦¬ ì „ì²´(ì£¼ì˜: í¬ë©´ ë°©ëŒ€í•©ë‹ˆë‹¤!)</h1>
<p>print_tree(ast_root, root_name="PyVerilogAST", max_depth=6, max_items=50)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### íŒ

  * íŠ¸ë¦¬ê°€ ë„ˆë¬´ í¬ë©´ `max_depth`/`max_items`ë¥¼ ì¤„ì´ì„¸ìš”.  
ì˜ˆ: `print_tree(ast_root, max_depth=4, max_items=20)`

  * ë¹„ê³µê°œ/ë˜ë” ì†ì„±ê¹Œì§€ ë³´ê³  ì‹¶ìœ¼ë©´:  
`print_tree(obj, include_private=True, include_dunder=True)`

  * ê°’ì´ ë„ˆë¬´ ê¸¸ë©´ ìë™ìœ¼ë¡œ `â€¦`ë¡œ ìƒëµí•©ë‹ˆë‹¤.

  * ìˆœí™˜ ì°¸ì¡°ê°€ ìˆìœ¼ë©´ `(cycle)`ë¡œ í‘œì‹œí•˜ì—¬ ë¬´í•œë£¨í”„ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.

ì›í•˜ëŠ” ì¶œë ¥ ìŠ¤íƒ€ì¼(ì˜ˆ: ê°’ ìˆ¨ê¸°ê¸°, íƒ€ì… ìˆ¨ê¸°ê¸°, íŠ¹ì • ì†ì„± ì œì™¸, íŒŒì¼ë¡œ ì €ì¥ ë“±)ë¡œ ë” ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆí•œ ë²„ì „ë„ ë°”ë¡œ ë§Œë“¤ì–´ì¤„ ìˆ˜ ìˆì–´ìš”. PyVerilogì—ì„œ ëª¨ë“ˆ ë‹¨ìœ„ë¡œë§Œ ë³´ê³  ì‹¶ë‹¤ë“ ì§€, íŠ¹ì • ë…¸ë“œ ìœ í˜•ë§Œ í•„í„°ë§í•œë‹¤ë“ ì§€â€”ì›í•˜ëŠ” ë·°ë¥¼ ì•Œë ¤ì£¼ë©´ ê±°ê¸°ì— ë§ì¶° ì†ì§ˆí•´ì¤„ê²Œìš”.

&lt;p class="chat--user" markdown="1"&gt;

PyVerilog ìŠ¤íƒ€ì¼ì— ì§‘ì°©í•˜ì§€ ë§ê³  ë²”ìš©ì ìœ¼ë¡œ ëª¨ë“  ì†ì„± dict ì— ëŒ€í•´ íŠ¸ë¦¬ë¥¼ ë§Œë“¤ì–´ì¤˜. â€œmember ë³€ìˆ˜ëª…: classëª…â€ í˜•íƒœë¡œ ë‚˜ì˜¤ë©´ ì¢‹ê² ì–´

&lt;/p&gt;

ì¢‹ì•„â€”â€œì†ì„± dictâ€ ì¤‘ì‹¬ìœ¼ë¡œ, ì–´ë–¤ ê°ì²´ë“  **ë©¤ë²„ ë³€ìˆ˜ ì´ë¦„: í´ë˜ìŠ¤ëª…** í˜•íƒœë¡œ íŠ¸ë¦¬ë¥¼ ê·¸ë ¤ì£¼ëŠ” ë²”ìš© ìœ í‹¸ì„ ë°”ë¡œ ì¤„ê²Œ.  
(ê°’ì€ ë³´ì—¬ì£¼ì§€ ì•Šê³ , íƒ€ì…(í´ë˜ìŠ¤ëª…)ë§Œ ì¶œë ¥. ì‚¬ì´í´/ê¹Šì´/ê°œìˆ˜ ì œí•œ, `__dict__`/`__slots__`/dict/ì‹œí€€ìŠ¤ ë‹¤ ì§€ì›.)
```python
from dataclasses import is_dataclass, fields as dc_fields
from collections.abc import Mapping, Iterable
import types

# ----- ì„¤ì • ê°€ëŠ¥í•œ í•„í„° -----
DATA_LIKE_TYPES = (str, bytes, bytearray, memoryview, int, float, bool, type(None), complex)

def _class_name(x):
    try:
        return type(x).__name__
    except Exception:
        return "&lt;unknown&gt;"

def _is_primitive(x):
    return isinstance(x, DATA_LIKE_TYPES)

def _iter_object_members(o, include_private=False, include_dunder=False, include_properties=False):
    """
    ê°ì²´ì˜ 'ë©¤ë²„ ë³€ìˆ˜' í›„ë³´ë¥¼ (name, value)ë¡œ yield.
    - __dict__, __slots__, dataclass í•„ë“œ ì¤‘ì‹¬
    - include_properties=True ë©´ property ê²Œí„°ë„ í¬í•¨(ì˜ˆì™¸ ë°œìƒ ì‹œ ë¬´ì‹œ)
    - ë©”ì„œë“œ/í•¨ìˆ˜/ë°”ìš´ë“œë©”ì„œë“œëŠ” ì œì™¸
    """
    yielded = set()

    # dataclass ìš°ì„ 
    if is_dataclass(o):
        for f in dc_fields(o):
            name = f.name
            try:
                val = getattr(o, name)
            except Exception:
                continue
            if not include_dunder and name.startswith("__") and name.endswith("__"):
                continue
            if not include_private and name.startswith("_") and not (name.startswith("__") and name.endswith("__")):
                continue
            yielded.add(name)
            yield name, val

    # __dict__
    if hasattr(o, "__dict__"):
        for name, val in vars(o).items():
            if not include_dunder and name.startswith("__") and name.endswith("__"):
                continue
            if not include_private and name.startswith("_") and not (name.startswith("__") and name.endswith("__")):
                continue
            yielded.add(name)
            yield name, val

    # __slots__
    if hasattr(o, "__slots__"):
        slots = getattr(o, "__slots__")
        if isinstance(slots, str):
            slots = [slots]
        for name in slots:
            if name in yielded:
                continue
            if not include_dunder and name.startswith("__") and name.endswith("__"):
                continue
            if not include_private and name.startswith("_") and not (name.startswith("__") and name.endswith("__")):
                continue
            try:
                val = getattr(o, name)
            except Exception:
                continue
            yielded.add(name)
            yield name, val

    # ì„ íƒ: property
    if include_properties:
        # dir ê¸°ë°˜ìœ¼ë¡œ propertyë§Œ ì¶”ê°€
        for name in dir(o):
            if name in yielded:
                continue
            if not include_dunder and name.startswith("__") and name.endswith("__"):
                continue
            if not include_private and name.startswith("_") and not (name.startswith("__") and name.endswith("__")):
                continue
            try:
                attr = getattr(type(o), name, None)
                if isinstance(attr, property):
                    try:
                        val = getattr(o, name)
                    except Exception:
                        continue
                    yield name, val
            except Exception:
                continue

def _iter_children(node, include_private, include_dunder, include_properties, max_items):
    """
    ë…¸ë“œì˜ 'ìì‹'ì„ (name, value)ë¡œ í†µì¼í•´ ì—´ê±°.
    ê·œì¹™:
      1) dictë¥˜ë©´ keyë¥¼ ë©¤ë²„ëª…ì²˜ëŸ¼ ì‚¬ìš©
      2) list/tuple/set ë“±ì€ ì¸ë±ìŠ¤/ìˆœë²ˆìœ¼ë¡œ í‘œê¸°
      3) ê¸°íƒ€ ê°ì²´ëŠ” ë©¤ë²„ ë³€ìˆ˜ë“¤(__dict__/__slots__/dataclass/property)
    """
    # 1) ë§¤í•‘
    if isinstance(node, Mapping):
        for i, (k, v) in enumerate(node.items()):
            if i &gt;= max_items:
                yield ("â€¦(truncated)", f"{len(node) - max_items} more")
                return
            yield (f"{repr(k)}", v)
        return

    # 2) ë¬¸ìì—´ë¥˜ ì œì™¸í•œ ì¼ë°˜ ì´í„°ëŸ¬ë¸”(ì‹œí€€ìŠ¤/ì„¸íŠ¸ ë“±)
    if isinstance(node, Iterable) and not isinstance(node, (str, bytes, bytearray, memoryview)):
        if isinstance(node, (list, tuple)):
            for i, v in enumerate(node[:max_items]):
                yield (f"[{i}]", v)
            if len(node) &gt; max_items:
                yield ("â€¦(truncated)", f"{len(node) - max_items} more")
            return
        elif isinstance(node, (set, frozenset)):
            for i, v in enumerate(list(node)[:max_items]):
                yield (f"[{i}]", v)
            if len(node) &gt; max_items:
                yield ("â€¦(truncated)", f"{len(node) - max_items} more")
            return

    # 3) ì¼ë°˜ ê°ì²´: ë©¤ë²„ ë³€ìˆ˜ dict
    for name, val in _iter_object_members(
        node,
        include_private=include_private,
        include_dunder=include_dunder,
        include_properties=include_properties,
    ):
        yield (name, val)

def attr_tree(
    obj,
    root_name="root",
    max_depth=10,
    max_items=50,
    include_private=False,
    include_dunder=False,
    include_properties=False,
):
    """
    ê°ì²´ì˜ 'ì†ì„± dict'ì„ ê¸°ë°˜ìœ¼ë¡œ íŠ¸ë¦¬ë¥¼ ê·¸ë¦½ë‹ˆë‹¤.
    ì¶œë ¥ í¬ë§·: "ë©¤ë²„ëª…: í´ë˜ìŠ¤ëª…"
    - dict/ì‹œí€€ìŠ¤ ìš”ì†Œë„ ê°€ë…ì„±ì„ ìœ„í•´ í‚¤/ì¸ë±ìŠ¤ë¥¼ 'ë©¤ë²„ëª…'ì²˜ëŸ¼ ì¶œë ¥í•©ë‹ˆë‹¤.
    """
    seen = set()
    lines = []

    def add_line(prefix, is_last, name, value):
        cls = _class_name(value)
        lines.append(prefix + ("â””â”€â”€ " if is_last else "â”œâ”€â”€ ") + f"{name}: {cls}")

    def walk(name, value, prefix="", is_last=True, depth=0):
        add_line(prefix, is_last, name, value)
        if depth &gt;= max_depth:
            return

        # ì›ì‹œ íƒ€ì…ì€ ë” ë‚´ë ¤ê°€ì§€ ì•ŠìŒ
        if _is_primitive(value):
            return

        # ì‚¬ì´í´ ë°©ì§€
        oid = id(value)
        if oid in seen:
            child_prefix = prefix + ("    " if is_last else "â”‚   ")
            lines.append(child_prefix + "â†ª (cycle)")
            return
        seen.add(oid)

        # ìì‹ ì—´ê±°
        children = list(_iter_children(
            value,
            include_private=include_private,
            include_dunder=include_dunder,
            include_properties=include_properties,
            max_items=max_items,
        ))

        L = len(children)
        for i, (child_name, child_val) in enumerate(children):
            child_prefix = prefix + ("    " if is_last else "â”‚   ")
            walk(child_name, child_val, prefix=child_prefix, is_last=(i == L - 1), depth=depth + 1)

    walk(root_name, obj, "", True, 0)
    return "\n".join(lines)

def print_attr_tree(obj, **kwargs):
    print(attr_tree(obj, **kwargs))
</code></pre></div></div>

<h3 id="í•µì‹¬-ì•„ì´ë””ì–´-step-by-step">í•µì‹¬ ì•„ì´ë””ì–´ (step-by-step)</h3>

<ol>
  <li>
    <p>â€œë¬´ì—‡ì„ ìì‹ìœ¼ë¡œ ë³¼ ê²ƒì¸ê°€?â€</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">dict</code> â†’ í‚¤ë¥¼ ë©¤ë²„ëª…ìœ¼ë¡œ ì‚¬ìš©</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">list/tuple/set</code> â†’ <code class="language-plaintext highlighter-rouge">[ì¸ë±ìŠ¤]</code> ë˜ëŠ” ìˆœë²ˆ</p>
      </li>
      <li>
        <p>ê·¸ ì™¸ ê°ì²´ â†’ <strong>ì†ì„± dict</strong> : <code class="language-plaintext highlighter-rouge">__dict__</code>, <code class="language-plaintext highlighter-rouge">__slots__</code>, (ì˜µì…˜) dataclass í•„ë“œì™€ <code class="language-plaintext highlighter-rouge">@property</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p>ì¶œë ¥ì€ ê°’ ëŒ€ì‹  <strong>í´ë˜ìŠ¤ëª…</strong> ë§Œ (<code class="language-plaintext highlighter-rouge">ë©¤ë²„ëª…: í´ë˜ìŠ¤ëª…</code>).</p>
  </li>
  <li>
    <p><strong>ì‚¬ì´í´ ê°ì§€</strong> ë¡œ ë¬´í•œ ì¬ê·€ ë°©ì§€(ê°ì²´ <code class="language-plaintext highlighter-rouge">id</code> ê¸°ì–µ).</p>
  </li>
  <li>
    <p><strong>íƒìƒ‰ í•œë„</strong> : <code class="language-plaintext highlighter-rouge">max_depth</code>, <code class="language-plaintext highlighter-rouge">max_items</code>ë¡œ ë³¼ë¥¨ ì œì–´.</p>
  </li>
  <li>
    <p><strong>ê°€ì‹œì„± ì˜µì…˜</strong> : <code class="language-plaintext highlighter-rouge">_private</code>/<code class="language-plaintext highlighter-rouge">__dunder__</code>/<code class="language-plaintext highlighter-rouge">property</code> ë…¸ì¶œ ì—¬ë¶€ ì„ íƒ.</p>
  </li>
</ol>

<h3 id="ê°„ë‹¨-ì‚¬ìš©-ì˜ˆì‹œ">ê°„ë‹¨ ì‚¬ìš© ì˜ˆì‹œ</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">y</span><span class="sh">"</span><span class="p">,)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span> <span class="n">self</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">k</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="nc">B</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">lst</span> <span class="o">=</span> <span class="p">[{</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_hidden</span> <span class="o">=</span> <span class="sh">"</span><span class="s">secret</span><span class="sh">"</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">p</span><span class="p">(</span><span class="n">self</span><span class="p">):</span> <span class="k">return</span> <span class="mi">42</span>

<span class="n">a</span> <span class="o">=</span> <span class="nc">A</span><span class="p">()</span>
<span class="nf">print_attr_tree</span><span class="p">(</span>
    <span class="n">a</span><span class="p">,</span>
    <span class="n">root_name</span><span class="o">=</span><span class="sh">"</span><span class="s">A</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">include_private</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>     <span class="c1"># _hidden ìˆ¨ê¹€
</span>    <span class="n">include_dunder</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>      <span class="c1"># __dunder__ ìˆ¨ê¹€
</span>    <span class="n">include_properties</span><span class="o">=</span><span class="bp">True</span>    <span class="c1"># property p í¬í•¨
</span><span class="p">)</span>
</code></pre></div></div>

<p>ì˜ˆìƒ ì¶œë ¥(ì¶•ì•½ ì˜ˆ):</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">â””â”€â”€</span> <span class="n">A</span><span class="p">:</span> <span class="n">A</span>
    <span class="err">â”œâ”€â”€</span> <span class="n">x</span><span class="p">:</span> <span class="n">B</span>
    <span class="err">â”‚</span>   <span class="err">â””â”€â”€</span> <span class="n">y</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="err">â”‚</span>       <span class="err">â””â”€â”€</span> <span class="sh">'</span><span class="s">k</span><span class="sh">'</span><span class="p">:</span> <span class="nb">list</span>
    <span class="err">â”‚</span>           <span class="err">â”œâ”€â”€</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="nb">int</span>
    <span class="err">â”‚</span>           <span class="err">â”œâ”€â”€</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nb">int</span>
    <span class="err">â”‚</span>           <span class="err">â””â”€â”€</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">int</span>
    <span class="err">â”œâ”€â”€</span> <span class="n">lst</span><span class="p">:</span> <span class="nb">list</span>
    <span class="err">â”‚</span>   <span class="err">â”œâ”€â”€</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="nb">dict</span>
    <span class="err">â”‚</span>   <span class="err">â”‚</span>   <span class="err">â””â”€â”€</span> <span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">:</span> <span class="nb">int</span>
    <span class="err">â”‚</span>   <span class="err">â””â”€â”€</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nb">tuple</span>
    <span class="err">â”‚</span>       <span class="err">â”œâ”€â”€</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="nb">int</span>
    <span class="err">â”‚</span>       <span class="err">â””â”€â”€</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nb">int</span>
    <span class="err">â””â”€â”€</span> <span class="n">p</span><span class="p">:</span> <span class="nb">int</span>
</code></pre></div></div>

<h3 id="ì°¸ê³ -ì˜µì…˜">ì°¸ê³  ì˜µì…˜</h3>

<ul>
  <li>
    <p>ê¹Šì´/ê°œìˆ˜ ì œí•œ: <code class="language-plaintext highlighter-rouge">print_attr_tree(obj, max_depth=4, max_items=30)</code></p>
  </li>
  <li>
    <p>ìˆ¨ê²¨ì§„ ë©¤ë²„ê¹Œì§€: <code class="language-plaintext highlighter-rouge">include_private=True</code>, <code class="language-plaintext highlighter-rouge">include_dunder=True</code></p>
  </li>
  <li>
    <p>property ì œì™¸(ê¸°ë³¸): <code class="language-plaintext highlighter-rouge">include_properties=False</code></p>
  </li>
</ul>

<p>í•„ìš”í•˜ë©´ íŠ¹ì • íƒ€ì…ì„ â€œìì‹ í™•ì¥ ëŒ€ìƒì—ì„œ ì œì™¸/í¬í•¨â€í•˜ëŠ” í›…, ì •ë ¬, ì¶œë ¥ ëŒ€ìƒ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸/ë¸”ë™ë¦¬ìŠ¤íŠ¸(ì˜ˆ: ë©”ì„œë“œ/ì½œëŸ¬ë¸” ì „ë¶€ ì œì™¸ ë“±)ë„ ë°”ë¡œ ë§ë¶™ì—¬ ì¤„ê²Œ.</p>

<p class="chat--user">

ê¸°ì¡´ ìœ í‹¸ì´ë‚˜ íŒ¨í‚¤ì§€ëŠ” ì—†ë‚˜

</p>

<p>ì¢‹ì€ ì§ˆë¬¸ì´ì—ìš” ğŸ‘<br />
ì œê°€ ì•ì—ì„œ ì§œë“œë¦° ê±´ â€œì§ì ‘ ì»¤ìŠ¤í…€í•´ì„œ ë²”ìš© íŠ¸ë¦¬ ë·°ì–´â€ë¥¼ ë§Œë“œëŠ” ì½”ë“œì˜€ëŠ”ë°, ì‚¬ì‹¤ ì´ë¯¸ ë¹„ìŠ·í•œ ê¸°ëŠ¥ì„ í•˜ëŠ” <strong>ìœ í‹¸/íŒ¨í‚¤ì§€</strong> ê°€ ëª‡ ê°€ì§€ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ ìš”êµ¬í•˜ì‹ </p>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">member ë³€ìˆ˜ëª…: classëª…</code> í˜•íƒœì˜ ê³„ì¸µì  íŠ¸ë¦¬<br />
 ë¥¼ <strong>ê·¸ëŒ€ë¡œ</strong> í•´ì£¼ëŠ” ê±´ ì—†ê³ , ë¹„ìŠ·í•œ ê±¸ ì‘ìš©í•  ìˆ˜ ìˆëŠ” ë„êµ¬ë“¤ì´ ìˆìŠµë‹ˆë‹¤.</p>
</blockquote>

<hr />

<h2 id="1-í‘œì¤€ë‚´ì¥-ê³„ì—´">1. í‘œì¤€/ë‚´ì¥ ê³„ì—´</h2>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">pprint</code></strong> (í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬)<br />
dict/listë¥¼ ë³´ê¸° ì¢‹ê²Œ ì¶œë ¥í•˜ì§€ë§Œ, ê¹Šì€ ê³„ì¸µ + í´ë˜ìŠ¤ ë©¤ë²„ê¹Œì§€ëŠ” í•œê³„ê°€ ìˆìŒ.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">inspect</code></strong> (í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬)<br />
ê°ì²´ì˜ signature, membersë¥¼ introspection í•˜ëŠ” ë° íŠ¹í™”.<br />
â†’ raw ë°ì´í„°ë¥¼ ì–»ëŠ” ë°ëŠ” ì¢‹ì§€ë§Œ tree í˜•íƒœëŠ” ì§ì ‘ ê·¸ë ¤ì•¼ í•¨.</p>
  </li>
</ul>

<hr />

<h2 id="2-íŠ¸ë¦¬êµ¬ì¡°-ì¶œë ¥ìš©">2. íŠ¸ë¦¬/êµ¬ì¡° ì¶œë ¥ìš©</h2>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">anytree</code></strong><br />
íŒŒì´ì¬ ê°ì²´ë¥¼ íŠ¸ë¦¬ êµ¬ì¡°ë¡œ ëª¨ë¸ë§í•´ì„œ ë¬¸ìì—´/Graphvizë¡œ ì¶œë ¥ ê°€ëŠ¥.<br />
ì§ì ‘ ë…¸ë“œ ìƒì„±í•´ì„œ ë„£ì–´ì•¼ í•˜ë¯€ë¡œ â€œìë™ introspectionâ€ì€ ì•„ë‹ˆê³ , â€œêµ¬ì¡°í™”ëœ ë°ì´í„° â†’ íŠ¸ë¦¬ ì¶œë ¥â€ì— ì í•©.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">asciitree</code></strong><br />
dict ê°™ì€ nested êµ¬ì¡°ë¥¼ <code class="language-plaintext highlighter-rouge">â”œâ”€/â””â”€</code> í˜•íƒœë¡œ ì˜ˆì˜ê²Œ ì¶œë ¥.<br />
â†’ ê°’ ëŒ€ì‹  <code class="language-plaintext highlighter-rouge">type(value).__name__</code>ë§Œ ë„£ë„ë¡ ë˜í¼ë¥¼ ì§œë©´ ë°”ë¡œ í™œìš© ê°€ëŠ¥.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">rich</code></strong> ì˜ <code class="language-plaintext highlighter-rouge">Tree</code><br />
pretty console ì¶œë ¥ ë¼ì´ë¸ŒëŸ¬ë¦¬.<br />
ê³„ì¸µì  ë°ì´í„°ë¥¼ íŠ¸ë¦¬ë¡œ ê·¸ë ¤ì£¼ëŠ” <code class="language-plaintext highlighter-rouge">Tree</code> ì»´í¬ë„ŒíŠ¸ê°€ ìˆìŒ.<br />
â†’ dict/objectë¥¼ ìˆœíšŒí•´ì„œ <code class="language-plaintext highlighter-rouge">Tree.add(f"{name}: {type(val).__name__}")</code>ë§Œ í•´ì£¼ë©´ ìš”êµ¬í•œ í˜•íƒœë¡œ ì‰½ê²Œ êµ¬í˜„ ê°€ëŠ¥.</p>
  </li>
</ul>

<hr />

<h2 id="3-ë””ë²„ê¹…ê°œë°œ-í¸ì˜-íŒ¨í‚¤ì§€">3. ë””ë²„ê¹…/ê°œë°œ í¸ì˜ íŒ¨í‚¤ì§€</h2>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">objprint</code></strong><br />
ê°ì²´ ë‚´ë¶€ êµ¬ì¡°ë¥¼ ì´ì˜ê²Œ ì¶œë ¥í•´ì¤Œ. dict/list ì§€ì›, ìˆœí™˜ ê°ì§€.<br />
â†’ ë‹¤ë§Œ ì¶œë ¥ í¬ë§·ì´ â€œê°’â€ ì¤‘ì‹¬ì´ë¼ <code class="language-plaintext highlighter-rouge">ë©¤ë²„ëª…: í´ë˜ìŠ¤ëª…</code> ì „ìš©ì€ ì•„ë‹˜.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">varname</code></strong><br />
ë³€ìˆ˜ëª… ì¶”ì  ë¼ì´ë¸ŒëŸ¬ë¦¬. ì§ì ‘ tree ì¶œë ¥ì€ ì—†ì§€ë§Œ introspectionì— ìœ ìš©.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">glom</code></strong><br />
ì¤‘ì²© ë°ì´í„° êµ¬ì¡°ë¥¼ íƒìƒ‰/ë³€í™˜í•˜ëŠ” ë„êµ¬. ì¶œë ¥ì€ ëœ ì˜ˆì˜ì§€ë§Œ, dict íŠ¸ë¦¬ ì²˜ë¦¬ì— ì í•©.</p>
  </li>
</ul>

<hr />

<h2 id="4-ì¶”ì²œ-ì¡°í•©">4. ì¶”ì²œ ì¡°í•©</h2>

<p>ë§Œì•½ <strong>â€œë°”ë¡œ ê°€ì ¸ë‹¤ ì“°ê³  ì‹¶ë‹¤â€</strong>ë©´:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">rich.Tree</code> + ì§§ì€ ì¬ê·€ í•¨ìˆ˜ â†’ â€œë©¤ë²„ëª…: í´ë˜ìŠ¤ëª…â€ íŠ¸ë¦¬ ë°”ë¡œ êµ¬í˜„ ê°€ëŠ¥.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">asciitree</code>ë„ lightweight ëŒ€ì•ˆ.</p>
  </li>
</ul>

<hr />

<p>ğŸ‘‰ ê²°ë¡ : <strong>ê¸°ì¡´ íŒ¨í‚¤ì§€ë¡œëŠ”<code class="language-plaintext highlighter-rouge">rich</code> + introspection ìœ í‹¸</strong>ì´ ê°€ì¥ ë²”ìš©ì ì´ê³  ì˜ˆì˜ê²Œ ë‚˜ì˜µë‹ˆë‹¤.<br />
ì œê°€ ìœ„ì—ì„œ ì§  í•¨ìˆ˜ë„ <code class="language-plaintext highlighter-rouge">print_attr_tree</code> ëŒ€ì‹  <code class="language-plaintext highlighter-rouge">rich.Tree</code>ë¥¼ ì¨ì„œ ì¶œë ¥ë§Œ ë°”ê¾¸ë©´ í›¨ì”¬ ë” ë³´ê¸° ì¢‹ê²Œ ì“¸ ìˆ˜ ìˆì–´ìš”.</p>

<hr />

<p>ì›í•˜ì‹œë©´ ì œê°€ <code class="language-plaintext highlighter-rouge">rich.Tree</code> ë²„ì „ìœ¼ë¡œ â€œmember: classâ€ ì „ìš© íŠ¸ë¦¬ í”„ë¦°í„° ì˜ˆì œë¥¼ ì§œë“œë¦´ê¹Œìš”?</p>

<p class="chat--user">

leafì¼ ê²½ìš° ê°’ë„ ë³´ì—¬ì£¼ë©´ ì¢‹ê² ì–´ age: int(9) ì´ëŸ° ì‹ìœ¼ë¡œ

</p>

<p>ì¢‹ìŠµë‹ˆë‹¤ ğŸ‘<br />
ë§ì”€í•´ì£¼ì‹  ëŒ€ë¡œ <strong>leaf ë…¸ë“œ(ë” ì´ìƒ ë‚´ë ¤ê°ˆ ì†ì„±ì´ ì—†ëŠ” ê²½ìš°)</strong>ì—ëŠ” ê°’ê¹Œì§€ ê°™ì´ ë³´ì—¬ì£¼ë©´ í›¨ì”¬ ì§ê´€ì ì´ì—ìš”.<br />
ì¶œë ¥ í¬ë§·ì€ ì˜ˆì‹œì²˜ëŸ¼:</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">age</span><span class="p">:</span> <span class="kt">int</span><span class="p">(</span><span class="m">9</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="ì½”ë“œ-ì˜ˆì œ-richtree-ê¸°ë°˜">ì½”ë“œ ì˜ˆì œ (<code class="language-plaintext highlighter-rouge">rich.Tree</code> ê¸°ë°˜)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">is_dataclass</span><span class="p">,</span> <span class="n">fields</span> <span class="k">as</span> <span class="n">dc_fields</span>
<span class="kn">from</span> <span class="n">collections.abc</span> <span class="kn">import</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="n">rich.tree</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="n">rich</span> <span class="kn">import</span> <span class="k">print</span> <span class="k">as</span> <span class="n">rprint</span>

<span class="n">PRIMITIVES</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nf">type</span><span class="p">(</span><span class="bp">None</span><span class="p">),</span> <span class="nb">bytes</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_is_primitive</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">PRIMITIVES</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_short_repr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nf">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="sh">"</span><span class="s">&lt;?&gt;</span><span class="sh">"</span>
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxlen</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="n">maxlen</span><span class="p">]</span> <span class="o">+</span> <span class="sh">"</span><span class="s">â€¦</span><span class="sh">"</span>
    <span class="k">return</span> <span class="n">s</span>

<span class="k">def</span> <span class="nf">_iter_members</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">include_private</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include_dunder</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="nf">is_dataclass</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nf">dc_fields</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">f</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">f</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">__dict__</span><span class="sh">"</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nf">vars</span><span class="p">(</span><span class="n">o</span><span class="p">).</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_dunder</span> <span class="ow">and</span> <span class="n">k</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_private</span> <span class="ow">and</span> <span class="n">k</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">k</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="k">yield</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span>
    <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">__slots__</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">__slots__</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">slots</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">slots</span> <span class="o">=</span> <span class="p">[</span><span class="n">slots</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">yield</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span>

<span class="k">def</span> <span class="nf">_iter_children</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># dict
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">node</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">k</span><span class="si">!r}</span><span class="sh">"</span><span class="p">,</span> <span class="n">v</span>
        <span class="k">return</span>
    <span class="c1"># sequence (ë¬¸ìì—´ ì œì™¸)
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                <span class="k">yield</span> <span class="sa">f</span><span class="sh">"</span><span class="s">[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">]</span><span class="sh">"</span><span class="p">,</span> <span class="n">v</span>
            <span class="k">return</span>
    <span class="c1"># object
</span>    <span class="k">yield</span> <span class="k">from</span> <span class="nf">_iter_members</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">build_tree</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">root</span><span class="sh">"</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">include_private</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include_dunder</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">Tree</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="n">tname</span> <span class="o">=</span> <span class="nf">type</span><span class="p">(</span><span class="n">value</span><span class="p">).</span><span class="n">__name__</span>

        <span class="c1"># leaf &amp; primitive â†’ ê°’ê¹Œì§€ ì¶œë ¥
</span>        <span class="k">if</span> <span class="nf">_is_primitive</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">or</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">max_depth</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">tname</span><span class="si">}</span><span class="s">(</span><span class="si">{</span><span class="nf">_short_repr</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span>
            <span class="n">tree</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">oid</span> <span class="o">=</span> <span class="nf">id</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
            <span class="n">tree</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">tname</span><span class="si">}</span><span class="s"> â†ª (cycle)</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">seen</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>

        <span class="n">node_label</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">tname</span><span class="si">}</span><span class="sh">"</span>
        <span class="n">child_tree</span> <span class="o">=</span> <span class="n">tree</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">node_label</span><span class="p">)</span>

        <span class="n">children</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">_iter_children</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="n">include_private</span><span class="o">=</span><span class="n">include_private</span><span class="p">,</span>
            <span class="n">include_dunder</span><span class="o">=</span><span class="n">include_dunder</span>
        <span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">children</span><span class="p">:</span>  <span class="c1"># leafì§€ë§Œ primitive ì•„ë‹˜ (ì˜ˆ: ë¹ˆ dict)
</span>            <span class="n">child_tree</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">(empty)</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                <span class="nf">walk</span><span class="p">(</span><span class="n">child_tree</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">root</span> <span class="o">=</span> <span class="nc">Tree</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="nf">type</span><span class="p">(</span><span class="n">obj</span><span class="p">).</span><span class="n">__name__</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">walk</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">root</span>

<span class="k">def</span> <span class="nf">print_attr_tree</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nf">rprint</span><span class="p">(</span><span class="nf">build_tree</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
</code></pre></div></div>

<hr />

<h2 id="ì‚¬ìš©-ì˜ˆì‹œ">ì‚¬ìš© ì˜ˆì‹œ</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="n">self</span><span class="p">.</span><span class="n">pets</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">dog</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">cat</span><span class="sh">"</span><span class="p">]</span>

<span class="n">p</span> <span class="o">=</span> <span class="nc">Person</span><span class="p">(</span><span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="nf">print_attr_tree</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">Person</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p>ì¶œë ¥ ì˜ˆì‹œ:</p>
<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">Person</span><span class="o">:</span> <span class="nt">Person</span>
<span class="err">â””â”€â”€</span> <span class="nt">Person</span><span class="o">:</span> <span class="nt">Person</span>
    <span class="err">â”œâ”€â”€</span> <span class="nt">name</span><span class="o">:</span> <span class="nt">str</span><span class="o">(</span><span class="s2">'Alice'</span><span class="o">)</span>
    <span class="err">â”œâ”€â”€</span> <span class="nt">age</span><span class="o">:</span> <span class="nt">int</span><span class="o">(</span><span class="err">9</span><span class="o">)</span>
    <span class="err">â””â”€â”€</span> <span class="nt">pets</span><span class="o">:</span> <span class="nt">list</span>
        <span class="err">â”œâ”€â”€</span> <span class="o">[</span><span class="err">0</span><span class="o">]:</span> <span class="nt">str</span><span class="o">(</span><span class="s2">'dog'</span><span class="o">)</span>
        <span class="err">â””â”€â”€</span> <span class="o">[</span><span class="err">1</span><span class="o">]:</span> <span class="nt">str</span><span class="o">(</span><span class="s2">'cat'</span><span class="o">)</span>
</code></pre></div></div>

<hr />

<p>ğŸ‘‰ ì´ë ‡ê²Œ í•˜ë©´ <strong>leaf ë…¸ë“œì¼ ê²½ìš° ê°’ê¹Œì§€<code class="language-plaintext highlighter-rouge">í´ë˜ìŠ¤ëª…(ê°’)</code> í˜•íƒœ</strong>ë¡œ í‘œì‹œë©ë‹ˆë‹¤.<br />
ê°’ì´ ë„ˆë¬´ ê¸¸ë©´ ìë™ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">â€¦</code>ìœ¼ë¡œ ì˜ë¼ì£¼ë„ë¡ í–ˆì–´ìš”.</p>

<p>ì›í•˜ì‹œë©´ <code class="language-plaintext highlighter-rouge">max_depth</code>, <code class="language-plaintext highlighter-rouge">maxlen</code>, íŠ¹ì • íƒ€ì… ì œì™¸ í•„í„° ê°™ì€ ì¶”ê°€ ì˜µì…˜ë„ ë„£ì–´ë“œë¦´ ìˆ˜ ìˆëŠ”ë°, í˜¹ì‹œ í•„ìš”í•˜ì‹¤ê¹Œìš”?</p>

<p class="chat--user">

ë¼ì´ë¸ŒëŸ¬ë¦¬ ê¸°ë°˜ ë§ê³  ì•„ê¹Œ ì§œì¤€ ì½”ë“œ ê¸°ë°˜ìœ¼ë¡œ

</p>

<p>ì¢‹ì•„! <strong>ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´</strong> ì•„ê¹Œ ë§Œë“  ë²”ìš© íŠ¸ë¦¬ ìœ í‹¸ì„ ê·¸ëŒ€ë¡œ í™•ì¥í•´ì„œ, <strong>leafì¼ ë•ŒëŠ” ê°’ê¹Œì§€<code class="language-plaintext highlighter-rouge">ë©¤ë²„: íƒ€ì…(ê°’)</code></strong> í˜•íƒœë¡œ ì¶œë ¥í•˜ë„ë¡ ì†ë´¤ì–´.<br />
(leaf ì •ì˜: ë” ë‚´ë ¤ê°ˆ ìì‹ì´ ì—†ê±°ë‚˜, ì›ì‹œí˜•ì´ê±°ë‚˜, ìµœëŒ€ ê¹Šì´ì— ë„ë‹¬í•œ ê²½ìš°)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">is_dataclass</span><span class="p">,</span> <span class="n">fields</span> <span class="k">as</span> <span class="n">dc_fields</span>
<span class="kn">from</span> <span class="n">collections.abc</span> <span class="kn">import</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Iterable</span>

<span class="n">PRIMITIVES</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nf">type</span><span class="p">(</span><span class="bp">None</span><span class="p">),</span> <span class="nb">bytes</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_is_primitive</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">PRIMITIVES</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_class_name</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">type</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">__name__</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">&lt;unknown&gt;</span><span class="sh">"</span>

<span class="k">def</span> <span class="nf">_short_repr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nf">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="sh">"</span><span class="s">&lt;?&gt;</span><span class="sh">"</span>
    <span class="k">if</span> <span class="n">maxlen</span> <span class="ow">and</span> <span class="nf">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxlen</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="n">maxlen</span><span class="p">]</span> <span class="o">+</span> <span class="sh">"</span><span class="s">â€¦</span><span class="sh">"</span>
    <span class="k">return</span> <span class="n">s</span>

<span class="k">def</span> <span class="nf">_iter_object_members</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">include_private</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include_dunder</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include_properties</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">yielded</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>

    <span class="k">if</span> <span class="nf">is_dataclass</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nf">dc_fields</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">name</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_dunder</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_private</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="n">yielded</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span>

    <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">__dict__</span><span class="sh">"</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nf">vars</span><span class="p">(</span><span class="n">o</span><span class="p">).</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_dunder</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_private</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="n">yielded</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span>

    <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">__slots__</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">__slots__</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">slots</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">slots</span> <span class="o">=</span> <span class="p">[</span><span class="n">slots</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">yielded</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_dunder</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_private</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">yielded</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span>

    <span class="k">if</span> <span class="n">include_properties</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nf">dir</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">yielded</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_dunder</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_private</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="nf">type</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">property</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">continue</span>

<span class="k">def</span> <span class="nf">_iter_children</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">include_private</span><span class="p">,</span> <span class="n">include_dunder</span><span class="p">,</span> <span class="n">include_properties</span><span class="p">,</span> <span class="n">max_items</span><span class="p">):</span>
    <span class="c1"># dictë¥˜
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="nf">items</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">[:</span><span class="n">max_items</span><span class="p">]):</span>
            <span class="k">yield</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">k</span><span class="si">!r}</span><span class="sh">"</span><span class="p">,</span> <span class="n">v</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_items</span><span class="p">:</span>
            <span class="k">yield</span> <span class="sh">"</span><span class="s">â€¦(truncated)</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">-</span> <span class="n">max_items</span><span class="si">}</span><span class="s"> more</span><span class="sh">"</span>
        <span class="k">return</span>

    <span class="c1"># ì‹œí€€ìŠ¤/ì„¸íŠ¸ (ë¬¸ìì—´ë¥˜ ì œì™¸)
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">,</span> <span class="nb">memoryview</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">node</span><span class="p">)[:</span><span class="n">max_items</span><span class="p">]):</span>
                <span class="k">yield</span> <span class="sa">f</span><span class="sh">"</span><span class="s">[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">]</span><span class="sh">"</span><span class="p">,</span> <span class="n">v</span>
            <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_items</span><span class="p">:</span>
                <span class="k">yield</span> <span class="sh">"</span><span class="s">â€¦(truncated)</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">-</span> <span class="n">max_items</span><span class="si">}</span><span class="s"> more</span><span class="sh">"</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">)):</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">seq</span><span class="p">[:</span><span class="n">max_items</span><span class="p">]):</span>
                <span class="k">yield</span> <span class="sa">f</span><span class="sh">"</span><span class="s">[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">]</span><span class="sh">"</span><span class="p">,</span> <span class="n">v</span>
            <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_items</span><span class="p">:</span>
                <span class="k">yield</span> <span class="sh">"</span><span class="s">â€¦(truncated)</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">-</span> <span class="n">max_items</span><span class="si">}</span><span class="s"> more</span><span class="sh">"</span>
            <span class="k">return</span>

    <span class="c1"># ì¼ë°˜ ê°ì²´ ë©¤ë²„
</span>    <span class="k">yield</span> <span class="k">from</span> <span class="nf">_iter_object_members</span><span class="p">(</span>
        <span class="n">node</span><span class="p">,</span>
        <span class="n">include_private</span><span class="o">=</span><span class="n">include_private</span><span class="p">,</span>
        <span class="n">include_dunder</span><span class="o">=</span><span class="n">include_dunder</span><span class="p">,</span>
        <span class="n">include_properties</span><span class="o">=</span><span class="n">include_properties</span><span class="p">,</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">attr_tree</span><span class="p">(</span>
    <span class="n">obj</span><span class="p">,</span>
    <span class="n">root_name</span><span class="o">=</span><span class="sh">"</span><span class="s">root</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">max_items</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">include_private</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">include_dunder</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">include_properties</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">leaf_value_maxlen</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    </span><span class="sh">'</span><span class="s">ì†ì„± dict</span><span class="sh">'</span><span class="s"> ê¸°ë°˜ ë²”ìš© íŠ¸ë¦¬ ì¶œë ¥.
    - ë‚´ë¶€ ë…¸ë“œ:  name: ClassName
    - leaf ë…¸ë“œ: name: ClassName(value_repr)
    </span><span class="sh">"""</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">add_leaf_line</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">is_last</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="nf">_class_name</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="p">(</span><span class="sh">"</span><span class="s">â””â”€â”€ </span><span class="sh">"</span> <span class="k">if</span> <span class="n">is_last</span> <span class="k">else</span> <span class="sh">"</span><span class="s">â”œâ”€â”€ </span><span class="sh">"</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">cls</span><span class="si">}</span><span class="s">(</span><span class="si">{</span><span class="nf">_short_repr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">leaf_value_maxlen</span><span class="p">)</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_inner_line</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">is_last</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="nf">_class_name</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="p">(</span><span class="sh">"</span><span class="s">â””â”€â”€ </span><span class="sh">"</span> <span class="k">if</span> <span class="n">is_last</span> <span class="k">else</span> <span class="sh">"</span><span class="s">â”œâ”€â”€ </span><span class="sh">"</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">cls</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="sh">""</span><span class="p">,</span> <span class="n">is_last</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="c1"># ê¹Šì´ ì œí•œ ë˜ëŠ” ì›ì‹œí˜•ì´ë©´ leaf
</span>        <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">max_depth</span> <span class="ow">or</span> <span class="nf">_is_primitive</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="nf">add_leaf_line</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">is_last</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># ì‚¬ì´í´ ë°©ì§€
</span>        <span class="n">oid</span> <span class="o">=</span> <span class="nf">id</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
            <span class="nf">add_inner_line</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">is_last</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">child_prefix</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="p">(</span><span class="sh">"</span><span class="s">    </span><span class="sh">"</span> <span class="k">if</span> <span class="n">is_last</span> <span class="k">else</span> <span class="sh">"</span><span class="s">â”‚   </span><span class="sh">"</span><span class="p">)</span>
            <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">child_prefix</span> <span class="o">+</span> <span class="sh">"</span><span class="s">â†ª (cycle)</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">seen</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>

        <span class="c1"># ìì‹ ë¯¸ë¦¬ êµ¬í•´ë³´ê³ , ì—†ìœ¼ë©´ leaf ì·¨ê¸‰(+ê°’ í‘œì‹œ)
</span>        <span class="n">children</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">_iter_children</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="n">include_private</span><span class="o">=</span><span class="n">include_private</span><span class="p">,</span>
            <span class="n">include_dunder</span><span class="o">=</span><span class="n">include_dunder</span><span class="p">,</span>
            <span class="n">include_properties</span><span class="o">=</span><span class="n">include_properties</span><span class="p">,</span>
            <span class="n">max_items</span><span class="o">=</span><span class="n">max_items</span><span class="p">,</span>
        <span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">children</span><span class="p">:</span>
            <span class="nf">add_leaf_line</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">is_last</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># ë‚´ë¶€ ë…¸ë“œ
</span>        <span class="nf">add_inner_line</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">is_last</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">child_prefix</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="p">(</span><span class="sh">"</span><span class="s">    </span><span class="sh">"</span> <span class="k">if</span> <span class="n">is_last</span> <span class="k">else</span> <span class="sh">"</span><span class="s">â”‚   </span><span class="sh">"</span><span class="p">)</span>

        <span class="n">L</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">child_name</span><span class="p">,</span> <span class="n">child_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">children</span><span class="p">):</span>
            <span class="nf">walk</span><span class="p">(</span><span class="n">child_name</span><span class="p">,</span> <span class="n">child_val</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">child_prefix</span><span class="p">,</span> <span class="n">is_last</span><span class="o">=</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="nf">walk</span><span class="p">(</span><span class="n">root_name</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="sh">""</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">print_attr_tree</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">attr_tree</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="ì˜ˆì‹œ">ì˜ˆì‹œ</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">y</span><span class="sh">"</span><span class="p">,)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span> <span class="n">self</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">k</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span>
        <span class="n">self</span><span class="p">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">9</span>
        <span class="n">self</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="nc">B</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">lst</span> <span class="o">=</span> <span class="p">[{</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_hidden</span> <span class="o">=</span> <span class="sh">"</span><span class="s">secret</span><span class="sh">"</span>

<span class="n">a</span> <span class="o">=</span> <span class="nc">A</span><span class="p">()</span>
<span class="nf">print_attr_tree</span><span class="p">(</span>
    <span class="n">a</span><span class="p">,</span>
    <span class="n">root_name</span><span class="o">=</span><span class="sh">"</span><span class="s">A</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">include_private</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>    <span class="c1"># _hidden ìˆ¨ê¹€
</span>    <span class="n">include_dunder</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>     <span class="c1"># __dunder__ ìˆ¨ê¹€
</span>    <span class="n">include_properties</span><span class="o">=</span><span class="bp">False</span>
<span class="p">)</span>
</code></pre></div></div>

<p>ì¶œë ¥(ì˜ˆ):</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">â””â”€â”€</span> <span class="n">A</span><span class="p">:</span> <span class="n">A</span>
    <span class="err">â”œâ”€â”€</span> <span class="n">name</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="sh">'</span><span class="s">Alice</span><span class="sh">'</span><span class="p">)</span>
    <span class="err">â”œâ”€â”€</span> <span class="n">age</span><span class="p">:</span> <span class="nf">int</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
    <span class="err">â”œâ”€â”€</span> <span class="n">x</span><span class="p">:</span> <span class="n">B</span>
    <span class="err">â”‚</span>   <span class="err">â””â”€â”€</span> <span class="n">y</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="err">â”‚</span>       <span class="err">â””â”€â”€</span> <span class="sh">'</span><span class="s">k</span><span class="sh">'</span><span class="p">:</span> <span class="nb">list</span>
    <span class="err">â”‚</span>           <span class="err">â”œâ”€â”€</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="nf">int</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="err">â”‚</span>           <span class="err">â”œâ”€â”€</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nf">int</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="err">â”‚</span>           <span class="err">â””â”€â”€</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nf">int</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="err">â””â”€â”€</span> <span class="n">lst</span><span class="p">:</span> <span class="nb">list</span>
        <span class="err">â”œâ”€â”€</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="nb">dict</span>
        <span class="err">â”‚</span>   <span class="err">â””â”€â”€</span> <span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">:</span> <span class="nf">int</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="err">â””â”€â”€</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nb">tuple</span>
            <span class="err">â”œâ”€â”€</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="nf">int</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="err">â””â”€â”€</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nf">int</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ì°¸ê³ -step-by-step">ì°¸ê³  (step-by-step)</h3>

<ol>
  <li>
    <p><strong>leaf íŒë‹¨</strong> : (a) ì›ì‹œí˜•(PRIMITIVES), (b) <code class="language-plaintext highlighter-rouge">max_depth</code> ë„ë‹¬, (c) ìì‹ íƒìƒ‰ ê²°ê³¼ ì—†ìŒ â†’ ê°’ê¹Œì§€ ì¶œë ¥.</p>
  </li>
  <li>
    <p><strong>ë‚´ë¶€ ë…¸ë“œ</strong> : ìì‹ì´ ìˆìœ¼ë©´ <code class="language-plaintext highlighter-rouge">name: ClassName</code>ë§Œ ì°ê³  ì•„ë˜ë¡œ ì¬ê·€.</p>
  </li>
  <li>
    <p><strong>ì‚¬ì´í´</strong> : ì´ë¯¸ ë³¸ ê°ì²´ë©´ <code class="language-plaintext highlighter-rouge">(cycle)</code> í‘œì‹œí•˜ê³  ì¤‘ë‹¨.</p>
  </li>
  <li>
    <p><strong>ê°€ì‹œì„± ì˜µì…˜</strong> : <code class="language-plaintext highlighter-rouge">_private</code>, <code class="language-plaintext highlighter-rouge">__dunder__</code>, <code class="language-plaintext highlighter-rouge">@property</code> í¬í•¨ ì—¬ë¶€ ì¡°ì ˆ.</p>
  </li>
  <li>
    <p><strong>ê¸¸ì´ ì œí•œ</strong> : <code class="language-plaintext highlighter-rouge">leaf_value_maxlen</code>ìœ¼ë¡œ leaf ê°’ <code class="language-plaintext highlighter-rouge">repr</code> ê¸¸ì´ ì œì–´.</p>
  </li>
</ol>

<p>ë” ì›í•˜ëŠ” í¬ë§·(ì˜ˆ: <code class="language-plaintext highlighter-rouge">key="..."</code> ë”°ì˜´í‘œ í†µì¼, dict í‚¤ ì •ë ¬, íŠ¹ì • íƒ€ì… ì¶•ì•½ ë“±) ìˆìœ¼ë©´ ë§í•´ì¤˜â€”ë°”ë¡œ ë°˜ì˜í• ê²Œ!</p>

<p class="chat--user">

ê°€ì¥ root ì•ì— ã„´â€” ê°€ ë“¤ì–´ê°€ì„œ ì „ì²´ì ìœ¼ë¡œ ì¸ë´íŠ¸ê°€ ë„ˆë¬´ ë§ì•„ì ¸. ì²« ë£¨íŠ¸ëŠ” ì„  ì—†ì´ ê·¸ëƒ¥ ë°”ë¡œ A: A ì´ë ‡ê²Œ ê°€ê²Œí•´ì¤˜. í•˜ìœ„ ì†ì„±ë“¤ë„ 1ì¹¸ì”© ì¸ë±íŠ¸ ë‹¹ê¸°ê³ 

</p>

<p>ì¢‹ì•„! â€œë£¨íŠ¸ì—ëŠ” ì„ (â””/â”œ) ì—†ì´ ë°”ë¡œ <code class="language-plaintext highlighter-rouge">A: A</code>ë¡œ ì‹œì‘â€í•˜ê³ , â€œí•˜ìœ„ ì†ì„±ë„ í•œ ì¹¸(ë ˆë²¨) ëœ ë“¤ì—¬ì“°ê¸°â€ ë˜ë„ë¡ ì½”ë“œë¥¼ ì†ë´¤ì–´. í•µì‹¬ì€ <strong>ë£¨íŠ¸ ë¼ë²¨ì€ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ì¶œë ¥</strong> í•˜ê³ , <strong>ìì‹ë¶€í„° ë¸Œëœì¹˜ ê¸°í˜¸</strong> ë¥¼ ë¶™ì´ëŠ” ê±°ì•¼.</p>

<p>ì•„ë˜ëŠ” <strong>ë°”ë€ ì „ì²´ ì½”ë“œ</strong>(ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ìŒ):</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">is_dataclass</span><span class="p">,</span> <span class="n">fields</span> <span class="k">as</span> <span class="n">dc_fields</span>
<span class="kn">from</span> <span class="n">collections.abc</span> <span class="kn">import</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Iterable</span>

<span class="n">PRIMITIVES</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nf">type</span><span class="p">(</span><span class="bp">None</span><span class="p">),</span> <span class="nb">bytes</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_is_primitive</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">PRIMITIVES</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_class_name</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">type</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">__name__</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">&lt;unknown&gt;</span><span class="sh">"</span>

<span class="k">def</span> <span class="nf">_short_repr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nf">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="sh">"</span><span class="s">&lt;?&gt;</span><span class="sh">"</span>
    <span class="k">if</span> <span class="n">maxlen</span> <span class="ow">and</span> <span class="nf">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxlen</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="n">maxlen</span><span class="p">]</span> <span class="o">+</span> <span class="sh">"</span><span class="s">â€¦</span><span class="sh">"</span>
    <span class="k">return</span> <span class="n">s</span>

<span class="k">def</span> <span class="nf">_iter_object_members</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">include_private</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include_dunder</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include_properties</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">yielded</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>

    <span class="k">if</span> <span class="nf">is_dataclass</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nf">dc_fields</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">name</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_dunder</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_private</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="n">yielded</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span>

    <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">__dict__</span><span class="sh">"</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nf">vars</span><span class="p">(</span><span class="n">o</span><span class="p">).</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_dunder</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_private</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="n">yielded</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span>

    <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">__slots__</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">__slots__</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">slots</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">slots</span> <span class="o">=</span> <span class="p">[</span><span class="n">slots</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">yielded</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_dunder</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_private</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">yielded</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span>

    <span class="k">if</span> <span class="n">include_properties</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nf">dir</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">yielded</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_dunder</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_private</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="nf">type</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">property</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">continue</span>

<span class="k">def</span> <span class="nf">_iter_children</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">include_private</span><span class="p">,</span> <span class="n">include_dunder</span><span class="p">,</span> <span class="n">include_properties</span><span class="p">,</span> <span class="n">max_items</span><span class="p">):</span>
    <span class="c1"># dictë¥˜
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="nf">items</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">[:</span><span class="n">max_items</span><span class="p">]):</span>
            <span class="k">yield</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">k</span><span class="si">!r}</span><span class="sh">"</span><span class="p">,</span> <span class="n">v</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_items</span><span class="p">:</span>
            <span class="k">yield</span> <span class="sh">"</span><span class="s">â€¦(truncated)</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">-</span> <span class="n">max_items</span><span class="si">}</span><span class="s"> more</span><span class="sh">"</span>
        <span class="k">return</span>

    <span class="c1"># ì‹œí€€ìŠ¤/ì„¸íŠ¸ (ë¬¸ìì—´ë¥˜ ì œì™¸)
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">,</span> <span class="nb">memoryview</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">seq</span><span class="p">[:</span><span class="n">max_items</span><span class="p">]):</span>
                <span class="k">yield</span> <span class="sa">f</span><span class="sh">"</span><span class="s">[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">]</span><span class="sh">"</span><span class="p">,</span> <span class="n">v</span>
            <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_items</span><span class="p">:</span>
                <span class="k">yield</span> <span class="sh">"</span><span class="s">â€¦(truncated)</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">-</span> <span class="n">max_items</span><span class="si">}</span><span class="s"> more</span><span class="sh">"</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">)):</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">seq</span><span class="p">[:</span><span class="n">max_items</span><span class="p">]):</span>
                <span class="k">yield</span> <span class="sa">f</span><span class="sh">"</span><span class="s">[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">]</span><span class="sh">"</span><span class="p">,</span> <span class="n">v</span>
            <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_items</span><span class="p">:</span>
                <span class="k">yield</span> <span class="sh">"</span><span class="s">â€¦(truncated)</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">-</span> <span class="n">max_items</span><span class="si">}</span><span class="s"> more</span><span class="sh">"</span>
            <span class="k">return</span>

    <span class="c1"># ì¼ë°˜ ê°ì²´ ë©¤ë²„
</span>    <span class="k">yield</span> <span class="k">from</span> <span class="nf">_iter_object_members</span><span class="p">(</span>
        <span class="n">node</span><span class="p">,</span>
        <span class="n">include_private</span><span class="o">=</span><span class="n">include_private</span><span class="p">,</span>
        <span class="n">include_dunder</span><span class="o">=</span><span class="n">include_dunder</span><span class="p">,</span>
        <span class="n">include_properties</span><span class="o">=</span><span class="n">include_properties</span><span class="p">,</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">attr_tree</span><span class="p">(</span>
    <span class="n">obj</span><span class="p">,</span>
    <span class="n">root_name</span><span class="o">=</span><span class="sh">"</span><span class="s">root</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">max_items</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">include_private</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">include_dunder</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">include_properties</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">leaf_value_maxlen</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    </span><span class="sh">'</span><span class="s">ì†ì„± dict</span><span class="sh">'</span><span class="s"> ê¸°ë°˜ ë²”ìš© íŠ¸ë¦¬ ì¶œë ¥.
    - ë£¨íŠ¸:  name: ClassName  (ë¸Œëœì¹˜ ì„  ì—†ìŒ)
    - ë‚´ë¶€ ë…¸ë“œ:  name: ClassName
    - leaf ë…¸ë“œ: name: ClassName(value_repr)
    </span><span class="sh">"""</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">add_leaf_line</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">is_last</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="nf">_class_name</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="p">(</span><span class="sh">"</span><span class="s">â””â”€â”€ </span><span class="sh">"</span> <span class="k">if</span> <span class="n">is_last</span> <span class="k">else</span> <span class="sh">"</span><span class="s">â”œâ”€â”€ </span><span class="sh">"</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">cls</span><span class="si">}</span><span class="s">(</span><span class="si">{</span><span class="nf">_short_repr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">leaf_value_maxlen</span><span class="p">)</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_inner_line</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">is_last</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="nf">_class_name</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="p">(</span><span class="sh">"</span><span class="s">â””â”€â”€ </span><span class="sh">"</span> <span class="k">if</span> <span class="n">is_last</span> <span class="k">else</span> <span class="sh">"</span><span class="s">â”œâ”€â”€ </span><span class="sh">"</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">cls</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="sh">""</span><span class="p">,</span> <span class="n">is_last</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="c1"># ê¹Šì´ ì œí•œ ë˜ëŠ” ì›ì‹œí˜•ì´ë©´ leaf
</span>        <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">max_depth</span> <span class="ow">or</span> <span class="nf">_is_primitive</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="nf">add_leaf_line</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">is_last</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">oid</span> <span class="o">=</span> <span class="nf">id</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
            <span class="nf">add_inner_line</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">is_last</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">child_prefix</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="p">(</span><span class="sh">"</span><span class="s">    </span><span class="sh">"</span> <span class="k">if</span> <span class="n">is_last</span> <span class="k">else</span> <span class="sh">"</span><span class="s">â”‚   </span><span class="sh">"</span><span class="p">)</span>
            <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">child_prefix</span> <span class="o">+</span> <span class="sh">"</span><span class="s">â†ª (cycle)</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">seen</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>

        <span class="n">children</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">_iter_children</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="n">include_private</span><span class="o">=</span><span class="n">include_private</span><span class="p">,</span>
            <span class="n">include_dunder</span><span class="o">=</span><span class="n">include_dunder</span><span class="p">,</span>
            <span class="n">include_properties</span><span class="o">=</span><span class="n">include_properties</span><span class="p">,</span>
            <span class="n">max_items</span><span class="o">=</span><span class="n">max_items</span><span class="p">,</span>
        <span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">children</span><span class="p">:</span>
            <span class="nf">add_leaf_line</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">is_last</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># ë‚´ë¶€ ë…¸ë“œ
</span>        <span class="nf">add_inner_line</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">is_last</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">child_prefix</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="p">(</span><span class="sh">"</span><span class="s">    </span><span class="sh">"</span> <span class="k">if</span> <span class="n">is_last</span> <span class="k">else</span> <span class="sh">"</span><span class="s">â”‚   </span><span class="sh">"</span><span class="p">)</span>

        <span class="n">L</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">child_name</span><span class="p">,</span> <span class="n">child_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">children</span><span class="p">):</span>
            <span class="nf">walk</span><span class="p">(</span><span class="n">child_name</span><span class="p">,</span> <span class="n">child_val</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">child_prefix</span><span class="p">,</span> <span class="n">is_last</span><span class="o">=</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># --- ë£¨íŠ¸ ì¶œë ¥ (ë¸Œëœì¹˜ ì„ /ì¸ë´íŠ¸ ì—†ìŒ) ---
</span>    <span class="n">root_cls</span> <span class="o">=</span> <span class="nf">_class_name</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">if</span> <span class="nf">_is_primitive</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">root_name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">root_cls</span><span class="si">}</span><span class="s">(</span><span class="si">{</span><span class="nf">_short_repr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">leaf_value_maxlen</span><span class="p">)</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">root_name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">root_cls</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># ë£¨íŠ¸ì˜ ìì‹ë¶€í„°ëŠ” ë¸Œëœì¹˜ ê¸°í˜¸ë¥¼ ì‚¬ìš©í•˜ë˜, ì¶”ê°€ ì¸ë´íŠ¸ ì—†ì´ ë°”ë¡œ ì‹œì‘
</span>    <span class="n">root_children</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">_iter_children</span><span class="p">(</span>
        <span class="n">obj</span><span class="p">,</span>
        <span class="n">include_private</span><span class="o">=</span><span class="n">include_private</span><span class="p">,</span>
        <span class="n">include_dunder</span><span class="o">=</span><span class="n">include_dunder</span><span class="p">,</span>
        <span class="n">include_properties</span><span class="o">=</span><span class="n">include_properties</span><span class="p">,</span>
        <span class="n">max_items</span><span class="o">=</span><span class="n">max_items</span><span class="p">,</span>
    <span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">root_children</span><span class="p">:</span>
        <span class="c1"># ìì‹ì´ ì—†ëŠ” ë¹„-ì›ì‹œ ë£¨íŠ¸ (ì˜ˆ: ë¹ˆ dict ë“±)
</span>        <span class="n">lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">(empty)</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="n">L</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">root_children</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">child_name</span><span class="p">,</span> <span class="n">child_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">root_children</span><span class="p">):</span>
        <span class="c1"># prefix=""ë¡œ ì‹œì‘ â†’ í•˜ìœ„ê°€ í•œ ì¹¸(ë ˆë²¨) ë‹¹ê²¨ì§„ íš¨ê³¼
</span>        <span class="nf">walk</span><span class="p">(</span><span class="n">child_name</span><span class="p">,</span> <span class="n">child_val</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="sh">""</span><span class="p">,</span> <span class="n">is_last</span><span class="o">=</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">print_attr_tree</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">attr_tree</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="ë™ì‘-í™•ì¸-ì˜ˆì‹œ">ë™ì‘ í™•ì¸ ì˜ˆì‹œ</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">y</span><span class="sh">"</span><span class="p">,)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span> <span class="n">self</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">k</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span>
        <span class="n">self</span><span class="p">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">9</span>
        <span class="n">self</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="nc">B</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">lst</span> <span class="o">=</span> <span class="p">[{</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_hidden</span> <span class="o">=</span> <span class="sh">"</span><span class="s">secret</span><span class="sh">"</span>

<span class="n">a</span> <span class="o">=</span> <span class="nc">A</span><span class="p">()</span>
<span class="nf">print_attr_tree</span><span class="p">(</span>
    <span class="n">a</span><span class="p">,</span>
    <span class="n">root_name</span><span class="o">=</span><span class="sh">"</span><span class="s">A</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">include_private</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">include_dunder</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">include_properties</span><span class="o">=</span><span class="bp">False</span>
<span class="p">)</span>
</code></pre></div></div>

<h4 id="ê¸°ëŒ€-ì¶œë ¥ì¸ë´íŠ¸-í•œ-ë‹¨ê³„-ê°ì†Œ--ë£¨íŠ¸ì—-ì„ -ì—†ìŒ">ê¸°ëŒ€ ì¶œë ¥(ì¸ë´íŠ¸ í•œ ë‹¨ê³„ ê°ì†Œ + ë£¨íŠ¸ì— ì„  ì—†ìŒ)</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">A</span><span class="p">:</span> <span class="n">A</span>
<span class="err">â”œâ”€â”€</span> <span class="n">name</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="sh">'</span><span class="s">Alice</span><span class="sh">'</span><span class="p">)</span>
<span class="err">â”œâ”€â”€</span> <span class="n">age</span><span class="p">:</span> <span class="nf">int</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="err">â”œâ”€â”€</span> <span class="n">x</span><span class="p">:</span> <span class="n">B</span>
<span class="err">â”‚</span>   <span class="err">â””â”€â”€</span> <span class="n">y</span><span class="p">:</span> <span class="nb">dict</span>
<span class="err">â”‚</span>       <span class="err">â””â”€â”€</span> <span class="sh">'</span><span class="s">k</span><span class="sh">'</span><span class="p">:</span> <span class="nb">list</span>
<span class="err">â”‚</span>           <span class="err">â”œâ”€â”€</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="nf">int</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="err">â”‚</span>           <span class="err">â”œâ”€â”€</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nf">int</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="err">â”‚</span>           <span class="err">â””â”€â”€</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nf">int</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="err">â””â”€â”€</span> <span class="n">lst</span><span class="p">:</span> <span class="nb">list</span>
    <span class="err">â”œâ”€â”€</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="nb">dict</span>
    <span class="err">â”‚</span>   <span class="err">â””â”€â”€</span> <span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">:</span> <span class="nf">int</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="err">â””â”€â”€</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nb">tuple</span>
        <span class="err">â”œâ”€â”€</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="nf">int</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="err">â””â”€â”€</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nf">int</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<p>í•„ìš”í•˜ë©´ ë£¨íŠ¸ë§Œ ê°’ í‘œì‹œ ì—¬ë¶€(ì§€ê¸ˆì€ ì›ì‹œí˜• ë£¨íŠ¸ì¼ ë•Œë§Œ <code class="language-plaintext highlighter-rouge">type(value)(repr)</code> í‘œì‹œ), í‚¤ ì •ë ¬ ì˜µì…˜, set ì •ë ¬, ê¸¸ì´ ì œí•œ ë“±ì„ ë” ë„£ì–´ì¤„ ìˆ˜ë„ ìˆì–´. ì›í•˜ëŠ” í¬ë§· ìˆìœ¼ë©´ ë§í•´ì¤˜!</p>

<p class="chat--user">

ì•„ ê·¸ëŸ°ë° @dataclassì— ëŒ€í•´ì„œ ì´ê±¸ ì ìš©í–ˆë”ë‹ˆ ê°™ì€ ì†ì„±ì´ 2ë²ˆì”© ë‚˜ì˜¤ë„¤

</p>

<p>ë§ì•„ìš”â€”ê·¸ í˜„ìƒì€ <strong>dataclass í•„ë“œë¥¼ ë¨¼ì € yield</strong> í•œ ë’¤ì—, ë‹¤ì‹œ <code class="language-plaintext highlighter-rouge">__dict__</code>ì—ì„œ <strong>ê°™ì€ ì´ë¦„ì„ í•œ ë²ˆ ë”</strong> ë‚´ë³´ë‚´ì„œ ìƒê¸´ ì¤‘ë³µì´ì—ìš”.<br />
í•´ê²°ì€ ê°„ë‹¨í•©ë‹ˆë‹¤: <code class="language-plaintext highlighter-rouge">__dict__</code>ë¥¼ ìˆœíšŒí•  ë•Œ <strong>ì´ë¯¸ ë‚¸ ì´ë¦„ì´ë©´ ê±´ë„ˆë›°ê¸°</strong> ë§Œ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤. (<code class="language-plaintext highlighter-rouge">__slots__</code>/<code class="language-plaintext highlighter-rouge">property</code> ìª½ì€ ì´ë¯¸ ì¤‘ë³µ ë°©ì§€ê°€ ë˜ì–´ ìˆì—ˆì–´ìš”.)</p>

<p>ì•„ë˜ì²˜ëŸ¼ <code class="language-plaintext highlighter-rouge">_iter_object_members</code> í•¨ìˆ˜ë§Œ êµì²´í•˜ì„¸ìš”. (ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” ê·¸ëŒ€ë¡œ)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">_iter_object_members</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">include_private</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include_dunder</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include_properties</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">yielded</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>

    <span class="c1"># 1) dataclass ìš°ì„ 
</span>    <span class="k">if</span> <span class="nf">is_dataclass</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nf">dc_fields</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">name</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_dunder</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_private</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="n">yielded</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span>

    <span class="c1"># 2) __dict__ (âš ï¸ ì¶”ê°€ëœ ì¤‘ë³µ ë°©ì§€)
</span>    <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">__dict__</span><span class="sh">"</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nf">vars</span><span class="p">(</span><span class="n">o</span><span class="p">).</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">yielded</span><span class="p">:</span>           <span class="c1"># &lt;&lt;&lt; ì¤‘ë³µ ë°©ì§€ (í•µì‹¬ ìˆ˜ì •)
</span>                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_dunder</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_private</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="n">yielded</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span>

    <span class="c1"># 3) __slots__ (ì´ë¯¸ ì¤‘ë³µ ë°©ì§€ ìˆìŒ)
</span>    <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">__slots__</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="sh">"</span><span class="s">__slots__</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">slots</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">slots</span> <span class="o">=</span> <span class="p">[</span><span class="n">slots</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">yielded</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_dunder</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_private</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">yielded</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span>

    <span class="c1"># 4) @property (ì´ë¯¸ ì¤‘ë³µ ë°©ì§€ ìˆìŒ)
</span>    <span class="k">if</span> <span class="n">include_properties</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nf">dir</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">yielded</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_dunder</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_private</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">__</span><span class="sh">"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="nf">type</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">property</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">yielded</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>     <span class="c1"># (ì¼ê´€ì„±)
</span>                    <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">continue</span>
</code></pre></div></div>

<h3 id="ì™œ-ì´ê²Œ-ë§ë‚˜-step-by-step">ì™œ ì´ê²Œ ë§ë‚˜ (step-by-step)</h3>

<ol>
  <li>
    <p><strong>dataclass í•„ë“œ</strong> ë¥¼ ë¨¼ì € ë‚´ë³´ëƒ„(ì›í•˜ëŠ” ìˆœì„œ).</p>
  </li>
  <li>
    <p>ê°™ì€ ì´ë¦„ì´ <code class="language-plaintext highlighter-rouge">__dict__</code>ì—ë„ ìˆìœ¼ë¯€ë¡œ, <code class="language-plaintext highlighter-rouge">yielded</code>ì— ê¸°ë¡ëœ ì´ë¦„ì´ë©´ <strong>ê±´ë„ˆëœ€</strong>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">__slots__</code>/<code class="language-plaintext highlighter-rouge">property</code>ë„ ë™ì¼í•œ ê·œì¹™ìœ¼ë¡œ <strong>ì¤‘ë³µ ë°©ì§€</strong>.</p>
  </li>
  <li>
    <p>ê²°ê³¼: dataclassì—ì„œ <strong>ì¤‘ë³µ ì—†ì´</strong> í•œ ë²ˆë§Œ í‘œê¸°ë©ë‹ˆë‹¤.</p>
  </li>
</ol>

<p>ì›í•˜ë©´ dataclass + <code class="language-plaintext highlighter-rouge">slots=True</code> ì¡°í•©(íŒŒì´ì¬ 3.10+)ë„ í…ŒìŠ¤íŠ¸ ì˜ˆì œ ë“œë¦´ê²Œìš”.</p>]]></content><author><name>hvppyarchive</name></author><category term="python" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">PyVerilog AST ë³€í™˜</title><link href="https://hvppyarchive.github.io/verilog/pyverilog-ir/" rel="alternate" type="text/html" title="PyVerilog AST ë³€í™˜" /><published>2025-08-20T14:24:23+09:00</published><updated>2025-08-20T14:24:23+09:00</updated><id>https://hvppyarchive.github.io/verilog/pyverilog-ir</id><content type="html" xml:base="https://hvppyarchive.github.io/verilog/pyverilog-ir/"><![CDATA[<p class="chat--user">

PyVerilogì˜ astê°€ ìƒê°ë³´ë‹¤ ì •ê·œí™”(í‘œì¤€í™”) ë˜ì–´ ìˆì§€ ì•Šì•„ì„œ ì˜ˆì™¸ì²˜ë¦¬í•  ê²ƒì´ ë„ˆë¬´ ë§ì•„.(e.g. portê°€ IO í¬í•¨ì¸ì§€, ë³¸ë¬¸ì— ì¨ìˆëŠ”ì§€ ë“±ë“±) ì¢€ ë” í‘œì¤€í™”ëœ í˜•ì‹ìœ¼ë¡œ ì‰½ê²Œ traverseí•  ìˆ˜ ìˆëŠ” í˜•íƒœë¡œ conversion í•˜ëŠ” ê¸°ëŠ¥ì„ ê°œë°œí•˜ë ¤ê³  í•´. ë“¤ì–´ê°€ì•¼í•  ì‚¬í•­ë“¤: - port(ìˆœì„œ, í¬íŠ¸ëª…, width(msb, lsb), in/out/inout) - ë‚´ë¶€ instance(submodule, port-argument mapping) - ë‚´ë¶€ nets(width(msb, lsb)) 

</p>

<p>ì¢‹ì•„ìš”â€”PyVerilog ASTì˜ ë“¤ì­‰ë‚ ì­‰í•¨(ANSI/Non-ANSI í¬íŠ¸ ì„ ì–¸, í¬ì§€ì…”ë„/ë„¤ì„ë“œ ì¸ìŠ¤í„´ìŠ¤, width í‘œí˜„ì‹ ë“±) ë•Œë¬¸ì— ì˜ˆì™¸ê°€ ë§ì£ . ì•„ë˜ì²˜ëŸ¼ <strong>í‘œì¤€í™”ëœ ì¤‘ê°„ í‘œí˜„(IR)</strong>ë¡œ ë³€í™˜í•˜ëŠ” íŒŒì´í”„ë¼ì¸ì„ ì œì•ˆí•©ë‹ˆë‹¤. ë°”ë¡œ ì“¸ ìˆ˜ ìˆëŠ” <strong>ì°¸ì¡° êµ¬í˜„ ì½”ë“œ</strong> ë„ ë„£ì—ˆì–´ìš”.</p>

<hr />

<h1 id="ëª©í‘œ">ëª©í‘œ</h1>

<ul>
  <li>
    <p>ëª¨ë“ˆ ë‹¨ìœ„ë¡œ <strong>ì¼ê´€ëœ JSON IR</strong> ì œê³µ</p>
  </li>
  <li>
    <p>í¬íŠ¸: <strong>ìˆœì„œ(index), ì´ë¦„, ë°©í–¥, í­(msb/lsb, ì •ìˆ˜ í‰ê°€ ê°€ëŠ¥í•˜ë©´ width), signed ì—¬ë¶€</strong></p>
  </li>
  <li>
    <p>ë‚´ë¶€ ì¸ìŠ¤í„´ìŠ¤: <strong>ì„œë¸Œëª¨ë“ˆëª…, ì¸ìŠ¤í„´ìŠ¤ëª…, íŒŒë¼ë¯¸í„° override, í¬íŠ¸-ì•„ê·œë¨¼íŠ¸ ë§¤í•‘(í¬ì§€ì…”ë„â†’ë„¤ì„ë“œ ìë™ ì¹˜í™˜)</strong></p>
  </li>
  <li>
    <p>ë‚´ë¶€ nets: <strong>wire/reg ë“±, ì´ë¦„, í­(msb/lsb, width)</strong></p>
  </li>
</ul>

<hr />

<h1 id="ì„¤ê³„-ìŠ¤í…ë³„">ì„¤ê³„ (ìŠ¤í…ë³„)</h1>

<ol>
  <li><strong>IR ìŠ¤í‚¤ë§ˆ ì •ì˜</strong></li>
</ol>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"modules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"&lt;modname&gt;"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"WIDTH"</span><span class="p">,</span><span class="nl">"value_str"</span><span class="p">:</span><span class="s2">"8"</span><span class="p">,</span><span class="nl">"value"</span><span class="p">:</span><span class="mi">8</span><span class="p">}],</span><span class="w">
      </span><span class="nl">"ports"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nl">"index"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"clk"</span><span class="p">,</span><span class="nl">"dir"</span><span class="p">:</span><span class="s2">"input"</span><span class="p">,</span><span class="nl">"signed"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
         </span><span class="nl">"msb_str"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="nl">"lsb_str"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="nl">"msb"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nl">"lsb"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nl">"width"</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"nets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"data"</span><span class="p">,</span><span class="nl">"kind"</span><span class="p">:</span><span class="s2">"wire"</span><span class="p">,</span><span class="nl">"signed"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
         </span><span class="nl">"msb_str"</span><span class="p">:</span><span class="s2">"WIDTH-1"</span><span class="p">,</span><span class="nl">"lsb_str"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="nl">"msb"</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="nl">"lsb"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nl">"width"</span><span class="p">:</span><span class="mi">8</span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"instances"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nl">"inst"</span><span class="p">:</span><span class="s2">"u0"</span><span class="p">,</span><span class="nl">"module"</span><span class="p">:</span><span class="s2">"child"</span><span class="p">,</span><span class="nl">"param_overrides"</span><span class="p">:[{</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"WIDTH"</span><span class="p">,</span><span class="nl">"value_str"</span><span class="p">:</span><span class="s2">"4"</span><span class="p">,</span><span class="nl">"value"</span><span class="p">:</span><span class="mi">4</span><span class="p">}],</span><span class="w">
         </span><span class="nl">"connections"</span><span class="p">:[{</span><span class="nl">"port"</span><span class="p">:</span><span class="s2">"a"</span><span class="p">,</span><span class="nl">"expr_str"</span><span class="p">:</span><span class="s2">"data[3:0]"</span><span class="p">},{</span><span class="nl">"port"</span><span class="p">:</span><span class="s2">"b"</span><span class="p">,</span><span class="nl">"expr_str"</span><span class="p">:</span><span class="s2">"clk"</span><span class="p">}]}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">*_str</code>ëŠ” ì›ë³¸ í‘œí˜„ì‹ ë¬¸ìì—´, <code class="language-plaintext highlighter-rouge">msb/lsb/width/value</code>ëŠ” <strong>ê°€ëŠ¥í•˜ë©´ ì •ìˆ˜ í‰ê°€</strong> , ì‹¤íŒ¨ ì‹œ <code class="language-plaintext highlighter-rouge">null</code>.</p>
  </li>
  <li>
    <p>í¬ì§€ì…”ë„ ì—°ê²°ì€ <strong>ì„œë¸Œëª¨ë“ˆ í¬íŠ¸ ìˆœì„œ</strong> ë¥¼ ì´ìš©í•´ ë„¤ì„ë“œë¡œ ë³€í™˜.</p>
  </li>
</ul>

<ol>
  <li><strong>ë‘ ë‹¨ê³„ ìˆ˜ì§‘</strong></li>
</ol>

<ul>
  <li>
    <p><strong>1íŒ¨ìŠ¤</strong> : ëª¨ë“  ëª¨ë“ˆì˜ í¬íŠ¸ ìˆœì„œ/ê¸°ë³¸ íŒŒë¼ë¯¸í„° í…Œì´ë¸” ìƒì„±(í¬ì§€ì…”ë„ ë§¤í•‘ìš©).</p>
  </li>
  <li>
    <p><strong>2íŒ¨ìŠ¤</strong> : ê° ëª¨ë“ˆì— ëŒ€í•´ í¬íŠ¸/ë„·/ì¸ìŠ¤í„´ìŠ¤ í‘œì¤€í™”.</p>
  </li>
</ul>

<ol>
  <li><strong>í¬íŠ¸ ì •ê·œí™”</strong></li>
</ol>

<ul>
  <li>
    <p>ANSI(<code class="language-plaintext highlighter-rouge">Ioport</code>)ì™€ Non-ANSI(<code class="language-plaintext highlighter-rouge">Port</code>+ë³¸ë¬¸ <code class="language-plaintext highlighter-rouge">Input/Output/Inout</code> ì„ ì–¸) ëª¨ë‘ í¡ìˆ˜.</p>
  </li>
  <li>
    <p>í­ ë¯¸ì§€ì •ì€ <code class="language-plaintext highlighter-rouge">1ë¹„íŠ¸(msb=lsb=0)</code>ë¡œ í†µì¼. ë°©í–¥ ë¯¸ìƒì€ ë³´ìˆ˜ì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">inout</code> ëŒ€ì‹  <strong>ë°œê²¬ ì‹¤íŒ¨ ì‹œ null</strong>(í˜„ì‹¤ì ìœ¼ë¡œ ê±°ì˜ ì—†ìŒ).</p>
  </li>
</ul>

<ol>
  <li><strong>ì¸ìŠ¤í„´ìŠ¤ ì •ê·œí™”</strong></li>
</ol>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">InstanceList</code>ë¥¼ ì¬ê·€ íƒìƒ‰(Generate ë¸”ë¡ ë‚´ë¶€ í¬í•¨).</p>
  </li>
  <li>
    <p>í¬ì§€ì…”ë„ ì—°ê²°ì€ 1íŒ¨ìŠ¤ì—ì„œ ëª¨ì€ <strong>ì„œë¸Œëª¨ë“ˆ í¬íŠ¸ ìˆœì„œ</strong> ë¡œ ë„¤ì„ë“œ ë³€í™˜. ì•Œ ìˆ˜ ì—†ëŠ” ì™¸ë¶€ ëª¨ë“ˆì€ ì¸ë±ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ ë‚¨ê¹€(ì˜ˆ: <code class="language-plaintext highlighter-rouge">__pos0</code>, <code class="language-plaintext highlighter-rouge">__pos1</code>).</p>
  </li>
</ul>

<ol>
  <li><strong>ë„· ì •ê·œí™”</strong></li>
</ol>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">wire/reg</code>(í•„ìš”í•˜ë©´ <code class="language-plaintext highlighter-rouge">integer</code>)ë¥¼ ìˆ˜ì§‘, ë‹¤ì¤‘ ì„ ì–¸ì€ ê°œë³„ í•­ëª©ìœ¼ë¡œ ë¶„í• .</p>
  </li>
  <li>
    <p>í¬íŠ¸ ì„ ì–¸ì—ì„œ ì´ë¯¸ ë“±ì¥í•œ ì‹ë³„ìëŠ” <strong>netsì—ì„œ ì¤‘ë³µ ì œì™¸</strong>(ìš”êµ¬ì‚¬í•­ì´ â€œë‚´ë¶€ netsâ€ì´ë¯€ë¡œ).</p>
  </li>
</ul>

<ol>
  <li><strong>í‘œí˜„ì‹ í‰ê°€ê¸°</strong></li>
</ol>

<ul>
  <li>íŒŒë¼ë¯¸í„° í™˜ê²½ì„ ì‚¬ìš©í•´ <code class="language-plaintext highlighter-rouge">IntConst/Identifier/UnaryOp/BinaryOp</code> ì¤‘ì‹¬ìœ¼ë¡œ <strong>ì•ˆì „í•œ ì •ìˆ˜ í‰ê°€</strong>(ë¯¸ì§€ì› ì—°ì‚° ì‹œ ê°’ì€ <code class="language-plaintext highlighter-rouge">null</code>, ì› ë¬¸ìì—´ì€ ìœ ì§€).</li>
</ul>

<hr />

<h1 id="ë ˆí¼ëŸ°ìŠ¤-êµ¬í˜„-python--pyverilog">ë ˆí¼ëŸ°ìŠ¤ êµ¬í˜„ (Python / PyVerilog)</h1>

<blockquote>
  <p>pip: <code class="language-plaintext highlighter-rouge">pyverilog</code> í•„ìš”. íŒŒì¼ ëª¨ìŒ ì…ë ¥ â†’ ìœ„ IR JSON ë°˜í™˜.
```python</p>
  <h1 id="vnormpy">vnorm.py</h1>
  <p>from <strong>future</strong> import annotations
from typing import Any, Dict, List, Tuple, Optional
import json
from pyverilog.vparser.parser import parse
from pyverilog.vparser import ast as vast
from pyverilog.ast_code_generator.codegen import ASTCodeGenerator</p>
</blockquote>

<p>codegen = ASTCodeGenerator()</p>

<h1 id="--utilities--">â€”â€”â€”- utilities â€”â€”â€”-</h1>
<p>def to_str(node) -&gt; Optional[str]:
    if node is None:
        return None
    try:
        return codegen.visit(node)
    except Exception:
        return None</p>

<p>def int_from_intconst(intconst: str) -&gt; Optional[int]:
    # Handles decimal/hex/bin/octal Verilog ints like 8'hFF or 'd10.
    s = intconst.replace('_', '')
    try:
        # forms: 10, 8'hFF, 'd3
        if "'" not in s:
            return int(s, 10)
        width_base, val = s.split("'")
        base = val[0].lower()
        digits = val[1:]
        if base == 'd': return int(digits, 10)
        if base == 'h': return int(digits, 16)
        if base == 'b': return int(digits, 2)
        if base == 'o': return int(digits, 8)
        # unknown base
        return int(digits, 10)
    except Exception:
        return None</p>

<p>def eval_expr(node, env: Dict[str, int]) -&gt; Optional[int]:
    # conservative evaluator for width-ish integer expressions
    if node is None:
        return None
    if isinstance(node, vast.IntConst):
        return int_from_intconst(node.value)
    if isinstance(node, vast.Identifier):
        return env.get(node.name)
    if isinstance(node, vast.UnaryOperator):
        v = eval_expr(node.children()[0], env)
        if v is None: return None
        op = node.<strong>class</strong>.<strong>name</strong>
        if op in ("Uplus",): return +v
        if op in ("Uminus",): return -v
        if op in ("Ulnot","Unot"): return 0 if v else 1
        return None
    if isinstance(node, vast.Partselect) or isinstance(node, vast.Pointer):
        # treat as unknown integer
        return None
    if isinstance(node, vast.Concat) or isinstance(node, vast.Repeat):
        return None
    # Binary operators
    if isinstance(node, vast.BinaryOperator):
        a = eval_expr(node.left, env)
        b = eval_expr(node.right, env)
        if a is None or b is None:
            return None
        t = node.<strong>class</strong>.<strong>name</strong>
        try:
            if t == "Plus": return a + b
            if t == "Minus": return a - b
            if t == "Times": return a * b
            if t == "Div": return a // b if b != 0 else None
            if t == "Power": return a ** b
            if t == "Mod": return a % b if b != 0 else None
            if t == "Sll": return a Â«Â b
            if t == "Srl": return aÂ Â» b
            if t == "And": return a &amp; b
            if t == "Or":  return a | b
            if t == "Xor": return a ^ b
        except Exception:
            return None
        return None
    return None</p>

<p>def width_tuple(width_node, env: Dict[str,int]):
    # returns (msb_str, lsb_str, msb_val, lsb_val, width_val)
    if width_node is None:
        return "0", "0", 0, 0, 1
    msb_n, lsb_n = width_node.msb, width_node.lsb
    msb_s, lsb_s = to_str(msb_n), to_str(lsb_n)
    msb_v, lsb_v = eval_expr(msb_n, env), eval_expr(lsb_n, env)
    width_v = None
    if msb_v is not None and lsb_v is not None:
        width_v = abs(msb_v - lsb_v) + 1
    return msb_s, lsb_s, msb_v, lsb_v, width_v</p>

<h1 id="--1st-pass-collect-module-port-order--param-defaults--">â€”â€”â€”- 1st pass: collect module port order &amp; param defaults â€”â€”â€”-</h1>
<p>def collect_modules(ast_root) -&gt; Dict[str, vast.ModuleDef]:
    mods = {}
    for d in ast_root.description.definitions:
        if isinstance(d, vast.ModuleDef):
            mods[d.name] = d
    return mods</p>

<p>def collect_param_env(mod: vast.ModuleDef) -&gt; Dict[str,int]:
    env = {}
    # parameters in header
    if getattr(mod, "paramlist", None):
        for p in mod.paramlist.params:
            if isinstance(p, vast.Parameter):
                v = eval_expr(p.value, env)  # parameters can depend on earlier ones
                if v is not None:
                    env[p.name] = v
    # parameters in body declarations, if any
    for item in getattr(mod, "items", []) or []:
        if isinstance(item, vast.Decl):
            for e in item.list:
                if isinstance(e, vast.Parameter):
                    v = eval_expr(e.value, env)
                    if v is not None:
                        env[e.name] = v
    return env</p>

<p>def ordered_port_names(mod: vast.ModuleDef) -&gt; List[str]:
    names = []
    if mod.portlist is None:
        return names
    for p in mod.portlist.ports:
        # Ioport(first=Identifier, second=Input/Output/Inout)
        if isinstance(p, vast.Ioport):
            names.append(p.first.name)
        elif isinstance(p, vast.Port):
            # Port(name, arg=None) in non-ANSI
            names.append(p.name)
    return names</p>

<h1 id="--helpers-declaration-maps--">â€”â€”â€”- helpers: declaration maps â€”â€”â€”-</h1>
<p>def build_io_decl_map(mod: vast.ModuleDef, env: Dict[str,int]):
    # name -&gt; (dir, signed, width_info)
    io_map = {}
    for item in getattr(mod, "items", []) or []:
        if not isinstance(item, vast.Decl):
            continue
        for e in item.list:
            if isinstance(e, (vast.Input, vast.Output, vast.Inout)):
                dir_ = "input" if isinstance(e, vast.Input) else ("output" if isinstance(e, vast.Output) else "inout")
                signed = bool(getattr(e, "signed", False))
                w = getattr(e, "width", None)
                msb_s, lsb_s, msb_v, lsb_v, width_v = width_tuple(w, env)
                for name in [n.name for n in e.children() if isinstance(n, vast.Identifier)]:
                    io_map[name] = (dir_, signed, (msb_s, lsb_s, msb_v, lsb_v, width_v))
    return io_map</p>

<p>def build_net_decl_list(mod: vast.ModuleDef, env: Dict[str,int]):
    nets = []
    for item in getattr(mod, "items", []) or []:
        if not isinstance(item, vast.Decl):
            continue
        for e in item.list:
            if isinstance(e, (vast.Wire, vast.Reg, vast.Integer)):
                kind = "wire" if isinstance(e, vast.Wire) else ("reg" if isinstance(e, vast.Reg) else "integer")
                signed = bool(getattr(e, "signed", False))
                w = getattr(e, "width", None)
                msb_s, lsb_s, msb_v, lsb_v, width_v = width_tuple(w, env)
                for n in e.children():
                    if isinstance(n, vast.Identifier):
                        nets.append({
                            "name": n.name, "kind": kind, "signed": signed,
                            "msb_str": msb_s, "lsb_str": lsb_s, "msb": msb_v, "lsb": lsb_v, "width": width_v
                        })
    return nets</p>

<h1 id="--recursive-walker-for-instancelist--">â€”â€”â€”- recursive walker for InstanceList â€”â€”â€”-</h1>
<p>def iter_instancelists(node):
    # yield vast.InstanceList under any nesting (e.g., Generate blocks)
    if isinstance(node, vast.InstanceList):
        yield node
    for ch in getattr(node, "children", lambda: [])():
        yield from iter_instancelists(ch)</p>

<h1 id="--2nd-pass-build-ir-per-module--">â€”â€”â€”- 2nd pass: build IR per module â€”â€”â€”-</h1>
<p>def normalize_module(mod: vast.ModuleDef, modlib_ports: Dict[str, List[str]]) -&gt; Dict[str,Any]:
    env = collect_param_env(mod)
    # parameters
    params = []
    # header params
    if getattr(mod, "paramlist", None):
        for p in mod.paramlist.params:
            if isinstance(p, vast.Parameter):
                params.append({
                    "name": p.name,
                    "value_str": to_str(p.value),
                    "value": eval_expr(p.value, env)
                })
    # body params (avoid duplicates)
    body_params = {}
    for item in getattr(mod, "items", []) or []:
        if isinstance(item, vast.Decl):
            for e in item.list:
                if isinstance(e, vast.Parameter) and e.name not in {x["name"] for x in params}:
                    body_params[e.name] = {
                        "name": e.name,
                        "value_str": to_str(e.value),
                        "value": eval_expr(e.value, env)
                    }
    params.extend(body_params.values())</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ports
io_map = build_io_decl_map(mod, env)
ordered_names = ordered_port_names(mod)
ports = []
for idx, pname in enumerate(ordered_names):
    dir_, signed, winfo = None, False, None
    # ANSI Ioport case
    ansi_hit = False
    if mod.portlist and isinstance(mod.portlist.ports[idx], vast.Ioport):
        io = mod.portlist.ports[idx]
        decl = io.second  # Input/Output/Inout
        dir_ = "input" if isinstance(decl, vast.Input) else ("output" if isinstance(decl, vast.Output) else "inout")
        signed = bool(getattr(decl, "signed", False))
        w = getattr(decl, "width", None)
        msb_s, lsb_s, msb_v, lsb_v, width_v = width_tuple(w, env)
        winfo = (msb_s, lsb_s, msb_v, lsb_v, width_v)
        ansi_hit = True
    # Non-ANSI fallback via body decl map
    if not ansi_hit and pname in io_map:
        dir_, signed, winfo = io_map[pname]
    if winfo is None:
        winfo = width_tuple(None, env)
    msb_s, lsb_s, msb_v, lsb_v, width_v = winfo
    ports.append({
        "index": idx, "name": pname, "dir": dir_, "signed": signed,
        "msb_str": msb_s, "lsb_str": lsb_s, "msb": msb_v, "lsb": lsb_v, "width": width_v
    })

# nets (exclude names that are top-level ports)
nets_raw = build_net_decl_list(mod, env)
port_names_set = set(ordered_names)
nets = [n for n in nets_raw if n["name"] not in port_names_set]

# instances
instances = []
for il in iter_instancelists(mod):
    submod = il.module
    # parameter overrides (common across instances in the list)
    param_overrides = []
    if getattr(il, "paramlist", None):
        for pa in il.paramlist.params:
            # pa: vast.ParamArg(name, argname/value)
            name = pa.paramname if hasattr(pa, "paramname") else getattr(pa, "name", None)
            value_node = pa.argname if hasattr(pa, "argname") else getattr(pa, "value", None)
            param_overrides.append({
                "name": name,
                "value_str": to_str(value_node),
                "value": eval_expr(value_node, env)
            })
    for inst in il.instances:
        conns = []
        # PortArg(portname, argname)
        portargs = getattr(inst, "portlist", []) or []
        # decide positional vs named
        positional = any(getattr(pa, "portname", None) in (None, "") for pa in portargs)
        if positional:
            # map by index using lib
            lib_ports = modlib_ports.get(submod, [])
            for i, pa in enumerate(portargs):
                pname = lib_ports[i] if i &lt; len(lib_ports) else f"__pos{i}"
                conns.append({"port": pname, "expr_str": to_str(getattr(pa, "argname", None))})
        else:
            for pa in portargs:
                conns.append({"port": pa.portname, "expr_str": to_str(pa.argname)})
        instances.append({
            "inst": inst.name,
            "module": submod,
            "param_overrides": param_overrides,
            "connections": conns
        })

return {"parameters": params, "ports": ports, "nets": nets, "instances": instances}
</code></pre></div></div>

<p>def convert_to_vnorm(files: List[str]) -&gt; Dict[str,Any]:
    ast, _ = parse(files)
    mods = collect_modules(ast)
    modlib_ports = {name: ordered_port_names(m) for name, m in mods.items()}
    result = {"modules": {}}
    for name, m in mods.items():
        result["modules"][name] = normalize_module(m, modlib_ports)
    return result</p>

<p>if <strong>name</strong> == "<strong>main</strong>":
    import argparse, sys
    ap = argparse.ArgumentParser()
    ap.add_argument("verilog", nargs="+", help="Verilog source files")
    ap.add_argument("-o", "â€“out", default="-", help="Output JSON path (default: stdout)")
    args = ap.parse_args()
    ir = convert_to_vnorm(args.verilog)
    s = json.dumps(ir, indent=2)
    if args.out == "-" or args.out == "/dev/stdout":
        print(s)
    else:
        with open(args.out, "w") as f:
            f.write(s)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
* * *

# ì‚¬ìš© ì˜ˆì‹œ

**ì˜ˆì œ Verilog**
```verilog
module child #(parameter WIDTH=8) (input clk, input [WIDTH-1:0] a, output y);
  assign y = a[0];
endmodule

module top (clk, rst, out);
  input clk, rst;
  output out;
  wire [7:0] data;
  child #(.WIDTH(8)) u0 (.clk(clk), .a(data), .y(out));
endmodule
</code></pre></div></div>

<p><strong>ì‹¤í–‰</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python vnorm.py top.v <span class="nt">-o</span> ir.json
</code></pre></div></div>

<p><strong>í•µì‹¬ ê²°ê³¼(ë°œì·Œ)</strong></p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"modules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"top"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"ports"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nl">"index"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"clk"</span><span class="p">,</span><span class="nl">"dir"</span><span class="p">:</span><span class="s2">"input"</span><span class="p">,</span><span class="nl">"width"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nl">"index"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"rst"</span><span class="p">,</span><span class="nl">"dir"</span><span class="p">:</span><span class="s2">"input"</span><span class="p">,</span><span class="nl">"width"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nl">"index"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"out"</span><span class="p">,</span><span class="nl">"dir"</span><span class="p">:</span><span class="s2">"output"</span><span class="p">,</span><span class="nl">"width"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">...</span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"nets"</span><span class="p">:[</span><span class="w">
        </span><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"data"</span><span class="p">,</span><span class="nl">"kind"</span><span class="p">:</span><span class="s2">"wire"</span><span class="p">,</span><span class="nl">"msb_str"</span><span class="p">:</span><span class="s2">"7"</span><span class="p">,</span><span class="nl">"lsb_str"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="nl">"msb"</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="nl">"lsb"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nl">"width"</span><span class="p">:</span><span class="mi">8</span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"instances"</span><span class="p">:[</span><span class="w">
        </span><span class="p">{</span><span class="nl">"inst"</span><span class="p">:</span><span class="s2">"u0"</span><span class="p">,</span><span class="nl">"module"</span><span class="p">:</span><span class="s2">"child"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"param_overrides"</span><span class="p">:[{</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"WIDTH"</span><span class="p">,</span><span class="nl">"value_str"</span><span class="p">:</span><span class="s2">"8"</span><span class="p">,</span><span class="nl">"value"</span><span class="p">:</span><span class="mi">8</span><span class="p">}],</span><span class="w">
         </span><span class="nl">"connections"</span><span class="p">:[</span><span class="w">
           </span><span class="p">{</span><span class="nl">"port"</span><span class="p">:</span><span class="s2">"clk"</span><span class="p">,</span><span class="nl">"expr_str"</span><span class="p">:</span><span class="s2">"clk"</span><span class="p">},</span><span class="w">
           </span><span class="p">{</span><span class="nl">"port"</span><span class="p">:</span><span class="s2">"a"</span><span class="p">,</span><span class="nl">"expr_str"</span><span class="p">:</span><span class="s2">"data"</span><span class="p">},</span><span class="w">
           </span><span class="p">{</span><span class="nl">"port"</span><span class="p">:</span><span class="s2">"y"</span><span class="p">,</span><span class="nl">"expr_str"</span><span class="p">:</span><span class="s2">"out"</span><span class="p">}</span><span class="w">
         </span><span class="p">]}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<hr />

<h1 id="êµ¬í˜„-í¬ì¸íŠ¸--ì—£ì§€ì¼€ì´ìŠ¤-ì²˜ë¦¬">êµ¬í˜„ í¬ì¸íŠ¸ &amp; ì—£ì§€ì¼€ì´ìŠ¤ ì²˜ë¦¬</h1>

<ul>
  <li>
    <p><strong>ANSI/Non-ANSI í¬íŠ¸</strong> : ë‘˜ ë‹¤ ì»¤ë²„. Non-ANSIëŠ” ë³¸ë¬¸ <code class="language-plaintext highlighter-rouge">Decl</code> íƒìƒ‰ìœ¼ë¡œ ë°©í–¥/í­ ì±„ì›€.</p>
  </li>
  <li>
    <p><strong>í­ ë¯¸ì§€ì •</strong> : <code class="language-plaintext highlighter-rouge">msb=lsb=0</code>, <code class="language-plaintext highlighter-rouge">width=1</code>ë¡œ í†µì¼.</p>
  </li>
  <li>
    <p><strong>í‘œí˜„ì‹ í‰ê°€ ì‹¤íŒ¨</strong> : <code class="language-plaintext highlighter-rouge">*_str</code>ë§Œ ë³´ì¡´í•˜ê³  ì •ìˆ˜ í•„ë“œëŠ” <code class="language-plaintext highlighter-rouge">null</code>.</p>
  </li>
  <li>
    <p><strong>í¬ì§€ì…”ë„ ì—°ê²°</strong> : 1íŒ¨ìŠ¤ì—ì„œ ìˆ˜ì§‘í•œ <strong>ì„œë¸Œëª¨ë“ˆ í¬íŠ¸ ìˆœì„œ</strong> ë¡œ ë„¤ì„ë“œí™”.</p>
  </li>
  <li>
    <p><strong>Generate ë‚´ë¶€ ì¸ìŠ¤í„´ìŠ¤</strong> : ì¬ê·€ íƒìƒ‰ìœ¼ë¡œ ìˆ˜ì§‘.</p>
  </li>
  <li>
    <p><strong>ë‚´ë¶€ nets</strong> : í¬íŠ¸ ì´ë¦„ê³¼ ì¤‘ë³µ ì œê±°.</p>
  </li>
  <li>
    <p><strong>íŒŒë¼ë¯¸í„°</strong> : í—¤ë”/ë³¸ë¬¸ ëª¨ë‘ ìˆ˜ì§‘, ê°€ëŠ¥í•œ ê²½ìš° ì •ìˆ˜ í‰ê°€.</p>
  </li>
</ul>

<hr />

<h1 id="ë‹¤ìŒ-í™•ì¥-ì•„ì´ë””ì–´">ë‹¤ìŒ í™•ì¥ ì•„ì´ë””ì–´</h1>

<ul>
  <li>
    <p>SystemVerilog ì¼ë¶€ ì§€ì›(ê°€ëŠ¥ ë²”ìœ„ì—ì„œ): <code class="language-plaintext highlighter-rouge">logic</code>, packed/unpacked ë°°ì—´, interface í¬íŠ¸ëŠ” ë³„ ë ˆì´ì–´ë¡œ.</p>
  </li>
  <li>
    <p>í­/íŒŒë¼ë¯¸í„° <strong>ì™„ì „ í‰ê°€</strong> ë¥¼ ìœ„í•´ PyVerilog Dataflow ì—°ê³„.</p>
  </li>
  <li>
    <p><strong>ê¸°ë³¸ nettype</strong>(<code class="language-plaintext highlighter-rouge">default_nettype none</code> ë¯¸ì‚¬ìš© ì‹œ) ì•”ì‹œì  net ê°ì§€ ì˜µì…˜.</p>
  </li>
  <li>
    <p><strong>ì†ŒìŠ¤ ìœ„ì¹˜ ì •ë³´</strong>(filename, lineno) ì¶”ê°€ë¡œ ë””ë²„ê¹… í¸ì˜ì„±â†‘.</p>
  </li>
  <li>
    <p><strong>ìŠ¤í‚¤ë§ˆ ê²€ì¦</strong>(pydantic/jsonschema)ë¡œ ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ ì•ˆì •ì„± í™•ë³´.</p>
  </li>
</ul>

<hr />

<p>í•„ìš”í•˜ì‹œë©´ ì´ IRë¡œë¶€í„° <strong>Graphviz ëª¨ë“ˆ-ì¸ìŠ¤í„´ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨</strong> ì´ë‚˜ <strong>í¬íŠ¸/ë„· í…Œì´ë¸”</strong> ë½‘ëŠ” ì½”ë“œë„ ë°”ë¡œ ë¶™ì—¬ë“œë¦´ê²Œìš”.</p>

<p class="chat--user">

JSON ë§ê³  Python classë¡œ ë³€í™˜í•˜ê³  ì‹¶ì–´

</p>

<p>ì¢‹ì§€! JSON ëŒ€ì‹  <strong>Python í´ë˜ìŠ¤(IR)</strong>ë¡œ ë°”ë¡œ ë‹¤ë£¨ê²Œ ë§Œë“¤ì.<br />
ì•„ë˜ëŠ” (1) íƒ€ì… ì„¤ê³„ â†’ (2) ë³€í™˜ íŒŒì´í”„ë¼ì¸ â†’ (3) ì „ì²´ êµ¬í˜„ ì½”ë“œ â†’ (4) ì‚¬ìš© ì˜ˆì‹œ ìˆœì„œë¡œ <strong>ì°¨ê·¼ì°¨ê·¼</strong> ì •ë¦¬í–ˆì–´.</p>

<hr />

<h1 id="1-ëª©í‘œ-ì¬ì •ì˜-step-by-step">1) ëª©í‘œ ì¬ì •ì˜ (Step-by-step)</h1>

<ul>
  <li>
    <p>PyVerilog AST â†’ <strong>ì¼ê´€ëœ Python dataclass IR</strong> ë°˜í™˜</p>
  </li>
  <li>
    <p>í¬í•¨ ì •ë³´</p>

    <ul>
      <li>
        <p><strong>í¬íŠ¸</strong> : ìˆœì„œ(index), ì´ë¦„, ë°©í–¥(in/out/inout), signed, í­(msb/lsb/width)</p>
      </li>
      <li>
        <p><strong>ì¸ìŠ¤í„´ìŠ¤</strong> : ì„œë¸Œëª¨ë“ˆëª…, ì¸ìŠ¤í„´ìŠ¤ëª…, íŒŒë¼ë¯¸í„° override, í¬íŠ¸-ì•„ê·œë¨¼íŠ¸ ë§¤í•‘(í¬ì§€ì…”ë„ â†’ ë„¤ì„ë“œ ìë™ ë³€í™˜)</p>
      </li>
      <li>
        <p><strong>ë‚´ë¶€ nets</strong> : wire/reg/integer, signed, í­(msb/lsb/width)</p>
      </li>
    </ul>
  </li>
  <li>
    <p>í‘œí˜„ì‹ì€ ê°€ëŠ¥í•œ í•œ <strong>ì •ìˆ˜ í‰ê°€</strong> , ì‹¤íŒ¨í•˜ë©´ ì›ë¬¸ ë¬¸ìì—´ ìœ ì§€</p>
  </li>
</ul>

<hr />

<h1 id="2-íƒ€ì…-ì„¤ê³„-dataclass--enum">2) íƒ€ì… ì„¤ê³„ (dataclass + Enum)</h1>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">DesignIR</code> (ë£¨íŠ¸) â†’ ëª¨ë“ˆëª… â†’ <code class="language-plaintext highlighter-rouge">ModuleIR</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ModuleIR</code> ì•ˆì— <code class="language-plaintext highlighter-rouge">Parameter</code>, <code class="language-plaintext highlighter-rouge">Port</code>, <code class="language-plaintext highlighter-rouge">Net</code>, <code class="language-plaintext highlighter-rouge">Instance(Connection[])</code></p>
  </li>
  <li>
    <p>ë°©í–¥/ë„· ì¢…ë¥˜ëŠ” Enumìœ¼ë¡œ ì•ˆì •í™”</p>
  </li>
</ul>

<hr />

<h1 id="3-ë³€í™˜-íŒŒì´í”„ë¼ì¸-ë‘-íŒ¨ìŠ¤-step-by-step">3) ë³€í™˜ íŒŒì´í”„ë¼ì¸ (ë‘ íŒ¨ìŠ¤, Step-by-step)</h1>

<ol>
  <li>
    <p><strong>1íŒ¨ìŠ¤</strong> : ëª¨ë“  ëª¨ë“ˆì˜</p>

    <ul>
      <li>
        <p>í¬íŠ¸ ìˆœì„œ ìˆ˜ì§‘(í¬ì§€ì…”ë„ ë§¤í•‘ìš©)</p>
      </li>
      <li>
        <p>íŒŒë¼ë¯¸í„° ê¸°ë³¸ê°’ í™˜ê²½(env) êµ¬ì„±(í­ í‰ê°€ìš©)</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>2íŒ¨ìŠ¤(ëª¨ë“ˆ ë‹¨ìœ„)</strong> :</p>

    <ul>
      <li>
        <p>í¬íŠ¸: ANSI/Non-ANSI í†µí•© ì •ê·œí™”</p>
      </li>
      <li>
        <p>ë„·: í¬íŠ¸ì™€ ì¤‘ë³µ ì œê±°, ë‹¤ì¤‘ ì„ ì–¸ ë¶„ë¦¬</p>
      </li>
      <li>
        <p>ì¸ìŠ¤í„´ìŠ¤: Generate ë‚´ë¶€ í¬í•¨ ì¬ê·€ ìˆ˜ì§‘, í¬ì§€ì…”ë„â†’ë„¤ì„ë“œ</p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h1 id="4-ì „ì²´-êµ¬í˜„-ì½”ë“œ-ë³µë¶™í•´ì„œ-vnorm_classespy-ë¡œ-ì €ì¥">4) ì „ì²´ êµ¬í˜„ ì½”ë“œ (ë³µë¶™í•´ì„œ <code class="language-plaintext highlighter-rouge">vnorm_classes.py</code> ë¡œ ì €ì¥)</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># vnorm_classes.py
</span><span class="kn">from</span> <span class="n">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">asdict</span>
<span class="kn">from</span> <span class="n">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="n">json</span>

<span class="kn">from</span> <span class="n">pyverilog.vparser.parser</span> <span class="kn">import</span> <span class="n">parse</span>
<span class="kn">from</span> <span class="n">pyverilog.vparser</span> <span class="kn">import</span> <span class="n">ast</span> <span class="k">as</span> <span class="n">vast</span>
<span class="kn">from</span> <span class="n">pyverilog.ast_code_generator.codegen</span> <span class="kn">import</span> <span class="n">ASTCodeGenerator</span>

<span class="n">codegen</span> <span class="o">=</span> <span class="nc">ASTCodeGenerator</span><span class="p">()</span>

<span class="c1"># -------------------- Typed IR --------------------
</span>
<span class="k">class</span> <span class="nc">Direction</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">INPUT</span> <span class="o">=</span> <span class="sh">"</span><span class="s">input</span><span class="sh">"</span>
    <span class="n">OUTPUT</span> <span class="o">=</span> <span class="sh">"</span><span class="s">output</span><span class="sh">"</span>
    <span class="n">INOUT</span> <span class="o">=</span> <span class="sh">"</span><span class="s">inout</span><span class="sh">"</span>

<span class="k">class</span> <span class="nc">NetKind</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">WIRE</span> <span class="o">=</span> <span class="sh">"</span><span class="s">wire</span><span class="sh">"</span>
    <span class="n">REG</span> <span class="o">=</span> <span class="sh">"</span><span class="s">reg</span><span class="sh">"</span>
    <span class="n">INTEGER</span> <span class="o">=</span> <span class="sh">"</span><span class="s">integer</span><span class="sh">"</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Parameter</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Port</span><span class="p">:</span>
    <span class="n">index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Direction</span><span class="p">]</span>          <span class="c1"># Non-ANSIì—ì„œ ë“œë¬¼ê²Œ ëª»ì°¾ìœ¼ë©´ None
</span>    <span class="n">signed</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">msb_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">lsb_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">msb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">lsb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>              <span class="c1"># msb/lsb ë‘˜ ë‹¤ í‰ê°€ë˜ë©´ abs(msb-lsb)+1
</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Net</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">NetKind</span>
    <span class="n">signed</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">msb_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">lsb_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">msb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">lsb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Connection</span><span class="p">:</span>
    <span class="n">port</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">expr_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Instance</span><span class="p">:</span>
    <span class="n">inst</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">module</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">param_overrides</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">connections</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Connection</span><span class="p">]</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ModuleIR</span><span class="p">:</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">ports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Port</span><span class="p">]</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">nets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Net</span><span class="p">]</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Instance</span><span class="p">]</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># í¸ì˜ ë©”ì„œë“œ
</span>    <span class="k">def</span> <span class="nf">port_by_name</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Port</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">ports</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">p</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">ports_by_dir</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dir_</span><span class="p">:</span> <span class="n">Direction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Port</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">ports</span> <span class="k">if</span> <span class="n">p</span><span class="p">.</span><span class="nb">dir</span> <span class="o">==</span> <span class="n">dir_</span><span class="p">]</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DesignIR</span><span class="p">:</span>
    <span class="n">modules</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ModuleIR</span><span class="p">]</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="nf">asdict</span><span class="p">(</span><span class="n">self</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>

<span class="c1"># -------------------- Helpers --------------------
</span>
<span class="k">def</span> <span class="nf">to_str</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">codegen</span><span class="p">.</span><span class="nf">visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">int_from_intconst</span><span class="p">(</span><span class="n">intconst</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">intconst</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">_</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="sh">"'"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">int</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">width_base</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"'"</span><span class="p">)</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">lower</span><span class="p">()</span>
        <span class="n">digits</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="sh">'</span><span class="s">d</span><span class="sh">'</span><span class="p">:</span> <span class="k">return</span> <span class="nf">int</span><span class="p">(</span><span class="n">digits</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="sh">'</span><span class="s">h</span><span class="sh">'</span><span class="p">:</span> <span class="k">return</span> <span class="nf">int</span><span class="p">(</span><span class="n">digits</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">:</span> <span class="k">return</span> <span class="nf">int</span><span class="p">(</span><span class="n">digits</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="sh">'</span><span class="s">o</span><span class="sh">'</span><span class="p">:</span> <span class="k">return</span> <span class="nf">int</span><span class="p">(</span><span class="n">digits</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">int</span><span class="p">(</span><span class="n">digits</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">eval_expr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">IntConst</span><span class="p">):</span>
        <span class="k">return</span> <span class="nf">int_from_intconst</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Identifier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">env</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">UnaryOperator</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nf">eval_expr</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="nf">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Uplus</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="o">+</span><span class="n">v</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Uminus</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="o">-</span><span class="n">v</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">Ulnot</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Unot</span><span class="sh">"</span><span class="p">):</span> <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">v</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">BinaryOperator</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nf">eval_expr</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">left</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nf">eval_expr</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">right</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">b</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Plus</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Minus</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Times</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Div</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">//</span> <span class="n">b</span> <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Power</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">**</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Mod</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span> <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Sll</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Srl</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">&gt;&gt;</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">And</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">&amp;</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Or</span><span class="sh">"</span><span class="p">:</span>  <span class="k">return</span> <span class="n">a</span> <span class="o">|</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Xor</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">^</span> <span class="n">b</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="c1"># ê¸°íƒ€ ë³µí•©í‘œí˜„(Concat/Repeat/Partselect/Pointer)ì€ í‰ê°€ ë³´ë¥˜
</span>    <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">width_tuple</span><span class="p">(</span><span class="n">width_node</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
    <span class="c1"># (msb_str, lsb_str, msb_val, lsb_val, width_val)
</span>    <span class="k">if</span> <span class="n">width_node</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="n">msb_n</span><span class="p">,</span> <span class="n">lsb_n</span> <span class="o">=</span> <span class="n">width_node</span><span class="p">.</span><span class="n">msb</span><span class="p">,</span> <span class="n">width_node</span><span class="p">.</span><span class="n">lsb</span>
    <span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span> <span class="o">=</span> <span class="nf">to_str</span><span class="p">(</span><span class="n">msb_n</span><span class="p">),</span> <span class="nf">to_str</span><span class="p">(</span><span class="n">lsb_n</span><span class="p">)</span>
    <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span> <span class="o">=</span> <span class="nf">eval_expr</span><span class="p">(</span><span class="n">msb_n</span><span class="p">,</span> <span class="n">env</span><span class="p">),</span> <span class="nf">eval_expr</span><span class="p">(</span><span class="n">lsb_n</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
    <span class="n">width_v</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">msb_v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">lsb_v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">width_v</span> <span class="o">=</span> <span class="nf">abs</span><span class="p">(</span><span class="n">msb_v</span> <span class="o">-</span> <span class="n">lsb_v</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span>

<span class="c1"># -------------------- 1st pass: module tables --------------------
</span>
<span class="k">def</span> <span class="nf">collect_modules</span><span class="p">(</span><span class="n">ast_root</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">ModuleDef</span><span class="p">]:</span>
    <span class="n">mods</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ast_root</span><span class="p">.</span><span class="n">description</span><span class="p">.</span><span class="n">definitions</span><span class="p">:</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">ModuleDef</span><span class="p">):</span>
            <span class="n">mods</span><span class="p">[</span><span class="n">d</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
    <span class="k">return</span> <span class="n">mods</span>

<span class="k">def</span> <span class="nf">collect_param_env</span><span class="p">(</span><span class="n">mod</span><span class="p">:</span> <span class="n">vast</span><span class="p">.</span><span class="n">ModuleDef</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># í—¤ë” íŒŒë¼ë¯¸í„°
</span>    <span class="k">if</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="sh">"</span><span class="s">paramlist</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mod</span><span class="p">.</span><span class="n">paramlist</span><span class="p">.</span><span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Parameter</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nf">eval_expr</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">env</span><span class="p">[</span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="c1"># ë°”ë”” íŒŒë¼ë¯¸í„°
</span>    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="sh">"</span><span class="s">items</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]:</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Decl</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">item</span><span class="p">.</span><span class="nb">list</span><span class="p">:</span>
                <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Parameter</span><span class="p">):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="nf">eval_expr</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">env</span><span class="p">[</span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">env</span>

<span class="k">def</span> <span class="nf">ordered_port_names</span><span class="p">(</span><span class="n">mod</span><span class="p">:</span> <span class="n">vast</span><span class="p">.</span><span class="n">ModuleDef</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">mod</span><span class="p">.</span><span class="n">portlist</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">names</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mod</span><span class="p">.</span><span class="n">portlist</span><span class="p">.</span><span class="n">ports</span><span class="p">:</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Ioport</span><span class="p">):</span>
            <span class="n">names</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Port</span><span class="p">):</span>
            <span class="n">names</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">names</span>

<span class="c1"># -------------------- Decl scans --------------------
</span>
<span class="k">def</span> <span class="nf">build_io_decl_map</span><span class="p">(</span><span class="n">mod</span><span class="p">:</span> <span class="n">vast</span><span class="p">.</span><span class="n">ModuleDef</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
    <span class="c1"># name -&gt; (Direction|None, signed, width_info)
</span>    <span class="n">io_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="sh">"</span><span class="s">items</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Decl</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">item</span><span class="p">.</span><span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="n">vast</span><span class="p">.</span><span class="n">Input</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Output</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Inout</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Input</span><span class="p">):</span>  <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">INPUT</span>
                <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Output</span><span class="p">):</span> <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">OUTPUT</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">INOUT</span>
                <span class="n">signed</span> <span class="o">=</span> <span class="nf">bool</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sh">"</span><span class="s">signed</span><span class="sh">"</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
                <span class="n">w</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sh">"</span><span class="s">width</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span> <span class="o">=</span> <span class="nf">width_tuple</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
                <span class="c1"># e.children() contains Identifiers
</span>                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">e</span><span class="p">.</span><span class="nf">children</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Identifier</span><span class="p">):</span>
                        <span class="n">io_map</span><span class="p">[</span><span class="n">n</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dir_</span><span class="p">,</span> <span class="n">signed</span><span class="p">,</span> <span class="p">(</span><span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">io_map</span>

<span class="k">def</span> <span class="nf">build_net_decl_list</span><span class="p">(</span><span class="n">mod</span><span class="p">:</span> <span class="n">vast</span><span class="p">.</span><span class="n">ModuleDef</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Net</span><span class="p">]:</span>
    <span class="n">nets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Net</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="sh">"</span><span class="s">items</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Decl</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">item</span><span class="p">.</span><span class="nb">list</span><span class="p">:</span>
            <span class="n">kind</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NetKind</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Wire</span><span class="p">):</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">NetKind</span><span class="p">.</span><span class="n">WIRE</span>
            <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Reg</span><span class="p">):</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">NetKind</span><span class="p">.</span><span class="n">REG</span>
            <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Integer</span><span class="p">):</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">NetKind</span><span class="p">.</span><span class="n">INTEGER</span>
            <span class="k">if</span> <span class="n">kind</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">signed</span> <span class="o">=</span> <span class="nf">bool</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sh">"</span><span class="s">signed</span><span class="sh">"</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
            <span class="n">w</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sh">"</span><span class="s">width</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span> <span class="o">=</span> <span class="nf">width_tuple</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">e</span><span class="p">.</span><span class="nf">children</span><span class="p">():</span>
                <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Identifier</span><span class="p">):</span>
                    <span class="n">nets</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Net</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">n</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="n">signed</span><span class="p">,</span>
                        <span class="n">msb_str</span><span class="o">=</span><span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_str</span><span class="o">=</span><span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb</span><span class="o">=</span><span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb</span><span class="o">=</span><span class="n">lsb_v</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width_v</span>
                    <span class="p">))</span>
    <span class="k">return</span> <span class="n">nets</span>

<span class="c1"># -------------------- Instance walker --------------------
</span>
<span class="k">def</span> <span class="nf">iter_instancelists</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">InstanceList</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">node</span>
    <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="sh">"</span><span class="s">children</span><span class="sh">"</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">[])():</span>
        <span class="k">yield</span> <span class="k">from</span> <span class="nf">iter_instancelists</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>

<span class="c1"># -------------------- 2nd pass: normalize module --------------------
</span>
<span class="k">def</span> <span class="nf">normalize_module</span><span class="p">(</span><span class="n">mod</span><span class="p">:</span> <span class="n">vast</span><span class="p">.</span><span class="n">ModuleDef</span><span class="p">,</span> <span class="n">modlib_ports</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">ModuleIR</span><span class="p">:</span>
    <span class="n">env</span> <span class="o">=</span> <span class="nf">collect_param_env</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>

    <span class="c1"># parameters
</span>    <span class="n">params</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="sh">"</span><span class="s">paramlist</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mod</span><span class="p">.</span><span class="n">paramlist</span><span class="p">.</span><span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Parameter</span><span class="p">):</span>
                <span class="n">params</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Parameter</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">value_str</span><span class="o">=</span><span class="nf">to_str</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">value</span><span class="p">),</span>
                    <span class="n">value</span><span class="o">=</span><span class="nf">eval_expr</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">),</span>
                <span class="p">))</span>
    <span class="c1"># body params (dedupe)
</span>    <span class="n">header_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="sh">"</span><span class="s">items</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]:</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Decl</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">item</span><span class="p">.</span><span class="nb">list</span><span class="p">:</span>
                <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Parameter</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="p">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">header_names</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Parameter</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">value_str</span><span class="o">=</span><span class="nf">to_str</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">value</span><span class="p">),</span>
                        <span class="n">value</span><span class="o">=</span><span class="nf">eval_expr</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">),</span>
                    <span class="p">))</span>

    <span class="c1"># ports
</span>    <span class="n">io_map</span> <span class="o">=</span> <span class="nf">build_io_decl_map</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
    <span class="n">ordered_names</span> <span class="o">=</span> <span class="nf">ordered_port_names</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
    <span class="n">ports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Port</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pname</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">ordered_names</span><span class="p">):</span>
        <span class="n">dir_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">signed</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">msb_s</span> <span class="o">=</span> <span class="n">lsb_s</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">msb_v</span> <span class="o">=</span> <span class="n">lsb_v</span> <span class="o">=</span> <span class="n">width_v</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">ansi_hit</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">mod</span><span class="p">.</span><span class="n">portlist</span> <span class="ow">and</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">mod</span><span class="p">.</span><span class="n">portlist</span><span class="p">.</span><span class="n">ports</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">vast</span><span class="p">.</span><span class="n">Ioport</span><span class="p">):</span>
            <span class="n">io</span> <span class="o">=</span> <span class="n">mod</span><span class="p">.</span><span class="n">portlist</span><span class="p">.</span><span class="n">ports</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">decl</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">second</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Input</span><span class="p">):</span>  <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">INPUT</span>
            <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Output</span><span class="p">):</span> <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">OUTPUT</span>
            <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Inout</span><span class="p">):</span> <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">INOUT</span>
            <span class="n">signed</span> <span class="o">=</span> <span class="nf">bool</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="sh">"</span><span class="s">signed</span><span class="sh">"</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
            <span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span> <span class="o">=</span> <span class="nf">width_tuple</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="sh">"</span><span class="s">width</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="n">env</span><span class="p">)</span>
            <span class="n">ansi_hit</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ansi_hit</span> <span class="ow">and</span> <span class="n">pname</span> <span class="ow">in</span> <span class="n">io_map</span><span class="p">:</span>
            <span class="n">dir_</span><span class="p">,</span> <span class="n">signed</span><span class="p">,</span> <span class="p">(</span><span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span><span class="p">)</span> <span class="o">=</span> <span class="n">io_map</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">msb_s</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">lsb_s</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">msb_v</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">lsb_v</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">width_v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># width unspecified -&gt; 1-bit
</span>            <span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span> <span class="o">=</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

        <span class="n">ports</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Port</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">pname</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">dir_</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="n">signed</span><span class="p">,</span>
            <span class="n">msb_str</span><span class="o">=</span><span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_str</span><span class="o">=</span><span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb</span><span class="o">=</span><span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb</span><span class="o">=</span><span class="n">lsb_v</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width_v</span>
        <span class="p">))</span>

    <span class="c1"># nets (exclude top ports)
</span>    <span class="n">nets_raw</span> <span class="o">=</span> <span class="nf">build_net_decl_list</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
    <span class="n">port_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">}</span>
    <span class="n">nets</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nets_raw</span> <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">port_names</span><span class="p">]</span>

    <span class="c1"># instances
</span>    <span class="n">instances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Instance</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">il</span> <span class="ow">in</span> <span class="nf">iter_instancelists</span><span class="p">(</span><span class="n">mod</span><span class="p">):</span>
        <span class="n">submod</span> <span class="o">=</span> <span class="n">il</span><span class="p">.</span><span class="n">module</span>

        <span class="n">shared_param_ovrs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">il</span><span class="p">,</span> <span class="sh">"</span><span class="s">paramlist</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">pa</span> <span class="ow">in</span> <span class="n">il</span><span class="p">.</span><span class="n">paramlist</span><span class="p">.</span><span class="n">params</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">paramname</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="n">value_node</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">argname</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="n">shared_param_ovrs</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Parameter</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">value_str</span><span class="o">=</span><span class="nf">to_str</span><span class="p">(</span><span class="n">value_node</span><span class="p">),</span>
                    <span class="n">value</span><span class="o">=</span><span class="nf">eval_expr</span><span class="p">(</span><span class="n">value_node</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
                <span class="p">))</span>

        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">il</span><span class="p">.</span><span class="n">instances</span><span class="p">:</span>
            <span class="n">conns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Connection</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">portargs</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="sh">"</span><span class="s">portlist</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]</span>
            <span class="n">positional</span> <span class="o">=</span> <span class="nf">any</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">portname</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span> <span class="k">for</span> <span class="n">pa</span> <span class="ow">in</span> <span class="n">portargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">positional</span><span class="p">:</span>
                <span class="n">lib_ports</span> <span class="o">=</span> <span class="n">modlib_ports</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">submod</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pa</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">portargs</span><span class="p">):</span>
                    <span class="n">pname</span> <span class="o">=</span> <span class="n">lib_ports</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">lib_ports</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="sh">"</span><span class="s">__pos</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span>
                    <span class="n">conns</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Connection</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">pname</span><span class="p">,</span> <span class="n">expr_str</span><span class="o">=</span><span class="nf">to_str</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">argname</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">))))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">pa</span> <span class="ow">in</span> <span class="n">portargs</span><span class="p">:</span>
                    <span class="n">conns</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Connection</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">pa</span><span class="p">.</span><span class="n">portname</span><span class="p">,</span> <span class="n">expr_str</span><span class="o">=</span><span class="nf">to_str</span><span class="p">(</span><span class="n">pa</span><span class="p">.</span><span class="n">argname</span><span class="p">)))</span>

            <span class="n">instances</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Instance</span><span class="p">(</span>
                <span class="n">inst</span><span class="o">=</span><span class="n">inst</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="n">submod</span><span class="p">,</span>
                <span class="n">param_overrides</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">shared_param_ovrs</span><span class="p">),</span>
                <span class="n">connections</span><span class="o">=</span><span class="n">conns</span>
            <span class="p">))</span>

    <span class="k">return</span> <span class="nc">ModuleIR</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">ports</span><span class="o">=</span><span class="n">ports</span><span class="p">,</span> <span class="n">nets</span><span class="o">=</span><span class="n">nets</span><span class="p">,</span> <span class="n">instances</span><span class="o">=</span><span class="n">instances</span><span class="p">)</span>

<span class="c1"># -------------------- Public API --------------------
</span>
<span class="k">def</span> <span class="nf">convert_to_design_ir</span><span class="p">(</span><span class="n">files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DesignIR</span><span class="p">:</span>
    <span class="n">ast</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nf">parse</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
    <span class="n">mods</span> <span class="o">=</span> <span class="nf">collect_modules</span><span class="p">(</span><span class="n">ast</span><span class="p">)</span>
    <span class="n">modlib_ports</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="nf">ordered_port_names</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mods</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>
    <span class="n">design</span> <span class="o">=</span> <span class="nc">DesignIR</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mods</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="n">design</span><span class="p">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nf">normalize_module</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">modlib_ports</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">design</span>

<span class="c1"># CLI (optional)
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">argparse</span><span class="p">,</span> <span class="n">sys</span>
    <span class="n">ap</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="nc">ArgumentParser</span><span class="p">()</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">verilog</span><span class="sh">"</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="sh">"</span><span class="s">+</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Verilog sources</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">-o</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">--out</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Dump as JSON (for debug)</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">ap</span><span class="p">.</span><span class="nf">parse_args</span><span class="p">()</span>
    <span class="n">ir</span> <span class="o">=</span> <span class="nf">convert_to_design_ir</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">verilog</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">out</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">out</span><span class="p">,</span> <span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">ir</span><span class="p">.</span><span class="nf">to_json</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Pretty print summary
</span>        <span class="k">for</span> <span class="n">mname</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">ir</span><span class="p">.</span><span class="n">modules</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[module] </span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">m</span><span class="p">.</span><span class="n">ports</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  port[</span><span class="si">{</span><span class="n">p</span><span class="p">.</span><span class="n">index</span><span class="si">}</span><span class="s">] </span><span class="si">{</span><span class="n">p</span><span class="p">.</span><span class="nb">dir</span> <span class="ow">and</span> <span class="n">p</span><span class="p">.</span><span class="nb">dir</span><span class="p">.</span><span class="n">value</span> <span class="ow">or</span> <span class="sh">'</span><span class="s">None</span><span class="sh">'</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s"> [</span><span class="si">{</span><span class="n">p</span><span class="p">.</span><span class="n">msb_str</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">p</span><span class="p">.</span><span class="n">lsb_str</span><span class="si">}</span><span class="s">] -&gt; width=</span><span class="si">{</span><span class="n">p</span><span class="p">.</span><span class="n">width</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">m</span><span class="p">.</span><span class="n">nets</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  net </span><span class="si">{</span><span class="n">n</span><span class="p">.</span><span class="n">kind</span><span class="p">.</span><span class="n">value</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">n</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s"> [</span><span class="si">{</span><span class="n">n</span><span class="p">.</span><span class="n">msb_str</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">n</span><span class="p">.</span><span class="n">lsb_str</span><span class="si">}</span><span class="s">] -&gt; width=</span><span class="si">{</span><span class="n">n</span><span class="p">.</span><span class="n">width</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m</span><span class="p">.</span><span class="n">instances</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  inst </span><span class="si">{</span><span class="n">i</span><span class="p">.</span><span class="n">inst</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">i</span><span class="p">.</span><span class="n">module</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">i</span><span class="p">.</span><span class="n">connections</span><span class="p">:</span>
                    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">    .</span><span class="si">{</span><span class="n">c</span><span class="p">.</span><span class="n">port</span><span class="si">}</span><span class="s">(</span><span class="si">{</span><span class="n">c</span><span class="p">.</span><span class="n">expr_str</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h1 id="5-ì‚¬ìš©-ì˜ˆì‹œ-step-by-step">5) ì‚¬ìš© ì˜ˆì‹œ (Step-by-step)</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python vnorm_classes.py top.v            <span class="c"># ìš”ì•½ ì¶œë ¥</span>
python vnorm_classes.py top.v <span class="nt">-o</span> ir.json <span class="c"># ë””ë²„ê·¸ìš© JSON ë¤í”„(ì˜µì…˜)</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ë¼ì´ë¸ŒëŸ¬ë¦¬ì²˜ëŸ¼ ì‚¬ìš©
</span><span class="kn">from</span> <span class="n">vnorm_classes</span> <span class="kn">import</span> <span class="n">convert_to_design_ir</span><span class="p">,</span> <span class="n">Direction</span>

<span class="n">ir</span> <span class="o">=</span> <span class="nf">convert_to_design_ir</span><span class="p">([</span><span class="sh">"</span><span class="s">top.v</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">child.v</span><span class="sh">"</span><span class="p">])</span>
<span class="n">top</span> <span class="o">=</span> <span class="n">ir</span><span class="p">.</span><span class="n">modules</span><span class="p">[</span><span class="sh">"</span><span class="s">top</span><span class="sh">"</span><span class="p">]</span>

<span class="c1"># í¬íŠ¸ ìˆœíšŒ
</span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">top</span><span class="p">.</span><span class="n">ports</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="nb">dir</span> <span class="ow">and</span> <span class="n">p</span><span class="p">.</span><span class="nb">dir</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">width</span><span class="p">)</span>

<span class="c1"># ì¸ìŠ¤í„´ìŠ¤/ì—°ê²° ìˆœíšŒ
</span><span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">top</span><span class="p">.</span><span class="n">instances</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">inst</span><span class="sh">"</span><span class="p">,</span> <span class="n">inst</span><span class="p">.</span><span class="n">inst</span><span class="p">,</span> <span class="sh">"</span><span class="s">:</span><span class="sh">"</span><span class="p">,</span> <span class="n">inst</span><span class="p">.</span><span class="n">module</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">inst</span><span class="p">.</span><span class="n">connections</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">  </span><span class="sh">"</span><span class="p">,</span> <span class="n">c</span><span class="p">.</span><span class="n">port</span><span class="p">,</span> <span class="sh">"</span><span class="s">=&gt;</span><span class="sh">"</span><span class="p">,</span> <span class="n">c</span><span class="p">.</span><span class="n">expr_str</span><span class="p">)</span>

<span class="c1"># í•„ìš” ì‹œ JSON ì§ë ¬í™”ë„ ê°€ëŠ¥ (í…ŒìŠ¤íŠ¸/ë¡œê¹…ìš©)
</span><span class="nf">print</span><span class="p">(</span><span class="n">ir</span><span class="p">.</span><span class="nf">to_json</span><span class="p">())</span>
</code></pre></div></div>

<hr />

<h1 id="6-ì£¼ì˜í™•ì¥-step-by-step">6) ì£¼ì˜/í™•ì¥ (Step-by-step)</h1>

<ul>
  <li>
    <p><strong>í‘œí˜„ì‹ í‰ê°€ ì‹¤íŒ¨</strong> : <code class="language-plaintext highlighter-rouge">value/width/msb/lsb</code>ëŠ” <code class="language-plaintext highlighter-rouge">None</code>ì´ ë  ìˆ˜ ìˆìŒ. ì›ë¬¸ì€ <code class="language-plaintext highlighter-rouge">*_str</code>ì— ë³´ì¡´.</p>
  </li>
  <li>
    <p><strong>í¬ì§€ì…”ë„ ì—°ê²°</strong> : ë¼ì´ë¸ŒëŸ¬ë¦¬ì— í•´ë‹¹ ì„œë¸Œëª¨ë“ˆì´ ì—†ìœ¼ë©´ <code class="language-plaintext highlighter-rouge">__pos0</code>ì²˜ëŸ¼ ë³´ì¡´.</p>
  </li>
  <li>
    <p><strong>SystemVerilog í™•ì¥</strong> : <code class="language-plaintext highlighter-rouge">logic</code>, packed/unpacked, interface í¬íŠ¸ ë“±ì€ ë³„ ë ˆì´ì–´ë¡œ í™•ì¥ ì¶”ì²œ.</p>
  </li>
  <li>
    <p><strong>ìœ„ì¹˜ ì •ë³´</strong> : í•„ìš”í•˜ë©´ <code class="language-plaintext highlighter-rouge">lineno/coord</code>ë¥¼ dataclassì— ì¶”ê°€ ê°€ëŠ¥.</p>
  </li>
  <li>
    <p><strong>ê²€ì¦</strong> : í° ì„¤ê³„ì—ì„œ ìŠ¤í‚¤ë§ˆ ë³´ì¥ ì›í•˜ë©´ <code class="language-plaintext highlighter-rouge">pydantic</code>ìœ¼ë¡œ êµì²´ ê°€ëŠ¥.</p>
  </li>
</ul>

<p>ì›í•˜ëŠ” ëŒ€ë¡œ <strong>ì§ì ‘ íƒìƒ‰ ê°€ëŠ¥í•œ Python í´ë˜ìŠ¤ IR</strong> ë¡œ ë³€í™˜ë˜ë„ë¡ êµ¬ì„±í•´ ë‘ì—ˆì–´.<br />
ì›í•˜ë©´ <code class="language-plaintext highlighter-rouge">Connection</code>ì— ì¢Œí‘œ/ì†ŒìŠ¤íŒŒì¼ ì •ë³´ë‚˜, <code class="language-plaintext highlighter-rouge">ModuleIR</code>ì— ë¹ ë¥¸ ì¸ë±ìŠ¤(ì˜ˆ: <code class="language-plaintext highlighter-rouge">port_dict</code>)ë¥¼ ì¶”ê°€í•´ì£¼ëŠ” ìµœì í™” ë²„ì „ë„ ë°”ë¡œ ë§Œë“¤ì–´ì¤„ê²Œ.</p>

<p class="chat--user">

IRì´ ë­ì•¼

</p>

<p>ì¢‹ì€ ì§ˆë¬¸! <strong>IR(Intermediate Representation, ì¤‘ê°„ í‘œí˜„)</strong>ì€ <em>ì†ŒìŠ¤ ì½”ë“œ(ë˜ëŠ” ì„¤ê³„)ë¥¼ í•œì¸µ í‘œì¤€í™”ëœ í˜•íƒœë¡œ ë‹´ì•„ë‘ëŠ” ì¤‘ê°„ ë‹¨ê³„ì˜ ë°ì´í„° êµ¬ì¡°</em> ì˜ˆìš”. íŒŒì„œê°€ ë§Œë“  â€œë¬¸ë²• ê·¸ëŒ€ë¡œâ€ì˜ íŠ¸ë¦¬(AST)ì™€, ê·¸ê±¸ ì¨ì„œ ë¶„ì„Â·ë³€í™˜Â·ì½”ë“œìƒì„± ê°™ì€ í›„ì²˜ë¦¬ ì‚¬ì´ì— ë†“ì…ë‹ˆë‹¤.</p>

<p>ì•„ë˜ì²˜ëŸ¼ <strong>ì°¨ê·¼ì°¨ê·¼</strong> ì´í•´í•˜ë©´ í¸í•´ìš”:</p>

<ol>
  <li>
    <p><strong>ì •ì˜</strong></p>

    <ul>
      <li>IR = ë¶„ì„Â·ìµœì í™”Â·ë³€í™˜ì„ í•˜ê¸° ì‰½ë„ë¡ ë§Œë“  <strong>í‘œì¤€í™”ëœ ë‚´ë¶€ ë°ì´í„° ëª¨ë¸</strong>.</li>
    </ul>
  </li>
  <li>
    <p><strong>ì™œ í•„ìš”í•œê°€</strong></p>

    <ul>
      <li>
        <p>ì–¸ì–´ ë¬¸ë²• ì°¨ì´/ìŠ¤íƒ€ì¼(ì˜ˆ: Verilog ANSI vs Non-ANSI í¬íŠ¸ ì„ ì–¸)ì„ <strong>í•œ ê°€ì§€ ê·œì¹™</strong> ìœ¼ë¡œ í†µì¼.</p>
      </li>
      <li>
        <p><strong>íŠ¸ë˜ë²„ìŠ¤(ìˆœíšŒ) ì‰¬ì›€</strong> : í•„ìš”í•œ ì •ë³´ê°€ ê°™ì€ ìë¦¬/í˜•íƒœì— ìˆìŒ.</p>
      </li>
      <li>
        <p><strong>ëª¨ë“ˆì„±</strong> : í”„ëŸ°íŠ¸ì—”ë“œ(AST)ì™€ ë°±ì—”ë“œ(ë¶„ì„/ìƒì„±)ë¥¼ ëŠìŠ¨í•˜ê²Œ ê²°í•©.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ASTì™€ì˜ ì°¨ì´</strong></p>

    <ul>
      <li>
        <p><strong>AST</strong> : ì›ë¬¸ ë¬¸ë²•ì„ ê±°ì˜ ê·¸ëŒ€ë¡œ ë°˜ì˜(ì¼€ì´ìŠ¤ê°€ ë§ê³  ì˜ˆì™¸ ì²˜ë¦¬ í•„ìš”).</p>
      </li>
      <li>
        <p><strong>IR</strong> : ì˜ë¯¸ ì¤‘ì‹¬ìœ¼ë¡œ <strong>ì •ê·œí™”/ì •ë¦¬</strong>(ì˜ˆ: í¬ì§€ì…”ë„ ì¸ìŠ¤í„´ìŠ¤ â†’ ë„¤ì„ë“œë¡œ ë³€í™˜, í­ ë¯¸ì§€ì •â†’1ë¹„íŠ¸ë¡œ í†µì¼, ìƒìˆ˜ ê°€ëŠ¥í•˜ë©´ í‰ê°€).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ì¼ë°˜ì ì¸ IRì˜ í˜•íƒœ</strong></p>

    <ul>
      <li>
        <p>ì»´íŒŒì¼ëŸ¬: SSA, 3-address code, CFG/DFG ë“±</p>
      </li>
      <li>
        <p>í•˜ë“œì›¨ì–´: <strong>ë„·ë¦¬ìŠ¤íŠ¸-ìœ ì‚¬ êµ¬ì¡°</strong> , íŒŒë¼ë¯¸í„° í‰ê°€ ê²°ê³¼, ëª¨ë“ˆ/ì¸ìŠ¤í„´ìŠ¤/ì—°ê²° ê´€ê³„ ë“±</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ë‹¹ì‹ ì˜ í”„ë¡œì íŠ¸ì—ì„œì˜ IR</strong></p>

    <ul>
      <li>
        <p>ìš°ë¦¬ê°€ ì„¤ê³„í•œ <strong>Python dataclass IR</strong> ì´ ê³§ IR:</p>

        <ul>
          <li>
            <p><code class="language-plaintext highlighter-rouge">ModuleIR</code> ì•ˆì— <code class="language-plaintext highlighter-rouge">ports</code>, <code class="language-plaintext highlighter-rouge">nets</code>, <code class="language-plaintext highlighter-rouge">instances</code>, <code class="language-plaintext highlighter-rouge">parameters</code></p>
          </li>
          <li>
            <p>í¬íŠ¸ ë°©í–¥/í­, ë‚´ë¶€ ë„· í­, ì¸ìŠ¤í„´ìŠ¤ì˜ í¬íŠ¸ ë§¤í•‘ì„ <strong>ì¼ê´€ëœ ìŠ¤í‚¤ë§ˆ</strong> ë¡œ ì œê³µ</p>
          </li>
          <li>
            <p>ê°€ëŠ¥í•œ ë²”ìœ„ì—ì„œ <strong>ì •ìˆ˜ í‰ê°€</strong>(<code class="language-plaintext highlighter-rouge">width</code>, <code class="language-plaintext highlighter-rouge">msb/lsb</code>) ì ìš©, ì‹¤íŒ¨í•´ë„ ì›ë¬¸(<code class="language-plaintext highlighter-rouge">*_str</code>) ë³´ì¡´</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ì–»ëŠ” ì´ì </strong></p>

    <ul>
      <li>
        <p>ì´í›„ ë‹¨ê³„(ì˜ˆ: ì—°ê²° ê²€ì‚¬, ìë™ ë°°ì„ , ë¬¸ì„œí™”, ì½”ë“œ ìƒì„±, ì‹œê°í™”)ë¥¼ <strong>ì˜ˆì™¸ì²˜ë¦¬ ê±°ì˜ ì—†ì´</strong> êµ¬í˜„ ê°€ëŠ¥.</p>
      </li>
      <li>
        <p>ë„êµ¬ ê°„ <strong>ì¬ì‚¬ìš©</strong> Â·í™•ì¥ ìš©ì´.</p>
      </li>
    </ul>
  </li>
</ol>

<p>í•œ ì¤„ ìš”ì•½: <strong>IRì€ â€œë‹¤ë£¨ê¸° ì‰¬ìš´ í‘œì¤€í˜• ì„¤ê³„ ìŠ¤ëƒ…ìƒ·â€</strong>ì´ê³ , ì§€ê¸ˆ ë§Œë“¤ê³  ìˆëŠ” Python í´ë˜ìŠ¤ë“¤ì´ ë°”ë¡œ ê·¸ IRì´ì—ìš”.</p>

<p class="chat--user">

decl = io.first ì´ì•¼. ê·¼ë° Enumì„ Serialize ëª»í•´ì„œ json ë³€í™˜ ë¶€ë¶„ì—ì„œ ì—ëŸ¬ê°€ ë‚˜

</p>

<p>ì¢‹ì€ í¬ì¸íŠ¸ ë‘ ê°€ì§€!</p>

<ul>
  <li>
    <p><strong>(A)</strong> <code class="language-plaintext highlighter-rouge">Ioport</code>ì—ì„œ ì„ ì–¸/ì´ë¦„ì˜ ìœ„ì¹˜ê°€ í™˜ê²½ë§ˆë‹¤ ë‹¬ë¼ <code class="language-plaintext highlighter-rouge">decl = io.first</code>ê°€ ë˜ëŠ” ì¼€ì´ìŠ¤ê°€ ìˆì–´ìš”. â‡’ <strong>ì–‘ìª½ ëª¨ë‘ ìë™ ê°ì§€</strong> í•˜ë„ë¡ ë°”ê¿‰ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p><strong>(B)</strong> <code class="language-plaintext highlighter-rouge">Enum</code>ì€ ê¸°ë³¸ <code class="language-plaintext highlighter-rouge">json.dumps</code>ë¡œ ì§ë ¬í™”ê°€ ì•ˆ ë©ë‹ˆë‹¤. â‡’ <strong>custom default/encoder</strong> ë¡œ <code class="language-plaintext highlighter-rouge">.value</code>ë¥¼ ì“°ê²Œ í•˜ë©´ í•´ê²°ë©ë‹ˆë‹¤.</p>
  </li>
</ul>

<p>ì•„ë˜ë¥¼ ê·¸ëŒ€ë¡œ ë°˜ì˜í•˜ì„¸ìš”. (í•„ìš”í•œ ë¶€ë¶„ë§Œ êµì²´/ì¶”ê°€)</p>

<hr />

<h2 id="1-ioport-ì–‘ì‹-ì°¨ì´ë¥¼-ìë™-ê°ì§€-firstsecond-ìŠ¤ì™‘-ëŒ€ì‘">1) <code class="language-plaintext highlighter-rouge">Ioport</code> ì–‘ì‹ ì°¨ì´ë¥¼ ìë™ ê°ì§€ (first/second ìŠ¤ì™‘ ëŒ€ì‘)</h2>

<h3 id="ordered_port_names-êµì²´"><code class="language-plaintext highlighter-rouge">ordered_port_names</code> êµì²´</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">ordered_port_names</span><span class="p">(</span><span class="n">mod</span><span class="p">:</span> <span class="n">vast</span><span class="p">.</span><span class="n">ModuleDef</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">mod</span><span class="p">.</span><span class="n">portlist</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">names</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mod</span><span class="p">.</span><span class="n">portlist</span><span class="p">.</span><span class="n">ports</span><span class="p">:</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Ioport</span><span class="p">):</span>
            <span class="c1"># Robust: ì´ë¦„ì´ ì–´ëŠ ìª½(first/second)ì— ìˆë“  ì¡ì•„ë‚¸ë‹¤
</span>            <span class="n">name_node</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Identifier</span><span class="p">):</span>
                <span class="n">name_node</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">first</span>
            <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Identifier</span><span class="p">):</span>
                <span class="n">name_node</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">second</span>
            <span class="k">if</span> <span class="n">name_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">names</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">name_node</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Port</span><span class="p">):</span>
            <span class="n">names</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">names</span>
</code></pre></div></div>

<h3 id="normalize_module-ë‚´ë¶€ì˜-í¬íŠ¸-ì •ê·œí™”-ë¶€ë¶„-ìˆ˜ì •"><code class="language-plaintext highlighter-rouge">normalize_module</code> ë‚´ë¶€ì˜ í¬íŠ¸ ì •ê·œí™” ë¶€ë¶„ ìˆ˜ì •</h3>

<p>ì•„ë˜ì²˜ëŸ¼ <strong>decl(ë°©í–¥/í­ì„ ê°€ì§„ ì„ ì–¸ ë…¸ë“œ)</strong>ë¥¼ ì–´ëŠ ìª½(first/second)ì´ë“  ì¡ë„ë¡ ë°”ê¿‰ë‹ˆë‹¤.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1"># ...
</span>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pname</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">ordered_names</span><span class="p">):</span>
        <span class="n">dir_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">signed</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">msb_s</span> <span class="o">=</span> <span class="n">lsb_s</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">msb_v</span> <span class="o">=</span> <span class="n">lsb_v</span> <span class="o">=</span> <span class="n">width_v</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">ansi_hit</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">mod</span><span class="p">.</span><span class="n">portlist</span> <span class="ow">and</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">mod</span><span class="p">.</span><span class="n">portlist</span><span class="p">.</span><span class="n">ports</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">vast</span><span class="p">.</span><span class="n">Ioport</span><span class="p">):</span>
            <span class="n">io</span> <span class="o">=</span> <span class="n">mod</span><span class="p">.</span><span class="n">portlist</span><span class="p">.</span><span class="n">ports</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

            <span class="c1"># ì–´ëŠ ìª½ì´ ì„ ì–¸ ë…¸ë“œì¸ì§€ ê°ì§€
</span>            <span class="k">def</span> <span class="nf">_is_decl</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">vast</span><span class="p">.</span><span class="n">Input</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Output</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Inout</span><span class="p">))</span>

            <span class="n">decl</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="nf">_is_decl</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">first</span><span class="p">):</span>
                <span class="n">decl</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">first</span>
            <span class="k">elif</span> <span class="nf">_is_decl</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">second</span><span class="p">):</span>
                <span class="n">decl</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">second</span>

            <span class="k">if</span> <span class="n">decl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Input</span><span class="p">):</span>  <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">INPUT</span>
                <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Output</span><span class="p">):</span> <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">OUTPUT</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">INOUT</span>
                <span class="n">signed</span> <span class="o">=</span> <span class="nf">bool</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="sh">"</span><span class="s">signed</span><span class="sh">"</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
                <span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span> <span class="o">=</span> <span class="nf">width_tuple</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="sh">"</span><span class="s">width</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="n">env</span><span class="p">)</span>
                <span class="n">ansi_hit</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1"># Non-ANSI fallback
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ansi_hit</span> <span class="ow">and</span> <span class="n">pname</span> <span class="ow">in</span> <span class="n">io_map</span><span class="p">:</span>
            <span class="n">dir_</span><span class="p">,</span> <span class="n">signed</span><span class="p">,</span> <span class="p">(</span><span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span><span class="p">)</span> <span class="o">=</span> <span class="n">io_map</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span>

        <span class="c1"># í­ ë¯¸ì§€ì • â†’ 1ë¹„íŠ¸
</span>        <span class="k">if</span> <span class="nf">all</span><span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span><span class="p">)):</span>
            <span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span> <span class="o">=</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

        <span class="n">ports</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Port</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">pname</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">dir_</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="n">signed</span><span class="p">,</span>
            <span class="n">msb_str</span><span class="o">=</span><span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_str</span><span class="o">=</span><span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb</span><span class="o">=</span><span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb</span><span class="o">=</span><span class="n">lsb_v</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width_v</span>
        <span class="p">))</span>
</code></pre></div></div>

<blockquote>
  <p>ì´ë ‡ê²Œ í•˜ë©´ <strong><code class="language-plaintext highlighter-rouge">decl = io.first</code></strong>ì¸ ì¼€ì´ìŠ¤ë„, ë°˜ëŒ€ë¡œ <strong><code class="language-plaintext highlighter-rouge">decl = io.second</code></strong>ì¸ ì¼€ì´ìŠ¤ë„ ëª¨ë‘ ì •ìƒ ì²˜ë¦¬ë¼ìš”.</p>
</blockquote>

<hr />

<h2 id="2-enum-json-ì§ë ¬í™”-ì—ëŸ¬-í•´ê²°">2) Enum JSON ì§ë ¬í™” ì—ëŸ¬ í•´ê²°</h2>

<p><code class="language-plaintext highlighter-rouge">json.dumps</code>ì— <code class="language-plaintext highlighter-rouge">default</code>ë¥¼ ì£¼ê±°ë‚˜, ì»¤ìŠ¤í…€ <code class="language-plaintext highlighter-rouge">JSONEncoder</code>ë¥¼ ì¨ì„œ <code class="language-plaintext highlighter-rouge">Enum</code>ì„ <code class="language-plaintext highlighter-rouge">.value</code>ë¡œ ë°”ê¿” ì£¼ì„¸ìš”.</p>

<h3 id="ê°„ë‹¨-ë²„ì „-default-í•¨ìˆ˜-ì¶”ê°€">ê°„ë‹¨ ë²„ì „: <code class="language-plaintext highlighter-rouge">default</code> í•¨ìˆ˜ ì¶”ê°€</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">from</span> <span class="n">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">asdict</span>

<span class="k">def</span> <span class="nf">_json_default</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
    <span class="c1"># Enum -&gt; ê·¸ ê°’ìœ¼ë¡œ ì§ë ¬í™”
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">o</span><span class="p">.</span><span class="n">value</span>
    <span class="c1"># í•„ìš”ì‹œ ì¶”ê°€ í•¸ë“¤ë§ ê°€ëŠ¥
</span>    <span class="k">return</span> <span class="nf">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DesignIR</span><span class="p">:</span>
    <span class="n">modules</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ModuleIR</span><span class="p">]</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="nf">asdict</span><span class="p">(</span><span class="n">self</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_json_default</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ëŒ€ì•ˆ-encoder-í´ë˜ìŠ¤ë¡œ">ëŒ€ì•ˆ: Encoder í´ë˜ìŠ¤ë¡œ</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">EnumEncoder</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">o</span><span class="p">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="nf">super</span><span class="p">().</span><span class="nf">default</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

<span class="c1"># ì‚¬ìš©
</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="nf">asdict</span><span class="p">(</span><span class="n">self</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cls</span><span class="o">=</span><span class="n">EnumEncoder</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>ì–´ëŠ ìª½ì´ë“  ê²°ê³¼ëŠ” ë™ì¼: <code class="language-plaintext highlighter-rouge">Direction.INPUT</code> â†’ <code class="language-plaintext highlighter-rouge">"input"</code>, <code class="language-plaintext highlighter-rouge">NetKind.WIRE</code> â†’ <code class="language-plaintext highlighter-rouge">"wire"</code>ì²˜ëŸ¼ ì§ë ¬í™”ë©ë‹ˆë‹¤.</p>
</blockquote>

<hr />

<h2 id="3-ë¹ ë¥¸-ì²´í¬ë¦¬ìŠ¤íŠ¸-step-by-step">3) ë¹ ë¥¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ (step-by-step)</h2>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ordered_port_names</code>ë¥¼ ìœ„ ì½”ë“œë¡œ <strong>êµì²´</strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">normalize_module</code>ì˜ <strong>í¬íŠ¸ ì²˜ë¦¬ ë¸”ë¡</strong> ì„ ìœ„ ì½”ë“œë¡œ <strong>êµì²´</strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">DesignIR.to_json</code>ì—ì„œ <code class="language-plaintext highlighter-rouge">default=_json_default</code> ë˜ëŠ” <code class="language-plaintext highlighter-rouge">cls=EnumEncoder</code>ë¥¼ <strong>ì ìš©</strong></p>
  </li>
  <li>
    <p>ë‹¤ì‹œ ì‹¤í–‰í•´ì„œ <code class="language-plaintext highlighter-rouge">Enum</code> ì§ë ¬í™” ì—ëŸ¬ê°€ ì‚¬ë¼ì§€ëŠ”ì§€, ANSI/Non-ANSI ëª¨ë‘ì—ì„œ í¬íŠ¸ ë°©í–¥/í­ì´ ì œëŒ€ë¡œ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸</p>
  </li>
</ol>

<p>í•„ìš”í•˜ë©´ <code class="language-plaintext highlighter-rouge">Port.dir</code> íƒ€ì…ì„ ì¼ì‹œì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">Optional[str]</code>ë¡œ ë°”ê¿”ë„ ë˜ì§€ë§Œ, ìœ„ì²˜ëŸ¼ <strong>Enum ìœ ì§€ + ì§ë ¬í™” ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ</strong> ê°€ ë” ì•ˆì •ì ì´ì—ìš”.<br />
ë‹¤ë¥¸ ë¶€ë¶„ë„ ë§‰íˆëŠ” ê²Œ ìˆìœ¼ë©´ ì˜¤ë¥˜ ë©”ì‹œì§€ë‘ í•¨ê»˜ ì•Œë ¤ì¤˜â€”ê±°ê¸°ì— ë§ì¶° ì¶”ê°€ íŒ¨ì¹˜ ì¤„ê²Œ!</p>

<p class="chat--user">

1. Normalize ë§ê³  í‘œì¤€í™”/ì •ê·œí™” ë¼ëŠ” ëŠë‚Œìœ¼ë¡œ rename í•˜ëŠ” ê±¸ ì œì•ˆí•´. 2. Port ë°©í–¥ì´ non ansi íƒ€ì…ìœ¼ë¡œ ë˜ì–´ìˆì„ ê²½ìš°ì— ì°¾ìœ¼ë©´ ì—…ë°ì´íŠ¸í•˜ë„ë¡ í•´ì¤˜

</p>

<p>ì¢‹ì•„â€”ìš”ì²­í•œ ë‘ ê°€ì§€ë¥¼ <strong>ì°¨ê·¼ì°¨ê·¼</strong> ë°˜ì˜í• ê²Œ.</p>

<hr />

<h1 id="1-normalize-ì´ë¦„ì„-í‘œì¤€í™”ì •ê·œí™”-ëŠë‚Œìœ¼ë¡œ-ë³€ê²½-ì œì•ˆ">1) â€œNormalizeâ€ ì´ë¦„ì„ â€œí‘œì¤€í™”/ì •ê·œí™”â€ ëŠë‚Œìœ¼ë¡œ ë³€ê²½ ì œì•ˆ</h1>

<p>ì˜ì–´ ì‹ë³„ìëŠ” ê·¸ëŒ€ë¡œ ì“°ë˜ ì˜ë¯¸ë¥¼ â€œí‘œì¤€í™”/ì •ê·œí™”â€ë¡œ ë°”ê¿” ì½íˆë„ë¡ ì¶”ì²œí•´.</p>

<p><strong>ì´ë¦„ ë§¤í•‘(ê¶Œì¥)</strong></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">normalize_module</code> â†’ <code class="language-plaintext highlighter-rouge">standardize_module</code> <em>(í‘œì¤€í™”)</em></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">convert_to_design_ir</code> â†’ <code class="language-plaintext highlighter-rouge">build_standard_ir</code> <em>(í‘œì¤€ IR ë¹Œë“œ)</em></p>
  </li>
  <li>
    <p>íŒŒì¼ëª… <code class="language-plaintext highlighter-rouge">vnorm_classes.py</code> â†’ <code class="language-plaintext highlighter-rouge">std_ir.py</code> <em>(standardized IR)</em></p>
  </li>
</ul>

<p><strong>í˜¸í™˜ìš© ë˜í¼(ì„ íƒ)</strong><br />
ê¸°ì¡´ í˜¸ì¶œë¶€ ì•ˆ ê¹¨ì§€ê²Œ ì•„ë˜ì²˜ëŸ¼ ìœ ì§€í•´ë„ ì¢‹ì•„.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">convert_to_design_ir</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
    <span class="c1"># deprecated alias for backward-compat
</span>    <span class="k">return</span> <span class="nf">build_standard_ir</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h1 id="2-non-ansi-ì„ ì–¸ì—ì„œ-í¬íŠ¸-ë°©í–¥ì†ì„±-ë°œê²¬-ì‹œ-ì—…ë°ì´íŠ¸-ë¡œì§-ì¶”ê°€">2) Non-ANSI ì„ ì–¸ì—ì„œ í¬íŠ¸ ë°©í–¥/ì†ì„± ë°œê²¬ ì‹œ <strong>ì—…ë°ì´íŠ¸</strong> ë¡œì§ ì¶”ê°€</h1>

<p>ìš”ì§€ëŠ” â€œí—¤ë”(ANSI)ê°€ ë¹„ì–´ ìˆê±°ë‚˜(non-ANSI ìŠ¤íƒ€ì¼) ë˜ëŠ” ì¶©ëŒ ì‹œ <strong>ë³¸ë¬¸ ì„ ì–¸(Decl)</strong> ì„ ì‹ ë¢°í•´ ë®ì–´ì“°ê¸°â€ë‹¤.<br />
ì•„ë˜ 2ê°œ ì¡°ê°ë§Œ êµì²´/ì¶”ê°€í•˜ë©´ ë¨.</p>

<h2 id="a-í¬íŠ¸-í‘œì¤€í™”-í•¨ìˆ˜-standardize_module-ê¸°ì¡´-normalize_module-ëŒ€ì²´">(A) í¬íŠ¸ í‘œì¤€í™” í•¨ìˆ˜: <code class="language-plaintext highlighter-rouge">standardize_module</code> (ê¸°ì¡´ <code class="language-plaintext highlighter-rouge">normalize_module</code> ëŒ€ì²´)</h2>

<p>ì°¨ì´ì :</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Ioport</code>ì—ì„œ ì„ ì–¸ ë…¸ë“œ(first/second) ìë™ ê°ì§€</p>
  </li>
  <li>
    <p>ì¼ë‹¨ í¬íŠ¸ë¥¼ êµ¬ì„±í•œ ë’¤ <strong>ë³¸ë¬¸ ì„ ì–¸ìœ¼ë¡œ í›„ì²˜ë¦¬ ë®ì–´ì“°ê¸°</strong> ìˆ˜í–‰</p>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">standardize_module</span><span class="p">(</span><span class="n">mod</span><span class="p">:</span> <span class="n">vast</span><span class="p">.</span><span class="n">ModuleDef</span><span class="p">,</span> <span class="n">modlib_ports</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">ModuleIR</span><span class="p">:</span>
    <span class="n">env</span> <span class="o">=</span> <span class="nf">collect_param_env</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>

    <span class="c1"># 1) parameters (ë™ì¼)
</span>    <span class="n">params</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="sh">"</span><span class="s">paramlist</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mod</span><span class="p">.</span><span class="n">paramlist</span><span class="p">.</span><span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Parameter</span><span class="p">):</span>
                <span class="n">params</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Parameter</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value_str</span><span class="o">=</span><span class="nf">to_str</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="nf">eval_expr</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
                <span class="p">))</span>
    <span class="n">header_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="sh">"</span><span class="s">items</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]:</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Decl</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">item</span><span class="p">.</span><span class="nb">list</span><span class="p">:</span>
                <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Parameter</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="p">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">header_names</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Parameter</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value_str</span><span class="o">=</span><span class="nf">to_str</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="nf">eval_expr</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
                    <span class="p">))</span>

    <span class="c1"># 2) í¬íŠ¸ ì´ˆì•ˆ(í—¤ë” ê¸°ë°˜)
</span>    <span class="n">ordered_names</span> <span class="o">=</span> <span class="nf">ordered_port_names</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
    <span class="n">ports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Port</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pname</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">ordered_names</span><span class="p">):</span>
        <span class="n">dir_</span><span class="p">,</span> <span class="n">signed</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">False</span>
        <span class="n">msb_s</span> <span class="o">=</span> <span class="n">lsb_s</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">msb_v</span> <span class="o">=</span> <span class="n">lsb_v</span> <span class="o">=</span> <span class="n">width_v</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># Ioportì—ì„œ first/second ì–´ëŠ ìª½ì´ë“  ì„ ì–¸ ë…¸ë“œ ê°ì§€
</span>        <span class="n">decl</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">mod</span><span class="p">.</span><span class="n">portlist</span> <span class="ow">and</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">mod</span><span class="p">.</span><span class="n">portlist</span><span class="p">.</span><span class="n">ports</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">vast</span><span class="p">.</span><span class="n">Ioport</span><span class="p">):</span>
            <span class="n">io</span> <span class="o">=</span> <span class="n">mod</span><span class="p">.</span><span class="n">portlist</span><span class="p">.</span><span class="n">ports</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">def</span> <span class="nf">_is_decl</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">vast</span><span class="p">.</span><span class="n">Input</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Output</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Inout</span><span class="p">))</span>
            <span class="k">if</span> <span class="nf">_is_decl</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">first</span><span class="p">):</span>  <span class="n">decl</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">first</span>
            <span class="k">elif</span> <span class="nf">_is_decl</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">second</span><span class="p">):</span> <span class="n">decl</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">second</span>
        <span class="k">if</span> <span class="n">decl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Input</span><span class="p">):</span>  <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">INPUT</span>
            <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Output</span><span class="p">):</span> <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">OUTPUT</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">INOUT</span>
            <span class="n">signed</span> <span class="o">=</span> <span class="nf">bool</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="sh">"</span><span class="s">signed</span><span class="sh">"</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
            <span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span> <span class="o">=</span> <span class="nf">width_tuple</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="sh">"</span><span class="s">width</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="n">env</span><span class="p">)</span>

        <span class="c1"># í­ ë¯¸ì§€ì • â†’ 1ë¹„íŠ¸ ê¸°ë³¸
</span>        <span class="k">if</span> <span class="nf">all</span><span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span><span class="p">)):</span>
            <span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span> <span class="o">=</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

        <span class="n">ports</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Port</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">pname</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">dir_</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="n">signed</span><span class="p">,</span>
            <span class="n">msb_str</span><span class="o">=</span><span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_str</span><span class="o">=</span><span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb</span><span class="o">=</span><span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb</span><span class="o">=</span><span class="n">lsb_v</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width_v</span>
        <span class="p">))</span>

    <span class="c1"># 3) ë³¸ë¬¸ ì„ ì–¸(Non-ANSI)ë¡œ **í›„ì²˜ë¦¬ ë®ì–´ì“°ê¸°**
</span>    <span class="n">io_map</span> <span class="o">=</span> <span class="nf">build_io_decl_map</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
    <span class="nf">apply_nonansi_overrides</span><span class="p">(</span><span class="n">ports</span><span class="p">,</span> <span class="n">io_map</span><span class="p">,</span> <span class="n">prefer_body</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c1"># 4) nets (í¬íŠ¸ëª… ì œì™¸)
</span>    <span class="n">nets_raw</span> <span class="o">=</span> <span class="nf">build_net_decl_list</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
    <span class="n">port_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">}</span>
    <span class="n">nets</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nets_raw</span> <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">port_names</span><span class="p">]</span>

    <span class="c1"># 5) instances (ê¸°ì¡´ê³¼ ë™ì¼)
</span>    <span class="n">instances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Instance</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">il</span> <span class="ow">in</span> <span class="nf">iter_instancelists</span><span class="p">(</span><span class="n">mod</span><span class="p">):</span>
        <span class="n">submod</span> <span class="o">=</span> <span class="n">il</span><span class="p">.</span><span class="n">module</span>
        <span class="n">shared_param_ovrs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">il</span><span class="p">,</span> <span class="sh">"</span><span class="s">paramlist</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">pa</span> <span class="ow">in</span> <span class="n">il</span><span class="p">.</span><span class="n">paramlist</span><span class="p">.</span><span class="n">params</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">paramname</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="n">value_node</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">argname</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="n">shared_param_ovrs</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Parameter</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value_str</span><span class="o">=</span><span class="nf">to_str</span><span class="p">(</span><span class="n">value_node</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="nf">eval_expr</span><span class="p">(</span><span class="n">value_node</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
                <span class="p">))</span>
        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">il</span><span class="p">.</span><span class="n">instances</span><span class="p">:</span>
            <span class="n">conns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Connection</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">pas</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="sh">"</span><span class="s">portlist</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]</span>
            <span class="n">positional</span> <span class="o">=</span> <span class="nf">any</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">portname</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span> <span class="k">for</span> <span class="n">pa</span> <span class="ow">in</span> <span class="n">pas</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">positional</span><span class="p">:</span>
                <span class="n">lib_ports</span> <span class="o">=</span> <span class="n">modlib_ports</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">submod</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pa</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">pas</span><span class="p">):</span>
                    <span class="n">pname</span> <span class="o">=</span> <span class="n">lib_ports</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">lib_ports</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="sh">"</span><span class="s">__pos</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span>
                    <span class="n">conns</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Connection</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">pname</span><span class="p">,</span> <span class="n">expr_str</span><span class="o">=</span><span class="nf">to_str</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">argname</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">))))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">pa</span> <span class="ow">in</span> <span class="n">pas</span><span class="p">:</span>
                    <span class="n">conns</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Connection</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">pa</span><span class="p">.</span><span class="n">portname</span><span class="p">,</span> <span class="n">expr_str</span><span class="o">=</span><span class="nf">to_str</span><span class="p">(</span><span class="n">pa</span><span class="p">.</span><span class="n">argname</span><span class="p">)))</span>
            <span class="n">instances</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Instance</span><span class="p">(</span><span class="n">inst</span><span class="o">=</span><span class="n">inst</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="n">submod</span><span class="p">,</span>
                                      <span class="n">param_overrides</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">shared_param_ovrs</span><span class="p">),</span>
                                      <span class="n">connections</span><span class="o">=</span><span class="n">conns</span><span class="p">))</span>
    <span class="k">return</span> <span class="nc">ModuleIR</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">ports</span><span class="o">=</span><span class="n">ports</span><span class="p">,</span> <span class="n">nets</span><span class="o">=</span><span class="n">nets</span><span class="p">,</span> <span class="n">instances</span><span class="o">=</span><span class="n">instances</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="b-ë³¸ë¬¸-ì„ ì–¸-ë®ì–´ì“°ê¸°-í—¬í¼-ì¶”ê°€-apply_nonansi_overrides">(B) ë³¸ë¬¸ ì„ ì–¸ ë®ì–´ì“°ê¸° í—¬í¼ ì¶”ê°€: <code class="language-plaintext highlighter-rouge">apply_nonansi_overrides</code></h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">prefer_body=True</code>ë©´ <strong>í•­ìƒ</strong> ë³¸ë¬¸ ì„ ì–¸ìœ¼ë¡œ ë®ì–´ì”€(ê¶Œì¥)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">prefer_body=False</code>ë©´ ë¹„ì–´ìˆëŠ” ê°’ë§Œ ì±„ì›€</p>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">apply_nonansi_overrides</span><span class="p">(</span><span class="n">ports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Port</span><span class="p">],</span> <span class="n">io_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span> <span class="n">prefer_body</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">io_map</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">dir2</span><span class="p">,</span> <span class="n">signed2</span><span class="p">,</span> <span class="p">(</span><span class="n">msb_s2</span><span class="p">,</span> <span class="n">lsb_s2</span><span class="p">,</span> <span class="n">msb_v2</span><span class="p">,</span> <span class="n">lsb_v2</span><span class="p">,</span> <span class="n">width_v2</span><span class="p">)</span> <span class="o">=</span> <span class="n">io_map</span><span class="p">[</span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">use_body</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">new</span> <span class="nf">if </span><span class="p">(</span><span class="n">prefer_body</span> <span class="ow">or</span> <span class="n">existing</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">existing</span>

        <span class="c1"># ë°©í–¥/ì„œëª…/í­ ëª¨ë‘ ì—…ë°ì´íŠ¸ ê·œì¹™ ì ìš©
</span>        <span class="n">p</span><span class="p">.</span><span class="nb">dir</span>    <span class="o">=</span> <span class="nf">use_body</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="nb">dir</span><span class="p">,</span> <span class="n">dir2</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="n">signed</span> <span class="o">=</span> <span class="nf">use_body</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">signed</span><span class="p">,</span> <span class="n">signed2</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="n">msb_str</span> <span class="o">=</span> <span class="nf">use_body</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">msb_str</span><span class="p">,</span> <span class="n">msb_s2</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="n">lsb_str</span> <span class="o">=</span> <span class="nf">use_body</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lsb_str</span><span class="p">,</span> <span class="n">lsb_s2</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="n">msb</span> <span class="o">=</span> <span class="nf">use_body</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">msb</span><span class="p">,</span> <span class="n">msb_v2</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="n">lsb</span> <span class="o">=</span> <span class="nf">use_body</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lsb</span><span class="p">,</span> <span class="n">lsb_v2</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="nf">use_body</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">width_v2</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="c-ì—”íŠ¸ë¦¬-í¬ì¸íŠ¸-ì´ë¦„-êµì²´-build_standard_ir">(C) ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸ ì´ë¦„ êµì²´ (<code class="language-plaintext highlighter-rouge">build_standard_ir</code>)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">build_standard_ir</span><span class="p">(</span><span class="n">files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DesignIR</span><span class="p">:</span>
    <span class="n">ast</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nf">parse</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
    <span class="n">mods</span> <span class="o">=</span> <span class="nf">collect_modules</span><span class="p">(</span><span class="n">ast</span><span class="p">)</span>
    <span class="n">modlib_ports</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="nf">ordered_port_names</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mods</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>
    <span class="n">design</span> <span class="o">=</span> <span class="nc">DesignIR</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mods</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="n">design</span><span class="p">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nf">standardize_module</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">modlib_ports</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">design</span>

<span class="c1"># (ì„ íƒ) í•˜ìœ„í˜¸í™˜
</span><span class="k">def</span> <span class="nf">convert_to_design_ir</span><span class="p">(</span><span class="n">files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DesignIR</span><span class="p">:</span>
    <span class="k">return</span> <span class="nf">build_standard_ir</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="ë™ì‘-ìš”ì•½-step-by-step">ë™ì‘ ìš”ì•½ (step-by-step)</h2>

<ol>
  <li>
    <p>í—¤ë”ì—ì„œ í¬íŠ¸ <strong>ì´ˆì•ˆ</strong> ìƒì„± (ANSIë©´ ê·¸ ê°’ ì‚¬ìš©, ì•„ë‹ˆë©´ 1ë¹„íŠ¸ ê¸°ë³¸)</p>
  </li>
  <li>
    <p>ë³¸ë¬¸ <code class="language-plaintext highlighter-rouge">Decl(Input/Output/Inout)</code> ìŠ¤ìº”í•´ì„œ <strong>io_map</strong> ìƒì„±</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">apply_nonansi_overrides(..., prefer_body=True)</code>ë¡œ</p>

    <ul>
      <li>
        <p><strong>non-ANSIì—ì„œ ì°¾ì€ ë°©í–¥/í­/ì„œëª…</strong> ì„ <strong>í•­ìƒ ë®ì–´ì“°ê¸°</strong></p>
      </li>
      <li>
        <p>ê²°ê³¼ì ìœ¼ë¡œ â€œí—¤ë”ê°€ ë¹„ì–´ ìˆê³  ë³¸ë¬¸ì—ë§Œ ë°©í–¥ì´ ìˆëŠ”â€ ê²½ìš°ë„ ì •í™•íˆ ì±„ì›Œì§</p>
      </li>
    </ul>
  </li>
</ol>

<p>ì›í•˜ë©´ <code class="language-plaintext highlighter-rouge">prefer_body=False</code>ë¡œ ë°”ê¿” â€œí—¤ë” ìš°ì„ , ë¹ˆ ê°’ë§Œ ë³´ì¶©â€ ì •ì±…ë„ ì‰½ê²Œ ì „í™˜ ê°€ëŠ¥í•´.<br />
í•„ìš” ì‹œ í¬íŠ¸ì— <code class="language-plaintext highlighter-rouge">source="ansi|body"</code> ê°™ì€ í•„ë“œ ì¶”ê°€í•´ì„œ ìµœì¢… ê°’ì˜ ì¶œì²˜ë¥¼ íŠ¸ë˜í‚¹í•˜ëŠ” ê²ƒë„ ì¶”ì²œ!</p>]]></content><author><name>hvppyarchive</name></author><category term="verilog" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">í…ìŠ¤íŠ¸ ë¶„í•  ë³µì‚¬</title><link href="https://hvppyarchive.github.io/misc/text-split-copy/" rel="alternate" type="text/html" title="í…ìŠ¤íŠ¸ ë¶„í•  ë³µì‚¬" /><published>2025-08-20T13:38:16+09:00</published><updated>2025-08-20T13:38:16+09:00</updated><id>https://hvppyarchive.github.io/misc/text-split-copy</id><content type="html" xml:base="https://hvppyarchive.github.io/misc/text-split-copy/"><![CDATA[<p class="chat--user">

ì–´ë–¤ ê¸´ í…ìŠ¤íŠ¸ê°€ ì…ë ¥ë˜ì—ˆì„ ë•Œ ê·¸ê±¸ íŠ¹ì • character ìˆ˜ ë‹¨ìœ„ë¡œ ìª¼ê°œì„œ ë³µì‚¬í•  ìˆ˜ ìˆê²Œ í•´ì¤„ ìˆ˜ ìˆì–´?

</p>

<p>ì¢‹ì£ ! â€œì›í•˜ëŠ” ê¸€ì ìˆ˜ë¡œ ì˜ë¼ì„œ ë³µì‚¬â€í•  ìˆ˜ ìˆëŠ” ì´ˆê°„ë‹¨ ì›¹í˜ì´ì§€ë¥¼ ë°”ë¡œ ë“œë¦´ê²Œìš”. ì•„ë˜ ì½”ë“œë¥¼ <code class="language-plaintext highlighter-rouge">splitter.html</code>ë¡œ ì €ì¥í•´ì„œ ë¸Œë¼ìš°ì €ë¡œ ì—´ë©´ ë©ë‹ˆë‹¤.</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"ko"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;title&gt;</span>í…ìŠ¤íŠ¸ ë¶„í•  <span class="err">&amp;</span> ë³µì‚¬<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;style&gt;</span>
  <span class="nt">body</span> <span class="p">{</span> <span class="nl">font-family</span><span class="p">:</span> <span class="n">system-ui</span><span class="p">,</span> <span class="o">-</span><span class="n">apple-system</span><span class="p">,</span> <span class="s1">"Segoe UI"</span><span class="p">,</span> <span class="n">Roboto</span><span class="p">,</span> <span class="s1">"Noto Sans KR"</span><span class="p">,</span> <span class="n">Arial</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span> <span class="nl">margin</span><span class="p">:</span> <span class="m">24px</span><span class="p">;</span> <span class="p">}</span>
  <span class="nt">h1</span> <span class="p">{</span> <span class="nl">font-size</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span> <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">16px</span><span class="p">;</span> <span class="p">}</span>
  <span class="nt">textarea</span> <span class="p">{</span> <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span> <span class="nl">min-height</span><span class="p">:</span> <span class="m">180px</span><span class="p">;</span> <span class="nl">box-sizing</span><span class="p">:</span> <span class="nb">border-box</span><span class="p">;</span> <span class="nl">padding</span><span class="p">:</span> <span class="m">12px</span><span class="p">;</span> <span class="p">}</span>
  <span class="nc">.row</span> <span class="p">{</span> <span class="nl">display</span><span class="p">:</span> <span class="nb">flex</span><span class="p">;</span> <span class="nl">gap</span><span class="p">:</span> <span class="m">12px</span><span class="p">;</span> <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span> <span class="nl">margin</span><span class="p">:</span> <span class="m">12px</span> <span class="m">0</span><span class="p">;</span> <span class="nl">flex-wrap</span><span class="p">:</span> <span class="nb">wrap</span><span class="p">;</span> <span class="p">}</span>
  <span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="s1">"number"</span><span class="o">]</span> <span class="p">{</span> <span class="nl">width</span><span class="p">:</span> <span class="m">120px</span><span class="p">;</span> <span class="nl">padding</span><span class="p">:</span> <span class="m">8px</span><span class="p">;</span> <span class="p">}</span>
  <span class="nt">button</span> <span class="p">{</span> <span class="nl">padding</span><span class="p">:</span> <span class="m">8px</span> <span class="m">12px</span><span class="p">;</span> <span class="nl">cursor</span><span class="p">:</span> <span class="nb">pointer</span><span class="p">;</span> <span class="p">}</span>
  <span class="nc">.stats</span> <span class="p">{</span> <span class="nl">margin</span><span class="p">:</span> <span class="m">8px</span> <span class="m">0</span> <span class="m">16px</span><span class="p">;</span> <span class="nl">color</span><span class="p">:</span> <span class="nx">#333</span><span class="p">;</span> <span class="p">}</span>
  <span class="nc">.chunk</span> <span class="p">{</span> <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="nx">#ddd</span><span class="p">;</span> <span class="nl">padding</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span> <span class="nl">margin</span><span class="p">:</span> <span class="m">12px</span> <span class="m">0</span><span class="p">;</span> <span class="nl">border-radius</span><span class="p">:</span> <span class="m">8px</span><span class="p">;</span> <span class="nl">background</span><span class="p">:</span> <span class="nx">#fafafa</span><span class="p">;</span> <span class="p">}</span>
  <span class="nc">.chunk</span> <span class="nt">header</span> <span class="p">{</span> <span class="nl">display</span><span class="p">:</span> <span class="nb">flex</span><span class="p">;</span> <span class="nl">justify-content</span><span class="p">:</span> <span class="nb">space-between</span><span class="p">;</span> <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span> <span class="nl">margin-bottom</span><span class="p">:</span> <span class="m">8px</span><span class="p">;</span> <span class="p">}</span>
  <span class="nc">.chunk</span> <span class="nt">pre</span> <span class="p">{</span> <span class="nl">white-space</span><span class="p">:</span> <span class="nb">pre-wrap</span><span class="p">;</span> <span class="nl">word-break</span><span class="p">:</span> <span class="n">break-word</span><span class="p">;</span> <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span> <span class="p">}</span>
  <span class="nc">.muted</span> <span class="p">{</span> <span class="nl">color</span><span class="p">:</span> <span class="nx">#666</span><span class="p">;</span> <span class="nl">font-size</span><span class="p">:</span> <span class="m">12px</span><span class="p">;</span> <span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;h1&gt;</span>í…ìŠ¤íŠ¸ ë¶„í•  <span class="err">&amp;</span> ë³µì‚¬<span class="nt">&lt;/h1&gt;</span>

  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"input"</span><span class="nt">&gt;</span>ì›ë³¸ í…ìŠ¤íŠ¸<span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;textarea</span> <span class="na">id=</span><span class="s">"input"</span> <span class="na">placeholder=</span><span class="s">"ì—¬ê¸°ì— ê¸´ í…ìŠ¤íŠ¸ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”"</span><span class="nt">&gt;&lt;/textarea&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"size"</span><span class="nt">&gt;</span>ì¡°ê° ê¸€ì ìˆ˜<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"size"</span> <span class="na">type=</span><span class="s">"number"</span> <span class="na">min=</span><span class="s">"1"</span> <span class="na">step=</span><span class="s">"1"</span> <span class="na">value=</span><span class="s">"500"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"splitBtn"</span><span class="nt">&gt;</span>ë¶„í• í•˜ê¸°<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"copyAllBtn"</span> <span class="na">title=</span><span class="s">"ëª¨ë“  ì¡°ê°ì„ ì´ì–´ë¶™ì—¬ì„œ ë³µì‚¬"</span><span class="nt">&gt;</span>ëª¨ë‘ ë³µì‚¬<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"muted"</span><span class="nt">&gt;</span>
    * í•œêµ­ì–´/ì´ëª¨ì§€ ë“± ë¬¶ìŒ ë¬¸ìê°€ ê¹¨ì§€ì§€ ì•Šë„ë¡ <span class="nt">&lt;code&gt;</span>Intl.Segmenter<span class="nt">&lt;/code&gt;</span>ë¥¼ ì´ìš©í•´ â€œë¬¸ì(ê·¸ë˜í”„ë¦¼)â€ ë‹¨ìœ„ë¡œ ìë¦…ë‹ˆë‹¤.
    (ë§¤ìš° ì˜¤ë˜ëœ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ì¼ë°˜ ë¬¸ì ê¸¸ì´ë¡œ ëŒ€ì²´)
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"stats"</span> <span class="na">class=</span><span class="s">"stats"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"chunks"</span><span class="nt">&gt;&lt;/div&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="kd">const</span> <span class="nx">$</span> <span class="o">=</span> <span class="p">(</span><span class="nx">sel</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="nx">sel</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">$$</span> <span class="o">=</span> <span class="p">(</span><span class="nx">sel</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nf">querySelectorAll</span><span class="p">(</span><span class="nx">sel</span><span class="p">));</span>
  <span class="kd">const</span> <span class="nx">input</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#input</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">sizeEl</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#size</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">splitBtn</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#splitBtn</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">copyAllBtn</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#copyAllBtn</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">stats</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#stats</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#chunks</span><span class="dl">'</span><span class="p">);</span>

  <span class="c1">// ì•ˆì „í•œ "ë¬¸ì(ê·¸ë˜í”„ë¦¼)" ë‹¨ìœ„ ë¶„í• ì„ ìœ„í•œ ì„¸ê·¸ë©˜í„°</span>
  <span class="kd">function</span> <span class="nf">getGraphemes</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="dl">'</span><span class="s1">Segmenter</span><span class="dl">'</span> <span class="k">in</span> <span class="nx">Intl</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">seg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Intl</span><span class="p">.</span><span class="nc">Segmenter</span><span class="p">(</span><span class="dl">'</span><span class="s1">ko</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">granularity</span><span class="p">:</span> <span class="dl">'</span><span class="s1">grapheme</span><span class="dl">'</span> <span class="p">});</span>
        <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">seg</span><span class="p">.</span><span class="nf">segment</span><span class="p">(</span><span class="nx">str</span><span class="p">),</span> <span class="nx">s</span> <span class="o">=&gt;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">segment</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* fallback below */</span> <span class="p">}</span>
    <span class="c1">// Fallback: code unit ê¸°ì¤€ (ì´ëª¨ì§€ ê²°í•©ë¬¸ìì— ì™„ë²½í•˜ì§„ ì•Šì§€ë§Œ ë™ì‘ì€ í•¨)</span>
    <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nf">chunkArray</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">out</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="nx">n</span><span class="p">)</span> <span class="nx">out</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nf">slice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">n</span><span class="p">).</span><span class="nf">join</span><span class="p">(</span><span class="dl">''</span><span class="p">));</span>
    <span class="k">return</span> <span class="nx">out</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="kd">function</span> <span class="nf">copyText</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">clipboard</span><span class="p">.</span><span class="nf">writeText</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Fallback: ì„ì‹œ í…ìŠ¤íŠ¸ì˜ì—­ ì´ìš©</span>
      <span class="kd">const</span> <span class="nx">ta</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">textarea</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">ta</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">text</span><span class="p">;</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">ta</span><span class="p">);</span>
      <span class="nx">ta</span><span class="p">.</span><span class="nf">select</span><span class="p">();</span>
      <span class="k">try</span> <span class="p">{</span> <span class="nb">document</span><span class="p">.</span><span class="nf">execCommand</span><span class="p">(</span><span class="dl">'</span><span class="s1">copy</span><span class="dl">'</span><span class="p">);</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nf">removeChild</span><span class="p">(</span><span class="nx">ta</span><span class="p">);</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span> <span class="p">}</span>
      <span class="k">catch </span><span class="p">(</span><span class="nx">e2</span><span class="p">)</span> <span class="p">{</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nf">removeChild</span><span class="p">(</span><span class="nx">ta</span><span class="p">);</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nf">renderChunks</span><span class="p">(</span><span class="nx">chunks</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">container</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
    <span class="nx">chunks</span><span class="p">.</span><span class="nf">forEach</span><span class="p">((</span><span class="nx">text</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">div</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">chunk</span><span class="dl">'</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">header</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">header</span><span class="dl">'</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">strong</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">title</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s2">`ì¡°ê° </span><span class="p">${</span><span class="nx">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span><span class="s2"> / </span><span class="p">${</span><span class="nx">chunks</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2">  (</span><span class="p">${</span><span class="nx">text</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2">ì)`</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">button</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">btn</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">ì´ ì¡°ê° ë³µì‚¬</span><span class="dl">'</span><span class="p">;</span>
      <span class="nx">btn</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">ok</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">copyText</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
        <span class="nx">btn</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">ok</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">ë³µì‚¬ë¨!</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">ë³µì‚¬ ì‹¤íŒ¨</span><span class="dl">'</span><span class="p">;</span>
        <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">btn</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">ì´ ì¡°ê° ë³µì‚¬</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1200</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">header</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">title</span><span class="p">);</span>
      <span class="nx">header</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">btn</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">pre</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">pre</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">pre</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">text</span><span class="p">;</span>
      <span class="nx">div</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">header</span><span class="p">);</span>
      <span class="nx">div</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">pre</span><span class="p">);</span>
      <span class="nx">container</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nf">splitNow</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">raw</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">value</span> <span class="o">??</span> <span class="dl">''</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">size</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">sizeEl</span><span class="p">.</span><span class="nx">value</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">grams</span> <span class="o">=</span> <span class="nf">getGraphemes</span><span class="p">(</span><span class="nx">raw</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">chunks</span> <span class="o">=</span> <span class="nf">chunkArray</span><span class="p">(</span><span class="nx">grams</span><span class="p">,</span> <span class="nx">size</span><span class="p">);</span>
    <span class="nf">renderChunks</span><span class="p">(</span><span class="nx">chunks</span><span class="p">);</span>
    <span class="nx">stats</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s2">`ì „ì²´ ê¸¸ì´: </span><span class="p">${</span><span class="nx">grams</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2">ì Â· ì¡°ê° ê°œìˆ˜: </span><span class="p">${</span><span class="nx">chunks</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> Â· ì¡°ê°ë‹¹ ìµœëŒ€ </span><span class="p">${</span><span class="nx">size</span><span class="p">}</span><span class="s2">ì`</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">splitBtn</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">splitNow</span><span class="p">);</span>

  <span class="nx">copyAllBtn</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">pieces</span> <span class="o">=</span> <span class="nx">$</span><span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.chunk pre</span><span class="dl">'</span><span class="p">).</span><span class="nf">map</span><span class="p">(</span><span class="nx">p</span> <span class="o">=&gt;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">textContent</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">joined</span> <span class="o">=</span> <span class="nx">pieces</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">ok</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">copyText</span><span class="p">(</span><span class="nx">joined</span><span class="p">);</span>
    <span class="nx">copyAllBtn</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">ok</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">ëª¨ë‘ ë³µì‚¬ë¨!</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">ë³µì‚¬ ì‹¤íŒ¨</span><span class="dl">'</span><span class="p">;</span>
    <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">copyAllBtn</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">ëª¨ë‘ ë³µì‚¬</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1200</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">})();</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h3 id="ì‚¬ìš©-ë°©ë²•-step-by-step">ì‚¬ìš© ë°©ë²• (step-by-step)</h3>

<ol>
  <li>
    <p>ìœ„ ì½”ë“œë¥¼ <code class="language-plaintext highlighter-rouge">splitter.html</code>ë¡œ ì €ì¥í•˜ê³  ë”ë¸”í´ë¦­í•´ ë¸Œë¼ìš°ì €ì—ì„œ ì—½ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ê¸´ í…ìŠ¤íŠ¸ë¥¼ ìƒë‹¨ ì…ë ¥ì°½ì— ë¶™ì—¬ë„£ìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>â€œì¡°ê° ê¸€ì ìˆ˜â€ì— ì›í•˜ëŠ” ìˆ«ì(ì˜ˆ: 500)ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>â€œë¶„í• í•˜ê¸°â€ë¥¼ ëˆ„ë¥´ë©´ ì•„ë˜ì— ì¡°ê°ë“¤ì´ ìƒì„±ë©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ê° ì¡°ê°ì˜ â€œì´ ì¡°ê° ë³µì‚¬â€ ë²„íŠ¼ìœ¼ë¡œ ê°œë³„ ë³µì‚¬í•˜ê±°ë‚˜, â€œëª¨ë‘ ë³µì‚¬â€ë¡œ ë‹¤ì‹œ ì´ì–´ë¶™ì¸ ì „ì²´ë¥¼ ë³µì‚¬í•  ìˆ˜ ìˆì–´ìš”.</p>
  </li>
</ol>

<h3 id="ì°¸ê³ ">ì°¸ê³ </h3>

<ul>
  <li>
    <p>ê¸°ë³¸ì ìœ¼ë¡œ í•œêµ­ì–´, ì´ëª¨ì§€ ë“± ê²°í•© ë¬¸ìë¥¼ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•˜ë„ë¡ â€œë¬¸ì(ê·¸ë˜í”„ë¦¼)â€ ë‹¨ìœ„ë¡œ ìë¦…ë‹ˆë‹¤. ì•„ì£¼ ì˜¤ë˜ëœ ë¸Œë¼ìš°ì €ì—ì„  ì¼ë°˜ ë¬¸ì ê¸¸ì´(<code class="language-plaintext highlighter-rouge">.length</code>)ë¡œ ë™ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>í•„ìš”í•˜ë©´ â€œì¡°ê°ë‹¹ Nìâ€ ì™¸ì—ë„ â€œê²¹ì¹¨(ì˜¤ë²„ë©)â€, â€œë¬¸ë‹¨ ë‹¨ìœ„ë¡œ ìë¥´ë˜ ìµœëŒ€ Nìâ€ ê°™ì€ ì˜µì…˜ë„ ë¶™ì—¬ë“œë¦´ ìˆ˜ ìˆì–´ìš”. ì›í•˜ëŠ” ê·œì¹™ì´ ìˆìœ¼ë©´ ì•Œë ¤ì£¼ì„¸ìš”!</p>
  </li>
</ul>

<p class="chat--user">

ì¢‹ì•„ ì˜ ì‘ë™í•´. ì „ì²´ì ì¸ êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ë˜ ë‘ ê°€ì§€ ê°œì„ í•´ì•¼í•  ì‚¬í•­ì´ ìˆì–´. 1. ë²„íŠ¼ì´ â€œë³µì‚¬ë¨!â€ìœ¼ë¡œ ë°”ë€ ë’¤ ë‹¤ì‹œ ì¼ì • ì‹œê°„ í›„ â€œì´ ì¡°ê° ë³µì‚¬â€ ë²„íŠ¼ìœ¼ë¡œ ëŒì•„ê°€ëŠ”ë°, ë‚´ê°€ ì–´ë””ê¹Œì§€ ë³µì‚¬í–ˆëŠ”ì§€ í—·ê°ˆë ¤. ë‚´ê°€ 1ë²ˆì´ë¼ë„ ëˆ„ë¥¸ ê²ƒì€ ë²„íŠ¼ ìƒ‰ì„ ë°”ê¾¸ê±°ë‚˜ í•´ì„œ ë‚´ê°€ ì–´ë””ê¹Œì§€ í–ˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆìœ¼ë©´ ì¢‹ê² ì–´. 2. ê° ì¡°ê°ì„ 8000ì ì •ë„ë¡œ í•˜ê³  ìˆëŠ”ë° ìŠ¤í¬ë¡¤ ë‚´ë ¤ì•¼í•  ê²Œ ë„ˆë¬´ ê¸¸ì–´. ê° ë¯¸ë¦¬ë³´ê¸° ë¸”ëŸ­ì„ ì ‘ì–´ë‘ê³  ë‚´ê°€ ì›í• ë•Œë§Œ í´ë„ ì¢‹ì„ ê±° ê°™ì•„. ë‘ ê°€ì§€ëŠ” ë‚´ê°€ ìƒê°í•˜ëŠ” ë°©í–¥ì¸ë° ë„ˆí•œí…Œ ë” ì¢‹ì€ ì•„ì´ë””ì–´ê°€ ìˆë‹¤ë©´ ë°˜ì˜í•´ì¤˜.

</p>

<p>ì¢‹ì•„ìš”! ë§ì”€í•´ì£¼ì‹  ë‘ ê°€ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ, êµ¬ì¡°ëŠ” ìœ ì§€í•˜ë©´ì„œ ì´ë ‡ê²Œ ê°œì„ í–ˆì–´ìš”.</p>

<ul>
  <li>
    <p>#1 â€œë‚´ê°€ ë³µì‚¬í•œ ì¡°ê°ì„ í•œëˆˆì—â€: ì–´ë–¤ ì¡°ê°ì´ë“  <strong>í•œ ë²ˆì´ë¼ë„ ë³µì‚¬ì— ì„±ê³µí•˜ë©´</strong> ê·¸ ì¹´ë“œê°€ <strong>ì˜êµ¬ í‘œì‹œ(ì„¸ì…˜ ë‚´)</strong> ë©ë‹ˆë‹¤.</p>

    <ul>
      <li>
        <p>ìƒë‹¨ ìš”ì•½ì¤„ì— âœ… ë°°ì§€ê°€ ë¶™ê³ , ì¹´ë“œ í…Œë‘ë¦¬ê°€ ê°•ì¡°ë©ë‹ˆë‹¤(ì´ˆë¡ìƒ‰).</p>
      </li>
      <li>
        <p>ë²„íŠ¼ ë¬¸êµ¬ëŠ” ì˜ˆì „ì²˜ëŸ¼ ì ê¹ â€œë³µì‚¬ë¨!â€ìœ¼ë¡œ ë°”ë€Œì§€ë§Œ, <strong>ë°°ì§€ëŠ” ê·¸ëŒ€ë¡œ</strong> ë‚¨ì•„ â€œì–´ë””ê¹Œì§€ í–ˆëŠ”ì§€â€ í—·ê°ˆë¦¬ì§€ ì•Šê²Œ í•´ìš”.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>#2 â€œìŠ¤í¬ë¡¤ ì§€ì˜¥ í•´ë°©â€: ê° ì¡°ê°ì„ <strong>ì ‘ì„ ìˆ˜ ìˆëŠ” ë¯¸ë¦¬ë³´ê¸°(accordion)</strong> ë¡œ ë°”ê¿¨ìŠµë‹ˆë‹¤.</p>

    <ul>
      <li>
        <p>ê¸°ë³¸ì€ ì ‘í˜ ìƒíƒœë¡œ ë Œë”ë§ë˜ê³ , ìš”ì•½ì¤„ì—” <strong>ì¡°ê° ë²ˆí˜¸/ì´ê°œìˆ˜, ê¸¸ì´, ì•ë¶€ë¶„ ë¯¸ë¦¬ë³´ê¸°</strong> ê°€ ë³´ì—¬ìš”.</p>
      </li>
      <li>
        <p>ìƒë‹¨ì— â€œ<strong>ëª¨ë‘ í¼ì¹˜ê¸° / ëª¨ë‘ ì ‘ê¸°</strong> â€ í† ê¸€ë„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.</p>
      </li>
    </ul>
  </li>
</ul>

<p>ê±°ê¸°ì— ì œì•ˆ í•˜ë‚˜ ë”!</p>

<ul>
  <li><strong>â€œë‹¤ìŒ ì¡°ê° ì—´ê¸°â€</strong> : ì–´ë–¤ ì¡°ê°ì—ì„œ ë³µì‚¬ ì„±ê³µí•˜ë©´, <strong>ë‹¤ìŒ ì¡°ê°ì„ ìë™ìœ¼ë¡œ í¼ì³</strong> ì‘ì—… íë¦„ì´ ë§¤ë„ëŸ½ìŠµë‹ˆë‹¤(ì„ íƒ ê°€ëŠ¥ í† ê¸€).</li>
</ul>

<p>ì•„ë˜ ì „ì²´ ì½”ë“œë§Œ <code class="language-plaintext highlighter-rouge">splitter.html</code>ë¡œ ì €ì¥í•´ ì—´ë©´ ë°”ë¡œ ë©ë‹ˆë‹¤.</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"ko"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;title&gt;</span>í…ìŠ¤íŠ¸ ë¶„í•  <span class="err">&amp;</span> ë³µì‚¬ (ê°œì„ íŒ)<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;style&gt;</span>
  <span class="nd">:root</span> <span class="p">{</span>
    <span class="py">--accent</span><span class="p">:</span> <span class="nx">#2e7d32</span><span class="p">;</span> <span class="c">/* ë³µì‚¬ ì™„ë£Œ ê°•ì¡°ìƒ‰ */</span>
    <span class="py">--muted</span><span class="p">:</span> <span class="nx">#666</span><span class="p">;</span>
    <span class="py">--border</span><span class="p">:</span> <span class="nx">#ddd</span><span class="p">;</span>
    <span class="py">--bg</span><span class="p">:</span> <span class="nx">#fafafa</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nt">body</span> <span class="p">{</span> <span class="nl">font-family</span><span class="p">:</span> <span class="n">system-ui</span><span class="p">,</span> <span class="o">-</span><span class="n">apple-system</span><span class="p">,</span> <span class="s1">"Segoe UI"</span><span class="p">,</span> <span class="n">Roboto</span><span class="p">,</span> <span class="s1">"Noto Sans KR"</span><span class="p">,</span> <span class="n">Arial</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span> <span class="nl">margin</span><span class="p">:</span> <span class="m">24px</span><span class="p">;</span> <span class="p">}</span>
  <span class="nt">h1</span> <span class="p">{</span> <span class="nl">font-size</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span> <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">16px</span><span class="p">;</span> <span class="p">}</span>
  <span class="nt">textarea</span> <span class="p">{</span> <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span> <span class="nl">min-height</span><span class="p">:</span> <span class="m">180px</span><span class="p">;</span> <span class="nl">box-sizing</span><span class="p">:</span> <span class="nb">border-box</span><span class="p">;</span> <span class="nl">padding</span><span class="p">:</span> <span class="m">12px</span><span class="p">;</span> <span class="p">}</span>
  <span class="nc">.row</span> <span class="p">{</span> <span class="nl">display</span><span class="p">:</span> <span class="nb">flex</span><span class="p">;</span> <span class="nl">gap</span><span class="p">:</span> <span class="m">12px</span><span class="p">;</span> <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span> <span class="nl">margin</span><span class="p">:</span> <span class="m">12px</span> <span class="m">0</span><span class="p">;</span> <span class="nl">flex-wrap</span><span class="p">:</span> <span class="nb">wrap</span><span class="p">;</span> <span class="p">}</span>
  <span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="s1">"number"</span><span class="o">]</span> <span class="p">{</span> <span class="nl">width</span><span class="p">:</span> <span class="m">120px</span><span class="p">;</span> <span class="nl">padding</span><span class="p">:</span> <span class="m">8px</span><span class="p">;</span> <span class="p">}</span>
  <span class="nt">button</span> <span class="p">{</span> <span class="nl">padding</span><span class="p">:</span> <span class="m">8px</span> <span class="m">12px</span><span class="p">;</span> <span class="nl">cursor</span><span class="p">:</span> <span class="nb">pointer</span><span class="p">;</span> <span class="p">}</span>
  <span class="nc">.stats</span> <span class="p">{</span> <span class="nl">margin</span><span class="p">:</span> <span class="m">8px</span> <span class="m">0</span> <span class="m">16px</span><span class="p">;</span> <span class="nl">color</span><span class="p">:</span> <span class="nx">#333</span><span class="p">;</span> <span class="p">}</span>
  <span class="nc">.muted</span> <span class="p">{</span> <span class="nl">color</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="l">--muted</span><span class="p">);</span> <span class="nl">font-size</span><span class="p">:</span> <span class="m">12px</span><span class="p">;</span> <span class="p">}</span>

  <span class="c">/* ì¡°ê°(ì ‘í˜ ì¹´ë“œ) */</span>
  <span class="nt">details</span><span class="nc">.chunk</span> <span class="p">{</span>
    <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="nf">var</span><span class="p">(</span><span class="l">--border</span><span class="p">);</span>
    <span class="nl">border-radius</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
    <span class="nl">background</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="l">--bg</span><span class="p">);</span>
    <span class="nl">margin</span><span class="p">:</span> <span class="m">12px</span> <span class="m">0</span><span class="p">;</span>
    <span class="nl">transition</span><span class="p">:</span> <span class="n">border-color</span> <span class="m">.2s</span><span class="p">,</span> <span class="n">box-shadow</span> <span class="m">.2s</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nt">details</span><span class="nc">.chunk</span><span class="o">[</span><span class="nt">open</span><span class="o">]</span> <span class="p">{</span>
    <span class="nl">box-shadow</span><span class="p">:</span> <span class="m">0</span> <span class="m">1px</span> <span class="m">10px</span> <span class="nf">rgba</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.04</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nt">details</span><span class="nc">.chunk.copied-once</span> <span class="p">{</span>
    <span class="nl">border-color</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="l">--accent</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c">/* ìš”ì•½ì¤„ */</span>
  <span class="nt">summary</span> <span class="p">{</span>
    <span class="nl">list-style</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
    <span class="nl">display</span><span class="p">:</span> <span class="nb">flex</span><span class="p">;</span>
    <span class="nl">gap</span><span class="p">:</span> <span class="m">8px</span><span class="p">;</span>
    <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
    <span class="nl">padding</span><span class="p">:</span> <span class="m">10px</span> <span class="m">12px</span><span class="p">;</span>
    <span class="nl">cursor</span><span class="p">:</span> <span class="nb">pointer</span><span class="p">;</span>
    <span class="py">user-select</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nt">summary</span><span class="nd">::-webkit-details-marker</span> <span class="p">{</span> <span class="nl">display</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span> <span class="p">}</span>
  <span class="nc">.summary-left</span> <span class="p">{</span> <span class="nl">display</span><span class="p">:</span> <span class="nb">flex</span><span class="p">;</span> <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span> <span class="nl">gap</span><span class="p">:</span> <span class="m">8px</span><span class="p">;</span> <span class="nl">flex</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span> <span class="p">}</span>
  <span class="nc">.badge</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">11px</span><span class="p">;</span>
    <span class="nl">padding</span><span class="p">:</span> <span class="m">2px</span> <span class="m">6px</span><span class="p">;</span>
    <span class="nl">border-radius</span><span class="p">:</span> <span class="m">999px</span><span class="p">;</span>
    <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="nf">var</span><span class="p">(</span><span class="l">--border</span><span class="p">);</span>
    <span class="nl">color</span><span class="p">:</span> <span class="nx">#333</span><span class="p">;</span>
    <span class="nl">background</span><span class="p">:</span> <span class="nx">#fff</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nc">.badge.ok</span> <span class="p">{</span>
    <span class="nl">border-color</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="l">--accent</span><span class="p">);</span>
    <span class="nl">color</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="l">--accent</span><span class="p">);</span>
    <span class="nl">font-weight</span><span class="p">:</span> <span class="m">600</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nc">.snippet</span> <span class="p">{</span>
    <span class="nl">color</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="l">--muted</span><span class="p">);</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">12px</span><span class="p">;</span>
    <span class="nl">overflow</span><span class="p">:</span> <span class="nb">hidden</span><span class="p">;</span>
    <span class="nl">text-overflow</span><span class="p">:</span> <span class="n">ellipsis</span><span class="p">;</span>
    <span class="nl">white-space</span><span class="p">:</span> <span class="nb">nowrap</span><span class="p">;</span>
    <span class="nl">max-width</span><span class="p">:</span> <span class="m">40ch</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c">/* ë³¸ë¬¸ */</span>
  <span class="nc">.chunk-body</span> <span class="p">{</span> <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span> <span class="m">12px</span> <span class="m">12px</span> <span class="m">12px</span><span class="p">;</span> <span class="p">}</span>
  <span class="nc">.actions</span> <span class="p">{</span> <span class="nl">display</span><span class="p">:</span> <span class="nb">flex</span><span class="p">;</span> <span class="nl">gap</span><span class="p">:</span> <span class="m">8px</span><span class="p">;</span> <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span> <span class="nl">margin</span><span class="p">:</span> <span class="m">8px</span> <span class="m">0</span><span class="p">;</span> <span class="nl">flex-wrap</span><span class="p">:</span> <span class="nb">wrap</span><span class="p">;</span> <span class="p">}</span>
  <span class="nc">.chunk</span> <span class="nt">pre</span> <span class="p">{</span> <span class="nl">white-space</span><span class="p">:</span> <span class="nb">pre-wrap</span><span class="p">;</span> <span class="nl">word-break</span><span class="p">:</span> <span class="n">break-word</span><span class="p">;</span> <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span> <span class="nl">padding</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span> <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="nf">var</span><span class="p">(</span><span class="l">--border</span><span class="p">);</span> <span class="nl">border-radius</span><span class="p">:</span> <span class="m">8px</span><span class="p">;</span> <span class="nl">background</span><span class="p">:</span> <span class="nx">#fff</span><span class="p">;</span> <span class="nl">max-height</span><span class="p">:</span> <span class="m">40vh</span><span class="p">;</span> <span class="nl">overflow</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span> <span class="p">}</span>

  <span class="c">/* ìƒë‹¨ ì»¨íŠ¸ë¡¤ */</span>
  <span class="nc">.toolbar</span> <span class="p">{</span> <span class="nl">display</span><span class="p">:</span> <span class="nb">flex</span><span class="p">;</span> <span class="nl">gap</span><span class="p">:</span> <span class="m">8px</span><span class="p">;</span> <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span> <span class="nl">flex-wrap</span><span class="p">:</span> <span class="nb">wrap</span><span class="p">;</span> <span class="nl">margin</span><span class="p">:</span> <span class="m">8px</span> <span class="m">0</span><span class="p">;</span> <span class="p">}</span>
  <span class="nc">.toolbar</span> <span class="nc">.spacer</span> <span class="p">{</span> <span class="nl">flex</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span> <span class="p">}</span>

  <span class="c">/* ì‘ì€ í† ê¸€ ìŠ¤ìœ„ì¹˜ */</span>
  <span class="nc">.toggle</span> <span class="p">{</span>
    <span class="nl">display</span><span class="p">:</span> <span class="nb">inline-flex</span><span class="p">;</span> <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span> <span class="nl">gap</span><span class="p">:</span> <span class="m">6px</span><span class="p">;</span> <span class="nl">font-size</span><span class="p">:</span> <span class="m">12px</span><span class="p">;</span> <span class="nl">color</span><span class="p">:</span> <span class="nx">#333</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nc">.toggle</span> <span class="nt">input</span> <span class="p">{</span> <span class="nl">width</span><span class="p">:</span> <span class="m">1.1rem</span><span class="p">;</span> <span class="nl">height</span><span class="p">:</span> <span class="m">1.1rem</span><span class="p">;</span> <span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;h1&gt;</span>í…ìŠ¤íŠ¸ ë¶„í•  <span class="err">&amp;</span> ë³µì‚¬<span class="nt">&lt;/h1&gt;</span>

  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"input"</span><span class="nt">&gt;</span>ì›ë³¸ í…ìŠ¤íŠ¸<span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;textarea</span> <span class="na">id=</span><span class="s">"input"</span> <span class="na">placeholder=</span><span class="s">"ì—¬ê¸°ì— ê¸´ í…ìŠ¤íŠ¸ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”"</span><span class="nt">&gt;&lt;/textarea&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"size"</span><span class="nt">&gt;</span>ì¡°ê° ê¸€ì ìˆ˜<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"size"</span> <span class="na">type=</span><span class="s">"number"</span> <span class="na">min=</span><span class="s">"1"</span> <span class="na">step=</span><span class="s">"1"</span> <span class="na">value=</span><span class="s">"8000"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"splitBtn"</span><span class="nt">&gt;</span>ë¶„í• í•˜ê¸°<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"copyAllBtn"</span> <span class="na">title=</span><span class="s">"ëª¨ë“  ì¡°ê°ì„ ì´ì–´ë¶™ì—¬ì„œ ë³µì‚¬"</span><span class="nt">&gt;</span>ëª¨ë‘ ë³µì‚¬<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"toolbar"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"expandAllBtn"</span><span class="nt">&gt;</span>ëª¨ë‘ í¼ì¹˜ê¸°<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"collapseAllBtn"</span><span class="nt">&gt;</span>ëª¨ë‘ ì ‘ê¸°<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"spacer"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"toggle"</span> <span class="na">title=</span><span class="s">"ë³µì‚¬ ì„±ê³µ ì‹œ ìë™ìœ¼ë¡œ ë‹¤ìŒ ì¡°ê°ì„ ì—´ì–´ ì‘ì—… íë¦„ì„ ë¹ ë¥´ê²Œ í•©ë‹ˆë‹¤."</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"autoOpenNext"</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">checked</span> <span class="nt">/&gt;</span>
      ë³µì‚¬ í›„ ë‹¤ìŒ ì¡°ê° ìë™ ì—´ê¸°
    <span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"muted"</span><span class="nt">&gt;</span>
    * í•œêµ­ì–´/ì´ëª¨ì§€ ë“± ê²°í•© ë¬¸ìê°€ ê¹¨ì§€ì§€ ì•Šë„ë¡ <span class="nt">&lt;code&gt;</span>Intl.Segmenter<span class="nt">&lt;/code&gt;</span>ë¡œ â€œë¬¸ì(ê·¸ë˜í”„ë¦¼)â€ ë‹¨ìœ„ë¡œ ìë¦…ë‹ˆë‹¤. (ì˜¤ë˜ëœ ë¸Œë¼ìš°ì €ëŠ” ì¼ë°˜ ê¸¸ì´ë¡œ ëŒ€ì²´)
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"stats"</span> <span class="na">class=</span><span class="s">"stats"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"chunks"</span><span class="nt">&gt;&lt;/div&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="kd">const</span> <span class="nx">$</span> <span class="o">=</span> <span class="p">(</span><span class="nx">sel</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="nx">sel</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">$$</span> <span class="o">=</span> <span class="p">(</span><span class="nx">sel</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nf">querySelectorAll</span><span class="p">(</span><span class="nx">sel</span><span class="p">));</span>
  <span class="kd">const</span> <span class="nx">input</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#input</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">sizeEl</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#size</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">splitBtn</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#splitBtn</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">copyAllBtn</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#copyAllBtn</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">stats</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#stats</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#chunks</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">expandAllBtn</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#expandAllBtn</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">collapseAllBtn</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#collapseAllBtn</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">autoOpenNextEl</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#autoOpenNext</span><span class="dl">'</span><span class="p">);</span>

  <span class="kd">function</span> <span class="nf">getGraphemes</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="dl">'</span><span class="s1">Segmenter</span><span class="dl">'</span> <span class="k">in</span> <span class="nx">Intl</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">seg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Intl</span><span class="p">.</span><span class="nc">Segmenter</span><span class="p">(</span><span class="dl">'</span><span class="s1">ko</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">granularity</span><span class="p">:</span> <span class="dl">'</span><span class="s1">grapheme</span><span class="dl">'</span> <span class="p">});</span>
        <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">seg</span><span class="p">.</span><span class="nf">segment</span><span class="p">(</span><span class="nx">str</span><span class="p">),</span> <span class="nx">s</span> <span class="o">=&gt;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">segment</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* fallback below */</span> <span class="p">}</span>
    <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nf">chunkArray</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">out</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="nx">n</span><span class="p">)</span> <span class="nx">out</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nf">slice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">n</span><span class="p">).</span><span class="nf">join</span><span class="p">(</span><span class="dl">''</span><span class="p">));</span>
    <span class="k">return</span> <span class="nx">out</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="kd">function</span> <span class="nf">copyText</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">clipboard</span><span class="p">.</span><span class="nf">writeText</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">ta</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">textarea</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">ta</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">text</span><span class="p">;</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">ta</span><span class="p">);</span>
      <span class="nx">ta</span><span class="p">.</span><span class="nf">select</span><span class="p">();</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nf">execCommand</span><span class="p">(</span><span class="dl">'</span><span class="s1">copy</span><span class="dl">'</span><span class="p">);</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nf">removeChild</span><span class="p">(</span><span class="nx">ta</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nf">removeChild</span><span class="p">(</span><span class="nx">ta</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nf">makeSummaryLine</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">total</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">snippet</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\s</span><span class="sr">+/g</span><span class="p">,</span> <span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">).</span><span class="nf">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">title</span><span class="p">:</span> <span class="s2">`ì¡°ê° </span><span class="p">${</span><span class="nx">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span><span class="s2"> / </span><span class="p">${</span><span class="nx">total</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
      <span class="na">meta</span><span class="p">:</span> <span class="s2">`(</span><span class="p">${</span><span class="nx">len</span><span class="p">}</span><span class="s2">ì)`</span><span class="p">,</span>
      <span class="nx">snippet</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nf">renderChunks</span><span class="p">(</span><span class="nx">chunks</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">container</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
    <span class="nx">chunks</span><span class="p">.</span><span class="nf">forEach</span><span class="p">((</span><span class="nx">text</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">details</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">details</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">details</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">chunk</span><span class="dl">'</span><span class="p">;</span>
      <span class="c1">// ê¸°ë³¸: ì ‘í˜</span>
      <span class="nx">details</span><span class="p">.</span><span class="nx">open</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">summary</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">summary</span><span class="dl">'</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">left</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">left</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">summary-left</span><span class="dl">'</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">b1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">span</span><span class="dl">'</span><span class="p">);</span> <span class="nx">b1</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">badge</span><span class="dl">'</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">b2</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">span</span><span class="dl">'</span><span class="p">);</span> <span class="nx">b2</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">badge</span><span class="dl">'</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">snip</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">span</span><span class="dl">'</span><span class="p">);</span> <span class="nx">snip</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">snippet</span><span class="dl">'</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">meta</span> <span class="o">=</span> <span class="nf">makeSummaryLine</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">chunks</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">text</span><span class="p">);</span>
      <span class="nx">b1</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">meta</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
      <span class="nx">b2</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">meta</span><span class="p">.</span><span class="nx">meta</span><span class="p">;</span>
      <span class="nx">snip</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">meta</span><span class="p">.</span><span class="nx">snippet</span><span class="p">;</span>

      <span class="nx">left</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">b1</span><span class="p">);</span> <span class="nx">left</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">b2</span><span class="p">);</span> <span class="nx">left</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">snip</span><span class="p">);</span>

      <span class="kd">const</span> <span class="nx">copiedBadge</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">span</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">copiedBadge</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">badge</span><span class="dl">'</span><span class="p">;</span>
      <span class="nx">copiedBadge</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">ë¯¸ë³µì‚¬</span><span class="dl">'</span><span class="p">;</span>

      <span class="nx">summary</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">left</span><span class="p">);</span>
      <span class="nx">summary</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">copiedBadge</span><span class="p">);</span>
      <span class="nx">details</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">summary</span><span class="p">);</span>

      <span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">body</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">chunk-body</span><span class="dl">'</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">actions</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">actions</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">actions</span><span class="dl">'</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">copyBtn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">button</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">copyBtn</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">ì´ ì¡°ê° ë³µì‚¬</span><span class="dl">'</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">copyAndNextBtn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">button</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">copyAndNextBtn</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">ë³µì‚¬í•˜ê³  ë‹¤ìŒ í¼ì¹˜ê¸°</span><span class="dl">'</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">markBtn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">button</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">markBtn</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">í‘œì‹œ í•´ì œ</span><span class="dl">'</span><span class="p">;</span>

      <span class="nx">actions</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">copyBtn</span><span class="p">);</span>
      <span class="nx">actions</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">copyAndNextBtn</span><span class="p">);</span>
      <span class="nx">actions</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">markBtn</span><span class="p">);</span>

      <span class="kd">const</span> <span class="nx">pre</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">pre</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">pre</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">text</span><span class="p">;</span>

      <span class="nx">body</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">actions</span><span class="p">);</span>
      <span class="nx">body</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">pre</span><span class="p">);</span>
      <span class="nx">details</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
      <span class="nx">container</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">details</span><span class="p">);</span>

      <span class="c1">// ìƒíƒœ ë§ˆí‚¹ í•¨ìˆ˜</span>
      <span class="kd">function</span> <span class="nf">markCopiedOnce</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">details</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">copied-once</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">copiedBadge</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">ok</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">copiedBadge</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">âœ… ë³µì‚¬í•¨</span><span class="dl">'</span><span class="p">;</span>
        <span class="nx">markBtn</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">í‘œì‹œ í•´ì œ</span><span class="dl">'</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="kd">function</span> <span class="nf">unmarkCopied</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">details</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">copied-once</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">copiedBadge</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">ok</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">copiedBadge</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">ë¯¸ë³µì‚¬</span><span class="dl">'</span><span class="p">;</span>
        <span class="nx">markBtn</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">í‘œì‹œí•˜ê¸°</span><span class="dl">'</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// ìˆ˜ë™ í† ê¸€ (ì›í•˜ì‹¤ ë•Œ ì§ì ‘ í‘œì‹œ/í•´ì œ)</span>
      <span class="nx">markBtn</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span> <span class="c1">// summary ì—´ë¦¼ ë°©ì§€</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">details</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">copied-once</span><span class="dl">'</span><span class="p">))</span> <span class="nf">unmarkCopied</span><span class="p">();</span>
        <span class="k">else</span> <span class="nf">markCopiedOnce</span><span class="p">();</span>
      <span class="p">});</span>

      <span class="c1">// ë³µì‚¬ ë²„íŠ¼</span>
      <span class="nx">copyBtn</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span> <span class="c1">// summary í† ê¸€ ë°©ì§€</span>
        <span class="kd">const</span> <span class="nx">ok</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">copyText</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
        <span class="nx">copyBtn</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">ok</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">ë³µì‚¬ë¨!</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">ë³µì‚¬ ì‹¤íŒ¨</span><span class="dl">'</span><span class="p">;</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">ok</span><span class="p">)</span> <span class="nf">markCopiedOnce</span><span class="p">();</span>
        <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">copyBtn</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">ì´ ì¡°ê° ë³µì‚¬</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1200</span><span class="p">);</span>
      <span class="p">});</span>

      <span class="c1">// ë³µì‚¬ í›„ ë‹¤ìŒ í¼ì¹˜ê¸°(ì˜µì…˜)</span>
      <span class="nx">copyAndNextBtn</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">ok</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">copyText</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
        <span class="nx">copyAndNextBtn</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">ok</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">ë³µì‚¬ë¨!</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">ë³µì‚¬ ì‹¤íŒ¨</span><span class="dl">'</span><span class="p">;</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
          <span class="nf">markCopiedOnce</span><span class="p">();</span>
          <span class="k">if </span><span class="p">(</span><span class="nx">autoOpenNextEl</span><span class="p">.</span><span class="nx">checked</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">next</span> <span class="o">=</span> <span class="nx">details</span><span class="p">.</span><span class="nx">nextElementSibling</span><span class="p">;</span>
            <span class="k">if </span><span class="p">(</span><span class="nx">next</span> <span class="o">&amp;&amp;</span> <span class="nx">next</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">DETAILS</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">next</span><span class="p">.</span><span class="nx">open</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
              <span class="nx">next</span><span class="p">.</span><span class="nf">scrollIntoView</span><span class="p">({</span> <span class="na">behavior</span><span class="p">:</span> <span class="dl">'</span><span class="s1">smooth</span><span class="dl">'</span><span class="p">,</span> <span class="na">block</span><span class="p">:</span> <span class="dl">'</span><span class="s1">start</span><span class="dl">'</span> <span class="p">});</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">copyAndNextBtn</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">ë³µì‚¬í•˜ê³  ë‹¤ìŒ í¼ì¹˜ê¸°</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1200</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nf">splitNow</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">raw</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">value</span> <span class="o">??</span> <span class="dl">''</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">size</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">sizeEl</span><span class="p">.</span><span class="nx">value</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">grams</span> <span class="o">=</span> <span class="nf">getGraphemes</span><span class="p">(</span><span class="nx">raw</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">chunks</span> <span class="o">=</span> <span class="nf">chunkArray</span><span class="p">(</span><span class="nx">grams</span><span class="p">,</span> <span class="nx">size</span><span class="p">);</span>
    <span class="nf">renderChunks</span><span class="p">(</span><span class="nx">chunks</span><span class="p">);</span>
    <span class="nx">stats</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s2">`ì „ì²´ ê¸¸ì´: </span><span class="p">${</span><span class="nx">grams</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2">ì Â· ì¡°ê° ê°œìˆ˜: </span><span class="p">${</span><span class="nx">chunks</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> Â· ì¡°ê°ë‹¹ ìµœëŒ€ </span><span class="p">${</span><span class="nx">size</span><span class="p">}</span><span class="s2">ì`</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">splitBtn</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">splitNow</span><span class="p">);</span>

  <span class="nx">copyAllBtn</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">pieces</span> <span class="o">=</span> <span class="nx">$</span><span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.chunk pre</span><span class="dl">'</span><span class="p">).</span><span class="nf">map</span><span class="p">(</span><span class="nx">p</span> <span class="o">=&gt;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">textContent</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">joined</span> <span class="o">=</span> <span class="nx">pieces</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">ok</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">copyText</span><span class="p">(</span><span class="nx">joined</span><span class="p">);</span>
    <span class="nx">copyAllBtn</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">ok</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">ëª¨ë‘ ë³µì‚¬ë¨!</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">ë³µì‚¬ ì‹¤íŒ¨</span><span class="dl">'</span><span class="p">;</span>
    <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">copyAllBtn</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">ëª¨ë‘ ë³µì‚¬</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1200</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">expandAllBtn</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">$</span><span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#chunks details.chunk</span><span class="dl">'</span><span class="p">).</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">d</span> <span class="o">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">open</span> <span class="o">=</span> <span class="kc">true</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="nx">collapseAllBtn</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">$</span><span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#chunks details.chunk</span><span class="dl">'</span><span class="p">).</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">d</span> <span class="o">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">open</span> <span class="o">=</span> <span class="kc">false</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">})();</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h3 id="ë°”ë€-ì -ìš”ì•½-step-by-step">ë°”ë€ ì  ìš”ì•½ (step-by-step)</h3>

<ol>
  <li>
    <p><strong>ë³µì‚¬ ì§„í–‰ ìƒí™© í‘œì‹œ</strong> : í•œ ë²ˆì´ë¼ë„ ë³µì‚¬ ì„±ê³µí•˜ë©´ í•´ë‹¹ ì¹´ë“œê°€ ì´ˆë¡ í…Œë‘ë¦¬ + <code class="language-plaintext highlighter-rouge">âœ… ë³µì‚¬í•¨</code> ë°°ì§€ë¡œ <strong>ì˜êµ¬ í‘œì‹œ(ì„¸ì…˜ ë‚´)</strong> ë©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p><strong>ì ‘í˜ UI</strong> : ê° ì¡°ê°ì€ <code class="language-plaintext highlighter-rouge">details/summary</code> ê¸°ë°˜ <strong>ì ‘í˜ ì¹´ë“œ</strong> ë¡œ ë Œë”ë§ë©ë‹ˆë‹¤. ìƒë‹¨ì˜ â€œëª¨ë‘ í¼ì¹˜ê¸°/ëª¨ë‘ ì ‘ê¸°â€ë¡œ ì¼ê´„ ì œì–´ ê°€ëŠ¥.</p>
  </li>
  <li>
    <p><strong>ë¯¸ë¦¬ë³´ê¸°</strong> : ìš”ì•½ì¤„ì— ì•ë¶€ë¶„ 60ì ë¯¸ë¦¬ë³´ê¸°ì™€ ê¸¸ì´ í‘œê¸°ê°€ ë“¤ì–´ê°€ <strong>ìŠ¤í¬ë¡¤ ì—†ì´ í›‘ì–´ë³´ê¸°</strong> ê°€ ì‰¬ì›Œì¡ŒìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
    <p><strong>ì‘ì—… íë¦„ ê°€ì†</strong> : â€œë³µì‚¬í•˜ê³  ë‹¤ìŒ í¼ì¹˜ê¸°â€ + (ì˜µì…˜) â€œë³µì‚¬ í›„ ë‹¤ìŒ ì¡°ê° ìë™ ì—´ê¸°â€ í† ê¸€ë¡œ <strong>ì—°ì† ì‘ì—…</strong> ì´ ë¶€ë“œëŸ½ìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
    <p><strong>ìˆ˜ë™ í‘œì‹œ/í•´ì œ</strong> ë²„íŠ¼: í•„ìš”í•˜ë©´ ë³µì‚¬ ì—†ì´ë„ â€œí‘œì‹œí•˜ê¸°/í‘œì‹œ í•´ì œâ€ë¡œ ì²´í¬ë¦¬ìŠ¤íŠ¸ì²˜ëŸ¼ ì“¸ ìˆ˜ ìˆì–´ìš”.</p>
  </li>
</ol>

<p>ì›í•˜ì‹œë©´</p>

<ul>
  <li>
    <p><strong>ì˜¤ë²„ë© ë¶„í• (ì˜ˆ: 8000ì, ì˜¤ë²„ë© 200ì)</strong> ,</p>
  </li>
  <li>
    <p><strong>ë¬¸ë‹¨/ë¬¸ì¥ ë‹¨ìœ„ ìµœëŒ€ Nì</strong>(ìì—°ì–´ ê²½ê³„ ìœ ì§€),</p>
  </li>
  <li>
    <p><strong>ì„¸ì…˜ ê°„ ì§„í–‰ìƒí™© ì €ì¥(localStorage)</strong><br />
ê°™ì€ ì˜µì…˜ë„ ë°”ë¡œ ë¶™ì—¬ë“œë¦´ê²Œìš”.</p>
  </li>
</ul>]]></content><author><name>hvppyarchive</name></author><category term="misc" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">PyVerilog AST ë³€í™˜</title><link href="https://hvppyarchive.github.io/verilog/pyverilog-ir/" rel="alternate" type="text/html" title="PyVerilog AST ë³€í™˜" /><published>2025-08-19T18:31:08+09:00</published><updated>2025-08-19T18:31:08+09:00</updated><id>https://hvppyarchive.github.io/verilog/pyverilog-ir</id><content type="html" xml:base="https://hvppyarchive.github.io/verilog/pyverilog-ir/"><![CDATA[<p class="chat--user">

PyVerilogì˜ astê°€ ìƒê°ë³´ë‹¤ ì •ê·œí™”(í‘œì¤€í™”) ë˜ì–´ ìˆì§€ ì•Šì•„ì„œ ì˜ˆì™¸ì²˜ë¦¬í•  ê²ƒì´ ë„ˆë¬´ ë§ì•„.(e.g. portê°€ IO í¬í•¨ì¸ì§€, ë³¸ë¬¸ì— ì¨ìˆëŠ”ì§€ ë“±ë“±) ì¢€ ë” í‘œì¤€í™”ëœ í˜•ì‹ìœ¼ë¡œ ì‰½ê²Œ traverseí•  ìˆ˜ ìˆëŠ” í˜•íƒœë¡œ conversion í•˜ëŠ” ê¸°ëŠ¥ì„ ê°œë°œí•˜ë ¤ê³  í•´. ë“¤ì–´ê°€ì•¼í•  ì‚¬í•­ë“¤: - port(ìˆœì„œ, í¬íŠ¸ëª…, width(msb, lsb), in/out/inout) - ë‚´ë¶€ instance(submodule, port-argument mapping) - ë‚´ë¶€ nets(width(msb, lsb)) 

</p>

<p>ì¢‹ì•„ìš”â€”PyVerilog ASTì˜ ë“¤ì­‰ë‚ ì­‰í•¨(ANSI/Non-ANSI í¬íŠ¸ ì„ ì–¸, í¬ì§€ì…”ë„/ë„¤ì„ë“œ ì¸ìŠ¤í„´ìŠ¤, width í‘œí˜„ì‹ ë“±) ë•Œë¬¸ì— ì˜ˆì™¸ê°€ ë§ì£ . ì•„ë˜ì²˜ëŸ¼ <strong>í‘œì¤€í™”ëœ ì¤‘ê°„ í‘œí˜„(IR)</strong>ë¡œ ë³€í™˜í•˜ëŠ” íŒŒì´í”„ë¼ì¸ì„ ì œì•ˆí•©ë‹ˆë‹¤. ë°”ë¡œ ì“¸ ìˆ˜ ìˆëŠ” <strong>ì°¸ì¡° êµ¬í˜„ ì½”ë“œ</strong> ë„ ë„£ì—ˆì–´ìš”.</p>

<hr />

<h1 id="ëª©í‘œ">ëª©í‘œ</h1>

<ul>
  <li>
    <p>ëª¨ë“ˆ ë‹¨ìœ„ë¡œ <strong>ì¼ê´€ëœ JSON IR</strong> ì œê³µ</p>
  </li>
  <li>
    <p>í¬íŠ¸: <strong>ìˆœì„œ(index), ì´ë¦„, ë°©í–¥, í­(msb/lsb, ì •ìˆ˜ í‰ê°€ ê°€ëŠ¥í•˜ë©´ width), signed ì—¬ë¶€</strong></p>
  </li>
  <li>
    <p>ë‚´ë¶€ ì¸ìŠ¤í„´ìŠ¤: <strong>ì„œë¸Œëª¨ë“ˆëª…, ì¸ìŠ¤í„´ìŠ¤ëª…, íŒŒë¼ë¯¸í„° override, í¬íŠ¸-ì•„ê·œë¨¼íŠ¸ ë§¤í•‘(í¬ì§€ì…”ë„â†’ë„¤ì„ë“œ ìë™ ì¹˜í™˜)</strong></p>
  </li>
  <li>
    <p>ë‚´ë¶€ nets: <strong>wire/reg ë“±, ì´ë¦„, í­(msb/lsb, width)</strong></p>
  </li>
</ul>

<hr />

<h1 id="ì„¤ê³„-ìŠ¤í…ë³„">ì„¤ê³„ (ìŠ¤í…ë³„)</h1>

<ol>
  <li><strong>IR ìŠ¤í‚¤ë§ˆ ì •ì˜</strong></li>
</ol>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"modules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"&lt;modname&gt;"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"WIDTH"</span><span class="p">,</span><span class="nl">"value_str"</span><span class="p">:</span><span class="s2">"8"</span><span class="p">,</span><span class="nl">"value"</span><span class="p">:</span><span class="mi">8</span><span class="p">}],</span><span class="w">
      </span><span class="nl">"ports"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nl">"index"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"clk"</span><span class="p">,</span><span class="nl">"dir"</span><span class="p">:</span><span class="s2">"input"</span><span class="p">,</span><span class="nl">"signed"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
         </span><span class="nl">"msb_str"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="nl">"lsb_str"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="nl">"msb"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nl">"lsb"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nl">"width"</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"nets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"data"</span><span class="p">,</span><span class="nl">"kind"</span><span class="p">:</span><span class="s2">"wire"</span><span class="p">,</span><span class="nl">"signed"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
         </span><span class="nl">"msb_str"</span><span class="p">:</span><span class="s2">"WIDTH-1"</span><span class="p">,</span><span class="nl">"lsb_str"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="nl">"msb"</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="nl">"lsb"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nl">"width"</span><span class="p">:</span><span class="mi">8</span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"instances"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nl">"inst"</span><span class="p">:</span><span class="s2">"u0"</span><span class="p">,</span><span class="nl">"module"</span><span class="p">:</span><span class="s2">"child"</span><span class="p">,</span><span class="nl">"param_overrides"</span><span class="p">:[{</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"WIDTH"</span><span class="p">,</span><span class="nl">"value_str"</span><span class="p">:</span><span class="s2">"4"</span><span class="p">,</span><span class="nl">"value"</span><span class="p">:</span><span class="mi">4</span><span class="p">}],</span><span class="w">
         </span><span class="nl">"connections"</span><span class="p">:[{</span><span class="nl">"port"</span><span class="p">:</span><span class="s2">"a"</span><span class="p">,</span><span class="nl">"expr_str"</span><span class="p">:</span><span class="s2">"data[3:0]"</span><span class="p">},{</span><span class="nl">"port"</span><span class="p">:</span><span class="s2">"b"</span><span class="p">,</span><span class="nl">"expr_str"</span><span class="p">:</span><span class="s2">"clk"</span><span class="p">}]}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">*_str</code>ëŠ” ì›ë³¸ í‘œí˜„ì‹ ë¬¸ìì—´, <code class="language-plaintext highlighter-rouge">msb/lsb/width/value</code>ëŠ” <strong>ê°€ëŠ¥í•˜ë©´ ì •ìˆ˜ í‰ê°€</strong> , ì‹¤íŒ¨ ì‹œ <code class="language-plaintext highlighter-rouge">null</code>.</p>
  </li>
  <li>
    <p>í¬ì§€ì…”ë„ ì—°ê²°ì€ <strong>ì„œë¸Œëª¨ë“ˆ í¬íŠ¸ ìˆœì„œ</strong> ë¥¼ ì´ìš©í•´ ë„¤ì„ë“œë¡œ ë³€í™˜.</p>
  </li>
</ul>

<ol>
  <li><strong>ë‘ ë‹¨ê³„ ìˆ˜ì§‘</strong></li>
</ol>

<ul>
  <li>
    <p><strong>1íŒ¨ìŠ¤</strong> : ëª¨ë“  ëª¨ë“ˆì˜ í¬íŠ¸ ìˆœì„œ/ê¸°ë³¸ íŒŒë¼ë¯¸í„° í…Œì´ë¸” ìƒì„±(í¬ì§€ì…”ë„ ë§¤í•‘ìš©).</p>
  </li>
  <li>
    <p><strong>2íŒ¨ìŠ¤</strong> : ê° ëª¨ë“ˆì— ëŒ€í•´ í¬íŠ¸/ë„·/ì¸ìŠ¤í„´ìŠ¤ í‘œì¤€í™”.</p>
  </li>
</ul>

<ol>
  <li><strong>í¬íŠ¸ ì •ê·œí™”</strong></li>
</ol>

<ul>
  <li>
    <p>ANSI(<code class="language-plaintext highlighter-rouge">Ioport</code>)ì™€ Non-ANSI(<code class="language-plaintext highlighter-rouge">Port</code>+ë³¸ë¬¸ <code class="language-plaintext highlighter-rouge">Input/Output/Inout</code> ì„ ì–¸) ëª¨ë‘ í¡ìˆ˜.</p>
  </li>
  <li>
    <p>í­ ë¯¸ì§€ì •ì€ <code class="language-plaintext highlighter-rouge">1ë¹„íŠ¸(msb=lsb=0)</code>ë¡œ í†µì¼. ë°©í–¥ ë¯¸ìƒì€ ë³´ìˆ˜ì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">inout</code> ëŒ€ì‹  <strong>ë°œê²¬ ì‹¤íŒ¨ ì‹œ null</strong>(í˜„ì‹¤ì ìœ¼ë¡œ ê±°ì˜ ì—†ìŒ).</p>
  </li>
</ul>

<ol>
  <li><strong>ì¸ìŠ¤í„´ìŠ¤ ì •ê·œí™”</strong></li>
</ol>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">InstanceList</code>ë¥¼ ì¬ê·€ íƒìƒ‰(Generate ë¸”ë¡ ë‚´ë¶€ í¬í•¨).</p>
  </li>
  <li>
    <p>í¬ì§€ì…”ë„ ì—°ê²°ì€ 1íŒ¨ìŠ¤ì—ì„œ ëª¨ì€ <strong>ì„œë¸Œëª¨ë“ˆ í¬íŠ¸ ìˆœì„œ</strong> ë¡œ ë„¤ì„ë“œ ë³€í™˜. ì•Œ ìˆ˜ ì—†ëŠ” ì™¸ë¶€ ëª¨ë“ˆì€ ì¸ë±ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ ë‚¨ê¹€(ì˜ˆ: <code class="language-plaintext highlighter-rouge">__pos0</code>, <code class="language-plaintext highlighter-rouge">__pos1</code>).</p>
  </li>
</ul>

<ol>
  <li><strong>ë„· ì •ê·œí™”</strong></li>
</ol>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">wire/reg</code>(í•„ìš”í•˜ë©´ <code class="language-plaintext highlighter-rouge">integer</code>)ë¥¼ ìˆ˜ì§‘, ë‹¤ì¤‘ ì„ ì–¸ì€ ê°œë³„ í•­ëª©ìœ¼ë¡œ ë¶„í• .</p>
  </li>
  <li>
    <p>í¬íŠ¸ ì„ ì–¸ì—ì„œ ì´ë¯¸ ë“±ì¥í•œ ì‹ë³„ìëŠ” <strong>netsì—ì„œ ì¤‘ë³µ ì œì™¸</strong>(ìš”êµ¬ì‚¬í•­ì´ â€œë‚´ë¶€ netsâ€ì´ë¯€ë¡œ).</p>
  </li>
</ul>

<ol>
  <li><strong>í‘œí˜„ì‹ í‰ê°€ê¸°</strong></li>
</ol>

<ul>
  <li>íŒŒë¼ë¯¸í„° í™˜ê²½ì„ ì‚¬ìš©í•´ <code class="language-plaintext highlighter-rouge">IntConst/Identifier/UnaryOp/BinaryOp</code> ì¤‘ì‹¬ìœ¼ë¡œ <strong>ì•ˆì „í•œ ì •ìˆ˜ í‰ê°€</strong>(ë¯¸ì§€ì› ì—°ì‚° ì‹œ ê°’ì€ <code class="language-plaintext highlighter-rouge">null</code>, ì› ë¬¸ìì—´ì€ ìœ ì§€).</li>
</ul>

<hr />

<h1 id="ë ˆí¼ëŸ°ìŠ¤-êµ¬í˜„-python--pyverilog">ë ˆí¼ëŸ°ìŠ¤ êµ¬í˜„ (Python / PyVerilog)</h1>

<blockquote>
  <p>pip: <code class="language-plaintext highlighter-rouge">pyverilog</code> í•„ìš”. íŒŒì¼ ëª¨ìŒ ì…ë ¥ â†’ ìœ„ IR JSON ë°˜í™˜.
```python</p>
  <h1 id="vnormpy">vnorm.py</h1>
  <p>from <strong>future</strong> import annotations
from typing import Any, Dict, List, Tuple, Optional
import json
from pyverilog.vparser.parser import parse
from pyverilog.vparser import ast as vast
from pyverilog.ast_code_generator.codegen import ASTCodeGenerator</p>
</blockquote>

<p>codegen = ASTCodeGenerator()</p>

<h1 id="--utilities--">â€”â€”â€”- utilities â€”â€”â€”-</h1>
<p>def to_str(node) -&gt; Optional[str]:
    if node is None:
        return None
    try:
        return codegen.visit(node)
    except Exception:
        return None</p>

<p>def int_from_intconst(intconst: str) -&gt; Optional[int]:
    # Handles decimal/hex/bin/octal Verilog ints like 8'hFF or 'd10.
    s = intconst.replace('_', '')
    try:
        # forms: 10, 8'hFF, 'd3
        if "'" not in s:
            return int(s, 10)
        width_base, val = s.split("'")
        base = val[0].lower()
        digits = val[1:]
        if base == 'd': return int(digits, 10)
        if base == 'h': return int(digits, 16)
        if base == 'b': return int(digits, 2)
        if base == 'o': return int(digits, 8)
        # unknown base
        return int(digits, 10)
    except Exception:
        return None</p>

<p>def eval_expr(node, env: Dict[str, int]) -&gt; Optional[int]:
    # conservative evaluator for width-ish integer expressions
    if node is None:
        return None
    if isinstance(node, vast.IntConst):
        return int_from_intconst(node.value)
    if isinstance(node, vast.Identifier):
        return env.get(node.name)
    if isinstance(node, vast.UnaryOperator):
        v = eval_expr(node.children()[0], env)
        if v is None: return None
        op = node.<strong>class</strong>.<strong>name</strong>
        if op in ("Uplus",): return +v
        if op in ("Uminus",): return -v
        if op in ("Ulnot","Unot"): return 0 if v else 1
        return None
    if isinstance(node, vast.Partselect) or isinstance(node, vast.Pointer):
        # treat as unknown integer
        return None
    if isinstance(node, vast.Concat) or isinstance(node, vast.Repeat):
        return None
    # Binary operators
    if isinstance(node, vast.BinaryOperator):
        a = eval_expr(node.left, env)
        b = eval_expr(node.right, env)
        if a is None or b is None:
            return None
        t = node.<strong>class</strong>.<strong>name</strong>
        try:
            if t == "Plus": return a + b
            if t == "Minus": return a - b
            if t == "Times": return a * b
            if t == "Div": return a // b if b != 0 else None
            if t == "Power": return a ** b
            if t == "Mod": return a % b if b != 0 else None
            if t == "Sll": return a Â«Â b
            if t == "Srl": return aÂ Â» b
            if t == "And": return a &amp; b
            if t == "Or":  return a | b
            if t == "Xor": return a ^ b
        except Exception:
            return None
        return None
    return None</p>

<p>def width_tuple(width_node, env: Dict[str,int]):
    # returns (msb_str, lsb_str, msb_val, lsb_val, width_val)
    if width_node is None:
        return "0", "0", 0, 0, 1
    msb_n, lsb_n = width_node.msb, width_node.lsb
    msb_s, lsb_s = to_str(msb_n), to_str(lsb_n)
    msb_v, lsb_v = eval_expr(msb_n, env), eval_expr(lsb_n, env)
    width_v = None
    if msb_v is not None and lsb_v is not None:
        width_v = abs(msb_v - lsb_v) + 1
    return msb_s, lsb_s, msb_v, lsb_v, width_v</p>

<h1 id="--1st-pass-collect-module-port-order--param-defaults--">â€”â€”â€”- 1st pass: collect module port order &amp; param defaults â€”â€”â€”-</h1>
<p>def collect_modules(ast_root) -&gt; Dict[str, vast.ModuleDef]:
    mods = {}
    for d in ast_root.description.definitions:
        if isinstance(d, vast.ModuleDef):
            mods[d.name] = d
    return mods</p>

<p>def collect_param_env(mod: vast.ModuleDef) -&gt; Dict[str,int]:
    env = {}
    # parameters in header
    if getattr(mod, "paramlist", None):
        for p in mod.paramlist.params:
            if isinstance(p, vast.Parameter):
                v = eval_expr(p.value, env)  # parameters can depend on earlier ones
                if v is not None:
                    env[p.name] = v
    # parameters in body declarations, if any
    for item in getattr(mod, "items", []) or []:
        if isinstance(item, vast.Decl):
            for e in item.list:
                if isinstance(e, vast.Parameter):
                    v = eval_expr(e.value, env)
                    if v is not None:
                        env[e.name] = v
    return env</p>

<p>def ordered_port_names(mod: vast.ModuleDef) -&gt; List[str]:
    names = []
    if mod.portlist is None:
        return names
    for p in mod.portlist.ports:
        # Ioport(first=Identifier, second=Input/Output/Inout)
        if isinstance(p, vast.Ioport):
            names.append(p.first.name)
        elif isinstance(p, vast.Port):
            # Port(name, arg=None) in non-ANSI
            names.append(p.name)
    return names</p>

<h1 id="--helpers-declaration-maps--">â€”â€”â€”- helpers: declaration maps â€”â€”â€”-</h1>
<p>def build_io_decl_map(mod: vast.ModuleDef, env: Dict[str,int]):
    # name -&gt; (dir, signed, width_info)
    io_map = {}
    for item in getattr(mod, "items", []) or []:
        if not isinstance(item, vast.Decl):
            continue
        for e in item.list:
            if isinstance(e, (vast.Input, vast.Output, vast.Inout)):
                dir_ = "input" if isinstance(e, vast.Input) else ("output" if isinstance(e, vast.Output) else "inout")
                signed = bool(getattr(e, "signed", False))
                w = getattr(e, "width", None)
                msb_s, lsb_s, msb_v, lsb_v, width_v = width_tuple(w, env)
                for name in [n.name for n in e.children() if isinstance(n, vast.Identifier)]:
                    io_map[name] = (dir_, signed, (msb_s, lsb_s, msb_v, lsb_v, width_v))
    return io_map</p>

<p>def build_net_decl_list(mod: vast.ModuleDef, env: Dict[str,int]):
    nets = []
    for item in getattr(mod, "items", []) or []:
        if not isinstance(item, vast.Decl):
            continue
        for e in item.list:
            if isinstance(e, (vast.Wire, vast.Reg, vast.Integer)):
                kind = "wire" if isinstance(e, vast.Wire) else ("reg" if isinstance(e, vast.Reg) else "integer")
                signed = bool(getattr(e, "signed", False))
                w = getattr(e, "width", None)
                msb_s, lsb_s, msb_v, lsb_v, width_v = width_tuple(w, env)
                for n in e.children():
                    if isinstance(n, vast.Identifier):
                        nets.append({
                            "name": n.name, "kind": kind, "signed": signed,
                            "msb_str": msb_s, "lsb_str": lsb_s, "msb": msb_v, "lsb": lsb_v, "width": width_v
                        })
    return nets</p>

<h1 id="--recursive-walker-for-instancelist--">â€”â€”â€”- recursive walker for InstanceList â€”â€”â€”-</h1>
<p>def iter_instancelists(node):
    # yield vast.InstanceList under any nesting (e.g., Generate blocks)
    if isinstance(node, vast.InstanceList):
        yield node
    for ch in getattr(node, "children", lambda: [])():
        yield from iter_instancelists(ch)</p>

<h1 id="--2nd-pass-build-ir-per-module--">â€”â€”â€”- 2nd pass: build IR per module â€”â€”â€”-</h1>
<p>def normalize_module(mod: vast.ModuleDef, modlib_ports: Dict[str, List[str]]) -&gt; Dict[str,Any]:
    env = collect_param_env(mod)
    # parameters
    params = []
    # header params
    if getattr(mod, "paramlist", None):
        for p in mod.paramlist.params:
            if isinstance(p, vast.Parameter):
                params.append({
                    "name": p.name,
                    "value_str": to_str(p.value),
                    "value": eval_expr(p.value, env)
                })
    # body params (avoid duplicates)
    body_params = {}
    for item in getattr(mod, "items", []) or []:
        if isinstance(item, vast.Decl):
            for e in item.list:
                if isinstance(e, vast.Parameter) and e.name not in {x["name"] for x in params}:
                    body_params[e.name] = {
                        "name": e.name,
                        "value_str": to_str(e.value),
                        "value": eval_expr(e.value, env)
                    }
    params.extend(body_params.values())</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ports
io_map = build_io_decl_map(mod, env)
ordered_names = ordered_port_names(mod)
ports = []
for idx, pname in enumerate(ordered_names):
    dir_, signed, winfo = None, False, None
    # ANSI Ioport case
    ansi_hit = False
    if mod.portlist and isinstance(mod.portlist.ports[idx], vast.Ioport):
        io = mod.portlist.ports[idx]
        decl = io.second  # Input/Output/Inout
        dir_ = "input" if isinstance(decl, vast.Input) else ("output" if isinstance(decl, vast.Output) else "inout")
        signed = bool(getattr(decl, "signed", False))
        w = getattr(decl, "width", None)
        msb_s, lsb_s, msb_v, lsb_v, width_v = width_tuple(w, env)
        winfo = (msb_s, lsb_s, msb_v, lsb_v, width_v)
        ansi_hit = True
    # Non-ANSI fallback via body decl map
    if not ansi_hit and pname in io_map:
        dir_, signed, winfo = io_map[pname]
    if winfo is None:
        winfo = width_tuple(None, env)
    msb_s, lsb_s, msb_v, lsb_v, width_v = winfo
    ports.append({
        "index": idx, "name": pname, "dir": dir_, "signed": signed,
        "msb_str": msb_s, "lsb_str": lsb_s, "msb": msb_v, "lsb": lsb_v, "width": width_v
    })

# nets (exclude names that are top-level ports)
nets_raw = build_net_decl_list(mod, env)
port_names_set = set(ordered_names)
nets = [n for n in nets_raw if n["name"] not in port_names_set]

# instances
instances = []
for il in iter_instancelists(mod):
    submod = il.module
    # parameter overrides (common across instances in the list)
    param_overrides = []
    if getattr(il, "paramlist", None):
        for pa in il.paramlist.params:
            # pa: vast.ParamArg(name, argname/value)
            name = pa.paramname if hasattr(pa, "paramname") else getattr(pa, "name", None)
            value_node = pa.argname if hasattr(pa, "argname") else getattr(pa, "value", None)
            param_overrides.append({
                "name": name,
                "value_str": to_str(value_node),
                "value": eval_expr(value_node, env)
            })
    for inst in il.instances:
        conns = []
        # PortArg(portname, argname)
        portargs = getattr(inst, "portlist", []) or []
        # decide positional vs named
        positional = any(getattr(pa, "portname", None) in (None, "") for pa in portargs)
        if positional:
            # map by index using lib
            lib_ports = modlib_ports.get(submod, [])
            for i, pa in enumerate(portargs):
                pname = lib_ports[i] if i &lt; len(lib_ports) else f"__pos{i}"
                conns.append({"port": pname, "expr_str": to_str(getattr(pa, "argname", None))})
        else:
            for pa in portargs:
                conns.append({"port": pa.portname, "expr_str": to_str(pa.argname)})
        instances.append({
            "inst": inst.name,
            "module": submod,
            "param_overrides": param_overrides,
            "connections": conns
        })

return {"parameters": params, "ports": ports, "nets": nets, "instances": instances}
</code></pre></div></div>

<p>def convert_to_vnorm(files: List[str]) -&gt; Dict[str,Any]:
    ast, _ = parse(files)
    mods = collect_modules(ast)
    modlib_ports = {name: ordered_port_names(m) for name, m in mods.items()}
    result = {"modules": {}}
    for name, m in mods.items():
        result["modules"][name] = normalize_module(m, modlib_ports)
    return result</p>

<p>if <strong>name</strong> == "<strong>main</strong>":
    import argparse, sys
    ap = argparse.ArgumentParser()
    ap.add_argument("verilog", nargs="+", help="Verilog source files")
    ap.add_argument("-o", "â€“out", default="-", help="Output JSON path (default: stdout)")
    args = ap.parse_args()
    ir = convert_to_vnorm(args.verilog)
    s = json.dumps(ir, indent=2)
    if args.out == "-" or args.out == "/dev/stdout":
        print(s)
    else:
        with open(args.out, "w") as f:
            f.write(s)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
* * *

# ì‚¬ìš© ì˜ˆì‹œ

**ì˜ˆì œ Verilog**
```verilog
module child #(parameter WIDTH=8) (input clk, input [WIDTH-1:0] a, output y);
  assign y = a[0];
endmodule

module top (clk, rst, out);
  input clk, rst;
  output out;
  wire [7:0] data;
  child #(.WIDTH(8)) u0 (.clk(clk), .a(data), .y(out));
endmodule
</code></pre></div></div>

<p><strong>ì‹¤í–‰</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python vnorm.py top.v <span class="nt">-o</span> ir.json
</code></pre></div></div>

<p><strong>í•µì‹¬ ê²°ê³¼(ë°œì·Œ)</strong></p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"modules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"top"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"ports"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nl">"index"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"clk"</span><span class="p">,</span><span class="nl">"dir"</span><span class="p">:</span><span class="s2">"input"</span><span class="p">,</span><span class="nl">"width"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nl">"index"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"rst"</span><span class="p">,</span><span class="nl">"dir"</span><span class="p">:</span><span class="s2">"input"</span><span class="p">,</span><span class="nl">"width"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nl">"index"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"out"</span><span class="p">,</span><span class="nl">"dir"</span><span class="p">:</span><span class="s2">"output"</span><span class="p">,</span><span class="nl">"width"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">...</span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"nets"</span><span class="p">:[</span><span class="w">
        </span><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"data"</span><span class="p">,</span><span class="nl">"kind"</span><span class="p">:</span><span class="s2">"wire"</span><span class="p">,</span><span class="nl">"msb_str"</span><span class="p">:</span><span class="s2">"7"</span><span class="p">,</span><span class="nl">"lsb_str"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="nl">"msb"</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="nl">"lsb"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nl">"width"</span><span class="p">:</span><span class="mi">8</span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"instances"</span><span class="p">:[</span><span class="w">
        </span><span class="p">{</span><span class="nl">"inst"</span><span class="p">:</span><span class="s2">"u0"</span><span class="p">,</span><span class="nl">"module"</span><span class="p">:</span><span class="s2">"child"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"param_overrides"</span><span class="p">:[{</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"WIDTH"</span><span class="p">,</span><span class="nl">"value_str"</span><span class="p">:</span><span class="s2">"8"</span><span class="p">,</span><span class="nl">"value"</span><span class="p">:</span><span class="mi">8</span><span class="p">}],</span><span class="w">
         </span><span class="nl">"connections"</span><span class="p">:[</span><span class="w">
           </span><span class="p">{</span><span class="nl">"port"</span><span class="p">:</span><span class="s2">"clk"</span><span class="p">,</span><span class="nl">"expr_str"</span><span class="p">:</span><span class="s2">"clk"</span><span class="p">},</span><span class="w">
           </span><span class="p">{</span><span class="nl">"port"</span><span class="p">:</span><span class="s2">"a"</span><span class="p">,</span><span class="nl">"expr_str"</span><span class="p">:</span><span class="s2">"data"</span><span class="p">},</span><span class="w">
           </span><span class="p">{</span><span class="nl">"port"</span><span class="p">:</span><span class="s2">"y"</span><span class="p">,</span><span class="nl">"expr_str"</span><span class="p">:</span><span class="s2">"out"</span><span class="p">}</span><span class="w">
         </span><span class="p">]}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<hr />

<h1 id="êµ¬í˜„-í¬ì¸íŠ¸--ì—£ì§€ì¼€ì´ìŠ¤-ì²˜ë¦¬">êµ¬í˜„ í¬ì¸íŠ¸ &amp; ì—£ì§€ì¼€ì´ìŠ¤ ì²˜ë¦¬</h1>

<ul>
  <li>
    <p><strong>ANSI/Non-ANSI í¬íŠ¸</strong> : ë‘˜ ë‹¤ ì»¤ë²„. Non-ANSIëŠ” ë³¸ë¬¸ <code class="language-plaintext highlighter-rouge">Decl</code> íƒìƒ‰ìœ¼ë¡œ ë°©í–¥/í­ ì±„ì›€.</p>
  </li>
  <li>
    <p><strong>í­ ë¯¸ì§€ì •</strong> : <code class="language-plaintext highlighter-rouge">msb=lsb=0</code>, <code class="language-plaintext highlighter-rouge">width=1</code>ë¡œ í†µì¼.</p>
  </li>
  <li>
    <p><strong>í‘œí˜„ì‹ í‰ê°€ ì‹¤íŒ¨</strong> : <code class="language-plaintext highlighter-rouge">*_str</code>ë§Œ ë³´ì¡´í•˜ê³  ì •ìˆ˜ í•„ë“œëŠ” <code class="language-plaintext highlighter-rouge">null</code>.</p>
  </li>
  <li>
    <p><strong>í¬ì§€ì…”ë„ ì—°ê²°</strong> : 1íŒ¨ìŠ¤ì—ì„œ ìˆ˜ì§‘í•œ <strong>ì„œë¸Œëª¨ë“ˆ í¬íŠ¸ ìˆœì„œ</strong> ë¡œ ë„¤ì„ë“œí™”.</p>
  </li>
  <li>
    <p><strong>Generate ë‚´ë¶€ ì¸ìŠ¤í„´ìŠ¤</strong> : ì¬ê·€ íƒìƒ‰ìœ¼ë¡œ ìˆ˜ì§‘.</p>
  </li>
  <li>
    <p><strong>ë‚´ë¶€ nets</strong> : í¬íŠ¸ ì´ë¦„ê³¼ ì¤‘ë³µ ì œê±°.</p>
  </li>
  <li>
    <p><strong>íŒŒë¼ë¯¸í„°</strong> : í—¤ë”/ë³¸ë¬¸ ëª¨ë‘ ìˆ˜ì§‘, ê°€ëŠ¥í•œ ê²½ìš° ì •ìˆ˜ í‰ê°€.</p>
  </li>
</ul>

<hr />

<h1 id="ë‹¤ìŒ-í™•ì¥-ì•„ì´ë””ì–´">ë‹¤ìŒ í™•ì¥ ì•„ì´ë””ì–´</h1>

<ul>
  <li>
    <p>SystemVerilog ì¼ë¶€ ì§€ì›(ê°€ëŠ¥ ë²”ìœ„ì—ì„œ): <code class="language-plaintext highlighter-rouge">logic</code>, packed/unpacked ë°°ì—´, interface í¬íŠ¸ëŠ” ë³„ ë ˆì´ì–´ë¡œ.</p>
  </li>
  <li>
    <p>í­/íŒŒë¼ë¯¸í„° <strong>ì™„ì „ í‰ê°€</strong> ë¥¼ ìœ„í•´ PyVerilog Dataflow ì—°ê³„.</p>
  </li>
  <li>
    <p><strong>ê¸°ë³¸ nettype</strong>(<code class="language-plaintext highlighter-rouge">default_nettype none</code> ë¯¸ì‚¬ìš© ì‹œ) ì•”ì‹œì  net ê°ì§€ ì˜µì…˜.</p>
  </li>
  <li>
    <p><strong>ì†ŒìŠ¤ ìœ„ì¹˜ ì •ë³´</strong>(filename, lineno) ì¶”ê°€ë¡œ ë””ë²„ê¹… í¸ì˜ì„±â†‘.</p>
  </li>
  <li>
    <p><strong>ìŠ¤í‚¤ë§ˆ ê²€ì¦</strong>(pydantic/jsonschema)ë¡œ ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ ì•ˆì •ì„± í™•ë³´.</p>
  </li>
</ul>

<hr />

<p>í•„ìš”í•˜ì‹œë©´ ì´ IRë¡œë¶€í„° <strong>Graphviz ëª¨ë“ˆ-ì¸ìŠ¤í„´ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨</strong> ì´ë‚˜ <strong>í¬íŠ¸/ë„· í…Œì´ë¸”</strong> ë½‘ëŠ” ì½”ë“œë„ ë°”ë¡œ ë¶™ì—¬ë“œë¦´ê²Œìš”.</p>

<p class="chat--user">

JSON ë§ê³  Python classë¡œ ë³€í™˜í•˜ê³  ì‹¶ì–´

</p>

<p>ì¢‹ì§€! JSON ëŒ€ì‹  <strong>Python í´ë˜ìŠ¤(IR)</strong>ë¡œ ë°”ë¡œ ë‹¤ë£¨ê²Œ ë§Œë“¤ì.<br />
ì•„ë˜ëŠ” (1) íƒ€ì… ì„¤ê³„ â†’ (2) ë³€í™˜ íŒŒì´í”„ë¼ì¸ â†’ (3) ì „ì²´ êµ¬í˜„ ì½”ë“œ â†’ (4) ì‚¬ìš© ì˜ˆì‹œ ìˆœì„œë¡œ <strong>ì°¨ê·¼ì°¨ê·¼</strong> ì •ë¦¬í–ˆì–´.</p>

<hr />

<h1 id="1-ëª©í‘œ-ì¬ì •ì˜-step-by-step">1) ëª©í‘œ ì¬ì •ì˜ (Step-by-step)</h1>

<ul>
  <li>
    <p>PyVerilog AST â†’ <strong>ì¼ê´€ëœ Python dataclass IR</strong> ë°˜í™˜</p>
  </li>
  <li>
    <p>í¬í•¨ ì •ë³´</p>

    <ul>
      <li>
        <p><strong>í¬íŠ¸</strong> : ìˆœì„œ(index), ì´ë¦„, ë°©í–¥(in/out/inout), signed, í­(msb/lsb/width)</p>
      </li>
      <li>
        <p><strong>ì¸ìŠ¤í„´ìŠ¤</strong> : ì„œë¸Œëª¨ë“ˆëª…, ì¸ìŠ¤í„´ìŠ¤ëª…, íŒŒë¼ë¯¸í„° override, í¬íŠ¸-ì•„ê·œë¨¼íŠ¸ ë§¤í•‘(í¬ì§€ì…”ë„ â†’ ë„¤ì„ë“œ ìë™ ë³€í™˜)</p>
      </li>
      <li>
        <p><strong>ë‚´ë¶€ nets</strong> : wire/reg/integer, signed, í­(msb/lsb/width)</p>
      </li>
    </ul>
  </li>
  <li>
    <p>í‘œí˜„ì‹ì€ ê°€ëŠ¥í•œ í•œ <strong>ì •ìˆ˜ í‰ê°€</strong> , ì‹¤íŒ¨í•˜ë©´ ì›ë¬¸ ë¬¸ìì—´ ìœ ì§€</p>
  </li>
</ul>

<hr />

<h1 id="2-íƒ€ì…-ì„¤ê³„-dataclass--enum">2) íƒ€ì… ì„¤ê³„ (dataclass + Enum)</h1>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">DesignIR</code> (ë£¨íŠ¸) â†’ ëª¨ë“ˆëª… â†’ <code class="language-plaintext highlighter-rouge">ModuleIR</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ModuleIR</code> ì•ˆì— <code class="language-plaintext highlighter-rouge">Parameter</code>, <code class="language-plaintext highlighter-rouge">Port</code>, <code class="language-plaintext highlighter-rouge">Net</code>, <code class="language-plaintext highlighter-rouge">Instance(Connection[])</code></p>
  </li>
  <li>
    <p>ë°©í–¥/ë„· ì¢…ë¥˜ëŠ” Enumìœ¼ë¡œ ì•ˆì •í™”</p>
  </li>
</ul>

<hr />

<h1 id="3-ë³€í™˜-íŒŒì´í”„ë¼ì¸-ë‘-íŒ¨ìŠ¤-step-by-step">3) ë³€í™˜ íŒŒì´í”„ë¼ì¸ (ë‘ íŒ¨ìŠ¤, Step-by-step)</h1>

<ol>
  <li>
    <p><strong>1íŒ¨ìŠ¤</strong> : ëª¨ë“  ëª¨ë“ˆì˜</p>

    <ul>
      <li>
        <p>í¬íŠ¸ ìˆœì„œ ìˆ˜ì§‘(í¬ì§€ì…”ë„ ë§¤í•‘ìš©)</p>
      </li>
      <li>
        <p>íŒŒë¼ë¯¸í„° ê¸°ë³¸ê°’ í™˜ê²½(env) êµ¬ì„±(í­ í‰ê°€ìš©)</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>2íŒ¨ìŠ¤(ëª¨ë“ˆ ë‹¨ìœ„)</strong> :</p>

    <ul>
      <li>
        <p>í¬íŠ¸: ANSI/Non-ANSI í†µí•© ì •ê·œí™”</p>
      </li>
      <li>
        <p>ë„·: í¬íŠ¸ì™€ ì¤‘ë³µ ì œê±°, ë‹¤ì¤‘ ì„ ì–¸ ë¶„ë¦¬</p>
      </li>
      <li>
        <p>ì¸ìŠ¤í„´ìŠ¤: Generate ë‚´ë¶€ í¬í•¨ ì¬ê·€ ìˆ˜ì§‘, í¬ì§€ì…”ë„â†’ë„¤ì„ë“œ</p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h1 id="4-ì „ì²´-êµ¬í˜„-ì½”ë“œ-ë³µë¶™í•´ì„œ-vnorm_classespy-ë¡œ-ì €ì¥">4) ì „ì²´ êµ¬í˜„ ì½”ë“œ (ë³µë¶™í•´ì„œ <code class="language-plaintext highlighter-rouge">vnorm_classes.py</code> ë¡œ ì €ì¥)</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># vnorm_classes.py
</span><span class="kn">from</span> <span class="n">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">asdict</span>
<span class="kn">from</span> <span class="n">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="n">json</span>

<span class="kn">from</span> <span class="n">pyverilog.vparser.parser</span> <span class="kn">import</span> <span class="n">parse</span>
<span class="kn">from</span> <span class="n">pyverilog.vparser</span> <span class="kn">import</span> <span class="n">ast</span> <span class="k">as</span> <span class="n">vast</span>
<span class="kn">from</span> <span class="n">pyverilog.ast_code_generator.codegen</span> <span class="kn">import</span> <span class="n">ASTCodeGenerator</span>

<span class="n">codegen</span> <span class="o">=</span> <span class="nc">ASTCodeGenerator</span><span class="p">()</span>

<span class="c1"># -------------------- Typed IR --------------------
</span>
<span class="k">class</span> <span class="nc">Direction</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">INPUT</span> <span class="o">=</span> <span class="sh">"</span><span class="s">input</span><span class="sh">"</span>
    <span class="n">OUTPUT</span> <span class="o">=</span> <span class="sh">"</span><span class="s">output</span><span class="sh">"</span>
    <span class="n">INOUT</span> <span class="o">=</span> <span class="sh">"</span><span class="s">inout</span><span class="sh">"</span>

<span class="k">class</span> <span class="nc">NetKind</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">WIRE</span> <span class="o">=</span> <span class="sh">"</span><span class="s">wire</span><span class="sh">"</span>
    <span class="n">REG</span> <span class="o">=</span> <span class="sh">"</span><span class="s">reg</span><span class="sh">"</span>
    <span class="n">INTEGER</span> <span class="o">=</span> <span class="sh">"</span><span class="s">integer</span><span class="sh">"</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Parameter</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Port</span><span class="p">:</span>
    <span class="n">index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Direction</span><span class="p">]</span>          <span class="c1"># Non-ANSIì—ì„œ ë“œë¬¼ê²Œ ëª»ì°¾ìœ¼ë©´ None
</span>    <span class="n">signed</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">msb_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">lsb_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">msb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">lsb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>              <span class="c1"># msb/lsb ë‘˜ ë‹¤ í‰ê°€ë˜ë©´ abs(msb-lsb)+1
</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Net</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">NetKind</span>
    <span class="n">signed</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">msb_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">lsb_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">msb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">lsb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Connection</span><span class="p">:</span>
    <span class="n">port</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">expr_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Instance</span><span class="p">:</span>
    <span class="n">inst</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">module</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">param_overrides</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">connections</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Connection</span><span class="p">]</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ModuleIR</span><span class="p">:</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">ports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Port</span><span class="p">]</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">nets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Net</span><span class="p">]</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Instance</span><span class="p">]</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># í¸ì˜ ë©”ì„œë“œ
</span>    <span class="k">def</span> <span class="nf">port_by_name</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Port</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">ports</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">p</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">ports_by_dir</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dir_</span><span class="p">:</span> <span class="n">Direction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Port</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">ports</span> <span class="k">if</span> <span class="n">p</span><span class="p">.</span><span class="nb">dir</span> <span class="o">==</span> <span class="n">dir_</span><span class="p">]</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DesignIR</span><span class="p">:</span>
    <span class="n">modules</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ModuleIR</span><span class="p">]</span> <span class="o">=</span> <span class="nf">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="nf">asdict</span><span class="p">(</span><span class="n">self</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>

<span class="c1"># -------------------- Helpers --------------------
</span>
<span class="k">def</span> <span class="nf">to_str</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">codegen</span><span class="p">.</span><span class="nf">visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">int_from_intconst</span><span class="p">(</span><span class="n">intconst</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">intconst</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">_</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="sh">"'"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">int</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">width_base</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"'"</span><span class="p">)</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">lower</span><span class="p">()</span>
        <span class="n">digits</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="sh">'</span><span class="s">d</span><span class="sh">'</span><span class="p">:</span> <span class="k">return</span> <span class="nf">int</span><span class="p">(</span><span class="n">digits</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="sh">'</span><span class="s">h</span><span class="sh">'</span><span class="p">:</span> <span class="k">return</span> <span class="nf">int</span><span class="p">(</span><span class="n">digits</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">:</span> <span class="k">return</span> <span class="nf">int</span><span class="p">(</span><span class="n">digits</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="sh">'</span><span class="s">o</span><span class="sh">'</span><span class="p">:</span> <span class="k">return</span> <span class="nf">int</span><span class="p">(</span><span class="n">digits</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">int</span><span class="p">(</span><span class="n">digits</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">eval_expr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">IntConst</span><span class="p">):</span>
        <span class="k">return</span> <span class="nf">int_from_intconst</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Identifier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">env</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">UnaryOperator</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nf">eval_expr</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="nf">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Uplus</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="o">+</span><span class="n">v</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Uminus</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="o">-</span><span class="n">v</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="sh">"</span><span class="s">Ulnot</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Unot</span><span class="sh">"</span><span class="p">):</span> <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">v</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">BinaryOperator</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nf">eval_expr</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">left</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nf">eval_expr</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">right</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">b</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Plus</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Minus</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Times</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Div</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">//</span> <span class="n">b</span> <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Power</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">**</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Mod</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span> <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Sll</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Srl</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">&gt;&gt;</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">And</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">&amp;</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Or</span><span class="sh">"</span><span class="p">:</span>  <span class="k">return</span> <span class="n">a</span> <span class="o">|</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Xor</span><span class="sh">"</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span> <span class="o">^</span> <span class="n">b</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="c1"># ê¸°íƒ€ ë³µí•©í‘œí˜„(Concat/Repeat/Partselect/Pointer)ì€ í‰ê°€ ë³´ë¥˜
</span>    <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">width_tuple</span><span class="p">(</span><span class="n">width_node</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
    <span class="c1"># (msb_str, lsb_str, msb_val, lsb_val, width_val)
</span>    <span class="k">if</span> <span class="n">width_node</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="n">msb_n</span><span class="p">,</span> <span class="n">lsb_n</span> <span class="o">=</span> <span class="n">width_node</span><span class="p">.</span><span class="n">msb</span><span class="p">,</span> <span class="n">width_node</span><span class="p">.</span><span class="n">lsb</span>
    <span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span> <span class="o">=</span> <span class="nf">to_str</span><span class="p">(</span><span class="n">msb_n</span><span class="p">),</span> <span class="nf">to_str</span><span class="p">(</span><span class="n">lsb_n</span><span class="p">)</span>
    <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span> <span class="o">=</span> <span class="nf">eval_expr</span><span class="p">(</span><span class="n">msb_n</span><span class="p">,</span> <span class="n">env</span><span class="p">),</span> <span class="nf">eval_expr</span><span class="p">(</span><span class="n">lsb_n</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
    <span class="n">width_v</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">msb_v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">lsb_v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">width_v</span> <span class="o">=</span> <span class="nf">abs</span><span class="p">(</span><span class="n">msb_v</span> <span class="o">-</span> <span class="n">lsb_v</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span>

<span class="c1"># -------------------- 1st pass: module tables --------------------
</span>
<span class="k">def</span> <span class="nf">collect_modules</span><span class="p">(</span><span class="n">ast_root</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">ModuleDef</span><span class="p">]:</span>
    <span class="n">mods</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ast_root</span><span class="p">.</span><span class="n">description</span><span class="p">.</span><span class="n">definitions</span><span class="p">:</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">ModuleDef</span><span class="p">):</span>
            <span class="n">mods</span><span class="p">[</span><span class="n">d</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
    <span class="k">return</span> <span class="n">mods</span>

<span class="k">def</span> <span class="nf">collect_param_env</span><span class="p">(</span><span class="n">mod</span><span class="p">:</span> <span class="n">vast</span><span class="p">.</span><span class="n">ModuleDef</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># í—¤ë” íŒŒë¼ë¯¸í„°
</span>    <span class="k">if</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="sh">"</span><span class="s">paramlist</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mod</span><span class="p">.</span><span class="n">paramlist</span><span class="p">.</span><span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Parameter</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nf">eval_expr</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">env</span><span class="p">[</span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="c1"># ë°”ë”” íŒŒë¼ë¯¸í„°
</span>    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="sh">"</span><span class="s">items</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]:</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Decl</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">item</span><span class="p">.</span><span class="nb">list</span><span class="p">:</span>
                <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Parameter</span><span class="p">):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="nf">eval_expr</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">env</span><span class="p">[</span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">env</span>

<span class="k">def</span> <span class="nf">ordered_port_names</span><span class="p">(</span><span class="n">mod</span><span class="p">:</span> <span class="n">vast</span><span class="p">.</span><span class="n">ModuleDef</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">mod</span><span class="p">.</span><span class="n">portlist</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">names</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mod</span><span class="p">.</span><span class="n">portlist</span><span class="p">.</span><span class="n">ports</span><span class="p">:</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Ioport</span><span class="p">):</span>
            <span class="n">names</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Port</span><span class="p">):</span>
            <span class="n">names</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">names</span>

<span class="c1"># -------------------- Decl scans --------------------
</span>
<span class="k">def</span> <span class="nf">build_io_decl_map</span><span class="p">(</span><span class="n">mod</span><span class="p">:</span> <span class="n">vast</span><span class="p">.</span><span class="n">ModuleDef</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
    <span class="c1"># name -&gt; (Direction|None, signed, width_info)
</span>    <span class="n">io_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="sh">"</span><span class="s">items</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Decl</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">item</span><span class="p">.</span><span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="n">vast</span><span class="p">.</span><span class="n">Input</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Output</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Inout</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Input</span><span class="p">):</span>  <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">INPUT</span>
                <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Output</span><span class="p">):</span> <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">OUTPUT</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">INOUT</span>
                <span class="n">signed</span> <span class="o">=</span> <span class="nf">bool</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sh">"</span><span class="s">signed</span><span class="sh">"</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
                <span class="n">w</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sh">"</span><span class="s">width</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span> <span class="o">=</span> <span class="nf">width_tuple</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
                <span class="c1"># e.children() contains Identifiers
</span>                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">e</span><span class="p">.</span><span class="nf">children</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Identifier</span><span class="p">):</span>
                        <span class="n">io_map</span><span class="p">[</span><span class="n">n</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dir_</span><span class="p">,</span> <span class="n">signed</span><span class="p">,</span> <span class="p">(</span><span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">io_map</span>

<span class="k">def</span> <span class="nf">build_net_decl_list</span><span class="p">(</span><span class="n">mod</span><span class="p">:</span> <span class="n">vast</span><span class="p">.</span><span class="n">ModuleDef</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Net</span><span class="p">]:</span>
    <span class="n">nets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Net</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="sh">"</span><span class="s">items</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Decl</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">item</span><span class="p">.</span><span class="nb">list</span><span class="p">:</span>
            <span class="n">kind</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NetKind</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Wire</span><span class="p">):</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">NetKind</span><span class="p">.</span><span class="n">WIRE</span>
            <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Reg</span><span class="p">):</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">NetKind</span><span class="p">.</span><span class="n">REG</span>
            <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Integer</span><span class="p">):</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">NetKind</span><span class="p">.</span><span class="n">INTEGER</span>
            <span class="k">if</span> <span class="n">kind</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">signed</span> <span class="o">=</span> <span class="nf">bool</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sh">"</span><span class="s">signed</span><span class="sh">"</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
            <span class="n">w</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sh">"</span><span class="s">width</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span> <span class="o">=</span> <span class="nf">width_tuple</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">e</span><span class="p">.</span><span class="nf">children</span><span class="p">():</span>
                <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Identifier</span><span class="p">):</span>
                    <span class="n">nets</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Net</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">n</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="n">signed</span><span class="p">,</span>
                        <span class="n">msb_str</span><span class="o">=</span><span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_str</span><span class="o">=</span><span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb</span><span class="o">=</span><span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb</span><span class="o">=</span><span class="n">lsb_v</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width_v</span>
                    <span class="p">))</span>
    <span class="k">return</span> <span class="n">nets</span>

<span class="c1"># -------------------- Instance walker --------------------
</span>
<span class="k">def</span> <span class="nf">iter_instancelists</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">InstanceList</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">node</span>
    <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="sh">"</span><span class="s">children</span><span class="sh">"</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">[])():</span>
        <span class="k">yield</span> <span class="k">from</span> <span class="nf">iter_instancelists</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>

<span class="c1"># -------------------- 2nd pass: normalize module --------------------
</span>
<span class="k">def</span> <span class="nf">normalize_module</span><span class="p">(</span><span class="n">mod</span><span class="p">:</span> <span class="n">vast</span><span class="p">.</span><span class="n">ModuleDef</span><span class="p">,</span> <span class="n">modlib_ports</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">ModuleIR</span><span class="p">:</span>
    <span class="n">env</span> <span class="o">=</span> <span class="nf">collect_param_env</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>

    <span class="c1"># parameters
</span>    <span class="n">params</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="sh">"</span><span class="s">paramlist</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mod</span><span class="p">.</span><span class="n">paramlist</span><span class="p">.</span><span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Parameter</span><span class="p">):</span>
                <span class="n">params</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Parameter</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">value_str</span><span class="o">=</span><span class="nf">to_str</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">value</span><span class="p">),</span>
                    <span class="n">value</span><span class="o">=</span><span class="nf">eval_expr</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">),</span>
                <span class="p">))</span>
    <span class="c1"># body params (dedupe)
</span>    <span class="n">header_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="sh">"</span><span class="s">items</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]:</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Decl</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">item</span><span class="p">.</span><span class="nb">list</span><span class="p">:</span>
                <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Parameter</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="p">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">header_names</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Parameter</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">value_str</span><span class="o">=</span><span class="nf">to_str</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">value</span><span class="p">),</span>
                        <span class="n">value</span><span class="o">=</span><span class="nf">eval_expr</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">),</span>
                    <span class="p">))</span>

    <span class="c1"># ports
</span>    <span class="n">io_map</span> <span class="o">=</span> <span class="nf">build_io_decl_map</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
    <span class="n">ordered_names</span> <span class="o">=</span> <span class="nf">ordered_port_names</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
    <span class="n">ports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Port</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pname</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">ordered_names</span><span class="p">):</span>
        <span class="n">dir_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">signed</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">msb_s</span> <span class="o">=</span> <span class="n">lsb_s</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">msb_v</span> <span class="o">=</span> <span class="n">lsb_v</span> <span class="o">=</span> <span class="n">width_v</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">ansi_hit</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">mod</span><span class="p">.</span><span class="n">portlist</span> <span class="ow">and</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">mod</span><span class="p">.</span><span class="n">portlist</span><span class="p">.</span><span class="n">ports</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">vast</span><span class="p">.</span><span class="n">Ioport</span><span class="p">):</span>
            <span class="n">io</span> <span class="o">=</span> <span class="n">mod</span><span class="p">.</span><span class="n">portlist</span><span class="p">.</span><span class="n">ports</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">decl</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">second</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Input</span><span class="p">):</span>  <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">INPUT</span>
            <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Output</span><span class="p">):</span> <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">OUTPUT</span>
            <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="n">vast</span><span class="p">.</span><span class="n">Inout</span><span class="p">):</span> <span class="n">dir_</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">INOUT</span>
            <span class="n">signed</span> <span class="o">=</span> <span class="nf">bool</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="sh">"</span><span class="s">signed</span><span class="sh">"</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
            <span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span> <span class="o">=</span> <span class="nf">width_tuple</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="sh">"</span><span class="s">width</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="n">env</span><span class="p">)</span>
            <span class="n">ansi_hit</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ansi_hit</span> <span class="ow">and</span> <span class="n">pname</span> <span class="ow">in</span> <span class="n">io_map</span><span class="p">:</span>
            <span class="n">dir_</span><span class="p">,</span> <span class="n">signed</span><span class="p">,</span> <span class="p">(</span><span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span><span class="p">)</span> <span class="o">=</span> <span class="n">io_map</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">msb_s</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">lsb_s</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">msb_v</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">lsb_v</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">width_v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># width unspecified -&gt; 1-bit
</span>            <span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb_v</span><span class="p">,</span> <span class="n">width_v</span> <span class="o">=</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

        <span class="n">ports</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Port</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">pname</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">dir_</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="n">signed</span><span class="p">,</span>
            <span class="n">msb_str</span><span class="o">=</span><span class="n">msb_s</span><span class="p">,</span> <span class="n">lsb_str</span><span class="o">=</span><span class="n">lsb_s</span><span class="p">,</span> <span class="n">msb</span><span class="o">=</span><span class="n">msb_v</span><span class="p">,</span> <span class="n">lsb</span><span class="o">=</span><span class="n">lsb_v</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width_v</span>
        <span class="p">))</span>

    <span class="c1"># nets (exclude top ports)
</span>    <span class="n">nets_raw</span> <span class="o">=</span> <span class="nf">build_net_decl_list</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
    <span class="n">port_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">}</span>
    <span class="n">nets</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nets_raw</span> <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">port_names</span><span class="p">]</span>

    <span class="c1"># instances
</span>    <span class="n">instances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Instance</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">il</span> <span class="ow">in</span> <span class="nf">iter_instancelists</span><span class="p">(</span><span class="n">mod</span><span class="p">):</span>
        <span class="n">submod</span> <span class="o">=</span> <span class="n">il</span><span class="p">.</span><span class="n">module</span>

        <span class="n">shared_param_ovrs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">il</span><span class="p">,</span> <span class="sh">"</span><span class="s">paramlist</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">pa</span> <span class="ow">in</span> <span class="n">il</span><span class="p">.</span><span class="n">paramlist</span><span class="p">.</span><span class="n">params</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">paramname</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="n">value_node</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">argname</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="n">shared_param_ovrs</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Parameter</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">value_str</span><span class="o">=</span><span class="nf">to_str</span><span class="p">(</span><span class="n">value_node</span><span class="p">),</span>
                    <span class="n">value</span><span class="o">=</span><span class="nf">eval_expr</span><span class="p">(</span><span class="n">value_node</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
                <span class="p">))</span>

        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">il</span><span class="p">.</span><span class="n">instances</span><span class="p">:</span>
            <span class="n">conns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Connection</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">portargs</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="sh">"</span><span class="s">portlist</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]</span>
            <span class="n">positional</span> <span class="o">=</span> <span class="nf">any</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">portname</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span> <span class="k">for</span> <span class="n">pa</span> <span class="ow">in</span> <span class="n">portargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">positional</span><span class="p">:</span>
                <span class="n">lib_ports</span> <span class="o">=</span> <span class="n">modlib_ports</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">submod</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pa</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">portargs</span><span class="p">):</span>
                    <span class="n">pname</span> <span class="o">=</span> <span class="n">lib_ports</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">lib_ports</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="sh">"</span><span class="s">__pos</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span>
                    <span class="n">conns</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Connection</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">pname</span><span class="p">,</span> <span class="n">expr_str</span><span class="o">=</span><span class="nf">to_str</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="sh">"</span><span class="s">argname</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">))))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">pa</span> <span class="ow">in</span> <span class="n">portargs</span><span class="p">:</span>
                    <span class="n">conns</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Connection</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">pa</span><span class="p">.</span><span class="n">portname</span><span class="p">,</span> <span class="n">expr_str</span><span class="o">=</span><span class="nf">to_str</span><span class="p">(</span><span class="n">pa</span><span class="p">.</span><span class="n">argname</span><span class="p">)))</span>

            <span class="n">instances</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Instance</span><span class="p">(</span>
                <span class="n">inst</span><span class="o">=</span><span class="n">inst</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="n">submod</span><span class="p">,</span>
                <span class="n">param_overrides</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">shared_param_ovrs</span><span class="p">),</span>
                <span class="n">connections</span><span class="o">=</span><span class="n">conns</span>
            <span class="p">))</span>

    <span class="k">return</span> <span class="nc">ModuleIR</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">ports</span><span class="o">=</span><span class="n">ports</span><span class="p">,</span> <span class="n">nets</span><span class="o">=</span><span class="n">nets</span><span class="p">,</span> <span class="n">instances</span><span class="o">=</span><span class="n">instances</span><span class="p">)</span>

<span class="c1"># -------------------- Public API --------------------
</span>
<span class="k">def</span> <span class="nf">convert_to_design_ir</span><span class="p">(</span><span class="n">files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DesignIR</span><span class="p">:</span>
    <span class="n">ast</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nf">parse</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
    <span class="n">mods</span> <span class="o">=</span> <span class="nf">collect_modules</span><span class="p">(</span><span class="n">ast</span><span class="p">)</span>
    <span class="n">modlib_ports</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="nf">ordered_port_names</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mods</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>
    <span class="n">design</span> <span class="o">=</span> <span class="nc">DesignIR</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mods</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="n">design</span><span class="p">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nf">normalize_module</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">modlib_ports</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">design</span>

<span class="c1"># CLI (optional)
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">argparse</span><span class="p">,</span> <span class="n">sys</span>
    <span class="n">ap</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="nc">ArgumentParser</span><span class="p">()</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">verilog</span><span class="sh">"</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="sh">"</span><span class="s">+</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Verilog sources</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ap</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">-o</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">--out</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Dump as JSON (for debug)</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">ap</span><span class="p">.</span><span class="nf">parse_args</span><span class="p">()</span>
    <span class="n">ir</span> <span class="o">=</span> <span class="nf">convert_to_design_ir</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">verilog</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">out</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">out</span><span class="p">,</span> <span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">ir</span><span class="p">.</span><span class="nf">to_json</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Pretty print summary
</span>        <span class="k">for</span> <span class="n">mname</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">ir</span><span class="p">.</span><span class="n">modules</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[module] </span><span class="si">{</span><span class="n">mname</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">m</span><span class="p">.</span><span class="n">ports</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  port[</span><span class="si">{</span><span class="n">p</span><span class="p">.</span><span class="n">index</span><span class="si">}</span><span class="s">] </span><span class="si">{</span><span class="n">p</span><span class="p">.</span><span class="nb">dir</span> <span class="ow">and</span> <span class="n">p</span><span class="p">.</span><span class="nb">dir</span><span class="p">.</span><span class="n">value</span> <span class="ow">or</span> <span class="sh">'</span><span class="s">None</span><span class="sh">'</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s"> [</span><span class="si">{</span><span class="n">p</span><span class="p">.</span><span class="n">msb_str</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">p</span><span class="p">.</span><span class="n">lsb_str</span><span class="si">}</span><span class="s">] -&gt; width=</span><span class="si">{</span><span class="n">p</span><span class="p">.</span><span class="n">width</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">m</span><span class="p">.</span><span class="n">nets</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  net </span><span class="si">{</span><span class="n">n</span><span class="p">.</span><span class="n">kind</span><span class="p">.</span><span class="n">value</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">n</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s"> [</span><span class="si">{</span><span class="n">n</span><span class="p">.</span><span class="n">msb_str</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">n</span><span class="p">.</span><span class="n">lsb_str</span><span class="si">}</span><span class="s">] -&gt; width=</span><span class="si">{</span><span class="n">n</span><span class="p">.</span><span class="n">width</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m</span><span class="p">.</span><span class="n">instances</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  inst </span><span class="si">{</span><span class="n">i</span><span class="p">.</span><span class="n">inst</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">i</span><span class="p">.</span><span class="n">module</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">i</span><span class="p">.</span><span class="n">connections</span><span class="p">:</span>
                    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">    .</span><span class="si">{</span><span class="n">c</span><span class="p">.</span><span class="n">port</span><span class="si">}</span><span class="s">(</span><span class="si">{</span><span class="n">c</span><span class="p">.</span><span class="n">expr_str</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h1 id="5-ì‚¬ìš©-ì˜ˆì‹œ-step-by-step">5) ì‚¬ìš© ì˜ˆì‹œ (Step-by-step)</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python vnorm_classes.py top.v            <span class="c"># ìš”ì•½ ì¶œë ¥</span>
python vnorm_classes.py top.v <span class="nt">-o</span> ir.json <span class="c"># ë””ë²„ê·¸ìš© JSON ë¤í”„(ì˜µì…˜)</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ë¼ì´ë¸ŒëŸ¬ë¦¬ì²˜ëŸ¼ ì‚¬ìš©
</span><span class="kn">from</span> <span class="n">vnorm_classes</span> <span class="kn">import</span> <span class="n">convert_to_design_ir</span><span class="p">,</span> <span class="n">Direction</span>

<span class="n">ir</span> <span class="o">=</span> <span class="nf">convert_to_design_ir</span><span class="p">([</span><span class="sh">"</span><span class="s">top.v</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">child.v</span><span class="sh">"</span><span class="p">])</span>
<span class="n">top</span> <span class="o">=</span> <span class="n">ir</span><span class="p">.</span><span class="n">modules</span><span class="p">[</span><span class="sh">"</span><span class="s">top</span><span class="sh">"</span><span class="p">]</span>

<span class="c1"># í¬íŠ¸ ìˆœíšŒ
</span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">top</span><span class="p">.</span><span class="n">ports</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="nb">dir</span> <span class="ow">and</span> <span class="n">p</span><span class="p">.</span><span class="nb">dir</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">width</span><span class="p">)</span>

<span class="c1"># ì¸ìŠ¤í„´ìŠ¤/ì—°ê²° ìˆœíšŒ
</span><span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">top</span><span class="p">.</span><span class="n">instances</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">inst</span><span class="sh">"</span><span class="p">,</span> <span class="n">inst</span><span class="p">.</span><span class="n">inst</span><span class="p">,</span> <span class="sh">"</span><span class="s">:</span><span class="sh">"</span><span class="p">,</span> <span class="n">inst</span><span class="p">.</span><span class="n">module</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">inst</span><span class="p">.</span><span class="n">connections</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">  </span><span class="sh">"</span><span class="p">,</span> <span class="n">c</span><span class="p">.</span><span class="n">port</span><span class="p">,</span> <span class="sh">"</span><span class="s">=&gt;</span><span class="sh">"</span><span class="p">,</span> <span class="n">c</span><span class="p">.</span><span class="n">expr_str</span><span class="p">)</span>

<span class="c1"># í•„ìš” ì‹œ JSON ì§ë ¬í™”ë„ ê°€ëŠ¥ (í…ŒìŠ¤íŠ¸/ë¡œê¹…ìš©)
</span><span class="nf">print</span><span class="p">(</span><span class="n">ir</span><span class="p">.</span><span class="nf">to_json</span><span class="p">())</span>
</code></pre></div></div>

<hr />

<h1 id="6-ì£¼ì˜í™•ì¥-step-by-step">6) ì£¼ì˜/í™•ì¥ (Step-by-step)</h1>

<ul>
  <li>
    <p><strong>í‘œí˜„ì‹ í‰ê°€ ì‹¤íŒ¨</strong> : <code class="language-plaintext highlighter-rouge">value/width/msb/lsb</code>ëŠ” <code class="language-plaintext highlighter-rouge">None</code>ì´ ë  ìˆ˜ ìˆìŒ. ì›ë¬¸ì€ <code class="language-plaintext highlighter-rouge">*_str</code>ì— ë³´ì¡´.</p>
  </li>
  <li>
    <p><strong>í¬ì§€ì…”ë„ ì—°ê²°</strong> : ë¼ì´ë¸ŒëŸ¬ë¦¬ì— í•´ë‹¹ ì„œë¸Œëª¨ë“ˆì´ ì—†ìœ¼ë©´ <code class="language-plaintext highlighter-rouge">__pos0</code>ì²˜ëŸ¼ ë³´ì¡´.</p>
  </li>
  <li>
    <p><strong>SystemVerilog í™•ì¥</strong> : <code class="language-plaintext highlighter-rouge">logic</code>, packed/unpacked, interface í¬íŠ¸ ë“±ì€ ë³„ ë ˆì´ì–´ë¡œ í™•ì¥ ì¶”ì²œ.</p>
  </li>
  <li>
    <p><strong>ìœ„ì¹˜ ì •ë³´</strong> : í•„ìš”í•˜ë©´ <code class="language-plaintext highlighter-rouge">lineno/coord</code>ë¥¼ dataclassì— ì¶”ê°€ ê°€ëŠ¥.</p>
  </li>
  <li>
    <p><strong>ê²€ì¦</strong> : í° ì„¤ê³„ì—ì„œ ìŠ¤í‚¤ë§ˆ ë³´ì¥ ì›í•˜ë©´ <code class="language-plaintext highlighter-rouge">pydantic</code>ìœ¼ë¡œ êµì²´ ê°€ëŠ¥.</p>
  </li>
</ul>

<p>ì›í•˜ëŠ” ëŒ€ë¡œ <strong>ì§ì ‘ íƒìƒ‰ ê°€ëŠ¥í•œ Python í´ë˜ìŠ¤ IR</strong> ë¡œ ë³€í™˜ë˜ë„ë¡ êµ¬ì„±í•´ ë‘ì—ˆì–´.<br />
ì›í•˜ë©´ <code class="language-plaintext highlighter-rouge">Connection</code>ì— ì¢Œí‘œ/ì†ŒìŠ¤íŒŒì¼ ì •ë³´ë‚˜, <code class="language-plaintext highlighter-rouge">ModuleIR</code>ì— ë¹ ë¥¸ ì¸ë±ìŠ¤(ì˜ˆ: <code class="language-plaintext highlighter-rouge">port_dict</code>)ë¥¼ ì¶”ê°€í•´ì£¼ëŠ” ìµœì í™” ë²„ì „ë„ ë°”ë¡œ ë§Œë“¤ì–´ì¤„ê²Œ.</p>

<p class="chat--user">

IRì´ ë­ì•¼

</p>

<p>ì¢‹ì€ ì§ˆë¬¸! <strong>IR(Intermediate Representation, ì¤‘ê°„ í‘œí˜„)</strong>ì€ <em>ì†ŒìŠ¤ ì½”ë“œ(ë˜ëŠ” ì„¤ê³„)ë¥¼ í•œì¸µ í‘œì¤€í™”ëœ í˜•íƒœë¡œ ë‹´ì•„ë‘ëŠ” ì¤‘ê°„ ë‹¨ê³„ì˜ ë°ì´í„° êµ¬ì¡°</em> ì˜ˆìš”. íŒŒì„œê°€ ë§Œë“  â€œë¬¸ë²• ê·¸ëŒ€ë¡œâ€ì˜ íŠ¸ë¦¬(AST)ì™€, ê·¸ê±¸ ì¨ì„œ ë¶„ì„Â·ë³€í™˜Â·ì½”ë“œìƒì„± ê°™ì€ í›„ì²˜ë¦¬ ì‚¬ì´ì— ë†“ì…ë‹ˆë‹¤.</p>

<p>ì•„ë˜ì²˜ëŸ¼ <strong>ì°¨ê·¼ì°¨ê·¼</strong> ì´í•´í•˜ë©´ í¸í•´ìš”:</p>

<ol>
  <li>
    <p><strong>ì •ì˜</strong></p>

    <ul>
      <li>IR = ë¶„ì„Â·ìµœì í™”Â·ë³€í™˜ì„ í•˜ê¸° ì‰½ë„ë¡ ë§Œë“  <strong>í‘œì¤€í™”ëœ ë‚´ë¶€ ë°ì´í„° ëª¨ë¸</strong>.</li>
    </ul>
  </li>
  <li>
    <p><strong>ì™œ í•„ìš”í•œê°€</strong></p>

    <ul>
      <li>
        <p>ì–¸ì–´ ë¬¸ë²• ì°¨ì´/ìŠ¤íƒ€ì¼(ì˜ˆ: Verilog ANSI vs Non-ANSI í¬íŠ¸ ì„ ì–¸)ì„ <strong>í•œ ê°€ì§€ ê·œì¹™</strong> ìœ¼ë¡œ í†µì¼.</p>
      </li>
      <li>
        <p><strong>íŠ¸ë˜ë²„ìŠ¤(ìˆœíšŒ) ì‰¬ì›€</strong> : í•„ìš”í•œ ì •ë³´ê°€ ê°™ì€ ìë¦¬/í˜•íƒœì— ìˆìŒ.</p>
      </li>
      <li>
        <p><strong>ëª¨ë“ˆì„±</strong> : í”„ëŸ°íŠ¸ì—”ë“œ(AST)ì™€ ë°±ì—”ë“œ(ë¶„ì„/ìƒì„±)ë¥¼ ëŠìŠ¨í•˜ê²Œ ê²°í•©.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ASTì™€ì˜ ì°¨ì´</strong></p>

    <ul>
      <li>
        <p><strong>AST</strong> : ì›ë¬¸ ë¬¸ë²•ì„ ê±°ì˜ ê·¸ëŒ€ë¡œ ë°˜ì˜(ì¼€ì´ìŠ¤ê°€ ë§ê³  ì˜ˆì™¸ ì²˜ë¦¬ í•„ìš”).</p>
      </li>
      <li>
        <p><strong>IR</strong> : ì˜ë¯¸ ì¤‘ì‹¬ìœ¼ë¡œ <strong>ì •ê·œí™”/ì •ë¦¬</strong>(ì˜ˆ: í¬ì§€ì…”ë„ ì¸ìŠ¤í„´ìŠ¤ â†’ ë„¤ì„ë“œë¡œ ë³€í™˜, í­ ë¯¸ì§€ì •â†’1ë¹„íŠ¸ë¡œ í†µì¼, ìƒìˆ˜ ê°€ëŠ¥í•˜ë©´ í‰ê°€).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ì¼ë°˜ì ì¸ IRì˜ í˜•íƒœ</strong></p>

    <ul>
      <li>
        <p>ì»´íŒŒì¼ëŸ¬: SSA, 3-address code, CFG/DFG ë“±</p>
      </li>
      <li>
        <p>í•˜ë“œì›¨ì–´: <strong>ë„·ë¦¬ìŠ¤íŠ¸-ìœ ì‚¬ êµ¬ì¡°</strong> , íŒŒë¼ë¯¸í„° í‰ê°€ ê²°ê³¼, ëª¨ë“ˆ/ì¸ìŠ¤í„´ìŠ¤/ì—°ê²° ê´€ê³„ ë“±</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ë‹¹ì‹ ì˜ í”„ë¡œì íŠ¸ì—ì„œì˜ IR</strong></p>

    <ul>
      <li>
        <p>ìš°ë¦¬ê°€ ì„¤ê³„í•œ <strong>Python dataclass IR</strong> ì´ ê³§ IR:</p>

        <ul>
          <li>
            <p><code class="language-plaintext highlighter-rouge">ModuleIR</code> ì•ˆì— <code class="language-plaintext highlighter-rouge">ports</code>, <code class="language-plaintext highlighter-rouge">nets</code>, <code class="language-plaintext highlighter-rouge">instances</code>, <code class="language-plaintext highlighter-rouge">parameters</code></p>
          </li>
          <li>
            <p>í¬íŠ¸ ë°©í–¥/í­, ë‚´ë¶€ ë„· í­, ì¸ìŠ¤í„´ìŠ¤ì˜ í¬íŠ¸ ë§¤í•‘ì„ <strong>ì¼ê´€ëœ ìŠ¤í‚¤ë§ˆ</strong> ë¡œ ì œê³µ</p>
          </li>
          <li>
            <p>ê°€ëŠ¥í•œ ë²”ìœ„ì—ì„œ <strong>ì •ìˆ˜ í‰ê°€</strong>(<code class="language-plaintext highlighter-rouge">width</code>, <code class="language-plaintext highlighter-rouge">msb/lsb</code>) ì ìš©, ì‹¤íŒ¨í•´ë„ ì›ë¬¸(<code class="language-plaintext highlighter-rouge">*_str</code>) ë³´ì¡´</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ì–»ëŠ” ì´ì </strong></p>

    <ul>
      <li>
        <p>ì´í›„ ë‹¨ê³„(ì˜ˆ: ì—°ê²° ê²€ì‚¬, ìë™ ë°°ì„ , ë¬¸ì„œí™”, ì½”ë“œ ìƒì„±, ì‹œê°í™”)ë¥¼ <strong>ì˜ˆì™¸ì²˜ë¦¬ ê±°ì˜ ì—†ì´</strong> êµ¬í˜„ ê°€ëŠ¥.</p>
      </li>
      <li>
        <p>ë„êµ¬ ê°„ <strong>ì¬ì‚¬ìš©</strong> Â·í™•ì¥ ìš©ì´.</p>
      </li>
    </ul>
  </li>
</ol>

<p>í•œ ì¤„ ìš”ì•½: <strong>IRì€ â€œë‹¤ë£¨ê¸° ì‰¬ìš´ í‘œì¤€í˜• ì„¤ê³„ ìŠ¤ëƒ…ìƒ·â€</strong>ì´ê³ , ì§€ê¸ˆ ë§Œë“¤ê³  ìˆëŠ” Python í´ë˜ìŠ¤ë“¤ì´ ë°”ë¡œ ê·¸ IRì´ì—ìš”.</p>]]></content><author><name>hvppyarchive</name></author><category term="verilog" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">OpenWebUI ì…‹ì—… ë°©ë²•</title><link href="https://hvppyarchive.github.io/llm/openwebui-serve/" rel="alternate" type="text/html" title="OpenWebUI ì…‹ì—… ë°©ë²•" /><published>2025-08-12T19:21:35+09:00</published><updated>2025-08-12T19:21:35+09:00</updated><id>https://hvppyarchive.github.io/llm/openwebui-serve</id><content type="html" xml:base="https://hvppyarchive.github.io/llm/openwebui-serve/"><![CDATA[<p class="chat--user">

endpoint ì£¼ì†Œë“¤ì„ ì´ë¯¸ ì•Œê³  ìˆì„ ë•Œ ê°œì¸ìš© openwebui ì…‹ì—… í•˜ëŠ” ë²• ì•Œë ¤ì¤˜

</p>

<p>ì¢‹ì•„ìš”. â€œì—”ë“œí¬ì¸íŠ¸ ì£¼ì†ŒëŠ” ì´ë¯¸ ì•Œê³  ìˆë‹¤â€ëŠ” ì „ì œë¡œ, <strong>ë¹ ë¥´ê²Œ ê°œì¸ìš© Open WebUI</strong> ë¥¼ ë„ìš°ê³  ê°ì¢…(OpenAIÂ·OllamaÂ·vLLMÂ·OpenRouter ë“±) <strong>ì»¤ìŠ¤í…€ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë¶™ì´ëŠ” ìµœì†Œ ì…‹ì—…</strong> ì„ stepâ€‘byâ€‘stepìœ¼ë¡œ ì •ë¦¬í•´ë“œë¦´ê²Œìš”.</p>

<hr />

<h1 id="1-ì„¤ì¹˜-ë°©ì‹-ê³ ë¥´ê¸°-docker-ì¶”ì²œ">1) ì„¤ì¹˜ ë°©ì‹ ê³ ë¥´ê¸° (Docker ì¶”ì²œ)</h1>

<p>ê°€ì¥ ê°„ë‹¨í•œ ê±´ Dockerì…ë‹ˆë‹¤. Open WebUI ê³µì‹ í€µìŠ¤íƒ€íŠ¸ë„ Dockerë¥¼ ê¶Œì¥í•´ìš”. <a href="https://docs.openwebui.com/getting-started/quick-start/?utm_source=chatgpt.com">Open WebUI</a></p>

<h3 id="a-docker-compose-ê¶Œì¥">A. Docker Compose (ê¶Œì¥)</h3>

<p>í”„ë¡œì íŠ¸ í´ë”ì—ì„œ ì•„ë˜ íŒŒì¼ì„ ì €ì¥í•˜ì„¸ìš”: <code class="language-plaintext highlighter-rouge">docker-compose.yml</code></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">openwebui</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">ghcr.io/open-webui/open-webui:main</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">openwebui</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3000:8080"</span>          <span class="c1"># ë¸Œë¼ìš°ì € ì ‘ì†ì€ http://localhost:3000</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./openwebui-data:/app/backend/data</span>   <span class="c1"># ì±„íŒ…/ì„¤ì • ì˜ì†í™”</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="c1"># í•„ìš” ì‹œ ê¸°ë³¸ê°’ë§Œìœ¼ë¡œ ì‹œì‘í•˜ê³ , ì´í›„ UIì—ì„œ ì„¸íŒ…í•˜ëŠ” ê²ƒì„ ê¶Œì¥</span>
      <span class="c1"># ìµœì´ˆ ì‹¤í–‰ í›„ ì¼ë¶€ í•­ëª©ì€ 'PersistentConfig'ë¡œ ë‚´ë¶€ì— ì €ì¥ë©ë‹ˆë‹¤.</span>
      <span class="c1"># (ì•„ë˜ 5) ì°¸ê³ )</span>
      <span class="na">WEBUI_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://localhost:3000"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
</code></pre></div></div>

<p>ì‹¤í–‰:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker compose up <span class="nt">-d</span>
</code></pre></div></div>

<h3 id="b-ë‹¨ì¼-ëª…ë ¹ìœ¼ë¡œ-ì‹¤í–‰docker-run">B. ë‹¨ì¼ ëª…ë ¹ìœ¼ë¡œ ì‹¤í–‰(docker run)</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">--name</span> openwebui <span class="se">\</span>
  <span class="nt">-p</span> 3000:8080 <span class="se">\</span>
  <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>/openwebui-data:/app/backend/data <span class="se">\</span>
  ghcr.io/open-webui/open-webui:main
</code></pre></div></div>

<p>ê³µì‹ í€µìŠ¤íƒ€íŠ¸ì˜ ê¸°ë³¸ íë¦„ê³¼ ë™ì¼í•©ë‹ˆë‹¤. <a href="https://docs.openwebui.com/getting-started/quick-start/?utm_source=chatgpt.com">Open WebUI</a></p>

<hr />

<h1 id="2-ìµœì´ˆ-ì ‘ì†">2) ìµœì´ˆ ì ‘ì†</h1>

<p>ë¸Œë¼ìš°ì €ì—ì„œ <code class="language-plaintext highlighter-rouge">http://localhost:3000</code>ìœ¼ë¡œ ë“¤ì–´ê°€ì„¸ìš”. ì´í›„ ê³„ì •/ê´€ë¦¬ì ìƒì„± ì ˆì°¨ëŠ” ê¸°ë³¸ UI íë¦„ì„ ë”°ë¦…ë‹ˆë‹¤(ë¡œê·¸ì¸/íšŒì›ê°€ì… í† ê¸€ ë“±ì€ í™˜ê²½ë³€ìˆ˜ë¡œ ì œì–´ ê°€ëŠ¥). ê´€ë ¨ ì¼ë°˜/ë³´ì•ˆ ë³€ìˆ˜ëŠ” â€œEnvironment Variable Configurationâ€ ë¬¸ì„œì— ì •ë¦¬ë¼ ìˆìŠµë‹ˆë‹¤. <a href="https://docs.openwebui.com/getting-started/env-configuration/">Open WebUI</a></p>

<hr />

<h1 id="3-ëª¨ë¸-ì œê³µìprovider-ì¶”ê°€--ì—”ë“œí¬ì¸íŠ¸-ë¶™ì´ê¸°">3) ëª¨ë¸ ì œê³µì(Provider) ì¶”ê°€ â†’ â€œì—”ë“œí¬ì¸íŠ¸ ë¶™ì´ê¸°â€</h1>

<p>Open WebUIëŠ” <strong>ì—¬ëŸ¬ ê°œì˜ OpenAIâ€‘í˜¸í™˜/ë¡œì»¬ ì—”ì§„ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë™ì‹œì— ë“±ë¡</strong> í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h3 id="a-openaií˜¸í™˜ì˜ˆ-openai-openrouter-vllm-lm-studio-ë“±">A. OpenAIâ€‘í˜¸í™˜(ì˜ˆ: OpenAI, OpenRouter, vLLM, LM Studio ë“±)</h3>

<ol>
  <li>
    <p><strong>Settings â†’ Models â†’ Providers</strong> ë¡œ ì´ë™</p>
  </li>
  <li>
    <p><strong>OpenAI Compatible</strong> ìœ í˜• ì¶”ê°€</p>
  </li>
  <li>
    <p><strong>Base URL</strong>(ì´ë¯¸ ì•Œê³  ê³„ì‹  ì—”ë“œí¬ì¸íŠ¸)ê³¼ <strong>API Key</strong> ì…ë ¥ â†’ ì €ì¥<br />
ê³µì‹ â€œStarting With OpenAIâ€ ê°€ì´ë“œê°€ ì´ ê²½ë¡œë¥¼ ì •í™•íˆ ì•ˆë‚´í•©ë‹ˆë‹¤. <a href="https://docs.openwebui.com/getting-started/quick-start/starting-with-openai/?utm_source=chatgpt.com">Open WebUI</a></p>
  </li>
</ol>

<blockquote>
  <p>íŒ: vLLM/LM Studioì²˜ëŸ¼ OpenAIâ€‘í˜¸í™˜ ì„œë²„ëŠ” ë³´í†µ <code class="language-plaintext highlighter-rouge">http(s)://HOST:PORT/v1</code> í˜•íƒœì˜ Base URLì„ ì”ë‹ˆë‹¤. ëª¨ë¸ ì´ë¦„ì€ í•´ë‹¹ ì„œë²„ì—ì„œ ë…¸ì¶œë˜ëŠ” ì´ë¦„ ê·¸ëŒ€ë¡œ ì ì–´ì•¼ ëª©ë¡ì— ëœ¹ë‹ˆë‹¤(ëª¨ë¸ ë¦¬ìŠ¤íŠ¸ ìºì‹œ TTLë„ ì¡°ì • ê°€ëŠ¥). <a href="https://docs.openwebui.com/getting-started/env-configuration/">Open WebUI</a></p>
</blockquote>

<h3 id="b-ollamaë¡œì»¬-ì‚¬ìš©-ì‹œ">B. Ollama(ë¡œì»¬) ì‚¬ìš© ì‹œ</h3>

<p>ë°©ë²• 2ê°€ì§€ ì¤‘ í¸í•œ ìª½ìœ¼ë¡œ:</p>

<ul>
  <li>
    <p><strong>UIì—ì„œ</strong> Providerë¡œ â€œOllamaâ€ ì¶”ê°€ í›„ <strong>Base URL</strong>(ì˜ˆ: <code class="language-plaintext highlighter-rouge">http://&lt;ì„œë²„IP&gt;:11434</code>) ì§€ì •</p>
  </li>
  <li>
    <p><strong>í™˜ê²½ë³€ìˆ˜ë¡œ</strong> ë¯¸ë¦¬ ë„˜ê¸°ê¸°: <code class="language-plaintext highlighter-rouge">OLLAMA_BASE_URL=http://&lt;ì„œë²„IP&gt;:11434</code><br />
ê³µì‹ Ollama ì—°ë™ ê°€ì´ë“œ ì°¸ì¡°. <a href="https://docs.openwebui.com/getting-started/quick-start/starting-with-ollama/?utm_source=chatgpt.com">Open WebUI</a></p>
  </li>
</ul>

<blockquote>
  <p>ì£¼ì˜: Dockerë¡œ ë¶„ë¦¬ ë°°ì¹˜í–ˆë‹¤ë©´ <code class="language-plaintext highlighter-rouge">127.0.0.1</code> ëŒ€ì‹  <strong>ì»¨í…Œì´ë„ˆì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ ì£¼ì†Œ</strong>(ì˜ˆ: ë¸Œë¦¬ì§€ ë„¤íŠ¸ì›Œí¬ì˜ ì„œë¹„ìŠ¤ëª… ë˜ëŠ” í˜¸ìŠ¤íŠ¸ IP)ë¥¼ ì¨ì•¼ í•©ë‹ˆë‹¤. ëª¨ë¸ ë¦¬ìŠ¤íŠ¸ íƒ€ì„ì•„ì›ƒ/ìºì‹œëŠ” <code class="language-plaintext highlighter-rouge">AIOHTTP_CLIENT_TIMEOUT_*</code>, <code class="language-plaintext highlighter-rouge">MODELS_CACHE_TTL</code>ë¡œ ì¡°ì ˆ ê°€ëŠ¥í•©ë‹ˆë‹¤. <a href="https://docs.openwebui.com/getting-started/env-configuration/">Open WebUI</a></p>
</blockquote>

<hr />

<h1 id="4-ì„ íƒ-ì¸ì¦ì‹±ê¸€ìœ ì €ë„ë©”ì¸-ì„¤ì •">4) (ì„ íƒ) ì¸ì¦/ì‹±ê¸€ìœ ì €/ë„ë©”ì¸ ì„¤ì •</h1>

<ul>
  <li>
    <p><strong>WEBUI_URL</strong> : OAuth/SSO ë“±ì„ ì“¸ ê³„íšì´ë©´ <strong>ë„ë©”ì¸ìœ¼ë¡œ ë¯¸ë¦¬</strong> ì§€ì •í•˜ì„¸ìš”(ì¤‘ìš”). <a href="https://docs.openwebui.com/getting-started/env-configuration/">Open WebUI</a></p>
  </li>
  <li>
    <p>íšŒì›ê°€ì…/ë¡œê·¸ì¸ í¼ í‘œì‹œ, ê¸°ë³¸ ì—­í•  ë“±ì€ <code class="language-plaintext highlighter-rouge">ENABLE_SIGNUP</code>, <code class="language-plaintext highlighter-rouge">ENABLE_LOGIN_FORM</code>, <code class="language-plaintext highlighter-rouge">DEFAULT_USER_ROLE</code> ë“±ìœ¼ë¡œ ì œì–´í•©ë‹ˆë‹¤. <a href="https://docs.openwebui.com/getting-started/env-configuration/">Open WebUI</a></p>
  </li>
</ul>

<hr />

<h1 id="5-í™˜ê²½ë³€ìˆ˜ì™€-persistentconfig-ë™ì‘-ì´í•´ì¤‘ìš”">5) í™˜ê²½ë³€ìˆ˜ì™€ â€œPersistentConfigâ€ ë™ì‘ ì´í•´(ì¤‘ìš”)</h1>

<p>Open WebUIëŠ” <strong>ìµœì´ˆ ê¸°ë™ ì‹œì </strong> ì— ì¼ë¶€ ì„¤ì •(â€˜PersistentConfigâ€™ í‘œì‹œëœ í•­ëª©)ì„ <strong>ë‚´ë¶€ DBì— ì˜êµ¬ ì €ì¥</strong> í•©ë‹ˆë‹¤. ê·¸ ë’¤ì—ëŠ” ê°™ì€ í™˜ê²½ë³€ìˆ˜ë¥¼ ë°”ê¿”ë„ ë‚´ë¶€ ì €ì¥ê°’ì´ ìš°ì„ ë©ë‹ˆë‹¤. í•„ìš”í•˜ë©´ <code class="language-plaintext highlighter-rouge">ENABLE_PERSISTENT_CONFIG=False</code>ë¡œ ë¹„í™œì„±í™”í•˜ê±°ë‚˜, <strong>ê´€ë¦¬ì UIì—ì„œ ê°’ì„ ë³€ê²½</strong> í•˜ì„¸ìš”. <a href="https://docs.openwebui.com/getting-started/env-configuration/">Open WebUI</a></p>

<hr />

<h1 id="6-ì„ íƒ-ì™¸ë¶€-ë…¸ì¶œhttps-traefik-ì˜ˆì‹œ">6) (ì„ íƒ) ì™¸ë¶€ ë…¸ì¶œ/HTTPS (Traefik ì˜ˆì‹œ)</h1>

<p>ì—¬ëŸ¬ ì„œë¹„ìŠ¤ì™€ í•¨ê»˜ ì“°ê±°ë‚˜ Letâ€™s Encryptë¡œ ìë™ HTTPSë¥¼ ì›í•˜ë©´ Traefikì„ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œë¡œ ë‘ë©´ í¸í•©ë‹ˆë‹¤. Compose ì˜ˆì œì™€ ê¸°ë³¸ êµ¬ì„± íë¦„ì€ Traefik ë¬¸ì„œì— ì˜ ì •ë¦¬ë¼ ìˆì–´ìš”. <a href="https://doc.traefik.io/traefik/user-guides/docker-compose/basic-example/?utm_source=chatgpt.com">doc.traefik.io+1</a></p>

<hr />

<h1 id="7-ì—…ë°ì´íŠ¸ë°±ì—…">7) ì—…ë°ì´íŠ¸/ë°±ì—…</h1>

<ul>
  <li>
    <p><strong>ë°ì´í„° ê²½ë¡œ</strong> : <code class="language-plaintext highlighter-rouge">./openwebui-data</code> ë³¼ë¥¨ì— ì±„íŒ…/ì„¤ì •ì´ ì €ì¥ë©ë‹ˆë‹¤(Compose ì˜ˆì œ ê¸°ì¤€).</p>
  </li>
  <li>
    <p>ì—…ë°ì´íŠ¸ëŠ” ì´ë¯¸ì§€ ì¬í’€/ì¬ì‹œì‘ìœ¼ë¡œ ì¶©ë¶„í•©ë‹ˆë‹¤. ì„¤ì • í•­ëª© ëŒ€ë¶€ë¶„ì€ ìœ„ <strong>PersistentConfig ê·œì¹™</strong> ì„ ë”°ë¦…ë‹ˆë‹¤. <a href="https://docs.openwebui.com/getting-started/env-configuration/">Open WebUI</a></p>
  </li>
</ul>

<hr />

<h2 id="ìì£¼-ë§‰íˆëŠ”-í¬ì¸íŠ¸ì§§ê²Œ">ìì£¼ ë§‰íˆëŠ” í¬ì¸íŠ¸(ì§§ê²Œ)</h2>

<ul>
  <li>
    <p><strong>ëª¨ë¸ì´ ì•ˆ ë³´ì„</strong> : Base URL/í‚¤ê°€ ë§ëŠ”ì§€, ì»¨í…Œì´ë„ˆ ê°„ ë„¤íŠ¸ì›Œí¬ ê²½ë¡œê°€ ë§ëŠ”ì§€ í™•ì¸. ëª¨ë¸ë¦¬ìŠ¤íŠ¸ ìºì‹œ/íƒ€ì„ì•„ì›ƒ ì¡°ì •. <a href="https://docs.openwebui.com/getting-started/env-configuration/">Open WebUI</a></p>
  </li>
  <li>
    <p><strong>ë¡œì»¬ Ollama ì—°ê²°</strong> : Docker ë¶„ë¦¬ ë°°ì¹˜ ì‹œ <code class="language-plaintext highlighter-rouge">localhost</code> ëŒ€ì‹  <strong>í˜¸ìŠ¤íŠ¸ IP</strong> ë˜ëŠ” <strong>ë„ì»¤ ë„¤íŠ¸ì›Œí¬ì˜ ì„œë¹„ìŠ¤ëª…</strong> ì‚¬ìš©. <a href="https://docs.openwebui.com/getting-started/quick-start/starting-with-ollama/?utm_source=chatgpt.com">Open WebUI</a></p>
  </li>
</ul>

<hr />

<p>í•„ìš”í•˜ì‹œë©´ <strong>í˜„ì¬ ê°€ì§€ê³  ê³„ì‹  ì—”ë“œí¬ì¸íŠ¸(Base URL/í‚¤/ëª¨ë¸ëª…) ì¡°í•©</strong> ì— ë§ì¶° <code class="language-plaintext highlighter-rouge">docker-compose.yml</code>ì„ ë°”ë¡œ ë§ì¶¤ ìƒì„±í•´ ë“œë¦´ê²Œìš”.</p>

<p class="chat--user">

pip ì„¤ì¹˜ ë°©ì‹ìœ¼ë¡œ ê°€ì´ë“œí•´ì¤˜

</p>

<p>ì¢‹ìŠµë‹ˆë‹¤. pip ê¸°ë°˜ìœ¼ë¡œ Open WebUIë¥¼ ì„¤ì¹˜í•˜ê³ , ì´ë¯¸ ì•Œê³  ê³„ì‹  ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë¶™ì´ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì •ë¦¬í•´ë“œë¦´ê²Œìš”.</p>

<hr />

<h2 id="1-python-í™˜ê²½-ì¤€ë¹„">1) Python í™˜ê²½ ì¤€ë¹„</h2>

<ul>
  <li><strong>Python 3.10 ì´ìƒ</strong> ì´ í•„ìš”í•©ë‹ˆë‹¤. (venv ê¶Œì¥)</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-m</span> venv .venv
<span class="nb">source</span> .venv/bin/activate
pip <span class="nb">install</span> <span class="nt">--upgrade</span> pip
</code></pre></div></div>

<hr />

<h2 id="2-open-webui-ì„¤ì¹˜">2) Open WebUI ì„¤ì¹˜</h2>

<p>ê³µì‹ ì €ì¥ì†Œì—ì„œ PyPI ë°°í¬ ë²„ì „ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>open-webui
</code></pre></div></div>

<p>ì„¤ì¹˜ í›„, CLI ëª…ë ¹ì–´ <code class="language-plaintext highlighter-rouge">open-webui</code>ê°€ ë“±ë¡ë©ë‹ˆë‹¤.</p>

<hr />

<h2 id="3-ì‹¤í–‰">3) ì‹¤í–‰</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>open-webui serve
</code></pre></div></div>

<p>ê¸°ë³¸ì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">http://127.0.0.1:8080</code>ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.<br />
ì›í•œë‹¤ë©´ í¬íŠ¸ ë³€ê²½:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>open-webui serve <span class="nt">--port</span> 3000
</code></pre></div></div>

<hr />

<h2 id="4-ìµœì´ˆ-ì ‘ì†--ê´€ë¦¬ì-ê³„ì •-ìƒì„±">4) ìµœì´ˆ ì ‘ì† &amp; ê´€ë¦¬ì ê³„ì • ìƒì„±</h2>

<p>ë¸Œë¼ìš°ì €ì—ì„œ <code class="language-plaintext highlighter-rouge">http://localhost:3000</code> â†’ ì²« ë¡œê·¸ì¸ ì‹œ ê´€ë¦¬ì ê³„ì •ì„ ë§Œë“­ë‹ˆë‹¤.</p>

<hr />

<h2 id="5-ì—”ë“œí¬ì¸íŠ¸-ë“±ë¡-openai-í˜¸í™˜--ollama-ë“±">5) ì—”ë“œí¬ì¸íŠ¸ ë“±ë¡ (OpenAI í˜¸í™˜ / Ollama ë“±)</h2>

<h3 id="a-uiì—ì„œ-ì„¤ì •">A. UIì—ì„œ ì„¤ì •</h3>

<ol>
  <li>
    <p><strong>Settings â†’ Models â†’ Providers</strong></p>
  </li>
  <li>
    <p><strong>Add Provider</strong> â†’ "OpenAI Compatible" ì„ íƒ</p>
  </li>
  <li>
    <p><strong>Base URL</strong> : ì•Œê³  ê³„ì‹  ì—”ë“œí¬ì¸íŠ¸ ì£¼ì†Œ ì…ë ¥</p>
  </li>
  <li>
    <p><strong>API Key</strong> : í•´ë‹¹ ì„œë¹„ìŠ¤ì˜ í‚¤ ì…ë ¥</p>
  </li>
  <li>
    <p>ì €ì¥ í›„ ëª¨ë¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì™€ ì„ íƒ</p>
  </li>
</ol>

<blockquote>
  <p>vLLM/LM Studioì˜ ê²½ìš° Base URLì´ <code class="language-plaintext highlighter-rouge">http://HOST:PORT/v1</code> í˜•ì‹ì¸ ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.</p>
</blockquote>

<hr />

<h3 id="b-í™˜ê²½ë³€ìˆ˜ë¡œ-ë¯¸ë¦¬-ì„¸íŒ…-ì„ íƒ">B. í™˜ê²½ë³€ìˆ˜ë¡œ ë¯¸ë¦¬ ì„¸íŒ… (ì„ íƒ)</h3>

<p>ì‹¤í–‰ ì „ì— ì•„ë˜ ì˜ˆì‹œì²˜ëŸ¼ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ë©´ UIì—ì„œ ìë™ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">OPENAI_API_BASE_URL</span><span class="o">=</span><span class="s2">"https://your-endpoint.example.com/v1"</span>
<span class="nb">export </span><span class="nv">OPENAI_API_KEY</span><span class="o">=</span><span class="s2">"sk-xxxxxxxxxxxxxxxx"</span>
open-webui serve
</code></pre></div></div>

<p>Ollama ì‚¬ìš© ì‹œ:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">OLLAMA_BASE_URL</span><span class="o">=</span><span class="s2">"http://localhost:11434"</span>
</code></pre></div></div>

<hr />

<h2 id="6-ë°ì´í„°-ì˜ì†í™”">6) ë°ì´í„° ì˜ì†í™”</h2>

<p>pip ì‹¤í–‰ì€ ê¸°ë³¸ì ìœ¼ë¡œ í˜„ì¬ ë””ë ‰í„°ë¦¬ì˜ <code class="language-plaintext highlighter-rouge">.open-webui</code> í´ë”ì— ë°ì´í„°(ì±„íŒ… ê¸°ë¡, ì„¤ì •)ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.</p>

<ul>
  <li>ë‹¤ë¥¸ ìœ„ì¹˜ì— ì €ì¥í•˜ë ¤ë©´:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>open-webui serve <span class="nt">--data-dir</span> /path/to/data
</code></pre></div></div>

<hr />

<h2 id="7-ì„ íƒ-https--ì™¸ë¶€-ì ‘ê·¼">7) (ì„ íƒ) HTTPS &amp; ì™¸ë¶€ ì ‘ê·¼</h2>

<ul>
  <li>
    <p>ë¡œì»¬ì—ì„œë§Œ ì“°ëŠ” ê²½ìš° ë¬´ê´€í•˜ì§€ë§Œ, ì™¸ë¶€ ì ‘ê·¼ ì‹œ <strong>ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ(Nginx/Traefik)</strong> + HTTPS ì ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ë„ë©”ì¸ ê¸°ë°˜ ì ‘ê·¼ ì‹œ <code class="language-plaintext highlighter-rouge">WEBUI_URL</code> í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¸íŒ…í•˜ë©´ OAuth/SSO ì—°ë™ ì‹œ í¸í•©ë‹ˆë‹¤.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">WEBUI_URL</span><span class="o">=</span><span class="s2">"https://chat.example.com"</span>
</code></pre></div></div>

<hr />

<h2 id="8-ì—…ë°ì´íŠ¸">8) ì—…ë°ì´íŠ¸</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install</span> <span class="nt">--upgrade</span> open-webui
</code></pre></div></div>

<hr />

<p>ì›í•˜ì‹œë©´ ì œê°€ <strong>pip ì„¤ì¹˜ìš© + í™˜ê²½ë³€ìˆ˜ ì—”ë“œí¬ì¸íŠ¸ ìë™ ì„¸íŒ…ì´ í¬í•¨ëœ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸</strong> ë¥¼ ë§Œë“¤ì–´ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br />
ê·¸ë ‡ê²Œ í•˜ë©´ ë§¤ë²ˆ UIì—ì„œ ì…ë ¥í•  í•„ìš” ì—†ì´ ì—”ë“œí¬ì¸íŠ¸ì™€ í‚¤ê°€ ìë™ ë“±ë¡ëœ ìƒíƒœë¡œ Open WebUIê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>

<p class="chat--user">

Your system has an unsupported version of sqlite3. Chroma requires sqlite3 &gt;= 3.35.0

</p>

<p>ì´ ì˜¤ë¥˜ëŠ” Open WebUIê°€ ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ëŠ” <strong>Chroma DB</strong> ê°€ ìµœì‹  SQLite ê¸°ëŠ¥(3.35.0 ì´ìƒ)ì„ ìš”êµ¬í•˜ëŠ”ë°,<br />
í˜„ì¬ OSì— ì„¤ì¹˜ëœ Pythonì´ <strong>ë„ˆë¬´ êµ¬ë²„ì „ SQLite</strong> ë¥¼ ë‚´ì¥í•˜ê³  ìˆì–´ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">pip install</code>ë¡œ ì„¤ì¹˜í–ˆì„ ë•Œ Pythonì€ <strong>ë‚´ì¥ëœ sqlite3 ë¼ì´ë¸ŒëŸ¬ë¦¬</strong> ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ, OSì— sqlite3ì„ ìƒˆë¡œ ê¹”ì•„ë„ Pythonì´ ê·¸ê±¸ ìë™ìœ¼ë¡œ ì“°ì§€ ì•ŠìŠµë‹ˆë‹¤.<br />
í•´ê²° ë°©ë²•ì€ í¬ê²Œ ë‘ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.</p>

<hr />

<h2 id="1-python-ìì²´ë¥¼-ìµœì‹ -ë¹Œë“œë¡œ-êµì²´-ê¶Œì¥">1) Python ìì²´ë¥¼ ìµœì‹  ë¹Œë“œë¡œ êµì²´ (ê¶Œì¥)</h2>

<p>ê°€ì¥ ê¹”ë”í•œ ë°©ë²•ì…ë‹ˆë‹¤. Python 3.10+ ìµœì‹  ë¹Œë“œëŠ” sqlite3 3.35.0 ì´ìƒì„ í¬í•¨í•©ë‹ˆë‹¤.</p>

<p><strong>Ubuntu/Debian ì˜ˆì‹œ</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>python3.11 python3.11-venv python3.11-dev
</code></pre></div></div>

<p>ê·¸ë¦¬ê³  ìƒˆ venvì—ì„œ ë‹¤ì‹œ ì„¤ì¹˜:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3.11 <span class="nt">-m</span> venv .venv
<span class="nb">source</span> .venv/bin/activate
pip <span class="nb">install</span> <span class="nt">--upgrade</span> pip
pip <span class="nb">install </span>open-webui
</code></pre></div></div>

<p><strong>macOS(Homebrew) ì˜ˆì‹œ</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>python@3.11
brew <span class="nb">link </span>python@3.11 <span class="nt">--force</span>
</code></pre></div></div>

<hr />

<h2 id="2-osì—-ìµœì‹ -sqlite3-ì„¤ì¹˜-í›„-python-ì¬ë¹Œë“œ">2) OSì— ìµœì‹  sqlite3 ì„¤ì¹˜ í›„ Python ì¬ë¹Œë“œ</h2>

<p>ë§Œì•½ Python ë²„ì „ì„ ê·¸ëŒ€ë¡œ ì“°ê³  ì‹¶ë‹¤ë©´:</p>

<ol>
  <li>
    <p>ìµœì‹  sqlite3 ì„¤ì¹˜</p>

    <ul>
      <li>Ubuntu/Debian:
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>sqlite3 libsqlite3-dev
</code></pre></div>        </div>
      </li>
      <li>macOS:
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>sqlite
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>Pythonì„ ì¬ë¹Œë“œí•˜ì—¬ ìƒˆ sqlite3ì„ ë§í¬<br />
(ì†ŒìŠ¤ ë¹Œë“œ ì‹œ <code class="language-plaintext highlighter-rouge">libsqlite3-dev</code>ë¥¼ ì„¤ì¹˜í•œ ìƒíƒœì—¬ì•¼ í•¨)</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pyenv <span class="nb">install </span>3.11.9
pyenv global 3.11.9
</code></pre></div>    </div>
  </li>
</ol>

<hr />

<h2 id="3-conda-í™˜ê²½ì„-ì´ìš©-ê°„ë‹¨-ëŒ€ì•ˆ">3) conda í™˜ê²½ì„ ì´ìš© (ê°„ë‹¨ ëŒ€ì•ˆ)</h2>

<p>condaëŠ” ìµœì‹  sqliteë¥¼ ìë™ í¬í•¨í•˜ë¯€ë¡œ, ì„¤ì¹˜ê°€ ê°„ë‹¨í•©ë‹ˆë‹¤.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda create <span class="nt">-n</span> openwebui <span class="nv">python</span><span class="o">=</span>3.11
conda activate openwebui
pip <span class="nb">install </span>open-webui
</code></pre></div></div>

<hr />

<p>ğŸ’¡ <strong>ì¶”ì²œ ìˆœì„œ</strong></p>

<ol>
  <li>
    <p>ê°€ëŠ¥í•˜ë©´ Pythonì„ ìµœì‹ ìœ¼ë¡œ ê°ˆì•„íƒ€ì„¸ìš”(ë°©ë²• 1).</p>
  </li>
  <li>
    <p>OS-level sqliteë§Œ ì—…ë°ì´íŠ¸í•´ì„  í•´ê²° ì•ˆ ë˜ë‹ˆ, Python ì¬ì„¤ì¹˜/ì¬ë¹Œë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ë³µì¡í•˜ë©´ condaë¡œ í™˜ê²½ ë§Œë“œëŠ” ê²Œ ì œì¼ ë¹ ë¦…ë‹ˆë‹¤.</p>
  </li>
</ol>

<hr />

<p>ì›í•˜ì‹œë©´ ì œê°€ <strong>í˜„ì¬ OS/Python ë²„ì „ê³¼ sqlite ë²„ì „ í™•ì¸ ëª…ë ¹</strong> ì„ ë“œë ¤ì„œ<br />
ì§€ê¸ˆ í™˜ê²½ì—ì„œ ì–´ë–¤ ê²½ë¡œê°€ ì œì¼ ë¹ ë¥¸ì§€ ë°”ë¡œ íŒë‹¨í•´ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br />
ê·¸ê±¸ í•´ë“œë¦´ê¹Œìš”?</p>

<p class="chat--user">

í˜„ì¬ ì„¤ì¹˜ëœ sqlite3 ë²„ì „ ë³´ëŠ” ë²• ì•Œë ¤ì¤˜. ë‚´ê°€ ì„¤ì¹˜í•œ íŒŒì´ì¬ì´ 3.11.12 ë¼ì„œ ìƒë‹¹íˆ ìµœì‹  ë²„ì „ì¸ë°. venvë¡œ ê°€ìƒí™˜ê²½ ë§Œë“¤ì–´ì„œ í•˜ê³  ìˆëŠ”ë° ì´ê²Œ ì´ìŠˆê°€ ë  ìˆ˜ë„ ìˆë‚˜?

</p>

<p>ë„¤, Python 3.11.12ë©´ ìƒë‹¹íˆ ìµœì‹ ì´ì§€ë§Œ,<br />
<strong>venv í™˜ê²½ ì•ˆì—ì„œë„ Pythonì´ ë¹Œë“œë  ë•Œ í¬í•¨ëœ SQLite ë²„ì „</strong> ì„ ê·¸ëŒ€ë¡œ ì“°ê¸° ë•Œë¬¸ì—,<br />
OSì˜ sqlite ë²„ì „ê³¼ëŠ” ë³„ê°œë¡œ ë¬¸ì œê°€ ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>í™•ì¸ ë°©ë²•ì€ ë‘ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.</p>

<hr />

<h2 id="1-pythonì´-ì“°ëŠ”-sqlite3-ë²„ì „-í™•ì¸">1) Pythonì´ ì“°ëŠ” sqlite3 ë²„ì „ í™•ì¸</h2>

<p>ê°€ìƒí™˜ê²½ ì•ˆì—ì„œ ì•„ë˜ ëª…ë ¹ ì‹¤í–‰:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-c</span> <span class="s2">"import sqlite3; print(sqlite3.sqlite_version)"</span>
</code></pre></div></div>

<p>ì´ ê°’ì´ <strong>3.35.0 ì´ìƒ</strong> ì´ì–´ì•¼ Chromaê°€ ë™ì‘í•©ë‹ˆë‹¤.</p>

<hr />

<h2 id="2-os-ì‹œìŠ¤í…œ-sqlite-ë²„ì „-í™•ì¸-ì°¸ê³ ">2) OS ì‹œìŠ¤í…œ sqlite ë²„ì „ í™•ì¸ (ì°¸ê³ )</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlite3 <span class="nt">--version</span>
</code></pre></div></div>

<p>ì´ê±´ OSì— ì„¤ì¹˜ëœ <code class="language-plaintext highlighter-rouge">sqlite3</code> CLI ë²„ì „ì…ë‹ˆë‹¤.<br />
Python ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<hr />

<p>ğŸ’¡ <strong>ì¤‘ìš” í¬ì¸íŠ¸</strong></p>

<ul>
  <li>
    <p>venvëŠ” <strong>í˜„ì¬ Python ì‹¤í–‰ íŒŒì¼</strong> ê³¼ ê·¸ì— ë‚´ì¥ëœ sqlite3ë¥¼ ê·¸ëŒ€ë¡œ ë³µì‚¬í•´ì„œ ì”ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ë”°ë¼ì„œ Python 3.11ì´ë¼ë„, í•´ë‹¹ Pythonì´ êµ¬ë²„ì „ sqliteë¡œ ë¹Œë“œë˜ì—ˆìœ¼ë©´ venv ì•ˆì—ì„œë„ ê·¸ëŒ€ë¡œ êµ¬ë²„ì „ì„ ì”ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>í•´ê²°í•˜ë ¤ë©´ ìµœì‹  sqliteë¡œ ë¹Œë“œëœ Pythonì„ ì“°ê±°ë‚˜(ì˜ˆ: pyenv, conda), ì‹œìŠ¤í…œ Pythonì„ êµì²´í•´ì•¼ í•©ë‹ˆë‹¤.</p>
  </li>
</ul>

<hr />

<p>ì›í•˜ì‹œë©´ ì œê°€ <strong>í˜„ì¬ venvì—ì„œ ë™ì‘í•˜ëŠ” sqlite ë²„ì „ í™•ì¸ í›„, ë°”ë¡œ ì—…ê·¸ë ˆì´ë“œ ë°©ë²•</strong> ê¹Œì§€ ì´ì–´ì„œ ì •ë¦¬í•´ ë“œë¦´ê¹Œìš”?<br />
ê·¸ëŸ¬ë©´ ë°”ë¡œ Chroma ì˜¤ë¥˜ë„ í•´ê²°ë©ë‹ˆë‹¤.</p>

<p class="chat--user">

ê·¸ë ‡ë„¤ ë‘˜ ë‹¤ 3.26.0 ìœ¼ë¡œ ë˜ê³  ìˆì–´. ë‚´ê°€ sudo ê¶Œí•œë„ ì—†ê³  ì¸í„°ë„· ì—°ê²°ë„ ì•ˆ ëœ redhat 8.x OSì•¼. ì´ê±°ì— ë§ì¶°ì„œ sqlite3 ì„¤ì¹˜í•˜ê³  íŒŒì´ì¬ 3.11 ë²„ì „ ë‹¤ì‹œ ë¹Œë“œ í•˜ëŠ” ë°©ë²• ì°¨ê·¼ì°¨ê·¼ ì•Œë ¤ì¤˜

</p>

<p>ì¢‹ì•„ìš”â€”<strong>sudo ì—†ìŒ + ì™¸ë¶€ ì¸í„°ë„· ì—†ìŒ + RHEL 8.x</strong> í™˜ê²½ì„ ì „ì œë¡œ, <strong>ì‚¬ìš©ì í™ˆ ë””ë ‰í„°ë¦¬</strong> ì— ìµœì‹  sqlite3ë¥¼ ì†ŒìŠ¤ì—ì„œ ì„¤ì¹˜í•˜ê³ , ê·¸ê±¸ ë§í¬í•´ì„œ <strong>Python 3.11ì„ ë‹¤ì‹œ ë¹Œë“œ</strong> í•˜ëŠ” ì ˆì°¨ë¥¼ <strong>ì™„ì „ ì˜¤í”„ë¼ì¸</strong> ê¸°ì¤€ìœ¼ë¡œ ì°¨ê·¼ì°¨ê·¼ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.<br />
(í•µì‹¬ì€: Pythonì´ ë§í¬í•˜ëŠ” sqliteë¥¼ 3.35.0 ì´ìƒìœ¼ë¡œ êµì²´í•˜ëŠ” ê²ƒ!)</p>

<hr />

<h1 id="ì „ì²´-íë¦„-í•œëˆˆì—">ì „ì²´ íë¦„ í•œëˆˆì—</h1>

<ol>
  <li>
    <p>ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ ê°€ëŠ¥í•œ PCì—ì„œ <strong>ì†ŒìŠ¤ tar.gz</strong> ë°›ì•„ì˜¤ê¸° â†’ ì‚¬ë‚´ë§/USBë¡œ ì„œë²„ì— ë³µì‚¬</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">$HOME/opt/sqlite-&lt;ë²„ì „&gt;</code>ì— sqlite3 ì„¤ì¹˜ (ì‚¬ìš©ì ê¶Œí•œ)</p>
  </li>
  <li>
    <p>ê·¸ sqliteë¥¼ ê°€ë¦¬í‚¤ë„ë¡ <strong>í™˜ê²½ë³€ìˆ˜(í—¤ë”/ë¼ì´ë¸ŒëŸ¬ë¦¬ ê²½ë¡œ)</strong> ì¡ê³  Python 3.11.12ë¥¼ <strong>ì¬ë¹Œë“œ + ì‚¬ìš©ì ê²½ë¡œì— ì„¤ì¹˜</strong></p>
  </li>
  <li>
    <p>ìƒˆ Pythonìœ¼ë¡œ venv ë‹¤ì‹œ ë§Œë“¤ê³ , <code class="language-plaintext highlighter-rouge">python -c "import sqlite3; print(sqlite3.sqlite_version)"</code>ê°€ <strong>3.35+</strong>ì¸ì§€ í™•ì¸</p>
  </li>
</ol>

<hr />

<h1 id="0-ì¤€ë¹„-ë””ë ‰í„°ë¦¬ë³€ìˆ˜">0) ì¤€ë¹„: ë””ë ‰í„°ë¦¬/ë³€ìˆ˜</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í™ˆ ë””ë ‰í„°ë¦¬ ì•„ë˜ì— ì„¤ì¹˜ ê²½ë¡œë¥¼ ì¡ìŠµë‹ˆë‹¤.</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/src <span class="nv">$HOME</span>/opt
<span class="c"># ì•„ë˜ ë²„ì „ì€ ì˜ˆì‹œì…ë‹ˆë‹¤. (3.45.3 ë“± 3.35.0 ì´ìƒì´ë©´ OK)</span>
<span class="nb">export </span><span class="nv">SQLITE_VER</span><span class="o">=</span>3.45.4
<span class="nb">export </span><span class="nv">PY_VER</span><span class="o">=</span>3.11.12

<span class="c"># ì„¤ì¹˜ prefix</span>
<span class="nb">export </span><span class="nv">SQLITE_PREFIX</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/opt/sqlite-</span><span class="nv">$SQLITE_VER</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">PY_PREFIX</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/opt/python-</span><span class="nv">$PY_VER</span><span class="s2">"</span>
</code></pre></div></div>

<hr />

<h1 id="1-ì˜¤í”„ë¼ì¸-íŒŒì¼-ì¤€ë¹„-ë‹¤ë¥¸-pcì—ì„œ-ë‹¤ìš´ë¡œë“œ">1) ì˜¤í”„ë¼ì¸ íŒŒì¼ ì¤€ë¹„ (ë‹¤ë¥¸ PCì—ì„œ ë‹¤ìš´ë¡œë“œ)</h1>

<p>ì™¸ë¶€ ì¸í„°ë„· ê°€ëŠ¥í•œ PCì—ì„œ ì•„ë˜ ë‘ ê°œ(ì´ìƒ)ë¥¼ ë°›ì•„ USB/ì‚¬ë‚´ë§ìœ¼ë¡œ <strong>ì„œë²„ì˜<code class="language-plaintext highlighter-rouge">$HOME/src</code></strong> ë¡œ ì˜®ê¹ë‹ˆë‹¤.</p>

<ul>
  <li>
    <p><strong>SQLite</strong> : <code class="language-plaintext highlighter-rouge">sqlite-autoconf-&lt;X&gt;.tar.gz</code></p>

    <ul>
      <li>
        <p>íŒŒì¼ëª… ìˆ«ì <code class="language-plaintext highlighter-rouge">&lt;X&gt;</code>ëŠ” ë²„ì „ ë„˜ë²„ë¥¼ ë¶™ì¸ ê°’ì…ë‹ˆë‹¤. ì˜ˆ: 3.45.4 â†’ <code class="language-plaintext highlighter-rouge">3450400</code></p>
      </li>
      <li>
        <p>ì˜ˆì‹œ íŒŒì¼ëª…: <code class="language-plaintext highlighter-rouge">sqlite-autoconf-3450400.tar.gz</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Python 3.11.12</strong> : <code class="language-plaintext highlighter-rouge">Python-3.11.12.tgz</code></p>
  </li>
</ul>

<blockquote>
  <p>(ì„ íƒ) pipë¥¼ ì“¸ ê³„íšì´ë©´, ë‚˜ì¤‘ì— í•„ìš”í•œ íŒ¨í‚¤ì§€ë“¤ <strong>whl/tar.gz</strong> ë„ ê°™ì´ ë°›ì•„ì˜¤ì„¸ìš”. ì˜¤í”„ë¼ì¸ ì„¤ì¹˜ ì‹œ <code class="language-plaintext highlighter-rouge">pip install --no-index --find-links</code>ë¡œ ì„¤ì¹˜í•©ë‹ˆë‹¤.</p>
</blockquote>

<p>ì„œë²„ì— íŒŒì¼ì´ ë„ì°©í•˜ë©´:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-1</span> <span class="nv">$HOME</span>/src
<span class="c"># sqlite-autoconf-3450400.tar.gz</span>
<span class="c"># Python-3.11.12.tgz</span>
</code></pre></div></div>

<hr />

<h1 id="2-sqlite3-335-ì‚¬ìš©ì-ë””ë ‰í„°ë¦¬ì—-ë¹Œë“œì„¤ì¹˜">2) sqlite3 (&gt;=3.35) ì‚¬ìš©ì ë””ë ‰í„°ë¦¬ì— ë¹Œë“œ/ì„¤ì¹˜</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> <span class="nv">$HOME</span>/src
<span class="nb">tar </span>xf sqlite-autoconf-3450400.tar.gz
<span class="nb">cd </span>sqlite-autoconf-3450400

<span class="c"># fPICìœ¼ë¡œ ë¹Œë“œ, prefixëŠ” ì‚¬ìš©ì ë””ë ‰í„°ë¦¬</span>
<span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">"-O2 -fPIC"</span> ./configure <span class="nt">--prefix</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">"</span>
make <span class="nt">-j</span><span class="s2">"</span><span class="si">$(</span><span class="nb">nproc</span><span class="si">)</span><span class="s2">"</span>
make <span class="nb">install</span>

<span class="c"># ì„¤ì¹˜ í™•ì¸</span>
<span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/bin/sqlite3"</span> <span class="nt">--version</span>
<span class="c"># 3.45.4 ... ê°™ì´ 3.35.0 ì´ìƒì´ ì¶œë ¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</span>
</code></pre></div></div>

<hr />

<h1 id="3-python-31112ë¥¼-ìƒˆ-sqliteì—-ë§í¬í•´ì„œ-ì¬ë¹Œë“œì„¤ì¹˜">3) Python 3.11.12ë¥¼ ìƒˆ sqliteì— ë§í¬í•´ì„œ ì¬ë¹Œë“œ/ì„¤ì¹˜</h1>

<p>Pythonì´ ìƒˆ sqlite í—¤ë”/ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë³´ë„ë¡ <strong>ì»´íŒŒì¼ í™˜ê²½ë³€ìˆ˜</strong> ë¥¼ ì¤ë‹ˆë‹¤. ë˜í•œ ì‹¤í–‰ ì‹œ ë¼ì´ë¸ŒëŸ¬ë¦¬ íƒìƒ‰ì´ ë˜ë„ë¡ <strong>rpath</strong> ë¥¼ ì‹¬ì–´ë‘ë©´ í¸í•©ë‹ˆë‹¤.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> <span class="nv">$HOME</span>/src
<span class="nb">tar </span>xf Python-3.11.12.tgz
<span class="nb">cd </span>Python-3.11.12

<span class="c"># ì»´íŒŒì¼ëŸ¬ê°€ ìƒˆ sqliteë¥¼ ì°¾ë„ë¡ ê²½ë¡œ ì§€ì •</span>
<span class="nb">export </span><span class="nv">CPPFLAGS</span><span class="o">=</span><span class="s2">"-I</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/include"</span>
<span class="nb">export </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">"-L</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib -Wl,-rpath,</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib"</span>
<span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">"</span>

<span class="c"># ìµœì í™”/ensurepip í¬í•¨í•˜ì—¬ ë¹Œë“œ</span>
./configure <span class="nt">--prefix</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PY_PREFIX</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nt">--enable-optimizations</span> <span class="se">\</span>
  <span class="nt">--with-lto</span> <span class="se">\</span>
  <span class="nt">--with-ensurepip</span><span class="o">=</span><span class="nb">install

</span>make <span class="nt">-j</span><span class="s2">"</span><span class="si">$(</span><span class="nb">nproc</span><span class="si">)</span><span class="s2">"</span>
make <span class="nb">install</span>
</code></pre></div></div>

<h2 id="ë¹Œë“œê°€-ëë‚œ-ë’¤-ê²½ë¡œ-ì ìš©--ë²„ì „-í™•ì¸">ë¹Œë“œê°€ ëë‚œ ë’¤ ê²½ë¡œ ì ìš© &amp; ë²„ì „ í™•ì¸</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ìƒˆ íŒŒì´ì¬ì„ PATH ì•ì— ë‘ê¸° (ì‰˜ í”„ë¡œí•„ì— ì¶”ê°€ ê¶Œì¥)</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PY_PREFIX</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>

<span class="c"># íŒŒì´ì¬ì´ ë°”ë¼ë³´ëŠ” sqlite ë²„ì „ í™•ì¸</span>
python3 <span class="nt">-c</span> <span class="s2">"import sqlite3; print(sqlite3.sqlite_version)"</span>
<span class="c"># =&gt; 3.45.4 (ë˜ëŠ” 3.35.0 ì´ìƒ) ê°€ ë‚˜ì™€ì•¼ ì„±ê³µ</span>
</code></pre></div></div>

<blockquote>
  <p>ë§Œì•½ ìœ„ì—ì„œ ì—¬ì „íˆ 3.26.0ì´ ë‚˜ì˜¨ë‹¤ë©´, Pythonì´ ìƒˆ sqliteë¥¼ ëª» ì°¾ì€ ê²ƒì…ë‹ˆë‹¤.</p>

  <ul>
    <li>
      <p><code class="language-plaintext highlighter-rouge">CPPFLAGS/LDFLAGS/LD_LIBRARY_PATH</code>ê°€ ì˜¬ë°”ë¥¸ì§€ ì ê²€</p>
    </li>
    <li>
      <p>ì•„ë˜ â€œë¬¸ì œ í•´ê²° íŒâ€ì˜ <strong>A. _sqlite3 ëª¨ë“ˆ ê°•ì œ êµ¬ì„±</strong> ì„ ì°¸ê³ í•´ ëª¨ë“ˆì„ ëª…ì‹œì ìœ¼ë¡œ ë¹Œë“œ</p>
    </li>
  </ul>

</blockquote>

<hr />

<h1 id="4-ìƒˆ-pythonìœ¼ë¡œ-venv-ë‹¤ì‹œ-ë§Œë“¤ê¸°-ì¤‘ìš”">4) ìƒˆ Pythonìœ¼ë¡œ venv ë‹¤ì‹œ ë§Œë“¤ê¸° (ì¤‘ìš”)</h1>

<p>ê¸°ì¡´ venvëŠ” <strong>ì˜ˆì „ íŒŒì´ì¬ ë°”ì´ë„ˆë¦¬/ë¼ì´ë¸ŒëŸ¬ë¦¬</strong> ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë§Œë“¤ì–´ì¡Œê¸° ë•Œë¬¸ì— <strong>ìƒˆë¡œ ë§Œë“¤ì–´ì•¼</strong> í•©ë‹ˆë‹¤.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># (ì„ íƒ) ì´ì „ venv ë¹„í™œì„±í™”</span>
deactivate 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>

<span class="c"># ìƒˆ venv ìƒì„±</span>
python3 <span class="nt">-m</span> venv <span class="nv">$HOME</span>/venvs/openwebui
<span class="nb">source</span> <span class="nv">$HOME</span>/venvs/openwebui/bin/activate

<span class="c"># pip ìì²´ ì—…ê·¸ë ˆì´ë“œ (ì˜¤í”„ë¼ì¸ì´ë©´ ìƒëµ)</span>
pip <span class="nb">install</span> <span class="nt">--upgrade</span> pip

<span class="c"># ìµœì¢… í™•ì¸ (venv ë‚´ë¶€ì—ì„œë„)</span>
python <span class="nt">-c</span> <span class="s2">"import sqlite3; print(sqlite3.sqlite_version)"</span>
<span class="c"># =&gt; 3.35.0 ì´ìƒì¸ì§€ ì¬í™•ì¸</span>
</code></pre></div></div>

<p>ì´ì œ ì´ venvì—ì„œ Open WebUI/Chromaë¥¼ ì“°ë©´ <strong>sqlite ë²„ì „ ì˜¤ë¥˜ ì—†ì´</strong> ë™ì‘í•©ë‹ˆë‹¤.</p>

<hr />

<h1 id="5-ì˜¤í”„ë¼ì¸-pip-ì„¤ì¹˜-íŒ">5) (ì˜¤í”„ë¼ì¸) pip ì„¤ì¹˜ íŒ</h1>

<p>ì™¸ë¶€ì—ì„œ ì˜ì¡´ì„±ë“¤ì„ ë¯¸ë¦¬ ë°›ì•„ ì™”ë‹¤ë©´:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ í´ë”(ì˜ˆ: /path/pkgs)ì— whl/tar.gz ëª¨ì•„ë‘” ê²½ìš°</span>
pip <span class="nb">install</span> <span class="nt">--no-index</span> <span class="nt">--find-links</span> /path/pkgs open-webui
</code></pre></div></div>

<ul>
  <li>
    <p>SSL ëª¨ë“ˆ(_ssl) ì—†ì´ ë¹Œë“œí–ˆë‹¤ë©´ <strong>https ë‹¤ìš´ë¡œë“œëŠ” ë¶ˆê°€</strong> í•˜ë¯€ë¡œ, í•„ìš”í•œ íŒ¨í‚¤ì§€ëŠ” <strong>ì‚¬ì „ ë‹¤ìš´ë¡œë“œ</strong> ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ë‚˜ì¤‘ì— ì¸í„°ë„·ì´ ê°€ëŠ¥í•´ì§€ë©´ OpenSSL í—¤ë”/ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©ì ì˜ì—­ì— ë¹Œë“œí•œ ë’¤, Pythonì„ ë‹¤ì‹œ ë¹Œë“œí•´ <code class="language-plaintext highlighter-rouge">_ssl</code> ëª¨ë“ˆì„ ë¶™ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì˜µì…˜).</p>
  </li>
</ul>

<hr />

<h2 id="ë¬¸ì œ-í•´ê²°-íŒ-troubleshooting">ë¬¸ì œ í•´ê²° íŒ (Troubleshooting)</h2>

<h3 id="a-_sqlite3-ëª¨ë“ˆì´-not-foundë¡œ-ìŠ¤í‚µë˜ëŠ”-ê²½ìš°">A) <code class="language-plaintext highlighter-rouge">_sqlite3</code> ëª¨ë“ˆì´ â€œnot foundâ€ë¡œ ìŠ¤í‚µë˜ëŠ” ê²½ìš°</h3>

<p>Python ë¹Œë“œ ë¡œê·¸ ë§ˆì§€ë§‰ ë¶€ë¶„ì— â€œThe necessary bits to build these optional modules were not foundâ€ ëª©ë¡ì— <code class="language-plaintext highlighter-rouge">_sqlite3</code>ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´, SQLite í—¤ë”/ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ëª» ì°¾ì€ ê²ƒì…ë‹ˆë‹¤. ê°€ì¥ í™•ì‹¤í•œ ë°©ë²•ì€ <strong>ëª¨ë“ˆ ë¹Œë“œ ì§€ì‹œë¥¼ ëª…ì‹œ</strong> í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> <span class="nv">$HOME</span>/src/Python-3.11.12/Modules

<span class="c"># Setup.local íŒŒì¼ì— ëª…ì‹œì ìœ¼ë¡œ _sqlite3 ëª¨ë“ˆ ë¹Œë“œ ì§€ì‹œ ì¶”ê°€</span>
<span class="nb">cat</span> <span class="o">&gt;</span> Setup.local <span class="o">&lt;&lt;</span><span class="sh">'</span><span class="no">EOF</span><span class="sh">'
_sqlite3 _sqlite/module.c -I</span><span class="nv">$SQLITE_PREFIX</span><span class="sh">/include -L</span><span class="nv">$SQLITE_PREFIX</span><span class="sh">/lib -lsqlite3
</span><span class="no">EOF

</span><span class="c"># í™˜ê²½ë³€ìˆ˜ëŠ” ì—¬ì „íˆ ì„¤ì •ëœ ìƒíƒœì—¬ì•¼ í•¨ (CPPFLAGS/LDFLAGS/LD_LIBRARY_PATH)</span>
<span class="nb">cd</span> ..
make <span class="nt">-j</span><span class="s2">"</span><span class="si">$(</span><span class="nb">nproc</span><span class="si">)</span><span class="s2">"</span>
make <span class="nb">install</span>
</code></pre></div></div>

<p>ë‹¤ì‹œ <code class="language-plaintext highlighter-rouge">python -c "import sqlite3; print(sqlite3.sqlite_version)"</code>ë¡œ í™•ì¸í•´ ë³´ì„¸ìš”.</p>

<h3 id="b-ë§¤ë²ˆ-ld_library_path-ì¡ê¸°-ì‹«ì„-ë•Œ">B) ë§¤ë²ˆ <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code> ì¡ê¸° ì‹«ì„ ë•Œ</h3>

<p>ìœ„ì—ì„œ <code class="language-plaintext highlighter-rouge">LDFLAGS="-Wl,-rpath,$SQLITE_PREFIX/lib"</code>ë¥¼ ì¤¬ë‹¤ë©´ ë³´í†µì€ í•„ìš” ì—†ìŠµë‹ˆë‹¤.<br />
í˜¹ì‹œ ë¹ ëœ¨ë ¸ë‹¤ë©´, ì•„ë˜ì²˜ëŸ¼ <strong>rpath í¬í•¨ ì¬ë¹Œë“œ</strong> í•˜ê±°ë‚˜, ì…¸ í”„ë¡œí•„(<code class="language-plaintext highlighter-rouge">~/.bashrc</code>)ì— ë‹¤ìŒì„ ì¶”ê°€í•˜ì„¸ìš”.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PY_PREFIX</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">"</span>
</code></pre></div></div>

<h3 id="c-ì—¬ëŸ¬-ë²„ì „-ê³µì¡´">C) ì—¬ëŸ¬ ë²„ì „ ê³µì¡´</h3>

<ul>
  <li>
    <p>ë‹¤ë¥¸ ì‘ì—…ì— ì‹œìŠ¤í…œ Pythonì´ í•„ìš”í•˜ë©´, ë‹¨ìˆœíˆ PATH/LD_LIBRARY_PATHë¥¼ <strong>í™œì„±í™”/ë¹„í™œì„±í™”</strong> í•˜ì—¬ ì „í™˜í•˜ë©´ ë©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ì¶©ëŒì„ í”¼í•˜ë ¤ë©´ í•­ìƒ <code class="language-plaintext highlighter-rouge">which python</code>ìœ¼ë¡œ í˜„ì¬ ì“°ëŠ” ë°”ì´ë„ˆë¦¬ê°€ ì–´ë””ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.</p>
  </li>
</ul>

<hr />

<h2 id="ìµœì¢…-ì²´í¬ë¦¬ìŠ¤íŠ¸">ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">$SQLITE_PREFIX/bin/sqlite3 --version</code>ì´ <strong>3.35+</strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">python -c "import sqlite3; print(sqlite3.sqlite_version)"</code>ê°€ <strong>3.35+</strong></p>
  </li>
  <li>
    <p>ìƒˆ <strong>venv</strong> ì—ì„œ ë™ì¼ ê²°ê³¼ í™•ì¸</p>
  </li>
  <li>
    <p>Open WebUI/Chroma ë‹¤ì‹œ ì‹¤í–‰ ì‹œ ë” ì´ìƒ <code class="language-plaintext highlighter-rouge">sqlite3 &gt;= 3.35.0</code> ì—ëŸ¬ê°€ ë‚˜ì˜¤ì§€ ì•ŠìŒ</p>
  </li>
</ul>

<p>í•„ìš”í•˜ë©´, ìœ„ ê³¼ì •ì„ <strong>ë³µë¶™ ê°€ëŠ¥í•œ ìŠ¤í¬ë¦½íŠ¸</strong>(ë²„ì „/ê²½ë¡œë§Œ ë³€ìˆ˜ë¡œ ë°”ê¾¸ë©´ ë˜ëŠ” í˜•íƒœ)ë¡œ ë§Œë“¤ì–´ ë“œë¦´ê²Œìš”.</p>

<p class="chat--user">

í˜¹ì‹œ ì´ê±° ë§ê³  ë‹¤ë¥¸ dependencyê°€ ìˆì„ê¹Œ? ë¯¸ë¦¬ ë‹¤ ì¤€ë¹„í•´ì„œ í•œ ë²ˆì— ì„¤ì¹˜í•˜ê³  ì‹¶ì–´.

</p>

<p>ì¢‹ì€ ì§ˆë¬¸ì´ì—ìš”. â€œí•œ ë²ˆì—â€ ëë‚´ë ¤ë©´ <strong>(A) Python ìì²´ë¥¼ ë¹Œë“œí•  ë•Œ í•„ìš”í•œ ë„¤ì´í‹°ë¸Œ ë¼ì´ë¸ŒëŸ¬ë¦¬</strong> ì™€ <strong>(B) Open WebUI/Chroma íŒŒì´ì¬ íŒ¨í‚¤ì§€ ì¸¡ ì˜ì¡´ì„±(ê°€ëŠ¥í•˜ë©´ íœ ë¡œ ë¯¸ë¦¬ ë°›ì•„ì˜¤ê¸°)</strong> ë‘ ì¶•ìœ¼ë¡œ ì¤€ë¹„í•˜ë©´ ë©ë‹ˆë‹¤. ì•„ë˜ë¥¼ <strong>ì°¨ê·¼ì°¨ê·¼</strong> ë”°ë¼ì˜¤ì„¸ìš”.</p>

<hr />

<h1 id="a-python-311ì„-ê¸°ëŠ¥-ë¹ ì§ì—†ì´-ë¹Œë“œí•˜ê¸°-ìœ„í•œ-ë„¤ì´í‹°ë¸Œ-ì˜ì¡´ì„±">A) Python 3.11ì„ ê¸°ëŠ¥ ë¹ ì§ì—†ì´ ë¹Œë“œí•˜ê¸° ìœ„í•œ ë„¤ì´í‹°ë¸Œ ì˜ì¡´ì„±</h1>

<blockquote>
  <p>ëª©í‘œ: <code class="language-plaintext highlighter-rouge">_sqlite3</code>, <code class="language-plaintext highlighter-rouge">_ssl</code>, <code class="language-plaintext highlighter-rouge">_bz2</code>, <code class="language-plaintext highlighter-rouge">_lzma</code>, <code class="language-plaintext highlighter-rouge">_readline</code>, <code class="language-plaintext highlighter-rouge">ctypes</code> ë“± <strong>í‘œì¤€ ëª¨ë“ˆì´ ë¹ ì§€ì§€ ì•Šê²Œ</strong> í•˜ë ¤ë©´, í•´ë‹¹ C ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ <strong>ì‚¬ìš©ì ê²½ë¡œ</strong> ì— ë¨¼ì € ì„¤ì¹˜í•˜ê³ , ê·¸ ê²½ë¡œë¥¼ ê°€ë¦¬í‚¤ë©° Pythonì„ ë¹Œë“œí•´ì•¼ í•©ë‹ˆë‹¤. (sudo/ì¸í„°ë„· ì—†ìŒ ê°€ì •)</p>
</blockquote>

<p>í•„ìˆ˜/ê°•ë ¥ê¶Œì¥ ë¼ì´ë¸ŒëŸ¬ë¦¬:</p>

<table>
  <thead>
    <tr>
      <th>ë¼ì´ë¸ŒëŸ¬ë¦¬</th>
      <th>ê¸°ëŠ¥(íŒŒì´ì¬ ë‚´ ëª¨ë“ˆ)</th>
      <th>ì—†ì„ ë•Œ ì¦ìƒ</th>
      <th>ì˜¤í”„ë¼ì¸ ì¤€ë¹„ ìš”ë ¹(ìš”ì§€)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>OpenSSL â‰¥1.1.1/3.0</strong></td>
      <td><code class="language-plaintext highlighter-rouge">ssl</code>, <code class="language-plaintext highlighter-rouge">hashlib</code> ê°€ì†</td>
      <td>HTTPS ë¶ˆê°€ â†’ pip ë‹¤ìš´ë¡œë“œ/ì¸ì¦ì„œ ë¬¸ì œ</td>
      <td>ì†ŒìŠ¤ tar.gz â†’ <code class="language-plaintext highlighter-rouge">$HOME/opt/openssl-&lt;ver&gt;</code>ì— ì„¤ì¹˜ í›„ <code class="language-plaintext highlighter-rouge">./configure</code> ì‹œ <code class="language-plaintext highlighter-rouge">--with-openssl</code> ë˜ëŠ” <code class="language-plaintext highlighter-rouge">CPPFLAGS/LDFLAGS</code>ë¡œ ê²½ë¡œ ì§€ì •</td>
    </tr>
    <tr>
      <td><strong>zlib</strong></td>
      <td><code class="language-plaintext highlighter-rouge">zlib</code></td>
      <td>ì••ì¶• ê´€ë ¨ ì¼ë¶€ ê¸°ëŠ¥ ì œí•œ</td>
      <td><code class="language-plaintext highlighter-rouge">zlib</code> ì†ŒìŠ¤ ë¹Œë“œ â†’ <code class="language-plaintext highlighter-rouge">$HOME/opt/zlib</code></td>
    </tr>
    <tr>
      <td><strong>bzip2 (libbz2)</strong></td>
      <td><code class="language-plaintext highlighter-rouge">_bz2</code></td>
      <td><code class="language-plaintext highlighter-rouge">.bz2</code> í•¸ë“¤ë§ ë¶ˆê°€</td>
      <td><code class="language-plaintext highlighter-rouge">bzip2</code> ì†ŒìŠ¤ ë¹Œë“œ â†’ <code class="language-plaintext highlighter-rouge">$HOME/opt/bzip2</code></td>
    </tr>
    <tr>
      <td><strong>xz (liblzma)</strong></td>
      <td><code class="language-plaintext highlighter-rouge">_lzma</code></td>
      <td><code class="language-plaintext highlighter-rouge">.xz</code> í•¸ë“¤ë§ ë¶ˆê°€</td>
      <td><code class="language-plaintext highlighter-rouge">xz</code>(xz-utils) ì†ŒìŠ¤ ë¹Œë“œ â†’ <code class="language-plaintext highlighter-rouge">$HOME/opt/xz</code></td>
    </tr>
    <tr>
      <td><strong>readline + ncurses</strong></td>
      <td><code class="language-plaintext highlighter-rouge">readline</code></td>
      <td>REPL íˆìŠ¤í† ë¦¬/ë¼ì¸í¸ì§‘ ë¯¸ì‘ë™</td>
      <td><code class="language-plaintext highlighter-rouge">readline</code>, <code class="language-plaintext highlighter-rouge">ncurses</code> ì†ŒìŠ¤ ë¹Œë“œ</td>
    </tr>
    <tr>
      <td><strong>libffi</strong></td>
      <td><code class="language-plaintext highlighter-rouge">_ctypes</code></td>
      <td><code class="language-plaintext highlighter-rouge">ctypes</code> ë¯¸êµ¬ì„±</td>
      <td><code class="language-plaintext highlighter-rouge">libffi</code> ì†ŒìŠ¤ ë¹Œë“œ</td>
    </tr>
    <tr>
      <td><strong>sqlite3 â‰¥3.35</strong></td>
      <td><code class="language-plaintext highlighter-rouge">_sqlite3</code></td>
      <td>(ì´ë¯¸ ë³´ì‹ ) Chroma ì—ëŸ¬</td>
      <td>ìœ„ì—ì„œ ì§„í–‰í•˜ì‹  ëŒ€ë¡œ ì†ŒìŠ¤ ë¹Œë“œ</td>
    </tr>
    <tr>
      <td><strong>expat</strong></td>
      <td><code class="language-plaintext highlighter-rouge">pyexpat</code></td>
      <td>XML íŒŒì‹± ë¯¸ë™ì‘</td>
      <td><code class="language-plaintext highlighter-rouge">expat</code> ì†ŒìŠ¤ ë¹Œë“œ</td>
    </tr>
    <tr>
      <td><strong>gdbm</strong>(ì„ íƒ)</td>
      <td><code class="language-plaintext highlighter-rouge">dbm.gnu</code></td>
      <td>GNU DBM ë¯¸ì‚¬ìš©</td>
      <td>í•„ìš” ì‹œë§Œ</td>
    </tr>
    <tr>
      <td><strong>uuid</strong>(libuuid, ì„ íƒ)</td>
      <td><code class="language-plaintext highlighter-rouge">uuid</code>(OS ë°±ì—”ë“œ)</td>
      <td>ìˆœìˆ˜ íŒŒì´ì¬ ëŒ€ì²´</td>
      <td>ì„ íƒ</td>
    </tr>
  </tbody>
</table>

<h3 id="ì„¤ì¹˜-ìˆœì„œê¶Œì¥">ì„¤ì¹˜ ìˆœì„œ(ê¶Œì¥)</h3>

<ol>
  <li>
    <p>zlib â†’ bzip2 â†’ xz â†’ readline/ncurses â†’ libffi â†’ <strong>sqlite</strong> â†’ <strong>OpenSSL</strong> â†’ expat</p>
  </li>
  <li>
    <p>ê° ë¼ì´ë¸ŒëŸ¬ë¦¬ë§ˆë‹¤ <code class="language-plaintext highlighter-rouge">--prefix="$HOME/opt/&lt;name&gt;-&lt;ver&gt;"</code>ë¡œ ì„¤ì¹˜</p>
  </li>
  <li>
    <p>Python ë¹Œë“œ ì „ì— ì•„ë˜ì²˜ëŸ¼ ê²½ë¡œë¥¼ í•œ ë²ˆì— ì¡ìŠµë‹ˆë‹¤:</p>
  </li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PKGROOTS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/opt/zlib:</span><span class="nv">$HOME</span><span class="s2">/opt/bzip2:</span><span class="nv">$HOME</span><span class="s2">/opt/xz:</span><span class="nv">$HOME</span><span class="s2">/opt/readline:</span><span class="nv">$HOME</span><span class="s2">/opt/ncurses:</span><span class="nv">$HOME</span><span class="s2">/opt/libffi:</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">:</span><span class="nv">$HOME</span><span class="s2">/opt/openssl:</span><span class="nv">$HOME</span><span class="s2">/opt/expat"</span>
<span class="nb">export </span><span class="nv">CPPFLAGS</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">printf</span> <span class="nt">--</span> <span class="s1">' -I%s/include'</span> <span class="k">${</span><span class="nv">PKGROOTS</span><span class="p">//</span>:/<span class="p"> </span><span class="k">}</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">printf</span> <span class="nt">--</span> <span class="s1">' -L%s/lib'</span> <span class="k">${</span><span class="nv">PKGROOTS</span><span class="p">//</span>:/<span class="p"> </span><span class="k">}</span><span class="si">)</span><span class="s2"> -Wl,-rpath,</span><span class="nv">$HOME</span><span class="s2">/opt/zlib/lib:</span><span class="nv">$HOME</span><span class="s2">/opt/bzip2/lib:</span><span class="nv">$HOME</span><span class="s2">/opt/xz/lib:</span><span class="nv">$HOME</span><span class="s2">/opt/readline/lib:</span><span class="nv">$HOME</span><span class="s2">/opt/ncurses/lib:</span><span class="nv">$HOME</span><span class="s2">/opt/libffi/lib:</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib:</span><span class="nv">$HOME</span><span class="s2">/opt/openssl/lib:</span><span class="nv">$HOME</span><span class="s2">/opt/expat/lib"</span>
<span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/opt/zlib/lib:</span><span class="nv">$HOME</span><span class="s2">/opt/bzip2/lib:</span><span class="nv">$HOME</span><span class="s2">/opt/xz/lib:</span><span class="nv">$HOME</span><span class="s2">/opt/readline/lib:</span><span class="nv">$HOME</span><span class="s2">/opt/ncurses/lib:</span><span class="nv">$HOME</span><span class="s2">/opt/libffi/lib:</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib:</span><span class="nv">$HOME</span><span class="s2">/opt/openssl/lib:</span><span class="nv">$HOME</span><span class="s2">/opt/expat/lib:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">"</span>
</code></pre></div></div>

<ol>
  <li>ê·¸ëŸ° ë‹¤ìŒ Python <code class="language-plaintext highlighter-rouge">./configure</code>:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./configure <span class="nt">--prefix</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PY_PREFIX</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nt">--enable-optimizations</span> <span class="nt">--with-lto</span> <span class="se">\</span>
  <span class="nt">--with-ensurepip</span><span class="o">=</span><span class="nb">install</span> <span class="se">\</span>
  <span class="nt">--with-openssl</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/opt/openssl-&lt;ver&gt;"</span>  <span class="c"># ìˆìœ¼ë©´ ëª…ì‹œ, ì—†ìœ¼ë©´ CPP/LDFLAGSì— ì˜ì¡´</span>
make <span class="nt">-j</span><span class="s2">"</span><span class="si">$(</span><span class="nb">nproc</span><span class="si">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> make <span class="nb">install</span>
</code></pre></div></div>

<ol>
  <li>ë¹Œë“œ í›„ í™•ì¸(ë°˜ë“œì‹œ venv ìƒˆë¡œ ìƒì„±):<br />
<code class="language-plaintext highlighter-rouge">python -c "import sqlite3, ssl, bz2, lzma, readline, ctypes, xml.parsers.expat as e; print(sqlite3.sqlite_version, ssl.OPENSSL_VERSION)"</code></li>
</ol>

<blockquote>
  <p><strong>íŒ</strong> : <code class="language-plaintext highlighter-rouge">_sqlite3</code>ì²˜ëŸ¼ ë¹ ì§€ëŠ” ëª¨ë“ˆì´ ìˆë‹¤ë©´, ìœ„ ê²½ë¡œ/ë³€ìˆ˜ ëˆ„ë½ì´ ì›ì¸ì…ë‹ˆë‹¤. í•„ìš”í•˜ë©´ <code class="language-plaintext highlighter-rouge">Modules/Setup.local</code>ì— ëª¨ë“ˆ ë¹Œë“œ ë¼ì¸(ì˜ˆ: <code class="language-plaintext highlighter-rouge">_sqlite3 ... -lsqlite3</code>)ì„ <strong>ëª…ì‹œ</strong> í•˜ê³  <code class="language-plaintext highlighter-rouge">make install</code>ì„ ë‹¤ì‹œ ì‹¤í–‰í•˜ì„¸ìš”.</p>
</blockquote>

<hr />

<h1 id="b-open-webui--chroma-íŒŒì´ì¬-íŒ¨í‚¤ì§€-ìª½-ì˜ì¡´ì„±ì˜¤í”„ë¼ì¸-íœ -ì¤€ë¹„">B) Open WebUI / Chroma íŒŒì´ì¬ íŒ¨í‚¤ì§€ ìª½ ì˜ì¡´ì„±(ì˜¤í”„ë¼ì¸ íœ  ì¤€ë¹„)</h1>

<blockquote>
  <p>ëª©í‘œ: RHEL 8.x + Python 3.11ì—ì„œ <strong>ë¹Œë“œ ì—†ì´ ì„¤ì¹˜</strong> ë˜ë„ë¡, ê°€ëŠ¥í•œ í•œ <strong>ë¯¸ë¦¬ ì»´íŒŒì¼ëœ wheel</strong>(manylinux2014_x86_64 ë“±)ì„ ëª¨ì•„ <strong>ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ</strong>(wheelhouse)ë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤. (sudo/ì¸í„°ë„· ì—†ìŒ ê°€ì •)</p>
</blockquote>

<h3 id="1-í•µì‹¬-íŒ¨í‚¤ì§€">1) í•µì‹¬ íŒ¨í‚¤ì§€</h3>

<ul>
  <li>
    <p><strong>open-webui</strong> (ë°±ì—”ë“œ FastAPI/uvicorn ë“± í¬í•¨)</p>
  </li>
  <li>
    <p><strong>chromadb</strong> (ë²¡í„°DB: SQLite/duckdb + <strong>hnswlib</strong> ë“±)</p>
  </li>
  <li>
    <p>ë‹¤ìŒì€ ì¢…ì†ì„±ì— ìì£¼ í¬í•¨ë˜ë©° <strong>ì»´íŒŒì¼ì´ í•„ìš”í•œ ê²½ìš°</strong> ê°€ ìˆëŠ” ê²ƒë“¤:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">hnswlib</code>(C++11)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">uvloop</code>, <code class="language-plaintext highlighter-rouge">httptools</code>, <code class="language-plaintext highlighter-rouge">watchfiles</code>(C/Rust ë¹Œë“œ í•„ìš” ê°€ëŠ¥)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">orjson</code>(Rust) ë˜ëŠ” <code class="language-plaintext highlighter-rouge">ujson</code>(C)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">numpy</code>, <code class="language-plaintext highlighter-rouge">scipy</code>, <code class="language-plaintext highlighter-rouge">pandas</code> (BLAS ì—°ë™/ì»´íŒŒì¼ ì´ìŠˆ â†’ <strong>ë°˜ë“œì‹œ wheel</strong> ë¡œ)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">pydantic</code>, <code class="language-plaintext highlighter-rouge">fastapi</code>, <code class="language-plaintext highlighter-rouge">starlette</code>, <code class="language-plaintext highlighter-rouge">uvicorn</code> ë“±ì€ ë³´í†µ pure-Pythonì´ì§€ë§Œ, <code class="language-plaintext highlighter-rouge">uvicorn[standard]</code>ë¼ë©´ ìœ„ ë„¤ì´í‹°ë¸Œ íŒ¨í‚¤ì§€ë¥¼ ì¶”ê°€ë¡œ ëŒì–´ì˜µë‹ˆë‹¤.</p>
      </li>
    </ul>
  </li>
</ul>

<h3 id="2-ì˜¤í”„ë¼ì¸-ë‹¤ìš´ë¡œë“œì‚¬ì „-ì¤€ë¹„-ë°©ë²•">2) ì˜¤í”„ë¼ì¸ ë‹¤ìš´ë¡œë“œ(ì‚¬ì „ ì¤€ë¹„) ë°©ë²•</h3>

<p><strong>ì™¸ë¶€ ì¸í„°ë„· ê°€ëŠ¥í•œ ë™ì¼/ìœ ì‚¬ ë¦¬ëˆ…ìŠ¤(x86_64, glibc) ë¨¸ì‹ </strong> ì—ì„œ:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3.11 <span class="nt">-m</span> venv dl <span class="o">&amp;&amp;</span> <span class="nb">source </span>dl/bin/activate
pip <span class="nb">install</span> <span class="nt">--upgrade</span> pip wheel

<span class="c"># ëª©ì ì§€ í´ë”</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> /tmp/wheelhouse

<span class="c"># ê°€ì¥ ì‰¬ìš´ ë°©ë²•: ì§ì ‘ ì¢…ì†ì„±ì„ í•´ì„í•˜ê²Œ ë§¡ê¹€</span>
pip download <span class="nt">--dest</span> /tmp/wheelhouse open-webui chromadb

<span class="c"># ë§Œì•½ ì•„í‚¤í…ì²˜ê°€ ë‹¤ë¥´ê±°ë‚˜ ê°•ì œë¡œ íœ ë§Œ ë°›ê³  ì‹¶ë‹¤ë©´ (ê³ ê¸‰)</span>
pip download <span class="nt">--only-binary</span><span class="o">=</span>:all: <span class="se">\</span>
  <span class="nt">--platform</span> manylinux2014_x86_64 <span class="nt">--implementation</span> <span class="nb">cp</span> <span class="nt">--python-version</span> 311 <span class="se">\</span>
  <span class="nt">--dest</span> /tmp/wheelhouse open-webui chromadb
</code></pre></div></div>

<ul>
  <li>
    <p>ì˜¤ë¥˜ê°€ ë‚˜ë©´, ë©”ì‹œì§€ì— ë‚˜ì˜¨ íŒ¨í‚¤ì§€ë¥¼ <strong>ê°œë³„ì ìœ¼ë¡œ ì¶”ê°€</strong> í•´ ë‹¤ì‹œ <code class="language-plaintext highlighter-rouge">pip download</code> í•˜ì„¸ìš”(ì˜ˆ: <code class="language-plaintext highlighter-rouge">numpy</code>, <code class="language-plaintext highlighter-rouge">hnswlib</code>, <code class="language-plaintext highlighter-rouge">orjson</code> ë“±).</p>
  </li>
  <li>
    <p><strong>Rust toolchain ì—†ì´ ì„¤ì¹˜í•˜ë ¤ë©´</strong> ë°˜ë“œì‹œ <code class="language-plaintext highlighter-rouge">orjson</code>, <code class="language-plaintext highlighter-rouge">watchfiles</code> ë“± <strong>ë¯¸ë¦¬ ë¹Œë“œëœ wheel</strong> ì„ í™•ë³´í•´ì•¼ í•©ë‹ˆë‹¤.</p>
  </li>
</ul>

<p>ì„œë²„ë¡œ ë³µì‚¬ í›„, ì˜¤í”„ë¼ì¸ ì„¤ì¹˜:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install</span> <span class="nt">--no-index</span> <span class="nt">--find-links</span> /path/to/wheelhouse open-webui chromadb
</code></pre></div></div>

<h3 id="3-chromachromadb-ê´€ë ¨-ì£¼ì˜ì ">3) Chroma(Chromadb) ê´€ë ¨ ì£¼ì˜ì </h3>

<ul>
  <li>
    <p>í˜„ì¬ ì—ëŸ¬ì˜ ì›ì¸ì¸ <strong>sqlite3 â‰¥ 3.35</strong> ëŠ” ì´ë¯¸ A)ì—ì„œ í•´ê²°.</p>
  </li>
  <li>
    <p><strong>hnswlib</strong> íœ ì´ ì—†ìœ¼ë©´ ì†ŒìŠ¤ ë¹Œë“œê°€ ì‹œë„ë©ë‹ˆë‹¤(ì˜¤í”„ë¼ì¸/ì»´íŒŒì¼ëŸ¬ ë¬¸ì œë¡œ ì‹¤íŒ¨í•˜ê¸° ì‰¬ì›€). <strong>ë°˜ë“œì‹œ íœ ë¡œ ê°€ì ¸ì˜¤ì„¸ìš”.</strong></p>
  </li>
  <li>
    <p>ì„±ëŠ¥ì„ ìœ„í•´ <code class="language-plaintext highlighter-rouge">numpy</code>ë„ <strong>íœ </strong> ì„ ê°•ë ¥ ì¶”ì²œí•©ë‹ˆë‹¤. (ì†ŒìŠ¤ ë¹Œë“œëŠ” BLAS/LAPACK ë“± ì¶”ê°€ ì§€ë¢°ê°€ ë§ìŒ)</p>
  </li>
</ul>

<hr />

<h1 id="c-ë„êµ¬-ì²´ì¸ì»´íŒŒì¼ëŸ¬-ë“±">C) ë„êµ¬ ì²´ì¸(ì»´íŒŒì¼ëŸ¬ ë“±)</h1>

<ul>
  <li>
    <p><strong>í•„ìˆ˜</strong> : <code class="language-plaintext highlighter-rouge">gcc</code>, <code class="language-plaintext highlighter-rouge">g++</code>, <code class="language-plaintext highlighter-rouge">make</code>, <code class="language-plaintext highlighter-rouge">tar</code>, <code class="language-plaintext highlighter-rouge">xz</code>, <code class="language-plaintext highlighter-rouge">patch</code>, <code class="language-plaintext highlighter-rouge">pkg-config</code></p>

    <ul>
      <li>ëŒ€ë¶€ë¶„ RHEL 8ì—ëŠ” ê¸°ë³¸ ì œê³µë˜ì§€ë§Œ, ë§Œì•½ ì‚¬ìš©ì PATHì— ì—†ë‹¤ë©´ <strong>ê´€ë¦¬ìì—ê²Œ ì„¤ì¹˜ ìš”ì²­</strong> í•„ìš”í•©ë‹ˆë‹¤(ì´ ë¶€ë¶„ì€ sudo/ì˜¤í”„ë¼ì¸ í™˜ê²½ì—ì„œ ì‚¬ìš©ì ì„¤ì¹˜ê°€ í˜„ì‹¤ì ìœ¼ë¡œ ì–´ë µìŠµë‹ˆë‹¤).</li>
    </ul>
  </li>
  <li>
    <p>ì„ íƒ(ì†ŒìŠ¤ ë¹Œë“œ ë§ì„ ë•Œ ìœ ìš©): <code class="language-plaintext highlighter-rouge">cmake</code>(ì¼ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬), <code class="language-plaintext highlighter-rouge">ninja</code>(ì„ íƒ)</p>
  </li>
</ul>

<hr />

<h1 id="d-í•œ-ë²ˆì—-ëë‚´ê¸°-ì²´í¬ë¦¬ìŠ¤íŠ¸">D) â€œí•œ ë²ˆì— ëë‚´ê¸°â€ ì²´í¬ë¦¬ìŠ¤íŠ¸</h1>

<ol>
  <li>
    <p>(ì™¸ë¶€ PC) ì•„ë˜ ì†ŒìŠ¤/íœ  ë‹¤ìš´ë¡œë“œ</p>

    <ul>
      <li>
        <p>ì†ŒìŠ¤: <code class="language-plaintext highlighter-rouge">sqlite</code>, <code class="language-plaintext highlighter-rouge">openssl</code>, <code class="language-plaintext highlighter-rouge">zlib</code>, <code class="language-plaintext highlighter-rouge">bzip2</code>, <code class="language-plaintext highlighter-rouge">xz</code>, <code class="language-plaintext highlighter-rouge">readline</code>, <code class="language-plaintext highlighter-rouge">ncurses</code>, <code class="language-plaintext highlighter-rouge">libffi</code>, <code class="language-plaintext highlighter-rouge">expat</code>, <code class="language-plaintext highlighter-rouge">Python-3.11.12.tgz</code></p>
      </li>
      <li>
        <p>íœ : <code class="language-plaintext highlighter-rouge">open-webui</code>, <code class="language-plaintext highlighter-rouge">chromadb</code>, <code class="language-plaintext highlighter-rouge">hnswlib</code>, <code class="language-plaintext highlighter-rouge">numpy</code>, <code class="language-plaintext highlighter-rouge">uvicorn</code>, <code class="language-plaintext highlighter-rouge">fastapi</code>, <code class="language-plaintext highlighter-rouge">pydantic</code>, <code class="language-plaintext highlighter-rouge">starlette</code>, <code class="language-plaintext highlighter-rouge">watchfiles</code>, <code class="language-plaintext highlighter-rouge">orjson</code>(ë˜ëŠ” <code class="language-plaintext highlighter-rouge">ujson</code>), ê¸°íƒ€ ìë™ìœ¼ë¡œ ëŒë ¤ì˜¤ëŠ” ê²ƒë“¤ ì „ë¶€</p>
      </li>
    </ul>
  </li>
  <li>
    <p>(ì„œë²„) A ìˆœì„œëŒ€ë¡œ <strong>ë„¤ì´í‹°ë¸Œ ë¼ì´ë¸ŒëŸ¬ë¦¬</strong> ë¥¼ <code class="language-plaintext highlighter-rouge">$HOME/opt/...</code>ì— ì„¤ì¹˜</p>
  </li>
  <li>
    <p>(ì„œë²„) í™˜ê²½ë³€ìˆ˜ë¡œ include/lib/rpath ì…‹ì—… í›„ <strong>Python ë¹Œë“œ</strong></p>
  </li>
  <li>
    <p>(ì„œë²„) ìƒˆ <strong>venv ìƒì„±</strong> â†’ <code class="language-plaintext highlighter-rouge">pip install --no-index --find-links â€¦</code>ë¡œ <strong>íœ </strong> ì„¤ì¹˜</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">python -c "import sqlite3; print(sqlite3.sqlite_version)"</code>ê°€ 3.35+ì¸ì§€ í™•ì¸</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">open-webui serve</code> ì‹¤í–‰ í…ŒìŠ¤íŠ¸</p>
  </li>
</ol>

<hr />

<p>í•„ìš”í•˜ì‹œë©´, ìœ„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ <strong>ì˜¤í”„ë¼ì¸ ë¹Œë“œ ìë™í™” ìŠ¤í¬ë¦½íŠ¸(í•˜ë‚˜ì˜ bash íŒŒì¼)</strong>ì™€, <strong>pip wheelhouse ë§Œë“¤ê¸°ìš© ëª…ë ¹ì–´ ì„¸íŠ¸</strong> ë¥¼ ì‚¬ìš©ì í™˜ê²½ì— ë§ì¶° ë½‘ì•„ë“œë¦´ê²Œìš”. ì–´ë–¤ ë²„ì „ ì¡°í•©ìœ¼ë¡œ ê°€ì‹¤ì§€ ì•Œë ¤ì£¼ì‹œë©´ ë°”ë¡œ ë§Œë“¤ì–´ ë“œë¦½ë‹ˆë‹¤.</p>

<p class="chat--user">

ìœ¼ì•… ë„ˆë¬´ ë§ì•„. ì €ê²ƒë“¤ì´ ë‹¤ ê¼­ í•„ìš”í•œê±°ì•¼? ë‚œ ì˜¤ë¥˜ë§Œ ì•ˆë‚˜ë©´ ë¼

</p>

<p>í™•ì‹¤íˆ ë§ì•˜ì£  ğŸ˜‚ â€œì˜¤ë¥˜ë§Œ ì•ˆ ë‚˜ê²Œâ€ê°€ ëª©í‘œë¼ë©´ <strong>ë”± í•˜ë‚˜ë§Œ</strong> í•´ê²°í•˜ë©´ ë©ë‹ˆë‹¤:</p>

<h2 id="í•µì‹¬ë§Œ-sqliteë§Œ-ìƒˆë¡œ-ê¹”ê³ -pythonì„-ê·¸ê±¸ë¡œ-ë‹¤ì‹œ-ë¹Œë“œ">í•µì‹¬ë§Œ: SQLiteë§Œ ìƒˆë¡œ ê¹”ê³ , Pythonì„ ê·¸ê±¸ë¡œ ë‹¤ì‹œ ë¹Œë“œ</h2>

<p>Chroma ì—ëŸ¬ì˜ <strong>ì§ì ‘ ì›ì¸</strong> ì€ <code class="language-plaintext highlighter-rouge">sqlite3 &lt; 3.35</code>ë¿ì´ì—ìš”.<br />
ì¦‰, <strong>ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„ ì „í˜€ ê±´ë“œë¦¬ì§€ ì•Šì•„ë„</strong> ë©ë‹ˆë‹¤.</p>

<h3 id="0-ë³€ìˆ˜í´ë”">0) ë³€ìˆ˜/í´ë”</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/src <span class="nv">$HOME</span>/opt
<span class="nb">export </span><span class="nv">SQLITE_VER</span><span class="o">=</span>3.45.4              <span class="c"># 3.35.0 ì´ìƒì´ë©´ OK</span>
<span class="nb">export </span><span class="nv">PY_VER</span><span class="o">=</span>3.11.12

<span class="nb">export </span><span class="nv">SQLITE_PREFIX</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/opt/sqlite-</span><span class="nv">$SQLITE_VER</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">PY_PREFIX</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/opt/python-</span><span class="nv">$PY_VER</span><span class="s2">"</span>
</code></pre></div></div>

<h3 id="1-ì˜¤í”„ë¼ì¸ì—ì„œ-ê°€ì ¸ì˜¨-ì†ŒìŠ¤-ì—…ë¡œë“œ">1) (ì˜¤í”„ë¼ì¸ì—ì„œ ê°€ì ¸ì˜¨) ì†ŒìŠ¤ ì—…ë¡œë“œ</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">sqlite-autoconf-&lt;NNNNNNN&gt;.tar.gz</code> (ì˜ˆ: 3.45.4 â†’ 3450400)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Python-3.11.12.tgz</code><br />
ì´ ë‘ ê°œë§Œ ìˆìœ¼ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.</p>
  </li>
</ul>

<h3 id="2-sqliteë§Œ-ì‚¬ìš©ì-ê²½ë¡œì—-ì„¤ì¹˜">2) SQLiteë§Œ ì‚¬ìš©ì ê²½ë¡œì— ì„¤ì¹˜</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> <span class="nv">$HOME</span>/src
<span class="nb">tar </span>xf sqlite-autoconf-3450400.tar.gz
<span class="nb">cd </span>sqlite-autoconf-3450400

<span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">"-O2 -fPIC"</span> ./configure <span class="nt">--prefix</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">"</span>
make <span class="nt">-j</span><span class="s2">"</span><span class="si">$(</span><span class="nb">nproc</span><span class="si">)</span><span class="s2">"</span>
make <span class="nb">install</span>

<span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/bin/sqlite3"</span> <span class="nt">--version</span>    <span class="c"># 3.35.0 ì´ìƒ í™•ì¸</span>
</code></pre></div></div>

<h3 id="3-pythonì„-ê·¸-sqliteë¡œë§Œ-ë§í¬í•´ì„œ-ì¬ë¹Œë“œ">3) Pythonì„ â€œê·¸ SQLiteâ€ë¡œë§Œ ë§í¬í•´ì„œ ì¬ë¹Œë“œ</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> <span class="nv">$HOME</span>/src
<span class="nb">tar </span>xf Python-3.11.12.tgz
<span class="nb">cd </span>Python-3.11.12

<span class="c"># ì»´íŒŒì¼ëŸ¬ê°€ ìƒˆ sqliteë¥¼ ë³´ê²Œ ê²½ë¡œ ì§€ì • + rpath ì‹¬ê¸°</span>
<span class="nb">export </span><span class="nv">CPPFLAGS</span><span class="o">=</span><span class="s2">"-I</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/include"</span>
<span class="nb">export </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">"-L</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib -Wl,-rpath,</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib"</span>
<span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">"</span>

./configure <span class="nt">--prefix</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PY_PREFIX</span><span class="s2">"</span> <span class="nt">--with-ensurepip</span><span class="o">=</span><span class="nb">install
</span>make <span class="nt">-j</span><span class="s2">"</span><span class="si">$(</span><span class="nb">nproc</span><span class="si">)</span><span class="s2">"</span>
make <span class="nb">install</span>
</code></pre></div></div>

<h3 id="4-ê²½ë¡œ-ì ìš©--ë²„ì „-í™•ì¸">4) ê²½ë¡œ ì ìš© + ë²„ì „ í™•ì¸</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PY_PREFIX</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>

python3 <span class="nt">-c</span> <span class="s2">"import sqlite3; print(sqlite3.sqlite_version)"</span>
<span class="c"># &gt;&gt;&gt; 3.35.0 ì´ìƒ ë‚˜ì˜¤ë©´ ë!</span>
</code></pre></div></div>

<h3 id="5-venv-ìƒˆë¡œ-ë§Œë“¤ê¸°-ì¤‘ìš”">5) venv ìƒˆë¡œ ë§Œë“¤ê¸° (ì¤‘ìš”)</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-m</span> venv <span class="nv">$HOME</span>/venvs/openwebui
<span class="nb">source</span> <span class="nv">$HOME</span>/venvs/openwebui/bin/activate
python <span class="nt">-c</span> <span class="s2">"import sqlite3; print(sqlite3.sqlite_version)"</span>  <span class="c"># ë‹¤ì‹œ 3.35+ í™•ì¸</span>
</code></pre></div></div>

<p>ì´ì œ <strong>ê°™ì€ ì—ëŸ¬ ì—†ì´</strong> Open WebUI / Chroma ëŒë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<hr />

<h2 id="í˜¹ì‹œ-ìƒê¸¸-ìˆ˜-ìˆëŠ”-ë”±-ë‘-ê°€ì§€-ì¶”ê°€-ì˜¤ë¥˜ë§Œ-ë©”ëª¨">í˜¹ì‹œ ìƒê¸¸ ìˆ˜ ìˆëŠ” â€œë”± ë‘ ê°€ì§€â€ ì¶”ê°€ ì˜¤ë¥˜ë§Œ ë©”ëª¨</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ssl</code> ëª¨ë“ˆ ì—†ë‹¤ëŠ” ì—ëŸ¬ â†’ <strong>ì˜¨ë¼ì¸ pip í•„ìš”í•  ë•Œë§Œ</strong> ë°œìƒ. ì§€ê¸ˆì€ ì˜¤í”„ë¼ì¸ì´ë¼ë©´ ë¬´ì‹œí•´ë„ OK.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">readline</code> íˆìŠ¤í† ë¦¬ ì•ˆ ë¨¹ìŒ â†’ ê¸°ëŠ¥ìƒ ë¶ˆí¸ì´ì§€ë§Œ <strong>ì¹˜ëª…ì  ì•„ë‹˜</strong>. í•„ìš”í•  ë•Œë§Œ ë‚˜ì¤‘ì— í•´ê²°.</p>
  </li>
</ul>

<blockquote>
  <p>ìš”ì•½: <strong>ì§€ê¸ˆì€ SQLiteë§Œ</strong> í•´ê²°í•˜ì„¸ìš”. ë‚˜ë¨¸ì§€ëŠ” ë¬¸ì œ ìƒê¸°ë©´ ê·¸ë•Œ ìµœì†Œë§Œ ë¶™ì´ë©´ ë¼ìš”.</p>
</blockquote>

<p>ì›í•˜ë©´ ìœ„ ì ˆì°¨ë¥¼ <strong>ë³µë¶™ìš© í•œ íŒŒì¼ ìŠ¤í¬ë¦½íŠ¸</strong> ë¡œ ë¬¶ì–´ ë“œë¦´ê²Œìš”.</p>

<p class="chat--user">

sqlite Precomiled Binaryê°€ ìˆëŠ”ë° ê·¸ëƒ¥ ì´ê±° ë°›ì•„ì„œ ì¨ë„ ë˜ë‚˜?

</p>

<p>ë„¤, ì „ì œ ì¡°ê±´ë§Œ ë§ìœ¼ë©´ <strong>Precompiled Binary</strong>(ë¯¸ë¦¬ ì»´íŒŒì¼ëœ sqlite3) ì¨ë„ ë©ë‹ˆë‹¤.<br />
ë‹¤ë§Œ Pythonì€ ì‹¤í–‰ ì‹œ ì‹œìŠ¤í…œ PATHì— ìˆëŠ” <code class="language-plaintext highlighter-rouge">sqlite3</code> CLIê°€ ì•„ë‹ˆë¼, <strong>ë¹Œë“œ ì‹œì ì— ë§í¬ëœ libsqlite3.so</strong> ë¥¼ ì”ë‹ˆë‹¤.</p>

<p>ì¦‰, ë‹¨ìˆœíˆ sqlite3 ì‹¤í–‰íŒŒì¼ë§Œ ë°›ì•„ì„œ ë‘ëŠ” ê±´ ì˜ë¯¸ ì—†ê³ , <strong>ë¼ì´ë¸ŒëŸ¬ë¦¬(.so)ì™€ í—¤ë”(.h)</strong> ê¹Œì§€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</p>

<hr />

<h2 id="1-í•„ìš”í•œ-êµ¬ì„±-ìš”ì†Œ">1) í•„ìš”í•œ êµ¬ì„± ìš”ì†Œ</h2>

<p>SQLite precompiled package ì•ˆì— ë³´í†µ ë‹¤ìŒì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">sqlite3</code> ì‹¤í–‰íŒŒì¼ (CLI)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">libsqlite3.so</code> (ë˜ëŠ” .a)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">sqlite3.h</code> ë“± ê°œë°œìš© í—¤ë” íŒŒì¼</p>
  </li>
</ul>

<p>ë§Œì•½ ì œê³µëœ ê²Œ <strong>CLI ì‹¤í–‰íŒŒì¼ë§Œ</strong> ì´ë¼ë©´ â†’ Python ì¬ë¹Œë“œì—ëŠ” ëª» ì”ë‹ˆë‹¤.</p>

<hr />

<h2 id="2-ì“¸-ìˆ˜-ìˆëŠ”-ê²½ìš°">2) ì“¸ ìˆ˜ ìˆëŠ” ê²½ìš°</h2>

<ul>
  <li>
    <p>precompiled bundleì´ <code class="language-plaintext highlighter-rouge">include/</code> ì™€ <code class="language-plaintext highlighter-rouge">lib/</code> ë””ë ‰í„°ë¦¬ë¥¼ í•¨ê»˜ ì œê³µ</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">libsqlite3.so</code>ê°€ <strong>3.35.0 ì´ìƒ</strong></p>
  </li>
  <li>
    <p>í•´ë‹¹ ë¹Œë“œê°€ <strong>RHEL 8.x glibc í˜¸í™˜</strong></p>
  </li>
</ul>

<p>ì„¤ì¹˜ ì˜ˆ:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/opt/sqlite-prebuilt
<span class="nb">tar </span>xf sqlite-precompiled.tar.gz <span class="nt">-C</span> <span class="nv">$HOME</span>/opt/sqlite-prebuilt

<span class="nb">export </span><span class="nv">SQLITE_PREFIX</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/opt/sqlite-prebuilt"</span>
<span class="nb">export </span><span class="nv">CPPFLAGS</span><span class="o">=</span><span class="s2">"-I</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/include"</span>
<span class="nb">export </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">"-L</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib -Wl,-rpath,</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib"</span>
<span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">"</span>

<span class="c"># ì´í›„ Python ë¹Œë“œ</span>
<span class="nb">cd </span>Python-3.11.12
./configure <span class="nt">--prefix</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/opt/python-3.11.12"</span> <span class="nt">--with-ensurepip</span><span class="o">=</span><span class="nb">install
</span>make <span class="nt">-j</span><span class="s2">"</span><span class="si">$(</span><span class="nb">nproc</span><span class="si">)</span><span class="s2">"</span>
make <span class="nb">install</span>
</code></pre></div></div>

<hr />

<h2 id="3-ì£¼ì˜í• -ì ">3) ì£¼ì˜í•  ì </h2>

<ul>
  <li>
    <p>precompiled binaryì˜ <code class="language-plaintext highlighter-rouge">.so</code> íŒŒì¼ì´ <strong>ì •ì  ê²½ë¡œ</strong>(<code class="language-plaintext highlighter-rouge">/usr/lib</code> ë“±)ì— ê¹”ë¦° ê²Œ ì•„ë‹ˆë¯€ë¡œ,<br />
ì‹¤í–‰ ì‹œ <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code> ë˜ëŠ” rpathë¡œ ê²½ë¡œë¥¼ ì•Œë ¤ì¤˜ì•¼ í•©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>glibc ë²„ì „ í˜¸í™˜ì„±ì´ ì•ˆ ë§ìœ¼ë©´ <code class="language-plaintext highlighter-rouge">symbol not found</code> ê°™ì€ ëŸ°íƒ€ì„ ì˜¤ë¥˜ê°€ ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>Python ë¹Œë“œ ì‹œ <code class="language-plaintext highlighter-rouge">_sqlite3</code> ëª¨ë“ˆì´ ì•ˆ ì¡íˆë©´, í—¤ë”(<code class="language-plaintext highlighter-rouge">sqlite3.h</code>) ê²½ë¡œê°€ CPPFLAGSì— ì¡í˜€ ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.</p>
  </li>
</ul>

<hr />

<p>ğŸ“Œ ê²°ë¡ :</p>

<ul>
  <li>
    <p><strong>ë¼ì´ë¸ŒëŸ¬ë¦¬+í—¤ë” í¬í•¨ëœ íŒ¨í‚¤ì§€</strong> ë©´ ë¬¸ì œ ì—†ì´ ì‚¬ìš© ê°€ëŠ¥</p>
  </li>
  <li>
    <p>CLIë§Œ ìˆëŠ” íŒ¨í‚¤ì§€ëŠ” Chroma ë¬¸ì œ í•´ê²° ë¶ˆê°€</p>
  </li>
  <li>
    <p>Python ë¹Œë“œì‹œ ìƒˆ sqliteë¥¼ ëª…ì‹œì ìœ¼ë¡œ ë§í¬í•´ì•¼ë§Œ ì ìš©ë¨</p>
  </li>
</ul>

<hr />

<p>ì›í•˜ì‹œë©´, ì œê°€ <strong>precompiled binaryê°€ ì“¸ ìˆ˜ ìˆëŠ”ì§€ ì²´í¬í•˜ëŠ” ëª…ë ¹ì–´ ì„¸íŠ¸</strong> ë¥¼ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br />
ê·¸ê±¸ë¡œ ì§€ê¸ˆ ê°€ì§€ê³  ìˆëŠ” íŒ¨í‚¤ì§€ê°€ Python ë¹Œë“œì— ë°”ë¡œ ì“¸ ìˆ˜ ìˆëŠ”ì§€ ë°”ë¡œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.<br />
ê·¸ê±° ë“œë¦´ê¹Œìš”?</p>

<p class="chat--user">

ì‘ soê°€ ì—†ë„¤

</p>

<p>ê·¸ëŸ¼ ê·¸ precompiled binaryëŠ” <strong>Python ë¹Œë“œì—ëŠ” ëª» ì”ë‹ˆë‹¤</strong>.</p>

<p>Pythonì´ ì‚¬ìš©í•˜ëŠ” <code class="language-plaintext highlighter-rouge">_sqlite3</code> ëª¨ë“ˆì€</p>

<ul>
  <li>
    <p><strong>sqlite3.h</strong>(í—¤ë” íŒŒì¼)</p>
  </li>
  <li>
    <p><strong>libsqlite3.so</strong>(ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬)</p>
  </li>
</ul>

<p>ì´ ë‘ ê°€ì§€ê°€ <strong>ë¹Œë“œ ì‹œì ì— í•„ìš”</strong> í•©ë‹ˆë‹¤.<br />
CLI ì‹¤í–‰íŒŒì¼(<code class="language-plaintext highlighter-rouge">sqlite3</code>)ë§Œìœ¼ë¡œëŠ” ì „í˜€ ì ìš©ì´ ì•ˆ ë¼ìš”.<br />
ê·¸ë˜ì„œ ê²°êµ­ SQLite ì†ŒìŠ¤ë¥¼ ë°›ì•„ì„œ ì§ì ‘ ë¹Œë“œí•´ì•¼ í•©ë‹ˆë‹¤.</p>

<hr />

<p>ğŸ“Œ <strong>ì •ë¦¬</strong></p>

<ul>
  <li>
    <p>ì§€ê¸ˆ ìƒí™©(so ì—†ìŒ) â†’ Python ì¬ë¹Œë“œ ì‹œ êµ¬ë²„ì „ ì‹œìŠ¤í…œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê·¸ëŒ€ë¡œ ë§í¬ â†’ Chroma ì—ëŸ¬ ì¬ë°œ</p>
  </li>
  <li>
    <p>í•´ê²° ë°©ë²• â†’ SQLite ì†ŒìŠ¤ tar.gz ë°›ì•„ì„œ <code class="language-plaintext highlighter-rouge">$HOME/opt/sqlite-&lt;ver&gt;</code>ì— ì„¤ì¹˜ í›„, Python ë¹Œë“œí•  ë•Œ ê·¸ ê²½ë¡œë¥¼ ì—°ê²°</p>
  </li>
</ul>

<hr />

<p>ì›í•˜ë©´ ì œê°€ <strong>ë”± SQLiteë§Œ</strong> ë¹Œë“œí•˜ê³  Pythonì— ë¶™ì´ëŠ” ìµœì†Œ ìŠ¤í¬ë¦½íŠ¸**ë¥¼ ë§Œë“¤ì–´ì„œ<br />
ê·¸ëŒ€ë¡œ ë³µë¶™í•´ì„œ ì“°ë©´ ë˜ê²Œ í•´ë“œë¦´ê¹Œìš”?<br />
ê·¸ë ‡ê²Œ í•˜ë©´ ë‹¤ë¥¸ ì˜ì¡´ì„± ê±´ë“œë¦´ í•„ìš” ì—†ì´ í•œ ë²ˆì— ëë‚©ë‹ˆë‹¤.</p>

<p class="chat--user">

sqlite ë¹Œë“œí•  ë•Œ ë‚´ê°€ ì„¤ì¹˜í•œ GCC ì‚¬ìš©í•˜ê³  ì‹¶ì–´.

</p>

<p>ì¢‹ì§€! <strong>sudo ì—†ì´, ë‚´ê°€ ì„¤ì¹˜í•œ GCCë¡œë§Œ</strong> SQLiteë¥¼ ë¹Œë“œí•´ì„œ <code class="language-plaintext highlighter-rouge">.so</code>ê¹Œì§€ ë§Œë“¤ê³ , ê·¸ê±¸ë¡œ íŒŒì´ì¬ì„ ë‹¤ì‹œ ë¹Œë“œí•˜ëŠ” ìµœì†Œ ì ˆì°¨ë¥¼ ë”± ì •ë¦¬í•´ì¤„ê²Œ. (RHEL 8.x, ì˜¤í”„ë¼ì¸ ê°€ì •)</p>

<hr />

<h1 id="0-ì „ì œ-ë‚´ê°€-ì„¤ì¹˜í•œ-gcc-ìœ„ì¹˜">0) ì „ì œ: ë‚´ê°€ ì„¤ì¹˜í•œ GCC ìœ„ì¹˜</h1>

<p>ì•„ë˜ì²˜ëŸ¼ ê²½ë¡œë§Œ ë„ˆ í™˜ê²½ì— ë§ê²Œ ë°”ê¿”ì¤˜.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë‚´ê°€ ì„¤ì¹˜í•œ GCC ë£¨íŠ¸(ì˜ˆ: $HOME/opt/gcc-12.3.0)</span>
<span class="nb">export </span><span class="nv">TOOLCHAIN_ROOT</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/opt/gcc-12.3.0"</span>

<span class="c"># PATHì™€ ëŸ°íƒ€ì„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê²½ë¡œ(ì¤‘ìš”)</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TOOLCHAIN_ROOT</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TOOLCHAIN_ROOT</span><span class="s2">/lib64:</span><span class="nv">$TOOLCHAIN_ROOT</span><span class="s2">/lib:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">"</span>

<span class="c"># í™•ì¸</span>
which gcc
gcc <span class="nt">--version</span>
</code></pre></div></div>

<blockquote>
  <p>í•„ìš”í•˜ë©´ binutilsê¹Œì§€ ê°™ì´ ì“´ë‹¤ëŠ” ì˜ë¯¸ë¡œ <code class="language-plaintext highlighter-rouge">AR/RANLIB/LD</code>ë„ ì§€ì • ê°€ëŠ¥:<br />
 <code class="language-plaintext highlighter-rouge">export AR="$TOOLCHAIN_ROOT/bin/ar"; export RANLIB="$TOOLCHAIN_ROOT/bin/ranlib"</code></p>
</blockquote>

<hr />

<h1 id="1-sqliteë¥¼-ë‚´-gccë¡œ-ë¹Œë“œê³µìœ -ë¼ì´ë¸ŒëŸ¬ë¦¬-so-ìƒì„±">1) SQLiteë¥¼ â€œë‚´ GCCâ€ë¡œ ë¹Œë“œ(+ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬ .so ìƒì„±)</h1>

<p>ì˜¤í”„ë¼ì¸ìœ¼ë¡œ ê°€ì ¸ì˜¨ <code class="language-plaintext highlighter-rouge">sqlite-autoconf-&lt;NNNNNNN&gt;.tar.gz</code> ê¸°ì¤€.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì„¤ì¹˜ ìœ„ì¹˜(ì›í•˜ëŠ” ê³³ìœ¼ë¡œ)</span>
<span class="nb">export </span><span class="nv">SQLITE_PREFIX</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/opt/sqlite-3.45.4"</span>

<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/src"</span> <span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">"</span>
<span class="nb">cd</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/src"</span>
<span class="nb">tar </span>xf sqlite-autoconf-3450400.tar.gz
<span class="nb">cd </span>sqlite-autoconf-3450400

<span class="c"># â˜… í•µì‹¬: CCë¥¼ ë‚´ GCCë¡œ ì§€ì •, -fPIC, rpathê¹Œì§€ ì¤€ë¹„</span>
<span class="nb">export </span><span class="nv">CC</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TOOLCHAIN_ROOT</span><span class="s2">/bin/gcc"</span>
<span class="nb">export </span><span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">"-O2 -fPIC </span><span class="se">\</span><span class="s2">
-DSQLITE_ENABLE_FTS5 </span><span class="se">\</span><span class="s2">
-DSQLITE_ENABLE_JSON1 </span><span class="se">\</span><span class="s2">
-DSQLITE_ENABLE_COLUMN_METADATA </span><span class="se">\</span><span class="s2">
-DSQLITE_ENABLE_RTREE </span><span class="se">\</span><span class="s2">
-DSQLITE_THREADSAFE=1"</span>
<span class="nb">export </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">"-Wl,-rpath,</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib"</span>

<span class="c"># configure â†’ build â†’ install</span>
./configure <span class="nt">--prefix</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">"</span> <span class="nt">--enable-shared</span> <span class="nt">--disable-static</span>
make <span class="nt">-j</span><span class="s2">"</span><span class="si">$(</span><span class="nb">nproc</span><span class="si">)</span><span class="s2">"</span>
make <span class="nb">install</span>

<span class="c"># ê²€ì¦</span>
<span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/bin/sqlite3"</span> <span class="nt">--version</span>            <span class="c"># 3.35.0 ì´ìƒ</span>
<span class="nb">ls</span> <span class="nt">-l</span> <span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib/libsqlite3.so"</span>          <span class="c"># .so ì¡´ì¬ í™•ì¸</span>
ldd <span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib/libsqlite3.so"</span> | <span class="nb">head</span>     <span class="c"># ë‚´ GCCì˜ libgcc_s ë“± ë§í¬ í™•ì¸</span>
</code></pre></div></div>

<blockquote>
  <p>TIP</p>

  <ul>
    <li>
      <p><code class="language-plaintext highlighter-rouge">--enable-shared</code>ë¡œ <code class="language-plaintext highlighter-rouge">.so</code> ìƒì„± í™•ì‹¤íˆ.</p>
    </li>
    <li>
      <p>rpathëŠ” ë‚˜ì¤‘ì— íŒŒì´ì¬ì´ ì´ <code class="language-plaintext highlighter-rouge">.so</code>ë¥¼ ì°¾ì„ ìˆ˜ ìˆê²Œ í•˜ëŠ” ì•ˆì „ì¥ì¹˜.</p>
    </li>
    <li>
      <p>ë§Œì•½ <code class="language-plaintext highlighter-rouge">ldd</code>ì—ì„œ ì´ìƒí•œ ì‹œìŠ¤í…œ libë¡œ ì—®ì´ë©´ <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code>ê°€ ì œëŒ€ë¡œ ì¡í˜”ëŠ”ì§€ ë‹¤ì‹œ í™•ì¸.</p>
    </li>
  </ul>

</blockquote>

<hr />

<h1 id="2-íŒŒì´ì¬ì„-ê·¸-sqlite-soí—¤ë”ë¡œ-ë§í¬í•´ì„œ-ì¬ë¹Œë“œ">2) íŒŒì´ì¬ì„ â€œê·¸ SQLite .so/í—¤ë”â€ë¡œ ë§í¬í•´ì„œ ì¬ë¹Œë“œ</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># íŒŒì´ì¬ ì„¤ì¹˜ ê²½ë¡œ</span>
<span class="nb">export </span><span class="nv">PY_PREFIX</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/opt/python-3.11.12"</span>

<span class="c"># ì»´íŒŒì¼/ë§í¬ì— SQLite ê²½ë¡œ ë°˜ì˜ + ëŸ°íƒ€ì„ rpath</span>
<span class="nb">export </span><span class="nv">CPPFLAGS</span><span class="o">=</span><span class="s2">"-I</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/include"</span>
<span class="nb">export </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">"-L</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib -Wl,-rpath,</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib"</span>
<span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib:</span><span class="nv">$TOOLCHAIN_ROOT</span><span class="s2">/lib64:</span><span class="nv">$TOOLCHAIN_ROOT</span><span class="s2">/lib:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">"</span>

<span class="c"># (ì˜µì…˜) íŒŒì´ì¬ë„ ë‚´ GCCë¡œ</span>
<span class="nb">export </span><span class="nv">CC</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TOOLCHAIN_ROOT</span><span class="s2">/bin/gcc"</span>

<span class="nb">cd</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/src"</span>
<span class="nb">tar </span>xf Python-3.11.12.tgz
<span class="nb">cd </span>Python-3.11.12

./configure <span class="nt">--prefix</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PY_PREFIX</span><span class="s2">"</span> <span class="nt">--with-ensurepip</span><span class="o">=</span><span class="nb">install
</span>make <span class="nt">-n</span> <span class="o">&gt;</span> /dev/null 2&gt;&amp;1  <span class="c"># (ìºì‹œ ìƒì„±ìš© ì‚´ì§ ëŒë¦¬ê¸°; ìƒëµ ê°€ëŠ¥)</span>
make <span class="nt">-j</span><span class="s2">"</span><span class="si">$(</span><span class="nb">nproc</span><span class="si">)</span><span class="s2">"</span>
make <span class="nb">install</span>

<span class="c"># PATH ì ìš© ë° í™•ì¸</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PY_PREFIX</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
python3 <span class="nt">-c</span> <span class="s2">"import sqlite3; print(sqlite3.sqlite_version)"</span>
<span class="c"># ==&gt; 3.35.0 ì´ìƒ ë‚˜ì˜¤ë©´ ì„±ê³µ!</span>
</code></pre></div></div>

<blockquote>
  <p>ë§Œì•½ <code class="language-plaintext highlighter-rouge">_sqlite3</code>ê°€ ë¹ ì¡Œë‹¤ëŠ” ë©”ì‹œì§€ê°€ ë‚˜ì˜¤ë©´:</p>

  <ul>
    <li>
      <p><code class="language-plaintext highlighter-rouge">CPPFLAGS/LDFLAGS/LD_LIBRARY_PATH</code>ê°€ ë§ëŠ”ì§€ í™•ì¸</p>
    </li>
    <li>
      <p>í•„ìš” ì‹œ <code class="language-plaintext highlighter-rouge">Modules/Setup.local</code>ì— ì•„ë˜ í•œ ì¤„ ì¶”ê°€ í›„ <code class="language-plaintext highlighter-rouge">make install</code> ë‹¤ì‹œ ì‹¤í–‰</p>
      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash
    
_sqlite3 _sqlite/module.c -I$SQLITE_PREFIX/include -L$SQLITE_PREFIX/lib -lsqlite3
    
</code></pre></div>      </div>
    </li>
  </ul>

</blockquote>

<hr />

<h1 id="3-venv-ìƒˆë¡œ-ë§Œë“¤ê¸°-ì¤‘ìš”">3) venv ìƒˆë¡œ ë§Œë“¤ê¸° (ì¤‘ìš”)</h1>

<p>ê¸°ì¡´ venvëŠ” êµ¬ë²„ì „ íŒŒì´ì¬ ê¸°ì¤€ì´ë¯€ë¡œ ìƒˆë¡œ ìƒì„±í•´ì•¼ í•´.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-m</span> venv <span class="nv">$HOME</span>/venvs/openwebui
<span class="nb">source</span> <span class="nv">$HOME</span>/venvs/openwebui/bin/activate
python <span class="nt">-c</span> <span class="s2">"import sqlite3; print(sqlite3.sqlite_version)"</span>  <span class="c"># 3.35+ ì¬í™•ì¸</span>
</code></pre></div></div>

<hr />

<h2 id="ìì£¼-ë¬»ëŠ”-í¬ì¸íŠ¸-ì§„ì§œ-í•µì‹¬ë§Œ">ìì£¼ ë¬»ëŠ” í¬ì¸íŠ¸ (ì§„ì§œ í•µì‹¬ë§Œ)</h2>

<ul>
  <li>
    <p><strong>Q. ê·¸ëƒ¥ sqlite3 ì‹¤í–‰íŒŒì¼ë§Œ ìˆìœ¼ë©´ ì•ˆ ë¼?</strong><br />
A. ì•ˆ ë¼. íŒŒì´ì¬ ë¹Œë“œì—ëŠ” <code class="language-plaintext highlighter-rouge">libsqlite3.so</code> + <code class="language-plaintext highlighter-rouge">sqlite3.h</code>ê°€ í•„ìš”.</p>
  </li>
  <li>
    <p><strong>Q. ê¼­ ë‚´ GCCì—¬ì•¼ í•˜ë‚˜?</strong><br />
A. ë„¤. ë„¤ì´í‹°ë¸Œ íˆ´ì²´ì¸ í˜¼ìš©í•˜ë©´ ëŸ°íƒ€ì„ì— <code class="language-plaintext highlighter-rouge">symbol not found</code> ë‚  ìˆ˜ ìˆìŒ. PATH/LD_LIBRARY_PATHë¥¼ ë‚´ GCCë¡œ ë¨¼ì € ì¡ì•„.</p>
  </li>
  <li>
    <p><strong>Q. rpath ê¼­ ë„£ì–´ì•¼ í•´?</strong><br />
A. ê°•ì¶”. ê·¸ëŸ¬ë©´ ì´í›„ì— <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code> ê¹œë°•í•´ë„ íŒŒì´ì¬ì´ <code class="language-plaintext highlighter-rouge">libsqlite3.so</code>ë¥¼ ë°”ë¡œ ì°¾ìŒ.</p>
  </li>
</ul>

<hr />

<p>í•„ìš”í•˜ë©´ ìœ„ ê³¼ì •ì„ <strong>ë³µë¶™ë§Œ í•˜ë©´ ë˜ëŠ” ë‹¨ì¼ bash ìŠ¤í¬ë¦½íŠ¸</strong> ë¡œ ë§Œë“¤ì–´ ì¤„ê²Œ. ê²½ë¡œë‘ ë²„ì „ë§Œ ë°”ê¾¸ë©´ ë°”ë¡œ ëŒì•„ê°€ê²Œ!</p>

<p class="chat--user">

-W1,-rpath ì´ê±´ ë­í•˜ëŠ” ì˜µì…˜ì´ì•¼?

</p>

<p>ì•„ë§ˆ ì œê°€ ì ì€ ê±´ <code class="language-plaintext highlighter-rouge">-Wl,-rpath</code> ì¸ë°, ê·¸ê±´ íƒ€ì´í•‘ì´ ì¡°ê¸ˆ ë¹„ìŠ·í•´ì„œ í—·ê°ˆë¦° ê±¸ ê±°ì˜ˆìš”.<br />
(<code class="language-plaintext highlighter-rouge">-W1</code>ì€ ì˜ë¯¸ ì—†ê³ , <code class="language-plaintext highlighter-rouge">-Wl</code>ì´ ë§ìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ì†Œë¬¸ì Lì€ â€œlinkerâ€ì˜ L)</p>

<hr />

<h2 id="-wl-rpathê²½ë¡œ-ì˜ë¯¸"><code class="language-plaintext highlighter-rouge">-Wl,-rpath,&lt;ê²½ë¡œ&gt;</code> ì˜ë¯¸</h2>

<ol>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">-Wl,</code></strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">gcc</code>ë‚˜ <code class="language-plaintext highlighter-rouge">g++</code> ê°™ì€ ì»´íŒŒì¼ ë“œë¼ì´ë²„ì— <strong>ë§ì»¤ ì˜µì…˜ì„ ê·¸ëŒ€ë¡œ ì „ë‹¬</strong> í•˜ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤.</p>
      </li>
      <li>
        <p>ì¦‰, <code class="language-plaintext highlighter-rouge">-Wl,ì˜µì…˜</code> â†’ â€œì´ ì˜µì…˜ì€ ë§ì»¤(ld)ì—ê²Œ ì£¼ëŠ” ê±°ì•¼â€ë¼ëŠ” ì˜ë¯¸.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">-rpath,&lt;ê²½ë¡œ&gt;</code></strong></p>

    <ul>
      <li>
        <p><strong>ëŸ°íƒ€ì„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê²€ìƒ‰ ê²½ë¡œ</strong> ë¥¼ ë°”ì´ë„ˆë¦¬ì— <strong>ì§ì ‘ ë°•ì•„ ë„£ìŒ</strong>.</p>
      </li>
      <li>
        <p>ì‹¤í–‰ íŒŒì¼ì´ ë§Œë“¤ì–´ì§ˆ ë•Œ ELF í—¤ë”ì˜ <code class="language-plaintext highlighter-rouge">RPATH</code>(ë˜ëŠ” <code class="language-plaintext highlighter-rouge">RUNPATH</code>)ì— <code class="language-plaintext highlighter-rouge">&lt;ê²½ë¡œ&gt;</code>ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.</p>
      </li>
      <li>
        <p>ê·¸ë˜ì„œ ì‹¤í–‰í•  ë•Œ <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code>ë¥¼ ë”°ë¡œ ì•ˆ ì¡ì•„ë„ í•´ë‹¹ ê²½ë¡œì—ì„œ <code class="language-plaintext highlighter-rouge">.so</code>ë¥¼ ìë™ìœ¼ë¡œ ì°¾ìŠµë‹ˆë‹¤.</p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h3 id="ì˜ˆì‹œ">ì˜ˆì‹œ</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc main.c <span class="nt">-L</span><span class="nv">$HOME</span>/opt/sqlite/lib <span class="nt">-lsqlite3</span> <span class="se">\</span>
    <span class="nt">-Wl</span>,-rpath,<span class="nv">$HOME</span>/opt/sqlite/lib
</code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">-Lâ€¦</code> : ë¹Œë“œí•  ë•Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê²€ìƒ‰ ê²½ë¡œ</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">-Wl,-rpath,â€¦</code> : ì‹¤í–‰í•  ë•Œë„ ì´ ê²½ë¡œë¥¼ ê¸°ì–µí•´ì„œ libsqlite3.so ì°¾ìŒ</p>
  </li>
</ul>

<hr />

<h3 id="ì™œ-pythonsqlite-ë¹Œë“œì—-ì“°ë‚˜">ì™œ Python/SQLite ë¹Œë“œì— ì“°ë‚˜?</h3>

<ul>
  <li>
    <p>í™ˆ ë””ë ‰í† ë¦¬ ê°™ì€ <strong>ë¹„í‘œì¤€ ê²½ë¡œ</strong> ì— ì„¤ì¹˜í•œ <code class="language-plaintext highlighter-rouge">.so</code>ëŠ” ê¸°ë³¸ ëŸ°íƒ€ì„ ê²½ë¡œì— ì—†ì–´ìš”.</p>
  </li>
  <li>
    <p>ë§¤ë²ˆ <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH=$HOME/opt/sqlite/lib</code> ì„¤ì •í•˜ëŠ” ê±´ ë²ˆê±°ë¡­ì£ .</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">-Wl,-rpath</code>ë¥¼ ë¹Œë“œ ì‹œ ë„£ì–´ë‘ë©´ <strong>ê·¸ íŒŒì´ì¬ ì‹¤í–‰ íŒŒì¼ì´ í•­ìƒ ê·¸ ê²½ë¡œì—ì„œ ë¨¼ì € .soë¥¼ ì°¾ê²Œ ë©ë‹ˆë‹¤</strong>.</p>
  </li>
</ul>

<hr />

<p>ì›í•˜ì‹œë©´ ì œê°€ <strong><code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code> ì—†ì´ë„ ë™ì‘í•˜ê²Œ rpath ë„£ì€ Python+SQLite ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸</strong>ë¥¼ ë°”ë¡œ ë§Œë“¤ì–´ë“œë¦´ê²Œìš”.<br />
ê·¸ëŸ¼ í™˜ê²½ë³€ìˆ˜ ê¹œë¹¡í•´ë„ ì•ˆì „í•©ë‹ˆë‹¤.</p>

<p class="chat--user">

ê·¼ë° sqliteí•  ë•Œë„ LDFLAGSë¥¼ ë„£ì–´ì¤˜ì•¼í•´?

</p>

<p>SQLite ë¹Œë“œí•  ë•ŒëŠ” <strong>ìƒí™©ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤</strong> ğŸ‘</p>

<hr />

<h2 id="1-ê¸°ë³¸ì ìœ¼ë¡œëŠ”-ldflags-ì—†ì–´ë„-ë¹Œë“œë¨">1. ê¸°ë³¸ì ìœ¼ë¡œëŠ” LDFLAGS ì—†ì–´ë„ ë¹Œë“œë¨</h2>

<ul>
  <li>
    <p>SQLite ìì²´ëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ì¡´ì„±ì´ ê±°ì˜ ì—†ì–´ìš”.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">./configure --prefix=â€¦</code>ë§Œìœ¼ë¡œë„ <code class="language-plaintext highlighter-rouge">libsqlite3.so</code> ì˜ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ê·¸ë˜ì„œ <strong>ìˆœìˆ˜ SQLite ë¹Œë“œ</strong> ë¼ë©´ <code class="language-plaintext highlighter-rouge">LDFLAGS</code>ë¥¼ ì•ˆ ì¤˜ë„ ë¬´ë°©í•©ë‹ˆë‹¤.</p>
  </li>
</ul>

<hr />

<h2 id="2-ê·¸ëŸ°ë°-ë‚´ê°€-ì›í•˜ëŠ”-rpathë¥¼-ë°•ê³ -ì‹¶ë‹¤ë©´-ldflags-í•„ìš”">2. ê·¸ëŸ°ë° ë‚´ê°€ ì›í•˜ëŠ” rpathë¥¼ ë°•ê³  ì‹¶ë‹¤ë©´ LDFLAGS í•„ìš”</h2>

<ul>
  <li>
    <p>SQLiteë¥¼ ì„¤ì¹˜í•œ <strong>ë¹„í‘œì¤€ ê²½ë¡œ</strong> ë¥¼ Python ë¹Œë“œ ì‹œ <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code> ì—†ì´ ì‚¬ìš©í•˜ê³  ì‹¶ìœ¼ë©´,<br />
SQLiteë¥¼ ë¹Œë“œí•  ë•Œë„ <code class="language-plaintext highlighter-rouge">.so</code> ì•ˆì— rpathë¥¼ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ì˜ˆ:</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">"-Wl,-rpath,</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib"</span>
</code></pre></div></div>

<p>ì´ë ‡ê²Œ í•˜ë©´ SQLite CLI(<code class="language-plaintext highlighter-rouge">sqlite3</code>)ë‚˜ SQLiteë¥¼ ë§í¬í•œ í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë  ë•Œ<br />
<code class="language-plaintext highlighter-rouge">$SQLITE_PREFIX/lib</code>ë¥¼ ìë™ìœ¼ë¡œ ê²€ìƒ‰í•©ë‹ˆë‹¤.</p>

<hr />

<h2 id="3-python-ë¹Œë“œì—ì„œëŠ”-ldflags-í•„ìˆ˜">3. Python ë¹Œë“œì—ì„œëŠ” LDFLAGS í•„ìˆ˜</h2>

<ul>
  <li>Pythonì´ <code class="language-plaintext highlighter-rouge">_sqlite3</code> ëª¨ë“ˆì„ ë§Œë“¤ ë•Œ <code class="language-plaintext highlighter-rouge">libsqlite3.so</code>ë¥¼ ì–´ë””ì„œ ì°¾ì„ì§€ ì•Œì•„ì•¼ í•´ì„œ,<br />
Python ë¹Œë“œí•  ë•ŒëŠ” ë°˜ë“œì‹œ
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">"-L</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib -Wl,-rpath,</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/lib"</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>ì²˜ëŸ¼ ë„£ì–´ì£¼ëŠ” ê²Œ ì•ˆì „í•©ë‹ˆë‹¤.</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">-Lâ€¦</code> â†’ ì»´íŒŒì¼/ë§í¬ ì‹œ ê²€ìƒ‰ ê²½ë¡œ</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">-Wl,-rpath,â€¦</code> â†’ ëŸ°íƒ€ì„ ê²€ìƒ‰ ê²½ë¡œ</p>
  </li>
</ul>

<hr />

<p>âœ… <strong>ì •ë¦¬</strong></p>

<ul>
  <li>
    <p><strong>SQLite ë¹Œë“œ:</strong> LDFLAGS ì—†ì´ë„ ê°€ëŠ¥. rpathë¥¼ ë„£ê³  ì‹¶ìœ¼ë©´ ì¶”ê°€.</p>
  </li>
  <li>
    <p><strong>Python ë¹Œë“œ:</strong> LDFLAGS í•„ìˆ˜. ìµœì†Œí•œ <code class="language-plaintext highlighter-rouge">-L&lt;sqlite lib&gt;</code> + <code class="language-plaintext highlighter-rouge">-Wl,-rpath,&lt;sqlite lib&gt;</code>ëŠ” ê¼­ ë„£ì–´ì•¼ ì•ˆì „.</p>
  </li>
</ul>

<hr />

<p>ì›í•˜ë©´ ì œê°€ <strong>SQLite ë¹Œë“œ ë•Œ rpath ì—†ì´, Python ë¹Œë“œ ë•Œë§Œ rpath ë„£ëŠ” ìµœì†Œ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸</strong> ë¥¼ ë°”ë¡œ ì§œ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br />
ê·¸ë ‡ê²Œ í•˜ë©´ ë¶ˆí•„ìš”í•œ ì˜µì…˜ì€ ì•ˆ ì“°ë©´ì„œë„ Pythonì—ì„œë§Œ ê²½ë¡œë¥¼ ê¸°ì–µí•˜ê²Œ í•  ìˆ˜ ìˆì–´ìš”.</p>

<p class="chat--user">

ê·¸ëŸ°ë° ì™œ ì´ë ‡ê²Œ ì„¤ì •í•  ê²ƒì´ ë§ì•„? configureì˜ defaultë¡œ ì–´ëŠì •ë„ reasonableí•œ ì„¤ì •ì´ ë“¤ì–´ê°€ìˆëŠ”ê±° ì•„ë‹ˆì•¼?

</p>

<p>ë§ì•„ìš” â€” <code class="language-plaintext highlighter-rouge">./configure</code>ê°€ ì´ë¯¸ ê½¤ <strong>reasonableí•œ ê¸°ë³¸ê°’</strong> ì„ ë„£ì–´ì£¼ê¸´ í•©ë‹ˆë‹¤.</p>

<p>ê·¸ëŸ°ë° ìš°ë¦¬ê°€ ì§€ê¸ˆ ì„¤ì •ì„ ë§ì´ ê±´ë“œë¦¬ëŠ” ì´ìœ ëŠ” <strong>ê¸°ë³¸ê°’ì´ "ì‹œìŠ¤í…œì— ì´ë¯¸ ê¹”ë¦° ê²ƒ" ê¸°ì¤€</strong> ì´ê¸° ë•Œë¬¸ì´ì—ìš”.<br />
RHEL 8ì²˜ëŸ¼ ì˜¤ë˜ëœ OS + sudo ë¶ˆê°€ í™˜ê²½ì—ì„œëŠ” ê·¸ ê¸°ë³¸ê°’ì´ <strong>ì›í•˜ëŠ” ìµœì‹  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì „í˜€ ì•ˆ ë´…ë‹ˆë‹¤</strong>.</p>

<hr />

<h2 id="1-configureì˜-ê¸°ë³¸-ë™ì‘">1. <code class="language-plaintext highlighter-rouge">configure</code>ì˜ ê¸°ë³¸ ë™ì‘</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">./configure</code>ëŠ” <code class="language-plaintext highlighter-rouge">PATH</code>ì™€ í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê²½ë¡œ(<code class="language-plaintext highlighter-rouge">/usr/include</code>, <code class="language-plaintext highlighter-rouge">/usr/lib64</code> ë“±)ì—ì„œ í—¤ë”ì™€ .soë¥¼ ì°¾ìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ìµœì‹  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ <strong>ë¹„í‘œì¤€ ê²½ë¡œ</strong>(<code class="language-plaintext highlighter-rouge">$HOME/opt/...</code>)ì— ì„¤ì¹˜í•´ë„, íŠ¹ë³„íˆ ì•Œë ¤ì£¼ì§€ ì•Šìœ¼ë©´ ê·¸ëƒ¥ ë¬´ì‹œí•˜ê³  ì‹œìŠ¤í…œ ê¸°ë³¸ êµ¬ë²„ì „ì„ ì”ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ì˜ˆ: Pythonì´ <code class="language-plaintext highlighter-rouge">_sqlite3</code> ëª¨ë“ˆì„ ë¹Œë“œí•  ë•Œ <code class="language-plaintext highlighter-rouge">/usr/include/sqlite3.h</code> + <code class="language-plaintext highlighter-rouge">/usr/lib64/libsqlite3.so</code>ë¥¼ ì°¾ì•„ì„œ ë§í¬ â†’ ê²°ê³¼ì ìœ¼ë¡œ 3.26.0.</p>
  </li>
</ul>

<hr />

<h2 id="2-ì™œ-ìš°ë¦¬ê°€-cppflagsldflagsë¥¼-ì£¼ë‚˜">2. ì™œ ìš°ë¦¬ê°€ CPPFLAGS/LDFLAGSë¥¼ ì£¼ë‚˜?</h2>

<ul>
  <li>
    <p>"ì•¼, í—¤ë”ëŠ” ì—¬ê¸° ìˆë‹¤!" â†’ <code class="language-plaintext highlighter-rouge">CPPFLAGS="-I$SQLITE_PREFIX/include"</code></p>
  </li>
  <li>
    <p>"ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì—¬ê¸° ìˆë‹¤!" â†’ <code class="language-plaintext highlighter-rouge">LDFLAGS="-L$SQLITE_PREFIX/lib"</code></p>
  </li>
  <li>
    <p>"ì‹¤í–‰í•  ë•Œë„ ì—¬ê¸°ì„œ ì°¾ì•„ë¼!" â†’ <code class="language-plaintext highlighter-rouge">-Wl,-rpath,$SQLITE_PREFIX/lib</code></p>
  </li>
  <li>
    <p>ì´ê±¸ ì•ˆ í•˜ë©´, ë¹Œë“œ ì‹œ <strong>ì»´íŒŒì¼ëŸ¬ëŠ” ìµœì‹  í—¤ë”ë¥¼ ëª» ë³´ê³ </strong> ,<br />
ì‹¤í–‰ ì‹œ <strong>ëŸ°íƒ€ì„ ë¡œë”ëŠ” ìµœì‹  .soë¥¼ ëª» ì°¾ìŠµë‹ˆë‹¤</strong>.</p>
  </li>
</ul>

<hr />

<h2 id="3-rpathê¹Œì§€-ë„£ëŠ”-ì´ìœ ">3. rpathê¹Œì§€ ë„£ëŠ” ì´ìœ </h2>

<ul>
  <li>
    <p>ê¸°ë³¸ì ìœ¼ë¡œ ì‹¤í–‰ ì‹œ <code class="language-plaintext highlighter-rouge">.so</code>ëŠ” <code class="language-plaintext highlighter-rouge">/lib</code>, <code class="language-plaintext highlighter-rouge">/usr/lib</code>, <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code>ì—ì„œ ì°¾ìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>í™ˆ ë””ë ‰í† ë¦¬ì— ê¹”ë¦° <code class="language-plaintext highlighter-rouge">.so</code>ëŠ” ê¸°ë³¸ ê²€ìƒ‰ ê²½ë¡œì— ì—†ì–´ìš”.</p>
  </li>
  <li>
    <p>ë§¤ë²ˆ <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code>ë¥¼ ì„¸íŒ…í•˜ì§€ ì•Šìœ¼ë ¤ë©´ rpathë¡œ ë°•ì•„ë‘ëŠ” ê²Œ í¸ë¦¬.</p>
  </li>
</ul>

<hr />

<h2 id="4-ìš”ì•½-ë¹„ìœ ">4. ìš”ì•½ ë¹„ìœ </h2>

<p>ê¸°ë³¸ <code class="language-plaintext highlighter-rouge">configure</code>ëŠ” <strong>"ë¶€ì—Œ(ì‹œìŠ¤í…œ ê¸°ë³¸ ê²½ë¡œ)ì— ìˆëŠ” ì¬ë£Œë§Œ"</strong> ì”ë‹ˆë‹¤.<br />
ìš°ë¦¬ê°€ í•œ ê±´ <strong>"ëƒ‰ì¥ê³ (í™ˆ ë””ë ‰í† ë¦¬)ì— ìˆëŠ” ìµœì‹  ì¬ë£Œë„ ì¨!"</strong> í•˜ê³  ê²½ë¡œë¥¼ ì•Œë ¤ì£¼ëŠ” ê±°ì˜ˆìš”.</p>

<hr />

<p>ì›í•˜ë©´ ì œê°€ <strong>ì´ ê²½ë¡œ ì„¤ì •ì„ ìµœì†Œí™”í•´ì„œ, SQLite ìµœì‹ íŒë§Œ ì“°ê²Œ í•˜ëŠ” configure ì˜ˆì œ</strong> ë¥¼ ì•„ì£¼ ê°„ë‹¨íˆ ì •ë¦¬í•´ ë“œë¦´ê¹Œìš”?<br />
ê·¸ëŸ¬ë©´ ì§€ê¸ˆì²˜ëŸ¼ CPPFLAGS/LDFLAGSë¥¼ ì—¬ëŸ¬ ì¤„ ì“°ì§€ ì•Šê³ ë„ ê¹”ë”í•˜ê²Œ ë©ë‹ˆë‹¤.</p>

<p class="chat--user">

ì•„ë‹ˆ rpathë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë‹¤ ì´í•´í•´ export CFLAGS="-O2 -fPIC \ -DSQLITE_ENABLE_FTS5 \ -DSQLITE_ENABLE_JSON1 \ -DSQLITE_ENABLE_COLUMN_METADATA \ -DSQLITE_ENABLE_RTREE \ -DSQLITE_THREADSAFE=1" ì´ê±°ëŠ” ì¢€ ê·€ì°®ì•„ì„œ ì•ˆë„£ì—ˆì–´ ê·¼ë°

</p>

<p>ê´œì°®ì•„â€”ì € í”Œë˜ê·¸ë“¤(<strong>FTS5/JSON1/RTREE/COLUMN_METADATA/THREADSAFE</strong>)ì€ â€œê¸°ëŠ¥ í† ê¸€â€ì¼ ë¿ì´ê³ , <strong>Chroma + Open WebUIê°€ ëŒì•„ê°€ëŠ”ë° í•„ìˆ˜ëŠ” ì•„ë‹ˆì•¼.</strong><br />
í˜„ì¬ ëª©í‘œ(ì—ëŸ¬ë§Œ ì•ˆ ë‚˜ê²Œ)ëŠ” <strong>ë²„ì „ â‰¥ 3.35.0</strong> ì´ í•µì‹¬ì´ê³ , ë¹Œë“œì—ì„  <strong><code class="language-plaintext highlighter-rouge">-fPIC</code></strong> ì •ë„ë§Œ ì±™ê¸°ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.</p>

<h2 id="ê²°ë¡ -ë¨¼ì €">ê²°ë¡  ë¨¼ì €</h2>

<ul>
  <li>
    <p><strong>ì§€ê¸ˆ ë‹¹ì¥ì€</strong> <code class="language-plaintext highlighter-rouge">CFLAGS="-O2 -fPIC"</code> ë§Œ ì¤˜ë„ OK.</p>
  </li>
  <li>
    <p>ì¶”ê°€ ê¸°ëŠ¥ì´ í•„ìš”í•  ë•Œë§Œ ê·¸ë•Œ ë‹¤ì‹œ ì¼œë©´ ë©ë‹ˆë‹¤. (ë‹¤ì‹œ ë¹Œë“œí•´ë„ Python ìª½ í° ìˆ˜ì • í•„ìš” ì—†ìŒ)</p>
  </li>
</ul>

<h2 id="ê°-ì˜µì…˜ì´-ì‹¤ì œë¡œ-ë­˜-ì¼œëŠ”ì§€-í•„ìš”í• -ë•Œë§Œ">ê° ì˜µì…˜ì´ ì‹¤ì œë¡œ ë­˜ ì¼œëŠ”ì§€ (í•„ìš”í•  ë•Œë§Œ!)</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">SQLITE_ENABLE_FTS5</code> : í’€í…ìŠ¤íŠ¸ ê²€ìƒ‰(FTS5) ì—”ì§„. ëŒ€ë¶€ë¶„ì˜ ì•±ì— <strong>í•„ìˆ˜ ì•„ë‹˜</strong>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">SQLITE_ENABLE_JSON1</code> : JSON í•¨ìˆ˜(<code class="language-plaintext highlighter-rouge">json_extract</code> ë“±). ì¿¼ë¦¬ì—ì„œ JSON ë‹¤ë£° ë•Œë§Œ í•„ìš”.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">SQLITE_ENABLE_RTREE</code> : R-Tree ì¸ë±ìŠ¤(ê³µê°„/ë²”ìœ„). íŠ¹ìˆ˜í•œ ê²½ìš°ì—ë§Œ.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">SQLITE_ENABLE_COLUMN_METADATA</code> : ì»¬ëŸ¼ ë©”íƒ€ë°ì´í„° API. ì¼ë°˜ ì‚¬ìš©ì—” ê±°ì˜ ë¶ˆí•„ìš”.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">SQLITE_THREADSAFE=1</code> : ìŠ¤ë ˆë“œ ì„¸ì´í”„. <strong>ê¸°ë³¸ê°’ì´ 1</strong> ì´ë¯€ë¡œ êµ³ì´ ì§€ì • ì•ˆ í•´ë„ ë¨.</p>
  </li>
</ul>

<h2 id="ìµœì†Œ-ì•ˆì „-ë¹Œë“œ-ì˜ˆì‹œ">â€œìµœì†Œ ì•ˆì „â€ ë¹Œë“œ ì˜ˆì‹œ</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ìµœì†Œë§Œ: ì„±ëŠ¥ + ê³µìœ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒì„±</span>
<span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">"-O2 -fPIC"</span> <span class="se">\</span>
./configure <span class="nt">--prefix</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">"</span> <span class="nt">--enable-shared</span> <span class="nt">--disable-static</span>
make <span class="nt">-j</span><span class="s2">"</span><span class="si">$(</span><span class="nb">nproc</span><span class="si">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> make <span class="nb">install</span>
</code></pre></div></div>

<h2 id="ë‚˜ì¤‘ì—-ê¸°ëŠ¥ì´-í•„ìš”í•´ì§€ë©´ì„ íƒ">ë‚˜ì¤‘ì— ê¸°ëŠ¥ì´ í•„ìš”í•´ì§€ë©´(ì„ íƒ)</h2>

<p>ê·€ì°®ì€ ë§¤í¬ë¡œ ëŒ€ì‹  <strong>configure í”Œë˜ê·¸</strong> ë¡œ ì¼œë„ ë©ë‹ˆë‹¤:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">"-O2 -fPIC"</span> <span class="se">\</span>
./configure <span class="nt">--prefix</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">"</span> <span class="nt">--enable-shared</span> <span class="nt">--disable-static</span> <span class="se">\</span>
  <span class="nt">--enable-fts5</span> <span class="nt">--enable-json1</span> <span class="nt">--enable-rtree</span>
make <span class="nt">-j</span><span class="s2">"</span><span class="si">$(</span><span class="nb">nproc</span><span class="si">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> make <span class="nb">install</span>
</code></pre></div></div>

<p>(= ë‚´ë¶€ì ìœ¼ë¡œ ìœ„ ë§¤í¬ë¡œë“¤ì„ ì •ì˜í•´ì¤ë‹ˆë‹¤)</p>

<h2 id="í˜„ì¬-ë¹Œë“œì—-ë­ê°€-ì¼œì¡ŒëŠ”ì§€-í™•ì¸">í˜„ì¬ ë¹Œë“œì— ë­ê°€ ì¼œì¡ŒëŠ”ì§€ í™•ì¸</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$SQLITE_PREFIX</span>/bin/sqlite3 <span class="nt">-cmd</span> <span class="s2">"PRAGMA compile_options;"</span> <span class="s2">":memory:"</span> <span class="s2">".quit"</span>
<span class="c"># ë˜ëŠ”</span>
<span class="nv">$SQLITE_PREFIX</span>/bin/sqlite3 <span class="nt">-line</span> <span class="s2">":memory:"</span> <span class="s2">"PRAGMA compile_options;"</span>
</code></pre></div></div>

<p>ì—¬ê¸°ì— <code class="language-plaintext highlighter-rouge">ENABLE_FTS5</code>, <code class="language-plaintext highlighter-rouge">ENABLE_JSON1</code> ê°™ì€ í•­ëª©ì´ ëœ¨ë©´ ì¼œì§„ ê²ƒ.</p>

<hr />

<h3 id="ìš”ì•½">ìš”ì•½</h3>

<ul>
  <li>
    <p><strong>ì§€ê¸ˆì€ CFLAGS ìµœì†Œ(-O2 -fPIC)ë§Œ</strong> ë„£ê³  ì§„í–‰í•´ë„ ë¬´ë°©.</p>
  </li>
  <li>
    <p>Chroma ì—ëŸ¬ëŠ” â€œë²„ì „â€ ì´ìŠˆì˜€ê³ , ë¶€ê°€ ê¸°ëŠ¥ í”Œë˜ê·¸ëŠ” í•„ìˆ˜ ì•„ë‹˜.</p>
  </li>
  <li>
    <p>ë‚˜ì¤‘ì— í•„ìš”í•´ì§€ë©´ <code class="language-plaintext highlighter-rouge">--enable-fts5/json1/rtree</code>ë¡œ ë‹¤ì‹œ ë¹Œë“œí•˜ë©´ ë.</p>
  </li>
</ul>

<p class="chat--user">

no such module: fts5 enable ì„ í•´ì•¼í•˜ë‚˜ë³¸

</p>

<p>ë§ì•„ìš”â€”ê·¸ ë©”ì‹œì§€ëŠ” <strong>FTS5ê°€ êº¼ì ¸ ìˆì–´ì„œ</strong> ë‚˜ëŠ” ê±°ì˜ˆìš”.<br />
ì´ë¯¸ í•œ ë²ˆ ë¹Œë“œí•˜ì…¨ë‹¤ë©´, <strong>SQLiteë§Œ ë‹¤ì‹œ ì»´íŒŒì¼</strong> í•´ì„œ <code class="language-plaintext highlighter-rouge">libsqlite3.so</code>ë¥¼ êµì²´í•˜ë©´ ë©ë‹ˆë‹¤. (Pythonì€ ë‹¤ì‹œ ì•ˆ ë¹Œë ¤ë„ ë¨â€”ê°™ì€ ê²½ë¡œì˜ <code class="language-plaintext highlighter-rouge">.so</code>ë¥¼ ëŸ°íƒ€ì„ì— ì“°ë‹ˆê¹Œìš”)</p>

<h2 id="ë¹ ë¥¸-í•´ê²°-ì»´íŒŒì¼ì—-í¬í•¨ì‹œí‚¤ëŠ”-ë°©ë²•">ë¹ ë¥¸ í•´ê²° (ì»´íŒŒì¼ì— í¬í•¨ì‹œí‚¤ëŠ” ë°©ë²•)</h2>

<p>ì•„ë˜ì²˜ëŸ¼ <code class="language-plaintext highlighter-rouge">--enable-fts5</code>ë§Œ ì¶”ê°€í•´ì„œ <strong>ë‹¤ì‹œ ë¹Œë“œÂ·ì„¤ì¹˜</strong> í•˜ì„¸ìš”.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì „ì œ: ì´ì „ê³¼ ê°™ì€ PREFIXë¥¼ ì‚¬ìš© (ì˜ˆ: $SQLITE_PREFIX)</span>
<span class="nb">cd</span> <span class="nv">$HOME</span>/src/sqlite-autoconf-3450400   <span class="c"># ì†ŒìŠ¤ ë””ë ‰í„°ë¦¬ë¡œ ì´ë™</span>

<span class="c"># (ë‚´ GCCë¥¼ ì“°ëŠ” ì¤‘ì´ë¼ë©´) CC/LD_LIBRARY_PATHë¥¼ ì´ì „ê³¼ ë™ì¼í•˜ê²Œ ì¡ì•„ë‘ì„¸ìš”.</span>
<span class="c"># export CC="$TOOLCHAIN_ROOT/bin/gcc"</span>
<span class="c"># export LD_LIBRARY_PATH="$TOOLCHAIN_ROOT/lib64:$LD_LIBRARY_PATH"</span>

<span class="c"># ìµœì†Œ ì˜µì…˜ + FTS5ë§Œ ì¼œê¸°</span>
<span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">"-O2 -fPIC"</span> <span class="se">\</span>
./configure <span class="nt">--prefix</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nt">--enable-shared</span> <span class="nt">--disable-static</span> <span class="se">\</span>
  <span class="nt">--enable-fts5</span>

make <span class="nt">-j</span><span class="s2">"</span><span class="si">$(</span><span class="nb">nproc</span><span class="si">)</span><span class="s2">"</span>
make <span class="nb">install</span>
</code></pre></div></div>

<h3 id="ì¼œì¡ŒëŠ”ì§€-í™•ì¸">ì¼œì¡ŒëŠ”ì§€ í™•ì¸</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/bin/sqlite3"</span> <span class="nt">-line</span> <span class="s2">":memory:"</span> <span class="s2">"PRAGMA compile_options;"</span>
<span class="c"># ì¶œë ¥ì— ENABLE_FTS5 ê°€ ë³´ì´ë©´ OK</span>
</code></pre></div></div>

<h3 id="ê°„ë‹¨-ì‹¤ì „-í…ŒìŠ¤íŠ¸">ê°„ë‹¨ ì‹¤ì „ í…ŒìŠ¤íŠ¸</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">/bin/sqlite3"</span> <span class="o">&lt;&lt;</span><span class="sh">'</span><span class="no">SQL</span><span class="sh">'
CREATE VIRTUAL TABLE t USING fts5(content);
INSERT INTO t(content) VALUES ('hello world'), ('hello sqlite'), ('fts5 works');
SELECT rowid, content FROM t WHERE t MATCH 'hello';
</span><span class="no">SQL
</span></code></pre></div></div>

<h2 id="python-ìª½ë„-ë˜ëŠ”ì§€-í™•ì¸">Python ìª½ë„ ë˜ëŠ”ì§€ í™•ì¸</h2>

<p><code class="language-plaintext highlighter-rouge">rpath</code> ë˜ëŠ” <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code>ê°€ ì´ë¯¸ ì¡í˜€ ìˆë‹¤ë©´, <strong>Pythonì€ ìë™ìœ¼ë¡œ ìƒˆ libsqlite3.so</strong> ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python - <span class="o">&lt;&lt;</span><span class="sh">'</span><span class="no">PY</span><span class="sh">'
import sqlite3
con = sqlite3.connect(':memory:')
con.execute("CREATE VIRTUAL TABLE t USING fts5(content)")
con.executemany("INSERT INTO t(content) VALUES (?)", [('hello world',), ('hello sqlite',), ('fts5 works',)])
print(list(con.execute("SELECT rowid, content FROM t WHERE t MATCH 'hello'")))
</span><span class="no">PY
</span></code></pre></div></div>

<h2 id="ì°¸ê³ -ì˜µì…˜">ì°¸ê³  (ì˜µì…˜)</h2>

<ul>
  <li>JSON í•¨ìˆ˜ë„ í•„ìš”í•˜ë©´ ë‹¤ìŒì²˜ëŸ¼ ê°™ì´ ì¼¤ ìˆ˜ ìˆì–´ìš”:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">"-O2 -fPIC"</span> ./configure <span class="nt">--prefix</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SQLITE_PREFIX</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nt">--enable-shared</span> <span class="nt">--disable-static</span> <span class="se">\</span>
  <span class="nt">--enable-fts5</span> <span class="nt">--enable-json1</span>
</code></pre></div>    </div>
  </li>
  <li><strong>ì¬ë¹Œë“œ í›„ Python ì¬ì„¤ì¹˜ëŠ” ë¶ˆí•„ìš”</strong> í•©ë‹ˆë‹¤. ë‹¨, <strong>ë‹¤ë¥¸ ê²½ë¡œ</strong> ì— ì„¤ì¹˜í–ˆë‹¤ë©´ <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code>ë‚˜ <code class="language-plaintext highlighter-rouge">-Wl,-rpath,&lt;ê²½ë¡œ&gt;</code>ë¡œ ìƒˆ ê²½ë¡œë¥¼ ë³´ì´ê²Œ í•´ì•¼ í•´ìš”.</li>
</ul>

<p>í•„ìš”í•˜ë©´ ìœ„ ê³¼ì •ì„ <strong>í•œ ë²ˆì— ë„ëŠ” ì§§ì€ ìŠ¤í¬ë¦½íŠ¸</strong> ë¡œ ë¬¶ì–´ ë“œë¦´ê²Œìš”.</p>

<p class="chat--user">

OperationalError: table embeddings already exists

</p>

<p>ì˜¤ë¥˜ ë©”ì‹œì§€ ê·¸ëŒ€ë¡œ í•´ì„í•˜ë©´, ì§€ê¸ˆ ì‚¬ìš© ì¤‘ì¸ SQLite DB ì•ˆì— <strong><code class="language-plaintext highlighter-rouge">embeddings</code> í…Œì´ë¸”ì´ ì´ë¯¸ ìˆì–´ì„œ</strong> ìƒˆë¡œ ë§Œë“œëŠ” ì¿¼ë¦¬(ì•„ë§ˆ <code class="language-plaintext highlighter-rouge">CREATE TABLE embeddings (...)</code>)ê°€ ë‹¤ì‹œ ì‹¤í–‰ë˜ë©° í„°ì§„ ê²ë‹ˆë‹¤. ë³´í†µ â‘  ê°™ì€ DB íŒŒì¼ì„ ë‘ ë²ˆ ì´ˆê¸°í™”í–ˆê±°ë‚˜, â‘¡ ì˜ˆì „ ë°ì´í„°ê°€ ë‚¨ì•„ ìˆëŠ”ë° ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œì§ì´ <code class="language-plaintext highlighter-rouge">IF NOT EXISTS</code> ì—†ì´ ì‹¤í–‰ë  ë•Œ ìƒê²¨ìš”.</p>

<p>ì•„ë˜ ì¤‘ í¸í•œ ê±¸ë¡œ í•´ê²°í•˜ì„¸ìš” â€” â€œì—ëŸ¬ë§Œ ì•ˆ ë‚˜ê²Œâ€ ê¸°ì¤€ìœ¼ë¡œ <strong>ê°€ì¥ ë¹¨ë¦¬ ëë‚˜ëŠ” ìˆœì„œ</strong> ì˜ˆìš”.</p>

<hr />

<h2 id="1-ê°€ì¥-ë¹ ë¦„-ìƒˆ-ë°ì´í„°-ë””ë ‰í„°ë¦¬dbë¡œ-ì‹œì‘">1) ê°€ì¥ ë¹ ë¦„: ìƒˆ ë°ì´í„° ë””ë ‰í„°ë¦¬/DBë¡œ ì‹œì‘</h2>

<p>(Open WebUI/Chromaê°€ ì“°ëŠ” <strong>ë°ì´í„° í´ë”</strong> ë§Œ ìƒˆë¡œ ì“°ë©´ ë°”ë¡œ í•´ê²°)</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì˜ˆ: Open WebUIë¥¼ ìƒˆ ë°ì´í„° í´ë”ë¡œ</span>
open-webui serve <span class="nt">--data-dir</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/openwebui-data-clean"</span>
</code></pre></div></div>

<p>í˜¹ì€(Chromaë¥¼ ì§ì ‘ ì“°ëŠ” ê²½ìš°):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Chroma ì˜ì† ë””ë ‰í„°ë¦¬ë¥¼ ìƒˆë¡œ</span>
<span class="nb">export </span><span class="nv">CHROMA_PERSIST_DIRECTORY</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/chroma-data-clean"</span>
<span class="c"># ì•±/ìŠ¤í¬ë¦½íŠ¸ ì¬ì‹¤í–‰</span>
</code></pre></div></div>

<blockquote>
  <p>ì¥ì : ê¸°ì¡´ íŒŒì¼ ê±´ë“œë¦¬ì§€ ì•ŠìŒ.<br />
 ë‹¨ì : ì´ì „ ëŒ€í™”/ì¸ë±ìŠ¤ëŠ” ìƒˆ í´ë”ë¡œ ë¶„ë¦¬ë¨(í•„ìš”í•˜ë©´ ë‚˜ì¤‘ì— ì˜®ê¸¸ ìˆ˜ ìˆìŒ).</p>
</blockquote>

<hr />

<h2 id="2-ê¸°ì¡´-dbì—ì„œ-í•´ë‹¹-í…Œì´ë¸”ë§Œ-ì‚­ì œ">2) ê¸°ì¡´ DBì—ì„œ í•´ë‹¹ í…Œì´ë¸”ë§Œ ì‚­ì œ</h2>

<p>â€œê·¸ DB íŒŒì¼ì„ ê·¸ëŒ€ë¡œ ì“°ë˜, ì¶©ëŒ í…Œì´ë¸”ë§Œ ì •ë¦¬â€í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. (ë°ì´í„°ê°€ ë‚ ì•„ê°ˆ ìˆ˜ ìˆìœ¼ë‹ˆ <strong>ì§„ì§œ í•„ìš” ì—†ì„ ë•Œë§Œ</strong>)</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># DB íŒŒì¼ ìœ„ì¹˜ íŒŒì•…</span>
<span class="c"># (ì˜ˆ: open-webuiì˜ --data-dir ì•ˆ, chroma.sqlite / chroma.db / app.db ë“±)</span>
<span class="c"># ëª» ì°¾ê² ìœ¼ë©´:</span>
<span class="c"># find "$HOME" -maxdepth 3 -type f \( -name "*.db" -o -name "*.sqlite*" \)</span>

<span class="c"># ìŠ¤í‚¤ë§ˆ í™•ì¸</span>
sqlite3 /path/to/your.db <span class="s2">".tables"</span>
sqlite3 /path/to/your.db <span class="s2">".schema embeddings"</span>

<span class="c"># ì •ë§ ì‚­ì œí•´ë„ ë˜ëŠ”ì§€ ê±´ìˆ˜ í™•ì¸</span>
sqlite3 /path/to/your.db <span class="s2">"SELECT COUNT(*) FROM embeddings;"</span>

<span class="c"># ì‚­ì œ (ì£¼ì˜: ë³µêµ¬ ì–´ë ¤ì›€)</span>
sqlite3 /path/to/your.db <span class="s2">"DROP TABLE embeddings;"</span>
</code></pre></div></div>

<p>ê·¸ ë‹¤ìŒ ì•±ì„ ë‹¤ì‹œ ì‹¤í–‰í•´ ë³´ì„¸ìš”. ì´ˆê¸°í™”/ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„ì—ì„œ í…Œì´ë¸”ì„ ë‹¤ì‹œ ë§Œë“¤ ê²ë‹ˆë‹¤.</p>

<hr />

<h2 id="3-ì½”ë“œì„¤ì •-ìª½ì—ì„œ-ì´ë¯¸-ìˆìœ¼ë©´-ê±´ë„ˆë›°ê¸°">3) ì½”ë“œ/ì„¤ì • ìª½ì—ì„œ â€œì´ë¯¸ ìˆìœ¼ë©´ ê±´ë„ˆë›°ê¸°â€</h2>

<p>ë§Œì•½ <strong>ì§ì ‘ ì‘ì„±í•œ ìŠ¤í¬ë¦½íŠ¸</strong> ê°€ í…Œì´ë¸”ì„ ë§Œë“œëŠ” ê±°ë¼ë©´, ì¿¼ë¦¬ë¥¼ ë°”ê¿”ì£¼ì„¸ìš”:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sql

CREATE TABLE IF NOT EXISTS embeddings ( ... );
</code></pre></div></div>

<p>(ê°€ìƒ í…Œì´ë¸” FTS5ì˜ ê²½ìš°ì—” <code class="language-plaintext highlighter-rouge">CREATE VIRTUAL TABLE IF NOT EXISTS</code> ì§€ì› ë²„ì „ì´ ì œí•œì ì¼ ìˆ˜ ìˆìœ¼ë‹ˆ, í™•ì‹¤íˆ í•˜ë ¤ë©´ ì‹¤í–‰ ì „ì— ì¡´ì¬ ì—¬ë¶€ë¥¼ ì²´í¬í•´ì„œ ë¶„ê¸°í•˜ì„¸ìš”.)</p>

<hr />

<h3 id="ì²´í¬-í¬ì¸íŠ¸-ì™œ-ë‹¤ì‹œ-ìƒê²¼ëŠ”ì§€">ì²´í¬ í¬ì¸íŠ¸ (ì™œ ë‹¤ì‹œ ìƒê²¼ëŠ”ì§€)</h3>

<ul>
  <li>
    <p><strong>ê°™ì€ DB íŒŒì¼ì„ ë‘ í”„ë¡œì„¸ìŠ¤ê°€</strong> ê°ê° â€œì´ˆê¸°í™”â€ ë¡œì§ìœ¼ë¡œ ì‹œì‘ â†’ ì¶©ëŒ.</p>
  </li>
  <li>
    <p>ì˜ˆì „ ë²„ì „/ë‹¤ë¥¸ ì•±ì´ ê°™ì€ DB íŒŒì¼ì„ ì‚¬ìš© â†’ ìŠ¤í‚¤ë§ˆ ì´ë¦„ ê²¹ì¹¨.</p>
  </li>
  <li>
    <p>ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ì— <code class="language-plaintext highlighter-rouge">IF NOT EXISTS</code>ê°€ ë¹ ì§.</p>
  </li>
</ul>

<hr />

<p>í•„ìš”í•˜ë©´ ì§€ê¸ˆ ì“°ëŠ” <strong>DB íŒŒì¼ ê²½ë¡œë¥¼ ê°™ì´ ì ê²€</strong> í•˜ê³ , â€œë“œë vs ìƒˆ í´ë”ë¡œ ì‹œì‘â€ ì¤‘ ì–´ë–¤ ê²Œ ì•ˆì „í•œì§€ ë°”ë¡œ íŒë‹¨í•´ ë“œë¦´ê²Œìš”. ì‚¬ìš© ì¤‘ì¸ ë°ì´í„° ë””ë ‰í„°ë¦¬/DB íŒŒì¼ ê²½ë¡œë§Œ ì•Œë ¤ì£¼ë©´ ë©ë‹ˆë‹¤.</p>

<p class="chat--user">

openwebuië¥¼ ë¶„ë¦¬ëœ ê³µê°„ë§ì—ì„œ ì„œë¹„ìŠ¤í• ê±°ì•¼. ë­ ë”°ë¡œ ì˜µì…˜ì„ ì£¼ê±°ë‚˜ í•´ì•¼í•  ê²ƒ ìˆì–´?

</p>

<p>ì¢‹ì•„â€”<strong>ë¶„ë¦¬ëœ íì‡„ë§(airâ€‘gapped/ë‚´ë¶€ë§)</strong>ì—ì„œ Open WebUIë¥¼ ì•ˆì •ì ìœ¼ë¡œ ëŒë¦´ ë•Œ â€œê¼­ ì±™ê¸°ë©´ ì¢‹ì€ ì˜µì…˜â€ë§Œ ë”± ì •ë¦¬í•´ ì¤„ê²Œ. ì „ë¶€ pip ì‹¤í–‰ ê¸°ì¤€ì´ì§€ë§Œ Docker/ì¿ ë²„ë„¤í‹°ìŠ¤ë„ ë™ì¼í•œ ENV ê°œë…ì´ì•¼.</p>

<hr />

<h2 id="í•µì‹¬ë§Œ-6ì¤„-ìš”ì•½">í•µì‹¬ë§Œ 6ì¤„ ìš”ì•½</h2>

<ol>
  <li>
    <p><strong>OFFLINE_MODE</strong> ì¼œì„œ ë²„ì „ì²´í¬/ì™¸ë¶€ ë‹¤ìš´ë¡œë“œ ë¹„í™œì„±í™”</p>
  </li>
  <li>
    <p><strong>ë‚´ë¶€ ë„ë©”ì¸ìœ¼ë¡œ WEBUI_URL</strong> ì§€ì •(SSO/ë¦¬ë‹¤ì´ë ‰íŠ¸ìš©)</p>
  </li>
  <li>
    <p><strong>íšŒì›ê°€ì…/ê¶Œí•œ í†µì œ</strong> : ENABLE_SIGNUP, DEFAULT_USER_ROLE</p>
  </li>
  <li>
    <p><strong>ì›¹ê²€ìƒ‰/RAG ì™¸ë¶€ í˜¸ì¶œ</strong> ì„ êº¼ë‘ê±°ë‚˜ ë‚´ë¶€ ê²€ìƒ‰ì—”ì§„ë§Œ í—ˆìš©</p>
  </li>
  <li>
    <p><strong>ëª¨ë¸/ì„ë² ë”©</strong> ì€ ë¯¸ë¦¬ ìºì‹œ(ëª¨ë¸ íŒŒì¼ì„ ë‚´ë¶€ ê²½ë¡œì— ì¤€ë¹„)</p>
  </li>
  <li>
    <p><strong>PersistentConfig ì£¼ì˜</strong> : ì²˜ìŒ ê°’ì´ DBì— ì €ì¥ë¨(ë°”ê¾¸ë ¤ë©´ UIì—ì„œ ìˆ˜ì •)</p>
  </li>
</ol>

<p>ì´ê²Œ ì „ë¶€ì•¼. ì•„ë˜ì— ë°”ë¡œ ì“¸ ìˆ˜ ìˆëŠ” ì˜ˆì‹œ ë¶™ì¼ê²Œ.</p>

<hr />

<h2 id="ìµœì†Œ-ê¶Œì¥-í™˜ê²½ë³€ìˆ˜-íì‡„ë§-ì•ˆì „íŒ">ìµœì†Œ ê¶Œì¥ í™˜ê²½ë³€ìˆ˜ (íì‡„ë§ ì•ˆì „íŒ)</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1) ì˜¤í”„ë¼ì¸ ëª¨ë“œ: ë²„ì „ ì²´í¬/í—ˆê¹…í˜ì´ìŠ¤ ìë™ ë‹¤ìš´ ë“± ë¹„í™œì„±í™”</span>
<span class="nb">export </span><span class="nv">OFFLINE_MODE</span><span class="o">=</span>True  <span class="c"># ì˜¤í”„ë¼ì¸ ë™ì‘ ê°€ì´ë“œì— ëª…ì‹œë¨ :contentReference[oaicite:0]{index=0}</span>

<span class="c"># 2) ë‚´ë¶€ URL ëª…ì‹œ(SSO/ë¦¬ë‹¤ì´ë ‰íŠ¸, ì¼ë¶€ ê¸°ëŠ¥ì—ì„œ í•„ìˆ˜)</span>
<span class="nb">export </span><span class="nv">WEBUI_URL</span><span class="o">=</span><span class="s2">"https://openwebui.internal.example"</span>  <span class="c"># PersistentConfig í•­ëª© :contentReference[oaicite:1]{index=1}</span>

<span class="c"># 3) ì‚¬ìš©ì ë§Œë“¤ê¸° ì •ì±…</span>
<span class="nb">export </span><span class="nv">ENABLE_SIGNUP</span><span class="o">=</span>False                  <span class="c"># ì‹ ê·œ ê°€ì… ë§‰ê¸°(ì´ˆê¸° ê´€ë¦¬ìë§Œ) :contentReference[oaicite:2]{index=2}</span>
<span class="nb">export </span><span class="nv">DEFAULT_USER_ROLE</span><span class="o">=</span><span class="s2">"pending"</span>          <span class="c"># ê°€ì… í—ˆìš© ì‹œì—ë„ ê¸°ë³¸ì€ ë³´ë¥˜ ê¶Œì¥ :contentReference[oaicite:3]{index=3}</span>

<span class="c"># 4) ì›¹ê²€ìƒ‰ ì™„ì „ ì°¨ë‹¨(ê¸°ë³¸ Falseì§€ë§Œ, ëª…ì‹œí•´ ë‘ë©´ ì¢‹ìŒ)</span>
<span class="nb">export </span><span class="nv">ENABLE_WEB_SEARCH</span><span class="o">=</span>False              <span class="c"># ì›¹ê²€ìƒ‰ í† ê¸€(í¼ì‹œìŠ¤í„´íŠ¸) :contentReference[oaicite:4]{index=4}</span>

<span class="c"># 5) CORS/ì¿ í‚¤(ë‚´ë¶€ HTTPSë¼ë©´ Secure ì¿ í‚¤ ì‚¬ìš© ê¶Œì¥)</span>
<span class="nb">export </span><span class="nv">CORS_ALLOW_ORIGIN</span><span class="o">=</span><span class="s2">"https://openwebui.internal.example"</span>  <span class="c"># ê¸°ë³¸ì€ * â†’ ë‚´ë¶€ë§Œ í—ˆìš©ìœ¼ë¡œ ì¡°ì´ê¸° :contentReference[oaicite:5]{index=5}</span>
<span class="nb">export </span><span class="nv">WEBUI_AUTH_COOKIE_SECURE</span><span class="o">=</span>True        <span class="c"># ë‚´ë¶€ë§ì´ë”ë¼ë„ HTTPSë©´ True ê¶Œì¥ :contentReference[oaicite:6]{index=6}</span>

<span class="c"># 6) ë°ì´í„° ê²½ë¡œ(ì˜ì†)</span>
<span class="nb">export </span><span class="nv">DATA_DIR</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.open-webui"</span>         <span class="c"># ë°ì´í„° ì˜ì† ê²½ë¡œ ê¶Œì¥ ì„¤ì • ë¬¸ì„œì— ì–¸ê¸‰ :contentReference[oaicite:7]{index=7}</span>

<span class="c"># (pip ì‹¤í–‰)</span>
open-webui serve <span class="nt">--port</span> 8080
</code></pre></div></div>

<blockquote>
  <p>ì°¸ê³ : <strong>OFFLINE_MODE=True</strong> ë¡œ ë‘ë©´ ìë™ ì—…ë°ì´íŠ¸ ì²´í¬/ì„ë² ë”© ëª¨ë¸ ìë™ ë‹¤ìš´ë¡œë“œ ë“±ì´ êº¼ì§€ê³ , ì˜¤í”„ë¼ì¸ì—ì„œë„ ì˜¤ë¥˜ ì—†ì´ ë™ì‘í•˜ë„ë¡ ë³´í˜¸í•´ì¤˜. ë‹¨, ì™¸ë¶€ APIÂ·OAuthÂ·ì›¹ê²€ìƒ‰ ìì²´ë¥¼ â€œê¸°ëŠ¥ì ìœ¼ë¡œ ë§‰ëŠ”â€ ìŠ¤ìœ„ì¹˜ëŠ” ì•„ë‹ˆì•¼. ë„¤ê°€ ì§ì ‘ ë„ê±°ë‚˜ ë‚´ë¶€ ë¦¬ì†ŒìŠ¤ë¡œë§Œ ì—°ê²°í•´ì•¼ í•´. <a href="https://docs.openwebui.com/tutorials/offline-mode/">Open WebUI</a></p>
</blockquote>

<hr />

<h2 id="ì„ íƒ-ë‚´ë¶€-ê²€ìƒ‰íˆ´ë§Œ-í—ˆìš©í•˜ê³ -ì‹¶ë‹¤ë©´">(ì„ íƒ) ë‚´ë¶€ ê²€ìƒ‰/íˆ´ë§Œ í—ˆìš©í•˜ê³  ì‹¶ë‹¤ë©´</h2>

<ul>
  <li>
    <p><strong>ì›¹ê²€ìƒ‰ ì™„ì „ ê¸ˆì§€</strong> : <code class="language-plaintext highlighter-rouge">ENABLE_WEB_SEARCH=False</code> ìœ ì§€. <a href="https://docs.openwebui.com/getting-started/env-configuration/">Open WebUI</a></p>
  </li>
  <li>
    <p><strong>ë‚´ë¶€ SearXNGë§Œ ì‚¬ìš©</strong> : ìì²´ SearXNGë¥¼ ì„¸ì›Œì„œ</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">ENABLE_WEB_SEARCH</span><span class="o">=</span>True
<span class="nb">export </span><span class="nv">WEB_SEARCH_ENGINE</span><span class="o">=</span>searxng
<span class="nb">export </span><span class="nv">SEARXNG_QUERY_URL</span><span class="o">=</span><span class="s2">"http://searxng.internal/search?q=&lt;query&gt;&amp;format=json"</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>ì²˜ëŸ¼ ë‚´ë¶€ ì—”ë“œí¬ì¸íŠ¸ë§Œ ì“°ê²Œ í•´ë„ ë¼. <a href="https://docs.openwebui.com/getting-started/env-configuration/">Open WebUI</a></p>

<hr />

<h2 id="ì„ íƒ-ë‚´ë¶€-llm-ì—”ë“œí¬ì¸íŠ¸ë§Œ-ì“°ê¸°">(ì„ íƒ) ë‚´ë¶€ LLM ì—”ë“œí¬ì¸íŠ¸ë§Œ ì“°ê¸°</h2>

<p>OpenAIâ€‘í˜¸í™˜ ì„œë²„(ì˜ˆ: ì‚¬ë‚´ vLLM/LM Studio/í”„ë¡ì‹œ ë“±)ë¥¼ <strong>Connections</strong> ì—ì„œ ì¶”ê°€í•˜ë©´ ë¼. Base URLì„ ë‚´ë¶€ ì£¼ì†Œë¡œë§Œ ì¡ìœ¼ë©´ ì™¸ë¶€ë¡œ ëª» ë‚˜ê°€. ê°€ì´ë“œëŠ” â€œOpenAI/í˜¸í™˜ ì„œë²„ ì‹œì‘í•˜ê¸°â€ì— ìˆì–´. <a href="https://docs.openwebui.com/getting-started/quick-start/starting-with-openai/?utm_source=chatgpt.com">Open WebUI+1</a></p>

<hr />

<h2 id="ì„ë² ë”©whisper-ê°™ì€-ëª¨ë¸ì€-ì‚¬ì „-ìºì‹œ">ì„ë² ë”©/Whisper ê°™ì€ ëª¨ë¸ì€ â€œì‚¬ì „ ìºì‹œâ€</h2>

<p>ì˜¤í”„ë¼ì¸ ëª¨ë“œì—ì„  í—ˆê¹…í˜ì´ìŠ¤ì—ì„œ <strong>ìë™ ë‹¤ìš´ë¡œë“œê°€ ë§‰íˆë¯€ë¡œ</strong> , ëª¨ë¸ íŒŒì¼ì„ <strong>ë¯¸ë¦¬</strong> ë°›ì•„ì„œ Open WebUI ìºì‹œ ê²½ë¡œì— ë„£ì–´ë‘¬ì•¼ í•´:</p>

<ul>
  <li>
    <p>ì„ë² ë”© ëª¨ë¸: <code class="language-plaintext highlighter-rouge">/app/backend/data/cache/embedding/models/</code></p>
  </li>
  <li>
    <p>whisper: <code class="language-plaintext highlighter-rouge">/app/backend/data/cache/whisper/models/</code><br />
í™˜ê²½ë³€ìˆ˜ë¡œ ë””í´íŠ¸ ëª¨ë¸ë„ ì§€ì • ê°€ëŠ¥(<code class="language-plaintext highlighter-rouge">RAG_EMBEDDING_MODEL</code>, <code class="language-plaintext highlighter-rouge">WHISPER_MODEL</code>). <a href="https://docs.openwebui.com/tutorials/offline-mode/">Open WebUI</a></p>
  </li>
</ul>

<hr />

<h2 id="ë³´ì•ˆìš´ì˜-íŒí•„ìš”í•œ-ê²ƒë§Œ">ë³´ì•ˆ/ìš´ì˜ íŒ(í•„ìš”í•œ ê²ƒë§Œ)</h2>

<ul>
  <li>
    <p><strong>ì²« ê³„ì •ì´ ê´€ë¦¬ì</strong> : ì´ˆê¸° ì…‹ì—… ë•Œ ë§Œë“  ì²« ê³„ì •ì´ Adminì´ë¼ ì‚¬ìš©ì ìŠ¹ì¸/ì •ì±…ì„ ì œì–´í•  ìˆ˜ ìˆì–´. <a href="https://docs.openwebui.com/getting-started/quick-start/?utm_source=chatgpt.com">Open WebUI</a></p>
  </li>
  <li>
    <p><strong>API í‚¤ ì œì–´</strong> : í•„ìš”í•˜ë©´ <strong>API Key Endpoint Restrictions</strong> ë¡œ í—ˆìš© ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì œí•œí•  ìˆ˜ ìˆì–´(ë‚´ë¶€ APIë§Œ í—ˆìš© ëª©ë¡ìœ¼ë¡œ). <a href="https://docs.openwebui.com/getting-started/env-configuration/">Open WebUI</a></p>
  </li>
  <li>
    <p><strong>PersistentConfig ì£¼ì˜</strong> : <code class="language-plaintext highlighter-rouge">ENABLE_SIGNUP</code>, <code class="language-plaintext highlighter-rouge">WEBUI_URL</code> ë“±ì€ <strong>ì²˜ìŒ ê°’ì´ ë‚´ë¶€ DBì— ì €ì¥</strong> ë¼. ë‚˜ì¤‘ì— ë°”ê¾¸ë ¤ë©´ Admin UIì—ì„œ ìˆ˜ì •í•˜ê±°ë‚˜ <code class="language-plaintext highlighter-rouge">ENABLE_PERSISTENT_CONFIG=False</code>ë¡œ ì¼ì‹œ í•´ì œ í›„ ì ìš©. <a href="https://docs.openwebui.com/getting-started/env-configuration/">Open WebUI</a></p>
  </li>
  <li>
    <p><strong>í”„ë¡ì‹œê°€ ìˆëŠ” ë‚´ë¶€ë§</strong> : ì›¹ë¡œë”/ì›¹ê²€ìƒ‰ì´ ë‚´ë¶€ í”„ë¡ì‹œë§Œ í†µê³¼í•˜ë„ë¡ <code class="language-plaintext highlighter-rouge">http_proxy/https_proxy/no_proxy</code>ë¥¼ ì§€ì›í•´. <a href="https://docs.openwebui.com/getting-started/env-configuration/">Open WebUI</a></p>
  </li>
</ul>

<hr />

<h2 id="ì²´í¬ë¦¬ìŠ¤íŠ¸-ì§„ì§œ-ìµœì†Œ">ì²´í¬ë¦¬ìŠ¤íŠ¸ (ì§„ì§œ ìµœì†Œ)</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">OFFLINE_MODE=True</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">WEBUI_URL</code>ì„ ë‚´ë¶€ ë„ë©”ì¸ìœ¼ë¡œ ì§€ì •</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ENABLE_SIGNUP=False</code> ë˜ëŠ” ê¸°ë³¸ ê¶Œí•œì„ <code class="language-plaintext highlighter-rouge">pending</code>ìœ¼ë¡œ</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ENABLE_WEB_SEARCH=False</code>(ë˜ëŠ” ë‚´ë¶€ SearXNGë¡œ í•œì •)</p>
  </li>
  <li>
    <p>ì„ë² ë”©/Whisper ëª¨ë¸ <strong>ì‚¬ì „ ìºì‹œ</strong> ì™„ë£Œ</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">DATA_DIR</code>ë¡œ ì˜ì† ê²½ë¡œ ì§€ì •</p>
  </li>
</ul>

<p>ì›í•˜ë©´ ë„¤ í™˜ê²½ ë³€ìˆ˜/ë‚´ë¶€ ì—”ë“œí¬ì¸íŠ¸ì— ë§ì¶˜ <strong>í•œ ì¤„ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸</strong>(pipìš©)ë¥¼ ë°”ë¡œ ë§Œë“¤ì–´ ì¤„ê²Œ.</p>

<p class="chat--user">

ê¸°ë³¸ í¬íŠ¸ ë²ˆí˜¸ê°€ ë­ì•¼

</p>

<p>pipë¡œ ì„¤ì¹˜í•´ì„œ <code class="language-plaintext highlighter-rouge">open-webui serve</code>ë¡œ ì‹¤í–‰í•˜ë©´ <strong>ê¸°ë³¸ í¬íŠ¸ëŠ” 8080</strong> ì´ì—ìš”.</p>

<ul>
  <li>
    <p>ê·¸ë˜ì„œ ë¸Œë¼ìš°ì €ì—ì„œ <code class="language-plaintext highlighter-rouge">http://localhost:8080</code>ìœ¼ë¡œ ì ‘ì†í•˜ë©´ ë©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>í¬íŠ¸ë¥¼ ë°”ê¾¸ê³  ì‹¶ìœ¼ë©´:</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>open-webui serve <span class="nt">--port</span> 3000
</code></pre></div></div>

<p>ì²˜ëŸ¼ <code class="language-plaintext highlighter-rouge">--port</code> ì˜µì…˜ì„ ì£¼ë©´ ë¼ìš”.</p>

<p class="chat--user">

endpointë¡œ ëª¨ë¸ ì¶”ê°€í•˜ëŠ” ë²•

</p>

<p>ì˜¤ì¼€ì´â€”ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì´ë¯¸ ì•Œê³  ìˆë‹¤ëŠ” ì „ì œë¡œ, <strong>Open WebUIì— ëª¨ë¸(í”„ë¡œë°”ì´ë”) ì¶”ê°€</strong> í•˜ëŠ” ê°€ì¥ ì‰¬ìš´ ë°©ë²•ì„ ë¹ ë¥´ê²Œ ì •ë¦¬í• ê²Œìš”. (pip ì„¤ì¹˜ ê¸°ì¤€, íì‡„ë§ë„ OK)</p>

<hr />

<h2 id="1-uiì—ì„œ-ì¶”ê°€-ê°€ì¥-ê°„ë‹¨">1) UIì—ì„œ ì¶”ê°€ (ê°€ì¥ ê°„ë‹¨)</h2>

<ol>
  <li>
    <p>ë¸Œë¼ìš°ì €ì—ì„œ Open WebUI ì ‘ì† â†’ <strong>Settings â†’ Models â†’ Providers</strong></p>
  </li>
  <li>
    <p><strong>Add Provider</strong> í´ë¦­ â†’ ìœ í˜•ì—ì„œ <strong>OpenAI Compatible</strong>(ë˜ëŠ” <strong>Ollama</strong>) ì„ íƒ</p>
  </li>
  <li>
    <p>ì…ë ¥:</p>

    <ul>
      <li>
        <p><strong>Base URL</strong> : ì˜ˆ) <code class="language-plaintext highlighter-rouge">http://&lt;host&gt;:&lt;port&gt;/v1</code></p>
      </li>
      <li>
        <p><strong>API Key</strong> : ì—”ë“œí¬ì¸íŠ¸ í‚¤ (í•„ìš” ì—†ìœ¼ë©´ ë¹ˆ ê°’/í† í°í˜•ì‹ì— ë§ê²Œ)</p>
      </li>
      <li>
        <p>(ì˜µì…˜) <strong>Custom Headers</strong> : ì‚¬ë‚´ í”„ë¡ì‹œ/ê²Œì´íŠ¸ì›¨ì´ì—ì„œ í—¤ë” ìš”êµ¬ ì‹œ ì¶”ê°€</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Save</strong> â†’ <strong>Refresh/Sync models</strong>(ëª¨ë¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨)</p>

    <ul>
      <li>ëª©ë¡ì´ ë¹„ë©´ â€œ<strong>Model name</strong> â€ì„ ì§ì ‘ ì…ë ¥í•´ ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€(ì—”ì§„ì´ ë…¸ì¶œí•˜ëŠ” ì •í™•í•œ ëª¨ë¸ ID í•„ìš”)</li>
    </ul>
  </li>
  <li>
    <p>ì›í•˜ëŠ” ëª¨ë¸ì— <strong>Set as default</strong>(ê¸°ë³¸ ëª¨ë¸ ì§€ì •)</p>
  </li>
</ol>

<blockquote>
  <p>vLLM/LM Studio/í”„ë¡ì‹œë¥˜ëŠ” ëŒ€ë¶€ë¶„ <code class="language-plaintext highlighter-rouge">â€¦/v1</code>ê°€ Base URLì´ê³ , ëª¨ë¸ IDëŠ” ì„œë²„ê°€ ê°€ì§„ ì´ë¦„ ê·¸ëŒ€ë¡œ ì¨ì•¼ ëª©ë¡ì— ì˜ ëœ¹ë‹ˆë‹¤.</p>
</blockquote>

<hr />

<h2 id="2-í™˜ê²½ë³€ìˆ˜ë¡œ-ë¯¸ë¦¬-ë°•ì•„ë‘ê³ -ì‹¤í–‰-ì´ˆê¸°-ìë™-ì„¤ì •">2) í™˜ê²½ë³€ìˆ˜ë¡œ ë¯¸ë¦¬ ë°•ì•„ë‘ê³  ì‹¤í–‰ (ì´ˆê¸° ìë™ ì„¤ì •)</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># OpenAI-í˜¸í™˜ ì—”ë“œí¬ì¸íŠ¸ ì˜ˆì‹œ</span>
<span class="nb">export </span><span class="nv">OPENAI_API_BASE_URL</span><span class="o">=</span><span class="s2">"http://&lt;host&gt;:&lt;port&gt;/v1"</span>
<span class="nb">export </span><span class="nv">OPENAI_API_KEY</span><span class="o">=</span><span class="s2">"sk-xxxxxxxx"</span>   <span class="c"># í•„ìš” ì—†ìœ¼ë©´ ìƒëµ ê°€ëŠ¥</span>
open-webui serve <span class="nt">--port</span> 8080
</code></pre></div></div>

<ul>
  <li>
    <p>ì‹¤í–‰ í›„ <strong>Settings â†’ Models</strong> ì— ë“¤ì–´ê°€ë©´ ìœ„ ê°’ì´ ë°˜ì˜ë˜ì–´ ìˆìŒ.</p>
  </li>
  <li>
    <p>ì—¬ëŸ¬ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì“°ë ¤ë©´ UIì—ì„œ í”„ë¡œë°”ì´ë”ë¥¼ ì¶”ê°€ë¡œ ë” ë“±ë¡í•˜ì„¸ìš”.</p>
  </li>
</ul>

<hr />

<h2 id="3-ì„ íƒ-ollama-ì „ìš©">3) (ì„ íƒ) Ollama ì „ìš©</h2>

<ul>
  <li>
    <p>UIì—ì„œ <strong>Ollama</strong> ìœ í˜• ì„ íƒ í›„ <strong>Base URL</strong> : <code class="language-plaintext highlighter-rouge">http://&lt;host&gt;:11434</code></p>
  </li>
  <li>
    <p>ë˜ëŠ”</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">OLLAMA_BASE_URL</span><span class="o">=</span><span class="s2">"http://&lt;host&gt;:11434"</span>
open-webui serve
</code></pre></div></div>

<hr />

<h2 id="4-ì—°ê²°-ì „-ì—”ë“œí¬ì¸íŠ¸-ì •ìƒì¸ì§€-ë¹ ë¥¸-ìê°€í…ŒìŠ¤íŠ¸">4) ì—°ê²° ì „ â€œì—”ë“œí¬ì¸íŠ¸ ì •ìƒì¸ì§€â€ ë¹ ë¥¸ ìê°€í…ŒìŠ¤íŠ¸</h2>

<h3 id="ëª¨ë¸-ëª©ë¡-í™•ì¸-openai-í˜¸í™˜-í‘œì¤€">ëª¨ë¸ ëª©ë¡ í™•ì¸ (OpenAI í˜¸í™˜ í‘œì¤€)</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-sS</span> <span class="nt">-H</span> <span class="s2">"Authorization: Bearer </span><span class="nv">$OPENAI_API_KEY</span><span class="s2">"</span> <span class="se">\</span>
  &lt;BASE_URL&gt;/models
</code></pre></div></div>

<ul>
  <li>
    <p>200 OK + ëª¨ë¸ ë¦¬ìŠ¤íŠ¸ê°€ ë‚˜ì˜¤ë©´ OK.</p>
  </li>
  <li>
    <p>ì—ëŸ¬ë©´ <strong>Base URL ëì—<code class="language-plaintext highlighter-rouge">/v1</code> ëˆ„ë½</strong>, í‚¤/í—¤ë”, CORS/í”„ë¡ì‹œ ë“±ì„ ì ê²€.</p>
  </li>
</ul>

<hr />

<h2 id="5-í”í•œ-ì´ìŠˆ--ë°”ë¡œ-í•´ê²°">5) í”í•œ ì´ìŠˆ &amp; ë°”ë¡œ í•´ê²°</h2>

<ul>
  <li>
    <p><strong>ëª¨ë¸ì´ ì•ˆ ëœ¸</strong> :</p>

    <ul>
      <li>
        <p>Base URLì´ <code class="language-plaintext highlighter-rouge">/v1</code>ì¸ì§€ í™•ì¸</p>
      </li>
      <li>
        <p>ë‚´ë¶€ë§ì´ë©´ <strong>ëª¨ë¸ ë¦¬ìŠ¤íŠ¸ ìºì‹œ</strong> ë•Œë¬¸ì— ì•ˆ ë³´ì¼ ìˆ˜ â†’ Settingsì—ì„œ <strong>Refresh/Sync</strong></p>
      </li>
      <li>
        <p>ê·¸ë˜ë„ ì•ˆ ëœ¨ë©´ <strong>ëª¨ë¸ ID ìˆ˜ë™ ì…ë ¥</strong>(ì„œë²„ì—ì„œ ì“°ëŠ” ì •í™•í•œ ì´ë¦„)</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>401/403</strong> : í‚¤ ë˜ëŠ” ì»¤ìŠ¤í…€ í—¤ë” ë¶ˆì¼ì¹˜. ê²Œì´íŠ¸ì›¨ì´ê°€ ìš”êµ¬í•˜ëŠ” í—¤ë”ë¥¼ <strong>Custom Headers</strong> ì— ì¶”ê°€.</p>
  </li>
  <li>
    <p><strong>ì—°ê²°ì€ ë˜ëŠ”ë° ì‘ë‹µ ì—ëŸ¬</strong> :</p>

    <ul>
      <li>
        <p>ì—”ì§„ì´ OpenAI Chat Completions ìŠ¤í™ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸(vLLM/LM StudioëŠ” ë³´í†µ ì§€ì›)</p>
      </li>
      <li>
        <p><strong>timeout</strong> ëŠ˜ë¦¬ê¸°(ì„œë²„ê°€ ëŠë¦´ ë•Œ)</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>íì‡„ë§</strong> : ì™¸ë¶€ ê²€ìƒ‰/ë‹¤ìš´ë¡œë“œê°€ í•„ìš” ì—†ê²Œ</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">ENABLE_WEB_SEARCH=False</code>, <code class="language-plaintext highlighter-rouge">OFFLINE_MODE=True</code></p>
      </li>
      <li>
        <p>ì„ë² ë”©/Whisper ëª¨ë¸ì€ <strong>ë¯¸ë¦¬ ìºì‹œ</strong>(í•„ìš” ì‹œ)</p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="6-ìµœì†Œ-ì˜ˆì‹œê°€ì¥-í”í•œ-vllmlm-studio">6) ìµœì†Œ ì˜ˆì‹œ(ê°€ì¥ í”í•œ vLLM/LM Studio)</h2>

<ul>
  <li>
    <p>Base URL: <code class="language-plaintext highlighter-rouge">http://10.0.0.5:8000/v1</code></p>
  </li>
  <li>
    <p>API Key: (ì—†ìœ¼ë©´ ë¹„ì›€)</p>
  </li>
  <li>
    <p>ëª¨ë¸ ID: ì„œë²„ê°€ ë…¸ì¶œí•˜ëŠ” ì´ë¦„(ì˜ˆ: <code class="language-plaintext highlighter-rouge">Meta-Llama-3-8B-Instruct</code>)</p>
  </li>
  <li>
    <p>ì €ì¥ â†’ Refresh â†’ ê¸°ë³¸ ëª¨ë¸ë¡œ ì§€ì •</p>
  </li>
</ul>

<hr />

<p>í•„ìš”í•˜ë©´ <strong>ë‹¹ì‹ ì´ ê°€ì§„ ì—”ë“œí¬ì¸íŠ¸/ëª¨ë¸ID/í‚¤ í˜•ì‹</strong> ì— ë§ì¶°ì„œ,<br />
í•œ ë²ˆì— ë¶™ëŠ” <strong>í™˜ê²½ë³€ìˆ˜ ìŠ¤ë‹ˆí«</strong> ì´ë‚˜ <strong>UI ì…ë ¥ê°’ í‘œ</strong> ë¥¼ ë§ì¶¤ìœ¼ë¡œ ë½‘ì•„ì¤„ê²Œ.</p>

<p class="chat--user">

ëª¨ë¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ì€ ì–´ë””ìˆì–´?

</p>

<p>Open WebUIì—ì„œ <strong>ëª¨ë¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨(Refresh/Sync)</strong> ë²„íŠ¼ì€ <strong>Settings â†’ Models</strong> í™”ë©´ì— ìˆìŠµë‹ˆë‹¤.</p>

<p>ì •í™•íˆëŠ” ì´ë ‡ê²Œ ì°¾ìœ¼ë©´ ë¼ìš”:</p>

<ol>
  <li>
    <p><strong>ë¸Œë¼ìš°ì €ì—ì„œ Open WebUI ì ‘ì†</strong></p>
  </li>
  <li>
    <p>ì¢Œì¸¡ ë©”ë‰´ì—ì„œ <strong>âš™ Settings</strong> í´ë¦­</p>
  </li>
  <li>
    <p>ìƒë‹¨ íƒ­ ì¤‘ì—ì„œ <strong>Models</strong> ì„ íƒ<br />
(ì—¬ê¸°ì„œ ì´ë¯¸ ë“±ë¡í•œ Providerë“¤ì´ ë³´ì…ë‹ˆë‹¤)</p>
  </li>
  <li>
    <p>ê° Provider ì¹´ë“œ(ì˜ˆ: "OpenAI Compatible") ì˜¤ë¥¸ìª½ ìœ„ì— <strong>âŸ³</strong> ì•„ì´ì½˜(ë˜ëŠ” "Refresh"/"Sync Models" ë²„íŠ¼)ì´ ìˆì–´ìš”.</p>
  </li>
  <li>
    <p>í´ë¦­í•˜ë©´ í•´ë‹¹ ì—”ë“œí¬ì¸íŠ¸ì— <code class="language-plaintext highlighter-rouge">/models</code> ìš”ì²­ì„ ë³´ë‚´ì„œ ìƒˆë¡œ ëª¨ë¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.</p>
  </li>
</ol>

<p>ğŸ’¡ ì°¸ê³ :</p>

<ul>
  <li>
    <p>ìƒˆë¡œê³ ì¹¨ í›„ì—ë„ ëª©ë¡ì— ì•ˆ ëœ¨ë©´, í•´ë‹¹ ì—”ë“œí¬ì¸íŠ¸ê°€ <strong>/models</strong> ì‘ë‹µì— ëª¨ë¸ IDë¥¼ ë°˜í™˜í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br />
ì´ëŸ´ ë• <strong>"Add model"</strong> ê¸°ëŠ¥ìœ¼ë¡œ ëª¨ë¸ IDë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë„£ì–´ì¤˜ì•¼ í•´ìš”.</p>
  </li>
  <li>
    <p>ëª©ë¡ ìºì‹œëŠ” ë‚´ë¶€ì ìœ¼ë¡œ TTLì´ ìˆì–´ì„œ, ë²„íŠ¼ ì—†ì´ë„ ì¼ì • ì‹œê°„ ì§€ë‚˜ë©´ ê°±ì‹ ë˜ì§€ë§Œ, ìˆ˜ë™ìœ¼ë¡œ ë°”ë¡œ ë³´ê³  ì‹¶ìœ¼ë©´ ì—¬ê¸°ì„œ ëˆŒëŸ¬ì£¼ë©´ ë©ë‹ˆë‹¤.</p>
  </li>
</ul>

<hr />

<p>ì›í•˜ë©´ ë‚´ê°€ UI ìŠ¤í¬ë¦°ìƒ·ì²˜ëŸ¼ ìƒê¸´ êµ¬ì¡°ë¥¼ ê·¸ë ¤ì„œ, <strong>Refresh ë²„íŠ¼ì´ ì •í™•íˆ ì–´ë”” ìˆëŠ”ì§€</strong> ë°”ë¡œ ë³´ì´ê²Œ í•´ì¤„ê¹Œìš”?<br />
ê·¸ëŸ¬ë©´ í•œ ë²ˆì— ì°¾ì„ ìˆ˜ ìˆì„ ê±°ì˜ˆìš”.</p>

<p class="chat--user">

ì´ê±° ì„œë²„ êº¼ë„ ì„¤ì •ì€ ì €ì¥ë˜ì§€?

</p>

<p>ë„¤, <strong>ì„œë²„ êº¼ë„ ì„¤ì •ì€ ì €ì¥ë©ë‹ˆë‹¤.</strong></p>

<p>Open WebUIëŠ” ì„¤ì •(ëª¨ë¸ ì—”ë“œí¬ì¸íŠ¸, ì‚¬ìš©ì ê³„ì •, UI í™˜ê²½ì„¤ì • ë“±)ì„ <strong>ë°±ì—”ë“œ ë°ì´í„°ë² ì´ìŠ¤</strong> ì— ì €ì¥í•©ë‹ˆë‹¤.</p>

<ul>
  <li>
    <p>pip ì„¤ì¹˜ ì‹œ ê¸°ë³¸ ê²½ë¡œ: <code class="language-plaintext highlighter-rouge">~/.open-webui</code> (ë˜ëŠ” <code class="language-plaintext highlighter-rouge">--data-dir</code>ë¡œ ì§€ì •í•œ ê²½ë¡œ)</p>
  </li>
  <li>
    <p>Docker ì‹¤í–‰ ì‹œ: <code class="language-plaintext highlighter-rouge">/app/backend/data</code> ë³¼ë¥¨</p>
  </li>
</ul>

<p>ì—¬ê¸° ì•ˆì—ëŠ” SQLite DB(<code class="language-plaintext highlighter-rouge">app.db</code>), ìºì‹œ, ì—…ë¡œë“œ íŒŒì¼ ë“±ì´ ë“¤ì–´ ìˆê³ ,<br />
ì„œë²„ë¥¼ êº¼ë„ ì´ ë””ë ‰í„°ë¦¬ë§Œ ìœ ì§€ë˜ë©´ ë‹¤ìŒ ì‹¤í–‰ ì‹œ ê·¸ëŒ€ë¡œ ë³µì›ë©ë‹ˆë‹¤.</p>

<hr />

<p>ğŸ“Œ <strong>ì£¼ì˜í•  ì </strong></p>

<ul>
  <li>
    <p>Dockerë¡œ ë„ìš¸ ë• <strong>ë³¼ë¥¨ ë§ˆìš´íŠ¸</strong> ì•ˆ í•˜ë©´ ì»¨í…Œì´ë„ˆ ì‚­ì œ ì‹œ ë°ì´í„°ë„ ê°™ì´ ë‚ ì•„ê°‘ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ENABLE_PERSISTENT_CONFIG=True</code>(ê¸°ë³¸ê°’)ì¼ ë•ŒëŠ” í™˜ê²½ë³€ìˆ˜ ê°’ë„ ìµœì´ˆ ê¸°ë™ ì‹œì ì— DBì— ì €ì¥ë¼ì„œ, ì´í›„ ì„œë²„ ì¬ì‹œì‘í•´ë„ DB ê°’ì´ ìš°ì„ ë©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ì„¤ì • ì´ˆê¸°í™”í•˜ê³  ì‹¶ìœ¼ë©´ <code class="language-plaintext highlighter-rouge">--data-dir</code> ìƒˆë¡œ ì§€ì •í•˜ê±°ë‚˜ <code class="language-plaintext highlighter-rouge">app.db</code>ë§Œ ì§€ìš°ë©´ ë©ë‹ˆë‹¤.</p>
  </li>
</ul>

<hr />

<p>ì›í•˜ë©´ ë‚´ê°€ <strong>í˜„ì¬ Open WebUIê°€ ì„¤ì • ì €ì¥í•˜ëŠ” ê²½ë¡œë¥¼ í™•ì¸í•˜ëŠ” ë°©ë²•</strong> ë„ ì•Œë ¤ì¤„ê²Œ.<br />
ê·¸ëŸ¬ë©´ ê»ë‹¤ ì¼œë„ ê·¸ëŒ€ë¡œ ìœ ì§€ë˜ëŠ”ì§€ ë°”ë¡œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆì–´ìš”.</p>

<p class="chat--user">

ì•„ë ˆë‚˜ ëª¨ë¸ì€ ë­ì•¼?

</p>

<p>ì•„, â€œArena Model(Arena ëª¨ë“œ)â€ì— ëŒ€í•´ ë¬¼ì–´ë³´ì‹  ê±°êµ°ìš”! Open WebUIì—ì„œ ì œê³µí•˜ëŠ” <strong>ëª¨ë¸ í‰ê°€ ê¸°ëŠ¥</strong> ìœ¼ë¡œ, <strong>A/B í…ŒìŠ¤íŒ…</strong> ì„ ì‰½ê²Œ í•  ìˆ˜ ìˆëŠ” ëª¨ë“œì…ë‹ˆë‹¤.</p>

<hr />

<h2 id="arena-modelì´ë€">Arena Modelì´ë€?</h2>

<ul>
  <li>
    <p><strong>ì—¬ëŸ¬ ëª¨ë¸ì„ ë¬¶ì€ ê·¸ë£¹</strong> ì—ì„œ <strong>ë¬´ì‘ìœ„ë¡œ í•˜ë‚˜ë¥¼ ì„ íƒ</strong> í•´ ì‘ë‹µì„ ìƒì„±í•˜ëŠ” ëª¨ë“œì…ë‹ˆë‹¤. <a href="https://docs.openwebui.com/features/evaluation/?utm_source=chatgpt.com">Open WebUI+10</a><a href="https://github.com/open-webui/open-webui/discussions/6538?utm_source=chatgpt.com">GitHub</a></p>
  </li>
  <li>
    <p>ìƒì„±ëœ ì‘ë‹µì—ëŠ” <strong>ì–´ë–¤ ëª¨ë¸ì´ ì¼ëŠ”ì§€ ìˆ¨ê²¨ì§„ ìƒíƒœ</strong> ì—¬ì„œ, <strong>ë¸”ë¼ì¸ë“œ í…ŒìŠ¤íŠ¸</strong> ì²˜ëŸ¼ ë¹„êµí•  ìˆ˜ ìˆì–´ìš”.</p>
  </li>
  <li>
    <p>ë‚´ê°€ ê·¸ ì‘ë‹µì— "<strong>ì¢‹ì•„ìš”/ì‹«ì–´ìš”</strong> "ë¥¼ ëˆ„ë¥´ë©´, ì–´ë–¤ ëª¨ë¸ì´ ì¼ëŠ”ì§€ ë‚˜ì¤‘ì— í™•ì¸í•  ìˆ˜ ìˆê³ , ë¦¬ë”ë³´ë“œë¥¼ í†µí•´ <strong>ëª¨ë¸ ê°„ ì„±ëŠ¥ ìˆœìœ„</strong> ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <a href="https://docs.openwebui.com/features/evaluation/?utm_source=chatgpt.com">Open WebUI</a><a href="https://github.com/open-webui/open-webui/discussions/6538?utm_source=chatgpt.com">GitHub</a></p>
  </li>
</ul>

<hr />

<h2 id="arena-model-ì‚¬ìš©ë²•-ìš”ì•½">Arena Model ì‚¬ìš©ë²• ìš”ì•½</h2>

<ol>
  <li>
    <p><strong>Admin Panel â†’ Settings â†’ Evaluations</strong> ì—ì„œ <strong>Arena Model</strong> ê·¸ë£¹ì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>í‰ê°€ì— í¬í•¨í•  ëª¨ë¸ë“¤ì„ ì„ íƒí•´ ê·¸ë£¹ì— ì¶”ê°€í•©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ì±— í™”ë©´ì—ì„œ <strong>Arena Model</strong> ì„ ì„ íƒí•˜ë©´, ëœë¤ìœ¼ë¡œ ëª¨ë¸ì´ í•˜ë‚˜ ë½‘í˜€ ì‘ë‹µ ìƒì„±.</p>
  </li>
  <li>
    <p>ì‘ë‹µì— <strong>ì¢‹ì•„ìš”/ì‹«ì–´ìš”</strong> í´ë¦­ â†’ ë’¤ì— ì–´ë–¤ ëª¨ë¸ì´ ë‹µí–ˆëŠ”ì§€ í™•ì¸ ê°€ëŠ¥.</p>
  </li>
  <li>
    <p>ë¦¬ë”ë³´ë“œë¥¼ í†µí•´ ê° ëª¨ë¸ì˜ ë¹„êµ ì„±ëŠ¥ì„ ì‹œê°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <a href="https://docs.openwebui.com/features/evaluation/?utm_source=chatgpt.com">Open WebUI+5</a></p>
  </li>
</ol>

<hr />

<h2 id="ì™œ-ìœ ìš©í• ê¹Œ">ì™œ ìœ ìš©í• ê¹Œ?</h2>

<ul>
  <li>
    <p><strong>í¸ê²¬ ì—†ëŠ” ë¹„êµ</strong> : ì‚¬ìš©ìê°€ ëª¨ë¸ ì´ë¦„ì„ ëª°ë¼ì„œ ì„ ì…ê²¬ ì—†ì´ í‰ê°€ ê°€ëŠ¥.</p>
  </li>
  <li>
    <p><strong>í–‰ë™ ê¸°ë°˜ ì„ í˜¸</strong> : ì¢‹ì•„ìš”/ì‹«ì–´ìš”ê°€ ìë™ìœ¼ë¡œ ë” ì¢‹ì€ ëª¨ë¸ì„ ë„ì›Œì¤Œ.</p>
  </li>
  <li>
    <p><strong>ë¦¬ë”ë³´ë“œ ì œê³µ</strong> : ì„¤ì •í•œ ëª¨ë¸ ê·¸ë£¹ ë‚´ì—ì„œ <strong>ì–´ë–¤ ëª¨ë¸ì´ ê°•í•œì§€ í•œëˆˆì— í™•ì¸ ê°€ëŠ¥</strong>.</p>
  </li>
</ul>

<hr />

<p>í•„ìš”í•˜ì‹œë©´, <strong>ê´€ë¦¬ì ì„¤ì • í™”ë©´ ìŠ¤í¬ë¦°ìƒ·</strong> , í˜¹ì€ ì‹¤ì œ Arena Modelì„ ì¼œê³  ì‚¬ìš©í•˜ëŠ” ì˜ˆì‹œ ì ˆì°¨ ìŠ¤í¬ë¦½íŠ¸ê¹Œì§€ ë§Œë“¤ì–´ë“œë¦´ ìˆ˜ ìˆì–´ìš”. í•„ìš”í•˜ì‹ ê°€ìš”?</p>]]></content><author><name>hvppyarchive</name></author><category term="llm" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">Reasoning effort ì‹¤í—˜ ê³„íš</title><link href="https://hvppyarchive.github.io/llm/reasoning-effort-test/" rel="alternate" type="text/html" title="Reasoning effort ì‹¤í—˜ ê³„íš" /><published>2025-08-11T17:59:44+09:00</published><updated>2025-08-11T17:59:44+09:00</updated><id>https://hvppyarchive.github.io/llm/reasoning-effort-test</id><content type="html" xml:base="https://hvppyarchive.github.io/llm/reasoning-effort-test/"><![CDATA[<p class="chat--user">

LLM ëª¨ë¸ì˜ Reasoning ê°•ë„ ì„¤ì •ì„ ë°”ê¿”ë³´ë©° ì–´ë–¤ ì°¨ì´ê°€ ë‚˜ëŠ”ì§€ ì‹¤í—˜ì„ í•´ë³´ê³  ì‹¶ì–´. ë‚´ê°€ ì“°ëŠ” ëª¨ë¸ì€ â€œReasoning effort: High"ë¥¼ ë„£ì–´ì£¼ë©´ ì„¤ì •ì„ ë°”ê¿€ ìˆ˜ìˆì–´. medium, Lowë„ ê°€ëŠ¥í•´. endpoint urlì´ ì£¼ì–´ì¡Œì„ ë•Œ ì‹¤í—˜ ê³„íšì„ ì„¸ìš°ê³  ìŠ¤í… ë°”ì´ ìŠ¤í…ìœ¼ë¡œ ì•Œë ¤ì¤˜.

</p>

<p>ì¢‹ì•„ìš”! â€œReasoning effort: High/Medium/Lowâ€ë¥¼ ë°”ê¿”ê°€ë©° <strong>ì–´ë–¤ ì°¨ì´ê°€ ì‹¤ì œë¡œ ë‚˜ëŠ”ì§€</strong> í™•ì¸í•˜ë ¤ë©´, ë³€ìˆ˜Â·ì§€í‘œÂ·ì‹¤í—˜ ì„¤ê³„ë¥¼ ë”± ì •í•´ ë†“ê³  ëŒë¦¬ëŠ” ê²Œ í•µì‹¬ì…ë‹ˆë‹¤. ì•„ë˜ëŠ” <strong>ì—”ë“œí¬ì¸íŠ¸ URLë§Œ ìˆìœ¼ë©´</strong> ê·¸ëŒ€ë¡œ ë”°ë¼ í•  ìˆ˜ ìˆëŠ” <strong>ìŠ¤í…-ë°”ì´-ìŠ¤í… ì‹¤í—˜ ê³„íš</strong> ì´ì—ìš”.</p>

<hr />

<h1 id="1-ëª©ì ê³¼-ê°€ì„¤-ì •í•˜ê¸°">1) ëª©ì ê³¼ ê°€ì„¤ ì •í•˜ê¸°</h1>

<ol>
  <li>
    <p><strong>ëª©ì :</strong> Reasoning effort ìˆ˜ì¤€ì— ë”°ë¼ <strong>ì •í™•ë„/ì¶”ë¡  ì„±ê³µë¥ </strong> , <strong>ì§€ì—° ì‹œê°„(latency)</strong> , <strong>í† í°/ë¹„ìš©</strong> ì´ ì–´ë–»ê²Œ ë‹¬ë¼ì§€ëŠ”ì§€ ì •ëŸ‰ ë¹„êµ.</p>
  </li>
  <li>
    <p><strong>ê°€ì„¤(ì˜ˆì‹œ):</strong></p>

    <ul>
      <li>
        <p>High &gt; Medium &gt; Low ìˆœìœ¼ë¡œ ì •í™•ë„â†‘, ë°˜ëŒ€ë¡œ ì§€ì—° ì‹œê°„Â·ë¹„ìš©ì€ Highê°€ ê°€ì¥ í¼.</p>
      </li>
      <li>
        <p>ë‚œë„ ë†’ì€ ë¬¸ì œ(ë©€í‹°ìŠ¤í…, í•¨ì • í¬í•¨)ëŠ” Highì˜ ì´ì ì´ ë” í¼.</p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h1 id="2-ë¹„êµí• -ì¡°ê±´-ì •ì˜">2) ë¹„êµí•  ì¡°ê±´ ì •ì˜</h1>

<ul>
  <li>
    <p><strong>ë…ë¦½ë³€ìˆ˜:</strong> <code class="language-plaintext highlighter-rouge">reasoning_effort âˆˆ {low, medium, high}</code></p>
  </li>
  <li>
    <p><strong>í†µì œë³€ìˆ˜:</strong> ë™ì¼ ëª¨ë¸/ë²„ì „, temperature(ì˜ˆ: 0.2), max_tokens, ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸, seed(ê°€ëŠ¥í•˜ë©´ ê³ ì •), API ì—”ë“œí¬ì¸íŠ¸.</p>
  </li>
  <li>
    <p><strong>ë°˜ë³µìˆ˜:</strong> ê° í”„ë¡¬í”„íŠ¸Ã—effortë³„ <strong>n=3~5íšŒ ë°˜ë³µ</strong>(ëœë¤ì„± í‰ê· í™”).</p>
  </li>
  <li>
    <p><strong>í‰ê°€ ì„¸íŠ¸:</strong> 3ê°œ ë²„í‚· ê¶Œì¥</p>

    <ul>
      <li>
        <p>(A) <strong>ì •í™•/ì˜¤ë‹µì´ ëª…í™•í•œ ë¬¸ì œ:</strong> ì˜ˆ) ìˆ˜í•™/ë…¼ë¦¬(ì •ë‹µ ì¡´ì¬) 50~100ë¬¸í•­</p>
      </li>
      <li>
        <p>(B) <strong>ì¥ë¬¸ ìš”ì•½/ë¶„ë¥˜/ì •ë³´ì¶”ì¶œ:</strong> ê¸°ì¤€ ë‹µì•ˆ ë˜ëŠ” ìŠ¤ì½”ì–´ëŸ¬ ìˆìŒ</p>
      </li>
      <li>
        <p>(C) <strong>ì½”ë”©/í¼ì¦/íˆ´-ì´ìš© ì‹œë‚˜ë¦¬ì˜¤:</strong> í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ë¡œ ì±„ì  ê°€ëŠ¥</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ìƒ˜í”Œ í¬ê¸°:</strong> ê° ë²„í‚·ë‹¹ ìµœì†Œ 50ê°œ(ê°€ëŠ¥í•˜ë©´ 100ê°œ). ì ì„ìˆ˜ë¡ ë°˜ë³µìˆ˜ë¥¼ ëŠ˜ë ¤ ë¶ˆí™•ì‹¤ì„± ë³´ì™„.</p>
  </li>
</ul>

<hr />

<h1 id="3-ì§€í‘œ-ì„¤ê³„">3) ì§€í‘œ ì„¤ê³„</h1>

<p><strong>í•µì‹¬ ì§€í‘œ</strong></p>

<ul>
  <li>
    <p><strong>ì •í™•ë„/ìŠ¤ì½”ì–´</strong> : ì •ë‹µë¥ , F1/ROUGE/BLEU, í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ í†µê³¼ìœ¨ ë“± íƒœìŠ¤í¬ë³„ ìë™ ì±„ì .</p>
  </li>
  <li>
    <p><strong>ì§€ì—° ì‹œê°„</strong> : end-to-end(ìš”ì²­~ì‘ë‹µ ìˆ˜ì‹ ) ms.</p>
  </li>
  <li>
    <p><strong>ë¹„ìš©/í† í°</strong> : input/output/reasoning í† í°(ê°€ëŠ¥ ì‹œ) ë° ì´ ë¹„ìš©.</p>
  </li>
  <li>
    <p><strong>ì‹¤íŒ¨ìœ¨</strong> : íƒ€ì„ì•„ì›ƒ/ì—ëŸ¬ìœ¨.</p>
  </li>
</ul>

<p><strong>ë³´ì¡° ì§€í‘œ</strong></p>

<ul>
  <li>
    <p><strong>ìŠ¤í… ìˆ˜ ì¶”ì •</strong> : ì‘ë‹µ ê¸¸ì´(í† í°)ë¡œ ê°„ì ‘ ì¶”ì •.</p>
  </li>
  <li>
    <p><strong>ì¼ê´€ì„±</strong> : ë°˜ë³µ ì‘ë‹µ ê°„ í¸ì°¨(ë¶„ì‚°).</p>
  </li>
</ul>

<hr />

<h1 id="4-ì‹¤í—˜-ë””ìì¸">4) ì‹¤í—˜ ë””ìì¸</h1>

<ol>
  <li>
    <p><strong>í˜ì–´ë“œ í…ŒìŠ¤íŠ¸(ê¶Œì¥):</strong> ê°™ì€ í”„ë¡¬í”„íŠ¸ë¥¼ Low/Med/High ëª¨ë‘ì— ëŒë ¤ <strong>ìŒëŒ€ ë¹„êµ</strong>.</p>
  </li>
  <li>
    <p><strong>ë¬´ì‘ìœ„ ìˆœì„œí™”:</strong> (í”„ë¡¬í”„íŠ¸ i)Ã—(effort j) ì‹¤í–‰ ìˆœì„œë¥¼ ë¬´ì‘ìœ„ë¡œ ì„ìŒ(ìˆœì„œ íš¨ê³¼ ì œê±°).</p>
  </li>
  <li>
    <p><strong>ë¼í‹´ ìŠ¤í€˜ì–´(ì„ íƒ):</strong> ìˆœì„œ í¸í–¥ì´ ê±±ì •ë˜ë©´ ì ìš©.</p>
  </li>
  <li>
    <p><strong>ë¦¬íŠ¸ë¼ì´ ê·œì¹™:</strong> íƒ€ì„ì•„ì›ƒ/429ëŠ” <strong>ì§€ìˆ˜ ë°±ì˜¤í”„</strong> ë¡œ 2~3íšŒ ì¬ì‹œë„, ì‹¤íŒ¨ëŠ” ë¡œê·¸ì— í‘œê¸°.</p>
  </li>
</ol>

<hr />

<h1 id="5-ë°ì´í„°-í¬ë§·ë¡œê·¸-ìŠ¤í‚¤ë§ˆ">5) ë°ì´í„° í¬ë§·(ë¡œê·¸ ìŠ¤í‚¤ë§ˆ)</h1>

<p>ê° í˜¸ì¶œë§ˆë‹¤ ì•„ë˜ë¥¼ ì €ì¥í•˜ì„¸ìš”(JSON line ì¶”ì²œ).</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"prompt_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A_023"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"bucket"</span><span class="p">:</span><span class="w"> </span><span class="s2">"math"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"effort"</span><span class="p">:</span><span class="w"> </span><span class="s2">"high|medium|low"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"trial"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"request_ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
  </span><span class="nl">"latency_ms"</span><span class="p">:</span><span class="w"> </span><span class="mi">842</span><span class="p">,</span><span class="w">
  </span><span class="nl">"input_tokens"</span><span class="p">:</span><span class="w"> </span><span class="mi">312</span><span class="p">,</span><span class="w">
  </span><span class="nl">"output_tokens"</span><span class="p">:</span><span class="w"> </span><span class="mi">521</span><span class="p">,</span><span class="w">
  </span><span class="nl">"reasoning_tokens"</span><span class="p">:</span><span class="w"> </span><span class="mi">409</span><span class="p">,</span><span class="w">     </span><span class="err">//</span><span class="w"> </span><span class="err">ì œê³µë˜ë©´</span><span class="w">
  </span><span class="nl">"cost_usd"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0123</span><span class="p">,</span><span class="w">          </span><span class="err">//</span><span class="w"> </span><span class="err">ë‹¨ê°€í‘œë¡œ</span><span class="w"> </span><span class="err">ê³„ì‚°</span><span class="w">
  </span><span class="nl">"response_text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
  </span><span class="nl">"tool_calls"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">            </span><span class="err">//</span><span class="w"> </span><span class="err">ìˆìœ¼ë©´</span><span class="w">
  </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<hr />

<h1 id="6-ì‹¤í–‰-ë°©ë²•ì—”ë“œí¬ì¸íŠ¸-ì˜ˆì‹œ">6) ì‹¤í–‰ ë°©ë²•(ì—”ë“œí¬ì¸íŠ¸ ì˜ˆì‹œ)</h1>

<p>ì•„ë˜ì—ì„œ <code class="language-plaintext highlighter-rouge">ENDPOINT_URL</code>ê³¼ <code class="language-plaintext highlighter-rouge">API_KEY</code>ë§Œ ë°”ê¿” ì“°ë©´ ë©ë‹ˆë‹¤.<br />
EffortëŠ” <strong>ìš”ì²­ ë°”ë””</strong> ì— <code class="language-plaintext highlighter-rouge">reasoning_effort</code> í•„ë“œë¡œ ë„£ëŠ”ë‹¤ê³  ê°€ì •í–ˆìŠµë‹ˆë‹¤. (ì˜ˆ: <code class="language-plaintext highlighter-rouge">"high"|"medium"|"low"</code>)</p>

<h2 id="a-curl-ë‹¨ê±´-í…ŒìŠ¤íŠ¸">(A) cURL ë‹¨ê±´ í…ŒìŠ¤íŠ¸</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> POST <span class="s2">"</span><span class="nv">$ENDPOINT_URL</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{
    "model": "your-model-id",
    "reasoning_effort": "high",
    "temperature": 0.2,
    "max_tokens": 1024,
    "seed": 42,
    "messages": [
      {"role": "system", "content": "You are a helpful assistant."},
      {"role": "user", "content": "ë¬¸ì œ: 12ê°œì˜ ì‚¬ê³¼ë¥¼ 3ëª…ì—ê²Œ ê³µí‰í•˜ê²Œ ë‚˜ëˆ„ë©´ í•œ ì‚¬ëŒë‹¹ ëª‡ ê°œì¸ê°€?"}
    ]
  }'</span>
</code></pre></div></div>

<h2 id="b-íŒŒì´ì¬-ë°°ì¹˜-ìŠ¤í¬ë¦½íŠ¸ì¬í˜„-ê°€ëŠ¥-ë¡œê·¸-ì €ì¥">(B) íŒŒì´ì¬ ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸(ì¬í˜„ ê°€ëŠ¥, ë¡œê·¸ ì €ì¥)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">random</span><span class="p">,</span> <span class="n">uuid</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">ENDPOINT_URL</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="sh">"</span><span class="s">ENDPOINT_URL</span><span class="sh">"</span><span class="p">)</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="sh">"</span><span class="s">API_KEY</span><span class="sh">"</span><span class="p">)</span>
<span class="n">MODEL</span> <span class="o">=</span> <span class="sh">"</span><span class="s">your-model-id</span><span class="sh">"</span>

<span class="n">HEADERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">Authorization</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Bearer </span><span class="si">{</span><span class="n">API_KEY</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">Content-Type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">application/json</span><span class="sh">"</span>
<span class="p">}</span>

<span class="n">EFFORTS</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">low</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">medium</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">high</span><span class="sh">"</span><span class="p">]</span>
<span class="n">TEMPERATURE</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">SEED</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">MAX_TOKENS</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="n">REPEATS</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># ê° í”„ë¡¬í”„íŠ¸Ã—effort ë°˜ë³µ ìˆ˜
</span>
<span class="c1"># í”„ë¡¬í”„íŠ¸ ëª©ë¡ ì˜ˆì‹œ
</span><span class="n">dataset</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="sh">"</span><span class="s">prompt_id</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">M_001</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">bucket</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">math</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ì„¸ ìˆ˜ì˜ í‰ê· ì´ 10ì´ê³ ...</span><span class="sh">"</span><span class="p">},</span>
    <span class="p">{</span><span class="sh">"</span><span class="s">prompt_id</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">S_014</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">bucket</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">summary</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ì•„ë˜ ê¸€ì„ 1ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½...</span><span class="sh">"</span><span class="p">},</span>
    <span class="c1"># ... (CSV/JSONì—ì„œ ë¡œë“œ ê¶Œì¥)
</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">call_model</span><span class="p">(</span><span class="n">user_text</span><span class="p">,</span> <span class="n">effort</span><span class="p">):</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">:</span> <span class="n">MODEL</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">reasoning_effort</span><span class="sh">"</span><span class="p">:</span> <span class="n">effort</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">temperature</span><span class="sh">"</span><span class="p">:</span> <span class="n">TEMPERATURE</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">max_tokens</span><span class="sh">"</span><span class="p">:</span> <span class="n">MAX_TOKENS</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">seed</span><span class="sh">"</span><span class="p">:</span> <span class="n">SEED</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">messages</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">system</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">You are a helpful assistant.</span><span class="sh">"</span><span class="p">},</span>
            <span class="p">{</span><span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="n">user_text</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">ENDPOINT_URL</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="nf">int</span><span class="p">((</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dt</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="n">r</span><span class="p">.</span><span class="n">status_code</span><span class="p">,</span> <span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">:</span> <span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
    <span class="c1"># API ì‚¬ì–‘ì— ë§ê²Œ íŒŒì‹±í•˜ì„¸ìš”
</span>    <span class="n">out_text</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">choices</span><span class="sh">"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">]</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">usage</span><span class="sh">"</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">return</span> <span class="n">dt</span><span class="p">,</span> <span class="p">{</span><span class="sh">"</span><span class="s">text</span><span class="sh">"</span><span class="p">:</span> <span class="n">out_text</span><span class="p">,</span> <span class="sh">"</span><span class="s">usage</span><span class="sh">"</span><span class="p">:</span> <span class="n">usage</span><span class="p">},</span> <span class="bp">None</span>

<span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="mi">2025</span><span class="p">)</span>
<span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">eff</span> <span class="ow">in</span> <span class="n">EFFORTS</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">REPEATS</span><span class="p">):</span>
            <span class="n">pairs</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">item</span><span class="p">,</span> <span class="n">eff</span><span class="p">,</span> <span class="n">trial</span><span class="p">))</span>

<span class="n">random</span><span class="p">.</span><span class="nf">shuffle</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span>

<span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">eff</span><span class="p">,</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
    <span class="n">latency_ms</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="nf">call_model</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">],</span> <span class="n">eff</span><span class="p">)</span>
    <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">uuid</span><span class="p">.</span><span class="nf">uuid4</span><span class="p">()),</span>
        <span class="sh">"</span><span class="s">ts</span><span class="sh">"</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">utcnow</span><span class="p">().</span><span class="nf">isoformat</span><span class="p">(),</span>
        <span class="sh">"</span><span class="s">prompt_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="sh">"</span><span class="s">prompt_id</span><span class="sh">"</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">bucket</span><span class="sh">"</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="sh">"</span><span class="s">bucket</span><span class="sh">"</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">effort</span><span class="sh">"</span><span class="p">:</span> <span class="n">eff</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">trial</span><span class="sh">"</span><span class="p">:</span> <span class="n">trial</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">latency_ms</span><span class="sh">"</span><span class="p">:</span> <span class="n">latency_ms</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">input_tokens</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="n">result</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">usage</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">prompt_tokens</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">output_tokens</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="n">result</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">usage</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">completion_tokens</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">reasoning_tokens</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="n">result</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">usage</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">reasoning_tokens</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">cost_usd</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>  <span class="c1"># ë‹¨ê°€í‘œë¡œ í›„ì²˜ë¦¬ ê³„ì‚°
</span>        <span class="sh">"</span><span class="s">response_text</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="n">result</span> <span class="ow">or</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">text</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="n">err</span>
    <span class="p">}</span>
    <span class="n">rows</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="sh">"</span><span class="s">prompt_id</span><span class="sh">"</span><span class="p">],</span> <span class="n">eff</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="sh">"</span><span class="s">latency:</span><span class="sh">"</span><span class="p">,</span> <span class="n">latency_ms</span><span class="p">,</span> <span class="sh">"</span><span class="s">ms</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">ok</span><span class="sh">"</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">err</span> <span class="k">else</span> <span class="sh">"</span><span class="s">ERR</span><span class="sh">"</span><span class="p">)</span>

<span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">runs.jsonl</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Saved runs.jsonl</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h1 id="7-ìë™-ì±„ì í’ˆì§ˆ-í‰ê°€">7) ìë™ ì±„ì /í’ˆì§ˆ í‰ê°€</h1>

<ul>
  <li>
    <p><strong>ì •ë‹µí˜• ë¬¸ì œ:</strong> ì •ë‹µ í‚¤ì™€ ë”± ë§¤ì¹­(ë¬¸ì ì •ê·œí™” í›„).</p>
  </li>
  <li>
    <p><strong>ìš”ì•½/ë¶„ë¥˜:</strong> ì •ë‹µ ë ˆì´ë¸”/ì°¸ì¡° ìš”ì•½ê³¼ ë¹„êµ(F1/ROUGE ë“±).</p>
  </li>
  <li>
    <p><strong>ì½”ë”©:</strong> í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ ì‹¤í–‰ í†µê³¼ìœ¨.</p>
  </li>
  <li>
    <p><strong>ì£¼ê´€í˜• í’ˆì§ˆ(ì„ íƒ):</strong> ë¸”ë¼ì¸ë“œ <strong>íœ´ë¨¼ í‰ê°€ ê°€ì´ë“œ</strong> ì˜ˆì‹œ</p>

    <ul>
      <li>
        <p>ê´€ë ¨ì„±(0â€“5), ì‚¬ì‹¤ì„±(0â€“5), êµ¬ì¡°/ëª…ë£Œì„±(0â€“5), ê³¼ì‰ì¶”ë¡ /í™˜ê°(ê°ì ).</p>
      </li>
      <li>
        <p>í‰ê°€ìëŠ” effort ê°’ì„ ëª¨ë¥¸ ì±„ë¡œ í‰ê°€(ì´ì¤‘ë§¹ê²€).</p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h1 id="8-ë¶„ì„-ê³„íšìŠ¤í…ë³„">8) ë¶„ì„ ê³„íš(ìŠ¤í…ë³„)</h1>

<ol>
  <li>
    <p><strong>ì „ì²˜ë¦¬:</strong> í”„ë¡¬í”„íŠ¸Â·effortÂ·trialë¡œ ê·¸ë£¹í•‘, trial í‰ê· (ë˜ëŠ” ì¤‘ìœ„) ê³„ì‚°.</p>
  </li>
  <li>
    <p><strong>ê¸°ë³¸ í†µê³„:</strong> effortë³„ í‰ê·  ì •í™•ë„/ì§€ì—°/ë¹„ìš© í‘œÂ·ë°•ìŠ¤í”Œë¡¯.</p>
  </li>
  <li>
    <p><strong>ìŒëŒ€ ë¹„êµ:</strong> ê°™ì€ í”„ë¡¬í”„íŠ¸ ê¸°ì¤€ìœ¼ë¡œ</p>

    <ul>
      <li>
        <p>ì •ëŸ‰ì§€í‘œ(ì •ë‹µë¥  ë“±): <strong>ìœŒì½•ìŠ¨ ë¶€í˜¸ìˆœìœ„ ê²€ì •</strong> ë˜ëŠ” <strong>ì§ì§€ì€ t-ê²€ì •</strong></p>
      </li>
      <li>
        <p>effort 3ìˆ˜ì¤€ ë™ì‹œ ë¹„êµ: <strong>ë°˜ë³µì¸¡ì • ANOVA</strong> ë˜ëŠ” <strong>í”„ë¦¬ë“œë¨¼ ê²€ì •</strong></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>íš¨ê³¼í¬ê¸° ì‚°ì¶œ:</strong> Cliffâ€™s delta / Cohenâ€™s d.</p>
  </li>
  <li>
    <p><strong>ì‹ ë¢°êµ¬ê°„:</strong> ë¶€íŠ¸ìŠ¤íŠ¸ë©(í”„ë¡¬í”„íŠ¸ ë‹¨ìœ„ ë¦¬ìƒ˜í”Œ) 95% CI.</p>
  </li>
  <li>
    <p><strong>ë‚œì´ë„ êµí˜¸ì‘ìš©:</strong> ë²„í‚·(A/B/C)ë³„ë¡œ ë¶„ë¦¬í•´ì„œ ë™ì¼ ë¶„ì„.</p>
  </li>
  <li>
    <p><strong>ë¹„ìš©-íš¨ìš© ê³¡ì„ :</strong> xì¶•=ë¹„ìš©(ë˜ëŠ” í† í°), yì¶•=ì •í™•ë„(ë˜ëŠ” ìŠ¹ë¥ )ë¡œ <strong>í”„ëŸ°í‹°ì–´</strong> ì‹œê°í™”.</p>
  </li>
</ol>

<hr />

<h1 id="9-ê²°ë¡ -ë„ì¶œ-ì²´í¬ë¦¬ìŠ¤íŠ¸">9) ê²°ë¡  ë„ì¶œ ì²´í¬ë¦¬ìŠ¤íŠ¸</h1>

<ul>
  <li>
    <p>Highê°€ <strong>ì–¼ë§ˆë‚˜</strong> ë” ì •í™•í•œê°€? (ì ˆëŒ€/ìƒëŒ€ ê°œì„  %)</p>
  </li>
  <li>
    <p>ê·¸ ê°œì„ ì´ <strong>í†µê³„ì ìœ¼ë¡œ ìœ ì˜</strong> í•œê°€? (pê°’/CI)</p>
  </li>
  <li>
    <p><strong>ì¶”ê°€ ì§€ì—°/ë¹„ìš© ëŒ€ë¹„ ê°€ì¹˜</strong> ê°€ ìˆëŠ”ê°€? (ì—…ë¬´ ì¼€ì´ìŠ¤ë³„)</p>
  </li>
  <li>
    <p>ì–´ë–¤ <strong>íƒœìŠ¤í¬</strong> ì—ì„œ Highì˜ ì´ë“ì´ íŠ¹íˆ í°ê°€?</p>
  </li>
  <li>
    <p>ìš´ì˜ ê¶Œì¥ì¹˜(ì˜ˆ: â€œê¸°ë³¸ Medium, ì‹¤íŒ¨/ë‚œí•´ ì‹œ High ì¬ì‹œë„â€).</p>
  </li>
</ul>

<hr />

<h1 id="10-ë¦¬ìŠ¤í¬ì£¼ì˜-ì‚¬í•­">10) ë¦¬ìŠ¤í¬/ì£¼ì˜ ì‚¬í•­</h1>

<ul>
  <li>
    <p><strong>ì¼ê´€ëœ ì‹œë“œÂ·ì˜¨ë„</strong> ë¡œ ê³µì •ì„± í™•ë³´.</p>
  </li>
  <li>
    <p><strong>í”„ë¡¬í”„íŠ¸ ëˆ„ìˆ˜ ë°©ì§€:</strong> ì •ë‹µ/í•´ì„¤ì„ ì‹œìŠ¤í…œ/ì»¨í…ìŠ¤íŠ¸ì— í¬í•¨í•˜ì§€ ì•Šê¸°.</p>
  </li>
  <li>
    <p><strong>ì²´ì¸ì˜¤ë¸Œì†ŒíŠ¸(ë‚´ì ì¶”ë¡ ) ë…¸ì¶œ</strong> ì€ í‰ê°€ì— í¬í•¨í•˜ë˜, ì™¸ë¶€ ë°°í¬/ì €ì¥ ì •ì±… ì¤€ìˆ˜.</p>
  </li>
  <li>
    <p><strong>ë ˆì´íŠ¸ ë¦¬ë°‹</strong> ê³¼ <strong>íƒ€ì„ì•„ì›ƒ</strong> ëŒ€ë¹„(ë°±ì˜¤í”„, íì‰).</p>
  </li>
  <li>
    <p><strong>ë°ì´í„° ë³´í˜¸:</strong> ë¯¼ê° ë°ì´í„° ë¹„ìµëª… ì „ì†¡ ê¸ˆì§€.</p>
  </li>
</ul>

<hr />

<h1 id="11-ì‚°ì¶œë¬¼í…œí”Œë¦¿">11) ì‚°ì¶œë¬¼(í…œí”Œë¦¿)</h1>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">runs.jsonl</code> ì›ì‹œ ë¡œê·¸</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">metrics.csv</code> (í”„ë¡¬í”„íŠ¸Ã—effort ì§‘ê³„í‘œ)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">report.md</code> (ìš”ì•½: ì„¤ì •, ë°ì´í„°, ê²°ê³¼, ê²°ë¡ , í•œê³„)</p>
  </li>
</ul>

<hr />

<h1 id="12-ë¹ ë¥¸-íŒŒì¼ëŸ¿30ë¶„-ì»·">12) ë¹ ë¥¸ íŒŒì¼ëŸ¿(30ë¶„ ì»·)</h1>

<ol>
  <li>
    <p>ë²„í‚· Aì—ì„œ 30ë¬¸í•­ë§Œ ì¶”ë ¤ì„œ Low/Med/High ê° 2íšŒì”©.</p>
  </li>
  <li>
    <p>ì •í™•ë„Â·ì§€ì—°Â·í† í°ë§Œ ìš°ì„  ë¹„êµ.</p>
  </li>
  <li>
    <p>íš¨ê³¼ ìˆìœ¼ë©´ ì „ì²´ ë°°ì¹˜ í™•ì¥.</p>
  </li>
</ol>

<hr />

<p>í•„ìš”í•˜ë©´ <strong>ì±„ì  ìŠ¤í¬ë¦½íŠ¸/ë¦¬í¬íŠ¸ ë…¸íŠ¸ë¶(ê·¸ë˜í”„ í¬í•¨)</strong>ë„ ë§Œë“¤ì–´ ë“œë¦´ê²Œìš”.<br />
ì—”ë“œí¬ì¸íŠ¸ ì‚¬ì–‘ì´ ì•½ê°„ ë‹¤ë¥´ë©´(ì˜ˆ: <code class="language-plaintext highlighter-rouge">reasoning_effort</code> í‚¤ ì´ë¦„, usage í•„ë“œ ëª…) ì•Œë ¤ì£¼ì‹œë©´ ìœ„ ì½”ë“œ/ìŠ¤í‚¤ë§ˆë¥¼ ë§ì¶° ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>

<p class="chat--user">

ë°ì´í„°ê°€ ì—†ì–´ ì´ëŸ° ê±¸ í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ë‚˜?

</p>

<p>LLMì˜ â€œReasoning effortâ€ ì„¤ì •ì„ ì§ì ‘ ë¹„êµí•´ ë³´ê³  ì‹¶ì€ë°, ì§ì ‘ ë°ì´í„°ê°€ ì—†ì–´ ë²ˆê±°ë¡œìš°ì‹œì£ ? ë‹¤í–‰íˆ, ì´ë¯¸ ë‹¤ì–‘í•œ <strong>LLM í‰ê°€ ë¼ì´ë¸ŒëŸ¬ë¦¬</strong> ê°€ ìˆì–´ ì‹¤í—˜ ê¸°ë°˜ ë§ˆë ¨ì— í›¨ì”¬ ìˆ˜ì›”í•˜ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆì–´ìš”.</p>

<hr />

<h2 id="ì£¼ìš”-ì˜¤í”ˆì†ŒìŠ¤-í‰ê°€-ë¼ì´ë¸ŒëŸ¬ë¦¬-ì†Œê°œ">ì£¼ìš” ì˜¤í”ˆì†ŒìŠ¤ í‰ê°€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì†Œê°œ</h2>

<h3 id="1-openai-evals">1. <strong>OpenAI Evals</strong></h3>

<ul>
  <li>OpenAIì—ì„œ ì œê³µí•˜ëŠ” ê³µì‹ <strong>í‰ê°€ í”„ë ˆì„ì›Œí¬</strong> ë¡œ, ê¸°ë³¸ ë²¤ì¹˜ë§ˆí¬ë¶€í„° ì»¤ìŠ¤í…€ í‰ê°€ê¹Œì§€ ì§€ì›í•©ë‹ˆë‹¤.<a href="https://github.com/openai/evals?utm_source=chatgpt.com">GitHub</a></li>
</ul>

<h3 id="2-eleutherais-lm-evaluation-harness">2. <strong>EleutherAIâ€™s lm-evaluation-harness</strong></h3>

<ul>
  <li>ìˆ˜ì‹­ì—¬ ê°œì˜ í•™ìˆ  ë²¤ì¹˜ë§ˆí¬ë¥¼ í•œ ê³³ì—ì„œ ì‹¤í–‰ ê°€ëŠ¥í•˜ê³ , ìì²´ APIë¿ ì•„ë‹ˆë¼ Hugging Face ëª¨ë¸, GPTâ€‘NeoX, Megatronâ€‘DeepSpeed ë“± ë‹¤ì–‘í•œ ëª¨ë¸ì„ ì§€ì›í•©ë‹ˆë‹¤.<a href="https://github.com/EleutherAI/lm-evaluation-harness?utm_source=chatgpt.com">GitHub</a></li>
</ul>

<h3 id="3-deepeval-confident-ai">3. <strong>DeepEval (Confident AI)</strong></h3>

<ul>
  <li>Pytest ê¸°ë°˜ìœ¼ë¡œ ë‹¤ì–‘í•œ ë©”íŠ¸ë¦­(ìš”ì•½, í™˜ê° ë“±)ì„ ì œê³µí•˜ì—¬ ì†ì‰½ê²Œ LLM ì¶œë ¥ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ” ì˜¤í”ˆì†ŒìŠ¤ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.<a href="https://www.reddit.com/r/LLMDevs/comments/1i6r1h9/top_6_open_source_llm_evaluation_frameworks/?utm_source=chatgpt.com">Reddit</a><a href="https://medium.com/%40zilliz_learn/top-10-rag-llm-evaluation-tools-you-dont-want-to-miss-a0bfabe9ae19?utm_source=chatgpt.com">Medium</a></li>
</ul>

<h3 id="4-lighteval-hugging-face">4. <strong>LightEval (Hugging Face)</strong></h3>

<ul>
  <li>ë‹¤ì–‘í•œ ë²¤ì¹˜ë§ˆí¬ì™€ ë©”íŠ¸ë¦­ì„ í•˜ë‚˜ì˜ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ í†µí•©í•œ í‰ê°€ íˆ´í‚·ìœ¼ë¡œ, Transformers, Accelerate, Hugging Face Hubì™€ ìœ ê¸°ì ìœ¼ë¡œ ì—°ë™ë©ë‹ˆë‹¤.<a href="https://www.cohorte.co/blog/lighteval-deep-dive-hugging-faces-all-in-one-framework-for-llm-evaluation?utm_source=chatgpt.com">Cohorte</a></li>
</ul>

<h3 id="5-evidently-llm-as-a-judge">5. <strong>Evidently (LLM-as-a-Judge)</strong></h3>

<ul>
  <li>LLMì„ í‰ê°€ìë¡œ ì‚¬ìš©í•˜ëŠ” â€œLLMâ€‘asâ€‘aâ€‘Judgeâ€ ë°©ì‹ì— íŠ¹í™”ëœ ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ, ìƒì„¸í•œ í‰ê°€ ê¸°ì¤€ê³¼ ëŒ€ì‹œë³´ë“œë¥¼ ì œê³µí•˜ë©° ìµœê·¼ê¹Œì§€ë„ ì—…ë°ì´íŠ¸ë˜ê³  ìˆì–´ìš”.<a href="https://www.evidentlyai.com/llm-guide/llm-as-a-judge?utm_source=chatgpt.com">Evidently AI+3</a></li>
</ul>

<h3 id="6-verdict">6. <strong>Verdict</strong></h3>

<ul>
  <li>â€œLLM-as-a-Judgeâ€ ì ‘ê·¼ì„ ê°•í™”í•œ ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ, ê²€ì¦, í† ë¡ (debate), ì§‘ê³„(aggregation) ê°™ì€ ëª¨ë“ˆ ê¸°ë°˜ í‰ê°€ íŒŒì´í”„ë¼ì¸ì„ ì œê³µí•´ í‰ê°€ ì‹ ë¢°ë„ë¥¼ ë†’ì…ë‹ˆë‹¤.<a href="https://arxiv.org/abs/2502.18018?utm_source=chatgpt.com">arXiv</a></li>
</ul>

<h3 id="7-llm-reasoners--autorace">7. <strong>LLM Reasoners + AutoRace</strong></h3>

<ul>
  <li>ì²´ì¸ ì˜¤ë¸Œ ì¶”ë¡ (chain-ofâ€‘thought)ì²˜ëŸ¼ ë‹¨ê³„ë³„ reasoningì„ ìë™ìœ¼ë¡œ í‰ê°€í•˜ëŠ” í”„ë ˆì„ì›Œí¬ì´ë©°, reasoning ì•Œê³ ë¦¬ì¦˜ì„ ëª¨ë“ˆí™”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.<a href="https://arxiv.org/abs/2404.05221?utm_source=chatgpt.com">arXiv</a></li>
</ul>

<h3 id="8-openr">8. <strong>OpenR</strong></h3>

<ul>
  <li>ì˜¤í”ˆì†ŒìŠ¤ í”„ë ˆì„ì›Œí¬ë¡œ, ì¶”ë¡ ëŠ¥ë ¥ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•œ ê°•í™”í•™ìŠµ(RL), test-time compute, ê³¼ì • ê°ë…(process supervision) ë“±ì„ í†µí•©í•œ í”Œë«í¼ì…ë‹ˆë‹¤.<a href="https://arxiv.org/abs/2410.09671?utm_source=chatgpt.com">arXiv</a></li>
</ul>

<hr />

<h2 id="ì¶”ì²œ-ì‹¤í—˜-í™œìš©-ë°©ì•ˆ">ì¶”ì²œ ì‹¤í—˜ í™œìš© ë°©ì•ˆ</h2>

<table>
  <thead>
    <tr>
      <th>ëª©í‘œ</th>
      <th>ì¶”ì²œ ë¼ì´ë¸ŒëŸ¬ë¦¬</th>
      <th>í™œìš©ë²•</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ê¸°ë³¸ì ì¸ ì •í™•ë„Â·ì§€ì—°Â·í† í° ë¹„êµ</td>
      <td><strong>lm-evaluation-harness</strong> , <strong>OpenAI Evals</strong> , <strong>LightEval</strong></td>
      <td>ë²¤ì¹˜ë§ˆí¬ íƒœìŠ¤í¬ë¡œ ì‹¤í—˜ ìë™í™”.</td>
    </tr>
    <tr>
      <td>ì¶œë ¥ì˜ ì§ˆì  í‰ê°€ (í™˜ê°, ìš”ì•½ í€„ë¦¬í‹° ë“±)</td>
      <td><strong>DeepEval</strong> , <strong>Evidently</strong></td>
      <td>Pytest ê¸°ë°˜ í…ŒìŠ¤íŠ¸ ë˜ëŠ” LLM-judge í™œìš©.</td>
    </tr>
    <tr>
      <td>Reasoning ê³¼ì • ë¶„ì„</td>
      <td><strong>LLM Reasoners + AutoRace</strong></td>
      <td>reasoning ë‹¨ê³„ë³„ ì„±ëŠ¥ ì •ëŸ‰í™”.</td>
    </tr>
    <tr>
      <td>ê³ ê¸‰ ì‹ ë¢°ë„ ë†’ì€ í‰ê°€</td>
      <td><strong>Verdict</strong></td>
      <td>í‰ê°€ìì˜ ê²€ì¦ ë° í•©ì˜ ì ˆì°¨ í¬í•¨.</td>
    </tr>
    <tr>
      <td>ì „ì²´ì ì¸ reasoning pipeline ê°•í™”</td>
      <td><strong>OpenR</strong></td>
      <td>test-time compute + RL í†µí•© ì‹¤í—˜ ì„¤ê³„.</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="ìš”ì•½">ìš”ì•½</h2>

<p>ë¬¼ë¦¬ì ì¸ ë°ì´í„°ì…‹ ì—†ì´ë„, ìœ„ì™€ ê°™ì€ ì˜¤í”ˆì†ŒìŠ¤ <strong>è©•åƒ¹ ë¼ì´ë¸ŒëŸ¬ë¦¬</strong> ë“¤ì„ í™œìš©í•˜ë©´ â€œReasoning effortâ€ ì„¤ì •ì— ë”°ë¥¸ ë¹„êµ ì‹¤í—˜ ì„¤ê³„ê°€ í›¨ì”¬ ê°„í¸í•´ì ¸ìš”.</p>

<p>â€” <strong>ê¸°ë³¸ ë¹„êµ</strong> ì—ëŠ” <code class="language-plaintext highlighter-rouge">lm-evaluation-harness</code> ë‚˜ <code class="language-plaintext highlighter-rouge">OpenAI Evals</code> ì¶”ì²œ<br />
â€” <strong>ì •ì„±ì  í‰ê°€</strong> ì—” <code class="language-plaintext highlighter-rouge">DeepEval</code>, <code class="language-plaintext highlighter-rouge">Evidently</code><br />
â€” <strong>íŠ¹í™”ëœ reasoning í‰ê°€</strong> ì—” <code class="language-plaintext highlighter-rouge">LLM Reasoners</code>, <code class="language-plaintext highlighter-rouge">Verdict</code><br />
â€” <strong>í›ˆë ¨/ì¶”ë¡  ì¤‘ì‹¬ í†µí•© ì‹¤í—˜</strong> ì—” <code class="language-plaintext highlighter-rouge">OpenR</code></p>

<p>í•„ìš”í•˜ì‹œë©´ í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¤‘ í•˜ë‚˜ë¥¼ ê³¨ë¼ <strong>ì„¤ì¹˜ë¶€í„° ì‹¤í—˜ ì½”ë“œ ì˜ˆì œ</strong> ê¹Œì§€ ë„ì™€ ë“œë¦´ê²Œìš”!</p>

<p class="chat--user">

í• ê²Œ ë„ˆë¬´ ë§ë„¤ ë‚´ê°€ ì‹¤í—˜í•˜ë ¤ëŠ” ëª¨ë¸ì€ gpt ossì•¼ ì´ë¯¸ í•œ ì‚¬ëŒ ì—†ì„ê¹Œ? ìš°ë¦¬ default ëª¨ë¸ì´ ì–´ë–¤ reasoning levelì´ defaultì¸ì§€ ê°„ë‹¨íˆ ì‹¤í—˜í•´ë³´ê³  ì‹¶ì–´

</p>

<p>ë§ì•„ìš”â€”ì´ë¯¸ í•´ë³¸ ì‚¬ëŒë“¤ì´ ìˆê³ , ë¬¸ì„œì—ë„ <strong>ê¸°ë³¸ê°’ì€ ë³´í†µ â€œmediumâ€</strong> ìœ¼ë¡œ ëª…ì‹œë¼ìš”. ì˜ˆì»¨ëŒ€ Databricksì˜ reasoning ëª¨ë¸ ê°€ì´ë“œì— <code class="language-plaintext highlighter-rouge">reasoning_effort</code> ê°’ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">"low"</code>, <strong><code class="language-plaintext highlighter-rouge">"medium"(default)</code></strong> , <code class="language-plaintext highlighter-rouge">"high"</code>ê°€ ë‚˜ì˜¨ë‹¤ê³  ë˜ì–´ ìˆì–´ìš”. ë˜ gpt-oss ì†Œê°œ/ëª¨ë¸ ì¹´ë“œì—ì„œë„ ì„¸ ë ˆë²¨ì„ ì§€ì›í•œë‹¤ê³  í•©ë‹ˆë‹¤. <a href="https://docs.databricks.com/aws/en/machine-learning/model-serving/query-reason-models?utm_source=chatgpt.com">Databricks Documentation</a><a href="https://openai.com/index/introducing-gpt-oss/?utm_source=chatgpt.com">OpenAI+1</a></p>

<p>ë‹¤ë§Œ â€œìš°ë¦¬ ì¸í”„ë¼/ì—”ë“œí¬ì¸íŠ¸â€ì˜ <strong>ì‹¤ì œ ê¸°ë³¸ê°’</strong> ì€ ê²Œì´íŠ¸ì›¨ì´ë‚˜ í”„ë¡ì‹œì—ì„œ ë®ì–´ì“¸ ìˆ˜ë„ ìˆìœ¼ë‹ˆ, <strong>ì´ˆë¯¸ë‹ˆ ê²€ì¦ ì‹¤í—˜</strong> ìœ¼ë¡œ í™•ì •í•˜ëŠ” ê²Œ ì œì¼ ê¹”ë”í•´ìš”. ì•„ë˜ ê·¸ëŒ€ë¡œ ëŒë ¤ë³´ë©´ 5ë¶„ ì»·.</p>

<hr />

<h1 id="ì´ˆê°„ë‹¨-ê²€ì¦-í”Œëœ-step-by-step">ì´ˆê°„ë‹¨ ê²€ì¦ í”Œëœ (step-by-step)</h1>

<ol>
  <li>
    <p><strong>í…ŒìŠ¤íŠ¸ í”„ë¡¬í”„íŠ¸ ê³ ì •</strong></p>

    <ul>
      <li>ì§§ê³  ì •ë‹µì´ ìˆëŠ” ë¬¸ì œ 1â€“2ê°œ(ì˜ˆ: ê°„ë‹¨ ì‚°ìˆ˜, ìƒì‹ ë¬¸ì œ).</li>
    </ul>
  </li>
  <li>
    <p><strong>ë„¤ ê°€ì§€ í˜¸ì¶œ ìˆ˜í–‰</strong></p>

    <ul>
      <li>
        <p>A: <code class="language-plaintext highlighter-rouge">reasoning_effort</code> <strong>ë¯¸ì§€ì •</strong> (ì‹¤ì œ ê¸°ë³¸ê°’ ì²´í¬)</p>
      </li>
      <li>
        <p>B: <code class="language-plaintext highlighter-rouge">"medium"</code></p>
      </li>
      <li>
        <p>C: <code class="language-plaintext highlighter-rouge">"low"</code></p>
      </li>
      <li>
        <p>D: <code class="language-plaintext highlighter-rouge">"high"</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ë¡œê·¸ë¡œ ë¹„êµí•  í•­ëª©</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">latency_ms</code>, <code class="language-plaintext highlighter-rouge">usage.reasoning_tokens</code>(ì§€ì› ì‹œ), <code class="language-plaintext highlighter-rouge">completion_tokens</code>, ì‘ë‹µ ê¸¸ì´/ì •í™•ë„.</p>
      </li>
      <li>
        <p>Aì™€ Bê°€ ê±°ì˜ ë™ì¼í•˜ë©´ <strong>ê¸°ë³¸ê°’=medium</strong> ìœ¼ë¡œ íŒë‹¨.</p>
      </li>
      <li>
        <p>C &lt; B &lt; D ìˆœìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">reasoning_tokens</code>ì™€ ì§€ì—°ì´ ì¦ê°€í•˜ë©´ íŒŒë¼ë¯¸í„° ì •ìƒ ë™ì‘.</p>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="curl-ì˜ˆì‹œ-ì—”ë“œí¬ì¸íŠ¸ë§Œ-ë°”ê¾¸ë©´-ë¨">cURL ì˜ˆì‹œ (ì—”ë“œí¬ì¸íŠ¸ë§Œ ë°”ê¾¸ë©´ ë¨)</h2>

<p>A) ê¸°ë³¸ê°’ í™•ì¸ (ë¯¸ì§€ì •)</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-s</span> <span class="nt">-X</span> POST <span class="s2">"</span><span class="nv">$ENDPOINT_URL</span><span class="s2">"</span> <span class="se">\</span>
 <span class="nt">-H</span> <span class="s2">"Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">"</span> <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
 <span class="nt">-d</span> <span class="s1">'{
   "model":"gpt-oss-20b",
   "temperature":0.2,
   "messages":[
     {"role":"system","content":"You are a helpful assistant."},
     {"role":"user","content":"12ê°œì˜ ì‚¬ê³¼ë¥¼ 3ëª…ì—ê²Œ ê³µí‰í•˜ê²Œ ë‚˜ëˆ„ë©´?"}
   ]
 }'</span>
</code></pre></div></div>

<p>B) Medium</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-d</span> <span class="s1">'{
  "model":"gpt-oss-20b",
  "reasoning_effort":"medium",
  "temperature":0.2,
  "messages":[{"role":"system","content":"You are a helpful assistant."},
              {"role":"user","content":"12ê°œì˜ ì‚¬ê³¼ë¥¼ 3ëª…ì—ê²Œ ê³µí‰í•˜ê²Œ ë‚˜ëˆ„ë©´?"}]
}'</span>
</code></pre></div></div>

<p>C) Low / D) HighëŠ” <code class="language-plaintext highlighter-rouge">"reasoning_effort"</code> ê°’ë§Œ ê°ê° <code class="language-plaintext highlighter-rouge">"low"</code>, <code class="language-plaintext highlighter-rouge">"high"</code>ë¡œ ë°”ê¾¸ë©´ ë©ë‹ˆë‹¤.</p>

<hr />

<h2 id="íŒŒì´ì¬-ìŠ¤ë‹ˆí«-ê²°ê³¼ë¥¼-í‘œë¡œ-ë¹„êµ">íŒŒì´ì¬ ìŠ¤ë‹ˆí« (ê²°ê³¼ë¥¼ í‘œë¡œ ë¹„êµ)</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">requests</span>
<span class="n">URL</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="sh">"</span><span class="s">ENDPOINT_URL</span><span class="sh">"</span><span class="p">);</span> <span class="n">KEY</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="sh">"</span><span class="s">API_KEY</span><span class="sh">"</span><span class="p">)</span>
<span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">Authorization</span><span class="sh">"</span><span class="p">:</span><span class="sa">f</span><span class="sh">"</span><span class="s">Bearer </span><span class="si">{</span><span class="n">KEY</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">Content-Type</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">application/json</span><span class="sh">"</span><span class="p">}</span>
<span class="n">payload_base</span><span class="o">=</span><span class="p">{</span>
    <span class="sh">"</span><span class="s">model</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">gpt-oss-20b</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">temperature</span><span class="sh">"</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">messages</span><span class="sh">"</span><span class="p">:[</span>
        <span class="p">{</span><span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">system</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">You are a helpful assistant.</span><span class="sh">"</span><span class="p">},</span>
        <span class="p">{</span><span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">12ê°œì˜ ì‚¬ê³¼ë¥¼ 3ëª…ì—ê²Œ ê³µí‰í•˜ê²Œ ë‚˜ëˆ„ë©´?</span><span class="sh">"</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">t0</span><span class="o">=</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
    <span class="n">r</span><span class="o">=</span><span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span><span class="n">json</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
    <span class="n">dt</span><span class="o">=</span><span class="nf">round</span><span class="p">((</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">j</span><span class="o">=</span><span class="n">r</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
    <span class="n">u</span><span class="o">=</span><span class="n">j</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">usage</span><span class="sh">"</span><span class="p">,{})</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">effort</span><span class="sh">"</span><span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">reasoning_effort</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">&lt;unspecified&gt;</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">latency_ms</span><span class="sh">"</span><span class="p">:</span><span class="n">dt</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">reasoning_tokens</span><span class="sh">"</span><span class="p">:</span><span class="n">u</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">reasoning_tokens</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">in_tokens</span><span class="sh">"</span><span class="p">:</span><span class="n">u</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">prompt_tokens</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">out_tokens</span><span class="sh">"</span><span class="p">:</span><span class="n">u</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">completion_tokens</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">text</span><span class="sh">"</span><span class="p">:</span><span class="n">j</span><span class="p">[</span><span class="sh">"</span><span class="s">choices</span><span class="sh">"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">][:</span><span class="mi">80</span><span class="p">]</span>
    <span class="p">}</span>

<span class="n">rows</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">effort</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="sh">"</span><span class="s">medium</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">low</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">high</span><span class="sh">"</span><span class="p">]:</span>
    <span class="n">p</span><span class="o">=</span><span class="nf">dict</span><span class="p">(</span><span class="n">payload_base</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">effort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="sh">"</span><span class="s">reasoning_effort</span><span class="sh">"</span><span class="p">]</span><span class="o">=</span><span class="n">effort</span>
    <span class="n">rows</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">run</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ê¸°ëŒ€ë˜ëŠ”-íŒë³„-ê¸°ì¤€">ê¸°ëŒ€ë˜ëŠ” íŒë³„ ê¸°ì¤€</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">effort=ë¯¸ì§€ì •</code> ê³¼ <code class="language-plaintext highlighter-rouge">medium</code>ì˜ <strong>ì§€ì—°/í† í° ìˆ˜ê°€ ê±°ì˜ ë™ì¼</strong> â‡’ ì‹¤ ê¸°ë³¸ê°’ì€ <strong>medium</strong>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">low</code>ëŠ” ë” ì§§ê³  í† í° ì ìŒ, <code class="language-plaintext highlighter-rouge">high</code>ëŠ” ë” ê¸¸ê³  í† í° ë§ìŒ â‡’ ë ˆë²¨ ìŠ¤ìœ„ì¹˜ ì •ìƒ.</p>
  </li>
</ul>

<hr />

<h2 id="ì´ë¯¸-í•œ-ì‚¬ëŒ-ì—†ì„ê¹Œì—-ëŒ€í•œ-ì§§ì€-ì •ë¦¬">â€œì´ë¯¸ í•œ ì‚¬ëŒ ì—†ì„ê¹Œ?â€ì— ëŒ€í•œ ì§§ì€ ì •ë¦¬</h2>

<ul>
  <li>gpt-oss ì¶œì‹œ ì†Œê°œ/ëª¨ë¸ ì¹´ë“œ/í”Œë«í¼ ë¬¸ì„œì—ì„œ <strong>ì„¸ ë ˆë²¨(ì €Â·ì¤‘Â·ê³ )</strong> ì§€ì›ê³¼ <strong>ê¸°ë³¸ê°’ medium</strong> ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ ë°°í¬ í™˜ê²½ì— ë”°ë¼ ê¸°ë³¸ê°’ì´ ë°”ë€” ìˆ˜ ìˆìœ¼ë‹ˆ ìœ„ ë¯¸ë‹ˆ í…ŒìŠ¤íŠ¸ë¡œ <strong>ìš°ë¦¬ í™˜ê²½ì˜ ì‹¤ì œ ê¸°ë³¸ê°’</strong> ì„ í™•ì •í•˜ëŠ” ê±¸ ê¶Œì¥í•©ë‹ˆë‹¤. <a href="https://openai.com/index/introducing-gpt-oss/?utm_source=chatgpt.com">OpenAI+1</a><a href="https://docs.databricks.com/aws/en/machine-learning/model-serving/query-reason-models?utm_source=chatgpt.com">Databricks Documentation</a></li>
</ul>

<p>ì›í•˜ì‹œë©´ ìœ„ íŒŒì´ì¬ ìŠ¤ë‹ˆí«ì„ <strong>CSV ì €ì¥/ê°„ë‹¨ ê·¸ë˜í”„</strong> ê¹Œì§€ í™•ì¥í•´ ë“œë¦´ê²Œìš”.</p>

<p class="chat--user">

ë„ˆë¬´ ì§ˆë¬¸ì´ ê°„ë‹¨í•œê±° ì•„ë‹ˆì•¼? ê·¸ê±´ ë¬¸ì œê°€ ì•ˆë¼?

</p>

<p>ì§ˆë¬¸ì´ ê°„ë‹¨í•´ë„ <strong>ê¸°ë³¸ê°’ í™•ì¸</strong> ì—ëŠ” ì•„ë¬´ ë¬¸ì œê°€ ì—†ì–´ìš”.<br />
ì—¬ê¸°ì„œ ìš°ë¦¬ê°€ ë³´ê³  ì‹¶ì€ ê±´ <strong>ì¶”ë¡  ì •í™•ë„</strong> ê°€ ì•„ë‹ˆë¼ <strong>reasoning_effort ì„¤ì •ì— ë”°ë¥¸ í† í°Â·ì§€ì—° ì‹œê°„ ë³€í™”</strong> ì´ê¸° ë•Œë¬¸ì´ì—ìš”.</p>

<hr />

<h2 id="ì™œ-ê°„ë‹¨í•œ-ì§ˆë¬¸ì´-ê´œì°®ì€ì§€">ì™œ ê°„ë‹¨í•œ ì§ˆë¬¸ì´ ê´œì°®ì€ì§€</h2>

<ol>
  <li>
    <p><strong>ëª©í‘œê°€ â€œdefault ê°’ì´ ë¬´ì—‡ì¸ì§€ í™•ì¸â€</strong> â†’ ì •ë‹µ ì—¬ë¶€ë³´ë‹¤ <em>ì‘ë‹µ íŒ¨í„´</em> ì´ í•µì‹¬</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">reasoning_effort</code>ë¥¼ ë°”ê¿¨ì„ ë•Œ reasoning tokens ìˆ˜ë‚˜ latencyê°€ ë‹¬ë¼ì§€ëŠ”ì§€ í™•ì¸í•˜ë©´ ì¶©ë¶„.</li>
    </ul>
  </li>
  <li>
    <p>ë³µì¡í•œ ì§ˆë¬¸ì€ ì˜¤íˆë ¤ ë³€ìˆ˜ ì¦ê°€</p>

    <ul>
      <li>ë‚œì´ë„ ë†’ì€ ì§ˆë¬¸ì€ ëœë¤ì„±Â·ì°½ì˜ì„± ìš”ì†Œê°€ ì»¤ì„œ ë¹„êµ ì¡ìŒ(noise) ì¦ê°€.</li>
    </ul>
  </li>
  <li>
    <p>ë‹¨ìˆœ ì§ˆë¬¸ë„ reasoning ë‹¨ê³„ ìˆ˜ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŒ</p>

    <ul>
      <li>Highì¼ ê²½ìš°, ë¶ˆí•„ìš”í•˜ê²Œë„ ë” ì¥í™©í•˜ê²Œ chain-of-thoughtì„ ìƒì„±í•  ìˆ˜ ìˆìŒ â†’ í† í°/ì‹œê°„ ì°¨ì´ ëª…í™•íˆ ê´€ì°° ê°€ëŠ¥.</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="ë‹¤ë§Œ-ì´ëŸ°-ì -ì£¼ì˜">ë‹¤ë§Œ ì´ëŸ° ì  ì£¼ì˜</h2>

<ul>
  <li>
    <p>ë„ˆë¬´ trivialí•´ì„œ <strong>í† í°Â·ì‹œê°„ ì°¨ì´ê°€ ê±°ì˜ ì—†ëŠ” ê²½ìš°</strong> ê°€ ìˆì„ ìˆ˜ ìˆìŒ.<br />
â†’ ê·¸ëŸ´ ë• ë‚œì´ë„ë¥¼ ì‚´ì§ ì˜¬ë¦° <strong>ì§§ì€ ë…¼ë¦¬ í¼ì¦/ë‘ì„¸ ë‹¨ê³„ ì‚°ìˆ˜ ë¬¸ì œ</strong> ì¶”ì²œ.</p>
  </li>
  <li>
    <p>ê°™ì€ ë¬¸ì œë¥¼ Low/Medium/High ëª¨ë‘ ëŒë ¤ì•¼ ë¹„êµ ê°€ëŠ¥.</p>
  </li>
  <li>
    <p>ê²°ê³¼ í•´ì„ ì‹œ <em>ì ˆëŒ€ê°’</em> ë³´ë‹¤ <strong>ìƒëŒ€ ë¹„êµ</strong> ë¥¼ ë³´ì•„ì•¼ í•¨.</p>
  </li>
</ul>

<hr />

<p>ì›í•˜ì‹œë©´ ì œê°€ <strong>ì§§ì§€ë§Œ reasoning ì°¨ì´ë¥¼ ì˜ ë“œëŸ¬ë‚´ëŠ” ì§ˆë¬¸ ì„¸íŠ¸</strong> ë¥¼ ë§Œë“¤ì–´ ë“œë¦´ ìˆ˜ ìˆì–´ìš”.<br />
ì˜ˆë¥¼ ë“¤ì–´ 5~10ì´ˆ ë‚´ë¡œ í’€ ìˆ˜ ìˆì§€ë§Œ, reasoning effortê°€ ë†’ìœ¼ë©´ ë¶ˆí•„ìš”í•˜ê²Œ ë” í’€ì–´ì“°ëŠ” ë¬¸ì œë“¤ìš”.</p>

<p class="chat--user">

ë„ˆë¬´ trivial í•˜ì–ì•„. ìœ ì¹˜ì›ìƒ ë ˆë²¨

</p>

<p>ë§ì•„ìš” ğŸ˜‚ â€œ12ê°œì˜ ì‚¬ê³¼ ë‚˜ëˆ„ê¸°â€ëŠ” ë„ˆë¬´ ìœ ì¹˜ì› ê¸‰ì´ë¼ HighÂ·MediumÂ·Low ì°¨ì´ê°€ ê±°ì˜ ì•ˆ ë‚  ìˆ˜ ìˆì–´ìš”.<br />
ê¸°ë³¸ê°’ í™•ì¸ì´ ëª©ì ì´ë¼ë„, <strong>ì§§ì§€ë§Œ ì¶”ë¡  ë‹¨ê³„ë¥¼ 2~4ë‹¨ê³„ ê±°ì¹˜ê²Œ ë§Œë“œëŠ” ì§ˆë¬¸</strong> ì„ ì“°ë©´ ì°¨ì´ê°€ í›¨ì”¬ ì˜ ë“œëŸ¬ë‚©ë‹ˆë‹¤.</p>

<hr />

<h2 id="reasoning-ì°¨ì´ë¥¼-ì˜-ë“œëŸ¬ë‚´ëŠ”-ê°„ë‹¨ì§§ì€-ì˜ˆì‹œ">Reasoning ì°¨ì´ë¥¼ ì˜ ë“œëŸ¬ë‚´ëŠ” ê°„ë‹¨Â·ì§§ì€ ì˜ˆì‹œ</h2>

<ol>
  <li><strong>2ë‹¨ê³„ ì‚°ìˆ˜ í¼ì¦</strong></li>
</ol>

<blockquote>
  <p>3ê°œì˜ ìƒìì— ê°ê° 4, 7, 9ê°œì˜ ì‚¬íƒ•ì´ ìˆë‹¤. ìƒì 2ì—ì„œ 5ê°œë¥¼ êº¼ë‚´ ìƒì 1ì— ë„£ê³ , ìƒì 3ì—ì„œ 2ê°œë¥¼ êº¼ë‚´ ìƒì 2ì— ë„£ìœ¼ë©´, ê° ìƒìì—ëŠ” ëª‡ ê°œì”© ë‚¨ëŠ”ê°€?</p>
</blockquote>

<ol>
  <li><strong>ê°„ë‹¨ ë…¼ë¦¬ ë¬¸ì œ</strong></li>
</ol>

<blockquote>
  <p>ì² ìˆ˜, ì˜í¬, ë¯¼ìˆ˜ëŠ” ë‹¬ë¦¬ê¸° ì‹œí•©ì„ í–ˆë‹¤. ì² ìˆ˜ëŠ” ì˜í¬ë³´ë‹¤ ë¹ ë¥´ê³ , ì˜í¬ëŠ” ë¯¼ìˆ˜ë³´ë‹¤ ëŠë¦¬ë‹¤. ëˆ„ê°€ 1ë“±ì¸ê°€?</p>
</blockquote>

<ol>
  <li><strong>ë‚ ì§œ ê³„ì‚°</strong></li>
</ol>

<blockquote>
  <p>ì˜¤ëŠ˜ì´ 2025ë…„ 8ì›” 11ì¼ì´ë¼ë©´, 45ì¼ í›„ëŠ” ë¬´ìŠ¨ ìš”ì¼ì¸ê°€?</p>
</blockquote>

<ol>
  <li><strong>ì§§ì€ ì¡°ê±´ ì¶”ë¡ </strong></li>
</ol>

<blockquote>
  <p>ì‚¬ê³¼ëŠ” 500g, ë°°ëŠ” 700gì´ë‹¤. ì‚¬ê³¼ 3ê°œì™€ ë°° 2ê°œì˜ ì´ ë¬´ê²ŒëŠ” ëª‡ kgì¸ê°€?</p>
</blockquote>

<ol>
  <li><strong>íŒ¨í„´ ì™„ì„±</strong></li>
</ol>

<blockquote>
  <p>ìˆ˜ì—´ 2, 4, 8, 16, ? ë‹¤ìŒ ìˆ«ìëŠ”?</p>
</blockquote>

<hr />

<h2 id="ì´ìœ ">ì´ìœ </h2>

<ul>
  <li>
    <p>ì´ëŸ° ë¬¸ì œë“¤ì€ <strong>High reasoning effort</strong> ì¼ ë•Œ ë¶ˆí•„ìš”í•˜ê²Œ ì„¸ì„¸í•œ Chain-of-Thoughtì„ ìƒì„±í•˜ë¯€ë¡œ í† í°Â·ì§€ì—° ì°¨ì´ê°€ í™•ì—°.</p>
  </li>
  <li>
    <p>Mediumì€ í•„ìš”í•œ ê³„ì‚°ë§Œ, LowëŠ” ë” ìš”ì•½ëœ ì¶”ë¡ ë§Œ ì œê³µí•˜ëŠ” ê²½í–¥.</p>
  </li>
  <li>
    <p>ì •ë‹µì´ ëª…í™•í•´ì„œ ë¹„êµ ì‹œ í˜¼ë™ ì—†ìŒ.</p>
  </li>
</ul>

<hr />

<p>ì›í•˜ì‹œë©´ ì œê°€ ì´ ë¬¸ì œë“¤ë¡œ <strong>ë¯¸ë‹ˆ default ê°’ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸</strong> ë¥¼ ë§Œë“¤ì–´ ë“œë¦´ê²Œìš”.<br />
ê·¸ëŸ¬ë©´ ë°”ë¡œ í•œ ë²ˆì— Low/Medium/High &amp; ë¯¸ì§€ì • ë„¤ ê°€ì§€ í˜¸ì¶œì„ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br />
ê·¸ë ‡ê²Œ í• ê¹Œìš”?</p>

<p class="chat--user">

ì‘ ìŠ¤í¬ë¦½íŠ¸ ë§Œë“¤ì–´ì¤˜

</p>

<p>ì™„ë£Œ! ë°”ë¡œ ëŒë¦´ ìˆ˜ ìˆëŠ” <strong>ë¯¸ë‹ˆ ê¸°ë³¸ê°’ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸</strong> ë¥¼ ë§Œë“¤ì–´ ë†¨ì–´ìš”.</p>

<p>Download the script (gpt_oss_effort_smoke_test.py)</p>

<h3 id="ì–´ë–»ê²Œ-ì“°ë‚˜ìš”-step-by-step">ì–´ë–»ê²Œ ì“°ë‚˜ìš”? (step-by-step)</h3>

<ol>
  <li>í™˜ê²½ë³€ìˆ˜ ì„¤ì •</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">ENDPOINT_URL</span><span class="o">=</span><span class="s2">"https://&lt;your-endpoint&gt;"</span>
<span class="nb">export </span><span class="nv">API_KEY</span><span class="o">=</span><span class="s2">"sk-..."</span>
</code></pre></div></div>

<ol>
  <li>ì‹¤í–‰</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python gpt_oss_effort_smoke_test.py <span class="nt">--model</span> gpt-oss-20b <span class="nt">--repeats</span> 2
</code></pre></div></div>

<ul>
  <li>
    <p>ê° í”„ë¡¬í”„íŠ¸ì— ëŒ€í•´ <strong>effort ë¯¸ì§€ì • / low / medium / high</strong> 4ê°€ì§€ë¡œ í˜¸ì¶œí•©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">runs.jsonl</code>(ì›ì‹œ ë¡œê·¸)ê³¼ <code class="language-plaintext highlighter-rouge">summary.csv</code>(ìš”ì•½ í‰ê· ì¹˜)ë¥¼ ì €ì¥í•˜ê³ , ì½˜ì†”ì— ë…¸ë ¥ìˆ˜ì¤€ë³„ í‰ê·  <strong>latency / tokens</strong> ë¥¼ í‘œë¡œ ì¶œë ¥í•©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">usage.reasoning_tokens</code>ê°€ APIì— ìˆìœ¼ë©´ ê°™ì´ ì§‘ê³„í•©ë‹ˆë‹¤.</p>
  </li>
</ul>

<h3 id="í•´ì„-íŒ">í•´ì„ íŒ</h3>

<ul>
  <li>
    <p>ì½˜ì†” í‘œì—ì„œ <strong><code class="language-plaintext highlighter-rouge">&lt;unspecified&gt;</code>ì™€ <code class="language-plaintext highlighter-rouge">medium</code>ì´ ê±°ì˜ ë™ì¼</strong>í•˜ë©´, ì—¬ëŸ¬ë¶„ í™˜ê²½ì˜ <strong>ê¸°ë³¸ê°’=medium</strong> ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ë³´í†µ í† í°/ì§€ì—°ì€ <strong>low &lt; medium &lt; high</strong> ìˆœìœ¼ë¡œ ì¦ê°€í•©ë‹ˆë‹¤.</p>
  </li>
</ul>

<p>ì›í•˜ë©´ <code class="language-plaintext highlighter-rouge">CSV â†’ ê·¸ë˜í”„(plot)</code> ë²„ì „ë„ ë°”ë¡œ ë§Œë“¤ì–´ ë“œë¦´ê²Œìš”.</p>

<p class="chat--user">

<code class="language-plaintext highlighter-rouge">python
# Create a ready-to-run Python script for mini default verification of reasoning_effort.
script = r'''#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
gpt_oss_effort_smoke_test.py

Mini smoke test to infer the default reasoning_effort for your GPT-OSS endpoint
and verify Low/Medium/High switches affect latency and tokens.

USAGE
-----
1) Set environment variables:
   export ENDPOINT_URL="https://&lt;your-endpoint&gt;"
   export API_KEY="sk-..."
2) (Optional) Choose model id via CLI: --model gpt-oss-20b
3) Run:
   python gpt_oss_effort_smoke_test.py --repeats 2

This will:
- Send a compact set of short-but-not-trivial prompts.
- Call the endpoint with four variants per prompt:
    A) effort unspecified  (to detect actual DEFAULT)
    B) effort = "medium"
    C) effort = "low"
    D) effort = "high"
- Log per-call latency, tokens, and short text preview.
- Save results to runs.jsonl and summary.csv.
- Print a quick table showing means by effort (latency / tokens).

Notes
-----
- The script assumes an OpenAI-compatible chat completions API that returns:
    { choices: [{ message: { content: str }}],
      usage: { prompt_tokens, completion_tokens, reasoning_tokens? } }
- If your API names differ, adjust parse_usage().
- The script retries transient HTTP errors with backoff.
"""

import argparse
import json
import os
import random
import sys
import time
from datetime import datetime
from typing import Any, Dict, Optional

import requests

# ---------- Configurable defaults ----------

DEFAULT_MODEL = "gpt-oss-20b"
DEFAULT_TEMPERATURE = 0.2
DEFAULT_MAX_TOKENS = 512
DEFAULT_SEED = 42
DEFAULT_TIMEOUT = 60
DEFAULT_REPEATS = 2

PROMPTS = [
    {
        "id": "math_boxes",
        "text": (
            "3ê°œì˜ ìƒìì— ê°ê° 4, 7, 9ê°œì˜ ì‚¬íƒ•ì´ ìˆë‹¤. "
            "ìƒì 2ì—ì„œ 5ê°œë¥¼ êº¼ë‚´ ìƒì 1ì— ë„£ê³ , ìƒì 3ì—ì„œ 2ê°œë¥¼ êº¼ë‚´ ìƒì 2ì— ë„£ìœ¼ë©´, "
            "ê° ìƒìì—ëŠ” ëª‡ ê°œì”© ë‚¨ëŠ”ê°€? ìµœì¢… ê²°ê³¼ë§Œ í•œêµ­ì–´ë¡œ ë§í•´ì¤˜."
        ),
    },
    {
        "id": "logic_race",
        "text": (
            "ì² ìˆ˜, ì˜í¬, ë¯¼ìˆ˜ëŠ” ë‹¬ë¦¬ê¸° ì‹œí•©ì„ í–ˆë‹¤. ì² ìˆ˜ëŠ” ì˜í¬ë³´ë‹¤ ë¹ ë¥´ê³ , "
            "ì˜í¬ëŠ” ë¯¼ìˆ˜ë³´ë‹¤ ëŠë¦¬ë‹¤. ëˆ„ê°€ 1ë“±ì¸ê°€? í•œ ë‹¨ì–´ë¡œë§Œ ë‹µí•´."
        ),
    },
    {
        "id": "date_calc",
        "text": (
            "ì˜¤ëŠ˜ì´ 2025ë…„ 8ì›” 11ì¼ì´ë¼ë©´, 45ì¼ í›„ëŠ” ë¬´ìŠ¨ ìš”ì¼ì¸ê°€?"
            " í•œêµ­ ì‹œê°„ëŒ€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ, ìš”ì¼ë§Œ í•œêµ­ì–´ë¡œ ë‹µí•´."
        ),
    },
    {
        "id": "weight_sum",
        "text": (
            "ì‚¬ê³¼ëŠ” 500g, ë°°ëŠ” 700gì´ë‹¤. ì‚¬ê³¼ 3ê°œì™€ ë°° 2ê°œì˜ ì´ ë¬´ê²ŒëŠ” ëª‡ kgì¸ê°€? "
            "ì†Œìˆ˜ì  ë‘˜ì§¸ ìë¦¬ê¹Œì§€ kg ë‹¨ìœ„ë¡œë§Œ ë‹µí•´."
        ),
    },
    {
        "id": "sequence",
        "text": "ìˆ˜ì—´ 2, 4, 8, 16, ? ë‹¤ìŒ ìˆ«ìëŠ”? ìˆ«ìë§Œ."
    },
]

EFFORT_LEVELS = [None, "medium", "low", "high"]  # None = unspecified (to detect actual default)

# ---------- Helpers ----------

def env(key: str, default: Optional[str] = None) -&gt; str:
    val = os.getenv(key, default)
    if val is None:
        print(f"[ERROR] Missing environment variable: {key}", file=sys.stderr)
        sys.exit(1)
    return val

def parse_usage(obj: Dict[str, Any]) -&gt; Dict[str, Optional[int]]:
    usage = obj.get("usage", {}) or {}
    return {
        "prompt_tokens": usage.get("prompt_tokens"),
        "completion_tokens": usage.get("completion_tokens"),
        "reasoning_tokens": usage.get("reasoning_tokens"),  # optional
        "total_tokens": usage.get("total_tokens"),
    }

def short(s: Optional[str], n: int = 80) -&gt; str:
    if not s:
        return ""
    s = s.replace("\n", " ").strip()
    return s[:n] + ("â€¦" if len(s) &gt; n else "")

def post_with_retries(url: str, headers: Dict[str, str], payload: Dict[str, Any], timeout: int) -&gt; requests.Response:
    backoffs = [0.5, 1.0, 2.0]
    for i, delay in enumerate([0.0] + backoffs):
        if delay:
            time.sleep(delay)
        try:
            resp = requests.post(url, headers=headers, json=payload, timeout=timeout)
            if resp.status_code in (429, 500, 502, 503, 504):
                # transient; let the loop retry
                last = resp
                continue
            return resp
        except requests.RequestException as e:
            last = e  # type: ignore[assignment]
    # On failure after retries, raise or return last response if available
    if isinstance(last, requests.Response):
        return last
    raise RuntimeError(f"HTTP error after retries: {last}")

def call_once(endpoint: str, api_key: str, model: str, user_text: str,
              effort: Optional[str], temperature: float, max_tokens: int,
              seed: Optional[int], timeout: int) -&gt; Dict[str, Any]:
    headers = {
        "Authorization": f"Bearer {api_key}",
        "Content-Type": "application/json",
    }
    messages = [
        {"role": "system", "content": "You are a helpful assistant."},
        {"role": "user", "content": user_text},
    ]
    body: Dict[str, Any] = {
        "model": model,
        "temperature": temperature,
        "max_tokens": max_tokens,
        "messages": messages,
    }
    if seed is not None:
        body["seed"] = seed
    if effort is not None:
        body["reasoning_effort"] = effort

    t0 = time.time()
    resp = post_with_retries(endpoint, headers, body, timeout=timeout)
    elapsed_ms = int(round((time.time() - t0) * 1000))

    result: Dict[str, Any] = {
        "status": resp.status_code,
        "latency_ms": elapsed_ms,
        "response_text": None,
        "usage": None,
        "raw": None,
        "error": None,
    }

    try:
        data = resp.json()
    except Exception as e:
        result["error"] = f"Non-JSON response: {resp.text[:200]} ({e})"
        return result

    result["raw"] = data
    if resp.status_code != 200:
        result["error"] = data
        return result

    try:
        text = data["choices"][0]["message"]["content"]
    except Exception:
        text = None
    result["response_text"] = text
    result["usage"] = parse_usage(data)
    return result

def mean(xs):
    vals = [x for x in xs if isinstance(x, (int, float))]
    return sum(vals)/len(vals) if vals else None

def safe_int(x):
    return int(x) if isinstance(x, (int, float)) else None

# ---------- Main ----------

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("--model", default=DEFAULT_MODEL)
    parser.add_argument("--repeats", type=int, default=DEFAULT_REPEATS,
                        help="Number of repeats per (prompt, effort) pair")
    parser.add_argument("--timeout", type=int, default=DEFAULT_TIMEOUT)
    parser.add_argument("--temperature", type=float, default=DEFAULT_TEMPERATURE)
    parser.add_argument("--max_tokens", type=int, default=DEFAULT_MAX_TOKENS)
    parser.add_argument("--no_seed", action="store_true", help="Do not send seed")
    args = parser.parse_args()

    endpoint = env("ENDPOINT_URL")
    api_key = env("API_KEY")
    model = args.model
    seed = None if args.no_seed else DEFAULT_SEED

    random.seed(2025)
    pairs = []
    for p in PROMPTS:
        for eff in EFFORT_LEVELS:
            for trial in range(args.repeats):
                pairs.append((p, eff, trial))
    random.shuffle(pairs)

    runs_path = "runs.jsonl"
    summary_rows = []
    n_ok = 0
    n_err = 0

    with open(runs_path, "w", encoding="utf-8") as f:
        for p, eff, trial in pairs:
            res = call_once(
                endpoint=endpoint, api_key=api_key, model=model,
                user_text=p["text"], effort=eff, temperature=args.temperature,
                max_tokens=args.max_tokens, seed=seed, timeout=args.timeout
            )
            row = {
                "ts": datetime.utcnow().isoformat(),
                "prompt_id": p["id"],
                "effort": eff if eff is not None else "&lt;unspecified&gt;",
                "trial": trial,
                "status": res["status"],
                "latency_ms": res["latency_ms"],
                "prompt_tokens": (res["usage"] or {}).get("prompt_tokens") if res["usage"] else None,
                "completion_tokens": (res["usage"] or {}).get("completion_tokens") if res["usage"] else None,
                "reasoning_tokens": (res["usage"] or {}).get("reasoning_tokens") if res["usage"] else None,
                "total_tokens": (res["usage"] or {}).get("total_tokens") if res["usage"] else None,
                "text_preview": short(res["response_text"], 120),
                "error": res["error"],
            }
            f.write(json.dumps(row, ensure_ascii=False) + "\n")
            if res["error"]:
                n_err += 1
            else:
                n_ok += 1
            summary_rows.append(row)

    # Aggregate means by effort
    by_effort = {}
    for r in summary_rows:
        e = r["effort"]
        by_effort.setdefault(e, {"latency": [], "comp": [], "reason": [], "total": []})
        if r["latency_ms"] is not None:
            by_effort[e]["latency"].append(r["latency_ms"])
        if r["completion_tokens"] is not None:
            by_effort[e]["comp"].append(r["completion_tokens"])
        if r["reasoning_tokens"] is not None:
            by_effort[e]["reason"].append(r["reasoning_tokens"])
        if r["total_tokens"] is not None:
            by_effort[e]["total"].append(r["total_tokens"])

    # Print quick table
    print("\n=== Quick Means by Effort ===")
    print("Effort           | Latency(ms) | OutTokens | ReasoningTokens | TotalTokens")
    print("-----------------+-------------+-----------+------------------+------------")
    def fmt(x):
        return f"{x:.1f}" if isinstance(x, (int, float)) else "-"
    for e in ["&lt;unspecified&gt;", "low", "medium", "high"]:
        mlat = mean(by_effort.get(e, {}).get("latency", []))
        mout = mean(by_effort.get(e, {}).get("comp", []))
        mrea = mean(by_effort.get(e, {}).get("reason", []))
        mtot = mean(by_effort.get(e, {}).get("total", []))
        print(f"{e:16} | {fmt(mlat):&gt;11} | {fmt(mout):&gt;9} | {fmt(mrea):&gt;16} | {fmt(mtot):&gt;10}")

    # Save a compact CSV summary
    csv_path = "summary.csv"
    try:
        import csv
        with open(csv_path, "w", newline="", encoding="utf-8") as cf:
            writer = csv.writer(cf)
            writer.writerow(["effort","mean_latency_ms","mean_completion_tokens","mean_reasoning_tokens","mean_total_tokens"])
            for e in ["&lt;unspecified&gt;", "low", "medium", "high"]:
                mlat = mean(by_effort.get(e, {}).get("latency", []))
                mout = mean(by_effort.get(e, {}).get("comp", []))
                mrea = mean(by_effort.get(e, {}).get("reason", []))
                mtot = mean(by_effort.get(e, {}).get("total", []))
                writer.writerow([e, f"{mlat:.1f}" if mlat else "", f"{mout:.1f}" if mout else "", f"{mrea:.1f}" if mrea else "", f"{mtot:.1f}" if mtot else ""])
        print(f"\nSaved: {csv_path}")
    except Exception as e:
        print(f"[WARN] CSV write failed: {e}")

    print(f"\nSaved raw runs to: {runs_path}")
    print(f"OK: {n_ok}, ERR: {n_err}")
    print("\nInterpretation tip:")
    print("- If '&lt;unspecified&gt;' and 'medium' are nearly identical across latency/tokens, your gateway default is likely 'medium'.")
    print("- Expect tokens/latency trend: low &lt; medium &lt; high (if reasoning tokens are exposed, same order).")

if __name__ == "__main__":
    main()
'''
with open('/mnt/data/gpt_oss_effort_smoke_test.py', 'w', encoding='utf-8') as f:
    f.write(script)
print("Script written to /mnt/data/gpt_oss_effort_smoke_test.py")
</code>

</p>

<p>ë„¤, ì´ ì½”ë“œ ê·¸ëŒ€ë¡œ <code class="language-plaintext highlighter-rouge">/mnt/data/gpt_oss_effort_smoke_test.py</code> ì— ì €ì¥ë¼ ìˆì–´ì„œ ë°”ë¡œ ë‹¤ìš´ë¡œë“œ í›„ ì‹¤í–‰í•˜ì‹œë©´ ë¼ìš”.</p>

<p>ğŸ“¥ gpt_oss_effort_smoke_test.py ë°›ê¸°</p>

<hr />

<h3 id="ì‹¤í–‰-ë°©ë²•-ìš”ì•½">ì‹¤í–‰ ë°©ë²• ìš”ì•½</h3>

<ol>
  <li>í™˜ê²½ë³€ìˆ˜ ì„¤ì •</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">ENDPOINT_URL</span><span class="o">=</span><span class="s2">"https://&lt;your-endpoint&gt;"</span>
<span class="nb">export </span><span class="nv">API_KEY</span><span class="o">=</span><span class="s2">"sk-..."</span>
</code></pre></div></div>

<ol>
  <li>ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python gpt_oss_effort_smoke_test.py <span class="nt">--model</span> gpt-oss-20b <span class="nt">--repeats</span> 2
</code></pre></div></div>

<ol>
  <li>ê²°ê³¼ í™•ì¸</li>
</ol>

<ul>
  <li>
    <p>ì½˜ì†” í‘œ: effortë³„ í‰ê·  <strong>latency / tokens</strong></p>
  </li>
  <li>
    <p>íŒŒì¼:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">runs.jsonl</code>: ëª¨ë“  í˜¸ì¶œ ê¸°ë¡</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">summary.csv</code>: í‰ê· ì¹˜ ìš”ì•½</p>
      </li>
    </ul>
  </li>
</ul>

<p><strong>íŒ</strong></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">&lt;unspecified&gt;</code>ì™€ <code class="language-plaintext highlighter-rouge">medium</code>ì´ ë¹„ìŠ·í•˜ë©´ defaultê°€ mediumì¼ ê°€ëŠ¥ì„± ë†’ìŒ</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">low &lt; medium &lt; high</code> ìˆœìœ¼ë¡œ reasoning_tokensì™€ latencyê°€ ì¦ê°€í•˜ëŠ”ì§€ í™•ì¸</p>
  </li>
</ul>

<p class="chat--user">

<code class="language-plaintext highlighter-rouge">python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
gpt_oss_effort_smoke_test.py

Mini smoke test to infer the default reasoning_effort for your GPT-OSS endpoint
and verify Low/Medium/High switches affect latency and tokens.

USAGE
-----
1) Set environment variables:
   export ENDPOINT_URL="https://&lt;your-endpoint&gt;"
   export API_KEY="sk-..."
2) (Optional) Choose model id via CLI: --model gpt-oss-20b
3) Run:
   python gpt_oss_effort_smoke_test.py --repeats 2

This will:
- Send a compact set of short-but-not-trivial prompts.
- Call the endpoint with four variants per prompt:
    A) effort unspecified  (to detect actual DEFAULT)
    B) effort = "medium"
    C) effort = "low"
    D) effort = "high"
- Log per-call latency, tokens, and short text preview.
- Save results to runs.jsonl and summary.csv.
- Print a quick table showing means by effort (latency / tokens).

Notes
-----
- The script assumes an OpenAI-compatible chat completions API that returns:
    { choices: [{ message: { content: str }}],
      usage: { prompt_tokens, completion_tokens, reasoning_tokens? } }
- If your API names differ, adjust parse_usage().
- The script retries transient HTTP errors with backoff.
"""

import argparse
import json
import os
import random
import sys
import time
from datetime import datetime
from typing import Any, Dict, Optional

import requests

# ---------- Configurable defaults ----------

DEFAULT_MODEL = "gpt-oss-20b"
DEFAULT_TEMPERATURE = 0.2
DEFAULT_MAX_TOKENS = 512
DEFAULT_SEED = 42
DEFAULT_TIMEOUT = 60
DEFAULT_REPEATS = 2

PROMPTS = [
    {
        "id": "math_boxes",
        "text": (
            "3ê°œì˜ ìƒìì— ê°ê° 4, 7, 9ê°œì˜ ì‚¬íƒ•ì´ ìˆë‹¤. "
            "ìƒì 2ì—ì„œ 5ê°œë¥¼ êº¼ë‚´ ìƒì 1ì— ë„£ê³ , ìƒì 3ì—ì„œ 2ê°œë¥¼ êº¼ë‚´ ìƒì 2ì— ë„£ìœ¼ë©´, "
            "ê° ìƒìì—ëŠ” ëª‡ ê°œì”© ë‚¨ëŠ”ê°€? ìµœì¢… ê²°ê³¼ë§Œ í•œêµ­ì–´ë¡œ ë§í•´ì¤˜."
        ),
    },
    {
        "id": "logic_race",
        "text": (
            "ì² ìˆ˜, ì˜í¬, ë¯¼ìˆ˜ëŠ” ë‹¬ë¦¬ê¸° ì‹œí•©ì„ í–ˆë‹¤. ì² ìˆ˜ëŠ” ì˜í¬ë³´ë‹¤ ë¹ ë¥´ê³ , "
            "ì˜í¬ëŠ” ë¯¼ìˆ˜ë³´ë‹¤ ëŠë¦¬ë‹¤. ëˆ„ê°€ 1ë“±ì¸ê°€? í•œ ë‹¨ì–´ë¡œë§Œ ë‹µí•´."
        ),
    },
    {
        "id": "date_calc",
        "text": (
            "ì˜¤ëŠ˜ì´ 2025ë…„ 8ì›” 11ì¼ì´ë¼ë©´, 45ì¼ í›„ëŠ” ë¬´ìŠ¨ ìš”ì¼ì¸ê°€?"
            " í•œêµ­ ì‹œê°„ëŒ€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ, ìš”ì¼ë§Œ í•œêµ­ì–´ë¡œ ë‹µí•´."
        ),
    },
    {
        "id": "weight_sum",
        "text": (
            "ì‚¬ê³¼ëŠ” 500g, ë°°ëŠ” 700gì´ë‹¤. ì‚¬ê³¼ 3ê°œì™€ ë°° 2ê°œì˜ ì´ ë¬´ê²ŒëŠ” ëª‡ kgì¸ê°€? "
            "ì†Œìˆ˜ì  ë‘˜ì§¸ ìë¦¬ê¹Œì§€ kg ë‹¨ìœ„ë¡œë§Œ ë‹µí•´."
        ),
    },
    {
        "id": "sequence",
        "text": "ìˆ˜ì—´ 2, 4, 8, 16, ? ë‹¤ìŒ ìˆ«ìëŠ”? ìˆ«ìë§Œ."
    },
]

EFFORT_LEVELS = [None, "medium", "low", "high"]  # None = unspecified (to detect actual default)

# ---------- Helpers ----------

def env(key: str, default: Optional[str] = None) -&gt; str:
    val = os.getenv(key, default)
    if val is None:
        print(f"[ERROR] Missing environment variable: {key}", file=sys.stderr)
        sys.exit(1)
    return val

def parse_usage(obj: Dict[str, Any]) -&gt; Dict[str, Optional[int]]:
    usage = obj.get("usage", {}) or {}
    return {
        "prompt_tokens": usage.get("prompt_tokens"),
        "completion_tokens": usage.get("completion_tokens"),
        "reasoning_tokens": usage.get("reasoning_tokens"),  # optional
        "total_tokens": usage.get("total_tokens"),
    }

def short(s: Optional[str], n: int = 80) -&gt; str:
    if not s:
        return ""
    s = s.replace("\n", " ").strip()
    return s[:n] + ("â€¦" if len(s) &gt; n else "")

def post_with_retries(url: str, headers: Dict[str, str], payload: Dict[str, Any], timeout: int) -&gt; requests.Response:
    backoffs = [0.5, 1.0, 2.0]
    for i, delay in enumerate([0.0] + backoffs):
        if delay:
            time.sleep(delay)
        try:
            resp = requests.post(url, headers=headers, json=payload, timeout=timeout)
            if resp.status_code in (429, 500, 502, 503, 504):
                # transient; let the loop retry
                last = resp
                continue
            return resp
        except requests.RequestException as e:
            last = e  # type: ignore[assignment]
    # On failure after retries, raise or return last response if available
    if isinstance(last, requests.Response):
        return last
    raise RuntimeError(f"HTTP error after retries: {last}")

def call_once(endpoint: str, api_key: str, model: str, user_text: str,
              effort: Optional[str], temperature: float, max_tokens: int,
              seed: Optional[int], timeout: int) -&gt; Dict[str, Any]:
    headers = {
        "Authorization": f"Bearer {api_key}",
        "Content-Type": "application/json",
    }
    messages = [
        {"role": "system", "content": "You are a helpful assistant."},
        {"role": "user", "content": user_text},
    ]
    body: Dict[str, Any] = {
        "model": model,
        "temperature": temperature,
        "max_tokens": max_tokens,
        "messages": messages,
    }
    if seed is not None:
        body["seed"] = seed
    if effort is not None:
        body["reasoning_effort"] = effort

    t0 = time.time()
    resp = post_with_retries(endpoint, headers, body, timeout=timeout)
    elapsed_ms = int(round((time.time() - t0) * 1000))

    result: Dict[str, Any] = {
        "status": resp.status_code,
        "latency_ms": elapsed_ms,
        "response_text": None,
        "usage": None,
        "raw": None,
        "error": None,
    }

    try:
        data = resp.json()
    except Exception as e:
        result["error"] = f"Non-JSON response: {resp.text[:200]} ({e})"
        return result

    result["raw"] = data
    if resp.status_code != 200:
        result["error"] = data
        return result

    try:
        text = data["choices"][0]["message"]["content"]
    except Exception:
        text = None
    result["response_text"] = text
    result["usage"] = parse_usage(data)
    return result

def mean(xs):
    vals = [x for x in xs if isinstance(x, (int, float))]
    return sum(vals)/len(vals) if vals else None

def safe_int(x):
    return int(x) if isinstance(x, (int, float)) else None

# ---------- Main ----------

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("--model", default=DEFAULT_MODEL)
    parser.add_argument("--repeats", type=int, default=DEFAULT_REPEATS,
                        help="Number of repeats per (prompt, effort) pair")
    parser.add_argument("--timeout", type=int, default=DEFAULT_TIMEOUT)
    parser.add_argument("--temperature", type=float, default=DEFAULT_TEMPERATURE)
    parser.add_argument("--max_tokens", type=int, default=DEFAULT_MAX_TOKENS)
    parser.add_argument("--no_seed", action="store_true", help="Do not send seed")
    args = parser.parse_args()

    endpoint = env("ENDPOINT_URL")
    api_key = env("API_KEY")
    model = args.model
    seed = None if args.no_seed else DEFAULT_SEED

    random.seed(2025)
    pairs = []
    for p in PROMPTS:
        for eff in EFFORT_LEVELS:
            for trial in range(args.repeats):
                pairs.append((p, eff, trial))
    random.shuffle(pairs)

    runs_path = "runs.jsonl"
    summary_rows = []
    n_ok = 0
    n_err = 0

    with open(runs_path, "w", encoding="utf-8") as f:
        for p, eff, trial in pairs:
            res = call_once(
                endpoint=endpoint, api_key=api_key, model=model,
                user_text=p["text"], effort=eff, temperature=args.temperature,
                max_tokens=args.max_tokens, seed=seed, timeout=args.timeout
            )
            row = {
                "ts": datetime.utcnow().isoformat(),
                "prompt_id": p["id"],
                "effort": eff if eff is not None else "&lt;unspecified&gt;",
                "trial": trial,
                "status": res["status"],
                "latency_ms": res["latency_ms"],
                "prompt_tokens": (res["usage"] or {}).get("prompt_tokens") if res["usage"] else None,
                "completion_tokens": (res["usage"] or {}).get("completion_tokens") if res["usage"] else None,
                "reasoning_tokens": (res["usage"] or {}).get("reasoning_tokens") if res["usage"] else None,
                "total_tokens": (res["usage"] or {}).get("total_tokens") if res["usage"] else None,
                "text_preview": short(res["response_text"], 120),
                "error": res["error"],
            }
            f.write(json.dumps(row, ensure_ascii=False) + "\n")
            if res["error"]:
                n_err += 1
            else:
                n_ok += 1
            summary_rows.append(row)

    # Aggregate means by effort
    by_effort = {}
    for r in summary_rows:
        e = r["effort"]
        by_effort.setdefault(e, {"latency": [], "comp": [], "reason": [], "total": []})
        if r["latency_ms"] is not None:
            by_effort[e]["latency"].append(r["latency_ms"])
        if r["completion_tokens"] is not None:
            by_effort[e]["comp"].append(r["completion_tokens"])
        if r["reasoning_tokens"] is not None:
            by_effort[e]["reason"].append(r["reasoning_tokens"])
        if r["total_tokens"] is not None:
            by_effort[e]["total"].append(r["total_tokens"])

    # Print quick table
    print("\n=== Quick Means by Effort ===")
    print("Effort           | Latency(ms) | OutTokens | ReasoningTokens | TotalTokens")
    print("-----------------+-------------+-----------+------------------+------------")
    def fmt(x):
        return f"{x:.1f}" if isinstance(x, (int, float)) else "-"
    for e in ["&lt;unspecified&gt;", "low", "medium", "high"]:
        mlat = mean(by_effort.get(e, {}).get("latency", []))
        mout = mean(by_effort.get(e, {}).get("comp", []))
        mrea = mean(by_effort.get(e, {}).get("reason", []))
        mtot = mean(by_effort.get(e, {}).get("total", []))
        print(f"{e:16} | {fmt(mlat):&gt;11} | {fmt(mout):&gt;9} | {fmt(mrea):&gt;16} | {fmt(mtot):&gt;10}")

    # Save a compact CSV summary
    csv_path = "summary.csv"
    try:
        import csv
        with open(csv_path, "w", newline="", encoding="utf-8") as cf:
            writer = csv.writer(cf)
            writer.writerow(["effort","mean_latency_ms","mean_completion_tokens","mean_reasoning_tokens","mean_total_tokens"])
            for e in ["&lt;unspecified&gt;", "low", "medium", "high"]:
                mlat = mean(by_effort.get(e, {}).get("latency", []))
                mout = mean(by_effort.get(e, {}).get("comp", []))
                mrea = mean(by_effort.get(e, {}).get("reason", []))
                mtot = mean(by_effort.get(e, {}).get("total", []))
                writer.writerow([e, f"{mlat:.1f}" if mlat else "", f"{mout:.1f}" if mout else "", f"{mrea:.1f}" if mrea else "", f"{mtot:.1f}" if mtot else ""])
        print(f"\nSaved: {csv_path}")
    except Exception as e:
        print(f"[WARN] CSV write failed: {e}")

    print(f"\nSaved raw runs to: {runs_path}")
    print(f"OK: {n_ok}, ERR: {n_err}")
    print("\nInterpretation tip:")
    print("- If '&lt;unspecified&gt;' and 'medium' are nearly identical across latency/tokens, your gateway default is likely 'medium'.")
    print("- Expect tokens/latency trend: low &lt; medium &lt; high (if reasoning tokens are exposed, same order).")

if __name__ == "__main__":
    main()
</code>

</p>

<p>ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ê·¸ëŒ€ë¡œ ì‹¤í–‰í•´ë„ <code class="language-plaintext highlighter-rouge">gpt-oss</code> ê¸°ë³¸ reasoning_effort ê°’ì„ ë¹ ë¥´ê²Œ í™•ì¸í•  ìˆ˜ ìˆê²Œ ì˜ ì§œì—¬ ìˆì–´ìš”.</p>

<h3 id="ìš”ì•½-1">ìš”ì•½</h3>

<ul>
  <li>
    <p><strong>í”„ë¡¬í”„íŠ¸</strong> : ë„ˆë¬´ trivialí•˜ì§€ ì•Šê³  reasoning ì°¨ì´ë¥¼ ë“œëŸ¬ë‚¼ ìˆ˜ ìˆëŠ” 5ë¬¸í•­.</p>
  </li>
  <li>
    <p><strong>ë¹„êµ ëª¨ë“œ</strong> :</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">&lt;unspecified&gt;</code> (ë¯¸ì§€ì • â†’ default ê°’ í™•ì¸)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">low</code>, <code class="language-plaintext highlighter-rouge">medium</code>, <code class="language-plaintext highlighter-rouge">high</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ì¸¡ì • ì§€í‘œ</strong> :</p>

    <ul>
      <li>
        <p>latency(ms)</p>
      </li>
      <li>
        <p>prompt/completion/reasoning/total tokens</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ì¶œë ¥</strong> :</p>

    <ul>
      <li>
        <p>ì½˜ì†”ì— í‰ê·  í‘œ</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">runs.jsonl</code> (ì›ì‹œ ë¡œê·¸)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">summary.csv</code> (í‰ê·  ìš”ì•½)</p>
      </li>
    </ul>
  </li>
</ul>

<h3 id="ì‹¤í–‰-ë°©ë²•">ì‹¤í–‰ ë°©ë²•</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">ENDPOINT_URL</span><span class="o">=</span><span class="s2">"https://&lt;your-endpoint&gt;"</span>
<span class="nb">export </span><span class="nv">API_KEY</span><span class="o">=</span><span class="s2">"sk-..."</span>

python gpt_oss_effort_smoke_test.py <span class="nt">--model</span> gpt-oss-20b <span class="nt">--repeats</span> 2
</code></pre></div></div>

<h3 id="ê²°ê³¼-í•´ì„">ê²°ê³¼ í•´ì„</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">&lt;unspecified&gt;</code>ì™€ <code class="language-plaintext highlighter-rouge">medium</code>ì´ ê±°ì˜ ë™ì¼ â†’ default = medium ê°€ëŠ¥ì„± í¼</p>
  </li>
  <li>
    <p>reasoning_tokens / latency ìˆœì„œ: <code class="language-plaintext highlighter-rouge">low &lt; medium &lt; high</code>ì´ë©´ ì •ìƒ ë™ì‘</p>
  </li>
</ul>

<p>ì›í•˜ë©´ ì—¬ê¸°ì— <strong>CSV ê²°ê³¼ë¥¼ ì‹œê°í™”í•˜ëŠ” í”Œë¡¯ ì½”ë“œ</strong> ë¥¼ ë¶™ì—¬ì„œ, í•œëˆˆì— ë¹„êµí•  ìˆ˜ ìˆê²Œ ë§Œë“¤ì–´ ë“œë¦´ê¹Œìš”?</p>]]></content><author><name>hvppyarchive</name></author><category term="llm" /><summary type="html"><![CDATA[]]></summary></entry></feed>